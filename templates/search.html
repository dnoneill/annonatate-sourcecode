{% extends 'base.html' %}
<link rel="stylesheet" type="text/css" href="https://dnoneill.github.io/jekyll-lunr-js-custom-search/dist/custom-search.css">
{% block content %}
<form action="{{ url_for('search') }}" method="get">
<input name="q" value="{{request.args['q']}}">
<input type="hidden" name="tag" value="{{request.args['tag']}}"> 
<input type="hidden" name="creator" value="{{request.args['creator']}}"> 
<input type=submit value=Submit>
</form>
<div class="content" style="display: inline-flex;">
<div style="float: left; width: 20%; ">
  <div id="facets">
    {% if facets['tags'] | length > 0 %}
    <h4>Tags</h4>
    {% for tag, count in facets['tags'].items() %}   
    {% if request.args['tag'] == tag %}
    <a href="{{url_for('search',tag='', q=request.args['q'], creator=request.args['creator']) }}">
    {% else %}
    <a href="{{url_for('search',tag=tag, creator=request.args['creator'], q=request.args['q']) }}">
    {% endif %}{{tag}} ({{count}}){% if request.args['tag'] == tag %} <i class="far fa-times-circle"></i>{% endif %}</a><br>
    {% endfor %}
    {% endif %}
    {% if facets['creator'] | length > 0 %}
    <h4>Creators</h4>
    {% for creator, count in facets['creator'].items() %}
    {% if request.args['creator'] == creator %}
    <a href="{{url_for('search',creator='', q=request.args['q'], tag=request.args['tag']) }}">
    {% else %}
    <a href="{{url_for('search',creator=creator, tag=request.args['tag'], q=request.args['q']) }}">
    {% endif %}{{creator}} ({{count}}){% if request.args['creator'] == creator %} <i class="far fa-times-circle"></i>{% endif %}</a><br>
    {% endfor %}
    {% endif %}
  </div>
</div>
<div style="float: left; width: 80%; border: 1px solid rgb(204, 204, 204);" class="all_results">
<div style="width: 100%; text-align: center; display: inline-block; border-bottom: 1px solid rgb(204, 204, 204);">
Showing {{results | length}} annotations out of {{annolength}} annotations
</div>
<ul id="resultslist">
{% for result in results %}
<li id="result">
{% if 'http' in result.id %}
<div class="thumbnail">
<iiif-annotation annotationurl="{{result.id}}" styling="image_only:true; height: 100;"></iiif-annotation>
</div>
{% endif %}
<h2><a href="{{ url_for('listannotations', annoid=result.basename, annotype='single') }}">{{result.basename}}</a></h2>
<div class="results_data">
  <table class="searchResultMetadata">
    <tbody>
      {% if result.searchfields.content %}
      <tr>
        <td class="searchResultLeftColumn">Content:</td>
        <td class="searchResultRightColumn">{{result.searchfields.content}}</td>
      </tr>
      {% endif %}
      {% if result.searchfields.tags %}
      <tr>
        <td class="searchResultLeftColumn">Tags:</td>
        <td class="searchResultRightColumn">{{result.searchfields.tags}}</td>
      </tr>
      {% endif %}
      {% if result.facets.creator %}
      <tr>
        <td class="searchResultLeftColumn">Creator{{'s' if result.facets.creator | length > 1}}: </td>
        <td class="searchResultRightColumn">{{", ".join(result.facets.creator)}}</td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>
</li>
{% endfor %}
</ul>
</div>
</div>
{% endblock %}
