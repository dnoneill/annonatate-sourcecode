function OpenSeadragon(options){return new OpenSeadragon.Viewer(options)}!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";function m(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item}function x(e){return null!=e&&e===e.window}var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var _t="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:_t,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(t){t=S.merge(this.constructor(),t);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(n){var t=this.length,n=+n+(n<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(o=a[t],o=i&&!Array.isArray(o)?[]:i||S.isPlainObject(o)?o:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(_t+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(n){return!(!n||"[object Object]"!==o.call(n)||(n=r(n))&&("function"!=typeof(n=v.call(n,"constructor")&&n.constructor)||a.call(n)!==l))},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,n){n=n||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!=a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var fe=function(n){function ne(n,t){return n="0x"+n.slice(1)-65536,t||(n<0?String.fromCharCode(65536+n):String.fromCharCode(n>>10|55296,1023&n|56320))}function ie(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}function oe(){T()}var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+ +new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(t,e,n,r){var o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(c=u[1]){if(9===p){if(!(a=e.getElementById(c)))return n;if(a.id===c)return n.push(a),n}else if(f&&(a=f.getElementById(c))&&y(e,a)&&a.id===c)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((c=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(c)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){for((f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;o--;)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t)}}function fe(e,t){for(var n=e.split("|"),r=n.length;r--;)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){for(var n,r=a([],e.length,o),i=r.length;i--;)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(n){var t=n&&n.namespaceURI,n=n&&(n.ownerDocument||n).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(r){var t,r=r?r.ownerDocument||r:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(t=C.defaultView)&&t.top!==t&&(t.addEventListener?t.addEventListener("unload",oe,!1):t.attachEvent&&t.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(n,t){if(void 0!==t.getElementById&&E){n=t.getElementById(n);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(t){t=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"!==e)return o;for(;n=o[i++];)1===n.nodeType&&r.push(n);return r},b.find.CLASS=d.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,r){var n=9===e.nodeType?e.documentElement:e,r=r&&r.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},j=t?function(e,t){return e===t?(l=!0,0):(n=!e.compareDocumentPosition-!t.compareDocumentPosition)||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1);var n}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var r=b.attrHandle[t.toLowerCase()],r=r&&D.call(b.attrHandle,t.toLowerCase())?r(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(t){t=se.attr(t,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!=m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){for(;l;){for(a=e;a=a[l];)if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){for(d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];a=++s&&a&&a[l]||(d=s=0)||u.pop();)if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(!1===(d=p?s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]:d))for(;(a=++s&&a&&a[l]||(d=s=0)||u.pop())&&((x?a.nodeName.toLowerCase()!==f:1!==a.nodeType)||!++d||(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a!==e)););return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){for(var n,r=a(e,o),i=r.length;i--;)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){for(var i,o=s(e,null,r,[]),a=e.length;a--;)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(t){return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(t=t.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=function(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){for(;e=e[u];)if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var i,r,a=[k,p];if(n){for(;e=e[u];)if((1===e.nodeType||f)&&s(e,t,n))return!0}else for(;e=e[u];)if(1===e.nodeType||f)if(i=(r=e[S]||(e[S]={}))[e.uniqueID]||(r[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){for(var r=i.length;r--;)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,r){r=!o&&(r||t!==w)||((i=t).nodeType?u:l)(e,t,r);return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r&&!b.relative[e[n].type];n++);return function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v)for(i=Te(p,u),v(i,[],n,r),o=i.length;o--;)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a));if(e){if(y||d){if(y){for(i=[],o=p.length;o--;)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}for(o=p.length;o--;)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);for(a=e,s=[],u=b.preFilter;a;){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){for(n=(t=t||h(e)).length;n--;)((a=Ee(t[n]))[S]?i:o).push(a);(a=A(e,(m=0<(y=i).length,x=0<(v=o).length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){for(a=0,t||o.ownerDocument==C||(T(o),n=!E);s=v[a++];)if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){for(a=0;s=y[a++];)s(c,f,t,n);if(e){if(0<u)for(;l--;)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=G.needsContext.test(e)?0:o.length;i--&&(a=o[i],!b.relative[s=a.type]);)if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,r,n){if(!n)return!0===e[r]?r.toLowerCase():(r=e.getAttributeNode(r))&&r.specified?r.value:null}),se}(C);S.find=fe,S.expr=fe.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=fe.uniqueSort,S.text=fe.getText,S.isXMLDoc=fe.isXML,S.contains=fe.contains,S.escapeSelector=fe.escape;function h(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r}function T(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}var k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(i,t,n){if(!i)return this;if(n=n||D,"string"!=typeof i)return i.nodeType?(this[0]=i,this.length=1,this):m(i)?void 0!==n.ready?n.ready(i):i(S):S.makeArray(i,this);if(!(r="<"===i[0]&&">"===i[i.length-1]&&3<=i.length?[null,i,null]:q.exec(i))||!r[1]&&t)return(!t||t.jquery?t||n:this.constructor(t)).find(i);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(var r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}).prototype=S.fn;var D=S(E),L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(t){t=t.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return(t="Until"!==r.slice(-5)?e:t)&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);function c(){for(a=a||r.once,o=i=!0;u.length;l=-1)for(t=u.shift();++l<s.length;)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1);r.memory||(t=!1),i=!1,a&&(s=t?[]:"")}var i,t,o,a,s=[],u=[],l=-1,f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){for(var n;-1<(n=S.inArray(t,s,n));)s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s=s&&[],this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){function e(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}}var n=this,r=arguments,t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){function a(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}}var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred();if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();for(;t--;)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e).catch(function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));function $(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),t=l?a?(t.call(e,r),null):(l=t,function(e,t,n){return l.call(S(e),n)}):t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o}var _=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}function V(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;for(;n--;)delete r[t[n]]}void 0!==t&&!S.isEmptyObject(r)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(t){t=t[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;return o&&void 0===e?void 0!==(t=Q.get(o,n))||void 0!==(t=Z(o,n))?t:void 0:void this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return r=Y.get(e,t=(t||"fx")+"queue"),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function s(){--r||i.resolveWith(o,[o])}var n,r=1,i=S.Deferred(),o=this,a=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var nt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+nt+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});function ae(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")}function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){for(l=l||c[3],c=+(u/=2)||1;a--;)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;S.style(e,t,(c*=2)+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=r.ownerDocument,s=r.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),ue[s]=u="none"===u?"block":u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i,_t=E.createDocumentFragment().appendChild(E.createElement("div"));(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),_t.appendChild(fe),y.checkClone=_t.cloneNode(!0).cloneNode(!0).lastChild.checked,_t.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!_t.cloneNode(!0).lastChild.defaultValue,_t.innerHTML="<option></option>",y.option=!!_t.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){for(a=a||f.appendChild(t.createElement("div")),u=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[u]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n)for(c=0;o=a[c++];)he.test(o.type||"")&&n.push(o);return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,u,l,c,f,d,h,p,v=Y.get(t);if(V(t))for(n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return void 0!==S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;l--;)d=p=(c=be.exec(e[l])||[])[1],h=(c[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:p,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){for(l=(t=(t||"").match(P)||[""]).length;l--;)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(c){var t,n,i,r,a,s=new Array(arguments.length),u=S.event.fix(c),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){for(a=S.event.handlers.call(this,u,l),t=0;(i=a[t++])&&!u.isPropagationStopped();)for(u.currentTarget=i.elem,n=0;(r=i.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==r.namespace&&!u.rnamespace.test(r.namespace)||(u.handleObj=r,u.data=r.data,void 0!==(r=((S.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(t){t=this||t;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(t){t=this||t;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(t){t=t.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)});for(i in e)this.off(i,t,e[i]);return this}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(a,t){var n,r,i,s;if(1===t.nodeType){if(Y.hasData(a)&&(s=Y.get(a).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(a)&&(a=Q.access(a),a=S.extend({},a),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],"input"===(l=(u=a[r]).nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=je(this,e)).insertBefore(e,t.firstChild)})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});function Re(e){var t=e.ownerDocument.defaultView;return(t=!t||!t.opener?C:t).getComputedStyle(e)}function Me(e,t,r){var i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=r.call(e),t)e.style[i]=o[i];return r}var Pe=new RegExp("^("+nt+")(?!px)[a-z%]+$","i"),Ie=new RegExp(ne.join("|"),"i");function We(i,o,n){var r,a,s=i.style;return(n=n||Re(i))&&(""!==(a=n.getPropertyValue(o)||n[o])||ie(i)||(a=S.style(i,o)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(o)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){var e;l&&(u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l),e=C.getComputedStyle(l),n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null)}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),r=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",r.style.height="9px",r.style.display="block",re.appendChild(e).appendChild(t).appendChild(r),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){return S.cssProps[e]||_e[e]||(e in $e?e:_e[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Be.length;n--;)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(n,t){if(t){n=We(n,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"==(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,o,n,r){var i,a=X(o);return Xe.test(o)||(o=ze(a)),"normal"===(i=void 0===(i=(a=S.cssHooks[o]||S.cssHooks[a])&&"get"in a?a.get(e,!0,n):i)?We(e,o,r):i)&&o in Ge&&(i=Ge[o]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,s){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||s)&&"border-box"===S.css(e,"boxSizing",!1,i),s=s?Qe(e,u,s,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return(e&&e.get?e:Ke.propHooks._default).get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(n&&n.set?n:Ke.propHooks._default).set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(t){return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(t=S.css(t.elem,t.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var t=Ze||at(),t=Math.max(0,l.startTime+l.duration-t),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(n,t){n=S.Tween(o,l.opts,n,t,l.opts.specialEasing[n]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){for(var n,r=0,i=(e=m(e)?(t=e,["*"]):e.match(P)).length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in c&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,a){var i=S.isEmptyObject(t),o=S.speed(e,n,a),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){function a(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,this.queue(e=e||"fx",function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},_t=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),_t.type="checkbox",y.checkOn=""!==_t.value,y.optSelected=nt.selected,(_t=E.createElement("input")).value="t",_t.type="radio",y.radioValue="t"===_t.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):!(i&&"get"in i&&null!==(r=i.get(e,t)))&&null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),y.optSelected||(S.propHooks.selected={get:function(t){t=t.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(t){t=t.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)for(;n=this[u++];)if(s=gt(n),r=1===n.nodeType&&" "+ht(s)+" "){for(a=0;o=e[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");s!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)for(;n=this[u++];)if(s=gt(n),r=1===n.nodeType&&" "+ht(s)+" "){for(a=0;o=e[a++];)for(;-1<r.indexOf(" "+o+" ");)r=r.replace(" "+o+" "," ");s!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"==o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a)for(t=0,n=S(this),r=vt(i);e=r[t++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==i&&"boolean"!=o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==i&&Y.get(this,"__className__")||""))})},hasClass:function(e){for(var n,r=0,t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(t){1===this.nodeType&&(null==(t=i?n.call(this,t,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){for(var t,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length,r=o<0?u:a?o:0;r<u;r++)if(((t=i[r]).selected||r===o)&&!t.disabled&&(!t.parentNode.disabled||!A(t.parentNode,"optgroup"))){if(t=S(t).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=S.makeArray(t),a=i.length;a--;)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;function xt(e){e.stopPropagation()}var mt=/^(?:focusinfocus|focusoutblur)$/;S.extend(S.event,{trigger:function(e,t,n,r){var i,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[],o=f=a=n=n||E;if(3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}for(i=0;(o=p[i++])&&!e.isPropagationStopped();)f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(r,t,n){r=S.extend(new S.Event,n,{type:r,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){function i(e){S.event.simulate(r,e.target,S.event.fix(e))}S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;S.param=function(e,t){function i(e,n){n=m(n)?n():n,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)}var n,r=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)!function At(n,e,r,i){if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(var t in e)At(n+"["+t+"]",e[t],r,i)}(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))for(;n=i[r++];)"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,n){n=n(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r=r||{})[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var c,f,p,n,d,h,g,i,o,v=S.ajaxSetup({},t=t||{}),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n)for(n={};t=qt.exec(p);)n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){if(e)if(h)T.always(e[T.status]);else for(var t in e)w[t]=[w[t],e[t]];return this},abort:function(t){t=t||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){o=E.createElement("a");try{o.href=v.url,o.href=o.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=o.protocol+"//"+o.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,u,i){var o,a,s,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=i||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,u&&(s=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a=a||i}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,u)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){for(var t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(t){return this[0]&&(m(t)&&(t=t.call(this[0])),t=S(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(y.createHTMLDocument?((o=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(o)):t=E),o=!i&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var o,a,s,i,r=S.css(e,"position"),c=S(e),f={};"static"===r&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),i=S.css(e,"left"),i=("absolute"===r||"fixed"===r)&&-1<(o+i).indexOf("auto")?(a=(r=c.position()).top,r.left):(a=parseFloat(o)||0,parseFloat(i)||0),null!=(t=m(t)?t.call(e,n,S.extend({},s)):t).top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),n=n.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===S.css(e,"position");)e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;return x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n?r?r[i]:e[t]:void(r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n)},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var r,i;if("string"==typeof t&&(i=e[t],t=e,e=i),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},void 0===e&&(C.jQuery=C.$=S),S}),void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e,window)}):"object"==typeof module&&module.exports?module.exports=t(require("jquery"),window):t(jQuery,window)}(function(s,n){"use strict";function e(e){return 0<=function(e,t){for(var r=/^(\d+)\.(\d+)\.(\d+)/,n=r.exec(e)||[],o=r.exec(t)||[],i=1;i<=3;i++){if(+o[i]<+n[i])return 1;if(+n[i]<+o[i])return-1}return 0}(s.fn.jquery,e)}s.migrateVersion="3.3.2",n.console&&n.console.log&&(s&&e("3.0.0")||n.console.log("JQMIGRATE: jQuery 3.0.0+ REQUIRED"),s.migrateWarnings&&n.console.log("JQMIGRATE: Migrate plugin loaded multiple times"),n.console.log("JQMIGRATE: Migrate is installed"+(s.migrateMute?"":" with logging active")+", version "+s.migrateVersion));var r={};function u(e){var t=n.console;s.migrateDeduplicateWarnings&&r[e]||(r[e]=!0,s.migrateWarnings.push(e),t&&t.warn&&!s.migrateMute&&(t.warn("JQMIGRATE: "+e),s.migrateTrace&&t.trace&&t.trace()))}function t(e,t,r,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return u(n),r},set:function(e){u(n),r=e}})}function o(e,t,r,n){e[t]=function(){return u(n),r.apply(this,arguments)}}s.migrateDeduplicateWarnings=!0,s.migrateWarnings=[],void 0===s.migrateTrace&&(s.migrateTrace=!0),s.migrateReset=function(){r={},s.migrateWarnings.length=0},"BackCompat"===n.document.compatMode&&u("jQuery is not compatible with Quirks Mode");var i,a,c,d={},l=s.fn.init,p=s.find,f=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/,y=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/g,m=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;for(i in s.fn.init=function(e){var t=Array.prototype.slice.call(arguments);return"string"==typeof e&&"#"===e&&(u("jQuery( '#' ) is not a valid selector"),t[0]=[]),l.apply(this,t)},s.fn.init.prototype=s.fn,s.find=function(t){var r=Array.prototype.slice.call(arguments);if("string"==typeof t&&f.test(t))try{n.document.querySelector(t)}catch(e){t=t.replace(y,function(e,t,r,n){return"["+t+r+'"'+n+'"]'});try{n.document.querySelector(t),u("Attribute selector with '#' must be quoted: "+r[0]),r[0]=t}catch(e){u("Attribute selector with '#' was not fixed: "+r[0])}}return p.apply(this,r)},p)Object.prototype.hasOwnProperty.call(p,i)&&(s.find[i]=p[i]);o(s.fn,"size",function(){return this.length},"jQuery.fn.size() is deprecated and removed; use the .length property"),o(s,"parseJSON",function(){return JSON.parse.apply(null,arguments)},"jQuery.parseJSON is deprecated; use JSON.parse"),o(s,"holdReady",s.holdReady,"jQuery.holdReady is deprecated"),o(s,"unique",s.uniqueSort,"jQuery.unique is deprecated; use jQuery.uniqueSort"),t(s.expr,"filters",s.expr.pseudos,"jQuery.expr.filters is deprecated; use jQuery.expr.pseudos"),t(s.expr,":",s.expr.pseudos,"jQuery.expr[':'] is deprecated; use jQuery.expr.pseudos"),e("3.1.1")&&o(s,"trim",function(e){return null==e?"":(e+"").replace(m,"")},"jQuery.trim is deprecated; use String.prototype.trim"),e("3.2.0")&&(o(s,"nodeName",function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},"jQuery.nodeName is deprecated"),o(s,"isArray",Array.isArray,"jQuery.isArray is deprecated; use Array.isArray")),e("3.3.0")&&(o(s,"isNumeric",function(e){var t=typeof e;return("number"==t||"string"==t)&&!isNaN(e-parseFloat(e))},"jQuery.isNumeric() is deprecated"),s.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){d["[object "+t+"]"]=t.toLowerCase()}),o(s,"type",function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?d[Object.prototype.toString.call(e)]||"object":typeof e},"jQuery.type is deprecated"),o(s,"isFunction",function(e){return"function"==typeof e},"jQuery.isFunction() is deprecated"),o(s,"isWindow",function(e){return null!=e&&e===e.window},"jQuery.isWindow() is deprecated")),s.ajax&&(a=s.ajax,c=/(=)\?(?=&|$)|\?\?/,s.ajax=function(){var e=a.apply(this,arguments);return e.promise&&(o(e,"success",e.done,"jQXHR.success is deprecated and removed"),o(e,"error",e.fail,"jQXHR.error is deprecated and removed"),o(e,"complete",e.always,"jQXHR.complete is deprecated and removed")),e},e("4.0.0")||s.ajaxPrefilter("+json",function(e){!1!==e.jsonp&&(c.test(e.url)||"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&c.test(e.data))&&u("JSON-to-JSONP auto-promotion is deprecated")}));var g=s.fn.removeAttr,h=s.fn.toggleClass,v=/\S+/g;function j(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})}s.fn.removeAttr=function(e){var r=this;return s.each(e.match(v),function(e,t){s.expr.match.bool.test(t)&&(u("jQuery.fn.removeAttr no longer sets boolean properties: "+t),r.prop(t,!1))}),g.apply(this,arguments)};var Q,b=!(s.fn.toggleClass=function(t){return void 0!==t&&"boolean"!=typeof t?h.apply(this,arguments):(u("jQuery.fn.toggleClass( boolean ) is deprecated"),this.each(function(){var e=this.getAttribute&&this.getAttribute("class")||"";e&&s.data(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==t&&s.data(this,"__className__")||"")}))}),w=/^[a-z]/,x=/^(?:Border(?:Top|Right|Bottom|Left)?(?:Width|)|(?:Margin|Padding)?(?:Top|Right|Bottom|Left)?|(?:Min|Max)?(?:Width|Height))$/;s.swap&&s.each(["height","width","reliableMarginRight"],function(e,t){var r=s.cssHooks[t]&&s.cssHooks[t].get;r&&(s.cssHooks[t].get=function(){var e;return b=!0,e=r.apply(this,arguments),b=!1,e})}),s.swap=function(e,t,r,o){var i,a={};for(i in b||u("jQuery.swap() is undocumented and deprecated"),t)a[i]=e.style[i],e.style[i]=t[i];for(i in o=r.apply(e,o||[]),t)e.style[i]=a[i];return o},e("3.4.0")&&"undefined"!=typeof Proxy&&(s.cssProps=new Proxy(s.cssProps||{},{set:function(){return u("JQMIGRATE: jQuery.cssProps is deprecated"),Reflect.set.apply(this,arguments)}})),s.cssNumber||(s.cssNumber={}),Q=s.fn.css,s.fn.css=function(e,n){var r,o=this;return e&&"object"==typeof e&&!Array.isArray(e)?(s.each(e,function(e,t){s.fn.css.call(o,e,t)}),this):("number"==typeof n&&(r=j(e),w.test(n=r)&&x.test(n[0].toUpperCase()+n.slice(1))||s.cssNumber[r]||u('Number-typed values are deprecated for jQuery.fn.css( "'+e+'", value )')),Q.apply(this,arguments))};var A,k,S,M,N=s.data;s.data=function(e,t,r){var n,o,i;if(t&&"object"==typeof t&&2===arguments.length){for(i in n=s.hasData(e)&&N.call(this,e),o={},t)i!==j(i)?(u("jQuery.data() always sets/gets camelCased names: "+i),n[i]=t[i]):o[i]=t[i];return N.call(this,e,o),t}return t&&"string"==typeof t&&t!==j(t)&&(n=s.hasData(e)&&N.call(this,e))&&t in n?(u("jQuery.data() always sets/gets camelCased names: "+t),2<arguments.length&&(n[t]=r),n[t]):N.apply(this,arguments)},s.fx&&(S=s.Tween.prototype.run,M=function(e){return e},s.Tween.prototype.run=function(){1<s.easing[this.easing].length&&(u("'jQuery.easing."+this.easing.toString()+"' should use only one argument"),s.easing[this.easing]=M),S.apply(this,arguments)},A=s.fx.interval||13,k="jQuery.fx.interval is deprecated",n.requestAnimationFrame&&Object.defineProperty(s.fx,"interval",{configurable:!0,enumerable:!0,get:function(){return n.document.hidden||u(k),A},set:function(e){u(k),A=e}}));var R=s.fn.load,H=s.event.add,C=s.event.fix;function T(e){var t=n.document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body&&t.body.innerHTML}function P(e){var t=e.replace(O,"<$1></$2>");t!==e&&T(e)!==T(t)&&u("HTML tags must be properly nested and closed: "+e)}s.event.props=[],s.event.fixHooks={},t(s.event.props,"concat",s.event.props.concat,"jQuery.event.props.concat() is deprecated and removed"),s.event.fix=function(e){var t=e.type,n=this.fixHooks[t],o=s.event.props;if(o.length)for(u("jQuery.event.props are deprecated and removed: "+o.join());o.length;)s.event.addProp(o.pop());if(n&&!n._migrated_&&(n._migrated_=!0,u("jQuery.event.fixHooks are deprecated and removed: "+t),(o=n.props)&&o.length))for(;o.length;)s.event.addProp(o.pop());return t=C.call(this,e),n&&n.filter?n.filter(t,e):t},s.event.add=function(e,t){return e===n&&"load"===t&&"complete"===n.document.readyState&&u("jQuery(window).on('load'...) called after load event occurred"),H.apply(this,arguments)},s.each(["load","unload","error"],function(e,t){s.fn[t]=function(){var e=Array.prototype.slice.call(arguments,0);return"load"===t&&"string"==typeof e[0]?R.apply(this,e):(u("jQuery.fn."+t+"() is deprecated"),e.splice(0,0,t),arguments.length?this.on.apply(this,e):(this.triggerHandler.apply(this,e),this))}}),s.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,r){s.fn[r]=function(e,t){return u("jQuery.fn."+r+"() event shorthand is deprecated"),0<arguments.length?this.on(r,null,e,t):this.trigger(r)}}),s(function(){s(n.document).triggerHandler("ready")}),s.event.special.ready={setup:function(){this===n.document&&u("'ready' event is deprecated")}},s.fn.extend({bind:function(e,t,r){return u("jQuery.fn.bind() is deprecated"),this.on(e,null,t,r)},unbind:function(e,t){return u("jQuery.fn.unbind() is deprecated"),this.off(e,null,t)},delegate:function(e,t,r,n){return u("jQuery.fn.delegate() is deprecated"),this.on(t,e,r,n)},undelegate:function(e,t,r){return u("jQuery.fn.undelegate() is deprecated"),1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)},hover:function(e,t){return u("jQuery.fn.hover() is deprecated"),this.on("mouseenter",e).on("mouseleave",t||e)}});var O=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,q=s.htmlPrefilter;s.UNSAFE_restoreLegacyHtmlPrefilter=function(){s.htmlPrefilter=function(e){return P(e),e.replace(O,"<$1></$2>")}},s.htmlPrefilter=function(e){return P(e),q(e)};var D,_=s.fn.offset;s.fn.offset=function(){var e=this[0];return!e||e.nodeType&&e.getBoundingClientRect?_.apply(this,arguments):(u("jQuery.fn.offset() requires a valid DOM element"),arguments.length?this:void 0)},s.ajax&&(D=s.param,s.param=function(e,t){var r=s.ajaxSettings&&s.ajaxSettings.traditional;return void 0===t&&r&&(u("jQuery.param() no longer uses jQuery.ajaxSettings.traditional"),t=r),D.call(this,e,t)});var E,F,J=s.fn.andSelf||s.fn.addBack;return s.fn.andSelf=function(){return u("jQuery.fn.andSelf() is deprecated and removed, use jQuery.fn.addBack()"),J.apply(this,arguments)},s.Deferred&&(E=s.Deferred,F=[["resolve","done",s.Callbacks("once memory"),s.Callbacks("once memory"),"resolved"],["reject","fail",s.Callbacks("once memory"),s.Callbacks("once memory"),"rejected"],["notify","progress",s.Callbacks("memory"),s.Callbacks("memory")]],s.Deferred=function(e){var i=E(),a=i.promise();return i.pipe=a.pipe=function(){var o=arguments;return u("deferred.pipe() is deprecated"),s.Deferred(function(n){s.each(F,function(e,t){var r="function"==typeof o[e]&&o[e];i[t[1]](function(){var e=r&&r.apply(this,arguments);e&&"function"==typeof e.promise?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[t[0]+"With"](this===a?n.promise():this,r?[e]:arguments)})}),o=null}).promise()},e&&e.call(i,i),i},s.Deferred.exceptionHook=E.exceptionHook),s}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker((m.inline?m.dpDiv.parent():m.input)[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){for(var s in t.extend(e,i),i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){for(var s,n,o=0;null!=(n=i[o]);o++)try{(s=t._data(n,"events"))&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0],l=h+"-"+(e=e.split(".")[1]);return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),(a=new i).options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?void(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(r[e]=s)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n&&a.widgetEventPrefix||e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;o<a;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a))!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0:t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},e=(s=e.split(".")).shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){for(var e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){for(var a,r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,o,s){var n="string"==typeof t||null===t,o={extra:n?e:o,keys:n?t:e,element:n?this.element:t,add:s="boolean"==typeof s?s:o};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(l,a){function r(){return e||!0!==o.options.disabled&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var c=l.match(/^([\w:-]*)\s*(.*)$/),l=c[1]+o.eventNamespace,c=c[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){var s=this;return setTimeout(function(){return("string"==typeof t?s[t]:t).apply(s,arguments)},e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},(i=t.Event(i)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&!1===a.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){var r=(n="string"==typeof n?{effect:n}:n)?!0!==n&&"number"!=typeof n&&n.effect||i:e,a=!t.isEmptyObject(n="number"==typeof(n=n||{})?{duration:n}:n);n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),i=s.children()[0];return t("body").append(s),e=i.offsetWidth,s.css("overflow","scroll"),e===(i=i.offsetWidth)&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var n=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===n||"auto"===n&&e.width<e.element[0].scrollWidth;return{width:"scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:!s&&!n?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={},_=function(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}(v);return v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");(i=1===i.length?r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]:i)[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:i<0?"left":0<e?"right":"center",vertical:r<0?"top":0<s?"bottom":"middle"};p<l&&p>a(e+i)&&(u.horizontal="center"),f<c&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i=e.within,n=i.isWindow?i.scrollLeft:i.offset.left,a=i.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?0<h&&l<=0?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=!(0<l&&h<=0)&&l<h?n+a-e.collisionWidth:n:0<h?t.left+=h:0<l?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i=e.within,n=i.isWindow?i.scrollTop:i.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?0<h&&l<=0?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=!(0<l&&h<=0)&&l<h?n+a-e.collisionHeight:n:0<h?t.top+=h:0<l?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var p=e.within,i=p.offset.left+p.scrollLeft,r=p.width,s=p.isWindow?p.scrollLeft:p.offset.left,f=t.left-e.collisionPosition.marginLeft,c=f-s,u=f+e.collisionWidth-r-s,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];c<0?((i=t.left+d+p+f+e.collisionWidth-r-i)<0||a(c)>i)&&(t.left+=d+p+f):0<u&&((0<(s=t.left-e.collisionPosition.marginLeft+d+p+f-s)||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var f=e.within,s=f.offset.top+f.scrollTop,r=f.height,i=f.isWindow?f.scrollTop:f.offset.top,g=t.top-e.collisionPosition.marginTop,c=g-i,u=g+e.collisionHeight-r-i,p="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];c<0?((s=t.top+p+f+g+e.collisionHeight-r-s)<0||a(c)>s)&&(t.top+=p+f+g):0<u&&((0<(i=t.top-e.collisionPosition.marginTop+p+f+g-i)||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:t<0?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,l){var a=l.re.exec(i),a=a&&l.parse(a),l=l.space||"rgba";return a?(a=s[l](a),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return 6*(i=(i+1)%1)<1?t+6*(e-t)*i:2*i<1?e:3*i<2?t+6*(e-t)*(2/3-i):t}var o,r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=-1<p.style.backgroundColor.indexOf("rgba"),f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),(l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(f(c,n instanceof l?function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}:function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&t.inArray(null,u[o].slice(0,3))<0&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(a,e){var n=(s=l(a))._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice(),s=s[o.cache];return f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?2<e?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=2<e?1:0),t=e&&e<3?Math.round(100*t)+"%":t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return 1===(t=(t||0).toString(16)).length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}})).parse.prototype=l.fn,c.hsla.to=function(u){if(null==u[0]||null==u[1]||null==u[2])return[null,null,null,u[3]];var s=u[0]/255,n=u[1]/255,o=u[2]/255,a=u[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,i=r+h,u=.5*i,i=0==l?0:u<=.5?l/i:l/(2-i);return[Math.round(h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240)%360,i,u,null==a?1:a]},c.hsla.from=function(o){if(null==o[0]||null==o[1]||null==o[2])return[null,null,null,o[3]];var e=o[0]/360,a=o[1],r=o[2],o=o[3],a=r<=.5?r*(1+a):r+a-r*a,r=2*r-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(s,e){s=u["object"===r?s:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?((n=l(c(d)))[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===o?c:("function"===o&&(n=n.call(this,c),o=t.type(n)),null==n&&i.empty?this:("string"===o&&((o=r.exec(n))&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),(l.hook=function(i){i=i.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})})("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)"string"==typeof n[i=n[s]]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||!t.fx.step[s]&&isNaN(parseFloat(o))||(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var a=t(this),r=a.attr("class")||"",l=(l=h.children?a.find("*").addBack():a).map(function(){return{el:t(this),start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})};o(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return 1<arguments.length?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return e={effect:e=t.isPlainObject(e)?(i=e).effect:e},t.isFunction(i=null==i?{}:i)&&(n=i,s=null,i={}),"number"!=typeof i&&!t.fx.speeds[i]||(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]||("string"==typeof e&&!t.effects.effect[e]||(t.isFunction(e)||"object"==typeof e&&!e.effect))}function s(o,s){var i=s.outerWidth(),s=s.outerHeight(),o=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(o)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),!1!==t.uiBackCompat&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;i<s;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;s<n;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return e="toggle"===e?t.is(":hidden")?"show":"hide":e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),e[0]!==o&&!t.contains(e[0],o)||t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),e[0]!==i&&!t.contains(e[0],i)||t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,n,i){if(0===n)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(n||100)/100:1,n="vertical"!==i?(n||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();1<e&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(i,e){i=i.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),e=(i?"hide"===e:"show"===e)?"none":e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),float:e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);0<o[0]&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),!1===t.uiBackCompat||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,function(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}function u(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[];return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):!1===a?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){0<i.indexOf(e)&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),u=t(e.to),o="fixed"===u.css("position"),c=t("body"),r=o?c.scrollTop():0,h=o?c.scrollLeft():0,c=u.offset(),c={top:c.top-r,left:c.left-h,height:u.innerHeight(),width:u.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return t<.5?i(2*t)/2:1-i(-2*t+2)/2}})}();t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(b,i){var s,n,a=t(this),p=b.mode,h="hide"===p,l="show"===p,o=b.direction||"up",u=b.distance,d=b.times||5,p=2*d+(l||h?1:0),f=b.duration/p,g=b.easing,m="up"===o||"down"===o?"top":"left",_="up"===o||"left"===o,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u=u||a["top"==m?"outerHeight":"outerWidth"]()/3,l&&((n={opacity:1})[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),(n={})[m]=o;v<d;v++)(s={})[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&((s={opacity:0})[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,1+p)}),t.effects.define("clip","hide",function(e,i){var n={},o=t(this),s=e.direction||"vertical",l="both"===s,h=l||"horizontal"===s,l=l||"vertical"===s,s=o.cssClip();n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var n=t(this),a="show"===e.mode,s=e.direction||"left",h="up"===s||"down"===s?"top":"left",l="up"===s||"left"===s?"-=":"+=",c="+="==l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"==h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&(p.css({visibility:"visible"}),t(b).remove(),i())}for(var a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),g="show"===e.mode,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[],o=0;o<u;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;a<d;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),_=e.mode,o="show"===_,a="hide"===_,r=e.size||15,h=/([0-9]+)%/.exec(r),c=!!e.horizFirst?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var n,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],o=e.mode,u="effect"!==o,d=e.scale||"both",s=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===o&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},"box"!==d&&"both"!==d||(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),"content"!==d&&"both"!==d||n.from.y===n.to.y||(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),s&&(s=t.effects.getBaseline(s,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),"content"!==d&&"both"!==d||(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),a=t.effects.scaledDimensions(i),o={height:a.height*n.from.y,width:a.width*n.from.x,outerHeight:a.outerHeight*n.from.y,outerWidth:a.outerWidth*n.from.x},a={height:a.height*n.to.y,width:a.width*n.to.x,outerHeight:a.height*n.to.y,outerWidth:a.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),a=e.mode,a=parseInt(e.percent,10)||(0===parseInt(e.percent,10)||"effect"!==a?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,a,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(s,i){s=t.extend(!0,{},s,{fade:!0,percent:parseInt(s.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),d=e.mode,o="show"===d,h=2*(e.times||5)+(o||"hide"===d?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for(!o&&s.is(":visible")||(s.css("opacity",0).show(),c=1);u<h;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,1+h)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),g=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===g||"down"===g?"top":"left",u="up"===g||"left"===g,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);s<r;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,1+h)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"==l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),!1!==t.uiBackCompat&&t.effects.define("transfer",function(e,i){t(this).transfer(e,i)}),t.ui.focusable=function(i,s){var n,o,r,h,l=i.nodeName.toLowerCase();return"area"===l?(o=(n=i.parentNode).name,!(!i.href||!o||"map"!==n.nodeName.toLowerCase())&&(0<(h=t("img[usemap='#"+o+"']")).length&&h.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled)&&((h=t(i).closest("fieldset")[0])&&(r=!h.disabled)):r="a"===l&&i.href||s,r&&t(i).is(":visible")&&function(t){for(var e=t.css("visibility");"inherit"===e;)e=(t=t.parent()).css("visibility");return"hidden"!==e}(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){var t;this.form=this.element.form(),this.form.length&&((t=this.form.data("ui-form-reset-instances")||[]).length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t))},_unbindFormResetHandler:function(){var e;this.form.length&&((e=this.form.data("ui-form-reset-instances")).splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset"))}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var i,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),(i=this.attr("id"))&&(o=(o=this.eq(0).parents().last()).add((o.length?o:this).siblings()),i="label[for='"+t.ui.escapeSelector(i)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(o){var i=this.css("position"),s="absolute"===i,n=o?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return(!s||"static"!==e.css("position"))&&n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||0<=i)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||!1!==e.active&&null!=e.active||(e.active=0),this._processPanels(),e.active<0&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var i,s=this.options.icons;s&&(i=t("<span>"),this._addClass(i,"ui-accordion-header-icon","ui-icon "+s.header),i.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||!1!==this.options.active||this._activate(0),void("icons"===t&&(this._destroyIcons(),e&&this._createIcons())))},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),!1===e.active&&!0===e.collapsible||!this.headers.length?(e.active=!1,this.active=t()):!1===e.active?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(i){i=this._findActive(i)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var n=this.options,i=this.active,a=t(e.currentTarget),s=a[0]===i[0],h=s&&n.collapsible,u=h?t():a.next(),c=i.next(),u={oldHeader:i,oldPanel:c,newHeader:h?t():a,newPanel:u};e.preventDefault(),s&&!n.collapsible||!1===this._trigger("beforeActivate",e,u)||(n.active=!h&&this.headers.index(a),this.active=s?t():a,this._toggle(u),this._removeClass(i,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=i.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),s||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,a=this,r=0,h=t.css("box-sizing"),d=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=d&&c.down||c,d=function(){a._toggleComplete(i)},n=(n="string"==typeof u?u:n)||u.easing||c.easing,o=(o="number"==typeof u?u:o)||u.duration||c.duration;return e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}})):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e=!(e=e||t.body).nodeName?t.body:e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i,s;this.previousFilter||(i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget),i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s)))},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]))||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var i=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:i=this.previousFilter||"",o=a=!1,n=96<=e.keyCode&&e.keyCode<=105?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===i?o=!0:n=i+n,i=this._filterMenuItems(n),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var i,n,a=this,r=this.options.icons.submenu,o=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),n=o.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(n,"ui-menu","ui-widget ui-widget-content ui-front"),(i=o.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),o=(n=i.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){var i;"icons"===t&&(i=this.element.find(".ui-menu-icon"),this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),i=this.active.children(".ui-menu-item-wrapper"),this._addClass(i,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),i=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(i,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=e.children(".ui-menu")).length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(r){var n,o,a;this._hasScroll()&&(o=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,a=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=r.offset().top-this.activeMenu.offset().top-o-a,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=r.outerHeight(),n<0?this.activeMenu.scrollTop(o+n):a<n+r&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){(t=t||(this.active?this.active.parent():this.element)).find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;(s=this.active?"first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0):s)&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return(i=t(this)).offset().top-s-n<0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,s,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return 0<(i=t(this)).offset().top-s+n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(i){var i=i.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,a=this.element[0].nodeName.toLowerCase(),o="textarea"===a,a="input"===a;this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))i=s=e=!0;else{i=s=e=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}}},keypress:function(s){if(e)return e=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||s.preventDefault());if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)})):(s=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:s})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(s.value),void((s=i.item.attr("aria-label")||s.value)&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion))))},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e=!(e=!(e=e&&(e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)))||!e[0]?this.element.closest(".ui-front, dialog"):e).length?this.document[0].body:e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;e&&(i||s)||(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):!1!==this._trigger("search",e)?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t=t&&this._normalize(t),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(1<t?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var m,g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a;return n?"controlgroupLabel"===s?((o=e.element.find(n)).each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(o.get()))):void(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),h=t.widget.extend({},a);"button"===s&&n.parent(".ui-spinner").length||((o=o||n[s]()[s]("instance"))&&(h.classes=e._resolveClassesValues(h.classes,o)),n[s](h),h=n[s]("widget"),t.data(h[0],"ui-controlgroup-data",o||n[s]("instance")),i.push(h[0]))}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var s=t(this).data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,s){s=this._buildSimpleOptions(s,"label").classes.label;this._removeClass(t,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(e){e=this._buildSimpleOptions(e,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"",o=t.trim(o.replace(g,""));s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,(e=this.options.onlyVisible?e.filter(":visible"):e).length&&(t.each(["first","last"],function(t,s){var o,n=e[s]().data("ui-controlgroup-data");n&&i["_"+n.widgetName+"Options"]?((o=i["_"+n.widgetName+"Options"](1===e.length?"only":s)).classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)):i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,s=this,n=this._super()||{};return this._readType(),e=this.element.labels(),this.label=t(e[e.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),null!=(e=this.element[0].disabled)&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length})).not(this.element):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),(t=this.iconSpace?t.not(this.iconSpace[0]):t).remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),null!=(t=this.element[0].disabled)&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(o,i){var s="iconPosition"!==o,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=(void 0===t.showLabel?this.options:t).showLabel,i=(void 0===t.icon?this.options:t).icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),(this.element[0].disabled=e)&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),!1!==t.uiBackCompat&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}}),t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var o,s=e.nodeName.toLowerCase(),n="div"===s||"span"===s;e.id||(this.uuid+=1,e.id="dp"+this.uuid),(o=this._newInst(t(e),n)).settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var o,n=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),n&&(i.append=t("<span class='"+this._appendClass+"'>"+n+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),"focus"!==(o=this._get(i,"showOn"))&&"both"!==o||e.on("focus",this._showDatepicker),"button"!==o&&"both"!==o||(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():(t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]&&t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])),!1}))},_autoSize:function(t){var e,i,s,n,o,a;this._get(t,"autoSize")&&!t.inline&&(o=new Date(2009,11,20),(a=this._get(t,"dateFormat")).match(/[DM]/)&&(e=function(t){for(n=s=i=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length))},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,c,s,l,u){var h,d=this._dialogInst;return d||(this.uuid+=1,h="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+h+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),(d=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,l||{}),c=c&&c.constructor===Date?this._formatDate(d,c):c,this._dialogInput.val(c),this._pos=u?u.length?u:[u.pageX,u.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s=t(e),o=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&("input"===(i=e.nodeName.toLowerCase())?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||((s=s.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s=t(e),o=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&("input"===(i=e.nodeName.toLowerCase())?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||((s=s.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&((n={})[i]=s),void(l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(e){e=this._getInst(e);e&&this._updateDatepicker(e)},_setDateDatepicker:function(i,e){i=this._getInst(i);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(i,e){i=this._getInst(i);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return(s=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv))[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,s[0]),(i=t.datepicker._get(o,"onSelect"))?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s=t.datepicker._getInst(e.target);return t.datepicker._get(s,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(s,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||s<" "||!i||-1<i.indexOf(s)):void 0},_doKeyUp:function(s){s=t.datepicker._getInst(s.target);if(s.input.val()!==s.lastVal)try{t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s))&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){var r,l,c,s;"input"!==(e=e.target||e).nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),t.datepicker._isDisabledDatepicker(e)||t.datepicker._lastInput===e||(s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),!1!==(l=(c=t.datepicker._get(s,"beforeShow"))?c.apply(e,[e,s]):{})&&(a(s.settings,l),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return!(r|="fixed"===t(this).css("position"))}),c={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),c=t.datepicker._checkOffset(s,c,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:c.left+"px",top:c.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",function(t){for(var e,i;t.length&&t[0]!==document;){if(("absolute"===(e=t.css("position"))||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s)))},_updateDatepicker:function(e){this.maxRows=4,(m=e).dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],r=e.dpDiv.find("."+this._dayOverClass+" a");0<r.length&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),1<n&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&n<h?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&o<l?Math.abs(o+r):0),i},_findPos:function(e){for(var i=this._getInst(e),n=this._get(i,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return[(i=t(e).offset()).left,i.top]},_hideDatepicker:function(o){var i,s,a=this._curInst;!a||o&&a!==t.data(o,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),o=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,o):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,o),i||o(),this._datepickerShowing=!1,(o=this._get(a,"onClose"))&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(s){var i;t.datepicker._curInst&&(i=t(s.target),s=t.datepicker._getInst(i[0]),(i[0].id===t.datepicker._mainDivId||0!==i.parents("#"+t.datepicker._mainDivId).length||i.hasClass(t.datepicker.markerClassName)||i.closest("."+t.datepicker._triggerClass).length||!t.datepicker._datepickerShowing||t.datepicker._inDialog&&t.blockUI)&&(!i.hasClass(t.datepicker.markerClassName)||t.datepicker._curInst===s)||t.datepicker._hideDatepicker())},_adjustDate:function(o,i,s){var n=t(o),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(i){var s=t(i),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(o,i,s){var n=t(o),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||((o=this._getInst(o[0])).selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(i){i=t(i);this._selectDate(i,"")},_selectDate:function(o,i){var s=t(o),o=this._getInst(s[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),(s=this._get(o,"onSelect"))?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(n){var i,s,o=this._get(n,"altField");o&&(i=this._get(n,"altFormat")||this._get(n,"dateFormat"),s=this._getDate(n),n=this.formatDate(i,s,this._getFormatConfig(n)),t(o).val(n))},noWeekends:function(e){e=e.getDay();return[0<e&&e<6,""]},iso8601Week:function(e){var i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?""+i:i+""))return null;function w(t){var a=y(t),a="@"===t?14:"!"===t?20:"y"===t&&a?4:"o"===t?3:2,a=RegExp("^\\d{"+("y"===t?a:1)+","+a+"}");if(!(a=i.substring(h).match(a)))throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)}function k(e,a,n){var o=-1,a=t.map(y(e)?n:a,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h}function x(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++}for(var o,a,r,h=0,c=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(i){i=e.length>n+1&&e.charAt(n+1)===i;return i&&n++,i},n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":g=(r=new Date(w("@"))).getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":g=(r=new Date((w("!")-this._ticksTo1970)/1e4)).getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():g<100&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(g<=c?0:-100)),-1<v)for(m=1,_=v;!(_<=(o=this._getDaysInMonth(g,m-1)));)m++,_-=o;if((r=this._daylightSavingAdjust(new Date(g,m-1,_))).getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";function l(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s}function c(t,e,i,s){return(h(t)?s:i)[e]}var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(i){i=t.length>s+1&&t.charAt(s+1)===i;return i&&s++,i},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(e.getFullYear()%100<10?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){function n(s){return(s=t.length>e+1&&t.charAt(e+1)===s)&&e++,s}for(var i="",s=!1,e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return(void 0!==t.settings[e]?t.settings:this._defaults)[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,a,s){a=null==a||""===a?s:"string"==typeof a?function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)}(a):"number"==typeof a?isNaN(a)?s:function(t){var e=new Date;return e.setDate(e.getDate()+t),e}(a):new Date(a.getTime());return(a=a&&"Invalid Date"==""+a?s:a)&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(12<t.getHours()?t.getHours()+2:0),t):null},_setDate:function(t,a,i){var s=!a,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,a,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){return!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,s,o,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,H,z,O,A,N,W,E,F,L,$=new Date,B=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth(),$.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),a=this._get(t,"hideIfNoPrevNext"),l=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),r=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-r,te=t.drawYear;if(Z<0&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&e<Q?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)--Z<0&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,r=this._get(t,"prevText"),r=l?this.formatDate(r,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):r,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+r+"</span></a>":a?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+r+"</span></a>",r=this._get(t,"nextText"),r=l?this.formatDate(r,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):r,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+r+"</span></a>":a?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+r+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=l?this.formatDate(a,r,this._getFormatConfig(t)):a,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?l:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":l)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",1<U[1])switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,0<k||0<C,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;w<7;w++)P+="<th scope='col'"+(5<=(w+c+6)%7?" class='ui-datepicker-week-end'":"")+"><span title='"+d[M=(w+c)%7]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",z=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,z)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+z)/7),O=X&&this.maxRows>z?this.maxRows:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;N<O;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;w<7;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],L=(F=A.getMonth()!==Z)&&!v||!E[0]||Q&&A<Q||J&&J<A,W+="<td class='"+(5<=(w+c+6)%7?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}11<++Z&&(Z=0,te++),x+=T+="</tbody></table>"+(X?"</div>"+(0<U[0]&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,p,r){var h,l,c,u,d,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+p[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),f=(p=function(e){e=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(e)?d:e})(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f<=g;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+"</div>"},_adjustInstDate:function(t,a,i){var s=t.selectedYear+("Y"===i?a:0),n=t.selectedMonth+("M"===i?a:0),a=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?a:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,a)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(t)},_restrictMinMax:function(s,n){var i=this._getMinMaxDate(s,"min"),s=this._getMinMaxDate(s,"max"),n=i&&n<i?i:n;return s&&s<n?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(e){e=this._get(e,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var o=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(e<0?e:o[0]*o[1]),1));return e<0&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(i,e){var n=this._getMinMaxDate(i,"min"),o=this._getMinMaxDate(i,"max"),a=null,r=null,s=this._get(i,"yearRange");return s&&(i=s.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return{shortYearCutoff:e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,n,i,s){n||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);n=n?"object"==typeof n?n:this._daylightSavingAdjust(new Date(s,i,n)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&("isDisabled"===e||"getDate"===e||"widget"===e)||"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)})},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return s&&!n&&this._mouseCapture(e)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?e.preventDefault():(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0)),!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||0<t(e.target).closest(".ui-resizable-handle").length)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blurActiveElement(e),this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]);t(e.target).closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=0<this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,s){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!s){s=this._uiHash();if(!1===this._trigger("drag",e,s))return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",e)&&i._clear()}):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(n){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[n])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=t.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this._isRootNode(this.offsetParent[0])?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var i,e=this.options,s=this.document[0];return this.relativeContainer=null,e.containment?"window"===e.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,t(s).width()-this.helperProportions.width-this.margins.left,(t(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),void((s=(i=t(e.containment))[0])&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(s,e){e=e||this.position;var i="absolute"===s?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(o,e){var i,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=o.pageX,l=o.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(i=this.relativeContainer?(i=this.relativeContainer.offset(),[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):this.containment,o.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),o.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),o.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),o.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(o=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=!i||o-this.offset.click.top>=i[1]||o-this.offset.click.top>i[3]?o:o-this.offset.click.top>=i[1]?o-a.grid[1]:o+a.grid[1],o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=!i||o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,n=this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])?!1:n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,o){var n=t("body"),o=o.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,n){n=n.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,n,o){n=t(n.helper),o=o.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,n){n=n.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),!1!==o&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){for(var n,o,a,r,h,l,c,u,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height,d=s.snapElements.length-1;0<=d;d--)l=(h=s.snapElements[d].left-s.margins.left)+s.snapElements[d].width,u=(c=s.snapElements[d].top-s.margins.top)+s.snapElements[d].height,_<h-g||l+g<m||b<c-g||u+g<v||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,a){var n,a=a.options,a=t.makeArray(t(a.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,n,o){n=t(n.helper),o=o.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,n){n=n.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,n){if("hidden"===t(e).css("overflow"))return!1;var s=n&&"left"===n?"scrollLeft":"scrollTop",n=!1;return 0<e[s]||(e[s]=1,n=0<e[s],e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();function i(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()}var e;return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){"handles"===(this._super(t,e),t)&&(this._removeHandles(),this._setupHandles())},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)n="ui-resizable-"+(e=t.trim(s[i])),o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,n,o;for(i in e=e||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(n=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],s!==e.target&&!t.contains(s,e.target)||(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),n.containment&&(i+=t(n.containment).scrollLeft()||0,s+=t(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var s=this.originalMousePosition,h=this.axis,a=e.pageX-s.left||0,s=e.pageY-s.top||0,h=this._change[h];return this._updatePrevProperties(),h&&(s=h.apply(this,[e,a,s]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(s=this._updateRatio(s,e)),s=this._respectSize(s,e),this._updateCache(s),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges())),!1},_mouseStop:function(e){this.resizing=!1;var a,r,h,l=this.options,c=this;return this._helper&&(h=(a=(r=this._proportionallyResizeElements).length&&/textarea/i.test(r[0].nodeName))&&this._hasScroll(r[0],"left")?0:c.sizeDiff.height,r=a?0:c.sizeDiff.width,a={width:c.helper.width()-r,height:c.helper.height()-h},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(n){var e,s,i=this.options,o={minWidth:this._isNumber(i.minWidth)?i.minWidth:0,maxWidth:this._isNumber(i.maxWidth)?i.maxWidth:1/0,minHeight:this._isNumber(i.minHeight)?i.minHeight:0,maxHeight:this._isNumber(i.maxHeight)?i.maxHeight:1/0};(this._aspectRatio||n)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,c=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(c),c=/nw|ne|n/.test(c);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];e<4;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize;return{left:this.originalPosition.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize;return{top:this.originalPosition.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,h=n.length&&/textarea/i.test(n[0].nodeName),c=h&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,l=h?0:i.sizeDiff.width,h={width:i.size.width-l,height:i.size.height-c},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,h=t(this).resizable("instance"),s=h.options,r=h.element,a=s.containment,d=a instanceof t?a.get(0):/parent/.test(a)?r.parent().get(0):a;d&&(h.containerElement=t(d),/document/.test(a)||a===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,r=h.containerSize.height,a=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:a,r=h._hasScroll(d)?d.scrollHeight:r,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(p){var a=t(this).resizable("instance"),n=a.options,s=a.containerOffset,i=a.position,c=a._aspectRatio||p.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=s),i.left<(a._helper?s.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-s.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=n.helper?s.left:0),i.top<(a._helper?s.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-s.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?s.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),i=/relative|absolute/.test(a.containerElement.css("position")),n&&i?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-s.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-s.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,l=t(e.helper),r=l.offset(),h=l.outerWidth()-e.sizeDiff.width,l=l.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var i=t(this).resizable("instance").options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&0<=i&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),!1!==t.uiBackCompat&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,v=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((v.width-o.width)/l)*l,d=Math.round((v.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((f-c<=0||p-l<=0)&&(e=i._getPaddingPlusBorderDimensions(this)),0<f-c?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),0<p-l?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;i<0&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,o=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,o);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;(t=!(t=!(t=!(t=!(t=t||this.element.find("[autofocus]")).length?this.element.find(":tabbable"):t).length?this.uiDialogButtonPane.find(":tabbable"):t).length?this.uiDialogTitlebarClose.filter(":tabbable"):t).length?this.uiDialog:t).eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===e||t.contains(this.uiDialog[0],e)||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);var i,s,n;e.keyCode!==t.ui.keyCode.TAB||e.isDefaultPrevented()||(i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last"),e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault()))},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(i,function(o,s){var n;s=t.isFunction(s)?{click:s,text:o}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(0<=a?"+":"")+a+" top"+(0<=r?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,a=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof a?a:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var h=i.uiDialog.offset(),r=h.left-i.document.scrollLeft(),h=h.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(0<=r?"+":"")+r+" top"+(0<=h?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||this.document.data("ui-dialog-instances",t=[]),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&((n=o.is(":data(ui-draggable)"))&&!i&&o.draggable("destroy"),!n&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((n=o.is(":data(ui-resizable)"))&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||!1===i||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){var e;this.options.modal&&(e=!0,this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1))},_destroyOverlay:function(){var t;this.options.modal&&this.overlay&&((t=this.document.data("ui-dialog-overlays")-1)?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null)}}),!1!==t.uiBackCompat&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e=e||{width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){var s;"accept"===e?this.accept=t.isFunction(i)?i:function(t){return t.is(i)}:"scope"===e&&(s=t.ui.ddmanager.droppables[this.options.scope],this._splice(s),this._addToManager(i)),this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return!(!s||(s.currentItem||s.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?!(n=!0):void 0}),!n&&(!!this.accept.call(this.element[0],s.currentItem||s.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element)))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return e<=t&&t<e+i}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return l<=o&&r<=u&&c<=a&&h<=d;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(c<=a&&a<=d||c<=h&&h<=d||a<c&&d<h)&&(l<=o&&o<=u||l<=r&&r<=u||o<l&&u<r);default:return!1}}}();!(t.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){var s,n,o,r;this.options.disabled||this.greedyChild||!this.visible||(r=!(o=v(e,this,this.options.tolerance,i))&&this.isover?"isout":o&&!this.isover?"isover":null)&&(this.options.greedy&&(n=this.options.scope,(o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n})).length&&((s=t(o[0]).droppable("instance")).greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}})!==t.uiBackCompat&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=!1===t,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),n=i.offset(),n={left:n.left-e.elementPos.left,top:n.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,(n.selected=s)?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return r<o&&(i=r,r=o,o=i),h<a&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),!1!==this.options.width&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,s){s=s.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t=this.element.find("option");this.menu.empty(),this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,t.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),s+=":not(.ui-state-disabled)"),(s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](s).eq(-1):i[t+"All"](s).eq(0)).length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?((t=window.getSelection()).removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection()).rangeCount&&(this.range=t.getRangeAt(0)):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(e){e=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){var i;"icons"===t&&(i=this.button.find("span.ui-icon"),this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)),this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e=!(e=!(e=e&&(e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)))||!e[0]?this.element.closest(".ui-front, dialog"):e).length?this.document[0].body:e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return!1===t?void this.button.css("width",""):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),void this.button.outerWidth(t))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,s=this.options,n=this.element.find(".ui-slider-handle"),a=[],i=s.values&&s.values.length||1;for(n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;e<i;e++)a.push("<span tabindex='0'></span>");this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(!0===e.range&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),"min"!==e.range&&"max"!==e.range||this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var s,n,o,a,h,l,c=this,u=this.options;return!u.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),l={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(l),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(i<n||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),!1!==this._start(e,a)&&(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var i={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(i);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(s){var o,s="horizontal"===this.orientation?(o=this.elementSize.width,s.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(o=this.elementSize.height,s.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=s/o;return(s=1<s?1:s)<0&&(s=0),"vertical"===this.orientation&&(s=1-s),o=this._valueMax()-this._valueMin(),o=this._valueMin()+s*o,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&!0===this.options.range&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i===o||!1!==this._trigger("slide",t,this._uiHash(e,i,a))&&(this._hasMultipleValues()?this.values(e,i):this.value(i))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var s,n,o;if(1<arguments.length)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(e))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=e,o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;0<=s;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(s){if(this._valueMin()>=s)return this._valueMin();if(s>=this._valueMax())return this._valueMax();var e=0<this.options.step?this.options.step:1,i=(s-this._valueMin())%e,s=s-i;return 2*Math.abs(i)>=e&&(s+=0<i?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step;(t=Math.round((t-e)/i)*i+e)>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return t=null!==this.options.min?Math.max(t,this._precisionOf(this.options.min)):t},_precisionOf:function(i){var e=""+i,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=!this._animateOff&&r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=(h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())*100,c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),!0===h.options.range&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?(s-n)/(o-n)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),!1===this._start(e,a)))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return e<=t&&t<e+i},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;0<=t;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),!!(s=t.data(e.target,o.widgetName+"-item")===o?t(e.target):s)&&(!(this.options.handle&&!i&&(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),!n))&&(this.currentItem=s,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,s){var n,o,a=this.options;if((this.currentContainer=this).refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;0<=n;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),!1!==r&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;0<=i;i--)if(n=(s=this.items[i]).item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){var s,n,o,a;if(e)return t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert?(n=(s=this).placeholder.offset(),a={},(o=this.options.axis)&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})):this._clear(e,i),!1},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,u=this.offset.click.top,d=this.offset.click.left,u="x"===this.options.axis||r<s+u&&s+u<h,d="y"===this.options.axis||o<e+d&&e+d<a;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?u&&d:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(i){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,i.top,i.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,i.left,i.width);return!!(e&&i)&&(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(n){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,n.top+n.height/2,n.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,n.left+n.width/2,n.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!=t&&(0<t?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!=t&&(0<t?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;0<=s;s--)for(n=(o=t(l[s],this.document[0])).length-1;0<=n;n--)(a=t.data(o[n],this.widgetFullName))&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;0<=s;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;0<=i;i--)for(s=(n=t(d[i],this.document[0])).length-1;0<=s;s--)(o=t.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;0<=i;i--)for(a=u[i][1],l=(r=u[i][s=0]).length;s<l;s++)(h=t(r[s])).data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var i,s,n,o;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;0<=i;i--)(s=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;0<=i;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){var i,s=(e=e||this).options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){i&&!s.forcePlaceholderSize||(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){for(var s,n,o,a,r,h,l,c,u,d=null,p=null,i=this.containers.length-1;0<=i;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,a=(c=d.floating||this._isFloating(this.currentItem))?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;0<=s;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));(o||this.options.dropOnEmpty)&&(this.currentContainer!==this.containers[p]?(o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1):this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1))}},_createHelper:function(s){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[s,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),s[0].style.width&&!i.forceHelperSize||s.width(this.currentItem.width()),s[0].style.height&&!i.forceHelperSize||s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=t.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s=this.options;"parent"===s.containment&&(s.containment=this.helper[0].parentNode),"document"!==s.containment&&"window"!==s.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===s.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===s.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(s.containment)||(e=t(s.containment)[0],i=t(s.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(o,i){i=i||this.position;var s="absolute"===o?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(s){var n=this.options,o=s.pageX,a=s.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(s.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),s.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),s.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),s.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(s=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=!this.containment||s-this.offset.click.top>=this.containment[1]&&s-this.offset.click.top<=this.containment[3]?s:s-this.offset.click.top>=this.containment[1]?s-n.grid[1]:s+n.grid[1],s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=!this.containment||s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0])),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)"auto"!==this._storedCSS[s]&&"static"!==this._storedCSS[s]||(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;0<=s;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((0<e?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){this.element[0]===t.ui.safeActiveElement(this.document[0])||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val();e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(e)&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?!1!==this._start(e)&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&0<this.uiSpinner.height()&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return!(!this.spinning&&!1===this._trigger("start",t))&&(this.counter||(this.counter=1),this.spinning=!0)},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",e,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return t=null!==this.options.min?Math.max(t,this._precisionOf(this.options.min)):t},_precisionOf:function(i){var e=""+i,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var s=this.options,e=null!==s.min?s.min:0,i=t-e;return t=e+Math.round(i/s.step)*s.step,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var n;return"culture"===t||"numberFormat"===t?(n=this._parse(this.element.val()),this.options[t]=e,void this.element.val(this._format(n))):("max"!==t&&"min"!==t&&"step"!==t||"string"!=typeof e||(e=this._parse(e)),"icons"===t&&(n=this.buttons.first().find(".ui-icon"),this._removeClass(n,null,this.options.icons.up),this._addClass(n,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),void this._super(t,e))},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return""===(t="string"==typeof t&&""!==t?window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t:t)||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null!==t&&t===this._adjustValue(t)},_value:function(t,e){var i;""===t||null!==(i=this._parse(t))&&(e||(i=this._adjustValue(i)),t=this._format(i)),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void r(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),!1!==t.uiBackCompat&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return 1<e.hash.length&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null!==(e=null===e?this.tabs.index(this.tabs.filter(".ui-tabs-active")):e)&&-1!==e||(e=!!this.tabs.length&&0)),!1!==e&&(-1===(e=this.tabs.index(this.tabs.eq(e)))&&(e=!i&&0)),e=!i&&!1===e&&this.anchors.length?0:e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(s);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(s!==this.options.active&&s);default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){for(var n=this.tabs.length-1;-1!==t.inArray(e=(e=n<e?0:e)<0?n:e,this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?void this._activate(e):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||!1!==this.options.active||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),!1!==e.active&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(a=(n=s.hash).substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,(o=e.element.find(n="#"+a)).length||(o=e._createPanel(a)).insertAfter(e.panels[i-1]||e.tablist),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;i=this.tabs[n];n++)i=t(i),!0===e||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===e)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,c=this.active,o=t(e.currentTarget).closest("li"),a=o[0]===c[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=c.length?this._getPanelForTab(c):t(),c={oldTab:c,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||!1===this._trigger("beforeActivate",e,c)||(i.active=!r&&this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(i){var i=this._findActive(i);i[0]!==this.active[0]&&(i=(i=!i.length?this.active:i).find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return!1===e?t():this.tabs.eq(e)},_getIndex:function(e){return e="string"==typeof e?this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']")):e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;!1!==i&&(i=void 0!==e&&(e=this._getIndex(e),t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(!0!==i){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(o,i){o=this._getIndex(o);function h(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr}var s=this,n=this.tabs.eq(o),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(i){i=t(i).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),!1!==t.uiBackCompat&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var n=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(n,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),(s=t.trim(s.join(" ")))?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&((e=t.Event("blur")).target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i=this.options.content,n=this,o=e?e.type:null;return"string"==typeof i||i.nodeType||i.jquery?this._open(e,t,i):void((i=i.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}))&&this._open(e,t,i))},_open:function(e,i,h){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,l=t.extend({},this.options.position);h&&((o=this._find(i))?o.tooltip.find(".ui-tooltip-content").html(h):(i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(h),this.liveRegion.children().hide(),(h=t("<div>").html(a.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})))},_registerCloseHandlers:function(e,i){var s={keyup:function(s){s.keyCode===t.ui.keyCode.ESCAPE&&((s=t.Event(s)).currentTarget=i[0],this.close(s,!0))}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,void(o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)))):void n.removeData("ui-tooltip-open")},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(e){e=e.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(e){e=e.closest(".ui-front, dialog");return e=!e.length?this.document[0].body:e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,o){var n=t.Event("blur"),o=o.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==t.uiBackCompat&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip}),function($){"use strict";function Modal(element,options){this.options=options,this.$body=$(document.body),this.$element=$(element),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.fixedContent=".navbar-fixed-top, .navbar-fixed-bottom",this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,$.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))}function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this),data=$this.data("bs.modal"),options=$.extend({},Modal.DEFAULTS,$this.data(),"object"==typeof option&&option);data||$this.data("bs.modal",data=new Modal(this,options)),"string"==typeof option?data[option](_relatedTarget):options.show&&data.show(_relatedTarget)})}Modal.VERSION="3.4.1",Modal.TRANSITION_DURATION=300,Modal.BACKDROP_TRANSITION_DURATION=150,Modal.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)},Modal.prototype.show=function(_relatedTarget){var that=this,e=$.Event("show.bs.modal",{relatedTarget:_relatedTarget});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){that.$element.one("mouseup.dismiss.bs.modal",function(e){$(e.target).is(that.$element)&&(that.ignoreBackdropClick=!0)})}),this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");that.$element.parent().length||that.$element.appendTo(that.$body),that.$element.show().scrollTop(0),that.adjustDialog(),transition&&that.$element[0].offsetWidth,that.$element.addClass("in"),that.enforceFocus();var e=$.Event("shown.bs.modal",{relatedTarget:_relatedTarget});transition?that.$dialog.one("bsTransitionEnd",function(){that.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger("focus").trigger(e)}))},Modal.prototype.hide=function(e){e&&e.preventDefault(),e=$.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),$(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),$.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal())},Modal.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){document===e.target||this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},Modal.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",$.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},Modal.prototype.resize=function(){this.isShown?$(window).on("resize.bs.modal",$.proxy(this.handleUpdate,this)):$(window).off("resize.bs.modal")},Modal.prototype.hideModal=function(){var that=this;this.$element.hide(),this.backdrop(function(){that.$body.removeClass("modal-open"),that.resetAdjustments(),that.resetScrollbar(),that.$element.trigger("hidden.bs.modal")})},Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},Modal.prototype.backdrop=function(callback){var callbackRemove,that=this,animate=this.$element.hasClass("fade")?"fade":"";this.isShown&&this.options.backdrop?(callbackRemove=$.support.transition&&animate,this.$backdrop=$(document.createElement("div")).addClass("modal-backdrop "+animate).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",$.proxy(function(e){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),callbackRemove&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),callback&&(callbackRemove?this.$backdrop.one("bsTransitionEnd",callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback())):!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),callbackRemove=function(){that.removeBackdrop(),callback&&callback()},$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()):callback&&callback()},Modal.prototype.handleUpdate=function(){this.adjustDialog()},Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:""})},Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},Modal.prototype.checkScrollbar=function(){var documentElementRect,fullWindowWidth=window.innerWidth;fullWindowWidth||(fullWindowWidth=(documentElementRect=document.documentElement.getBoundingClientRect()).right-Math.abs(documentElementRect.left)),this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth,this.scrollbarWidth=this.measureScrollbar()},Modal.prototype.setScrollbar=function(){var bodyPad=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";var scrollbarWidth=this.scrollbarWidth;this.bodyIsOverflowing&&(this.$body.css("padding-right",bodyPad+scrollbarWidth),$(this.fixedContent).each(function(index,element){var actualPadding=element.style.paddingRight,calculatedPadding=$(element).css("padding-right");$(element).data("padding-right",actualPadding).css("padding-right",parseFloat(calculatedPadding)+scrollbarWidth+"px")}))},Modal.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad),$(this.fixedContent).each(function(index,element){var padding=$(element).data("padding-right");$(element).removeData("padding-right"),element.style.paddingRight=padding||""})},Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure",this.$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;return this.$body[0].removeChild(scrollDiv),scrollbarWidth};var old=$.fn.modal;$.fn.modal=Plugin,$.fn.modal.Constructor=Modal,$.fn.modal.noConflict=function(){return $.fn.modal=old,this},$(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),option=$this.attr("href"),target=$this.attr("data-target")||option&&option.replace(/.*(?=#[^\s]+$)/,""),$target=$(document).find(target),option=$target.data("bs.modal")?"toggle":$.extend({remote:!/#/.test(option)&&option},$target.data(),$this.data());$this.is("a")&&e.preventDefault(),$target.one("show.bs.modal",function(showEvent){showEvent.isDefaultPrevented()||$target.one("hidden.bs.modal",function(){$this.is(":visible")&&$this.trigger("focus")})}),Plugin.call($target,option,this)})}(jQuery),function($){"use strict";$.fn.emulateTransitionEnd=function(duration){var called=!1,$el=this;$(this).one("bsTransitionEnd",function(){called=!0});return setTimeout(function(){called||$($el).trigger($.support.transition.end)},duration),this},$(function(){$.support.transition=function(){var name,el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(name in transEndEventNames)if(void 0!==el.style[name])return{end:transEndEventNames[name]};return!1}(),$.support.transition&&($.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):root.bootbox=factory(root.jQuery)}(this,function init($,undefined){"use strict";var templates={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},defaults={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body"},exports={};function processCallback(e,dialog,callback){e.stopPropagation(),e.preventDefault(),$.isFunction(callback)&&!1===callback.call(dialog,e)||dialog.modal("hide")}function each(collection,iterator){var index=0;$.each(collection,function(key,value){iterator(key,value,index++)})}function sanitize(options){var buttons,total;if("object"!=typeof options)throw new Error("Please supply an object of options");if(!options.message)throw new Error("Please specify a message");return(options=$.extend({},defaults,options)).buttons||(options.buttons={}),buttons=options.buttons,total=function(obj){var k,t=0;for(k in obj)t++;return t}(buttons),each(buttons,function(key,button,index){if($.isFunction(button)&&(button=buttons[key]={callback:button}),"object"!==$.type(button))throw new Error("button with key "+key+" must be an object");button.label||(button.label=key),button.className||(button.className=total<=2&&index===total-1?"btn-primary":"btn-default")}),options}function mergeArguments(defaults,args,properties){return $.extend(!0,{},defaults,function(args,properties){var argn=args.length,options={};if(argn<1||2<argn)throw new Error("Invalid argument length");return 2===argn||"string"==typeof args[0]?(options[properties[0]]=args[0],options[properties[1]]=args[1]):options=args[0],options}(args,properties))}function mergeDialogOptions(className,labels,properties,args){return validateButtons(mergeArguments({className:"bootbox-"+className,buttons:createLabels.apply(null,labels)},args,properties),labels)}function createLabels(){for(var buttons={},i=0,j=arguments.length;i<j;i++){var value=arguments[i],key=value.toLowerCase(),value=value.toUpperCase();buttons[key]={label:function(key){var locale=locales[defaults.locale];return(locale||locales.en)[key]}(value)}}return buttons}function validateButtons(options,buttons){var allowedButtons={};return each(buttons,function(key,value){allowedButtons[value]=!0}),each(options.buttons,function(key){if(allowedButtons[key]===undefined)throw new Error("button key "+key+" is not allowed (options are "+buttons.join("\n")+")")}),options}exports.alert=function(){var options=mergeDialogOptions("alert",["ok"],["message","callback"],arguments);if(options.callback&&!$.isFunction(options.callback))throw new Error("alert requires callback property to be a function when provided");return options.buttons.ok.callback=options.onEscape=function(){return!$.isFunction(options.callback)||options.callback.call(this)},exports.dialog(options)},exports.confirm=function(){var options=mergeDialogOptions("confirm",["cancel","confirm"],["message","callback"],arguments);if(options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,!1)},options.buttons.confirm.callback=function(){return options.callback.call(this,!0)},!$.isFunction(options.callback))throw new Error("confirm requires a callback");return exports.dialog(options)},exports.prompt=function(){var dialog,input,form=$(templates.form),options=validateButtons(mergeArguments({className:"bootbox-prompt",buttons:createLabels("cancel","confirm"),value:"",inputType:"text"},arguments,["title","callback"]),["cancel","confirm"]),shouldShow=options.show===undefined||options.show;if(options.message=form,options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,null)},options.buttons.confirm.callback=function(){switch(options.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":value=input.val();break;case"checkbox":var checkedItems=input.find("input:checked"),value=[];each(checkedItems,function(_,item){value.push($(item).val())})}return options.callback.call(this,value)},options.show=!1,!options.title)throw new Error("prompt requires a title");if(!$.isFunction(options.callback))throw new Error("prompt requires a callback");if(!templates.inputs[options.inputType])throw new Error("invalid prompt type");switch(input=$(templates.inputs[options.inputType]),options.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":input.val(options.value);break;case"select":var groups={},inputOptions=options.inputOptions||[];if(!$.isArray(inputOptions))throw new Error("Please pass an array of input options");if(!inputOptions.length)throw new Error("prompt with select requires options");each(inputOptions,function(_,option){var elem=input;if(option.value===undefined||option.text===undefined)throw new Error("given options in wrong format");option.group&&(groups[option.group]||(groups[option.group]=$("<optgroup/>").attr("label",option.group)),elem=groups[option.group]),elem.append("<option value='"+option.value+"'>"+option.text+"</option>")}),each(groups,function(_,group){input.append(group)}),input.val(options.value);break;case"checkbox":var values=$.isArray(options.value)?options.value:[options.value];if(!(inputOptions=options.inputOptions||[]).length)throw new Error("prompt with checkbox requires options");if(!inputOptions[0].value||!inputOptions[0].text)throw new Error("given options in wrong format");input=$("<div/>"),each(inputOptions,function(_,option){var checkbox=$(templates.inputs[options.inputType]);checkbox.find("input").attr("value",option.value),checkbox.find("label").append(option.text),each(values,function(_,value){value===option.value&&checkbox.find("input").prop("checked",!0)}),input.append(checkbox)})}return options.placeholder&&input.attr("placeholder",options.placeholder),options.pattern&&input.attr("pattern",options.pattern),options.maxlength&&input.attr("maxlength",options.maxlength),form.append(input),form.on("submit",function(e){e.preventDefault(),e.stopPropagation(),dialog.find(".btn-primary").click()}),(dialog=exports.dialog(options)).off("shown.bs.modal"),dialog.on("shown.bs.modal",function(){input.focus()}),!0===shouldShow&&dialog.modal("show"),dialog},exports.dialog=function(options){options=sanitize(options);var dialog=$(templates.dialog),closeButton=dialog.find(".modal-dialog"),body=dialog.find(".modal-body"),buttons=options.buttons,buttonStr="",callbacks={onEscape:options.onEscape};if($.fn.modal===undefined)throw new Error("$.fn.modal is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.");return each(buttons,function(key,button){buttonStr+="<button data-bb-handler='"+key+"' type='button' class='btn "+button.className+"'>"+button.label+"</button>",callbacks[key]=button.callback}),body.find(".bootbox-body").html(options.message),!0===options.animate&&dialog.addClass("fade"),options.className&&dialog.addClass(options.className),"large"===options.size?closeButton.addClass("modal-lg"):"small"===options.size&&closeButton.addClass("modal-sm"),options.title&&body.before(templates.header),options.closeButton&&(closeButton=$(templates.closeButton),options.title?dialog.find(".modal-header").prepend(closeButton):closeButton.css("margin-top","-10px").prependTo(body)),options.title&&dialog.find(".modal-title").html(options.title),buttonStr.length&&(body.after(templates.footer),dialog.find(".modal-footer").html(buttonStr)),dialog.on("hidden.bs.modal",function(e){e.target===this&&dialog.remove()}),dialog.on("shown.bs.modal",function(){dialog.find(".btn-primary:first").focus()}),"static"!==options.backdrop&&dialog.on("click.dismiss.bs.modal",function(e){dialog.children(".modal-backdrop").length&&(e.currentTarget=dialog.children(".modal-backdrop").get(0)),e.target===e.currentTarget&&dialog.trigger("escape.close.bb")}),dialog.on("escape.close.bb",function(e){callbacks.onEscape&&processCallback(e,dialog,callbacks.onEscape)}),dialog.on("click",".modal-footer button",function(e){var callbackKey=$(this).data("bb-handler");processCallback(e,dialog,callbacks[callbackKey])}),dialog.on("click",".bootbox-close-button",function(e){processCallback(e,dialog,callbacks.onEscape)}),dialog.on("keyup",function(e){27===e.which&&dialog.trigger("escape.close.bb")}),$(options.container).append(dialog),dialog.modal({backdrop:!!options.backdrop&&"static",keyboard:!1,show:!1}),options.show&&dialog.modal("show"),dialog},exports.setDefaults=function(){var values={};2===arguments.length?values[arguments[0]]=arguments[1]:values=arguments[0],$.extend(defaults,values)},exports.hideAll=function(){return $(".bootbox").modal("hide"),exports};var locales={bg_BG:{OK:"ÐÐº",CANCEL:"ÐÑÐºÐ°Ð·",CONFIRM:"ÐÐ¾ÑÐ²ÑÑÐ¶Ð´Ð°Ð²Ð°Ð¼"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"ZruÅ¡it",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"ÎÎ½ÏÎ¬Î¾ÎµÎ¹",CANCEL:"ÎÎºÏÏÏÏÎ·",CONFIRM:"ÎÏÎ¹Î²ÎµÎ²Î±Î¯ÏÏÎ·"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fa:{OK:"ÙØ¨ÙÙ",CANCEL:"ÙØºÙ",CONFIRM:"ØªØ§ÛÛØ¯"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"×××©××¨",CANCEL:"×××××",CONFIRM:"×××©××¨"},hu:{OK:"OK",CANCEL:"MÃ©gsem",CONFIRM:"MegerÅsÃ­t"},hr:{OK:"OK",CANCEL:"Odustani",CONFIRM:"Potvrdi"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"ã­ã£ã³ã»ã«",CONFIRM:"ç¢ºèª"},lt:{OK:"Gerai",CANCEL:"AtÅ¡aukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"ApstiprinÄt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"PotwierdÅº"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"ÐÑÐ¼ÐµÐ½Ð°",CONFIRM:"ÐÑÐ¸Ð¼ÐµÐ½Ð¸ÑÑ"},sq:{OK:"OK",CANCEL:"Anulo",CONFIRM:"Prano"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},th:{OK:"à¸à¸à¸¥à¸",CANCEL:"à¸¢à¸à¹à¸¥à¸´à¸",CONFIRM:"à¸¢à¸·à¸à¸¢à¸±à¸"},tr:{OK:"Tamam",CANCEL:"Ä°ptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"åæ¶",CONFIRM:"ç¡®è®¤"},zh_TW:{OK:"OK",CANCEL:"åæ¶",CONFIRM:"ç¢ºèª"}};return exports.addLocale=function(name,values){return $.each(["OK","CANCEL","CONFIRM"],function(_,v){if(!values[v])throw new Error("Please supply a translation for '"+v+"'")}),locales[name]={OK:values.OK,CANCEL:values.CANCEL,CONFIRM:values.CONFIRM},exports},exports.removeLocale=function(name){return delete locales[name],exports},exports.setLocale=function(name){return exports.setDefaults("locale",name)},exports.init=function(_$){return init(_$||$)},exports}),function(){"use strict";(typeof define==="function"&&define.amd?define:function(a,b){if(typeof module!=="undefined"&&module.exports)module.exports=b(require("jquery"));else b(jQuery)})(["jquery"],function($){var j=$.scrollTo=function(a,b,c){return $(window).scrollTo(a,b,c)};function both(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}return j.defaults={axis:"xy",duration:0,limit:!0},j.window=function(a){return $(window)._scrollable()},$.fn._scrollable=function(){return this.map(function(){var b=this;if(!(!b.nodeName||-1!=$.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"])))return b;b=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||"BackCompat"==b.compatMode?b.body:b.documentElement})},$.fn.scrollTo=function(f,g,h){return"object"==typeof g&&(h=g,g=0),"function"==typeof h&&(h={onAfter:h}),"max"==f&&(f=9e9),h=$.extend({},j.defaults,h),g=g||h.duration,h.queue=h.queue&&1<h.axis.length,h.queue&&(g/=2),h.offset=both(h.offset),h.over=both(h.over),this._scrollable().each(function(){if(null!=f){var toff,d=this,$elem=$(d),targ=f,attr={},win=$elem.is("html,body");switch(typeof targ){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}if(!(targ=win?$(targ):$(targ,this)).length)return;case"object":(targ.is||targ.style)&&(toff=(targ=$(targ)).offset())}var e=$.isFunction(h.offset)&&h.offset(d,targ)||h.offset;$.each(h.axis.split(""),function(i,a){var b="x"==a?"Left":"Top",c=b.toLowerCase(),key="scroll"+b,old=d[key],max=j.max(d,a);toff?(attr[key]=toff[c]+(win?0:old-$elem.offset()[c]),h.margin&&(attr[key]-=parseInt(targ.css("margin"+b))||0,attr[key]-=parseInt(targ.css("border"+b+"Width"))||0),attr[key]+=e[c]||0,h.over[c]&&(attr[key]+=targ["x"==a?"width":"height"]()*h.over[c])):(c=targ[c],attr[key]=c.slice&&"%"==c.slice(-1)?parseFloat(c)/100*max:c),h.limit&&/^\d+$/.test(attr[key])&&(attr[key]=attr[key]<=0?0:Math.min(attr[key],max)),!i&&h.queue&&(old!=attr[key]&&animate(h.onAfterFirst),delete attr[key])}),animate(h.onAfter)}function animate(a){$elem.animate(attr,g,h.easing,a&&function(){a.call(this,targ,h)})}}).end()},j.max=function(body,d){var html="x"==d?"Width":"Height",scroll="scroll"+html;if(!$(body).is("html,body"))return body[scroll]-$(body)[html.toLowerCase()]();d="client"+html,html=body.ownerDocument.documentElement,body=body.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])},j})}(),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a,b){"use strict";if(!a.jstree){var c=0,d=!1,e=!1,f=!1,g=[],q=a("script:last").attr("src"),i=window.document,j=window.setImmediate,k=window.Promise;!j&&k&&(j=function(a,b){k.resolve(b).then(a)}),a.jstree={version:"3.3.12",defaults:{plugins:[]},plugins:{},path:q&&-1!==q.indexOf("/")?q.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},a.jstree.create=function(b,d){var e=new a.jstree.core(++c),f=d;return d=a.extend(!0,{},a.jstree.defaults,d),f&&f.plugins&&(d.plugins=f.plugins),a.each(d.plugins,function(a,b){"core"!==a&&(e=e.plugin(b,d[b]))}),a(b).data("jstree",e),e.init(b,d),e},a.jstree.destroy=function(){a(".jstree:jstree").jstree("destroy"),a(i).off(".jstree")},a.jstree.core=function(a){this._id=a,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},a.jstree.reference=function(b){var c=null,d=null;if(!b||!b.id||b.tagName&&b.nodeType||(b=b.id),!d||!d.length)try{d=a(b)}catch(e){}if(!d||!d.length)try{d=a("#"+b.replace(a.jstree.idregex,"\\$&"))}catch(e){}return d&&d.length&&(d=d.closest(".jstree")).length&&(d=d.data("jstree"))?c=d:a(".jstree").each(function(){var d=a(this).data("jstree");return d&&d._model.data[b]?(c=d,!1):void 0}),c},a.fn.jstree=function(c){var d="string"==typeof c,e=Array.prototype.slice.call(arguments,1),f=null;return!(!0===c&&!this.length)&&(this.each(function(){var g=a.jstree.reference(this),h=d&&g?g[c]:null;return f=d&&h?h.apply(g,e):null,g||d||c!==b&&!a.isPlainObject(c)||a.jstree.create(this,c),(null===(f=g&&!d||!0===c?g||!1:f)||f===b)&&void 0}),null!==f&&f!==b?f:this)},a.expr.pseudos.jstree=a.expr.createPseudo(function(c){return function(c){return a(c).hasClass("jstree")&&a(c).data("jstree")!==b}}),a.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:a.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{"ctrl-space":function(b){b.type="click",a(b.currentTarget).trigger(b)},enter:function(b){b.type="click",a(b.currentTarget).trigger(b)},left:function(c){c.preventDefault(),this.is_open(c.currentTarget)?this.close_node(c.currentTarget):(c=this.get_parent(c.currentTarget))&&c.id!==a.jstree.root&&this.get_node(c,!0).children(".jstree-anchor").trigger("focus")},up:function(b){b.preventDefault();b=this.get_prev_dom(b.currentTarget);b&&b.length&&b.children(".jstree-anchor").trigger("focus")},right:function(c){c.preventDefault(),this.is_closed(c.currentTarget)?this.open_node(c.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").trigger("focus")}):!this.is_open(c.currentTarget)||(c=this.get_node(c.currentTarget,!0).children(".jstree-children")[0])&&a(this._firstChild(c)).children(".jstree-anchor").trigger("focus")},down:function(b){b.preventDefault();b=this.get_next_dom(b.currentTarget);b&&b.length&&b.children(".jstree-anchor").trigger("focus")},"*":function(a){this.open_all()},home:function(c){c.preventDefault();c=this._firstChild(this.get_container_ul()[0]);c&&a(c).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(a){a.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(a){a.preventDefault(),this.edit(a.currentTarget)}}},a.jstree.core.prototype={plugin:function(b,c){var d=a.jstree.plugins[b];return d?(this._data[b]={},d.prototype=this,new d(c,this)):this},init:function(b,c){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=a(b).addClass("jstree jstree-"+this._id),this.settings=c,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node(a.jstree.root)},destroy:function(a){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty(),this.teardown()},_create_prototype_node:function(){var b,c,a=i.createElement("LI");return a.setAttribute("role","none"),(b=i.createElement("I")).className="jstree-icon jstree-ocl",b.setAttribute("role","presentation"),a.appendChild(b),(b=i.createElement("A")).className="jstree-anchor",b.setAttribute("href","#"),b.setAttribute("tabindex","-1"),b.setAttribute("role","treeitem"),(c=i.createElement("I")).className="jstree-icon jstree-themeicon",c.setAttribute("role","presentation"),b.appendChild(c),a.appendChild(b),b=c=null,a},_kbevent_to_func:function(a){var c=[];if(a.ctrlKey&&c.push("ctrl"),a.altKey&&c.push("alt"),a.shiftKey&&c.push("shift"),c.push({8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"}[a.which]||a.which),"shift-shift"===(c=c.sort().join("-").toLowerCase())||"ctrl-ctrl"===c||"alt-alt"===c)return null;var e,f,d=this.settings.core.keyboard;for(e in d)if(d.hasOwnProperty(e)&&(f=e,"-"!==f&&"+"!==f&&(f=f.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS"),f=f.split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase()),f===c))return d[e];return null},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var b="",c=null,d=0;this.element.on("dblclick.jstree",function(b){if(b.target.tagName&&"input"===b.target.tagName.toLowerCase())return!0;if(i.selection&&i.selection.empty)i.selection.empty();else if(window.getSelection){b=window.getSelection();try{b.removeAllRanges(),b.collapse()}catch(c){}}}).on("mousedown.jstree",function(a){a.target===this.element[0]&&(a.preventDefault(),d=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",function(a){this.toggle_node(a.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(a){return!(!a.target.tagName||"input"!==a.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(a.target))}.bind(this)).on("click.jstree",".jstree-anchor",function(b){b.preventDefault(),b.currentTarget!==i.activeElement&&a(b.currentTarget).trigger("focus"),this.activate_node(b.currentTarget,b)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(c){if(c.target.tagName&&"input"===c.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===c.which?c.which=39:39===c.which&&(c.which=37));var b=this._kbevent_to_func(c);if(b){c=b.call(this,c);if(!1===c||!0===c)return c}}.bind(this)).on("load_node.jstree",function(b,c){c.status&&(c.node.id!==a.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var b=[],c=0,d=this._data.core.selected.length;c<d;c++)b=b.concat(this._model.data[this._data.core.selected[c]].parents);for(c=0,d=(b=a.vakata.array_unique(b)).length;c<d;c++)this.open_node(b[c],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),0))}.bind(this)).on("keypress.jstree",function(g){if(g.target.tagName&&"input"===g.target.tagName.toLowerCase())return!0;c&&clearTimeout(c),c=setTimeout(function(){b=""},500);var e=String.fromCharCode(g.which).toLowerCase(),f=this.element.find(".jstree-anchor").filter(":visible"),g=f.index(i.activeElement)||0,h=!1;if(1<(b+=e).length){if(f.slice(g).each(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).trigger("focus"),!(h=!0)):void 0}.bind(this)),h)return;if(f.slice(0,g).each(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).trigger("focus"),!(h=!0)):void 0}.bind(this)),h)return}new RegExp("^"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(b)&&(f.slice(g+1).each(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).trigger("focus"),!(h=!0)):void 0}.bind(this)),h||f.slice(0,g+1).each(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).trigger("focus"),!(h=!0)):void 0}.bind(this)))}.bind(this)).on("init.jstree",function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots,this._data.core.themes.stripes=a.stripes,this._data.core.themes.icons=a.icons,this._data.core.themes.ellipsis=a.ellipsis,this.set_theme(a.name||"default",a.url),this.set_theme_variant(a.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(b){this._data.core.focused=null,a(b.currentTarget).filter(".jstree-hovered").trigger("mouseleave"),this.element.attr("tabindex","0")}.bind(this)).on("focus.jstree",".jstree-anchor",function(b){var c=this.get_node(b.currentTarget);c&&c.id&&(this._data.core.focused=c.id),this.element.find(".jstree-hovered").not(b.currentTarget).trigger("mouseleave"),a(b.currentTarget).trigger("mouseenter"),this.element.attr("tabindex","-1")}.bind(this)).on("focus.jstree",function(){var a;500<+new Date-d&&!this._data.core.focused&&this.settings.core.restore_focus&&(d=0,(a=this.get_node(this.element.attr("aria-activedescendant"),!0))&&a.find("> .jstree-anchor").trigger("focus"))}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(a){this.hover_node(a.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(a){this.dehover_node(a.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree"),a(i).off(".jstree-"+this._id)},trigger:function(a,b){((b=b||{}).instance=this).element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(b){var c=this.settings.core.strings;return a.vakata.is_function(c)?c.call(this,b):c&&c[b]?c[b]:b},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(b,c){var d;(b=b&&b.id?b.id:b)instanceof a&&b.length&&b[0].id&&(b=b[0].id);try{if(this._model.data[b])b=this._model.data[b];else if("string"==typeof b&&this._model.data[b.replace(/^#/,"")])b=this._model.data[b.replace(/^#/,"")];else if("string"==typeof b&&(d=a("#"+b.replace(a.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[d.closest(".jstree-node").attr("id")])b=this._model.data[d.closest(".jstree-node").attr("id")];else if((d=this.element.find(b)).length&&this._model.data[d.closest(".jstree-node").attr("id")])b=this._model.data[d.closest(".jstree-node").attr("id")];else{if(!(d=this.element.find(b)).length||!d.hasClass("jstree"))return!1;b=this._model.data[a.jstree.root]}return b=c?b.id===a.jstree.root?this.element:a("#"+b.id.replace(a.jstree.idregex,"\\$&"),this.element):b}catch(e){return!1}},get_path:function(b,c,d){if(!(b=b.parents?b:this.get_node(b))||b.id===a.jstree.root||!b.parents)return!1;var e,f,g=[];for(g.push(d?b.id:b.text),e=0,f=b.parents.length;e<f;e++)g.push(d?b.parents[e]:this.get_text(b.parents[e]));return g=g.reverse().slice(1),c?g.join(c):g},get_next_dom:function(b,c){var d;if((b=this.get_node(b,!0))[0]===this.element[0]){for(d=this._firstChild(this.get_container_ul()[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);return!!d&&a(d)}if(!b||!b.length)return!1;if(c){for(d=b[0];(d=this._nextSibling(d))&&0===d.offsetHeight;);return!!d&&a(d)}if(b.hasClass("jstree-open")){for(d=this._firstChild(b.children(".jstree-children")[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);if(null!==d)return a(d)}for(d=b[0];(d=this._nextSibling(d))&&0===d.offsetHeight;);return null!==d?a(d):b.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(b,c){var d;if((b=this.get_node(b,!0))[0]===this.element[0]){for(d=this.get_container_ul()[0].lastChild;d&&0===d.offsetHeight;)d=this._previousSibling(d);return!!d&&a(d)}if(!b||!b.length)return!1;if(c){for(d=b[0];(d=this._previousSibling(d))&&0===d.offsetHeight;);return!!d&&a(d)}for(d=b[0];(d=this._previousSibling(d))&&0===d.offsetHeight;);if(null===d)return!(!(d=b[0].parentNode.parentNode)||!d.className||-1===d.className.indexOf("jstree-node"))&&a(d);for(b=a(d);b.hasClass("jstree-open");)b=b.children(".jstree-children").first().children(".jstree-node:visible:last");return b},get_parent:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.parent},get_children_dom:function(a){return(a=this.get_node(a,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!a||!a.length)&&a.children(".jstree-children").children(".jstree-node")},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(b,c){var d,e,f,g,h;if(a.vakata.is_array(b))return this._load_nodes(b.slice(),c),!0;if(!(b=this.get_node(b)))return c&&c.call(this,b,!1),!1;if(b.state.loaded){for(b.state.loaded=!1,f=0,g=b.parents.length;f<g;f++)this._model.data[b.parents[f]].children_d=a.vakata.array_filter(this._model.data[b.parents[f]].children_d,function(c){return-1===a.inArray(c,b.children_d)});for(d=0,e=b.children_d.length;d<e;d++)this._model.data[b.children_d[d]].state.selected&&(h=!0),delete this._model.data[b.children_d[d]];h&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(c){return-1===a.inArray(c,b.children_d)})),b.children=[],b.children_d=[],h&&this.trigger("changed",{action:"load_node",node:b,selected:this._data.core.selected})}return b.state.failed=!1,b.state.loading=!0,this.get_node(b,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(b,function(a){(b=this._model.data[b.id]).state.loading=!1,b.state.loaded=a,b.state.failed=!b.state.loaded;for(var d=this.get_node(b,!0),e=0,g=this._model.data,h=!1,e=0,f=b.children.length;e<f;e++)if(g[b.children[e]]&&!g[b.children[e]].state.hidden){h=!0;break}b.state.loaded&&d&&d.length&&(d.removeClass("jstree-closed jstree-open jstree-leaf"),h?"#"!==b.id&&d.addClass(b.state.opened?"jstree-open":"jstree-closed"):d.addClass("jstree-leaf")),d.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:b,status:a}),c&&c.call(this,b,a)}.bind(this)),!0},_load_nodes:function(a,b,c,d){for(var e=!0,f=function(){this._load_nodes(a,b,!0)},g=this._model.data,j=[],h=0,i=a.length;h<i;h++)g[a[h]]&&(!g[a[h]].state.loaded&&!g[a[h]].state.failed||!c&&d)&&(this.is_loading(a[h])||this.load_node(a[h],f),e=!1);if(e){for(h=0,i=a.length;h<i;h++)g[a[h]]&&g[a[h]].state.loaded&&j.push(a[h]);b&&!b.done&&(b.call(this,j),b.done=!0)}},load_all:function(b,c){if(b=b||a.jstree.root,!(b=this.get_node(b)))return!1;var g,h,d=[],e=this._model.data,f=e[b.id].children_d;for(b.state&&!b.state.loaded&&d.push(b.id),g=0,h=f.length;g<h;g++)e[f[g]]&&e[f[g]].state&&!e[f[g]].state.loaded&&d.push(f[g]);d.length?this._load_nodes(d,function(){this.load_all(b,c)}):(c&&c.call(this,b),this.trigger("load_all",{node:b}))},_load_node:function(b,c){function f(){return 3!==this.nodeType&&8!==this.nodeType}var e,d=this.settings.core.data;return d?a.vakata.is_function(d)?d.call(this,b,function(d){!1===d?c.call(this,!1):this["string"==typeof d?"_append_html_data":"_append_json_data"](b,"string"==typeof d?a(a.parseHTML(d)).filter(f):d,function(a){c.call(this,a)})}.bind(this)):"object"==typeof d?d.url?(d=a.extend(!0,{},d),a.vakata.is_function(d.url)&&(d.url=d.url.call(this,b)),a.vakata.is_function(d.data)&&(d.data=d.data.call(this,b)),a.ajax(d).done(function(d,e,g){var h=g.getResponseHeader("Content-Type");return h&&-1!==h.indexOf("json")||"object"==typeof d?this._append_json_data(b,d,function(a){c.call(this,a)}):h&&-1!==h.indexOf("html")||"string"==typeof d?this._append_html_data(b,a(a.parseHTML(d)).filter(f),function(a){c.call(this,a)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:b.id,xhr:g})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))}.bind(this)).fail(function(a){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:b.id,xhr:a})},c.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)}.bind(this))):(e=a.vakata.is_array(d)?a.extend(!0,[],d):a.isPlainObject(d)?a.extend(!0,{},d):d,b.id===a.jstree.root?this._append_json_data(b,e,function(a){c.call(this,a)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))):"string"==typeof d?b.id===a.jstree.root?this._append_html_data(b,a(a.parseHTML(d)).filter(f),function(a){c.call(this,a)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1)):c.call(this,!1):b.id===a.jstree.root?this._append_html_data(b,this._data.core.original_container_html.clone(!0),function(a){c.call(this,a)}):c.call(this,!1)},_node_changed:function(b){(b=this.get_node(b))&&-1===a.inArray(b.id,this._model.changed)&&this._model.changed.push(b.id)},_append_html_data:function(k,e,d){(k=this.get_node(k)).children=[],k.children_d=[];var l,m,n,e=e.is("ul")?e.children():e,f=k.id,g=[],h=[],i=this._model.data,j=i[f],k=this._data.core.selected.length;for(e.each(function(b,c){(l=this._parse_model_from_html(a(c),f,j.parents.concat()))&&(g.push(l),h.push(l),i[l].children_d.length&&(h=h.concat(i[l].children_d)))}.bind(this)),j.children=g,j.children_d=h,m=0,n=j.parents.length;m<n;m++)i[j.parents[m]].children_d=i[j.parents[m]].children_d.concat(h);this.trigger("model",{nodes:h,parent:f}),f!==a.jstree.root?(this._node_changed(f),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==k&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),d.call(this,!0)},_append_json_data:function(b,c,d,e){if(null!==this.element){(b=this.get_node(b)).children=[],b.children_d=[],c.d&&("string"==typeof(c=c.d)&&(c=JSON.parse(c))),a.vakata.is_array(c)||(c=[c]);var f=null,g={df:this._model.default_state,dat:c,par:b.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},h=this,i=function(n,b){function s(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var f,h,j,k,e=a.id.toString(),m={id:e,text:a.text||"",icon:a.icon===b||a.icon,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in i)i.hasOwnProperty(f)&&(m.state[f]=i[f]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(m.icon=a.data.jstree.icon),m.icon!==b&&null!==m.icon&&""!==m.icon||(m.icon=!0),a&&a.data&&(m.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(m.state[f]=a.data.jstree[f]);if(a&&"object"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(m.state[f]=a.state[f]);if(a&&"object"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(m.li_attr[f]=a.li_attr[f]);if(m.li_attr.id||(m.li_attr.id=e),a&&"object"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(m.a_attr[f]=a.a_attr[f]);for(a&&a.children&&!0===a.children&&(m.state.loaded=!1,m.children=[],m.children_d=[]),f=0,h=(l[m.id]=m).children.length;f<h;f++)j=s(l[m.children[f]],m.id,d),k=l[j],m.children_d.push(j),k.children_d.length&&(m.children_d=m.children_d.concat(k.children_d));return delete a.data,delete a.children,l[m.id].original=a,m.state.selected&&g.push(m.id),m.id}function t(a,c,d){d=d?d.concat():[],c&&d.unshift(c);for(var f,h,m,n,o,e=!1;e="j"+j+"_"+ ++k,l[e];);for(f in o={id:!1,text:"string"==typeof a?a:"",icon:"object"!=typeof a||a.icon===b||a.icon,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},i)i.hasOwnProperty(f)&&(o.state[f]=i[f]);if(a&&a.id&&(o.id=a.id.toString()),a&&a.text&&(o.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(o.icon=a.data.jstree.icon),o.icon!==b&&null!==o.icon&&""!==o.icon||(o.icon=!0),a&&a.data&&(o.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(o.state[f]=a.data.jstree[f]);if(a&&"object"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(o.state[f]=a.state[f]);if(a&&"object"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(o.li_attr[f]=a.li_attr[f]);if(o.li_attr.id&&!o.id&&(o.id=o.li_attr.id.toString()),o.id||(o.id=e),o.li_attr.id||(o.li_attr.id=o.id),a&&"object"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(o.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,h=a.children.length;f<h;f++)m=t(a.children[f],o.id,d),n=l[m],o.children.push(m),n.children_d.length&&(o.children_d=o.children_d.concat(n.children_d));o.children_d=o.children_d.concat(o.children)}return a&&a.children&&!0===a.children&&(o.state.loaded=!1,o.children=[],o.children_d=[]),delete a.data,delete a.children,o.original=a,(l[o.id]=o).state.selected&&g.push(o.id),o.id}var o,p,q,r,c=(n=n.data?n.data:n).dat,d=n.par,e=[],f=[],g=[],i=n.df,j=n.t_id,k=n.t_cnt,l=n.m,m=l[d],n=n.sel;if(c.length&&c[0].id!==b&&c[0].parent!==b){for(p=0,q=c.length;p<q;p++)c[p].children||(c[p].children=[]),c[p].state||(c[p].state={}),l[c[p].id.toString()]=c[p];for(p=0,q=c.length;p<q;p++)l[c[p].parent.toString()]?(l[c[p].parent.toString()].children.push(c[p].id.toString()),m.children_d.push(c[p].id.toString())):void 0!==h&&(h._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:c[p].id.toString(),parent:c[p].parent.toString()})},h.settings.core.error.call(h,h._data.core.last_error));for(p=0,q=m.children.length;p<q;p++)o=s(l[m.children[p]],d,m.parents.concat()),f.push(o),l[o].children_d.length&&(f=f.concat(l[o].children_d));for(p=0,q=m.parents.length;p<q;p++)l[m.parents[p]].children_d=l[m.parents[p]].children_d.concat(f);r={cnt:k,mod:l,sel:n,par:d,dpc:f,add:g}}else{for(p=0,q=c.length;p<q;p++)(o=t(c[p],d,m.parents.concat()))&&(e.push(o),f.push(o),l[o].children_d.length&&(f=f.concat(l[o].children_d)));for(m.children=e,m.children_d=f,p=0,q=m.parents.length;p<q;p++)l[m.parents[p]].children_d=l[m.parents[p]].children_d.concat(f);r={cnt:k,mod:l,sel:n,par:d,dpc:f,add:g}}return"undefined"!=typeof window&&void 0!==window.document?r:void postMessage(r)},k=function(b,c){if(null!==this.element){for(var e in this._cnt=b.cnt,f=this._model.data)f.hasOwnProperty(e)&&f[e].state&&f[e].state.loading&&b.mod[e]&&(b.mod[e].state.loading=!0);if(this._model.data=b.mod,c){var g,i=b.add,k=b.sel,l=this._data.core.selected.slice(),f=this._model.data;if(k.length!==l.length||a.vakata.array_unique(k.concat(l)).length!==k.length){for(e=0,g=k.length;e<g;e++)-1===a.inArray(k[e],i)&&-1===a.inArray(k[e],l)&&(f[k[e]].state.selected=!1);for(e=0,g=l.length;e<g;e++)-1===a.inArray(l[e],k)&&(f[l[e]].state.selected=!0)}}b.add.length&&(this._data.core.selected=this._data.core.selected.concat(b.add)),this.trigger("model",{nodes:b.dpc,parent:b.par}),b.par!==a.jstree.root?(this._node_changed(b.par),this.redraw()):this.redraw(!0),b.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!c&&j?j(function(){d.call(h,!0)}):d.call(h,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+i.toString()],{type:"text/javascript"}))),!this._data.core.working||e?(this._data.core.working=!0,(f=new window.Worker(this._wrk)).onmessage=function(a){k.call(this,a.data,!0);try{f.terminate(),f=null}catch(b){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),g.par?f.postMessage(g):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([b,c,d,!0])}catch(l){k.call(this,i(g),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else k.call(this,i(g),!1)}},_parse_model_from_html:function(c,k,e){e=e?[].concat(e):[],k&&e.unshift(k);var f,g,j,l,h=this._model.data,i={id:!1,text:!1,icon:!0,parent:k,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(j in this._model.default_state)this._model.default_state.hasOwnProperty(j)&&(i.state[j]=this._model.default_state[j]);if(k=a.vakata.attributes(c,!0),a.each(k,function(b,c){return!(c=a.vakata.trim(c)).length||(i.li_attr[b]=c,void("id"===b&&(i.id=c.toString())))}),(k=c.children("a").first()).length&&(k=a.vakata.attributes(k,!0),a.each(k,function(b,c){(c=a.vakata.trim(c)).length&&(i.a_attr[b]=c)})),(k=(c.children("a").first().length?c.children("a").first():c).clone()).children("ins, i, ul").remove(),k=k.html(),k=a("<div></div>").html(k),i.text=this.settings.core.force_text?k.text():k.html(),k=c.data(),i.data=k?a.extend(!0,{},k):null,i.state.opened=c.hasClass("jstree-open"),i.state.selected=c.children("a").hasClass("jstree-clicked"),i.state.disabled=c.children("a").hasClass("jstree-disabled"),i.data&&i.data.jstree)for(j in i.data.jstree)i.data.jstree.hasOwnProperty(j)&&(i.state[j]=i.data.jstree[j]);for((k=c.children("a").children(".jstree-themeicon")).length&&(i.icon=!k.hasClass("jstree-themeicon-hidden")&&k.attr("rel")),i.state.icon!==b&&(i.icon=i.state.icon),i.icon!==b&&null!==i.icon&&""!==i.icon||(i.icon=!0),k=c.children("ul").children("li");h[l="j"+this._id+"_"+ ++this._cnt];);return i.id=i.li_attr.id?i.li_attr.id.toString():l,k.length?(k.each(function(b,c){f=this._parse_model_from_html(a(c),i.id,e),g=this._model.data[f],i.children.push(f),g.children_d.length&&(i.children_d=i.children_d.concat(g.children_d))}.bind(this)),i.children_d=i.children_d.concat(i.children)):c.hasClass("jstree-closed")&&(i.state.loaded=!1),i.li_attr.class&&(i.li_attr.class=i.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),i.a_attr.class&&(i.a_attr.class=i.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),(h[i.id]=i).state.selected&&this._data.core.selected.push(i.id),i.id},_parse_model_from_flat_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var h,i,j,k,e=a.id.toString(),f=this._model.data,g=this._model.default_state,l={id:e,text:a.text||"",icon:a.icon===b||a.icon,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in g)g.hasOwnProperty(h)&&(l.state[h]=g[h]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),l.icon!==b&&null!==l.icon&&""!==l.icon||(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&(l.state[h]=a.data.jstree[h]);if(a&&"object"==typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(l.state[h]=a.state[h]);if(a&&"object"==typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(l.li_attr[h]=a.li_attr[h]);if(l.li_attr.id||(l.li_attr.id=e),a&&"object"==typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(l.a_attr[h]=a.a_attr[h]);for(a&&a.children&&!0===a.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),h=0,i=(f[l.id]=l).children.length;h<i;h++)k=f[j=this._parse_model_from_flat_json(f[l.children[h]],l.id,d)],l.children_d.push(j),k.children_d.length&&(l.children_d=l.children_d.concat(k.children_d));return delete a.data,delete a.children,f[l.id].original=a,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);for(var f,g,h,i,l,e=!1,j=this._model.data,k=this._model.default_state;j[e="j"+this._id+"_"+ ++this._cnt];);for(f in l={id:!1,text:"string"==typeof a?a:"",icon:"object"!=typeof a||a.icon===b||a.icon,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},k)k.hasOwnProperty(f)&&(l.state[f]=k[f]);if(a&&a.id&&(l.id=a.id.toString()),a&&a.text&&(l.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),l.icon!==b&&null!==l.icon&&""!==l.icon||(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(l.state[f]=a.data.jstree[f]);if(a&&"object"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(l.state[f]=a.state[f]);if(a&&"object"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(l.li_attr[f]=a.li_attr[f]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=e),l.li_attr.id||(l.li_attr.id=l.id),a&&"object"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(l.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,g=a.children.length;f<g;f++)i=j[h=this._parse_model_from_json(a.children[f],l.id,d)],l.children.push(h),i.children_d.length&&(l.children_d=l.children_d.concat(i.children_d));l.children_d=l.children.concat(l.children_d)}return a&&a.children&&!0===a.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete a.data,delete a.children,l.original=a,(j[l.id]=l).state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){for(var d,b=(this._model.force_full_redraw?this._model.data[a.jstree.root].children:this._model.changed).concat([]),c=i.createElement("UL"),g=this._data.core.focused,e=0,f=b.length;e<f;e++)(d=this.redraw_node(b[e],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&c.appendChild(d);this._model.force_full_redraw&&(c.className=this.get_container_ul()[0].className,c.setAttribute("role","group"),this.element.empty().append(c)),null!==g&&this.settings.core.restore_focus&&((d=this.get_node(g,!0))&&d.length&&d.children(".jstree-anchor")[0]!==i.activeElement?d.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:b})},redraw:function(a){a&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(b){var e,c=this.get_node(b),d=!1,f=!1,g=i;if(!c)return!1;if(c.id===a.jstree.root)return this.redraw(!0);if(!(b=this.get_node(b,!0))||!b.length)return!1;if(b.children(".jstree-children").remove(),b=b[0],c.children.length&&c.state.loaded){for((f=g.createElement("UL")).setAttribute("role","group"),f.className="jstree-children",d=0,e=c.children.length;d<e;d++)f.appendChild(this.redraw_node(c.children[d],!0,!0));b.appendChild(f)}},redraw_node:function(b,c,d,e){var t,u,f=this.get_node(b),g=!1,h=!1,j=!1,k=!1,l=!1,m=!1,n="",o=i,p=this._model.data,q=!1,s=null,v=!1,w=!1;if(!f)return!1;if(f.id===a.jstree.root)return this.redraw(!0);if(c=c||0===f.children.length,b=i.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(f.id[0])?"\\3"+f.id[0]+" "+f.id.substr(1).replace(a.jstree.idregex,"\\$&"):f.id.replace(a.jstree.idregex,"\\$&"))):i.getElementById(f.id))b=a(b),d||((g=b.parent().parent()[0])===this.element[0]&&(g=null),h=b.index()),(c=!c&&f.children.length&&!b.children(".jstree-children").length?!0:c)||(j=b.children(".jstree-children")[0]),q=b.children(".jstree-anchor")[0]===i.activeElement,b.remove();else if(c=!0,!d){if(!(null===(g=f.parent!==a.jstree.root?a("#"+f.parent.replace(a.jstree.idregex,"\\$&"),this.element)[0]:null)||g&&p[f.parent].state.opened))return!1;h=a.inArray(f.id,(null===g?p[a.jstree.root]:p[f.parent]).children)}for(k in b=this._data.core.node.cloneNode(!0),n="jstree-node ",f.li_attr)if(f.li_attr.hasOwnProperty(k)){if("id"===k)continue;"class"!==k?b.setAttribute(k,f.li_attr[k]):n+=f.li_attr[k]}for(f.a_attr.id||(f.a_attr.id=f.id+"_anchor"),b.childNodes[1].setAttribute("aria-selected",!!f.state.selected),b.childNodes[1].setAttribute("aria-level",f.parents.length),this.settings.core.compute_elements_positions&&(b.childNodes[1].setAttribute("aria-setsize",p[f.parent].children.length),b.childNodes[1].setAttribute("aria-posinset",p[f.parent].children.indexOf(f.id)+1)),f.state.disabled&&b.childNodes[1].setAttribute("aria-disabled",!0),k=0,l=f.children.length;k<l;k++)if(!p[f.children[k]].state.hidden){v=!0;break}if(null!==f.parent&&p[f.parent]&&!f.state.hidden&&(k=a.inArray(f.id,p[f.parent].children),w=f.id,-1!==k))for(k++,l=p[f.parent].children.length;k<l&&(w=!p[p[f.parent].children[k]].state.hidden?p[f.parent].children[k]:w)===f.id;k++);for(l in f.state.hidden&&(n+=" jstree-hidden"),f.state.loading&&(n+=" jstree-loading"),f.state.loaded&&!v?n+=" jstree-leaf":(n+=f.state.opened&&f.state.loaded?" jstree-open":" jstree-closed",b.childNodes[1].setAttribute("aria-expanded",f.state.opened&&f.state.loaded)),w===f.id&&(n+=" jstree-last"),b.id=f.id,b.className=n,n=(f.state.selected?" jstree-clicked":"")+(f.state.disabled?" jstree-disabled":""),f.a_attr)if(f.a_attr.hasOwnProperty(l)){if("href"===l&&"#"===f.a_attr[l])continue;"class"!==l?b.childNodes[1].setAttribute(l,f.a_attr[l]):n+=" "+f.a_attr[l]}if(n.length&&(b.childNodes[1].className="jstree-anchor "+n),(f.icon&&!0!==f.icon||!1===f.icon)&&(!1===f.icon?b.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===f.icon.indexOf("/")&&-1===f.icon.indexOf(".")?b.childNodes[1].childNodes[0].className+=" "+f.icon+" jstree-themeicon-custom":(b.childNodes[1].childNodes[0].style.backgroundImage='url("'+f.icon+'")',b.childNodes[1].childNodes[0].style.backgroundPosition="center center",b.childNodes[1].childNodes[0].style.backgroundSize="auto",b.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?b.childNodes[1].appendChild(o.createTextNode(f.text)):b.childNodes[1].innerHTML+=f.text,c&&f.children.length&&(f.state.opened||e)&&f.state.loaded){for((m=o.createElement("UL")).setAttribute("role","group"),m.className="jstree-children",k=0,l=f.children.length;k<l;k++)m.appendChild(this.redraw_node(f.children[k],c,!0));b.appendChild(m)}if(j&&b.appendChild(j),!d){for(k=0,l=(g=g||this.element[0]).childNodes.length;k<l;k++)if(g.childNodes[k]&&g.childNodes[k].className&&-1!==g.childNodes[k].className.indexOf("jstree-children")){s=g.childNodes[k];break}s||((s=o.createElement("UL")).setAttribute("role","group"),s.className="jstree-children",g.appendChild(s)),h<(g=s).childNodes.length?g.insertBefore(b,g.childNodes[h]):g.appendChild(b),q&&(t=this.element[0].scrollTop,u=this.element[0].scrollLeft,b.childNodes[1].focus(),this.element[0].scrollTop=t,this.element[0].scrollLeft=u)}return f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(function(){this.open_node(f.id,!1,0)}.bind(this),0)),b},open_node:function(c,d,e){var f,g,h,i;if(a.vakata.is_array(c)){for(f=0,g=(c=c.slice()).length;f<g;f++)this.open_node(c[f],d,e);return!0}return!(!(c=this.get_node(c))||c.id===a.jstree.root)&&(e=e===b?this.settings.core.animation:e,this.is_closed(c)?this.is_loaded(c)?(h=this.get_node(c,!0),i=this,h.length&&(e&&h.children(".jstree-children").length&&h.children(".jstree-children").stop(!0,!0),c.children.length&&!this._firstChild(h.children(".jstree-children")[0])&&this.draw_children(c),e?(this.trigger("before_open",{node:c}),h.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(e,function(){this.style.display="",i.element&&i.trigger("after_open",{node:c})})):(this.trigger("before_open",{node:c}),h[0].className=h[0].className.replace("jstree-closed","jstree-open"),h[0].childNodes[1].setAttribute("aria-expanded",!0))),c.state.opened=!0,d&&d.call(this,c,!0),h.length||this.trigger("before_open",{node:c}),this.trigger("open_node",{node:c}),e&&h.length||this.trigger("after_open",{node:c}),!0):this.is_loading(c)?setTimeout(function(){this.open_node(c,d,e)}.bind(this),500):void this.load_node(c,function(a,b){return b?this.open_node(a,d,e):!!d&&d.call(this,a,!1)}):(d&&d.call(this,c,!1),!1))},_open_to:function(b){if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;for(var e=b.parents,c=0,d=e.length;c<d;c+=1)c!==a.jstree.root&&this.open_node(e[c],!1,0);return a("#"+b.id.replace(a.jstree.idregex,"\\$&"),this.element)},close_node:function(c,d){var e,f,g,h;if(a.vakata.is_array(c)){for(e=0,f=(c=c.slice()).length;e<f;e++)this.close_node(c[e],d);return!0}return!(!(c=this.get_node(c))||c.id===a.jstree.root)&&(!this.is_closed(c)&&(d=d===b?this.settings.core.animation:d,h=(g=this).get_node(c,!0),c.state.opened=!1,this.trigger("close_node",{node:c}),void(h.length?d?h.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(d,function(){this.style.display="",h.children(".jstree-children").remove(),g.element&&g.trigger("after_close",{node:c})}):(h[0].className=h[0].className.replace("jstree-open","jstree-closed"),h.children(".jstree-anchor").attr("aria-expanded",!1),h.children(".jstree-children").remove(),this.trigger("after_close",{node:c})):this.trigger("after_close",{node:c}))))},toggle_node:function(b){var c,d;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.toggle_node(b[c]);return!0}return this.is_closed(b)?this.open_node(b):this.is_open(b)?this.close_node(b):void 0},open_all:function(b,c,d){if(b=b||a.jstree.root,!(b=this.get_node(b)))return!1;var f,g,h,e=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0);if(!e.length){for(f=0,g=b.children_d.length;f<g;f++)this.is_closed(this._model.data[b.children_d[f]])&&(this._model.data[b.children_d[f]].state.opened=!0);return this.trigger("open_all",{node:b})}d=d||e,(e=(h=this).is_closed(b)?e.find(".jstree-closed").addBack():e.find(".jstree-closed")).each(function(){h.open_node(this,function(a,b){b&&this.is_parent(a)&&this.open_all(a,c,d)},c||0)}),0===d.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(d)})},close_all:function(b,c){if(b=b||a.jstree.root,!(b=this.get_node(b)))return!1;var f,g,d=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0),e=this;for(d.length&&(d=this.is_open(b)?d.find(".jstree-open").addBack():d.find(".jstree-open"),a(d.get().reverse()).each(function(){e.close_node(this,c||0)})),f=0,g=b.children_d.length;f<g;f++)this._model.data[b.children_d[f]].state.opened=!1;this.trigger("close_all",{node:b})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(b){var c,d;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.enable_node(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(b.state.disabled=!1,this.get_node(b,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:b}))},disable_node:function(b){var c,d;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.disable_node(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(b.state.disabled=!0,this.get_node(b,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:b}))},is_hidden:function(a){return!0===(a=this.get_node(a)).state.hidden},hide_node:function(b,c){var d,e;if(a.vakata.is_array(b)){for(d=0,e=(b=b.slice()).length;d<e;d++)this.hide_node(b[d],!0);return c||this.redraw(),!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&void(b.state.hidden||(b.state.hidden=!0,this._node_changed(b.parent),c||this.redraw(),this.trigger("hide_node",{node:b})))},show_node:function(b,c){var d,e;if(a.vakata.is_array(b)){for(d=0,e=(b=b.slice()).length;d<e;d++)this.show_node(b[d],!0);return c||this.redraw(),!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&void(b.state.hidden&&(b.state.hidden=!1,this._node_changed(b.parent),c||this.redraw(),this.trigger("show_node",{node:b})))},hide_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&!d[c].state.hidden&&(d[c].state.hidden=!0,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger("hide_all",{nodes:e}),e},show_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&d[c].state.hidden&&(d[c].state.hidden=!1,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger("show_all",{nodes:e}),e},activate_node:function(a,c){if(this.is_disabled(a))return!1;if(c&&"object"==typeof c||(c={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==b?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&(!c.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(c.shiftKey){for(var d=this.get_node(a).id,e=this._data.core.last_clicked.id,f=this.get_node(this._data.core.last_clicked.parent).children,g=!1,h=0,i=f.length;h<i;h+=1)f[h]===d&&(g=!g),f[h]===e&&(g=!g),this.is_disabled(f[h])||!g&&f[h]!==d&&f[h]!==e?this.deselect_node(f[h],!0,c):this.is_hidden(f[h])||this.select_node(f[h],!0,!1,c);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:c})}else this.is_selected(a)?this.deselect_node(a,!1,c):this.select_node(a,!1,!1,c);else!this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,c):(this.deselect_all(!0),this.select_node(a,!1,!1,c),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a),event:c})},hover_node:function(a){if(!(a=this.get_node(a,!0))||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b),a.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(a)}),setTimeout(function(){c.attr("aria-activedescendant",a[0].id)},0)},dehover_node:function(a){return!!((a=this.get_node(a,!0))&&a.length&&a.children(".jstree-hovered").length)&&(a.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(a)}))},select_node:function(b,c,d,e){var f,g,h;if(a.vakata.is_array(b)){for(g=0,h=(b=b.slice()).length;g<h;g++)this.select_node(b[g],c,d,e);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(f=this.get_node(b,!0),void(b.state.selected||(b.state.selected=!0,this._data.core.selected.push(b.id),(f=!d?this._open_to(b):f)&&f.length&&f.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:b,selected:this._data.core.selected,event:e}),c||this.trigger("changed",{action:"select_node",node:b,selected:this._data.core.selected,event:e}))))},deselect_node:function(b,c,d){var e,f,g;if(a.vakata.is_array(b)){for(e=0,f=(b=b.slice()).length;e<f;e++)this.deselect_node(b[e],c,d);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(g=this.get_node(b,!0),void(b.state.selected&&(b.state.selected=!1,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,b.id),g.length&&g.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:b,selected:this._data.core.selected,event:d}),c||this.trigger("changed",{action:"deselect_node",node:b,selected:this._data.core.selected,event:d}))))},select_all:function(b){var d,e,c=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[a.jstree.root].children_d.concat(),d=0,e=this._data.core.selected.length;d<e;d++)this._model.data[this._data.core.selected[d]]&&(this._model.data[this._data.core.selected[d]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),b||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:c})},deselect_all:function(a){for(var b=this._data.core.selected.concat([]),c=0,d=this._data.core.selected.length;c<d;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:b}),a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.state.selected},get_selected:function(b){return b?a.map(this._data.core.selected,function(a){return this.get_node(a)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(b){for(var g,h,c=this.get_selected(!0),d={},e=0,f=c.length;e<f;e++)d[c[e].id]=c[e];for(e=0,f=c.length;e<f;e++)for(g=0,h=c[e].children_d.length;g<h;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];for(e in c=[],d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,function(a){return this.get_node(a)}.bind(this)):c},get_bottom_selected:function(b){for(var c=this.get_selected(!0),d=[],e=0,f=c.length;e<f;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,function(a){return this.get_node(a)}.bind(this)):d},get_state:function(){var c,b={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(c in this._model.data)this._model.data.hasOwnProperty(c)&&c!==a.jstree.root&&(this._model.data[c].state.loaded&&this.settings.core.loaded_state&&b.core.loaded.push(c),this._model.data[c].state.opened&&b.core.open.push(c),this._model.data[c].state.selected&&b.core.selected.push(c));return b},set_state:function(c,d){if(c){if(c.core&&c.core.selected&&c.core.initial_selection===b&&(c.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),c.core){var h,i;if(c.core.loaded)return this.settings.core.loaded_state&&a.vakata.is_array(c.core.loaded)&&c.core.loaded.length?this._load_nodes(c.core.loaded,function(a){delete c.core.loaded,this.set_state(c,d)}):(delete c.core.loaded,this.set_state(c,d)),!1;if(c.core.open)return a.vakata.is_array(c.core.open)&&c.core.open.length?this._load_nodes(c.core.open,function(a){this.open_node(a,!1,0),delete c.core.open,this.set_state(c,d)}):(delete c.core.open,this.set_state(c,d)),!1;if(c.core.scroll)return c.core.scroll&&c.core.scroll.left!==b&&this.element.scrollLeft(c.core.scroll.left),c.core.scroll&&c.core.scroll.top!==b&&this.element.scrollTop(c.core.scroll.top),delete c.core.scroll,this.set_state(c,d),!1;if(c.core.selected)return h=this,c.core.initial_selection!==b&&c.core.initial_selection!==this._data.core.selected.concat([]).sort().join(",")||(this.deselect_all(),a.each(c.core.selected,function(a,b){h.select_node(b,!1,!0)})),delete c.core.initial_selection,delete c.core.selected,this.set_state(c,d),!1;for(i in c)c.hasOwnProperty(i)&&"core"!==i&&-1===a.inArray(i,this.settings.plugins)&&delete c[i];if(a.isEmptyObject(c.core))return delete c.core,this.set_state(c,d),!1}return!a.isEmptyObject(c)||(c=null,d&&d.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(b,c){this._data.core.state=!0===c?{}:this.get_state(),c&&a.vakata.is_function(c)&&(this._data.core.state=c.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var d=this.get_container_ul()[0].className;b||(this.element.html("<ul class='"+d+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(a.jstree.root,function(b,c){c&&(this.get_container_ul()[0].className=d,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(a.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(b){if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;var c=[],d=[],e=this._data.core.selected.concat([]);d.push(b.id),!0===b.state.opened&&c.push(b.id),this.get_node(b,!0).find(".jstree-open").each(function(){d.push(this.id),c.push(this.id)}),this._load_nodes(d,function(a){this.open_node(c,!1,0),this.select_node(e),this.trigger("refresh_node",{node:b,nodes:a})}.bind(this),!1,!0)},set_id:function(b,c){if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;var d,e,f=this._model.data,g=b.id;for(c=c.toString(),f[b.parent].children[a.inArray(b.id,f[b.parent].children)]=c,d=0,e=b.parents.length;d<e;d++)f[b.parents[d]].children_d[a.inArray(b.id,f[b.parents[d]].children_d)]=c;for(d=0,e=b.children.length;d<e;d++)f[b.children[d]].parent=c;for(d=0,e=b.children_d.length;d<e;d++)f[b.children_d[d]].parents[a.inArray(b.id,f[b.children_d[d]].parents)]=c;return-1!==(d=a.inArray(b.id,this._data.core.selected))&&(this._data.core.selected[d]=c),(d=this.get_node(b.id,!0))&&(d.attr("id",c),this.element.attr("aria-activedescendant")===b.id&&this.element.attr("aria-activedescendant",c)),delete f[b.id],b.id=c,f[b.li_attr.id=c]=b,this.trigger("set_id",{node:b,new:b.id,old:g}),!0},get_text:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.text},set_text:function(b,c){var d,e;if(a.vakata.is_array(b)){for(d=0,e=(b=b.slice()).length;d<e;d++)this.set_text(b[d],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(b.text=c,this.get_node(b,!0).length&&this.redraw_node(b.id),this.trigger("set_text",{obj:b,text:c}),!0)},get_json:function(b,c,d){if(!(b=this.get_node(b||a.jstree.root)))return!1;c&&c.flat&&!d&&(d=[]);var f,g,e={id:b.id,text:b.text,icon:this.get_icon(b),li_attr:a.extend(!0,{},b.li_attr),a_attr:a.extend(!0,{},b.a_attr),state:{},data:(!c||!c.no_data)&&a.extend(!0,a.vakata.is_array(b.data)?[]:{},b.data)};if(c&&c.flat?e.parent=b.parent:e.children=[],c&&c.no_state)delete e.state;else for(f in b.state)b.state.hasOwnProperty(f)&&(e.state[f]=b.state[f]);if(c&&c.no_li_attr&&delete e.li_attr,c&&c.no_a_attr&&delete e.a_attr,c&&c.no_id&&(delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id),c&&c.flat&&b.id!==a.jstree.root&&d.push(e),!c||!c.no_children)for(f=0,g=b.children.length;f<g;f++)c&&c.flat?this.get_json(b.children[f],c,d):e.children.push(this.get_json(b.children[f],c));return c&&c.flat?d:b.id===a.jstree.root?e.children:e},create_node:function(c,d,e,f,g){if(null===c&&(c=a.jstree.root),!(c=this.get_node(c)))return!1;if(!(e=e===b?"last":e).toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(c))return this.load_node(c,function(){this.create_node(c,d,e,f,!0)});var h,i,j,k;switch((d="string"==typeof(d=d||{text:this.get_string("New node")})?{text:d}:a.extend(!0,{},d)).text===b&&(d.text=this.get_string("New node")),c.id===a.jstree.root&&("after"===(e="before"===e?"first":e)&&(e="last")),e){case"before":h=this.get_node(c.parent),e=a.inArray(c.id,h.children),c=h;break;case"after":h=this.get_node(c.parent),e=a.inArray(c.id,h.children)+1,c=h;break;case"inside":case"first":e=0;break;case"last":e=c.children.length;break;default:e=e||0}if(e>c.children.length&&(e=c.children.length),d.id||(d.id=!0),!this.check("create_node",d,c,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===d.id&&delete d.id,!(d=this._parse_model_from_json(d,c.id,c.parents.concat())))return!1;for(h=this.get_node(d),(i=[]).push(d),i=i.concat(h.children_d),this.trigger("model",{nodes:i,parent:c.id}),c.children_d=c.children_d.concat(i),j=0,k=c.parents.length;j<k;j++)this._model.data[c.parents[j]].children_d=this._model.data[c.parents[j]].children_d.concat(i);for(d=h,h=[],j=0,k=c.children.length;j<k;j++)h[e<=j?j+1:j]=c.children[j];return h[e]=d.id,c.children=h,this.redraw_node(c,!0),this.trigger("create_node",{node:this.get_node(d),parent:c.id,position:e}),f&&f.call(this,this.get_node(d)),d.id},rename_node:function(b,c){var d,e,f;if(a.vakata.is_array(b)){for(d=0,e=(b=b.slice()).length;d<e;d++)this.rename_node(b[d],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(f=b.text,this.check("rename_node",b,this.get_parent(b),c)?(this.set_text(b,c),this.trigger("rename_node",{node:b,text:c,old:f}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(b){var c,d,e,g,h,i,j,k,l,m,n;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.delete_node(b[c]);return!0}if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;if(e=this.get_node(b.parent),n=a.inArray(b.id,e.children),l=!1,!this.check("delete_node",b,e,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(e.children=a.vakata.array_remove(e.children,n)),(g=b.children_d.concat([])).push(b.id),h=0,i=b.parents.length;h<i;h++)this._model.data[b.parents[h]].children_d=a.vakata.array_filter(this._model.data[b.parents[h]].children_d,function(b){return-1===a.inArray(b,g)});for(j=0,k=g.length;j<k;j++)if(this._model.data[g[j]].state.selected){l=!0;break}for(l&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(b){return-1===a.inArray(b,g)})),this.trigger("delete_node",{node:b,parent:e.id}),l&&this.trigger("changed",{action:"delete_node",node:b,selected:this._data.core.selected,parent:e.id}),j=0,k=g.length;j<k;j++)delete this._model.data[g[j]];return-1!==a.inArray(this._data.core.focused,g)&&(this._data.core.focused=null,m=this.element[0].scrollTop,n=this.element[0].scrollLeft,e.id===a.jstree.root?this._model.data[a.jstree.root].children[0]&&this.get_node(this._model.data[a.jstree.root].children[0],!0).children(".jstree-anchor").triger("focus"):this.get_node(e,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=m,this.element[0].scrollLeft=n),this.redraw_node(e,!0),!0},check:function(b,c,d,e,f){c=c&&c.id?c:this.get_node(c),d=d&&d.id?d:this.get_node(d);var g=b.match(/^move_node|copy_node|create_node$/i)?d:c,h=this.settings.core.check_callback;if("move_node"===b||"copy_node"===b){if(!(f&&f.is_multi||"move_node"!==b||a.inArray(c.id,d.children)!==e))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})});if(!(f&&f.is_multi||c.id!==d.id&&("move_node"!==b||a.inArray(c.id,d.children)!==e)&&-1===a.inArray(d.id,c.children_d)))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})})}return(g=g&&g.data?g.data:g)&&g.functions&&(!1===g.functions[b]||!0===g.functions[b])?(!1===g.functions[b]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+b,data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})}),g.functions[b]):!(!1===h||a.vakata.is_function(h)&&!1===h.call(this,b,c,d,e,f)||h&&!1===h[b])||!(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+b,data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})})},last_error:function(){return this._data.core.last_error},move_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(c,d,e,f,!0,!1,i)});if(a.vakata.is_array(c)){if(1!==c.length){for(j=0,k=c.length;j<k;j++)(r=this.move_node(c[j],d,e,f,g,!1,i))&&(d=r,e="after");return this.redraw(),!0}c=c[0]}if(!(c=c&&c.id?c:this.get_node(c))||c.id===a.jstree.root)return!1;if(l=(c.parent||a.jstree.root).toString(),n=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,p=!(o=i||(this._model.data[c.id]?this:a.jstree.reference(c.id)))||!o._id||this._id!==o._id,m=o&&o._id&&l&&o._model.data[l]&&o._model.data[l].children?a.inArray(c.id,o._model.data[l].children):-1,o&&o._id&&(c=o._model.data[c.id]),p)return!!(r=this.copy_node(c,d,e,f,g,!1,i))&&(o&&o.delete_node(c),r);switch(d.id===a.jstree.root&&("after"===(e="before"===e?"first":e)&&(e="last")),e){case"before":e=a.inArray(d.id,n.children);break;case"after":e=a.inArray(d.id,n.children)+1;break;case"inside":case"first":e=0;break;case"last":e=n.children.length;break;default:e=e||0}if(e>n.children.length&&(e=n.children.length),!this.check("move_node",c,n,e,{core:!0,origin:i,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(c.parent===n.id){for(q=n.children.concat(),-1!==(r=a.inArray(c.id,q))&&(q=a.vakata.array_remove(q,r),r<e&&e--),r=[],s=0,t=q.length;s<t;s++)r[e<=s?s+1:s]=q[s];r[e]=c.id,n.children=r,this._node_changed(n.id),this.redraw(n.id===a.jstree.root)}else{for((r=c.children_d.concat()).push(c.id),s=0,t=c.parents.length;s<t;s++){for(q=[],u=0,v=(w=o._model.data[c.parents[s]].children_d).length;u<v;u++)-1===a.inArray(w[u],r)&&q.push(w[u]);o._model.data[c.parents[s]].children_d=q}for(o._model.data[l].children=a.vakata.array_remove_item(o._model.data[l].children,c.id),s=0,t=n.parents.length;s<t;s++)this._model.data[n.parents[s]].children_d=this._model.data[n.parents[s]].children_d.concat(r);for(q=[],s=0,t=n.children.length;s<t;s++)q[e<=s?s+1:s]=n.children[s];for(q[e]=c.id,n.children=q,n.children_d.push(c.id),n.children_d=n.children_d.concat(c.children_d),c.parent=n.id,(r=n.parents.concat()).unshift(n.id),w=c.parents.length,r=(c.parents=r).concat(),s=0,t=c.children_d.length;s<t;s++)this._model.data[c.children_d[s]].parents=this._model.data[c.children_d[s]].parents.slice(0,-1*w),Array.prototype.push.apply(this._model.data[c.children_d[s]].parents,r);l!==a.jstree.root&&n.id!==a.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(n.id)),h||this.redraw()}return f&&f.call(this,c,n,e),this.trigger("move_node",{node:c,parent:n.id,position:e,old_parent:l,old_position:m,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id,old_instance:o,new_instance:this}),c.id},copy_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(c,d,e,f,!0,!1,i)});if(a.vakata.is_array(c)){if(1!==c.length){for(j=0,k=c.length;j<k;j++)(m=this.copy_node(c[j],d,e,f,g,!0,i))&&(d=m,e="after");return this.redraw(),!0}c=c[0]}if(!(c=c&&c.id?c:this.get_node(c))||c.id===a.jstree.root)return!1;switch(q=(c.parent||a.jstree.root).toString(),r=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,(s=i||(this._model.data[c.id]?this:a.jstree.reference(c.id)))&&s._id&&(this._id,s._id),s&&s._id&&(c=s._model.data[c.id]),d.id===a.jstree.root&&("after"===(e="before"===e?"first":e)&&(e="last")),e){case"before":e=a.inArray(d.id,r.children);break;case"after":e=a.inArray(d.id,r.children)+1;break;case"inside":case"first":e=0;break;case"last":e=r.children.length;break;default:e=e||0}if(e>r.children.length&&(e=r.children.length),!this.check("copy_node",c,r,e,{core:!0,origin:i,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(p=s?s.get_json(c,{no_id:!0,no_data:!0,no_state:!0}):c))return!1;if(!0===p.id&&delete p.id,!(p=this._parse_model_from_json(p,r.id,r.parents.concat())))return!1;for(m=this.get_node(p),c&&c.state&&!1===c.state.loaded&&(m.state.loaded=!1),(l=[]).push(p),l=l.concat(m.children_d),this.trigger("model",{nodes:l,parent:r.id}),n=0,o=r.parents.length;n<o;n++)this._model.data[r.parents[n]].children_d=this._model.data[r.parents[n]].children_d.concat(l);for(l=[],n=0,o=r.children.length;n<o;n++)l[e<=n?n+1:n]=r.children[n];return l[e]=m.id,r.children=l,r.children_d.push(m.id),r.children_d=r.children_d.concat(m.children_d),r.id===a.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(r.id),h||this.redraw(r.id===a.jstree.root),f&&f.call(this,m,r,e),this.trigger("copy_node",{node:m,original:c,parent:r.id,position:e,old_parent:q,old_position:s&&s._id&&q&&s._model.data[q]&&s._model.data[q].children?a.inArray(c.id,s._model.data[q].children):-1,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id,old_instance:s,new_instance:this}),m.id},cut:function(b){if(b=b||this._data.core.selected.concat(),!(b=!a.vakata.is_array(b)?[b]:b).length)return!1;for(var g,c=[],h=0,i=b.length;h<i;h++)(g=this.get_node(b[h]))&&g.id&&g.id!==a.jstree.root&&c.push(g);return!!c.length&&(d=c,e="move_node",void(f=this).trigger("cut",{node:b}))},copy:function(b){if(b=b||this._data.core.selected.concat(),!(b=!a.vakata.is_array(b)?[b]:b).length)return!1;for(var g,c=[],h=0,i=b.length;h<i;h++)(g=this.get_node(b[h]))&&g.id&&g.id!==a.jstree.root&&c.push(g);return!!c.length&&(d=c,e="copy_node",void(f=this).trigger("copy",{node:b}))},get_buffer:function(){return{mode:e,node:d,inst:f}},can_paste:function(){return!1!==e&&!1!==d},paste:function(a,b){return!!((a=this.get_node(a))&&e&&e.match(/^(copy_node|move_node)$/)&&d)&&(this[e](d,a,b,!1,!1,!1,f)&&this.trigger("paste",{parent:a.id,node:d,mode:e}),void(f=e=d=!1))},clear_buffer:function(){f=e=d=!1,this.trigger("clear_buffer")},edit:function(b,c,d){var f,g,h,j,k,l,m,n,o=!1;return!!(b=this.get_node(b))&&(this.check("edit",b,this.get_parent(b))?(n=b,c="string"==typeof c?c:b.text,this.set_text(b,""),b=this._open_to(b),n.text=c,m=this._data.core.rtl,f=this.element.width(),this._data.core.focused=n.id,g=b.children(".jstree-anchor").trigger("focus"),h=a("<span></span>"),j=c,k=a("<div></div>",{css:{position:"absolute",top:"-200px",left:m?"0px":"-1000px",visibility:"hidden"}}).appendTo(i.body),l=a("<input />",{value:j,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(m){m.stopImmediatePropagation(),m.preventDefault();var f=h.children(".jstree-rename-input").val(),m=this.settings.core.force_text;""===f&&(f=j),k.remove(),h.replaceWith(g),h.remove(),j=m?j:a("<div></div>").append(a.parseHTML(j)).html(),b=this.get_node(b),this.set_text(b,j),(m=!!this.rename_node(b,m?a("<div></div>").text(f).text():a("<div></div>").append(a.parseHTML(f)).html()))||this.set_text(b,j),this._data.core.focused=n.id,setTimeout(function(){var a=this.get_node(n.id,!0);a.length&&(this._data.core.focused=n.id,a.children(".jstree-anchor").trigger("focus"))}.bind(this),0),d&&d.call(this,n,m,o,f),l=null}.bind(this),keydown:function(a){var b=a.which;27===b&&(o=!0,this.value=j),27!==b&&13!==b&&37!==b&&38!==b&&39!==b&&40!==b&&32!==b||a.stopImmediatePropagation(),27!==b&&13!==b||(a.preventDefault(),this.blur())},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(k.text("pW"+this.value).width(),f))},keypress:function(a){return 13!==a.which&&void 0}}),m={fontFamily:g.css("fontFamily")||"",fontSize:g.css("fontSize")||"",fontWeight:g.css("fontWeight")||"",fontStyle:g.css("fontStyle")||"",fontStretch:g.css("fontStretch")||"",fontVariant:g.css("fontVariant")||"",letterSpacing:g.css("letterSpacing")||"",wordSpacing:g.css("wordSpacing")||""},h.attr("class",g.attr("class")).append(g.contents().clone()).append(l),g.replaceWith(h),k.css(m),l.css(m).width(Math.min(k.text("pW"+l[0].value).width(),f))[0].select(),void a(i).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(b){l&&b.target!==l&&a(l).trigger("blur")})):(this.settings.core.error.call(this,this._data.core.last_error),!1))},set_theme:function(b,c){if(!b)return!1;(c=!0===c?(this.settings.core.themes.dir||a.jstree.path+"/themes")+"/"+b+"/style.css":c)&&-1===a.inArray(c,g)&&(a("head").append('<link rel="stylesheet" href="'+c+'" type="text/css" />'),g.push(c)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=b,this.element.addClass("jstree-"+b),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+b+"-responsive"),this.trigger("set_theme",{theme:b})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(c,d){var e,f,g,h;if(a.vakata.is_array(c)){for(e=0,f=(c=c.slice()).length;e<f;e++)this.set_icon(c[e],d);return!0}return!(!(c=this.get_node(c))||c.id===a.jstree.root)&&(h=c.icon,c.icon=!0===d||null===d||d===b||""===d||d,g=this.get_node(c,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===d?(g.removeClass("jstree-themeicon-custom "+h).css("background","").removeAttr("rel"),this.hide_icon(c)):(!0===d||null===d||d===b||""===d?g.removeClass("jstree-themeicon-custom "+h).css("background","").removeAttr("rel"):-1===d.indexOf("/")&&-1===d.indexOf(".")?(g.removeClass(h).css("background",""),g.addClass(d+" jstree-themeicon-custom").attr("rel",d)):(g.removeClass(h).css("background",""),g.addClass("jstree-themeicon-custom").css("background","url('"+d+"') center center no-repeat").attr("rel",d)),!1===h&&this.show_icon(c)),!0)},get_icon:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.icon},hide_icon:function(b){var c,d;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.hide_icon(b[c]);return!0}return!(!(b=this.get_node(b))||b===a.jstree.root)&&(b.icon=!1,this.get_node(b,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(b){var c,d,e;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.show_icon(b[c]);return!0}return!(!(b=this.get_node(b))||b===a.jstree.root)&&(e=this.get_node(b,!0),b.icon=!e.length||e.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),b.icon||(b.icon=!0),e.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},a.vakata={},a.vakata.attributes=function(b,c){b=a(b)[0];var d=c?{}:[];return b&&b.attributes&&a.each(b.attributes,function(b,e){-1===a.inArray(e.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==e.value&&""!==a.vakata.trim(e.value)&&(c?d[e.name]=e.value:d.push(e.name))}),d},a.vakata.array_unique=function(a){for(var c=[],g={},d=0,f=a.length;d<f;d++)g[a[d]]===b&&(c.push(a[d]),g[a[d]]=!0);return c},a.vakata.array_remove=function(a,b){return a.splice(b,1),a},a.vakata.array_remove_item=function(b,d){d=a.inArray(d,b);return-1!==d?a.vakata.array_remove(b,d):b},a.vakata.array_filter=function(a,b,c,d,e){if(a.filter)return a.filter(b,c);for(e in d=[],a)~~e+""==e+""&&0<=e&&b.call(c,a[e],+e,a)&&d.push(a[e]);return d},a.vakata.trim=function(a){return String.prototype.trim?String.prototype.trim.call(a.toString()):a.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},a.vakata.is_function=function(a){return"function"==typeof a&&"number"!=typeof a.nodeType},a.vakata.is_array=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},Function.prototype.bind||(Function.prototype.bind=function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);if("function"!=typeof a)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var d=c.concat(Array.prototype.slice.call(arguments));return a.apply(b,d)}}),a.jstree.plugins.changed=function(a,b){var c=[];this.trigger=function(a,d){if(d=d||{},"changed"===a.replace(".jstree","")){d.changed={selected:[],deselected:[]};for(var g={},e=0,f=c.length;e<f;e++)g[c[e]]=1;for(e=0,f=d.selected.length;e<f;e++)g[d.selected[e]]?g[d.selected[e]]=2:d.changed.selected.push(d.selected[e]);for(e=0,f=c.length;e<f;e++)1===g[c[e]]&&d.changed.deselected.push(c[e]);c=d.selected.slice()}b.trigger.call(this,a,d)},this.refresh=function(a,d){return c=[],b.refresh.apply(this,arguments)}};var m,n,l=i.createElement("I");l.className="jstree-icon jstree-checkbox",l.setAttribute("role","presentation"),a.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},a.jstree.plugins.checkbox=function(c,d){this.bind=function(){d.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)}.bind(this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",function(a,b){for(var c=this._model.data,e=(c[b.parent],b.nodes),f=0,g=e.length;f<g;f++)c[e[f]].state.checked=c[e[f]].state.checked||c[e[f]].original&&c[e[f]].original.state&&c[e[f]].original.state.checked,c[e[f]].state.checked&&this._data.checkbox.selected.push(e[f])}.bind(this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",function(b,n){var h,i,j,k,l,m,d=this._model.data,e=d[n.parent],f=n.nodes,g=[],n=this.settings.checkbox.cascade,o=this.settings.checkbox.tie_selection;if(-1!==n.indexOf("down"))if(e.state[o?"selected":"checked"]){for(i=0,j=f.length;i<j;i++)d[f[i]].state[o?"selected":"checked"]=!0;this._data[o?"core":"checkbox"].selected=this._data[o?"core":"checkbox"].selected.concat(f)}else for(i=0,j=f.length;i<j;i++)if(d[f[i]].state[o?"selected":"checked"]){for(k=0,l=d[f[i]].children_d.length;k<l;k++)d[d[f[i]].children_d[k]].state[o?"selected":"checked"]=!0;this._data[o?"core":"checkbox"].selected=this._data[o?"core":"checkbox"].selected.concat(d[f[i]].children_d)}if(-1!==n.indexOf("up")){for(i=0,j=e.children_d.length;i<j;i++)d[e.children_d[i]].children.length||g.push(d[e.children_d[i]].parent);for(k=0,l=(g=a.vakata.array_unique(g)).length;k<l;k++)for(e=d[g[k]];e&&e.id!==a.jstree.root;){for(i=h=0,j=e.children.length;i<j;i++)h+=d[e.children[i]].state[o?"selected":"checked"];if(h!==j)break;e.state[o?"selected":"checked"]=!0,this._data[o?"core":"checkbox"].selected.push(e.id),(m=this.get_node(e,!0))&&m.length&&m.attr("aria-selected",!0).children(".jstree-anchor").addClass(o?"jstree-clicked":"jstree-checked"),e=this.get_node(e.parent)}}this._data[o?"core":"checkbox"].selected=a.vakata.array_unique(this._data[o?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(b,l){var j,k,e=l.node,f=this._model.data,g=this.get_node(e.parent),l=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection,n={},o=this._data[m?"core":"checkbox"].selected;for(h=0,i=o.length;h<i;h++)n[o[h]]=!0;if(-1!==l.indexOf("down"))for(var p=this._cascade_new_checked_state(e.id,!0),q=e.children_d.concat(e.id),h=0,i=q.length;h<i;h++)-1<p.indexOf(q[h])?n[q[h]]=!0:delete n[q[h]];if(-1!==l.indexOf("up"))for(;g&&g.id!==a.jstree.root;){for(h=j=0,i=g.children.length;h<i;h++)j+=f[g.children[h]].state[m?"selected":"checked"];if(j!==i)break;g.state[m?"selected":"checked"]=!0,n[g.id]=!0,(k=this.get_node(g,!0))&&k.length&&k.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),g=this.get_node(g.parent)}for(h in o=[],n)n.hasOwnProperty(h)&&o.push(h);this._data[m?"core":"checkbox"].selected=o}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(b,c){for(var h,d=this.get_node(a.jstree.root),e=this._model.data,f=0,g=d.children_d.length;f<g;f++)(h=e[d.children_d[f]])&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(b,l){var g,h,i,p,e=l.node,j=(this.get_node(e,!0),this.settings.checkbox.cascade),k=this.settings.checkbox.tie_selection,l=this._data[k?"core":"checkbox"].selected,o=e.children_d.concat(e.id);if(-1!==j.indexOf("down")&&(p=this._cascade_new_checked_state(e.id,!1),l=a.vakata.array_filter(l,function(a){return-1===o.indexOf(a)||-1<p.indexOf(a)})),-1!==j.indexOf("up")&&-1===l.indexOf(e.id)){for(g=0,h=e.parents.length;g<h;g++)(i=this._model.data[e.parents[g]]).state[k?"selected":"checked"]=!1,i&&i.original&&i.original.state&&i.original.state.undetermined&&(i.original.state.undetermined=!1),(i=this.get_node(e.parents[g],!0))&&i.length&&i.attr("aria-selected",!1).children(".jstree-anchor").removeClass(k?"jstree-clicked":"jstree-checked");l=a.vakata.array_filter(l,function(a){return-1===e.parents.indexOf(a)})}this._data[k?"core":"checkbox"].selected=l}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",function(b,c){for(var f,g,h,i,d=this.get_node(c.parent),e=this._model.data,j=this.settings.checkbox.tie_selection;d&&d.id!==a.jstree.root&&!d.state[j?"selected":"checked"];){for(f=h=0,g=d.children.length;f<g;f++)h+=e[d.children[f]].state[j?"selected":"checked"];if(!(0<g&&h===g))break;d.state[j?"selected":"checked"]=!0,this._data[j?"core":"checkbox"].selected.push(d.id),(i=this.get_node(d,!0))&&i.length&&i.attr("aria-selected",!0).children(".jstree-anchor").addClass(j?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}}.bind(this)).on("move_node.jstree",function(b,f){var h,i,j,k,l,d=f.is_multi,e=f.old_parent,f=this.get_node(f.parent),g=this._model.data,m=this.settings.checkbox.tie_selection;if(!d)for(h=this.get_node(e);h&&h.id!==a.jstree.root&&!h.state[m?"selected":"checked"];){for(j=i=0,k=h.children.length;j<k;j++)i+=g[h.children[j]].state[m?"selected":"checked"];if(!(0<k&&i===k))break;h.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(h.id),(l=this.get_node(h,!0))&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),h=this.get_node(h.parent)}for(h=f;h&&h.id!==a.jstree.root;){for(j=i=0,k=h.children.length;j<k;j++)i+=g[h.children[j]].state[m?"selected":"checked"];if(i===k)h.state[m?"selected":"checked"]||(h.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(h.id),(l=this.get_node(h,!0))&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"));else{if(!h.state[m?"selected":"checked"])break;h.state[m?"selected":"checked"]=!1,this._data[m?"core":"checkbox"].selected=a.vakata.array_remove_item(this._data[m?"core":"checkbox"].selected,h.id),(l=this.get_node(h,!0))&&l.length&&l.attr("aria-selected",!1).children(".jstree-anchor").removeClass(m?"jstree-clicked":"jstree-checked")}h=this.get_node(h.parent)}}.bind(this))},this.get_undetermined=function(c){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];for(var f,g,h={},i=this._model.data,j=this.settings.checkbox.tie_selection,k=this._data[j?"core":"checkbox"].selected,l=[],m=this,n=[],d=0,e=k.length;d<e;d++)if(i[k[d]]&&i[k[d]].parents)for(f=0,g=i[k[d]].parents.length;f<g&&h[i[k[d]].parents[f]]===b;f++)i[k[d]].parents[f]!==a.jstree.root&&(h[i[k[d]].parents[f]]=!0,l.push(i[k[d]].parents[f]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var j,c=m.get_node(this);if(c)if(c.state.loaded){for(d=0,e=c.children_d.length;d<e;d++)if(!(j=i[c.children_d[d]]).state.loaded&&j.original&&j.original.state&&j.original.state.undetermined&&!0===j.original.state.undetermined)for(h[j.id]===b&&j.id!==a.jstree.root&&(h[j.id]=!0,l.push(j.id)),f=0,g=j.parents.length;f<g;f++)h[j.parents[f]]===b&&j.parents[f]!==a.jstree.root&&(h[j.parents[f]]=!0,l.push(j.parents[f]))}else if(c.original&&c.original.state&&c.original.state.undetermined&&!0===c.original.state.undetermined)for(h[c.id]===b&&c.id!==a.jstree.root&&(h[c.id]=!0,l.push(c.id)),f=0,g=c.parents.length;f<g;f++)h[c.parents[f]]===b&&c.parents[f]!==a.jstree.root&&(h[c.parents[f]]=!0,l.push(c.parents[f]))}),d=0,e=l.length;d<e;d++)i[l[d]].state[j?"selected":"checked"]||n.push(c?i[l[d]]:l[d]);return n},this._undetermined=function(){if(null!==this.element){var b,c,d,a=this.get_undetermined(!1);for(this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),b=0,c=a.length;b<c;b++)(d=this.get_node(a[b],!0))&&d.length&&d.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(a,b,c,e){if(a=d.redraw_node.apply(this,arguments)){for(var h=null,i=null,f=0,g=a.childNodes.length;f<g;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf("jstree-anchor")){h=a.childNodes[f];break}h&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(h.className+=" jstree-checked"),i=l.cloneNode(!1),this._model.data[a.id].state.checkbox_disabled&&(i.className+=" jstree-checkbox-disabled"),h.insertBefore(i,h.childNodes[0]))}return c||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)),a},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(b){b=this.get_node(b);var d,e,c=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection,g=this._data[f?"core":"checkbox"].selected,h=this._model.data;if(!b||!0===b.state[f?"selected":"checked"]||-1===c.indexOf("undetermined")||-1===c.indexOf("down")&&-1===c.indexOf("up"))return!1;if(!b.state.loaded&&!0===b.original.state.undetermined)return!0;for(d=0,e=b.children_d.length;d<e;d++)if(-1!==a.inArray(b.children_d[d],g)||!h[b.children_d[d]].state.loaded&&h[b.children_d[d]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(b){var c,d,e;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.disable_checkbox(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(e=this.get_node(b,!0),void(b.state.checkbox_disabled||(b.state.checkbox_disabled=!0,e&&e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:b}))))},this.enable_checkbox=function(b){var c,d,e;if(a.vakata.is_array(b)){for(c=0,d=(b=b.slice()).length;c<d;c++)this.enable_checkbox(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(e=this.get_node(b,!0),void(b.state.checkbox_disabled&&(b.state.checkbox_disabled=!1,e&&e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:b}))))},this.activate_node=function(b,c){return!a(c.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||a(c.target).hasClass("jstree-checkbox"))&&(c.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!a(c.target).hasClass("jstree-checkbox")?d.activate_node.call(this,b,c):!this.is_disabled(b)&&(this.is_checked(b)?this.uncheck_node(b,c):this.check_node(b,c),void this.trigger("activate_node",{node:this.get_node(b)})))},this._cascade_new_checked_state=function(m,b){var h,i,d=this.settings.checkbox.tie_selection,e=this._model.data[m],f=[],g=[];if(!this.settings.checkbox.cascade_to_disabled&&e.state.disabled||!this.settings.checkbox.cascade_to_hidden&&e.state.hidden)j=this.get_checked_descendants(m),e.state[d?"selected":"checked"]&&j.push(e.id),f=f.concat(j);else{if(e.children)for(h=0,i=e.children.length;h<i;h++){var k=e.children[h],j=this._cascade_new_checked_state(k,b),f=f.concat(j);-1<j.indexOf(k)&&g.push(k)}var l=this.get_node(e,!0),m=0<g.length&&g.length<e.children.length;e.original&&e.original.state&&e.original.state.undetermined&&(e.original.state.undetermined=m),!m&&b&&g.length===e.children.length?(e.state[d?"selected":"checked"]=b,f.push(e.id),l.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked")):(e.state[d?"selected":"checked"]=!1,l.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked"))}return f},this.get_checked_descendants=function(e){var c=this,d=c.settings.checkbox.tie_selection,e=c._model.data[e];return a.vakata.array_filter(e.children_d,function(a){return c._model.data[a].state[d?"selected":"checked"]})},this.check_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.select_node(b,!1,!0,c);var d,e,f;if(a.vakata.is_array(b)){for(e=0,f=(b=b.slice()).length;e<f;e++)this.check_node(b[e],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(d=this.get_node(b,!0),void(b.state.checked||(b.state.checked=!0,this._data.checkbox.selected.push(b.id),d&&d.length&&d.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:b,selected:this._data.checkbox.selected,event:c}))))},this.uncheck_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.deselect_node(b,!1,c);var d,e,f;if(a.vakata.is_array(b)){for(d=0,e=(b=b.slice()).length;d<e;d++)this.uncheck_node(b[d],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(f=this.get_node(b,!0),void(b.state.checked&&(b.state.checked=!1,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,b.id),f.length&&f.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:b,selected:this._data.checkbox.selected,event:c}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var c,d;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[a.jstree.root].children_d.concat(),c=0,d=this._data.checkbox.selected.length;c<d;c++)this._model.data[this._data.checkbox.selected[c]]&&(this._model.data[this._data.checkbox.selected[c]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();for(var a=this._data.checkbox.selected.concat([]),b=0,c=this._data.checkbox.selected.length;b<c;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})},this.is_checked=function(b){return this.settings.checkbox.tie_selection?this.is_selected(b):!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.state.checked},this.get_checked=function(b){return this.settings.checkbox.tie_selection?this.get_selected(b):b?a.map(this._data.checkbox.selected,function(a){return this.get_node(a)}.bind(this)):this._data.checkbox.selected.slice()},this.get_top_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_top_selected(b);for(var g,h,c=this.get_checked(!0),d={},e=0,f=c.length;e<f;e++)d[c[e].id]=c[e];for(e=0,f=c.length;e<f;e++)for(g=0,h=c[e].children_d.length;g<h;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];for(e in c=[],d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,function(a){return this.get_node(a)}.bind(this)):c},this.get_bottom_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(b);for(var c=this.get_checked(!0),d=[],e=0,f=c.length;e<f;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,function(a){return this.get_node(a)}.bind(this)):d},this.load_node=function(b,c){var e,f,j;if(!a.vakata.is_array(b)&&!this.settings.checkbox.tie_selection&&((j=this.get_node(b))&&j.state.loaded))for(e=0,f=j.children_d.length;e<f;e++)this._model.data[j.children_d[e]].state.checked&&(this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,j.children_d[e]));return d.load_node.apply(this,arguments)},this.get_state=function(){var a=d.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(a.checkbox=this._data.checkbox.selected.slice()),a},this.set_state=function(b,c){var f,e=d.set_state.apply(this,arguments);return e&&b.checkbox?(this.settings.checkbox.tie_selection||(this.uncheck_all(),f=this,a.each(b.checkbox,function(a,b){f.check_node(b)})),delete b.checkbox,this.set_state(b,c),!1):e},this.refresh=function(a,b){return this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]),d.refresh.apply(this,arguments)}},a.jstree.defaults.conditionalselect=function(){return!0},a.jstree.plugins.conditionalselect=function(a,b){this.activate_node=function(a,c){return this.settings.conditionalselect.call(this,this.get_node(a),c)?b.activate_node.call(this,a,c):void 0}},a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(b,c){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(d){var c=a.jstree.reference(d.reference),d=c.get_node(d.reference);c.create_node(d,{},"last",function(a){try{c.edit(a)}catch(b){setTimeout(function(){c.edit(a)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(d){var c=a.jstree.reference(d.reference),d=c.get_node(d.reference);c.edit(d)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(d){var c=a.jstree.reference(d.reference),d=c.get_node(d.reference);c.is_selected(d)?c.delete_node(c.get_selected()):c.delete_node(d)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(d){var c=a.jstree.reference(d.reference),d=c.get_node(d.reference);c.is_selected(d)?c.cut(c.get_top_selected()):c.cut(d)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(d){var c=a.jstree.reference(d.reference),d=c.get_node(d.reference);c.is_selected(d)?c.copy(c.get_top_selected()):c.copy(d)}},paste:{separator_before:!1,icon:!1,_disabled:function(b){return!a.jstree.reference(b.reference).can_paste()},separator_after:!1,label:"Paste",action:function(d){var c=a.jstree.reference(d.reference),d=c.get_node(d.reference);c.paste(d)}}}}}}},a.jstree.plugins.contextmenu=function(c,d){this.bind=function(){d.bind.call(this);var e,f,b=0,c=null;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(a,d){"input"!==a.target.tagName.toLowerCase()&&(a.preventDefault(),b=a.ctrlKey?+new Date:0,(d||c)&&(b=+new Date+1e4),c&&clearTimeout(c),this.is_loading(a.currentTarget)||this.show_contextmenu(a.currentTarget,a.pageX,a.pageY,a))}.bind(this)).on("click.jstree",".jstree-anchor",function(c){this._data.contextmenu.visible&&(!b||250<+new Date-b)&&a.vakata.context.hide(),b=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",function(b){b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(e=b.originalEvent.changedTouches[0].clientX,f=b.originalEvent.changedTouches[0].clientY,c=setTimeout(function(){a(b.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(b){c&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(10<Math.abs(e-b.originalEvent.changedTouches[0].clientX)||10<Math.abs(f-b.originalEvent.changedTouches[0].clientY))&&(clearTimeout(c),a.vakata.context.hide())}).on("touchend.vakata.jstree",function(a){c&&clearTimeout(c)}),a(i).on("context_hide.vakata.jstree",function(b,c){this._data.contextmenu.visible=!1,a(c.reference).removeClass("jstree-context")}.bind(this))},this.teardown=function(){this._data.contextmenu.visible&&a.vakata.context.hide(),a(i).off("context_hide.vakata.jstree"),d.teardown.call(this)},this.show_contextmenu=function(c,d,e,f){if(!(c=this.get_node(c))||c.id===a.jstree.root)return!1;var j,g=this.settings.contextmenu,i=this.get_node(c,!0).children(".jstree-anchor"),k=!1;!g.show_at_node&&d!==b&&e!==b||(j=i.offset(),d=j.left,e=j.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(c)&&this.activate_node(c,f),k=g.items,a.vakata.is_function(k)&&(k=k.call(this,c,function(a){this._show_contextmenu(c,d,e,a)}.bind(this))),a.isPlainObject(k)&&this._show_contextmenu(c,d,e,k)},this._show_contextmenu=function(b,c,d,e){var g=this.get_node(b,!0).children(".jstree-anchor");a(i).one("context_show.vakata.jstree",function(b,c){var d="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";a(c.element).addClass(d),g.addClass("jstree-context")}.bind(this)),this._data.contextmenu.visible=!0,a.vakata.context.show(g,{x:c,y:d},e),this.trigger("show_contextmenu",{node:b,x:c,y:d})}},function(a){var b=!1,c={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(i).triggerHandler("context_"+b+".vakata",{reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}})},_execute:function(b){return!(!(b=c.items[b])||b._disabled&&(!a.vakata.is_function(b._disabled)||b._disabled({item:b,reference:c.reference,element:c.element}))||!b.action)&&b.action.call(null,{item:b,reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}})},_parse:function(b,d){if(!b)return!1;d||(c.html="",c.items=[]);var g,e="",f=!1;return d&&(e+="<ul>"),a.each(b,function(b,d){return!d||(c.items.push(d),!f&&d.separator_before&&(e+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>"),f=!1,e+="<li class='"+(d._class||"")+(!0===d._disabled||a.vakata.is_function(d._disabled)&&d._disabled({item:d,reference:c.reference,element:c.element})?" vakata-contextmenu-disabled ":"")+"' "+(d.shortcut?" data-shortcut='"+d.shortcut+"' ":"")+">",e+="<a href='#' rel='"+(c.items.length-1)+"' "+(d.title?"title='"+d.title+"'":"")+">",a.vakata.context.settings.icons&&(e+="<i ",d.icon&&(e+=-1!==d.icon.indexOf("/")||-1!==d.icon.indexOf(".")?" style='background:url(\""+d.icon+"\") center center no-repeat' ":" class='"+d.icon+"' "),e+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),e+=(a.vakata.is_function(d.label)?d.label({item:b,reference:c.reference,element:c.element}):d.label)+(d.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+d.shortcut+'">'+(d.shortcut_label||"")+"</span>":"")+"</a>",d.submenu&&((g=a.vakata.context._parse(d.submenu,!0))&&(e+=g)),e+="</li>",void(d.separator_after&&(e+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>",f=!0)))}),e=e.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),d&&(e+="</ul>"),d||(c.html=e,a.vakata.context._trigger("parse")),10<e.length&&e},_show_submenu:function(c){var d,e,f,g,h,i,j,k;(c=a(c)).length&&c.children("ul").length&&(d=c.children("ul"),f=(e=c.offset().left)+c.outerWidth(),g=c.offset().top,h=d.width(),i=d.height(),j=a(window).width()+a(window).scrollLeft(),k=a(window).height()+a(window).scrollTop(),b?c[f-(h+10+c.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):c[j<f+h&&j-f<e?"addClass":"removeClass"]("vakata-context-right"),k<g+i+10&&d.css("bottom","-1px"),c.hasClass("vakata-context-right")?e<h&&d.css("margin-right",e-h):j-f<h&&d.css("margin-left",j-f-h),d.show())},show:function(d,e,o){var g,h,j,k,l,m,n;switch(c.element&&c.element.length&&c.element.width(""),!0){case!e&&!d:return!1;case!!e&&!!d:c.reference=d,c.position_x=e.x,c.position_y=e.y;break;case!e&&!!d:g=(c.reference=d).offset(),c.position_x=g.left+d.outerHeight(),c.position_y=g.top;break;case!!e&&!d:c.position_x=e.x,c.position_y=e.y}d&&!o&&a(d).data("vakata_contextmenu")&&(o=a(d).data("vakata_contextmenu")),a.vakata.context._parse(o)&&c.element.html(c.html),c.items.length&&(c.element.appendTo(i.body),h=c.element,j=c.position_x,k=c.position_y,l=h.width(),m=h.height(),n=a(window).width()+a(window).scrollLeft(),o=a(window).height()+a(window).scrollTop(),!b||(j-=h.outerWidth()-a(d).outerWidth())<a(window).scrollLeft()+20&&(j=a(window).scrollLeft()+20),c.element.css({left:j=n<j+l+20?n-(l+20):j,top:k=o<k+m+20?o-(m+20):k}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover"),c.is_visible=!0,a.vakata.context._trigger("show"))},hide:function(){c.is_visible&&(c.element.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),c.is_visible=!1,a.vakata.context._trigger("hide"))}},a(function(){b="rtl"===a(i.body).css("direction");var d=!1;c.element=a("<ul class='vakata-context'></ul>"),c.element.on("mouseenter","li",function(b){b.stopImmediatePropagation(),a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(b){a.contains(this,b.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(b){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(){a.vakata.context.hide()},a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(b){b.preventDefault(),a(this).trigger("blur").parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){var d=null;switch(b.which){case 13:case 32:b.type="click",b.preventDefault(),a(b.currentTarget).trigger(b);break;case 37:c.is_visible&&(c.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),b.stopImmediatePropagation(),b.preventDefault());break;case 38:c.is_visible&&((d=!(d=c.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length?c.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last():d).addClass("vakata-context-hover").children("a").trigger("focus"),b.stopImmediatePropagation(),b.preventDefault());break;case 39:c.is_visible&&(c.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),b.stopImmediatePropagation(),b.preventDefault());break;case 40:c.is_visible&&((d=!(d=c.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length?c.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first():d).addClass("vakata-context-hover").children("a").trigger("focus"),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",function(b){b.preventDefault();b=c.element.find(".vakata-contextmenu-shortcut-"+b.which).parent();b.parent().not(".vakata-context-disabled")&&b.trigger("click")}),a(i).on("mousedown.vakata.jstree",function(b){c.is_visible&&c.element[0]!==b.target&&!a.contains(c.element[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,d){c.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),b&&c.element.addClass("vakata-context-rtl").css("direction","rtl"),c.element.find("ul").hide().end()})})}(a),a.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1},a.jstree.plugins.dnd=function(b,c){this.init=function(a,b){c.init.call(this,a,b),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in i.createElement("span")},this.bind=function(){c.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(b){if(this.settings.dnd.large_drag_target&&a(b.target).closest(".jstree-node")[0]!==b.currentTarget)return!0;if("touchstart"===b.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var c=this.get_node(b.target),d=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,e=1<d?d+" "+this.get_string("nodes"):this.get_text(b.currentTarget);if(this.settings.core.force_text&&(e=a.vakata.html.escape(e)),c&&c.id&&c.id!==a.jstree.root&&(1===b.which||"touchstart"===b.type||"dragstart"===b.type)&&(!0===this.settings.dnd.is_draggable||a.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<d?this.get_top_selected(!0):[c],b))){if(m={jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:1<d?this.get_top_selected():[c.id]},n=b.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),a.vakata.dnd.start(b,m,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+e+'<ins class="jstree-copy">+</ins></div>');a.vakata.dnd._trigger("start",b,{helper:a(),element:n,data:m})}}.bind(this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(b){return b.preventDefault(),a.vakata.dnd._trigger("move",b,{helper:a(),element:n,data:m}),!1}).on("drop.jstree",function(b){return b.preventDefault(),a.vakata.dnd._trigger("stop",b,{helper:a(),element:n,data:m}),!1}.bind(this))},this.redraw_node=function(a,b,d,e){if((a=c.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)a.setAttribute("draggable",!0);else{for(var h=null,f=0,g=a.childNodes.length;f<g;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf("jstree-anchor")){h=a.childNodes[f];break}h&&h.setAttribute("draggable",!0)}return a}},a(function(){var c=!1,d=!1,e=!1,f=!1,g=a('<div id="jstree-marker">&#160;</div>').hide();a(i).on("dragover.vakata.jstree",function(b){n&&a.vakata.dnd._trigger("move",b,{helper:a(),element:n,data:m})}).on("drop.vakata.jstree",function(b){n&&(a.vakata.dnd._trigger("stop",b,{helper:a(),element:n,data:m}),m=n=null)}).on("dnd_start.vakata.jstree",function(a,b){e=c=!1,b&&b.data&&b.data.jstree&&g.appendTo(i.body)}).on("dnd_move.vakata.jstree",function(h,i){var j=i.event.target!==e.target;if(!f||i.event&&"dragover"===i.event.type&&!j||clearTimeout(f),i&&i.data&&i.data.jstree&&(!i.event.target.id||"jstree-marker"!==i.event.target.id)){e=i.event;var m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,k=a.jstree.reference(i.event.target),l=!1;if(k&&k._data&&k._data.dnd)if(g.attr("class","jstree-"+k.get_theme()+(k.settings.core.themes.responsive?" jstree-dnd-responsive":"")),D=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey)),i.helper.children().attr("class","jstree-"+k.get_theme()+" jstree-"+k.get_theme()+"-"+k.get_theme_variant()+" "+(k.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[D?"show":"hide"](),i.event.target!==k.element[0]&&i.event.target!==k.get_container_ul()[0]||0!==k.get_container_ul().children().length){if((l=k.settings.dnd.large_drop_target?a(i.event.target).closest(".jstree-node").children(".jstree-anchor"):a(i.event.target).closest(".jstree-anchor"))&&l.length&&l.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(m=l.offset(),n=(i.event.pageY!==b?i.event:i.event.originalEvent).pageY-m.top,r=l.outerHeight(),u=n<r/3?["b","i","a"]:r-r/3<n?["a","i","b"]:r/2<n?["i","a","b"]:["i","b","a"],a.each(u,function(b,e){switch(e){case"b":p=m.left-6,q=m.top,s=k.get_parent(l),t=l.parent().index(),F="jstree-below";break;case"i":B=k.settings.dnd.inside_pos,C=k.get_node(l.parent()),p=m.left-2,q=m.top+r/2+1,s=C.id,t="first"===B?0:"last"===B?C.children.length:Math.min(B,C.children.length),F="jstree-inside";break;case"a":p=m.left-6,q=m.top+r,s=k.get_parent(l),t=l.parent().index()+1,F="jstree-above"}for(v=!0,w=0,x=i.data.nodes.length;w<x;w++)if(y=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node",z=t,"move_node"==y&&"a"===e&&i.data.origin&&i.data.origin===k&&s===k.get_parent(i.data.nodes[w])&&(A=k.get_node(s),z>a.inArray(i.data.nodes[w],A.children)&&--z),!(v=v&&(k&&k.settings&&k.settings.dnd&&!1===k.settings.dnd.check_while_dragging||k.check(y,i.data.origin&&i.data.origin!==k?i.data.origin.get_node(i.data.nodes[w]):i.data.nodes[w],s,z,{dnd:!0,ref:k.get_node(l.parent()),pos:e,origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==k,is_foreign:!i.data.origin})))){k&&k.last_error&&(d=k.last_error());break}return"i"===e&&l.parent().is(".jstree-closed")&&k.settings.dnd.open_timeout&&(!i.event||"dragover"!==i.event.type||j)&&(f&&clearTimeout(f),f=setTimeout(function(a,b){return function(){a.open_node(b)}}(k,l),k.settings.dnd.open_timeout)),v?((E=k.get_node(s,!0)).hasClass(".jstree-dnd-parent")||(a(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),E.addClass("jstree-dnd-parent")),c={ins:k,par:s,pos:"i"!==e||"last"!==B||0!==t||k.is_loaded(C)?t:"last"},g.css({left:p+"px",top:q+"px"}).show(),g.removeClass("jstree-above jstree-inside jstree-below").addClass(F),i.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=D?"copy":"move"),d={},!(u=!0)):void 0}),!0===u))return}else{for(v=!0,w=0,x=i.data.nodes.length;w<x&&(v=v&&k.check(i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node",i.data.origin&&i.data.origin!==k?i.data.origin.get_node(i.data.nodes[w]):i.data.nodes[w],a.jstree.root,"last",{dnd:!0,ref:k.get_node(a.jstree.root),pos:"i",origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==k,is_foreign:!i.data.origin}));w++);if(v)return c={ins:k,par:a.jstree.root,pos:"last"},g.hide(),i.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=D?"copy":"move"))}a(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),c=!1,i.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),i.event.originalEvent&&i.event.originalEvent.dataTransfer,g.hide()}}).on("dnd_scroll.vakata.jstree",function(a,b){b&&b.data&&b.data.jstree&&(g.hide(),e=c=!1,b.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(b,h){if(a(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),f&&clearTimeout(f),h&&h.data&&h.data.jstree){g.hide().detach();var i,j,k=[];if(c){for(i=0,j=h.data.nodes.length;i<j;i++)k[i]=h.data.origin?h.data.origin.get_node(h.data.nodes[i]):h.data.nodes[i];c.ins[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?"copy_node":"move_node"](k,c.par,c.pos,!1,!1,!1,h.data.origin)}else(i=a(h.event.target).closest(".jstree")).length&&d&&d.error&&"check"===d.error&&((i=i.jstree(!0))&&i.settings.core.error.call(this,d));c=e=!1}}).on("keyup.jstree keydown.jstree",function(b,h){(h=a.vakata.dnd._get())&&h.data&&h.data.jstree&&("keyup"===b.type&&27===b.which?(f&&clearTimeout(f),f=e=d=c=!1,g.hide().detach(),a.vakata.dnd._clean()):(h.helper.find(".jstree-copy").first()[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(b.metaKey||b.ctrlKey))?"show":"hide"](),e&&(e.metaKey=b.metaKey,e.ctrlKey=b.ctrlKey,a.vakata.dnd._trigger("move",e))))})}),function(a){var c={element:!(a.vakata.html={div:a("<div></div>"),escape:function(b){return a.vakata.html.div.text(b).html()},strip:function(b){return a.vakata.html.div.empty().append(a.parseHTML(b)).text()}}),target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(c,d,e){(e=e===b?a.vakata.dnd._get():e).event=d,a(i).triggerHandler("dnd_"+c+".vakata",e)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},n=null,a(i).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag),a(i).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(e){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t)return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1;if(!c.scroll_i)return c.scroll_i=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===e)return!1;var d=c.scroll_e.scrollTop(),e=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(d+c.scroll_t*a.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(e+c.scroll_l*a.vakata.dnd.settings.scroll_speed),d===c.scroll_e.scrollTop()&&e===c.scroll_e.scrollLeft()||a.vakata.dnd._trigger("scroll",c.scroll_e)},start:function(b,d,e){"touchstart"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&a.vakata.dnd.stop({});try{b.currentTarget.unselectable="on",b.currentTarget.onselectstart=function(){return!1},b.currentTarget.style&&(b.currentTarget.style.touchAction="none",b.currentTarget.style.msTouchAction="none",b.currentTarget.style.MozUserSelect="none")}catch(f){}return c.init_x=b.pageX,c.init_y=b.pageY,c.data=d,c.is_down=!0,c.element=b.currentTarget,c.target=b.target,c.is_touch="touchstart"===b.type,!1!==e&&(c.helper=a("<div id='vakata-dnd'></div>").html(e).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),a(i).on("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag),a(i).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop),!1},drag:function(b){if("touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(b.pageX-c.init_x)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-c.init_y)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)))return;c.helper&&(c.helper.appendTo(i.body),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,a(c.target).one("click.vakata",!1),a.vakata.dnd._trigger("start",b)}var g,j,k,l,d=!1,e=!1,f=!1,h=!1,m=!1,n=!1;return c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var d=a(this),e=d.offset();return this.scrollHeight>this.offsetHeight&&(e.top+d.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),b.pageY-e.top<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(e.left+d.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),b.pageX-e.left<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=a(this),!1):void 0}),c.scroll_e||(d=a(i),e=a(window),f=d.height(),g=e.height(),h=d.width(),j=e.width(),k=d.scrollTop(),l=d.scrollLeft(),g<f&&b.pageY-k<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),g<f&&g-(b.pageY-k)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),j<h&&b.pageX-l<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),j<h&&j-(b.pageX-l)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=d)),c.scroll_e&&a.vakata.dnd._scroll(!0),c.helper&&(m=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),n=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),h&&n+c.helper_w>h&&(n=h-(c.helper_w+2)),c.helper.css({left:n+"px",top:(m=f&&f<m+25?f-50:m)+"px"})),a.vakata.dnd._trigger("move",b),!1}},stop:function(b){var d;return"touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag?(b.target!==c.target&&a(c.target).off("click.vakata"),a.vakata.dnd._trigger("stop",b)):"touchend"===b.type&&b.target===c.target&&(d=setTimeout(function(){a(b.target).trigger("click")},100),a(b.target).one("click",function(){d&&clearTimeout(d)})),a.vakata.dnd._clean(),!1}}}(a),a.jstree.defaults.massload=null,a.jstree.plugins.massload=function(b,c){this.init=function(a,b){this._data.massload={},c.init.call(this,a,b)},this._load_nodes=function(b,d,e,f){var j,k,l,g=this.settings.massload,h=[],i=this._model.data;if(!e){for(j=0,k=b.length;j<k;j++)i[b[j]]&&(i[b[j]].state.loaded||i[b[j]].state.failed)&&!f||(h.push(b[j]),(l=this.get_node(b[j],!0))&&l.length&&l.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},h.length){if(a.vakata.is_function(g))return g.call(this,h,function(a){var g,h;if(a)for(g in a)a.hasOwnProperty(g)&&(this._data.massload[g]=a[g]);for(g=0,h=b.length;g<h;g++)(l=this.get_node(b[g],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);c._load_nodes.call(this,b,d,e,f)}.bind(this));if("object"==typeof g&&g&&g.url)return g=a.extend(!0,{},g),a.vakata.is_function(g.url)&&(g.url=g.url.call(this,h)),a.vakata.is_function(g.data)&&(g.data=g.data.call(this,h)),a.ajax(g).done(function(a,g,h){var i,j;if(a)for(i in a)a.hasOwnProperty(i)&&(this._data.massload[i]=a[i]);for(i=0,j=b.length;i<j;i++)(l=this.get_node(b[i],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);c._load_nodes.call(this,b,d,e,f)}.bind(this)).fail(function(a){c._load_nodes.call(this,b,d,e,f)}.bind(this))}}return c._load_nodes.call(this,b,d,e,f)},this._load_node=function(b,d){var f,g=this._data.massload[b.id];return g?(f=this["string"==typeof g?"_append_html_data":"_append_json_data"](b,"string"==typeof g?a(a.parseHTML(g)).filter(function(){return 3!==this.nodeType}):g,function(a){d.call(this,a)}),(g=this.get_node(b.id,!0))&&g.length&&g.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[b.id],f):c._load_node.call(this,b,d)}},a.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},a.jstree.plugins.search=function(c,d){this.bind=function(){d.bind.call(this),this._data.search.str="",this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",function(b,c){if(this._data.search.som&&c.res.length){for(var h,i,d=this._model.data,g=[],e=0,f=c.res.length;e<f;e++)if(d[c.res[e]]&&!d[c.res[e]].state.hidden&&(g.push(c.res[e]),g=g.concat(d[c.res[e]].parents),this._data.search.smc))for(h=0,i=d[c.res[e]].children_d.length;h<i;h++)d[d[c.res[e]].children_d[h]]&&!d[d[c.res[e]].children_d[h]].state.hidden&&g.push(d[c.res[e]].children_d[h]);g=a.vakata.array_remove_item(a.vakata.array_unique(g),a.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(g,!0),this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(a,b){this._data.search.som&&b.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))}.bind(this))},this.search=function(c,d,e,f,g,h){if(!1===c||""===a.vakata.trim(c.toString()))return this.clear_search();f=(f=this.get_node(f))&&f.id?f.id:null,c=c.toString();var o,p,i=this.settings.search,j=i.ajax||!1,k=this._model.data,l=null,m=[],n=[];if(this._data.search.res.length&&!g&&this.clear_search(),e===b&&(e=i.show_only_matches),h===b&&(h=i.show_only_matches_children),!d&&!1!==j)return a.vakata.is_function(j)?j.call(this,c,function(b){b&&b.d&&(b=b.d),this._load_nodes(a.vakata.is_array(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g,h)})}.bind(this),f):((j=a.extend({},j)).data||(j.data={}),j.data.str=c,f&&(j.data.inside=f),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=a.ajax(j).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(j)},this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.vakata.is_array(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g,h)})}.bind(this)),this._data.search.lastRequest);if(g||(this._data.search.str=c,this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=e,this._data.search.smc=h),l=new a.vakata.search(c,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),a.each(k[f||a.jstree.root].children_d,function(a,b){var d=k[b];d.text&&!d.state.hidden&&(!i.search_leaves_only||d.state.loaded&&0===d.children.length)&&(i.search_callback&&i.search_callback.call(this,c,d)||!i.search_callback&&l.search(d.text).isMatch)&&(m.push(b),n=n.concat(d.parents))}),m.length){for(o=0,p=(n=a.vakata.array_unique(n)).length;o<p;o++)n[o]!==a.jstree.root&&k[n[o]]&&!0===this.open_node(n[o],null,0)&&this._data.search.opn.push(n[o]);g?(this._data.search.dom=this._data.search.dom.add(a(this.element[0].querySelectorAll("#"+a.map(m,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(a.jstree.idregex,"\\$&"):b.replace(a.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=a.vakata.array_unique(this._data.search.res.concat(m))):(this._data.search.dom=a(this.element[0].querySelectorAll("#"+a.map(m,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(a.jstree.idregex,"\\$&"):b.replace(a.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=m),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:c,res:this._data.search.res,show_only_matches:e})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=a(this.element[0].querySelectorAll("#"+a.map(this._data.search.res,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(a.jstree.idregex,"\\$&"):b.replace(a.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=a()},this.redraw_node=function(b,c,e,f){if((b=d.redraw_node.apply(this,arguments))&&-1!==a.inArray(b.id,this._data.search.res)){for(var i=null,g=0,h=b.childNodes.length;g<h;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf("jstree-anchor")){i=b.childNodes[g];break}i&&(i.className+=" jstree-search")}return b}},function(a){a.vakata.search=function(b,c,d){d=d||{},!1!==(d=a.extend({},a.vakata.search.defaults,d)).fuzzy&&(d.fuzzy=!0),b=d.caseSensitive?b:b.toLowerCase();var i,j,k,l,e=d.location,f=d.distance,g=d.threshold,h=b.length;return 32<h&&(d.fuzzy=!1),d.fuzzy&&(i=1<<h-1,j=function(){for(var a={},c=0,c=0;c<h;c++)a[b.charAt(c)]=0;for(c=0;c<h;c++)a[b.charAt(c)]|=1<<h-c-1;return a}(),k=function(c,d){c/=h,d=Math.abs(e-d);return f?c+d/f:d?1:c}),l=function(a){if(a=d.caseSensitive?a:a.toLowerCase(),b===a||-1!==a.indexOf(b))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var c,f,o,p,r,s,t,u,v,l=a.length,m=g,n=a.indexOf(b,e),q=h+l,w=1,x=[];for(-1!==n&&(m=Math.min(k(0,n),m),-1!==(n=a.lastIndexOf(b,e+h))&&(m=Math.min(k(0,n),m))),n=-1,c=0;c<h;c++){for(o=0,p=q;o<p;)k(c,e+p)<=m?o=p:q=p,p=Math.floor((q-o)/2+o);for(q=p,s=Math.max(1,e-p+1),t=Math.min(e+p,l)+h,(u=new Array(t+2))[t+1]=(1<<c)-1,f=t;s<=f;f--)if(v=j[a.charAt(f-1)],u[f]=0===c?(u[f+1]<<1|1)&v:(u[f+1]<<1|1)&v|(r[f+1]|r[f])<<1|1|r[f+1],u[f]&i&&(w=k(c,f-1))<=m){if(m=w,x.push(n=f-1),!(e<n))break;s=Math.max(1,2*e-n)}if(k(c+1,e)>m)break;r=u}return{isMatch:0<=n,score:w}},!0===c?{search:l}:l(c)},a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(a),a.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};var o=!(a.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this),this.element.on("model.jstree",function(a,b){this.sort(b.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(a,b){this.sort(b.parent||b.node.parent,!1),this.redraw_node(b.parent||b.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(a,b){this.sort(b.parent,!1),this.redraw_node(b.parent,!0)}.bind(this))},this.sort=function(a,b){var c,d;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(this.settings.sort.bind(this)),b))for(c=0,d=a.children_d.length;c<d;c++)this.sort(a.children_d[c],!1)}});a.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},a.jstree.plugins.state=function(b,c){this.bind=function(){c.bind.call(this);var a=function(){this.element.on(this.settings.state.events,function(){o&&clearTimeout(o),o=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this)),this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(b,c){this.element.one("restore_state.jstree",a),this.restore_state()||a()}.bind(this))},this.save_state=function(){var c=this.get_state();this.settings.state.preserve_loaded||delete c.core.loaded;c={state:c,ttl:this.settings.state.ttl,sec:+new Date};a.vakata.storage.set(this.settings.state.key,JSON.stringify(c))},this.restore_state=function(){var b=a.vakata.storage.get(this.settings.state.key);if(b)try{b=JSON.parse(b)}catch(c){return!1}return!(b&&b.ttl&&b.sec&&+new Date-b.sec>b.ttl)&&(!!(b=(b=b&&b.state?b.state:b)&&a.vakata.is_function(this.settings.state.filter)?this.settings.state.filter.call(this,b):b)&&(this.settings.state.preserve_loaded||delete b.core.loaded,this.element.one("set_state.jstree",function(c,d){d.instance.trigger("restore_state",{state:a.extend(!0,{},b)})}),this.set_state(b),!0))},this.clear_state=function(){return a.vakata.storage.del(this.settings.state.key)}},function(a){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}}(a),a.jstree.defaults.types={default:{}},a.jstree.defaults.types[a.jstree.root]={},a.jstree.plugins.types=function(c,d){this.init=function(c,e){var f,g;if(e&&e.types&&e.types.default)for(f in e.types)if("default"!==f&&f!==a.jstree.root&&e.types.hasOwnProperty(f))for(g in e.types.default)e.types.default.hasOwnProperty(g)&&e.types[f][g]===b&&(e.types[f][g]=e.types.default[g]);d.init.call(this,c,e),this._model.data[a.jstree.root].type=a.jstree.root},this.refresh=function(b,c){d.refresh.call(this,b,c),this._model.data[a.jstree.root].type=a.jstree.root},this.bind=function(){this.element.on("model.jstree",function(c,d){for(var k,e=this._model.data,f=d.nodes,g=this.settings.types,j="default",h=0,i=f.length;h<i;h++){if(j="default",e[f[h]].original&&e[f[h]].original.type&&g[e[f[h]].original.type]&&(j=e[f[h]].original.type),e[f[h]].data&&e[f[h]].data.jstree&&e[f[h]].data.jstree.type&&g[e[f[h]].data.jstree.type]&&(j=e[f[h]].data.jstree.type),e[f[h]].type=j,!0===e[f[h]].icon&&g[j].icon!==b&&(e[f[h]].icon=g[j].icon),g[j].li_attr!==b&&"object"==typeof g[j].li_attr)for(k in g[j].li_attr)if(g[j].li_attr.hasOwnProperty(k)){if("id"===k)continue;e[f[h]].li_attr[k]===b?e[f[h]].li_attr[k]=g[j].li_attr[k]:"class"===k&&(e[f[h]].li_attr.class=g[j].li_attr.class+" "+e[f[h]].li_attr.class)}if(g[j].a_attr!==b&&"object"==typeof g[j].a_attr)for(k in g[j].a_attr)if(g[j].a_attr.hasOwnProperty(k)){if("id"===k)continue;e[f[h]].a_attr[k]===b?e[f[h]].a_attr[k]=g[j].a_attr[k]:"href"===k&&"#"===e[f[h]].a_attr[k]?e[f[h]].a_attr.href=g[j].a_attr.href:"class"===k&&(e[f[h]].a_attr.class=g[j].a_attr.class+" "+e[f[h]].a_attr.class)}}e[a.jstree.root].type=a.jstree.root}.bind(this)),d.bind.call(this)},this.get_json=function(b,c,e){var f,g,h=this._model.data,i=c?a.extend(!0,{},c,{no_id:!1}):{},j=d.get_json.call(this,b,i,e);if(!1===j)return!1;if(a.vakata.is_array(j))for(f=0,g=j.length;f<g;f++)j[f].type=j[f].id&&h[j[f].id]&&h[j[f].id].type?h[j[f].id].type:"default",c&&c.no_id&&(delete j[f].id,j[f].li_attr&&j[f].li_attr.id&&delete j[f].li_attr.id,j[f].a_attr&&j[f].a_attr.id&&delete j[f].a_attr.id);else j.type=j.id&&h[j.id]&&h[j.id].type?h[j.id].type:"default",c&&c.no_id&&(j=this._delete_ids(j));return j},this._delete_ids=function(b){if(a.vakata.is_array(b)){for(var c=0,d=b.length;c<d;c++)b[c]=this._delete_ids(b[c]);return b}return delete b.id,b.li_attr&&b.li_attr.id&&delete b.li_attr.id,b.a_attr&&b.a_attr.id&&delete b.a_attr.id,b.children&&a.vakata.is_array(b.children)&&(b.children=this._delete_ids(b.children)),b},this.check=function(c,e,f,g,h){if(!1===d.check.call(this,c,e,f,g,h))return!1;e=e&&e.id?e:this.get_node(e),f=f&&f.id?f:this.get_node(f);var j,k,l,m,i=(i=e&&e.id?h&&h.origin?h.origin:a.jstree.reference(e.id):null)&&i._model&&i._model.data?i._model.data:null;switch(c){case"create_node":case"move_node":case"copy_node":if("move_node"!==c||-1===a.inArray(e.id,f.children)){if((j=this.get_rules(f)).max_children!==b&&-1!==j.max_children&&j.max_children===f.children.length)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:!(!e||!e.id)&&e.id,par:!(!f||!f.id)&&f.id})});if(j.valid_children!==b&&-1!==j.valid_children&&-1===a.inArray(e.type||"default",j.valid_children))return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:!(!e||!e.id)&&e.id,par:!(!f||!f.id)&&f.id})});if(i&&e.children_d&&e.parents){for(l=k=0,m=e.children_d.length;l<m;l++)k=Math.max(k,i[e.children_d[l]].parents.length);k=k-e.parents.length+1}(k<=0||k===b)&&(k=1);do{if(j.max_depth!==b&&-1!==j.max_depth&&j.max_depth<k)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:!(!e||!e.id)&&e.id,par:!(!f||!f.id)&&f.id})})}while(f=this.get_node(f.parent),j=this.get_rules(f),k++,f)}}return!0},this.get_rules=function(c){if(!(c=this.get_node(c)))return!1;c=this.get_type(c,!0);return c.max_depth===b&&(c.max_depth=-1),c.max_children===b&&(c.max_children=-1),c.valid_children===b&&(c.valid_children=-1),c},this.get_type=function(b,c){return!!(b=this.get_node(b))&&(c?a.extend({type:b.type},this.settings.types[b.type]):b.type)},this.set_type=function(c,d){var f,g,h,i,j,k,l,m,e=this._model.data;if(a.vakata.is_array(c)){for(g=0,h=(c=c.slice()).length;g<h;g++)this.set_type(c[g],d);return!0}if(f=this.settings.types,c=this.get_node(c),!f[d]||!c)return!1;if((l=this.get_node(c,!0))&&l.length&&(m=l.children(".jstree-anchor")),i=c.type,j=this.get_icon(c),c.type=d,!0!==j&&f[i]&&(f[i].icon===b||j!==f[i].icon)||this.set_icon(c,f[d].icon===b||f[d].icon),f[i]&&f[i].li_attr!==b&&"object"==typeof f[i].li_attr)for(k in f[i].li_attr)if(f[i].li_attr.hasOwnProperty(k)){if("id"===k)continue;"class"===k?(e[c.id].li_attr.class=(e[c.id].li_attr.class||"").replace(f[i].li_attr[k],""),l&&l.removeClass(f[i].li_attr[k])):e[c.id].li_attr[k]===f[i].li_attr[k]&&(e[c.id].li_attr[k]=null,l&&l.removeAttr(k))}if(f[i]&&f[i].a_attr!==b&&"object"==typeof f[i].a_attr)for(k in f[i].a_attr)if(f[i].a_attr.hasOwnProperty(k)){if("id"===k)continue;"class"===k?(e[c.id].a_attr.class=(e[c.id].a_attr.class||"").replace(f[i].a_attr[k],""),m&&m.removeClass(f[i].a_attr[k])):e[c.id].a_attr[k]===f[i].a_attr[k]&&("href"===k?(e[c.id].a_attr[k]="#",m&&m.attr("href","#")):(delete e[c.id].a_attr[k],m&&m.removeAttr(k)))}if(f[d].li_attr!==b&&"object"==typeof f[d].li_attr)for(k in f[d].li_attr)if(f[d].li_attr.hasOwnProperty(k)){if("id"===k)continue;e[c.id].li_attr[k]===b?(e[c.id].li_attr[k]=f[d].li_attr[k],l&&("class"===k?l.addClass(f[d].li_attr[k]):l.attr(k,f[d].li_attr[k]))):"class"===k&&(e[c.id].li_attr.class=f[d].li_attr[k]+" "+e[c.id].li_attr.class,l&&l.addClass(f[d].li_attr[k]))}if(f[d].a_attr!==b&&"object"==typeof f[d].a_attr)for(k in f[d].a_attr)if(f[d].a_attr.hasOwnProperty(k)){if("id"===k)continue;e[c.id].a_attr[k]===b?(e[c.id].a_attr[k]=f[d].a_attr[k],m&&("class"===k?m.addClass(f[d].a_attr[k]):m.attr(k,f[d].a_attr[k]))):"href"===k&&"#"===e[c.id].a_attr[k]?(e[c.id].a_attr.href=f[d].a_attr.href,m&&m.attr("href",f[d].a_attr.href)):"class"===k&&(e[c.id].a_attr.class=f[d].a_attr.class+" "+e[c.id].a_attr.class,m&&m.addClass(f[d].a_attr[k]))}return!0}},a.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(a,b){return a+" ("+b+")"}},a.jstree.plugins.unique=function(c,d){this.check=function(b,c,e,f,g){if(!1===d.check.call(this,b,c,e,f,g))return!1;if(c=c&&c.id?c:this.get_node(c),!(e=e&&e.id?e:this.get_node(e))||!e.children)return!0;for(var o,h="rename_node"===b?f:c.text,i=[],j=this.settings.unique.case_sensitive,k=this.settings.unique.trim_whitespace,l=this._model.data,m=0,n=e.children.length;m<n;m++)o=l[e.children[m]].text,j||(o=o.toLowerCase()),k&&(o=o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),i.push(o);switch(j||(h=h.toLowerCase()),k&&(h=h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),b){case"delete_node":return!0;case"rename_node":return o=c.text||"",j||(o=o.toLowerCase()),k&&(o=o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(m=-1===a.inArray(h,i)||c.text&&o===h)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),m;case"create_node":return(m=-1===a.inArray(h,i))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),m;case"copy_node":return(m=-1===a.inArray(h,i))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),m;case"move_node":return(m=c.parent===e.id&&(!g||!g.is_multi)||-1===a.inArray(h,i))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),m}return!0},this.create_node=function(c,e,f,g,h){if(!e||e.text===b){if(null===c&&(c=a.jstree.root),!(c=this.get_node(c)))return d.create_node.call(this,c,e,f,g,h);if(!(f=f===b?"last":f).toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(c))return d.create_node.call(this,c,e,f,g,h);e=e||{};for(var i,r,n=this._model.data,o=this.settings.unique.case_sensitive,p=this.settings.unique.trim_whitespace,q=this.settings.unique.duplicate,j=i=this.get_string("New node"),k=[],l=0,m=c.children.length;l<m;l++)r=n[c.children[l]].text,o||(r=r.toLowerCase()),p&&(r=r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),k.push(r);for(l=1,r=j,o||(r=r.toLowerCase()),p&&(r=r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==a.inArray(r,k);)r=j=q.call(this,i,++l).toString(),o||(r=r.toLowerCase()),p&&(r=r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));e.text=j}return d.create_node.call(this,c,e,f,g,h)}};var p=i.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",a.jstree.plugins.wholerow=function(b,c){this.bind=function(){c.bind.call(this),this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");for(var c=!1,d=0,e=b.selected.length;d<e;d++)(c=this.get_node(b.selected[d],!0))&&c.length&&c.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(a,b){"hover_node"===a.type&&this.is_disabled(b.node)||this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(b){var c;this._data.contextmenu&&(b.preventDefault(),c=a.Event("contextmenu",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,pageX:b.pageX,pageY:b.pageY}),a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c))}.bind(this)).on("click.jstree",".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=a.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).trigger("focus")}).on("dblclick.jstree",".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=a.Event("dblclick",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).trigger("focus")}).on("click.jstree",".jstree-leaf > .jstree-ocl",function(b){b.stopImmediatePropagation();var c=a.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(a){return a.stopImmediatePropagation(),this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget),!1}.bind(this)).on("mouseleave.jstree",".jstree-node",function(a){this.dehover_node(a.currentTarget)}.bind(this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),c.teardown.call(this)},this.redraw_node=function(b,d,e,f){var g;return(b=c.redraw_node.apply(this,arguments))&&(g=p.cloneNode(!0),-1!==a.inArray(b.id,this._data.core.selected)&&(g.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===b.id&&(g.className+=" jstree-wholerow-hovered"),b.insertBefore(g,b.childNodes[0])),b}},window.customElements&&Object&&Object.create){q=Object.create(HTMLElement.prototype);q.createdCallback=function(){var c,b={core:{},plugins:[]};for(c in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(c)&&this.attributes[c]&&(b.plugins.push(c),this.getAttribute(c)&&JSON.parse(this.getAttribute(c))&&(b[c]=JSON.parse(this.getAttribute(c))));for(c in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(c)&&this.attributes[c]&&(b.core[c]=JSON.parse(this.getAttribute(c))||this.getAttribute(c));a(this).jstree(b)};try{window.customElements.define("vakata-jstree",function(){},{prototype:q})}catch(r){}}}}),function(a,b,c){!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.qtip&&a(jQuery)}(function(d){"use strict";function e(a,b,c,e){this.id=c,this.target=a,this.tooltip=F,this.elements={target:a},this._id=S+"-"+c,this.timers={img:{}},this.options=b,this.plugins={},this.cache={event:{},target:d(),disabled:E,attr:e,onTooltip:E,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=E}function f(a){return a===F||"object"!==d.type(a)}function g(a){return!(d.isFunction(a)||a&&a.attr||a.length||"object"===d.type(a)&&(a.jquery||a.then))}function h(a){var b,c,e,h;return f(a)?E:(f(a.metadata)&&(a.metadata={type:a.metadata}),"content"in a&&(f(b=a.content)||b.jquery||b.done?(c=g(b)?E:b,b=a.content={text:c}):c=b.text,"ajax"in b&&(e=b.ajax,h=e&&e.once!==E,delete b.ajax,b.text=function(a,b){var f=c||d(this).attr(b.options.content.attr)||"Loading...",g=d.ajax(d.extend({},e,{context:b})).then(e.success,F,e.error).then(function(a){return a&&h&&b.set("content.text",a),a},function(a,c,d){b.destroyed||0===a.status||b.set("content.text",c+": "+d)});return h?f:(b.set("content.text",f),g)}),"title"in b&&(d.isPlainObject(b.title)&&(b.button=b.title.button,b.title=b.title.text),g(b.title||E)&&(b.title=E))),"position"in a&&f(a.position)&&(a.position={my:a.position,at:a.position}),"show"in a&&f(a.show)&&(a.show=a.show.jquery?{target:a.show}:a.show===D?{ready:D}:{event:a.show}),"hide"in a&&f(a.hide)&&(a.hide=a.hide.jquery?{target:a.hide}:{event:a.hide}),"style"in a&&f(a.style)&&(a.style={classes:a.style}),d.each(R,function(){this.sanitize&&this.sanitize(a)}),a)}function i(a,b){for(var c,d=0,e=a,f=b.split(".");e=e[f[d++]];)d<f.length&&(c=e);return[c||a,f.pop()]}function j(a,b){var c,d,e;for(c in this.checks)if(this.checks.hasOwnProperty(c))for(d in this.checks[c])this.checks[c].hasOwnProperty(d)&&(e=new RegExp(d,"i").exec(a))&&(b.push(e),"builtin"!==c&&!this.plugins[c]||this.checks[c][d].apply(this.plugins[c]||this,b))}function k(a){return V.concat("").join(a?"-"+a+" ":" ")}function l(a,b){return 0<b?setTimeout(d.proxy(a,this),b):void a.call(this)}function m(a){this.tooltip.hasClass(aa)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=l.call(this,function(){this.toggle(D,a)},this.options.show.delay))}function n(a){if(!this.tooltip.hasClass(aa)&&!this.destroyed){var b=d(a.relatedTarget),c=b.closest(W)[0]===this.tooltip[0],e=b[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==b[0]&&"mouse"===this.options.position.target&&c||this.options.hide.fixed&&/mouse(out|leave|move)/.test(a.type)&&(c||e))try{a.preventDefault(),a.stopImmediatePropagation()}catch(f){}else this.timers.hide=l.call(this,function(){this.toggle(E,a)},this.options.hide.delay,this)}}function o(a){!this.tooltip.hasClass(aa)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=l.call(this,function(){this.hide(a)},this.options.hide.inactive))}function p(a){this.rendered&&0<this.tooltip[0].offsetWidth&&this.reposition(a)}function q(a,c,e){d(b.body).delegate(a,(c.split?c:c.join("."+S+" "))+"."+S,function(){var a=y.api[d.attr(this,U)];a&&!a.disabled&&e.apply(a,arguments)})}function r(a,c,f){var g,l,m=d(b.body),n=a[0]===b?m:a,i=a.metadata?a.metadata(f.metadata):F,k="html5"===f.metadata.type&&i?i[f.metadata.name]:F,q=a.data(f.metadata.name||"qtipopts");try{q="string"==typeof q?d.parseJSON(q):q}catch(r){}if(i=(k=d.extend(D,{},y.defaults,f,"object"==typeof q?h(q):F,h(k||i))).position,k.id=c,"boolean"==typeof k.content.text){if(g=a.attr(k.content.attr),k.content.attr===E||!g)return E;k.content.text=g}if(i.container.length||(i.container=m),i.target===E&&(i.target=n),k.show.target===E&&(k.show.target=n),k.show.solo===D&&(k.show.solo=i.container.closest("body")),k.hide.target===E&&(k.hide.target=n),k.position.viewport===D&&(k.position.viewport=i.container),i.container=i.container.eq(0),i.at=new A(i.at,D),i.my=new A(i.my),a.data(S))if(k.overwrite)a.qtip("destroy",!0);else if(k.overwrite===E)return E;return a.attr(T,c),k.suppress&&(l=a.attr("title"))&&a.removeAttr("title").attr(ca,l).attr("title",""),g=new e(a,k,c,!!g),a.data(S,g),g}function s(a){return a.charAt(0).toUpperCase()+a.slice(1)}function u(a,b){return Math.ceil(parseFloat(function(a,b){var d,e,f=b.charAt(0).toUpperCase()+b.slice(1),g=(b+" "+va.join(f+" ")+f).split(" "),h=0;if(ua[b])return a.css(ua[b]);for(;d=g[h++];)if((e=a.css(d))!==c)return ua[b]=d,e}(a,b)))}function v(a,b){this._ns="tip",this.options=b,this.offset=b.offset,this.size=[b.width,b.height],this.qtip=a,this.init(a)}function w(a,b){this.options=b,this._ns="-modal",this.qtip=a,this.init(a)}function x(a){this._ns="ie6",this.qtip=a,this.init(a)}var y,A,B,C,D=!0,E=!1,F=null,G="x",H="y",I="width",J="height",K="top",L="left",M="bottom",N="right",O="center",Q="shift",R={},S="qtip",T="data-hasqtip",U="data-qtip-id",V=["ui-widget","ui-tooltip"],W="."+S,X="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),Y=S+"-fixed",Z=S+"-default",$=S+"-focus",_=S+"-hover",aa=S+"-disabled",ba="_replacedByqTip",ca="oldtitle",da={ie:function(){for(var a=4,c=b.createElement("div");(c.innerHTML="\x3c!--[if gt IE "+a+"]><i></i><![endif]--\x3e")&&c.getElementsByTagName("i")[0];a+=1);return 4<a?a:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||E},ka=e.prototype;ka._when=function(a){return d.when.apply(d,a)},ka.render=function(a){if(this.rendered||this.destroyed)return this;var b=this,c=this.options,e=this.cache,f=this.elements,g=c.content.text,h=c.content.title,i=c.content.button,j=c.position,k=[];return d.attr(this.target[0],"aria-describedby",this._id),e.posClass=this._createPosClass((this.position={my:j.my,at:j.at}).my),this.tooltip=f.tooltip=d("<div/>",{id:this._id,class:[S,Z,c.style.classes,e.posClass].join(" "),width:c.style.width||"",height:c.style.height||"",tracking:"mouse"===j.target&&j.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":E,"aria-describedby":this._id+"-content","aria-hidden":D}).toggleClass(aa,this.disabled).attr(U,this.id).data(S,this).appendTo(j.container).append(f.content=d("<div />",{class:S+"-content",id:this._id+"-content","aria-atomic":D})),this.rendered=-1,this.positioning=D,h&&(this._createTitle(),d.isFunction(h)||k.push(this._updateTitle(h,E))),i&&this._createButton(),d.isFunction(g)||k.push(this._updateContent(g,E)),this.rendered=D,this._setWidget(),d.each(R,function(a){var c;"render"===this.initialize&&(c=this(b))&&(b.plugins[a]=c)}),this._unassignEvents(),this._assignEvents(),this._when(k).then(function(){b._trigger("render"),b.positioning=E,b.hiddenDuringWait||!c.show.ready&&!a||b.toggle(D,e.event,E),b.hiddenDuringWait=E}),y.api[this.id]=this},ka.destroy=function(a){function b(){if(!this.destroyed){this.destroyed=D;var a,b=this.target,c=b.attr(ca);for(a in this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),d.each(this.plugins,function(){this.destroy&&this.destroy()}),this.timers)this.timers.hasOwnProperty(a)&&clearTimeout(this.timers[a]);b.removeData(S).removeAttr(U).removeAttr(T).removeAttr("aria-describedby"),this.options.suppress&&c&&b.attr("title",c).removeAttr(ca),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=F,delete y.api[this.id]}}return this.destroyed||(a===D&&"hide"!==this.triggering||!this.rendered?b.call(this):(this.tooltip.one("tooltiphidden",d.proxy(b,this)),this.triggering||this.hide())),this.target},B=ka.checks={builtin:{"^id$":function(a,b,g,e){var f=g===D?y.nextid:g,g=S+"-"+f;f!==E&&0<f.length&&!d("#"+g).length?(this._id=g,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):a[b]=e},"^prerender":function(a,b,c){c&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(a,b,c){this._updateContent(c)},"^content.attr$":function(a,b,c,d){this.options.content.text===this.target.attr(d)&&this._updateContent(this.target.attr(c))},"^content.title$":function(a,b,c){return c?(this.elements.title||this._createTitle(),void this._updateTitle(c)):this._removeTitle()},"^content.button$":function(a,b,c){this._updateButton(c)},"^content.title.(text|button)$":function(a,b,c){this.set("content."+b,c)},"^position.(my|at)$":function(a,b,c){"string"==typeof c&&(this.position[b]=a[b]=new A(c,"at"===b))},"^position.container$":function(a,b,c){this.rendered&&this.tooltip.appendTo(c)},"^show.ready$":function(a,b,c){c&&(!this.rendered&&this.render(D)||this.toggle(D))},"^style.classes$":function(a,b,c,d){this.rendered&&this.tooltip.removeClass(d).addClass(c)},"^style.(width|height)":function(a,b,c){this.rendered&&this.tooltip.css(b,c)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(a,b,c){this.rendered&&this.tooltip.toggleClass(Z,!!c)},"^events.(render|show|move|hide|focus|blur)$":function(a,b,c){this.rendered&&this.tooltip[(d.isFunction(c)?"":"un")+"bind"]("tooltip"+b,c)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){var a;this.rendered&&(a=this.options.position,this.tooltip.attr("tracking","mouse"===a.target&&a.adjust.mouse),this._unassignEvents(),this._assignEvents())}}},ka.get=function(c){if(this.destroyed)return this;c=i(this.options,c.toLowerCase()),c=c[0][c[1]];return c.precedance?c.string():c};var ea=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,fa=/^prerender|show\.ready/i;ka.set=function(a,b){if(this.destroyed)return this;var c,e=this.rendered,f=E,g=this.options;return"string"==typeof a?(c=a,(a={})[c]=b):a=d.extend({},a),d.each(a,function(b,c){var j,h;e&&fa.test(b)?delete a[b]:(h=(j=i(g,b.toLowerCase()))[0][j[1]],j[0][j[1]]=c&&c.nodeType?d(c):c,f=ea.test(b)||f,a[b]=[j[0],j[1],c,h])}),h(g),this.positioning=D,d.each(a,d.proxy(j,this)),this.positioning=E,this.rendered&&0<this.tooltip[0].offsetWidth&&f&&this.reposition("mouse"===g.position.target?F:this.cache.event),this},ka._update=function(a,b){var c=this,e=this.cache;return this.rendered&&a?(d.isFunction(a)&&(a=a.call(this.elements.target,e.event,this)||""),d.isFunction(a.then)?(e.waiting=D,a.then(function(a){return e.waiting=E,c._update(a,b)},F,function(a){return c._update(a,b)})):a===E||!a&&""!==a?E:(a.jquery&&0<a.length?b.empty().append(a.css({display:"block",visibility:"visible"})):b.html(a),this._waitForContent(b).then(function(a){c.rendered&&0<c.tooltip[0].offsetWidth&&c.reposition(e.event,!a.length)}))):E},ka._waitForContent=function(a){var b=this.cache;return b.waiting=D,(d.fn.imagesLoaded?a.imagesLoaded():(new d.Deferred).resolve([])).done(function(){b.waiting=E}).promise()},ka._updateContent=function(a,b){this._update(a,this.elements.content,b)},ka._updateTitle=function(a,b){this._update(a,this.elements.title,b)===E&&this._removeTitle(E)},ka._createTitle=function(){var a=this.elements,b=this._id+"-title";a.titlebar&&this._removeTitle(),a.titlebar=d("<div />",{class:S+"-titlebar "+(this.options.style.widget?k("header"):"")}).append(a.title=d("<div />",{id:b,class:S+"-title","aria-atomic":D})).insertBefore(a.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(a){d(this).toggleClass("ui-state-active ui-state-focus","down"===a.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(a){d(this).toggleClass("ui-state-hover","mouseover"===a.type)}),this.options.content.button&&this._createButton()},ka._removeTitle=function(a){var b=this.elements;b.title&&(b.titlebar.remove(),b.titlebar=b.title=b.button=F,a!==E&&this.reposition())},ka._createPosClass=function(a){return S+"-pos-"+(a||this.options.position.my).abbrev()},ka.reposition=function(c,e){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=D;var f,g,i,j=this.cache,k=this.tooltip,l=this.options.position,m=l.target,n=l.my,o=l.at,p=l.viewport,q=l.container,r=l.adjust,s=r.method.split(" "),t=k.outerWidth(E),u=k.outerHeight(E),v=0,w=0,x=k.css("position"),y={left:0,top:0},z=0<k[0].offsetWidth,A=c&&"scroll"===c.type,B=d(a),C=q[0].ownerDocument,F=this.mouse;if(d.isArray(m)&&2===m.length)o={x:L,y:K},y={left:m[0],top:m[1]};else if("mouse"===m)o={x:L,y:K},(!r.mouse||this.options.hide.distance)&&j.origin&&j.origin.pageX?c=j.origin:c&&"resize"!==c.type&&"scroll"!==c.type?F&&F.pageX&&(c=F):c=j.event,"static"!==x&&(y=q.offset()),C.body.offsetWidth!==(a.innerWidth||C.documentElement.clientWidth)&&(g=d(b.body).offset()),y={left:c.pageX-y.left+(g&&g.left||0),top:c.pageY-y.top+(g&&g.top||0)},r.mouse&&A&&F&&(y.left-=(F.scrollX||0)-B.scrollLeft(),y.top-=(F.scrollY||0)-B.scrollTop());else{if("event"===m?c&&c.target&&"scroll"!==c.type&&"resize"!==c.type?j.target=d(c.target):c.target||(j.target=this.elements.target):"event"!==m&&(j.target=d(m.jquery?m:this.elements.target)),m=j.target,0===(m=d(m).eq(0)).length)return this;m[0]===b||m[0]===a?(v=da.iOS?a.innerWidth:m.width(),w=da.iOS?a.innerHeight:m.height(),m[0]===a&&(y={top:(p||m).scrollTop(),left:(p||m).scrollLeft()})):R.imagemap&&m.is("area")?f=R.imagemap(this,m,o,R.viewport?s:E):R.svg&&m&&m[0].ownerSVGElement?f=R.svg(this,m,o,R.viewport?s:E):(v=m.outerWidth(E),w=m.outerHeight(E),y=m.offset()),f&&(v=f.width,w=f.height,g=f.offset,y=f.position),y=this.reposition.offset(m,y,q),(3.1<da.iOS&&da.iOS<4.1||4.3<=da.iOS&&da.iOS<4.33||!da.iOS&&"fixed"===x)&&(y.left-=B.scrollLeft(),y.top-=B.scrollTop()),f&&f.adjustable===E||(y.left+=o.x===N?v:o.x===O?v/2:0,y.top+=o.y===M?w:o.y===O?w/2:0)}return y.left+=r.x+(n.x===N?-t:n.x===O?-t/2:0),y.top+=r.y+(n.y===M?-u:n.y===O?-u/2:0),R.viewport?(i=y.adjusted=R.viewport(this,y,l,v,w,t,u),g&&i.left&&(y.left+=g.left),g&&i.top&&(y.top+=g.top),i.my&&(this.position.my=i.my)):y.adjusted={left:0,top:0},j.posClass!==(i=this._createPosClass(this.position.my))&&(j.posClass=i,k.removeClass(j.posClass).addClass(i)),this._trigger("move",[y,p.elem||p],c)&&(delete y.adjusted,e===E||!z||isNaN(y.left)||isNaN(y.top)||"mouse"===m||!d.isFunction(l.effect)?k.css(y):d.isFunction(l.effect)&&(l.effect.call(k,this,d.extend({},y)),k.queue(function(a){d(this).css({opacity:"",height:""}),da.ie&&this.style.removeAttribute("filter"),a()})),this.positioning=E),this},ka.reposition.offset=function(l,c,e){function f(a,b){c.left+=b*a.scrollLeft(),c.top+=b*a.scrollTop()}if(!e[0])return c;for(var g,h,i,j,k=d(l[0].ownerDocument),l=!!da.ie&&"CSS1Compat"!==b.compatMode,m=e[0];"static"!==(h=d.css(m,"position"))&&("fixed"===h?(i=m.getBoundingClientRect(),f(k,-1)):((i=d(m).position()).left+=parseFloat(d.css(m,"borderLeftWidth"))||0,i.top+=parseFloat(d.css(m,"borderTopWidth"))||0),c.left-=i.left+(parseFloat(d.css(m,"marginLeft"))||0),c.top-=i.top+(parseFloat(d.css(m,"marginTop"))||0),g||"hidden"===(j=d.css(m,"overflow"))||"visible"===j||(g=d(m))),m=m.offsetParent;);return g&&(g[0]!==k[0]||l)&&f(g,1),c};var ga=(A=ka.reposition.Corner=function(c,b){c=(""+c).replace(/([A-Z])/," $1").replace(/middle/gi,O).toLowerCase(),this.x=(c.match(/left|right/i)||c.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(c.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!b;c=c.charAt(0);this.precedance="t"===c||"b"===c?H:G}).prototype;ga.invert=function(a,b){this[a]=this[a]===L?N:this[a]===N?L:b||this[a]},ga.string=function(a){var d=this.x,c=this.y,d=d!==c?"center"===d||"center"!==c&&(this.precedance===H||this.forceY)?[c,d]:[d,c]:[d];return!1!==a?d.join(" "):d},ga.abbrev=function(){var a=this.string(!1);return a[0].charAt(0)+(a[1]&&a[1].charAt(0)||"")},ga.clone=function(){return new A(this.string(),this.forceY)},ka.toggle=function(a,c){var e=this.cache,i=this.options,g=this.tooltip;if(c){if(/over|enter/.test(c.type)&&e.event&&/out|leave/.test(e.event.type)&&i.show.target.add(c.target).length===i.show.target.length&&g.has(c.relatedTarget).length)return this;e.event=d.event.fix(c)}if(this.waiting&&!a&&(this.hiddenDuringWait=D),!this.rendered)return a?this.render(1):this;if(this.destroyed||this.disabled)return this;var j,k=a?"show":"hide",l=this.options[k],m=this.options.position,n=this.options.content,o=this.tooltip.css("width"),h=this.tooltip.is(":visible"),q=a||1===l.target.length,i=!c||l.target.length<2||e.target[0]===c.target;return(typeof a).search("boolean|number")&&(a=!h),i=(h=!g.is(":animated")&&h===a&&i)?F:!!this._trigger(k,[90]),this.destroyed||(i!==E&&a&&this.focus(c),!i||h||(d.attr(g[0],"aria-hidden",!a),a?(this.mouse&&(e.origin=d.event.fix(this.mouse)),d.isFunction(n.text)&&this._updateContent(n.text,E),d.isFunction(n.title)&&this._updateTitle(n.title,E),!C&&"mouse"===m.target&&m.adjust.mouse&&(d(b).bind("mousemove."+S,this._storeMouse),C=D),o||g.css("width",g.outerWidth(E)),this.reposition(c,arguments[2]),o||g.css("width",""),l.solo&&("string"==typeof l.solo?d(l.solo):d(W,l.solo)).not(g).not(l.target).qtip("hide",new d.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete e.origin,C&&!d(W+'[tracking="true"]:visible',l.solo).not(g).length&&(d(b).unbind("mousemove."+S),C=E),this.blur(c)),j=d.proxy(function(){a?(da.ie&&g[0].style.removeAttribute("filter"),g.css("overflow",""),"string"==typeof l.autofocus&&d(this.options.show.autofocus,g).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):g.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(a?"visible":"hidden")},this),l.effect===E||q===E?(g[k](),j()):d.isFunction(l.effect)?(g.stop(1,1),l.effect.call(g,this),g.queue("fx",function(a){j(),a()})):g.fadeTo(90,a?1:0,j),a&&l.target.trigger("qtip-"+this.id+"-inactive"))),this},ka.show=function(a){return this.toggle(D,a)},ka.hide=function(a){return this.toggle(E,a)},ka.focus=function(a){if(!this.rendered||this.destroyed)return this;var b=d(W),c=this.tooltip,e=parseInt(c[0].style.zIndex,10),f=y.zindex+b.length;return c.hasClass($)||this._trigger("focus",[f],a)&&(e!==f&&(b.each(function(){this.style.zIndex>e&&(this.style.zIndex=this.style.zIndex-1)}),b.filter("."+$).qtip("blur",a)),c.addClass($)[0].style.zIndex=f),this},ka.blur=function(a){return!this.rendered||this.destroyed||(this.tooltip.removeClass($),this._trigger("blur",[this.tooltip.css("zIndex")],a)),this},ka.disable=function(a){return this.destroyed||("toggle"===a?a=!(this.rendered?this.tooltip.hasClass(aa):this.disabled):"boolean"!=typeof a&&(a=D),this.rendered&&this.tooltip.toggleClass(aa,a).attr("aria-disabled",a),this.disabled=!!a),this},ka.enable=function(){return this.disable(E)},ka._createButton=function(){var a=this,b=this.elements,c=b.tooltip,e=this.options.content.button,g="string"==typeof e?e:"Close tooltip";b.button&&b.button.remove(),e.jquery?b.button=e:b.button=d("<a />",{class:"qtip-close "+(this.options.style.widget?"":S+"-icon"),title:g,"aria-label":g}).prepend(d("<span />",{class:"ui-icon ui-icon-close",html:"&times;"})),b.button.appendTo(b.titlebar||c).attr("role","button").click(function(b){return c.hasClass(aa)||a.hide(b),E})},ka._updateButton=function(a){if(!this.rendered)return E;var b=this.elements.button;a?this._createButton():b.remove()},ka._setWidget=function(){var a=this.options.style.widget,b=this.elements,c=b.tooltip,d=c.hasClass(aa);c.removeClass(aa),aa=a?"ui-state-disabled":"qtip-disabled",c.toggleClass(aa,d),c.toggleClass("ui-helper-reset "+k(),a).toggleClass(Z,this.options.style.def&&!a),b.content&&b.content.toggleClass(k("content"),a),b.titlebar&&b.titlebar.toggleClass(k("header"),a),b.button&&b.button.toggleClass(S+"-icon",!a)},ka._storeMouse=function(a){return(this.mouse=d.event.fix(a)).type="mousemove",this},ka._bind=function(a,b,c,g,f){if(a&&c&&b.length){g="."+this._id+(g?"-"+g:"");return d(a).bind((b.split?b:b.join(g+" "))+g,d.proxy(c,f||this)),this}},ka._unbind=function(a,b){return a&&d(a).unbind("."+this._id+(b?"-"+b:"")),this},ka._trigger=function(a,b,c){var e=new d.Event("tooltip"+a);return e.originalEvent=c&&d.extend({},c)||this.cache.event||F,this.triggering=a,this.tooltip.trigger(e,[this].concat(b||[])),this.triggering=E,!e.isDefaultPrevented()},ka._bindEvents=function(a,b,c,e,f,g){var h=c.filter(e).add(e.filter(c)),i=[];h.length&&(d.each(b,function(b,e){e=d.inArray(e,a);-1<e&&i.push(a.splice(e,1)[0])}),i.length&&(this._bind(h,i,function(a){(!!this.rendered&&0<this.tooltip[0].offsetWidth?g:f).call(this,a)}),c=c.not(h),e=e.not(h))),this._bind(c,a,f),this._bind(e,b,g)},ka._assignInitialEvents=function(a){function b(a){return this.disabled||this.destroyed?E:(this.cache.event=a&&d.event.fix(a),this.cache.target=a&&d(a.target),clearTimeout(this.timers.show),void(this.timers.show=l.call(this,function(){this.render("object"==typeof a||c.show.ready)},c.prerender?0:c.show.delay)))}var c=this.options,e=c.show.target,f=c.hide.target,g=c.show.event?d.trim(""+c.show.event).split(" "):[],h=c.hide.event?d.trim(""+c.hide.event).split(" "):[];this._bind(this.elements.target,["remove","removeqtip"],function(){this.destroy(!0)},"destroy"),/mouse(over|enter)/i.test(c.show.event)&&!/mouse(out|leave)/i.test(c.hide.event)&&h.push("mouseleave"),this._bind(e,"mousemove",function(a){this._storeMouse(a),this.cache.onTarget=D}),this._bindEvents(g,h,e,f,b,function(){return this.timers?void clearTimeout(this.timers.show):E}),(c.show.ready||c.prerender)&&b.call(this,a)},ka._assignEvents=function(){var c=this,e=this.options,f=e.position,g=this.tooltip,h=e.show.target,i=e.hide.target,j=f.container,k=f.viewport,l=d(b),q=d(a),r=e.show.event?d.trim(""+e.show.event).split(" "):[],s=e.hide.event?d.trim(""+e.hide.event).split(" "):[];d.each(e.events,function(a,b){c._bind(g,"toggle"===a?["tooltipshow","tooltiphide"]:["tooltip"+a],b,null,g)}),/mouse(out|leave)/i.test(e.hide.event)&&"window"===e.hide.leave&&this._bind(l,["mouseout","blur"],function(a){/select|option/.test(a.target.nodeName)||a.relatedTarget||this.hide(a)}),e.hide.fixed?i=i.add(g.addClass(Y)):/mouse(over|enter)/i.test(e.show.event)&&this._bind(i,"mouseleave",function(){clearTimeout(this.timers.show)}),-1<(""+e.hide.event).indexOf("unfocus")&&this._bind(j.closest("html"),["mousedown","touchstart"],function(a){var b=d(a.target),c=this.rendered&&!this.tooltip.hasClass(aa)&&0<this.tooltip[0].offsetWidth,e=0<b.parents(W).filter(this.tooltip[0]).length;b[0]===this.target[0]||b[0]===this.tooltip[0]||e||this.target.has(b[0]).length||!c||this.hide(a)}),"number"==typeof e.hide.inactive&&(this._bind(h,"qtip-"+this.id+"-inactive",o,"inactive"),this._bind(i.add(g),y.inactiveEvents,o)),this._bindEvents(r,s,h,i,m,n),this._bind(h.add(g),"mousemove",function(a){var b,c,d;"number"==typeof e.hide.distance&&(b=this.cache.origin||{},c=this.options.hide.distance,((d=Math.abs)(a.pageX-b.pageX)>=c||d(a.pageY-b.pageY)>=c)&&this.hide(a)),this._storeMouse(a)}),"mouse"===f.target&&f.adjust.mouse&&(e.hide.event&&this._bind(h,["mouseenter","mouseleave"],function(a){return this.cache?void(this.cache.onTarget="mouseenter"===a.type):E}),this._bind(l,"mousemove",function(a){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(aa)&&0<this.tooltip[0].offsetWidth&&this.reposition(a)})),(f.adjust.resize||k.length)&&this._bind(d.event.special.resize?k:q,"resize",p),f.adjust.scroll&&this._bind(q.add(f.container),"scroll",p)},ka._unassignEvents=function(){var g=this.options,e=g.show.target,f=g.hide.target,g=d.grep([this.elements.target[0],this.rendered&&this.tooltip[0],g.position.container[0],g.position.viewport[0],g.position.container.closest("html")[0],a,b],function(a){return"object"==typeof a});e&&e.toArray&&(g=g.concat(e.toArray())),f&&f.toArray&&(g=g.concat(f.toArray())),this._unbind(g)._unbind(g,"destroy")._unbind(g,"inactive")},d(function(){q(W,["mouseenter","mouseleave"],function(a){var b="mouseenter"===a.type,c=d(a.currentTarget),e=d(a.relatedTarget||a.target),f=this.options;b?(this.focus(a),c.hasClass(Y)&&!c.hasClass(aa)&&clearTimeout(this.timers.hide)):"mouse"===f.position.target&&f.position.adjust.mouse&&f.hide.event&&f.show.target&&!e.closest(f.show.target[0]).length&&this.hide(a),c.toggleClass(_,b)}),q("["+U+"]",X,o)}),y=d.fn.qtip=function(a,b,e){var f=(""+a).toLowerCase(),g=F,i=d.makeArray(arguments).slice(1),j=i[i.length-1],k=this[0]?d.data(this[0],S):F;return!arguments.length&&k||"api"===f?k:"string"==typeof a?(this.each(function(){var a=d.data(this,S);if(!a)return D;if(j&&j.timeStamp&&(a.cache.event=j),!b||"option"!==f&&"options"!==f)a[f]&&a[f].apply(a,i);else{if(e===c&&!d.isPlainObject(b))return g=a.get(b),E;a.set(b,e)}}),g!==F?g:this):"object"!=typeof a&&arguments.length?void 0:(k=h(d.extend(D,{},a)),this.each(function(c){var b,c=d.isArray(k.id)?k.id[c]:k.id;return c=!c||c===E||c.length<1||y.api[c]?y.nextid++:c,(b=r(d(this),c,k))===E?D:(y.api[c]=b,d.each(R,function(){"initialize"===this.initialize&&this(b)}),void b._assignInitialEvents(j))}))},d.qtip=e,y.api={},d.each({attr:function(a,b){if(this.length){var c=this[0],e="title",f=d.data(c,"qtip");if(a===e&&f&&f.options&&"object"==typeof f&&"object"==typeof f.options&&f.options.suppress)return arguments.length<2?d.attr(c,ca):(f&&f.options.content.attr===e&&f.cache.attr&&f.set("content.text",b),this.attr(ca,b))}return d.fn["attr"+ba].apply(this,arguments)},clone:function(a){var b=d.fn["clone"+ba].apply(this,arguments);return a||b.filter("["+ca+"]").attr("title",function(){return d.attr(this,ca)}).removeAttr(ca),b}},function(a,b){if(!b||d.fn[a+ba])return D;var c=d.fn[a+ba]=d.fn[a];d.fn[a]=function(){return b.apply(this,arguments)||c.apply(this,arguments)}}),d.ui||(d["cleanData"+ba]=d.cleanData,d.cleanData=function(a){for(var b,c=0;(b=d(a[c])).length;c++)if(b.attr(T))try{b.triggerHandler("removeqtip")}catch(e){}d["cleanData"+ba].apply(this,arguments)}),y.version="3.0.3",y.nextid=0,y.inactiveEvents=X,y.zindex=15e3,y.defaults={prerender:E,id:E,overwrite:D,suppress:D,content:{text:D,attr:"title",title:E,button:E},position:{my:"top left",at:"bottom right",target:E,container:E,viewport:E,adjust:{x:0,y:0,mouse:D,scroll:D,resize:D,method:"flipinvert flipinvert"},effect:function(a,b){d(this).animate(b,{duration:200,queue:E})}},show:{target:E,event:"mouseenter",effect:D,delay:90,solo:E,ready:E,autofocus:E},hide:{target:E,event:"mouseleave",effect:D,delay:0,fixed:E,inactive:E,leave:"window",distance:E},style:{classes:"",widget:E,width:E,height:E,def:D},events:{render:F,move:F,show:F,hide:F,toggle:F,visible:F,hidden:F,focus:F,blur:F}};var ia,ja,ma="margin",na="border",oa="color",pa="background-color",qa="transparent",ra=" !important",sa=!!b.createElement("canvas").getContext,ta=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,ua={},va=["Webkit","O","Moz","ms"];sa?(ka=a.devicePixelRatio||1,wa=function(){var a=b.createElement("canvas").getContext("2d");return a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||1}(),ja=ka/wa):ia=function(a,b,c){return"<qtipvml:"+a+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(b||"")+' style="behavior: url(#default#VML); '+(c||"")+'" />'},d.extend(v.prototype,{init:function(a){var b,c=this.element=a.elements.tip=d("<div />",{class:S+"-tip"}).prependTo(a.tooltip);sa?((b=d("<canvas />").appendTo(this.element)[0].getContext("2d")).lineJoin="miter",b.miterLimit=1e5,b.save()):(b=ia("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(b+b),a._bind(d("*",c).add(c),["click","mousedown"],function(a){a.stopPropagation()},this._ns)),a._bind(a.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(a){var b=this.qtip.elements.titlebar;return b&&(a.y===K||a.y===O&&this.element.position().top+this.size[1]/2+this.options.offset<b.outerHeight(D))},_parseCorner:function(a){var b=this.qtip.options.position.my;return a===E||b===E?a=E:a===D?a=new A(b.string()):a.string||((a=new A(a)).fixed=D),a},_parseWidth:function(a,e,c){var d=this.qtip.elements,e=na+s(e)+"Width";return(c?u(c,e):u(d.content,e)||u(this._useTitle(a)&&d.titlebar||d.content,e)||u(d.tooltip,e))||0},_parseRadius:function(a){var b=this.qtip.elements,c=na+s(a.y)+s(a.x)+"Radius";return!(da.ie<9)&&(u(this._useTitle(a)&&b.titlebar||b.content,c)||u(b.tooltip,c))||0},_invalidColour:function(a,d,c){d=a.css(d);return!d||c&&d===a.css(c)||ta.test(d)?E:d},_parseColours:function(h){var b=this.qtip.elements,c=this.element.css("cssText",""),e=na+s(h[h.precedance])+s(oa),f=this._useTitle(h)&&b.titlebar||b.content,g=this._invalidColour,h=[];return h[0]=g(c,pa)||g(f,pa)||g(b.content,pa)||g(b.tooltip,pa)||c.css(pa),h[1]=g(c,e,oa)||g(f,e,oa)||g(b.content,e,oa)||g(b.tooltip,e,oa)||b.tooltip.css(e),d("*",c).add(c).css("cssText",pa+":"+qa+ra+";"+na+":0"+ra+";"),h},_calculateSize:function(c){var e=c.precedance===H,f=this.options.width,d=this.options.height,h="c"===c.abbrev(),m=(e?f:d)*(h?.5:1),j=Math.pow,k=Math.round,c=Math.sqrt(j(m,2)+j(d,2)),m=[this.border/m*c,this.border/d*c];return m[2]=Math.sqrt(j(m[0],2)-j(this.border,2)),m[3]=Math.sqrt(j(m[1],2)-j(this.border,2)),d=[k((c=(c+m[2]+m[3]+(h?0:m[0]))/c)*f),k(c*d)],e?d:d.reverse()},_calculateTip:function(a,f,h){var d=(f=f||this.size)[0]*(h=h||1),e=f[1]*h,f=Math.ceil(d/2),h=Math.ceil(e/2),h={br:[0,0,d,e,d,0],bl:[0,0,d,0,0,e],tr:[0,e,d,0,d,e],tl:[0,0,0,e,d,e],tc:[0,e,f,0,d,e],bc:[0,0,d,0,f,e],rc:[0,0,d,h,0,e],lc:[d,0,d,e,0,h]};return h.lt=h.br,h.rt=h.bl,h.lb=h.tr,h.rb=h.tl,h[a.abbrev()]},_drawCoords:function(a,b){a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(b[2],b[3]),a.lineTo(b[4],b[5]),a.closePath()},create:function(){var a=this.corner=(sa||da.ie)&&this._parseCorner(this.options.corner);return this.enabled=!!this.corner&&"c"!==this.corner.abbrev(),this.enabled&&(this.qtip.cache.corner=a.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(b,c){if(!this.enabled)return this;var e,f,h,k,l,m=this.qtip.elements,j=this.element,o=j.children(),p=this.options,i=this.size,r=p.mimic,g=Math.round;b=b||(this.qtip.cache.corner||this.corner),r===E?r=b:((r=new A(r)).precedance=b.precedance,"inherit"===r.x?r.x=b.x:"inherit"===r.y?r.y=b.y:r.x===r.y&&(r[b.precedance]=b[b.precedance])),f=r.precedance,b.precedance===G?this._swapDimensions():this._resetDimensions(),(e=this.color=this._parseColours(b))[1]!==qa?(l=this.border=this._parseWidth(b,b[b.precedance]),p.border&&l<1&&!ta.test(e[1])&&(e[0]=e[1]),this.border=l=p.border!==D?p.border:l):this.border=l=0,k=this.size=this._calculateSize(b),j.css({width:k[0],height:k[1],lineHeight:k[1]+"px"}),j=b.precedance===H?[g(r.x===L?l:r.x===N?k[0]-i[0]-l:(k[0]-i[0])/2),g(r.y===K?k[1]-i[1]:0)]:[g(r.x===L?k[0]-i[0]:0),g(r.y===K?l:r.y===M?k[1]-i[1]-l:(k[1]-i[1])/2)],sa?((g=o[0].getContext("2d")).restore(),g.save(),g.clearRect(0,0,6e3,6e3),h=this._calculateTip(r,i,ja),i=this._calculateTip(r,this.size,ja),o.attr(I,k[0]*ja).attr(J,k[1]*ja),o.css(I,k[0]).css(J,k[1]),this._drawCoords(g,i),g.fillStyle=e[1],g.fill(),g.translate(j[0]*ja,j[1]*ja),this._drawCoords(g,h),g.fillStyle=e[0],g.fill()):(h="m"+(h=this._calculateTip(r))[0]+","+h[1]+" l"+h[2]+","+h[3]+" "+h[4]+","+h[5]+" xe",j[2]=l&&/^(r|b)/i.test(b.string())?8===da.ie?2:1:0,o.css({coordsize:k[0]+l+" "+k[1]+l,antialias:""+(-1<r.string().indexOf(O)),left:j[0]-j[2]*Number(f===G),top:j[1]-j[2]*Number(f===H),width:k[0]+l,height:k[1]+l}).each(function(a){var b=d(this);b[b.prop?"prop":"attr"]({coordsize:k[0]+l+" "+k[1]+l,path:h,fillcolor:e[0],filled:!!a,stroked:!a}).toggle(!(!l&&!a)),a||b.html(ia("stroke",'weight="'+2*l+'px" color="'+e[1]+'" miterlimit="1000" joinstyle="miter"'))})),a.opera&&setTimeout(function(){m.tip.css({display:"inline-block",visibility:"visible"})},1),c!==E&&this.calculate(b,k)},calculate:function(a,b){if(!this.enabled)return E;var c,e,f=this,g=this.qtip.elements,h=this.element,i=this.options.offset,j={};return a=a||this.corner,c=a.precedance,b=b||this._calculateSize(a),e=[a.x,a.y],c===G&&e.reverse(),d.each(e,function(d,e){var h,k,l;e===O?(j[h=c===H?L:K]="50%",j[ma+"-"+h]=-Math.round(b[c===H?0:1]/2)+i):(h=f._parseWidth(a,e,g.tooltip),k=f._parseWidth(a,e,g.content),l=f._parseRadius(a),j[e]=Math.max(-f.border,d?k:i+(h<l?l:-h)))}),j[a[c]]-=b[c===G?0:1],h.css({margin:"",top:"",bottom:"",left:"",right:""}).css(j),j},reposition:function(a,m,d){function e(a,b,c,d,e){a===Q&&j.precedance===b&&k[d]&&j[c]!==O?j.precedance=j.precedance===G?H:G:a!==Q&&k[d]&&(j[b]=j[b]===O?0<k[d]?d:e:j[b]===d?e:d)}function f(a,b,e){j[a]===O?p[ma+"-"+b]=o[a]=g[ma+"-"+b]-k[b]:(h=g[e]!==c?[k[b],-g[b]]:[-k[b],g[b]],(o[a]=Math.max(h[0],h[1]))>h[0]&&(d[b]-=k[b],o[b]=E),p[g[e]!==c?e:b]=o[a])}var g,h,i,j,k,n,o,p;this.enabled&&(i=m.cache,j=this.corner.clone(),k=d.adjusted,m=(n=m.options.position.adjust.method.split(" "))[0],n=n[1]||n[0],o={left:E,top:E,x:0,y:0},p={},this.corner.fixed!==D&&(e(m,G,H,L,N),e(n,H,G,K,M),j.string()===i.corner.string()&&i.cornerTop===k.top&&i.cornerLeft===k.left||this.update(j,E)),(g=this.calculate(j)).right!==c&&(g.left=-g.right),g.bottom!==c&&(g.top=-g.bottom),g.user=this.offset,o.left=m===Q&&!!k.left,o.left&&f(G,L,N),o.top=n===Q&&!!k.top,o.top&&f(H,K,M),this.element.css(p).toggle(!(o.x&&o.y||j.x===O&&o.y||j.y===O&&o.x)),d.left-=g.left.charAt?g.user:m!==Q||o.top||!o.left&&!o.top?g.left+this.border:0,d.top-=g.top.charAt?g.user:n!==Q||o.left||!o.left&&!o.top?g.top+this.border:0,i.cornerLeft=k.left,i.cornerTop=k.top,i.corner=j.clone())},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),(wa=R.tip=function(a){return new v(a,a.options.style.tip)}).initialize="render",wa.sanitize=function(a){var b;a.style&&"tip"in a.style&&("object"!=typeof(b=a.style.tip)&&(b=a.style.tip={corner:b}),/string|boolean/i.test(typeof b.corner)||(b.corner=D))},B.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(a){this.size=[a.width,a.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},d.extend(D,y.defaults,{style:{tip:{corner:D,mimic:E,width:6,height:6,border:D,offset:0}}});var wa,ya="qtip-modal",za="."+ya,xa=function(){function c(a){j.length<1&&a.length?a.not("body").blur():j.first().focus()}function e(i){var e,g;h.is(":visible")&&(e=d(i.target),g=f.tooltip,((i=e.closest(W)).length<1?E:parseInt(i[0].style.zIndex,10)>parseInt(g[0].style.zIndex,10))||e.closest(W)[0]===g[0]||c(e))}var f,g,h,i=this,j={};d.extend(i,{init:function(){return h=i.elem=d("<div />",{id:"qtip-overlay",html:"<div></div>",mousedown:function(){return E}}).hide(),d(b.body).bind("focusin"+za,e),d(b).bind("keydown"+za,function(a){f&&f.options.show.modal.escape&&27===a.keyCode&&f.hide(a)}),h.bind("click"+za,function(a){f&&f.options.show.modal.blur&&f.hide(a)}),i},update:function(b){j=(f=b).options.show.modal.stealfocus!==E?b.tooltip.find("*").filter(function(){return function(a){if(d.expr[":"].focusable)return d.expr[":"].focusable;var b,e,f=!isNaN(d.attr(a,"tabindex")),g=a.nodeName&&a.nodeName.toLowerCase();return"area"===g?(e=(b=a.parentNode).name,!(!a.href||!e||"map"!==b.nodeName.toLowerCase())&&(!!(e=d("img[usemap=#"+e+"]")[0])&&e.is(":visible"))):/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g&&a.href||f}(this)}):[]},toggle:function(a,e,j){var p=a.tooltip,l=a.options.show.modal,m=l.effect,n=e?"show":"hide",o=h.is(":visible"),p=d(za).filter(":visible:not(:animated)").not(p);return i.update(a),e&&l.stealfocus!==E&&c(d(":focus")),h.toggleClass("blurs",l.blur),e&&h.appendTo(b.body),h.is(":animated")&&o===e&&g!==E||!e&&p.length||(h.stop(D,E),d.isFunction(m)?m.call(h,e):m===E?h[n]():h.fadeTo(parseInt(j,10)||90,e?1:0,function(){e||h.hide()}),e||h.queue(function(a){h.css({left:"",top:""}),d(za).length||h.detach(),a()}),g=e,f.destroyed&&(f=F)),i}}),i.init()};xa=new xa,d.extend(w.prototype,{init:function(a){var b=a.tooltip;return this.options.on?(a.elements.overlay=xa.elem,b.addClass(ya).css("z-index",y.modal_zindex+d(za).length),a._bind(b,["tooltipshow","tooltiphide"],function(a,c,e){var f=a.originalEvent;if(a.target===b[0])if(f&&"tooltiphide"===a.type&&/mouse(leave|enter)/.test(f.type)&&d(f.relatedTarget).closest(xa.elem[0]).length)try{a.preventDefault()}catch(g){}else f&&"tooltipsolo"===f.type||this.toggle(a,"tooltipshow"===a.type,e)},this._ns,this),a._bind(b,"tooltipfocus",function(a,c){if(!a.isDefaultPrevented()&&a.target===b[0]){var e=d(za),f=y.modal_zindex+e.length,g=parseInt(b[0].style.zIndex,10);xa.elem[0].style.zIndex=f-1,e.each(function(){this.style.zIndex>g&&--this.style.zIndex}),e.filter("."+$).qtip("blur",a.originalEvent),b.addClass($)[0].style.zIndex=f,xa.update(c);try{a.preventDefault()}catch(h){}}},this._ns,this),void a._bind(b,"tooltiphide",function(a){a.target===b[0]&&d(za).filter(":visible").not(b).last().qtip("focus",a)},this._ns,this)):this},toggle:function(a,b,c){return a&&a.isDefaultPrevented()?this:void xa.toggle(this.qtip,!!b,c)},destroy:function(){this.qtip.tooltip.removeClass(ya),this.qtip._unbind(this.qtip.tooltip,this._ns),xa.toggle(this.qtip,E),delete this.qtip.elements.overlay}}),(wa=R.modal=function(a){return new w(a,a.options.show.modal)}).sanitize=function(a){a.show&&("object"!=typeof a.show.modal?a.show.modal={on:!!a.show.modal}:void 0===a.show.modal.on&&(a.show.modal.on=D))},y.modal_zindex=y.zindex-200,wa.initialize="render",B.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(0<this.qtip.tooltip[0].offsetWidth)}},d.extend(D,y.defaults,{show:{modal:{on:E,effect:D,blur:D,stealfocus:D,escape:D}}}),R.viewport=function(A,d,C,f,g,h,i){function j(a,b,c,e,f,g,h,C,j){var k=d[f],s=u[a],t=v[a],x=s===f?j:s===g?-j:-j/2,B=q[f]+r[f]-(n?0:m[f]),A=B-k,B=k+j-(h===I?o:p)-B,C=x-(u.precedance===a||s===u[b]?t===f?C:t===g?-C:-C/2:0)-(t===O?C/2:0);return c===Q?(C=(s===f?1:-1)*x,d[f]+=0<A?A:0<B?-B:0,d[f]=Math.max(-m[f]+r[f],k-C,Math.min(Math.max(-m[f]+r[f]+(h===I?o:p),k+C),d[f],"center"===s?k-x:1e9))):(e*="flipinvert"===c?2:0,0<A&&(s!==f||0<B)?(d[f]-=C+e,l.invert(a,f)):0<B&&(s!==g||0<A)&&(d[f]-=(s===O?-C:C)+e,l.invert(a,g)),d[f]<q[f]&&-d[f]>B&&(d[f]=k,l=u.clone())),d[f]-k}var l,m,n,o,p,q,r,s=C.target,k=A.elements.tooltip,u=C.my,v=C.at,w=C.adjust,B=w.method.split(" "),y=B[0],z=B[1]||B[0],A=C.viewport,B=C.container,C={left:0,top:0};return A.jquery&&s[0]!==a&&s[0]!==b.body&&"none"!==w.method?(m=B.offset()||C,n="static"===B.css("position"),k="fixed"===k.css("position"),o=A[0]===a?A.width():A.outerWidth(E),p=A[0]===a?A.height():A.outerHeight(E),q={left:k?0:A.scrollLeft(),top:k?0:A.scrollTop()},r=A.offset()||C,"shift"===y&&"shift"===z||(l=u.clone()),{left:"none"!==y?j(G,H,y,w.x,L,N,I,f,h):0,top:"none"!==z?j(H,G,z,w.y,K,M,J,g,i):0,my:l}):C},R.polys={polygon:function(a,b){for(var c,d,e,k,l,f={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:E},g=0,h=[],i=1,j=1,g=a.length;g--;)(c=[parseInt(a[--g],10),parseInt(a[g+1],10)])[0]>f.position.right&&(f.position.right=c[0]),c[0]<f.position.left&&(f.position.left=c[0]),c[1]>f.position.bottom&&(f.position.bottom=c[1]),c[1]<f.position.top&&(f.position.top=c[1]),h.push(c);if(d=f.width=Math.abs(f.position.right-f.position.left),e=f.height=Math.abs(f.position.bottom-f.position.top),"c"===b.abbrev())f.position={left:f.position.left+f.width/2,top:f.position.top+f.height/2};else{for(;0<d&&0<e&&0<i&&0<j;)for(d=Math.floor(d/2),e=Math.floor(e/2),b.x===L?i=d:b.x===N?i=f.width-d:i+=Math.floor(d/2),b.y===K?j=e:b.y===M?j=f.height-e:j+=Math.floor(e/2),g=h.length;g--&&!(h.length<2);)k=h[g][0]-f.position.left,l=h[g][1]-f.position.top,(b.x===L&&i<=k||b.x===N&&k<=i||b.x===O&&(k<i||k>f.width-i)||b.y===K&&j<=l||b.y===M&&l<=j||b.y===O&&(l<j||l>f.height-j))&&h.splice(g,1);f.position={left:h[0][0],top:h[0][1]}}return f},rect:function(a,b,c,d){return{width:Math.abs(c-a),height:Math.abs(d-b),position:{left:Math.min(a,c),top:Math.min(b,d)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(a,b,c,d,g){var h=R.polys._angles[g.abbrev()],g=0===h?0:c*Math.cos(h*Math.PI),h=d*Math.sin(h*Math.PI);return{width:2*c-Math.abs(g),height:2*d-Math.abs(h),position:{left:a+g,top:b+h},adjustable:E}},circle:function(a,b,c,d){return R.polys.ellipse(a,b,c,c,d)}},R.svg=function(f,h,e){for(var i,j,k,l,m,n,o=h[0],p=d(o.ownerSVGElement),q=o.ownerDocument,r=(parseInt(h.css("stroke-width"),10)||0)/2;!o.getBBox;)o=o.parentNode;if(!o.getBBox||!o.parentNode)return E;switch(o.nodeName){case"ellipse":case"circle":m=R.polys.ellipse(o.cx.baseVal.value,o.cy.baseVal.value,(o.rx||o.r).baseVal.value+r,(o.ry||o.r).baseVal.value+r,e);break;case"line":case"polygon":case"polyline":for(m=[],k=-1,i=(l=o.points||[{x:o.x1.baseVal.value,y:o.y1.baseVal.value},{x:o.x2.baseVal.value,y:o.y2.baseVal.value}]).numberOfItems||l.length;++k<i;)j=l.getItem?l.getItem(k):l[k],m.push.apply(m,[j.x,j.y]);m=R.polys.polygon(m,e);break;default:m={width:(m=o.getBBox()).width,height:m.height,position:{left:m.x,top:m.y}}}return n=m.position,(p=p[0]).createSVGPoint&&(h=o.getScreenCTM(),(l=p.createSVGPoint()).x=n.left,l.y=n.top,h=l.matrixTransform(h),n.left=h.x,n.top=h.y),q!==b&&"mouse"!==f.position.target&&((f=d((q.defaultView||q.parentWindow).frameElement).offset())&&(n.left+=f.left,n.top+=f.top)),q=d(q),n.left+=q.scrollLeft(),n.top+=q.scrollTop(),m},R.imagemap=function(a,b,e){var f,g,h,i,j=((b=!b.jquery?d(b):b).attr("shape")||"rect").toLowerCase().replace("poly","polygon"),k=d('img[usemap="#'+b.parent("map").attr("name")+'"]'),m=d.trim(b.attr("coords")).replace(/,$/,"").split(",");if(!k.length)return E;if("polygon"===j)h=R.polys.polygon(m,e);else{if(!R.polys[j])return E;for(g=-1,i=m.length,f=[];++g<i;)f.push(parseInt(m[g],10));h=R.polys[j].apply(this,f.concat(e))}return(e=k.offset()).left+=Math.ceil((k.outerWidth(E)-k.width())/2),e.top+=Math.ceil((k.outerHeight(E)-k.height())/2),h.position.left+=e.left,h.position.top+=e.top,h};var Aa;d.extend(x.prototype,{_scroll:function(){var b=this.qtip.elements.overlay;b&&(b[0].style.top=d(a).scrollTop()+"px")},init:function(c){var e=c.tooltip;d("select, object").length<1&&(this.bgiframe=c.elements.bgiframe=d('<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>').appendTo(e),c._bind(e,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=d("<div/>",{id:S+"-rcontainer"}).appendTo(b.body),c.elements.overlay&&c.elements.overlay.addClass("qtipmodal-ie6fix")&&(c._bind(a,["scroll","resize"],this._scroll,this._ns,this),c._bind(e,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var b=this.qtip.tooltip,d={height:b.outerHeight(E),width:b.outerWidth(E)},a=this.qtip.plugins.tip,f=this.qtip.elements.tip,b=parseInt(b.css("borderLeftWidth"),10)||0;b={left:-b,top:-b},a&&f&&(b[(a="x"===a.corner.precedance?[I,L]:[J,K])[1]]-=f[a[0]]()),this.bgiframe.css(b).css(d)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var b,c,d,e=this.qtip.tooltip,a=this.qtip.options.style,g=this.qtip.options.position.container;return this.qtip.drawing=1,a.height&&e.css(J,a.height),a.width?e.css(I,a.width):(e.css(I,"").appendTo(this.redrawContainer),(b=e.width())%2<1&&(b+=1),a=-1<((c=e.css("maxWidth")||"")+(d=e.css("minWidth")||"")).indexOf("%")?g.width()/100:0,b=(c=(-1<c.indexOf("%")?a:+parseInt(c,10))||b)+(d=(-1<d.indexOf("%")?a:+parseInt(d,10))||0)?Math.min(Math.max(b,d),c):b,e.css(I,Math.round(b)).appendTo(g)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([a,this.qtip.tooltip],this._ns)}}),(Aa=R.ie6=function(a){return 6===da.ie?new x(a):E}).initialize="render",B.ie6={"^content|style$":function(){this.redraw()}}})}(window,document),function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){function f(e){var n=Array.isArray(e.from)?e.from:e.from?[e.from]:[t.WILDCARD];s[e.name]=s[e.name]||{};for(var r=0;r<n.length;r++)c[n[r]]=c[n[r]]||[],c[n[r]].push(e.name),s[e.name][n[r]]=e.to||n[r];e.to&&(c[e.to]=c[e.to]||[])}var r="string"==typeof e.initial?{state:e.initial}:e.initial,i=e.terminal||e.final,a=n||e.target||{},o=e.events||[],u=e.callbacks||{},s={},c={};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var v,l=0;l<o.length;l++)f(o[l]);for(v in s)s.hasOwnProperty(v)&&(a[v]=t.buildEvent(v,s[v]));for(v in u)u.hasOwnProperty(v)&&(a[v]=u[v]);return a.current="none",a.is=function(t){return Array.isArray(t)?0<=t.indexOf(this.current):this.current===t},a.can=function(e){return!this.transition&&void 0!==s[e]&&(s[e].hasOwnProperty(this.current)||s[e].hasOwnProperty(t.WILDCARD))},a.cannot=function(t){return!this.can(t)},a.transitions=function(){return(c[this.current]||[]).concat(c[t.WILDCARD]||[])},a.isFinished=function(){return this.is(i)},a.error=e.error||function(t,e,n,r,i,a,o){throw o||a},a.states=function(){return Object.keys(c).sort()},r&&!r.defer&&a[r.event](),a},doCallback:function(e,n,r,i,a,o){if(n)try{return n.apply(e,[r,i,a].concat(o))}catch(n){return e.error(r,i,a,o,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",n)}},beforeAnyEvent:function(e,n,r,i,a){return t.doCallback(e,e.onbeforeevent,n,r,i,a)},afterAnyEvent:function(e,n,r,i,a){return t.doCallback(e,e.onafterevent||e.onevent,n,r,i,a)},leaveAnyState:function(e,n,r,i,a){return t.doCallback(e,e.onleavestate,n,r,i,a)},enterAnyState:function(e,n,r,i,a){return t.doCallback(e,e.onenterstate||e.onstate,n,r,i,a)},changeState:function(e,n,r,i,a){return t.doCallback(e,e.onchangestate,n,r,i,a)},beforeThisEvent:function(e,n,r,i,a){return t.doCallback(e,e["onbefore"+n],n,r,i,a)},afterThisEvent:function(e,n,r,i,a){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,r,i,a)},leaveThisState:function(e,n,r,i,a){return t.doCallback(e,e["onleave"+r],n,r,i,a)},enterThisState:function(e,n,r,i,a){return t.doCallback(e,e["onenter"+i]||e["on"+i],n,r,i,a)},beforeEvent:function(e,n,r,i,a){if(!1===t.beforeThisEvent(e,n,r,i,a)||!1===t.beforeAnyEvent(e,n,r,i,a))return!1},afterEvent:function(e,n,r,i,a){t.afterThisEvent(e,n,r,i,a),t.afterAnyEvent(e,n,r,i,a)},leaveState:function(e,n,r,i,u){var o=t.leaveThisState(e,n,r,i,u),u=t.leaveAnyState(e,n,r,i,u);return!1!==o&&!1!==u&&(t.ASYNC===o||t.ASYNC===u?t.ASYNC:void 0)},enterState:function(e,n,r,i,a){t.enterThisState(e,n,r,i,a),t.enterAnyState(e,n,r,i,a)},buildEvent:function(e,n){return function(){var r=this.current,i=n[r]||(n[t.WILDCARD]!=t.WILDCARD?n[t.WILDCARD]:r)||r,a=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,i,a,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,i,a,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,r,i,a))return t.Result.CANCELLED;if(r===i)return t.afterEvent(this,e,r,i,a),t.Result.NOTRANSITION;var o=this;this.transition=function(){return o.transition=null,o.current=i,t.enterState(o,e,r,i,a),t.changeState(o,e,r,i,a),t.afterEvent(o,e,r,i,a),t.Result.SUCCEEDED},this.transition.cancel=function(){o.transition=null,t.afterEvent(o,e,r,i,a)};var u=t.leaveState(this,e,r,i,a);return!1===u?(this.transition=null,t.Result.CANCELLED):t.ASYNC===u?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=t:exports).StateMachine=t:"function"==typeof define&&define.amd?define(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}(),function(V){"use strict";function o(){}function $(e){return e}var H=function(n,r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(r.apply(null,e))}},q=function(e){return function(){return e}};function d(r){for(var o=[],e=1;e<arguments.length;e++)o[e-1]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=o.concat(e);return r.apply(null,n)}}function y(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,e)}}function N(n){function t(){return o}function r(e){return e(n)}var e=q(n),o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:C,isNone:b,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return N(e(n))},each:function(e){e(n)},bind:r,exists:r,forall:r,filter:function(e){return e(n)?o:w},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(b,function(e){return t(n,e)})}};return o}function K(e,t){for(var n=[],r=[],o=0,i=e.length;o<i;o++){var a=e[o];(t(a,o)?n:r).push(a)}return{pass:n,fail:r}}function J(e,t){for(var n=0,r=e.length;n<r;++n)if(!0!==t(e[n],n))return!1;return!0}function Q(e,t){return U(e,function(e){return!F(t,e)})}function Z(e){return 0===e.length?_.none():_.some(e[0])}function ee(e){return 0===e.length?_.none():_.some(e[e.length-1])}function ie(){return oe.getOrDie("URL")}var i,b=q(!1),C=q(!0),tE=function(){return w},w=(c=function(e){return e.isNone()},l={fold:function(e,t){return e()},is:b,isSome:b,isNone:C,getOr:jN=function(e){return e},getOrThunk:RN=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:q(null),getOrUndefined:q(void 0),or:jN,orThunk:RN,map:tE,each:o,bind:tE,exists:b,forall:C,filter:tE,equals:c,equals_:c,toArray:function(){return[]},toString:q("none()")},Object.freeze&&Object.freeze(l),l),_={some:N,none:tE,from:function(e){return null==e?w:N(e)}},KN=function(t){return function(e){return function(e){if(null===e)return"null";var t=typeof e;return"object"==t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t}(e)===t}},S=KN("string"),T=KN("object"),k=KN("array"),A=KN("null"),R=KN("boolean"),D=KN("function"),O=KN("number"),B=Array.prototype.slice,P=Array.prototype.indexOf,I=Array.prototype.push,L=function(e,t){return P.call(e,t)},F=function(e,t){return-1<L(e,t)},M=function(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n],n))return!0;return!1},W=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},z=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},U=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},j=function(e,t,n){return z(e,function(e){n=t(n,e)}),n},X=function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(t(o,n))return _.some(o)}return _.none()},Y=function(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n],n))return _.some(n);return _.none()},G=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!k(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);I.apply(t,e[n])}return t}(W(e,t))},te=D(Array.from)?Array.from:function(e){return B.call(e)},ne=void 0!==V.window?V.window:Function("return this;")(),oe={getOrDie:function(e,n){n=function(e,t){return function(e,t){for(var n=null!=t?t:ne,r=0;r<e.length&&null!=n;++r)n=n[e[r]];return n}(e.split("."),t)}(e,n);if(null==n)throw new Error(e+" not available on this browser");return n}},ae_createObjectURL=function(e){return ie().createObjectURL(e)},ae_revokeObjectURL=function(e){ie().revokeObjectURL(e)},LN=V.navigator,oE=LN.userAgent,Cp=function(e){return"matchMedia"in V.window&&V.matchMedia(e).matches},QN=/Android/.test(oE),MN=(MN=!(i=/WebKit/.test(oE))&&/MSIE/gi.test(oE)&&/Explorer/gi.test(LN.appName))&&/MSIE (\w+)\./.exec(oE)[1],jN=-1!==oE.indexOf("Trident/")&&(-1!==oE.indexOf("rv:")||-1!==LN.appName.indexOf("Netscape"))&&11,RN=-1!==oE.indexOf("Edge/")&&!MN&&!jN&&12;MN=MN||jN||RN;function me(e,t){return"number"!=typeof t&&(t=0),setTimeout(e,t)}function ge(e,t){return"number"!=typeof t&&(t=1),setInterval(e,t)}function Ne(e,a){var n,u,o=a||{};for(n in e)ye[n]||(o[n]=e[n]);return o.target||(o.target=o.srcElement||V.document),fe.experimentalShadowDom&&(o.target=function(n,t){if(n.composedPath){n=n.composedPath();if(n&&0<n.length)return n[0]}return t}(e,o.target)),e&&ve.test(e.type)&&void 0===e.pageX&&void 0!==e.clientX&&(a=(u=o.target.ownerDocument||V.document).documentElement,u=u.body,o.pageX=e.clientX+(a&&a.scrollLeft||u&&u.scrollLeft||0)-(a&&a.clientLeft||u&&u.clientLeft||0),o.pageY=e.clientY+(a&&a.scrollTop||u&&u.scrollTop||0)-(a&&a.clientTop||u&&u.clientTop||0)),o.preventDefault=function(){o.isDefaultPrevented=Ce,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},o.stopPropagation=function(){o.isPropagationStopped=Ce,e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)},!(o.stopImmediatePropagation=function(){o.isImmediatePropagationStopped=Ce,o.stopPropagation()})==(o.isDefaultPrevented===Ce||o.isDefaultPrevented===be)&&(o.isDefaultPrevented=be,o.isPropagationStopped=be,o.isImmediatePropagationStopped=be),void 0===o.metaKey&&(o.metaKey=!1),o}function Se(){var y=this,b={},g="mce-data-"+(+new Date).toString(32),h="onmouseenter"in V.document.documentElement,p="onfocusin"in V.document.documentElement,v={mouseenter:"mouseover",mouseleave:"mouseout"},m=1;function C(e,a){var n,r,o,i,a=b[a];if(n=a&&a[e.type])for(r=0,o=n.length;r<o;r++)if((i=n[r])&&!1===i.func.call(i.scope,e)&&e.preventDefault(),e.isImmediatePropagationStopped())return}y.domLoaded=!1,y.events=b,y.bind=function(e,t,n,r){function d(e){C(Ne(e||f.event),o)}var o,i,a,u,s,c,l,f=V.window;if(e&&3!==e.nodeType&&8!==e.nodeType){for(e[g]?o=e[g]:(o=m++,e[g]=o,b[o]={}),r=r||e,a=(t=t.split(" ")).length;a--;)c=d,s=l=!1,"DOMContentLoaded"===(u=t[a])&&(u="ready"),y.domLoaded&&"ready"===u&&"complete"===e.readyState?n.call(r,Ne({type:u})):(h||(s=v[u])&&(c=function(e){var n,t=e.currentTarget;if((n=e.relatedTarget)&&t.contains)n=t.contains(n);else for(;n&&n!==t;)n=n.parentNode;n||((e=Ne(e||f.event)).type="mouseout"===e.type?"mouseleave":"mouseenter",e.target=t,C(e,o))}),p||"focusin"!==u&&"focusout"!==u||(l=!0,s="focusin"===u?"focus":"blur",c=function(e){(e=Ne(e||f.event)).type="focus"===e.type?"focusin":"focusout",C(e,o)}),(i=b[o][u])?"ready"===u&&y.domLoaded?n({type:u}):i.push({func:n,scope:r}):(b[o][u]=i=[{func:n,scope:r}],i.fakeName=s,i.capture=l,i.nativeHandler=c,"ready"===u?function(e,t,n){var i,a,u,s,r=e.document,o={type:"ready"};n.domLoaded?t(o):(i=function(){return"complete"===r.readyState||"interactive"===r.readyState&&r.body},a=function(){n.domLoaded||(n.domLoaded=!0,t(o))},u=function(){i()&&(we(r,"readystatechange",u),a())},s=function(){try{r.documentElement.doScroll("left")}catch(e){return void he.setTimeout(s)}a()},!r.addEventListener||fe.ie&&fe.ie<11?(xe(r,"readystatechange",u),r.documentElement.doScroll&&e.self===e.top&&s()):i()?a():xe(e,"DOMContentLoaded",a),xe(e,"load",a))}(e,c,y):xe(e,s||u,c,l)));return e=i=0,n}},y.unbind=function(e,t,n){var r,o,i,a,u,s,c,l,f;if(!e||3===e.nodeType||8===e.nodeType)return y;if(r=e[g]){if(s=b[r],t){for(i=(t=t.split(" ")).length;i--;)if(o=s[u=t[i]]){if(n)for(a=o.length;a--;)o[a].func===n&&(c=o.nativeHandler,l=o.fakeName,f=o.capture,(o=o.slice(0,a).concat(o.slice(a+1))).nativeHandler=c,o.fakeName=l,o.capture=f,s[u]=o);n&&0!==o.length||(delete s[u],we(e,o.fakeName||u,o.nativeHandler,o.capture))}}else{for(u in s)o=s[u],we(e,o.fakeName||u,o.nativeHandler,o.capture);s={}}for(u in s)return y;delete b[r];try{delete e[g]}catch(d){e[g]=null}}return y},y.fire=function(e,t,n){var r;if(!e||3===e.nodeType||8===e.nodeType)return y;for((n=Ne(null,n)).type=t,n.target=e;(r=e[g])&&C(n,r),(e=e.parentNode||e.ownerDocument||e.defaultView||e.parentWindow)&&!n.isPropagationStopped(););return y},y.clean=function(e){var t,n,r=y.unbind;if(!e||3===e.nodeType||8===e.nodeType)return y;if(e[g]&&r(e),(e=!e.getElementsByTagName?e.document:e)&&e.getElementsByTagName)for(r(e),t=(n=e.getElementsByTagName("*")).length;t--;)(e=n[t])[g]&&r(e);return y},y.destroy=function(){b={}},y.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}}var le,c=!i&&!jN&&/Gecko/.test(oE),l=-1!==oE.indexOf("Mac"),tE=/(iPad|iPhone)/.test(oE),KN="FormData"in V.window&&"FileReader"in V.window&&"URL"in V.window&&!!ae_createObjectURL,LN=Cp("only screen and (max-device-width: 480px)")&&(QN||tE),jN=Cp("only screen and (min-width: 800px)")&&(QN||tE),Cp=-1!==oE.indexOf("Windows Phone"),fe={opera:!1,webkit:i=RN?!1:i,ie:MN,gecko:c,mac:l,iOS:tE,android:QN,contentEditable:!tE||KN||534<=parseInt(oE.match(/AppleWebKit\/(\d*)/)[1],10),transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!==MN,range:V.window.getSelection&&"Range"in V.window,documentMode:MN&&!RN?V.document.documentMode||7:10,fileApi:KN,ceFalse:!1===MN||8<MN,cacheSuffix:null,container:null,overrideViewPort:null,experimentalShadowDom:!1,canHaveCSP:!1===MN||11<MN,desktop:!LN&&!jN,windowsPhone:Cp},de=window.Promise||function(){function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],l(e,r(o,this),r(u,this))}var e=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t=i.immediateFn||"function"==typeof setImmediate&&setImmediate||function(e){setTimeout(e,1)};function a(r){var o=this;null!==this._state?t(function(){var t,e=o._state?r.onFulfilled:r.onRejected;if(null!==e){try{t=e(o._value)}catch(n){return void r.reject(n)}r.resolve(t)}else(o._state?r.resolve:r.reject)(o._value)}):this._deferreds.push(r)}function o(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void l(r(t,e),r(o,this),r(u,this))}this._state=!0,this._value=e,s.call(this)}catch(n){u.call(this,n)}}function u(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,t=this._deferreds.length;e<t;e++)a.call(this,this._deferreds[e]);this._deferreds=null}function c(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function l(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(o){if(r)return;r=!0,n(o)}}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(n,r){var o=this;return new i(function(e,t){a.call(o,new c(n,r,e,t))})},i.all=function(){var s=Array.prototype.slice.call(1===arguments.length&&e(arguments[0])?arguments[0]:arguments);return new i(function(o,i){if(0===s.length)return o([]);var a=s.length;for(var e=0;e<s.length;e++)!function u(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return n.call(e,function(e){u(t,e)},i),0}s[t]=e,0==--a&&o(s)}catch(r){i(r)}}(e,s[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(o){return new i(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},i}(),QN=function(t,n){var r,e;return(e=function(){var e=arguments;clearTimeout(r),r=me(function(){t.apply(this,e)},n)}).stop=function(){clearTimeout(r)},e},he={requestAnimationFrame:function(e,t){le?le.then(e):le=new de(function(e){(function(e,t){for(var r=V.window.requestAnimationFrame,o=["ms","moz","webkit"],n=0;n<o.length&&!r;n++)r=V.window[o[n]+"RequestAnimationFrame"];(r=r||function(e){V.window.setTimeout(e,0)})(e,t)})(e,t=t||V.document.body)}).then(e)},setTimeout:me,setInterval:ge,setEditorTimeout:function(e,t,n){return me(function(){e.removed||t()},n)},setEditorInterval:function(e,t,n){var r;return r=ge(function(){e.removed?clearInterval(r):t()},n)},debounce:QN,throttle:QN,clearInterval:function(e){return clearInterval(e)},clearTimeout:function(e){return clearTimeout(e)}},ve=/^(?:mouse|contextmenu)|click/,ye={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1},be=function(){return!1},Ce=function(){return!0},xe=function(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n)},we=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n)};(Se.Event=new Se).bind(V.window,"ready",function(){});function Et(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(65536+r):String.fromCharCode(r>>10|55296,1023&r|56320)}var Te,ke,_e,Ae,Re,De,Oe,Be,Pe,Ie,Le,Fe,Me,ze,Ue,je,Ve,He,qe="sizzle"+-new Date,$e=V.window.document,We=0,Ke=0,Xe=Tt(),Ye=Tt(),Ge=Tt(),Je=function(e,t){return e===t&&(Le=!0),0},Qe="undefined",Ze={}.hasOwnProperty,tE=[],tt=tE.pop,nt=tE.push,rt=tE.push,ot=tE.slice,it=tE.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1},at="[\\x20\\t\\r\\n\\f]",oE="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",RN="\\["+at+"*("+oE+")(?:"+at+"*([*^$|!~]?=)"+at+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+oE+"))|)"+at+"*\\]",KN=":("+oE+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+RN+")*)|.*)\\)|)",lt=new RegExp("^"+at+"+|((?:^|[^\\\\])(?:\\\\.)*)"+at+"+$","g"),ft=new RegExp("^"+at+"*,"+at+"*"),dt=new RegExp("^"+at+"*([>+~]|"+at+")"+at+"*"),mt=new RegExp("="+at+"*([^\\]'\"]*?)"+at+"*\\]","g"),gt=new RegExp(KN),pt=new RegExp("^"+oE+"$"),ht={ID:new RegExp("^#("+oE+")"),CLASS:new RegExp("^\\.("+oE+")"),TAG:new RegExp("^("+oE+"|[*])"),ATTR:new RegExp("^"+RN),PSEUDO:new RegExp("^"+KN),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+at+"*(even|odd|(([+-]|)(\\d*)n|)"+at+"*(?:([+-]|)"+at+"*(\\d+)|))"+at+"*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^"+at+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+at+"*((?:-\\d)?\\d*)"+at+"*\\)|)(?=[^-]|$)","i")},vt=/^(?:input|select|textarea|button)$/i,yt=/^h\d$/i,bt=/^[^{]+\{\s*\[native \w/,Ct=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,xt=/[+~]/,wt=/'|\\/g,Nt=new RegExp("\\\\([\\da-f]{1,6}"+at+"?|("+at+")|.)","ig");try{rt.apply(tE=ot.call($e.childNodes),$e.childNodes),tE[$e.childNodes.length].nodeType}catch(iE){rt={apply:tE.length?function(e,t){nt.apply(e,ot.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}var St=function(e,t,n,r){var u,s,c,l,f,d,m;if((t?t.ownerDocument||t:$e)!==Me&&Fe(t),n=n||[],!e||"string"!=typeof e)return n;if(1!==(u=(t=t||Me).nodeType)&&9!==u)return[];if(Ue&&!r){if(d=Ct.exec(e))if(m=d[1]){if(9===u){if(!(l=t.getElementById(m))||!l.parentNode)return n;if(l.id===m)return n.push(l),n}else if(t.ownerDocument&&(l=t.ownerDocument.getElementById(m))&&He(t,l)&&l.id===m)return n.push(l),n}else{if(d[2])return rt.apply(n,t.getElementsByTagName(e)),n;if((m=d[3])&&ke.getElementsByClassName)return rt.apply(n,t.getElementsByClassName(m)),n}if(ke.qsa&&(!je||!je.test(e))){if(f=l=qe,d=t,m=9===u&&e,1===u&&"object"!==t.nodeName.toLowerCase()){for(c=De(e),(l=t.getAttribute("id"))?f=l.replace(wt,"\\$&"):t.setAttribute("id",f),f="[id='"+f+"'] ",s=c.length;s--;)c[s]=f+Pt(c[s]);d=xt.test(e)&&Ot(t.parentNode)||t,m=c.join(",")}if(m)try{return rt.apply(n,d.querySelectorAll(m)),n}catch(g){}finally{l||t.removeAttribute("id")}}}return Be(e.replace(lt,"$1"),t,n,r)};function Tt(){var r=[];return function e(t,n){return r.push(t+" ")>_e.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function kt(e){return e[qe]=!0,e}function _t(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||1<<31)-(~e.sourceIndex||1<<31);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function Dt(a){return kt(function(i){return i=+i,kt(function(e,t){for(var n,r=a([],e.length,i),o=r.length;o--;)e[n=r[o]]&&(e[n]=!(t[n]=e[n]))})})}function Ot(e){return e&&typeof e.getElementsByTagName!==Qe&&e}for(Te in ke=St.support={},Re=St.isXML=function(t){t=t&&(t.ownerDocument||t).documentElement;return!!t&&"HTML"!==t.nodeName},Fe=St.setDocument=function(t){var s=t?t.ownerDocument||t:$e,t=s.defaultView;return s!==Me&&9===s.nodeType&&s.documentElement?(ze=(Me=s).documentElement,Ue=!Re(s),t&&t!==function(e){try{return e.top}catch(t){}return null}(t)&&(t.addEventListener?t.addEventListener("unload",function(){Fe()},!1):t.attachEvent&&t.attachEvent("onunload",function(){Fe()})),ke.attributes=!0,ke.getElementsByTagName=!0,ke.getElementsByClassName=bt.test(s.getElementsByClassName),ke.getById=!0,_e.find.ID=function(n,t){if(typeof t.getElementById!==Qe&&Ue){n=t.getElementById(n);return n&&n.parentNode?[n]:[]}},_e.filter.ID=function(e){var t=e.replace(Nt,Et);return function(e){return e.getAttribute("id")===t}},_e.find.TAG=ke.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==Qe)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],o=0,i=t.getElementsByTagName(e);if("*"!==e)return i;for(;n=i[o++];)1===n.nodeType&&r.push(n);return r},_e.find.CLASS=ke.getElementsByClassName&&function(e,t){if(Ue)return t.getElementsByClassName(e)},Ve=[],je=[],ke.disconnectedMatch=!0,je=je.length&&new RegExp(je.join("|")),Ve=Ve.length&&new RegExp(Ve.join("|")),t=bt.test(ze.compareDocumentPosition),He=t||bt.test(ze.contains)?function(e,r){var n=9===e.nodeType?e.documentElement:e,r=r&&r.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},Je=t?function(e,t){return e===t?(Le=!0,0):(n=!e.compareDocumentPosition-!t.compareDocumentPosition)||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!ke.sortDetached&&t.compareDocumentPosition(e)===n?e===s||e.ownerDocument===$e&&He($e,e)?-1:t===s||t.ownerDocument===$e&&He($e,t)?1:Ie?it.call(Ie,e)-it.call(Ie,t):0:4&n?-1:1);var n}:function(e,t){if(e===t)return Le=!0,0;var n,r=0,o=e.parentNode,i=t.parentNode,a=[e],u=[t];if(!o||!i)return e===s?-1:t===s?1:o?-1:i?1:Ie?it.call(Ie,e)-it.call(Ie,t):0;if(o===i)return _t(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;a[r]===u[r];)r++;return r?_t(a[r],u[r]):a[r]===$e?-1:u[r]===$e?1:0},s):Me},St.matches=function(e,t){return St(e,null,null,t)},St.matchesSelector=function(e,t){if((e.ownerDocument||e)!==Me&&Fe(e),t=t.replace(mt,"='$1']"),ke.matchesSelector&&Ue&&(!Ve||!Ve.test(t))&&(!je||!je.test(t)))try{var n=(void 0).call(e,t);if(n||ke.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(iE){}return 0<St(t,Me,null,[e]).length},St.contains=function(e,t){return(e.ownerDocument||e)!==Me&&Fe(e),He(e,t)},St.attr=function(e,t){(e.ownerDocument||e)!==Me&&Fe(e);var r=_e.attrHandle[t.toLowerCase()],r=r&&Ze.call(_e.attrHandle,t.toLowerCase())?r(e,t,!Ue):void 0;return void 0!==r?r:ke.attributes||!Ue?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},St.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},St.uniqueSort=function(e){var t,n=[],r=0,o=0;if(Le=!ke.detectDuplicates,Ie=!ke.sortStable&&e.slice(0),e.sort(Je),Le){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)e.splice(n[r],1)}return Ie=null,e},Ae=St.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=Ae(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=Ae(t);return n},(_e=St.selectors={cacheLength:50,createPseudo:kt,match:ht,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Nt,Et),e[3]=(e[3]||e[4]||e[5]||"").replace(Nt,Et),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||St.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&St.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return ht.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&gt.test(n)&&(t=De(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Nt,Et).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=Xe[e+" "];return t||(t=new RegExp("(^|"+at+")"+e+"("+at+"|$)"))&&Xe(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Qe&&e.getAttribute("class")||"")})},ATTR:function(n,r,o){return function(t){t=St.attr(t,n);return null==t?"!="===r:!r||(t+="","="===r?t===o:"!="===r?t!==o:"^="===r?o&&0===t.indexOf(o):"*="===r?o&&-1<t.indexOf(o):"$="===r?o&&t.slice(-o.length)===o:"~="===r?-1<(" "+t+" ").indexOf(o):"|="===r&&(t===o||t.slice(0,o.length+1)===o+"-"))}},CHILD:function(m,e,t,g,p){var h="nth"!==m.slice(0,3),v="last"!==m.slice(-4),y="of-type"===e;return 1===g&&0===p?function(e){return!!e.parentNode}:function(e,t,n){var r,o,i,a,u,s,c=h!=v?"nextSibling":"previousSibling",l=e.parentNode,f=y&&e.nodeName.toLowerCase(),d=!n&&!y;if(l){if(h){for(;c;){for(i=e;i=i[c];)if(y?i.nodeName.toLowerCase()===f:1===i.nodeType)return!1;s=c="only"===m&&!s&&"nextSibling"}return!0}if(s=[v?l.firstChild:l.lastChild],v&&d){for(u=(r=(o=l[qe]||(l[qe]={}))[m]||[])[0]===We&&r[1],a=r[0]===We&&r[2],i=u&&l.childNodes[u];i=++u&&i&&i[c]||(a=u=0)||s.pop();)if(1===i.nodeType&&++a&&i===e){o[m]=[We,u,a];break}}else if(d&&(r=(e[qe]||(e[qe]={}))[m])&&r[0]===We)a=r[1];else for(;(i=++u&&i&&i[c]||(a=u=0)||s.pop())&&((y?i.nodeName.toLowerCase()!==f:1!==i.nodeType)||!++a||(d&&((i[qe]||(i[qe]={}))[m]=[We,a]),i!==e)););return(a-=p)===g||a%g==0&&0<=a/g}}},PSEUDO:function(e,i){var t,a=_e.pseudos[e]||_e.setFilters[e.toLowerCase()]||St.error("unsupported pseudo: "+e);return a[qe]?a(i):1<a.length?(t=[e,e,"",i],_e.setFilters.hasOwnProperty(e.toLowerCase())?kt(function(e,t){for(var n,r=a(e,i),o=r.length;o--;)e[n=it.call(e,r[o])]=!(t[n]=r[o])}):function(e){return a(e,0,t)}):a}},pseudos:{not:kt(function(e){var r=[],o=[],u=Oe(e.replace(lt,"$1"));return u[qe]?kt(function(e,t,n,r){for(var o,i=u(e,null,r,[]),a=e.length;a--;)(o=i[a])&&(e[a]=!(t[a]=o))}):function(e,t,n){return r[0]=e,u(r,null,n,o),!o.pop()}}),has:kt(function(t){return function(e){return 0<St(t,e).length}}),contains:kt(function(t){return t=t.replace(Nt,Et),function(e){return-1<(e.textContent||e.innerText||Ae(e)).indexOf(t)}}),lang:kt(function(n){return pt.test(n||"")||St.error("unsupported lang: "+n),n=n.replace(Nt,Et).toLowerCase(),function(e){var t;do{if(t=Ue?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=V.window.location&&V.window.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===ze},focus:function(e){return e===Me.activeElement&&(!Me.hasFocus||Me.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_e.pseudos.empty(e)},header:function(e){return yt.test(e.nodeName)},input:function(e){return vt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(t){return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(t=t.getAttribute("type"))||"text"===t.toLowerCase())},first:Dt(function(){return[0]}),last:Dt(function(e,t){return[t-1]}),eq:Dt(function(e,t,n){return[n<0?n+t:n]}),even:Dt(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:Dt(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:Dt(function(e,t,n){for(var r=n<0?n+t:n;0<=--r;)e.push(r);return e}),gt:Dt(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=_e.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_e.pseudos[Te]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(Te);for(Te in{submit:!0,reset:!0})_e.pseudos[Te]=function(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}(Te);function Bt(){}function Pt(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function It(a,e,t){var u=e.dir,s=t&&"parentNode"===u,c=Ke++;return e.first?function(e,t,n){for(;e=e[u];)if(1===e.nodeType||s)return a(e,t,n)}:function(e,t,n){var r,o,i=[We,c];if(n){for(;e=e[u];)if((1===e.nodeType||s)&&a(e,t,n))return!0}else for(;e=e[u];)if(1===e.nodeType||s){if((r=(o=e[qe]||(e[qe]={}))[u])&&r[0]===We&&r[1]===c)return i[2]=r[2];if((o[u]=i)[2]=a(e,t,n))return!0}}}function Lt(o){return 1<o.length?function(e,t,n){for(var r=o.length;r--;)if(!o[r](e,t,n))return!1;return!0}:o[0]}function Ft(e,t,n,r,o){for(var i,a=[],u=0,s=e.length,c=null!=t;u<s;u++)(i=e[u])&&(n&&!n(i,r,o)||(a.push(i),c&&t.push(u)));return a}function zt(e){for(var r,t,n,o=e.length,i=_e.relative[e[0].type],a=i||_e.relative[" "],u=i?1:0,s=It(function(e){return e===r},a,!0),c=It(function(e){return-1<it.call(r,e)},a,!0),l=[function(e,t,n){return!i&&(n||t!==Pe)||((r=t).nodeType?s:c)(e,t,n)}];u<o;u++)if(t=_e.relative[e[u].type])l=[It(Lt(l),t)];else{if((t=_e.filter[e[u].type].apply(null,e[u].matches))[qe]){for(n=++u;n<o&&!_e.relative[e[n].type];n++);return function Mt(m,g,p,h,v,e){return h&&!h[qe]&&(h=Mt(h)),v&&!v[qe]&&(v=Mt(v,e)),kt(function(e,t,n,r){var o,i,a,u=[],s=[],c=t.length,l=e||function(e,t,n){for(var r=0,o=t.length;r<o;r++)St(e,t[r],n);return n}(g||"*",n.nodeType?[n]:n,[]),f=!m||!e&&g?l:Ft(l,u,m,n,r),d=p?v||(e?m:c||h)?[]:t:f;if(p&&p(f,d,n,r),h)for(o=Ft(d,s),h(o,[],n,r),i=o.length;i--;)(a=o[i])&&(d[s[i]]=!(f[s[i]]=a));if(e){if(v||m){if(v){for(o=[],i=d.length;i--;)(a=d[i])&&o.push(f[i]=a);v(null,d=[],o,r)}for(i=d.length;i--;)(a=d[i])&&-1<(o=v?it.call(e,a):u[i])&&(e[o]=!(t[o]=a))}}else d=Ft(d===t?d.splice(c,d.length):d),v?v(null,t,d,r):rt.apply(t,d)})}(1<u&&Lt(l),1<u&&Pt(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(lt,"$1"),t,u<n&&zt(e.slice(u,n)),n<o&&zt(e=e.slice(n)),n<o&&Pt(e))}l.push(t)}return Lt(l)}Bt.prototype=_e.filters=_e.pseudos,_e.setFilters=new Bt,De=St.tokenize=function(e,t){var n,r,o,i,a,u,s,c=Ye[e+" "];if(c)return t?0:c.slice(0);for(a=e,u=[],s=_e.preFilter;a;){for(i in n&&!(r=ft.exec(a))||(r&&(a=a.slice(r[0].length)||a),u.push(o=[])),n=!1,(r=dt.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(lt," ")}),a=a.slice(n.length)),_e.filter)!(r=ht[i].exec(a))||s[i]&&!(r=s[i](r))||(n=r.shift(),o.push({value:n,type:i,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?St.error(e):Ye(e,u).slice(0)},Oe=St.compile=function(e,t){var n,h,v,y,b,r,o=[],i=[],a=Ge[e+" "];if(!a){for(n=(t=t||De(e)).length;n--;)((a=zt(t[n]))[qe]?o:i).push(a);(a=Ge(e,(y=0<(v=o).length,b=0<(h=i).length,r=function(e,t,n,r,o){var i,a,u,s=0,c="0",l=e&&[],f=[],d=Pe,m=e||b&&_e.find.TAG("*",o),g=We+=null==d?1:Math.random()||.1,p=m.length;for(o&&(Pe=t!==Me&&t);c!==p&&null!=(i=m[c]);c++){if(b&&i){for(a=0;u=h[a++];)if(u(i,t,n)){r.push(i);break}o&&(We=g)}y&&((i=!u&&i)&&s--,e&&l.push(i))}if(s+=c,y&&c!==s){for(a=0;u=v[a++];)u(l,f,t,n);if(e){if(0<s)for(;c--;)l[c]||f[c]||(f[c]=tt.call(r));f=Ft(f)}rt.apply(r,f),o&&!e&&0<f.length&&1<s+v.length&&St.uniqueSort(r)}return o&&(We=g,Pe=d),l},y?kt(r):r))).selector=e}return a},Be=St.select=function(e,t,n,r){var o,i,a,u,s,c="function"==typeof e&&e,l=!r&&De(e=c.selector||e);if(n=n||[],1===l.length){if(2<(i=l[0]=l[0].slice(0)).length&&"ID"===(a=i[0]).type&&ke.getById&&9===t.nodeType&&Ue&&_e.relative[i[1].type]){if(!(t=(_e.find.ID(a.matches[0].replace(Nt,Et),t)||[])[0]))return n;c&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=ht.needsContext.test(e)?0:i.length;o--&&(a=i[o],!_e.relative[u=a.type]);)if((s=_e.find[u])&&(r=s(a.matches[0].replace(Nt,Et),xt.test(i[0].type)&&Ot(t.parentNode)||t))){if(i.splice(o,1),!(e=r.length&&Pt(i)))return rt.apply(n,r),n;break}}return(c||Oe(e,l))(r,t,!Ue,n,xt.test(e)&&Ot(t.parentNode)||t),n},ke.sortStable=qe.split("").sort(Je).join("")===qe,ke.detectDuplicates=!!Le,Fe(),ke.sortDetached=!0;function jt(e,t,n){var r,o;if(!e)return 0;if(n=n||e,void 0!==e.length){for(r=0,o=e.length;r<o;r++)if(!1===t.call(n,e[r],r,e))return 0}else for(r in e)if(e.hasOwnProperty(r)&&!1===t.call(n,e[r],r,e))return 0;return 1}function Vt(e,t,n){for(var r=0,o=e.length;r<o;r++)if(t.call(n,e[r],r,e))return r;return-1}function $t(e){return null==e?"":(""+e).replace(qt,"")}function Wt(e,t){return t?!("array"!==t||!Ht.isArray(e))||typeof e===t:void 0!==e}function Kt(e,n,r,o){o=o||this,e&&(r&&(e=e[r]),Ht.each(e,function(e,t){return!1!==n.call(o,e,t,r)&&void Kt(e,n,r,o)}))}function tn(e){return void 0!==e}function nn(e){return"string"==typeof e}function rn(e,t){var r,o=(t=t||Yt).createElement("div"),n=t.createDocumentFragment();for(o.innerHTML=e;r=o.firstChild;)n.appendChild(r);return n}function on(e,t,n,r){var o;if(nn(t))t=rn(t,bn(e[0]));else if(t.length&&!t.nodeType){if(t=gn.makeArray(t),r)for(o=t.length-1;0<=o;o--)on(e,t[o],n,r);else for(o=0;o<t.length;o++)on(e,t[o],n,r);return e}if(t.nodeType)for(o=e.length;o--;)n.call(e[o],t);return e}function an(e,t){return e&&t&&-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function un(e,t,n){var r,o;return t=gn(t)[0],e.each(function(){var e=this;n&&r===e.parentNode||(r=e.parentNode,o=t.cloneNode(!1),e.parentNode.insertBefore(o,e)),o.appendChild(e)}),e}function gn(e,t){return new gn.fn.init(e,t)}function hn(e){return null==e?"":(""+e).replace(pn,"")}function vn(e,t){var n,r,o,i;if(e)if(void 0===(n=e.length)){for(r in e)if(e.hasOwnProperty(r)&&(i=e[r],!1===t.call(i,r,i)))break}else for(o=0;o<n&&(i=e[o],!1!==t.call(i,o,i));o++);return e}function yn(e,n){var r=[];return vn(e,function(e,t){n(t,e)&&r.push(t)}),r}function bn(e){return e?9===e.nodeType?e:e.ownerDocument:Yt}var Ut=Array.isArray,Ht={isArray:Ut,toArray:function(e){var t,n,r=e;if(!Ut(e))for(r=[],t=0,n=e.length;t<n;t++)r[t]=e[t];return r},each:jt,map:function(n,r){var o=[];return jt(n,function(e,t){o.push(r(e,t,n))}),o},filter:function(n,r){var o=[];return jt(n,function(e,t){r&&!r(e,t,n)||o.push(e)}),o},indexOf:function(e,t){var n,r;if(e)for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},reduce:function(e,t,n,r){var o=0;for(arguments.length<3&&(n=e[0]);o<e.length;o++)n=t.call(r,n,e[o],o);return n},findIndex:Vt,find:function(e,t,r){r=Vt(e,t,r);return-1!==r?e[r]:void 0},last:function(e){return e[e.length-1]}},qt=/^\s*|\s*$/g,Xt={trim:$t,isArray:Ht.isArray,is:Wt,toArray:Ht.toArray,makeMap:function(e,t,n){var r;for(t=t||",",n=n||{},r=(e="string"==typeof(e=e||[])?e.split(t):e).length;r--;)n[e[r]]={};return n},each:Ht.each,map:Ht.map,grep:Ht.filter,inArray:Ht.indexOf,hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},extend:function(e,t){for(var o,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];for(var u,s=arguments,n=1,r=s.length;n<r;n++)for(o in t=s[n])t.hasOwnProperty(o)&&void 0!==(u=t[o])&&(e[o]=u);return e},create:function(e,t,n){var r,o,i,a,u,s=this,c=0;if(e=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(e),i=e[3].match(/(^|\.)(\w+)$/i)[2],!(o=s.createNS(e[3].replace(/\.\w+$/,""),n))[i]){if("static"===e[2])return o[i]=t,void(this.onCreate&&this.onCreate(e[2],e[3],o[i]));t[i]||(t[i]=function(){},c=1),o[i]=t[i],s.extend(o[i].prototype,t),e[5]&&(r=s.resolve(e[5]).prototype,a=e[5].match(/\.(\w+)$/i)[1],u=o[i],o[i]=c?function(){return r[a].apply(this,arguments)}:function(){return this.parent=r[a],u.apply(this,arguments)},o[i].prototype[i]=o[i],s.each(r,function(e,t){o[i].prototype[t]=r[t]}),s.each(t,function(e,t){r[t]?o[i].prototype[t]=function(){return this.parent=r[t],e.apply(this,arguments)}:t!==i&&(o[i].prototype[t]=e)})),s.each(t.static,function(e,t){o[i][t]=e})}},walk:Kt,createNS:function(e,t){var n,r;for(t=t||V.window,e=e.split("."),n=0;n<e.length;n++)t[r=e[n]]||(t[r]={}),t=t[r];return t},resolve:function(e,t){var n,r;for(t=t||V.window,n=0,r=(e=e.split(".")).length;n<r&&(t=t[e[n]]);n++);return t},explode:function(e,t){return!e||Wt(e,"array")?e:Ht.map(e.split(t||","),$t)},_addCacheSuffix:function(e){var t=fe.cacheSuffix;return t&&(e+=(-1===e.indexOf("?")?"?":"&")+t),e}},Yt=V.document,Gt=Array.prototype.push,Jt=Array.prototype.slice,Qt=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Zt=Se.Event,en=Xt.makeMap("children,contents,next,prev"),sn=Xt.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),cn=Xt.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),ln={for:"htmlFor",class:"className",readonly:"readOnly"},fn={float:"cssFloat"},dn={},mn={},pn=/^\s*|\s*$/g;gn.fn=gn.prototype={constructor:gn,selector:"",context:null,length:0,init:function(e,t){var n,r,o=this;if(!e)return o;if(e.nodeType)return o.context=o[0]=e,o.length=1,o;if(t&&t.nodeType)o.context=t;else{if(t)return gn(e).attr(t);o.context=t=V.document}if(nn(e)){if(!(n="<"===(o.selector=e).charAt(0)&&">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:Qt.exec(e)))return gn(t).find(e);if(n[1])for(r=rn(e,bn(t)).firstChild;r;)Gt.call(o,r),r=r.nextSibling;else{if(!(r=bn(t).getElementById(n[2])))return o;if(r.id!==n[2])return o.find(e);o.length=1,o[0]=r}}else this.add(e,!1);return o},toArray:function(){return Xt.toArray(this)},add:function(e,t){var n,r,o=this;if(nn(e))return o.add(gn(e));if(!1!==t)for(n=gn.unique(o.toArray().concat(gn.makeArray(e))),o.length=n.length,r=0;r<n.length;r++)o[r]=n[r];else Gt.apply(o,gn.makeArray(e));return o},attr:function(t,n){var e,r=this;if("object"==typeof t)vn(t,function(e,t){r.attr(e,t)});else{if(!tn(n)){if(r[0]&&1===r[0].nodeType){if((e=dn[t])&&e.get)return e.get(r[0],t);if(cn[t])return r.prop(t)?t:void 0;null===(n=r[0].getAttribute(t,2))&&(n=void 0)}return n}this.each(function(){var e;1===this.nodeType&&((e=dn[t])&&e.set?e.set(this,n):null===n?this.removeAttribute(t,2):this.setAttribute(t,n,2))})}return r},removeAttr:function(e){return this.attr(e,null)},prop:function(e,t){var n=this;if("object"==typeof(e=ln[e]||e))vn(e,function(e,t){n.prop(e,t)});else{if(!tn(t))return n[0]&&n[0].nodeType&&e in n[0]?n[0][e]:t;this.each(function(){1===this.nodeType&&(this[e]=t)})}return n},css:function(n,r){function t(e){return e.replace(/-(\D)/g,function(e,t){return t.toUpperCase()})}function a(e){return e.replace(/[A-Z]/g,function(e){return"-"+e})}var e,o,i=this;if("object"==typeof n)vn(n,function(e,t){i.css(e,t)});else if(tn(r))n=t(n),"number"!=typeof r||sn[n]||(r=r.toString()+"px"),i.each(function(){var e=this.style;if((o=mn[n])&&o.set)o.set(this,r);else{try{this.style[fn[n]||n]=r}catch(t){}null!==r&&""!==r||(e.removeProperty?e.removeProperty(a(n)):e.removeAttribute(n))}});else{if(e=i[0],(o=mn[n])&&o.get)return o.get(e);if(!e.ownerDocument.defaultView)return e.currentStyle?e.currentStyle[t(n)]:"";try{return e.ownerDocument.defaultView.getComputedStyle(e,null).getPropertyValue(a(n))}catch(u){return}}return i},remove:function(){for(var e,t=this.length;t--;)e=this[t],Zt.clean(e),e.parentNode&&e.parentNode.removeChild(e);return this},empty:function(){for(var e,t=this.length;t--;)for(e=this[t];e.firstChild;)e.removeChild(e.firstChild);return this},html:function(e){var t,n=this;if(tn(e)){t=n.length;try{for(;t--;)n[t].innerHTML=e}catch(r){gn(n[t]).empty().append(e)}return n}return n[0]?n[0].innerHTML:""},text:function(e){var t,n=this;if(tn(e)){for(t=n.length;t--;)"innerText"in n[t]?n[t].innerText=e:n[0].textContent=e;return n}return n[0]?n[0].innerText||n[0].textContent:""},append:function(){return on(this,arguments,function(e){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(e)})},prepend:function(){return on(this,arguments,function(e){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(e,this.firstChild)},!0)},before:function(){return this[0]&&this[0].parentNode?on(this,arguments,function(e){this.parentNode.insertBefore(e,this)}):this},after:function(){return this[0]&&this[0].parentNode?on(this,arguments,function(e){this.parentNode.insertBefore(e,this.nextSibling)},!0):this},appendTo:function(e){return gn(e).append(this),this},prependTo:function(e){return gn(e).prepend(this),this},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){return un(this,e)},wrapAll:function(e){return un(this,e,!0)},wrapInner:function(e){return this.each(function(){gn(this).contents().wrapAll(e)}),this},unwrap:function(){return this.parent().each(function(){gn(this).replaceWith(this.childNodes)})},clone:function(){var e=[];return this.each(function(){e.push(this.cloneNode(!0))}),gn(e)},addClass:function(e){return this.toggleClass(e,!0)},removeClass:function(e){return this.toggleClass(e,!1)},toggleClass:function(o,i){var e=this;return"string"!=typeof o||(-1!==o.indexOf(" ")?vn(o.split(" "),function(){e.toggleClass(this,i)}):e.each(function(e,t){var n,r;(r=an(t,o))!==i&&(n=t.className,r?t.className=hn((" "+n+" ").replace(" "+o+" "," ")):t.className+=n?" "+o:o)})),e},hasClass:function(e){return an(this[0],e)},each:function(e){return vn(this,e)},on:function(e,t){return this.each(function(){Zt.bind(this,e,t)})},off:function(e,t){return this.each(function(){Zt.unbind(this,e,t)})},trigger:function(e){return this.each(function(){"object"==typeof e?Zt.fire(this,e.type,e):Zt.fire(this,e)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new gn(Jt.apply(this,arguments))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(e){for(var r=[],t=0,n=this.length;t<n;t++)gn.find(e,this[t],r);return gn(r)},filter:function(n){return gn("function"==typeof n?yn(this.toArray(),function(e,t){return n(t,e)}):gn.filter(n,this.toArray()))},closest:function(n){var r=[];return n instanceof gn&&(n=n[0]),this.each(function(e,t){for(;t;){if("string"==typeof n&&gn(t).is(n)){r.push(t);break}if(t===n){r.push(t);break}t=t.parentNode}}),gn(r)},offset:function(r){var n,o,i=0,a=0;return r?this.css(r):((o=this[0])&&(r=(n=o.ownerDocument).documentElement,o.getBoundingClientRect&&(i=(o=o.getBoundingClientRect()).left+(r.scrollLeft||n.body.scrollLeft)-r.clientLeft,a=o.top+(r.scrollTop||n.body.scrollTop)-r.clientTop)),{left:i,top:a})},push:Gt,sort:[].sort,splice:[].splice},Xt.extend(gn,{extend:Xt.extend,makeArray:function(e){return e&&e===e.window||e.nodeType?[e]:Xt.toArray(e)},inArray:function(e,t){var n;if(t.indexOf)return t.indexOf(e);for(n=t.length;n--;)if(t[n]===e)return n;return-1},isArray:Xt.isArray,each:vn,trim:hn,grep:yn,find:St,expr:St.selectors,unique:St.uniqueSort,text:St.getText,contains:St.contains,filter:function(e,t,n){var r=t.length;for(n&&(e=":not("+e+")");r--;)1!==t[r].nodeType&&t.splice(r,1);return 1===t.length?gn.find.matchesSelector(t[0],e)?[t[0]]:[]:gn.find.matches(e,t)}});function Cn(e,t,n){var r=[],o=e[t];for("string"!=typeof n&&n instanceof gn&&(n=n[0]);o&&9!==o.nodeType;){if(void 0!==n){if(o===n)break;if("string"==typeof n&&gn(o).is(n))break}1===o.nodeType&&r.push(o),o=o[t]}return r}function xn(e,t,n,r){var o=[];for(r instanceof gn&&(r=r[0]);e;e=e[t])if(!n||e.nodeType===n){if(void 0!==r){if(e===r)break;if("string"==typeof r&&gn(e).is(r))break}o.push(e)}return o}function wn(e,t,n){for(e=e[t];e;e=e[t])if(e.nodeType===n)return e;return null}vn({parent:function(t){t=t.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Cn(e,"parentNode")},next:function(e){return wn(e,"nextSibling",1)},prev:function(e){return wn(e,"previousSibling",1)},children:function(e){return xn(e.firstChild,"nextSibling",1)},contents:function(e){return Xt.toArray(("iframe"===e.nodeName?e.contentDocument||e.contentWindow.document:e).childNodes)}},function(e,r){gn.fn[e]=function(t){var n=[];return this.each(function(){var e=r.call(n,this,t,n);e&&(gn.isArray(e)?n.push.apply(n,e):n.push(e))}),1<this.length&&(en[e]||(n=gn.unique(n)),0===e.indexOf("parents")&&(n=n.reverse())),n=gn(n),t?n.filter(t):n}}),vn({parentsUntil:function(e,t){return Cn(e,"parentNode",t)},nextUntil:function(e,t){return xn(e,"nextSibling",1,t).slice(1)},prevUntil:function(e,t){return xn(e,"previousSibling",1,t).slice(1)}},function(r,o){gn.fn[r]=function(t,e){var n=[];return this.each(function(){var e=o.call(n,this,t,n);e&&(gn.isArray(e)?n.push.apply(n,e):n.push(e))}),1<this.length&&(n=gn.unique(n),0!==r.indexOf("parents")&&"prevUntil"!==r||(n=n.reverse())),n=gn(n),e?n.filter(e):n}}),gn.fn.is=function(e){return!!e&&0<this.filter(e).length},gn.fn.init.prototype=gn.fn,gn.overrideDefaults=function(n){function o(e,t){return r=r||n(),0===arguments.length&&(e=r.element),t=t||r.context,new o.fn.init(e,t)}var r;return gn.extend(o,this),o};MN=function(n,r,e){vn(e,function(e,t){n[e]=n[e]||{},n[e][r]=t})};fe.ie&&fe.ie<8&&(MN(dn,"get",{maxlength:function(t){t=t.maxLength;return 2147483647===t?void 0:t},size:function(t){t=t.size;return 20===t?void 0:t},class:function(e){return e.className},style:function(t){t=t.style.cssText;return 0===t.length?void 0:t}}),MN(dn,"set",{class:function(e,t){e.className=t},style:function(e,t){e.style.cssText=t}})),fe.ie&&fe.ie<9&&(fn.float="styleFloat",MN(mn,"set",{opacity:function(n,t){n=n.style;null===t||""===t?n.removeAttribute("filter"):(n.zoom=1,n.filter="alpha(opacity="+100*t+")")}})),gn.attrHooks=dn,gn.cssHooks=mn;function On(){return Bn(0,0)}function Bn(e,t){return{major:e,minor:t}}function Ln(e,t){return function(){return t===e}}function Fn(e){var t=e.current;return{current:t,version:e.version,isEdge:Ln("Edge",t),isChrome:Ln("Chrome",t),isIE:Ln("IE",t),isOpera:Ln("Opera",t),isFirefox:Ln(In,t),isSafari:Ln("Safari",t)}}function Hn(e,t){return function(){return t===e}}function qn(e){var t=e.current;return{current:t,version:e.version,isWindows:Hn(zn,t),isiOS:Hn("iOS",t),isAndroid:Hn(Un,t),isOSX:Hn("OSX",t),isLinux:Hn("Linux",t),isSolaris:Hn(jn,t),isFreeBSD:Hn(Vn,t)}}function Wn(e,t){var n=String(t).toLowerCase();return X(e,function(e){return e.search(n)})}function Yn(e,t){return-1!==e.indexOf(t)}function Gn(e){return e.replace(/^\s+|\s+$/g,"")}function Jn(e){return e.replace(/\s+$/g,"")}function ir(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:q(e)}}function br(e,t){return pr.call(e,t)}function xr(e,t,n){if(!(S(n)||R(n)||O(n)))throw V.console.error("Invalid call to Attr.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}function wr(e,t,n){xr(e.dom(),t,n)}function Sr(e,t){e.dom().removeAttribute(t)}function kr(r,a){var o=r.dom(),i=V.window.getComputedStyle(o).getPropertyValue(a);return null===(a=""!==i||void 0!==(r=mr(r=r)?r.dom().parentNode:r.dom())&&null!==r&&r.ownerDocument.body.contains(r)?i:_r(o,a))?void 0:a}function Rr(e,t){for(var n=[],r=function(e){return n.push(e),t(e)},o=t(e);(o=o.bind(r)).isSome(););return n}function Br(e,t){return function(e,t,n){return 0!=(e.compareDocumentPosition(t)&n)}(e,t,oe.getOrDie("Node").DOCUMENT_POSITION_CONTAINED_BY)}function Lr(r,t){if((r=r.dom()).nodeType!==Pr)return!1;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}function jr(e){return ar.fromDom(e.dom().ownerDocument.defaultView)}function Hr(e){return _.from(e.dom().previousSibling).map(ar.fromDom)}function $r(n){return n=Rr(n,Hr),(n=B.call(n,0)).reverse(),n}function Wr(e){return Rr(e,qr)}function Yr(e){return Xr(e,0)}function Gr(e){return Xr(e,e.dom().childNodes.length-1)}function Qr(e){return X(e,dr)}var En,Sn,Tn,Pn_detect=function(e,n){n=String(n).toLowerCase();return 0===e.length?On():function(r,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(r,t);if(!n)return{major:0,minor:0};r=function(e){return Number(t.replace(n,"$"+e))};return Bn(r(1),r(2))}(e,n)},Pn_unknown=On,In="Firefox",Mn={unknown:function(){return Fn({current:void 0,version:Pn_unknown()})},nu:Fn,edge:q("Edge"),chrome:q("Chrome"),ie:q("IE"),opera:q("Opera"),firefox:q(In),safari:q("Safari")},zn="Windows",Un="Android",jn="Solaris",Vn="FreeBSD",$n={unknown:function(){return qn({current:void 0,version:Pn_unknown()})},nu:qn,windows:q(zn),ios:q("iOS"),android:q(Un),linux:q("Linux"),osx:q("OSX"),solaris:q(jn),freebsd:q(Vn)},Kn=function(e,n){return Wn(e,n).map(function(e){var t=Pn_detect(e.versionRegexes,n);return{current:e.name,version:t}})},Xn=function(e,n){return Wn(e,n).map(function(e){var t=Pn_detect(e.versionRegexes,n);return{current:e.name,version:t}})},LN=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,jN=function(t){return function(e){return Yn(e,t)}},Cp=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return Yn(e,"edge/")&&Yn(e,"chrome")&&Yn(e,"safari")&&Yn(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,LN],search:function(e){return Yn(e,"chrome")&&!Yn(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return Yn(e,"msie")||Yn(e,"trident")}},{name:"Opera",versionRegexes:[LN,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:jN("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:jN("firefox")},{name:"Safari",versionRegexes:[LN,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(Yn(e,"safari")||Yn(e,"mobile/"))&&Yn(e,"applewebkit")}}],QN=[{name:"Windows",search:jN("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return Yn(e,"iphone")||Yn(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:jN("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:jN("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:jN("linux"),versionRegexes:[]},{name:"Solaris",search:jN("sunos"),versionRegexes:[]},{name:"FreeBSD",search:jN("freebsd"),versionRegexes:[]}],nr={browsers:q(Cp),oses:q(QN)},or={detect:(Tn=!(En=function(){var l,n,f,o,i,c,s,t=V.navigator.userAgent;return l=t,o=nr.browsers(),i=nr.oses(),c=Kn(o,l).fold(Mn.unknown,Mn.nu),s=Xn(i,l).fold($n.unknown,$n.nu),{browser:c,os:s,deviceType:(n=c,f=l,o=(t=s).isiOS()&&!0===/ipad/i.test(f),i=t.isiOS()&&!o,c=t.isAndroid()&&3===t.version.major,l=t.isAndroid()&&4===t.version.major,s=o||c||l&&!0===/mobile/i.test(f),l=(c=t.isiOS()||t.isAndroid())&&!s,f=n.isSafari()&&t.isiOS()&&!1===/safari/i.test(f),{isiPad:q(o),isiPhone:q(i),isTablet:q(s),isPhone:q(l),isTouch:q(c),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:q(f)})}}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Tn||(Tn=!0,Sn=En.apply(null,e)),Sn})},ar={fromHtml:function(e,n){n=(n||V.document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw V.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return ir(n.childNodes[0])},fromTag:function(n,t){n=(t||V.document).createElement(n);return ir(n)},fromText:function(n,t){n=(t||V.document).createTextNode(n);return ir(n)},fromDom:ir,fromPoint:function(r,t,n){r=r.dom();return _.from(r.elementFromPoint(t,n)).map(ir)}},oE=(V.Node.ATTRIBUTE_NODE,V.Node.CDATA_SECTION_NODE,V.Node.COMMENT_NODE,V.Node.DOCUMENT_NODE),RN=(V.Node.DOCUMENT_TYPE_NODE,V.Node.DOCUMENT_FRAGMENT_NODE,V.Node.ELEMENT_NODE),KN=V.Node.TEXT_NODE,lr=(V.Node.PROCESSING_INSTRUCTION_NODE,V.Node.ENTITY_REFERENCE_NODE,V.Node.ENTITY_NODE,V.Node.NOTATION_NODE,function(e){return e.dom().nodeName.toLowerCase()}),tE=function(t){return function(e){return e.dom().nodeType===t}},dr=tE(RN),mr=tE(KN),gr=Object.keys,pr=Object.hasOwnProperty,hr=function(e,t){for(var n=gr(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},yr=function(e,n){var r={},o={};return hr(e,function(e,t){(n(e,t)?r:o)[t]=e}),{t:r,f:o}},Cr=function(e){return void 0!==e.style&&D(e.style.getPropertyValue)},Nr=function(e,t){var n=e.dom();hr(t,function(e,t){xr(n,t,e)})},Er=function(e,n){n=e.dom().getAttribute(n);return null===n?void 0:n},_r=function(e,t){return Cr(e)?e.style.getPropertyValue(t):""},MN=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(t.length!==n.length)throw new Error('Wrong number of arguments to struct. Expected "['+t.length+']", got '+n.length+" arguments");var r={};return z(t,function(e,t){r[e]=q(n[t])}),r}},Pr=RN,Ir=oE,Fr=function(e){return e.nodeType!==Pr&&e.nodeType!==Ir||0===e.childElementCount},Mr=function(e,t){return e.dom()===t.dom()},zr=or.detect().browser.isIE()?function(e,t){return Br(e.dom(),t.dom())}:function(n,r){n=n.dom(),r=r.dom();return n!==r&&n.contains(r)},Ur=function(e){return ar.fromDom(e.dom().ownerDocument)},Vr=function(e){return _.from(e.dom().parentNode).map(ar.fromDom)},qr=function(e){return _.from(e.dom().nextSibling).map(ar.fromDom)},Kr=function(e){return W(e.dom().childNodes,ar.fromDom)},Xr=function(n,t){n=n.dom().childNodes;return _.from(n[t]).map(ar.fromDom)},Jr=(MN("element","offset"),or.detect().browser),Zr_getPos=function(e,i,n){var r,o,a=0,u=0,s=e.ownerDocument;if(n=n||e,i){if(n===e&&i.getBoundingClientRect&&"static"===kr(ar.fromDom(e),"position"))return{x:a=(o=i.getBoundingClientRect()).left+(s.documentElement.scrollLeft||e.scrollLeft)-s.documentElement.clientLeft,y:u=o.top+(s.documentElement.scrollTop||e.scrollTop)-s.documentElement.clientTop};for(r=i;r&&r!==n&&r.nodeType;)a+=r.offsetLeft||0,u+=r.offsetTop||0,r=r.offsetParent;for(r=i.parentNode;r&&r!==n&&r.nodeType;)a-=r.scrollLeft||0,u-=r.scrollTop||0,r=r.parentNode;u+=(i=ar.fromDom(i),Jr.isFirefox()&&"table"===lr(i)?Qr(Kr(i)).filter(function(e){return"caption"===lr(e)}).bind(function(o){return Qr(Wr(o)).map(function(r){var t=r.dom().offsetTop,n=o.dom().offsetTop,r=o.dom().offsetHeight;return t<=n?-r:0})}).getOr(0):0)}return{x:a,y:u}},LN={},jN={exports:LN},kn=void 0,_n=LN,An=jN,Rn=void 0;(function(e){"object"==typeof _n&&void 0!==An?An.exports=e():"function"==typeof kn&&kn.amd?kn([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=e()})(function(){return function i(a,u,s){function c(t,e){if(!u[t]){if(!a[t]){var o="function"==typeof Rn&&Rn;if(!e&&o)return o(t,!0);if(l)return l(t,!0);o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}o=u[t]={exports:{}};a[t][0].call(o.exports,function(e){return c(a[t][1][e]||e)},o,o.exports,i,a,u,s)}return u[t].exports}for(var l="function"==typeof Rn&&Rn,e=0;e<s.length;e++)c(s[e]);return c}({1:[function(e,i,n){var r,o,i=i.exports={};function a(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(iE){try{return r.call(null,e,0)}catch(iE){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(iE){r=a}try{o="function"==typeof clearTimeout?clearTimeout:u}catch(iE){o=u}}();var c,l=[],f=!1,d=-1;function m(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&g())}function g(){if(!f){var e=s(m);f=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,f=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===u||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(iE){try{return o.call(null,e)}catch(iE){return o.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||f||s(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(e,f,t){!function(n){function r(){}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function o(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var t,e=1===n._state?r.onFulfilled:r.onRejected;if(null!==e){try{t=e(n._value)}catch(iE){return void u(r.promise,iE)}a(r.promise,t)}else(1===n._state?a:u)(r.promise,n._value)})):n._deferreds.push(r)}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void s(e);if("function"==typeof n)return void l((r=n,o=t,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=t,s(e)}catch(iE){u(e,iE)}var r,o}function u(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,a(t,e))},function(e){n||(n=!0,u(t,e))})}catch(r){if(n)return;n=!0,u(t,r)}}var e,t;e=this,t=setTimeout,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new c(e,t,n)),n},i.all=function(e){var s=Array.prototype.slice.call(e);return new i(function(o,i){if(0===s.length)return o([]);var a=s.length;for(var e=0;e<s.length;e++)!function u(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return n.call(e,function(e){u(t,e)},i),0}s[t]=e,0==--a&&o(s)}catch(r){i(r)}}(e,s[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(o){return new i(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},i._immediateFn="function"==typeof n?function(e){n(e)}:function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},void 0!==f&&f.exports?f.exports=i:e.Promise||(e.Promise=i)}.call(this,e("timers").setImmediate)},{timers:3}],3:[function(s,e,c){!function(e,t){var r=s("process/browser.js").nextTick,n=Function.prototype.apply,o=Array.prototype.slice,i={},a=0;function u(e,t){this._id=e,this._clearFn=t}c.setTimeout=function(){return new u(n.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new u(n.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(e){e.close()},u.prototype.unref=u.prototype.ref=function(){},u.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},c.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},c._unrefActive=c.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},c.setImmediate="function"==typeof e?e:function(e){var t=a++,n=!(arguments.length<2)&&o.call(arguments,1);return i[t]=!0,r(function(){i[t]&&(n?e.apply(null,n):e.call(null),c.clearImmediate(t))}),t},c.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}.call(this,s("timers").setImmediate,s("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(o,t,n){var r=o("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();t.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});function ro(e){function r(e){o()?a(e):t.push(e)}function o(){return n.isSome()}function a(t){n.each(function(e){V.setTimeout(function(){t(e)},0)})}var n=_.none(),t=[];return e(function(e){n=_.some(e),function(e){z(e,a)}(t),t=[]}),{get:r,map:function(n){return ro(function(t){r(function(e){t(n(e))})})},isReady:o}}function io(e){V.setTimeout(function(){throw e},0)}function ao(n){function e(e){n().then(e,io)}return{map:function(e){return ao(function(){return n().then(e)})},bind:function(t){return ao(function(){return n().then(function(e){return t(e).toPromise()})})},anonBind:function(e){return ao(function(){return n().then(function(){return e.toPromise()})})},toLazy:function(){return oo_nu(e)},toCached:function(){var e=null;return ao(function(){return e=null===e?n():e})},toPromise:n,get:e}}function lo(n){return{is:function(e){return n===e},isValue:C,isError:b,getOr:q(n),getOrThunk:q(n),getOrDie:q(n),or:function(e){return lo(n)},orThunk:function(e){return lo(n)},fold:function(e,t){return t(n)},map:function(e){return lo(e(n))},mapError:function(e){return lo(n)},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return _.some(n)}}}function fo(n){return{is:b,isValue:b,isError:C,getOr:$,getOrThunk:function(e){return e()},getOrDie:function(){return e=String(n),function(){throw new Error(e)}();var e},or:function(e){return e},orThunk:function(e){return e()},fold:function(e,t){return e(n)},map:function(e){return fo(n)},mapError:function(e){return fo(e(n))},each:o,bind:function(e){return fo(n)},exists:b,forall:C,toOption:_.none}}var no=jN.exports.boltExport,oo_nu=ro,uo={nu:function(e){return ao(function(){return new no(e)})},pure:function(e){return ao(function(){return no.resolve(e)})}},so=function(a,e){return e(function(r){var o=[],i=0;0===a.length?r([]):z(a,function(e,t){var n;e.get((n=t,function(e){o[n]=e,++i>=a.length&&r(o)}))})})},mo_value=lo,mo_error=fo;function go(e,u){function n(e,t,n,r){var o,i;if(e){if(!r&&e[t])return e[t];if(e!==u){if(o=e[n])return o;for(i=e.parentNode;i&&i!==u;i=i.parentNode)if(o=i[n])return o}}}var t=e;this.current=function(){return t},this.next=function(e){return t=n(t,"firstChild","nextSibling",e)},this.prev=function(e){return t=n(t,"lastChild","previousSibling",e)},this.prev2=function(e){return t=function(i,t,r){var o,a;if(i&&(o=i.previousSibling,!u||o!==u)){if(o){if(!r)for(a=o[t];a;a=a[t])if(!a[t])return a;return o}return(i=i.parentNode)&&i!==u?i:void 0}}(t,"lastChild",e)}}function xo(e){return dr(e)&&!Co(e)}function Vo(e){return e&&"SPAN"===e.tagName&&"bookmark"===e.getAttribute("data-mce-type")}function Ho(e,t){var n,a,r=t.childNodes;if(!jo.isElement(t)||!Vo(t)){for(n=r.length-1;0<=n;n--)Ho(e,r[n]);if(!1===jo.isDocument(t)){if(jo.isText(t)&&0<t.nodeValue.length){var u=Xt.trim(t.nodeValue).length;if(e.isBlock(t.parentNode)||0<u)return;if(0===u&&(a=t.previousSibling&&"SPAN"===t.previousSibling.nodeName,u=t.nextSibling&&"SPAN"===t.nextSibling.nodeName,a&&u))return}else if(jo.isElement(t)&&(1===(r=t.childNodes).length&&Vo(r[0])&&t.parentNode.insertBefore(r[0],t),r.length||To(ar.fromDom(t))))return;e.remove(t)}return t}}function Jo(e,t){var n,r,o,i={};if(e){for(e=e.split(","),t=t||10,n=0;n<e.length;n+=2)r=String.fromCharCode(parseInt(e[n],t)),ho[r]||(o="&"+e[n+1]+";",i[r]=o,i[o]=r);return i}}function Qo(e,t){return e.replace(t?Wo:Ko,function(e){return ho[e]||e})}function Zo(e,t){return e.replace(t?Wo:Ko,function(e){return 1<e.length?"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";":ho[e]||"&#"+e.charCodeAt(0)+";"})}function ei(e,t,n){return n=n||po,e.replace(t?Wo:Ko,function(e){return ho[e]||n[e]||e})}var Cp=function(t){var n;return function(e){return(n=n||function(e,t){for(var n={},r=0,o=e.length;r<o;r++){var i=e[r];n[String(i)]=t(i,r)}return n}(t,q(!0))).hasOwnProperty(lr(e))}},bo=Cp(["h1","h2","h3","h4","h5","h6"]),Co=Cp(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]),wo=function(e){return dr(e)&&"br"===lr(e)},No=Cp(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),Eo=Cp(["ul","ol","dl"]),So=Cp(["li","dd","dt"]),To=Cp(["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed","source","wbr","track"]),ko=Cp(["thead","tbody","tfoot"]),_o=Cp(["td","th"]),Ao=Cp(["pre","script","textarea","style"]),QN=function(t){return function(e){return!!e&&e.nodeType===t}},Do=QN(1),tE=function(e){var r=e.toLowerCase().split(" ");return function(e){var t,n;if(e&&e.nodeType)for(n=e.nodeName.toLowerCase(),t=0;t<r.length;t++)if(n===r[t])return!0;return!1}},KN=function(t){return function(e){if(Do(e)){if(e.contentEditable===t)return!0;if(e.getAttribute("data-mce-contenteditable")===t)return!0}return!1}},RN=QN(3),oE=QN(8),LN=QN(9),jN=QN(11),Cp=tE("br"),QN=KN("true"),KN=KN("false"),jo={isText:RN,isElement:Do,isComment:oE,isDocument:LN,isDocumentFragment:jN,isBr:Cp,isContentEditableTrue:QN,isContentEditableFalse:KN,isRestrictedNode:function(e){return!!e&&!Object.getPrototypeOf(e)},matchNodeNames:tE,hasPropValue:function(t,n){return function(e){return Do(e)&&e[t]===n}},hasAttribute:function(t,e){return function(e){return Do(e)&&e.hasAttribute(t)}},hasAttributeValue:function(t,n){return function(e){return Do(e)&&e.getAttribute(t)===n}},matchStyleValues:function(r,e){var o=e.toLowerCase().split(" ");return function(e){var t;if(Do(e))for(t=0;t<o.length;t++){var n=e.ownerDocument.defaultView.getComputedStyle(e,null);if((n?n.getPropertyValue(r):null)===o[t])return!0}return!1}},isBogus:function(e){return Do(e)&&e.hasAttribute("data-mce-bogus")},isBogusAll:function(e){return Do(e)&&"all"===e.getAttribute("data-mce-bogus")},isTable:function(e){return Do(e)&&"TABLE"===e.tagName}},qo_trimNode=Ho,$o=Xt.makeMap,Wo=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Ko=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Xo=/[<>&\"\']/g,Yo=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,Go={128:"â¬",130:"â",131:"Æ",132:"â",133:"â¦",134:"â ",135:"â¡",136:"Ë",137:"â°",138:"Å ",139:"â¹",140:"Å",142:"Å½",145:"â",146:"â",147:"â",148:"â",149:"â¢",150:"â",151:"â",152:"Ë",153:"â¢",154:"Å¡",155:"âº",156:"Å",158:"Å¾",159:"Å¸"},ho={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},vo={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},po=Jo("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),ti={encodeRaw:Qo,encodeAllRaw:function(e){return(""+e).replace(Xo,function(e){return ho[e]||e})},encodeNumeric:Zo,encodeNamed:ei,getEncodeFunc:function(r,t){var n=Jo(t)||po,r=$o(r.replace(/\+/g,","));return r.named&&r.numeric?function(e,t){return e.replace(t?Wo:Ko,function(e){return void 0!==ho[e]?ho[e]:void 0!==n[e]?n[e]:1<e.length?"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";":"&#"+e.charCodeAt(0)+";"})}:r.named?t?function(e,t){return ei(e,t,n)}:ei:r.numeric?Zo:Qo},decode:function(e){return e.replace(Yo,function(r,n){return n?65535<(n="x"===n.charAt(0).toLowerCase()?parseInt(n.substr(1),16):parseInt(n,10))?(n-=65536,String.fromCharCode(55296+(n>>10),56320+(1023&n))):Go[n]||String.fromCharCode(n):vo[r]||po[r]||(n=r,(r=ar.fromTag("div").dom()).innerHTML=n,r.textContent||r.innerText||n)})}},ni={},ri={},oi=Xt.makeMap,ii=Xt.each,ai=Xt.extend,ui=Xt.explode,si=Xt.inArray,ci=function(e,t){return(e=Xt.trim(e))?e.split(t||" "):[]},li=function(e){function a(e,t,n){function a(e,t){for(var o={},n=0,r=e.length;n<r;n++)o[e[n]]=t||{};return o}var r,i;for(t=t||"","string"==typeof(n=n||[])&&(n=ci(n)),r=(e=ci(e)).length;r--;)i={attributes:a(i=ci([u,t].join(" "))),attributesOrder:i,children:a(n,ri)},s[e[r]]=i}function c(e,t){var r,o,i,n=(e=ci(e)).length;for(t=ci(t);n--;)for(r=s[e[n]],o=0,i=t.length;o<i;o++)r.attributes[t[o]]={},r.attributesOrder.push(t[o])}var u,t,n,r,o,s={};return ni[e]||(u="id accesskey class dir lang style tabindex title role",t="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",n="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==e&&(u+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",t+=" article aside details dialog figure main header footer hgroup section nav",n+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!==e&&(u+=" xml:lang",n=[n,o="acronym applet basefont big font strike tt"].join(" "),ii(ci(o),function(e){a(e,"",n)}),t=[t,o="center dir isindex noframes"].join(" "),r=[t,n].join(" "),ii(ci(o),function(e){a(e,"",r)})),r=r||[t,n].join(" "),a("html","manifest","head body"),a("head","","base command link meta noscript script style title"),a("title hr noscript br"),a("base","href target"),a("link","href rel media hreflang type sizes hreflang"),a("meta","name http-equiv content charset"),a("style","media type scoped"),a("script","src async defer type charset"),a("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",r),a("address dt dd div caption","",r),a("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",n),a("blockquote","cite",r),a("ol","reversed start type","li"),a("ul","","li"),a("li","value",r),a("dl","","dt dd"),a("a","href target rel media hreflang type",n),a("q","cite",n),a("ins del","cite datetime",r),a("img","src sizes srcset alt usemap ismap width height"),a("iframe","src name width height",r),a("embed","src type width height"),a("object","data type typemustmatch name usemap form width height",[r,"param"].join(" ")),a("param","name value"),a("map","name",[r,"area"].join(" ")),a("area","alt coords shape href target rel media hreflang type"),a("table","border","caption colgroup thead tfoot tbody tr"+("html4"===e?" col":"")),a("colgroup","span","col"),a("col","span"),a("tbody thead tfoot","","tr"),a("tr","","td th"),a("td","colspan rowspan headers",r),a("th","colspan rowspan headers scope abbr",r),a("form","accept-charset action autocomplete enctype method name novalidate target",r),a("fieldset","disabled form name",[r,"legend"].join(" ")),a("label","form for",n),a("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),a("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===e?r:n),a("select","disabled form multiple name required size","option optgroup"),a("optgroup","disabled label","option"),a("option","disabled label selected value"),a("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),a("menu","type label",[r,"li"].join(" ")),a("noscript","",r),"html4"!==e&&(a("wbr"),a("ruby","",[n,"rt rp"].join(" ")),a("figcaption","",r),a("mark rt rp summary bdi","",n),a("canvas","width height",r),a("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[r,"track source"].join(" ")),a("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[r,"track source"].join(" ")),a("picture","","img source"),a("source","src srcset type media sizes"),a("track","kind src srclang label default"),a("datalist","",[n,"option"].join(" ")),a("article section nav aside main header footer","",r),a("hgroup","","h1 h2 h3 h4 h5 h6"),a("figure","",[r,"figcaption"].join(" ")),a("time","datetime",n),a("dialog","open",r),a("command","type label icon disabled checked radiogroup command"),a("output","for form name",n),a("progress","value max",n),a("meter","value min max low high optimum",n),a("details","open",[r,"summary"].join(" ")),a("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!==e&&(c("script","language xml:space"),c("style","xml:space"),c("object","declare classid code codebase codetype archive standby align border hspace vspace"),c("embed","align name hspace vspace"),c("param","valuetype type"),c("a","charset name rev shape coords"),c("br","clear"),c("applet","codebase archive code object alt name width height align hspace vspace"),c("img","name longdesc align border hspace vspace"),c("iframe","longdesc frameborder marginwidth marginheight scrolling align"),c("font basefont","size color face"),c("input","usemap align"),c("select","onchange"),c("textarea"),c("h1 h2 h3 h4 h5 h6 div p legend caption","align"),c("ul","type compact"),c("li","type"),c("ol dl menu dir","compact"),c("pre","width xml:space"),c("hr","align noshade size width"),c("isindex","prompt"),c("table","summary width frame rules cellspacing cellpadding align bgcolor"),c("col","width align char charoff valign"),c("colgroup","width align char charoff valign"),c("thead","align char charoff valign"),c("tr","align char charoff valign bgcolor"),c("th","axis align char charoff valign nowrap bgcolor width height"),c("form","accept"),c("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),c("tfoot","align char charoff valign"),c("tbody","align char charoff valign"),c("area","nohref"),c("body","background bgcolor text link vlink alink")),"html4"!==e&&(c("input button select textarea","autofocus"),c("input textarea","placeholder"),c("a","download"),c("link script img","crossorigin"),c("iframe","sandbox seamless allowfullscreen")),ii(ci("a form meter progress dfn"),function(e){s[e]&&delete s[e].children[e]}),delete s.caption.children.table,delete s.script,ni[e]=s)},fi=function(e,n){var r;return e&&(r={},ii(e="string"==typeof e?{"*":e}:e,function(e,t){r[t]=r[t.toUpperCase()]=("map"===n?oi:ui)(e,/[, ]/)})),r};function di(i){var e,t,r,o,a,u,s,c,l,f,d,m,N={},g={},E=[],p={},h={},x=function(e,t,n){var r=i[e];return r?r=oi(r,/[, ]/,oi(r.toUpperCase(),/[, ]/)):(r=ni[e])||(r=oi(t," ",oi(t.toUpperCase()," ")),r=ai(r,n),ni[e]=r),r},n=li((i=i||{}).schema);!1===i.verify_html&&(i.valid_elements="*[*]"),e=fi(i.valid_styles),t=fi(i.invalid_styles,"map"),s=fi(i.valid_classes,"map"),r=x("whitespace_elements","pre script noscript style textarea video audio iframe object code"),o=x("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),a=x("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),u=x("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),l=x("non_empty_elements","td th iframe video audio object script pre code",a),f=x("move_caret_before_on_enter_elements","table",l),d=x("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside main nav figure"),c=x("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption details summary",d),m=x("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),ii((i.special||"script noscript iframe noframes noembed title style textarea xmp").split(" "),function(e){h[e]=new RegExp("</"+e+"[^>]*>","gi")});function y(e){var t,n,r,o,i,a,u,s,c,l,f,d,m,g,p,h,v,y,b,C=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,x=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,w=/[*?+]/;if(e)for(e=ci(e,","),N["@"]&&(h=N["@"].attributes,v=N["@"].attributesOrder),t=0,n=e.length;t<n;t++)if(i=C.exec(e[t])){if(g=i[1],c=i[2],p=i[3],s=i[5],a={attributes:d={},attributesOrder:m=[]},"#"===g&&(a.paddEmpty=!0),"-"===g&&(a.removeEmpty=!0),"!"===i[4]&&(a.removeEmptyAttrs=!0),h){for(y in h)d[y]=h[y];m.push.apply(m,v)}if(s)for(r=0,o=(s=ci(s,"|")).length;r<o;r++)if(i=x.exec(s[r])){if(u={},f=i[1],l=i[2].replace(/[\\:]:/g,":"),g=i[3],b=i[4],"!"===f&&(a.attributesRequired=a.attributesRequired||[],a.attributesRequired.push(l),u.required=!0),"-"===f){delete d[l],m.splice(si(m,l),1);continue}g&&("="===g&&(a.attributesDefault=a.attributesDefault||[],a.attributesDefault.push({name:l,value:b}),u.defaultValue=b),":"===g&&(a.attributesForced=a.attributesForced||[],a.attributesForced.push({name:l,value:b}),u.forcedValue=b),"<"===g&&(u.validValues=oi(b,"?"))),w.test(l)?(a.attributePatterns=a.attributePatterns||[],u.pattern=S(l),a.attributePatterns.push(u)):(d[l]||m.push(l),d[l]=u)}h||"@"!==c||(h=d,v=m),p&&(a.outputName=c,N[p]=a),w.test(c)?(a.pattern=S(c),E.push(a)):N[c]=a}}function b(e){N={},E=[],y(e),ii(n,function(e,t){g[t]=e.children})}function C(e){var a=/^(~)?(.+)$/;e&&(ni.text_block_elements=ni.block_elements=null,ii(ci(e,","),function(i){var t=a.exec(i),i="~"===t[1],r=i?"span":"div",o=t[2];g[o]=g[r],p[o]=r,i||(c[o.toUpperCase()]={},c[o]={}),N[o]||(i=N[r],delete(i=ai({},i)).removeEmptyAttrs,delete i.removeEmpty,N[o]=i),ii(g,function(e,t){e[r]&&(g[t]=e=ai({},g[t]),e[o]=e[r])})}))}function w(e){var t,n=N[e];if(n)return n;for(t=E.length;t--;)if((n=E[t]).pattern.test(e))return n}var S=function(e){return new RegExp("^"+e.replace(/([?+*])/g,".$1")+"$")},x=function(e){var o=/^([+\-]?)(\w+)\[([^\]]+)\]$/;ni[i.schema]=null,e&&ii(ci(e,","),function(r){var t,n,r=o.exec(r);r&&(n=r[1],t=n?g[r[2]]:g[r[2]]={"#comment":{}},t=g[r[2]],ii(ci(r[3],"|"),function(e){"-"===n?delete t[e]:t[e]={}}))})};return i.valid_elements?b(i.valid_elements):(ii(n,function(e,t){N[t]={attributes:e.attributes,attributesOrder:e.attributesOrder},g[t]=e.children}),"html5"!==i.schema&&ii(ci("strong/b em/i"),function(e){e=ci(e,"/"),N[e[1]].outputName=e[0]}),ii(ci("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(e){N[e]&&(N[e].removeEmpty=!0)}),ii(ci("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),function(e){N[e].paddEmpty=!0}),ii(ci("span"),function(e){N[e].removeEmptyAttrs=!0})),C(i.custom_elements),x(i.valid_children),y(i.extended_valid_elements),x("+ol[ul|ol],+ul[ul|ol]"),ii({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},function(e,t){N[t]&&(N[t].parentsRequired=ci(e))}),i.invalid_elements&&ii(ui(i.invalid_elements),function(e){N[e]&&delete N[e]}),w("span")||y("span[!data-mce-type|*]"),{children:g,elements:N,getValidStyles:function(){return e},getValidClasses:function(){return s},getBlockElements:function(){return c},getInvalidStyles:function(){return t},getShortEndedElements:function(){return a},getTextBlockElements:function(){return d},getTextInlineElements:function(){return m},getBoolAttrs:function(){return u},getElementRule:w,getSelfClosingElements:function(){return o},getNonEmptyElements:function(){return l},getMoveCaretBeforeOnEnterElements:function(){return f},getWhiteSpaceElements:function(){return r},getSpecialElements:function(){return h},isValidChild:function(n,t){n=g[n.toLowerCase()];return!(!n||!n[t.toLowerCase()])},isValid:function(e,t){var n,r,o=w(e);if(o){if(!t)return!0;if(o.attributes[t])return!0;if(n=o.attributePatterns)for(r=n.length;r--;)if(n[r].pattern.test(e))return!0}return!1},getCustomElements:function(){return p},addValidElements:y,setValidElements:b,addCustomElements:C,addValidChildren:x}}var mi=function(e,t,n,r){function o(e){return 1<(e=parseInt(e,10).toString(16)).length?e:"0"+e}return"#"+o(t)+o(n)+o(r)};function gi(b,e){var C,t,c,l,x=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,w=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,N=/\s*([^:]+):\s*([^;]+);?/g,E=/\s+$/,S={},T="\ufeff";for(b=b||{},e&&(c=e.getValidStyles(),l=e.getInvalidStyles()),t=("\\\" \\' \\; \\: ; : "+T).split(" "),C=0;C<t.length;C++)S[t[C]]=T+C,S[T+C]=t[C];return{toHex:function(e){return e.replace(x,mi)},parse:function(e){function m(e){var t,n=c[e];if(n){for(t=(n=n.split(" ")).length;t--;)if(n[t]!==n[0])return;return c[e]=n[0],1}}function g(e){return o=!0,S[e]}function v(e){return e.replace(/\\[0-9a-f]+/gi,h)}function y(e,t,n,a,o,i){if(o=o||i)return"'"+(o=p(o)).replace(/\'/g,"\\'")+"'";if(t=p(t||n||a),!b.allow_script_urls){a=t.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(a))return"";if(!b.allow_svg_data_urls&&/^data:image\/svg/i.test(a))return""}return"url('"+(t=l?l.call(f,t,"style"):t).replace(/\'/g,"\\'")+"')"}var n,r,o,u,s,c={},l=b.url_converter,f=b.url_converter_scope||this,a=function(e,t,n){var r,o,i,a;if((r=c[e+"-top"+t])&&(o=c[e+"-right"+t])&&(i=c[e+"-bottom"+t])&&(a=c[e+"-left"+t])){var u=[r,o,i,a];for(C=u.length-1;C--&&u[C]===u[C+1];);-1<C&&n||(c[e+t]=-1===C?u[0]:u.join(" "),delete c[e+"-top"+t],delete c[e+"-right"+t],delete c[e+"-bottom"+t],delete c[e+"-left"+t])}},p=function(e,t){return o&&(e=e.replace(/\uFEFF[0-9]/g,function(e){return S[e]})),e=!t?e.replace(/\\([\'\";:])/g,"$1"):e},h=function(e){return String.fromCharCode(parseInt(e.slice(1),16))};if(e){for(e=(e=e.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,g).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(e){return e.replace(/[;:]/g,g)});r=N.exec(e);)if(N.lastIndex=r.index+r[0].length,n=r[1].replace(E,"").toLowerCase(),r=r[2].replace(E,""),n&&r){if(n=v(n),r=v(r),-1!==n.indexOf(T)||-1!==n.indexOf('"'))continue;if(!b.allow_script_urls&&("behavior"===n||/expression\s*\(|\/\*|\*\//.test(r)))continue;"font-weight"===n&&"700"===r?r="bold":"color"!==n&&"background-color"!==n||(r=r.toLowerCase()),r=(r=r.replace(x,mi)).replace(w,y),c[n]=o?p(r,!0):r}a("border","",!0),a("border","-width"),a("border","-color"),a("border","-style"),a("padding",""),a("margin",""),u="border-style",s="border-color",m(a="border-width")&&m(u)&&m(s)&&(c.border=c[a]+" "+c[u]+" "+c[s],delete c[a],delete c[u],delete c[s]),"medium none"===c.border&&delete c.border,"none"===c["border-image"]&&delete c["border-image"]}return c},serialize:function(i,e){function s(e){var t,n,r,o;if(t=c[e])for(n=0,r=t.length;n<r;n++)e=t[n],(o=i[e])&&(u+=(0<u.length?" ":"")+e+": "+o+";")}var t,n,r,o,a,u="";if(e&&c)s("*"),s(e);else for(t in i)!(n=i[t])||l&&(r=t,o=e,a=void 0,(a=l["*"])&&a[r]||(a=l[o])&&a[r])||(u+=(0<u.length?" ":"")+t+": "+n+";");return u}}}function wi(e,t){var r=t.attr("style"),r=(r=e.serialize(e.parse(r),t[0].nodeName))||null;t.attr("data-mce-style",r)}function Ni(e,t){var n,r,o=0;if(e)for(n=e.nodeType,e=e.previousSibling;e;e=e.previousSibling)r=e.nodeType,(!t||3!==r||r!==n&&e.nodeValue.length)&&(o++,n=r);return o}var hi=Xt.each,vi=Xt.grep,yi=fe.ie,bi=/^([a-z0-9],?)+$/i,Ci=/^[ \t\r\n]*$/;function Ei(a,u){var c=this;void 0===u&&(u={});function v(r,t,n){var o,i=h(r);return o=void 0===(o=i.length?(r=s[t])&&r.get?r.get(i,t):i.attr(t):o)?n||"":o}function y(t){return(t=p(t))?t.attributes:[]}function x(e,t){return Zr_getPos(a.body,p(e),t)}function N(e){var t,n;return e=p(e),t=w(e,"width"),n=w(e,"height"),-1===t.indexOf("px")&&(t=0),-1===n.indexOf("px")&&(n=0),{w:parseInt(t,10)||e.offsetWidth||e.clientWidth,h:parseInt(n,10)||e.offsetHeight||e.clientHeight}}function S(e,t,n,r){var o,i=[],a=p(e);for(r=void 0===r,n=n||("BODY"!==C().nodeName?C().parentNode:null),Xt.is(t,"string")&&(t="*"===(o=t)?function(e){return 1===e.nodeType}:function(e){return E(e,o)});a&&a!==n&&a.nodeType&&9!==a.nodeType;){if(!t||"function"==typeof t&&t(a)){if(!r)return[a];i.push(a)}a=a.parentNode}return r?i:null}function T(e,t,n){var r=t;if(e)for("string"==typeof t&&(r=function(e){return E(e,t)}),e=e[n];e;e=e[n])if("function"==typeof r&&r(e))return e;return null}function D(e,t,n){return R(a.createElement(e),e,t,n,!0)}function P(n,t){return n=h(n),(t?n.each(function(){for(var e;e=this.firstChild;)3===e.nodeType&&0===e.data.length?this.removeChild(e):this.parentNode.insertBefore(e,this)}):n).remove(),1<n.length?n.toArray():n[0]}function I(e,t,n){h(e).toggleClass(t,n).each(function(){""===this.className&&gn(this).attr("class",null)})}function L(t,e,n){return k(e,function(e){return Xt.is(e,"array")&&(t=t.cloneNode(!0)),n&&hi(vi(e.childNodes),function(e){t.appendChild(e)}),e.parentNode.replaceChild(t,e)})}function F(){return a.createRange()}function U(e){if(e&&jo.isElement(e)){var t=e.getAttribute("data-mce-contenteditable");return t&&"inherit"!==t?t:"inherit"!==e.contentEditable?e.contentEditable:null}return null}var r={},i=V.window,o={},t=0,e=function(m,g){function t(t){return uo.nu(function(e){n(t,H(e,q(mo_value(t))),H(e,q(mo_error(t))))})}function o(e){return e.fold($,$)}var h=0,v={},p=(g=void 0===g?{}:g).maxLoadTime||5e3,y=function(e){m.getElementsByTagName("head")[0].appendChild(e)},n=function(e,t,d){function u(){for(var e=a.passed,t=e.length;t--;)e[t]();a.status=2,a.passed=[],a.failed=[]}function c(e,t){e()||((new Date).getTime()-i<p?he.setTimeout(t):s())}function l(){c(function(){for(var t,n=m.styleSheets,r=n.length;r--;)if((t=(t=n[r]).ownerNode?t.ownerNode:t.owningElement)&&t.id===o.id)return u(),1},l)}function f(){c(function(){try{var e=r.sheet.cssRules;return u(),e}catch(t){}},f)}var o,r,i,a,s=function(){for(var e=a.failed,t=e.length;t--;)e[t]();a.status=3,a.passed=[],a.failed=[]};if(e=Xt._addCacheSuffix(e),v[e]?a=v[e]:(a={passed:[],failed:[]},v[e]=a),t&&a.passed.push(t),d&&a.failed.push(d),1!==a.status)if(2!==a.status)if(3!==a.status){if(a.status=1,(o=m.createElement("link")).rel="stylesheet",o.type="text/css",o.id="u"+h++,o.async=!1,o.defer=!1,i=(new Date).getTime(),g.contentCssCors&&(o.crossOrigin="anonymous"),"onload"in o&&!((d=V.navigator.userAgent.match(/WebKit\/(\d*)/))&&parseInt(d[1],10)<536))o.onload=l,o.onerror=s;else{if(0<V.navigator.userAgent.indexOf("Firefox"))return(r=m.createElement("style")).textContent='@import "'+e+'"',f(),void y(r);l()}y(o),o.href=e}else s();else u()};return{load:n,loadAll:function(e,n,r){!function(e){return so(e,uo.nu)}(W(e,t)).get(function(t){t=K(t,function(e){return e.isValue()});0<t.fail.length?r(t.fail.map(o)):n(t.pass.map(o))})}}}(a,{contentCssCors:u.contentCssCors}),l=[],f=u.schema||di({}),d=gi({url_converter:u.url_converter,url_converter_scope:u.url_converter_scope},u.schema),m=u.ownEvents?new Se(u.proxy):Se.Event,n=f.getBlockElements(),g=gn.overrideDefaults(function(){return{context:a,element:j.getRoot()}}),p=function(e){if(e&&a&&"string"==typeof e){var t=a.getElementById(e);return t&&t.id!==e?a.getElementsByName(e)[1]:t}return e},h=function(e){return"string"==typeof e&&(e=p(e)),g(e)},b=function(o,t,n){""===n&&(n=null);var i=h(o),r=i.attr(t);i.length&&((o=s[t])&&o.set?o.set(i,n,t):i.attr(t,n),r!==n&&u.onSetAttrib&&u.onSetAttrib({attrElm:i,attrName:t,attrValue:n}))},C=function(){return u.root_element||a.body},w=function(r,t,n){r=h(r);return n?r.css(t):("float"===(t=t.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}))&&(t=fe.ie&&fe.ie<12?"styleFloat":"cssFloat"),r[0]&&r[0].style?r[0].style[t]:void 0)},E=function(i,t){if(!i)return!1;if(!Array.isArray(i)){if("*"===t)return 1===i.nodeType;if(bi.test(t)){for(var r=t.toLowerCase().split(/,/),o=i.nodeName.toLowerCase(),n=r.length-1;0<=n;n--)if(r[n]===o)return!0;return!1}if(i.nodeType&&1!==i.nodeType)return!1}i=Array.isArray(i)?i:[i];return 0<St(t,i[0].ownerDocument||i[0],null,i).length},k=function(t,n,r){var o,t="string"==typeof t?p(t):t;return!!t&&(Xt.isArray(t)&&(t.length||0===t.length)?(o=[],hi(t,function(e,t){e&&("string"==typeof e&&(e=p(e)),o.push(n.call(r,e,t)))}),o):n.call(r||c,t))},_=function(e,t){h(e).each(function(e,n){hi(t,function(e,t){b(n,t,e)})})},A=function(t,r){t=h(t);yi?t.each(function(e,t){if(!1!==t.canHaveHTML){for(;t.firstChild;)t.removeChild(t.firstChild);try{t.innerHTML="<br>"+r,t.removeChild(t.firstChild)}catch(n){gn("<div></div>").html("<br>"+r).contents().slice(1).appendTo(t)}return r}}):t.html(r)},R=function(e,n,r,o,i){return k(e,function(e){var t="string"==typeof n?a.createElement(n):n;return _(t,r),o&&("string"!=typeof o&&o.nodeType?t.appendChild(o):"string"==typeof o&&A(t,o)),i?t:e.appendChild(t)})},O=ti.decode,B=ti.encodeAllRaw,M=function(e,t,n,r){if(Xt.isArray(e)){for(var o=e.length;o--;)e[o]=M(e[o],t,n,r);return e}return!u.collect||e!==a&&e!==i||l.push([e,t,n,r]),m.bind(e,t,n,r||j)},z=function(e,t,n){var r;if(Xt.isArray(e)){for(r=e.length;r--;)e[r]=z(e[r],t,n);return e}if(l&&(e===a||e===i))for(r=l.length;r--;){var o=l[r];e!==o[0]||t&&t!==o[1]||n&&n!==o[2]||m.unbind(o[0],o[1],o[2])}return m.unbind(e,t,n)},j={doc:a,settings:u,win:i,files:o,stdMode:!0,boxModel:!0,styleSheetLoader:e,boundEvents:l,styles:d,schema:f,events:m,isBlock:function(e){if("string"==typeof e)return!!n[e];if(e){var t=e.nodeType;if(t)return!(1!==t||!n[e.nodeName])}return!1},$:g,$$:h,root:null,clone:function(t,e){if(!yi||1!==t.nodeType||e)return t.cloneNode(e);if(e)return null;var n=a.createElement(t.nodeName);return hi(y(t),function(e){b(n,e.nodeName,v(t,e.nodeName))}),n},getRoot:C,getViewPort:function(n){var t=n||i,n=t.document.documentElement;return{x:t.pageXOffset||n.scrollLeft,y:t.pageYOffset||n.scrollTop,w:t.innerWidth||n.clientWidth,h:t.innerHeight||n.clientHeight}},getRect:function(n){var t;return n=p(n),t=x(n),n=N(n),{x:t.x,y:t.y,w:n.w,h:n.h}},getSize:N,getParent:function(e,t,r){r=S(e,t,r,!1);return r&&0<r.length?r[0]:null},getParents:S,get:p,getNext:function(e,t){return T(e,t,"nextSibling")},getPrev:function(e,t){return T(e,t,"previousSibling")},select:function(e,t){return St(e,p(t)||u.root_element||a,[])},is:E,add:R,create:D,createHTML:function(e,t,n){var r,o="";for(r in o+="<"+e,t)t.hasOwnProperty(r)&&null!==t[r]&&void 0!==t[r]&&(o+=" "+r+'="'+B(t[r])+'"');return void 0!==n?o+">"+n+"</"+e+">":o+" />"},createFragment:function(e){var t,n=a.createElement("div"),r=a.createDocumentFragment();for(r.appendChild(n),e&&(n.innerHTML=e);t=n.firstChild;)r.appendChild(t);return r.removeChild(n),r},remove:P,setStyle:function(e,t,r){r=h(e).css(t,r);u.update_styles&&wi(d,r)},getStyle:w,setStyles:function(e,n){n=h(e).css(n);u.update_styles&&wi(d,n)},removeAllAttribs:function(e){return k(e,function(e){for(var n=e.attributes,t=n.length-1;0<=t;t--)e.removeAttributeNode(n.item(t))})},setAttrib:b,setAttribs:_,getAttrib:v,getPos:x,parseStyle:function(e){return d.parse(e)},serializeStyle:function(e,t){return d.serialize(e,t)},addStyle:function(e){var t,n;if(j!==Ei.DOM&&a===V.document){if(r[e])return;r[e]=!0}(n=a.getElementById("mceDefaultStyles"))||((n=a.createElement("style")).id="mceDefaultStyles",n.type="text/css",(t=a.getElementsByTagName("head")[0]).firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(a.createTextNode(e))},loadCSS:function(e){var n;j===Ei.DOM||a!==V.document?(e=e||"",n=a.getElementsByTagName("head")[0],hi(e.split(","),function(t){t=Xt._addCacheSuffix(t),o[t]||(o[t]=!0,t=D("link",{rel:"stylesheet",href:t}),n.appendChild(t))})):Ei.DOM.loadCSS(e)},addClass:function(e,t){h(e).addClass(t)},removeClass:function(e,t){I(e,t,!1)},hasClass:function(e,t){return h(e).hasClass(t)},toggleClass:I,show:function(e){h(e).show()},hide:function(e){h(e).hide()},isHidden:function(e){return"none"===h(e).css("display")},uniqueId:function(e){return(e||"mce_")+t++},setHTML:A,getOuterHTML:function(t){t="string"==typeof t?p(t):t;return jo.isElement(t)?t.outerHTML:gn("<div></div>").append(gn(t).clone()).html()},setOuterHTML:function(e,t){h(e).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=t)}catch(e){}P(gn(this).html(t),!0)})},decode:O,encode:B,insertAfter:function(e,t){var r=p(t);return k(e,function(e){var n,t=r.parentNode;return(n=r.nextSibling)?t.insertBefore(e,n):t.appendChild(e),e})},replace:L,rename:function(t,e){var n;return t.nodeName!==e.toUpperCase()&&(n=D(e),hi(y(t),function(e){b(n,e.nodeName,v(t,e.nodeName))}),L(n,t,!0)),n||t},findCommonAncestor:function(e,t){for(var n,r=e;r;){for(n=t;n&&r!==n;)n=n.parentNode;if(r===n)break;r=r.parentNode}return!r&&e.ownerDocument?e.ownerDocument.documentElement:r},toHex:function(e){return d.toHex(Xt.trim(e))},run:k,getAttribs:y,isEmpty:function(e,t){var n,r,o,i,a,u,s=0;if(e=e.firstChild){a=new go(e,e.parentNode),t=t||(f?f.getNonEmptyElements():null),i=f?f.getWhiteSpaceElements():{};do{if(o=e.nodeType,jo.isElement(e)){var c=e.getAttribute("data-mce-bogus");if(c){e=a.next("all"===c);continue}if(u=e.nodeName.toLowerCase(),t&&t[u]){if("br"!==u)return!1;s++,e=a.next();continue}for(n=(r=y(e)).length;n--;)if("name"===(u=r[n].nodeName)||"data-mce-bookmark"===u)return!1}if(8===o)return!1;if(3===o&&!Ci.test(e.nodeValue))return!1;if(3===o&&e.parentNode&&i[e.parentNode.nodeName]&&Ci.test(e.nodeValue))return!1;e=a.next()}while(e)}return s<=1},createRng:F,nodeIndex:Ni,split:function(e,t,n){var r,o,i=F();if(e&&t)return i.setStart(e.parentNode,Ni(e)),i.setEnd(t.parentNode,Ni(t)),r=i.extractContents(),(i=F()).setStart(t.parentNode,Ni(t)+1),i.setEnd(e.parentNode,Ni(e)+1),o=i.extractContents(),(i=e.parentNode).insertBefore(qo_trimNode(j,r),e),n?i.insertBefore(n,e):i.insertBefore(t,e),i.insertBefore(qo_trimNode(j,o),e),P(e),n||t},bind:M,unbind:z,fire:function(e,t,n){return m.fire(e,t,n)},getContentEditable:U,getContentEditableParent:function(e){for(var t=C(),n=null;e&&e!==t&&null===(n=U(e));e=e.parentNode);return n},destroy:function(){if(l)for(var e=l.length;e--;){var t=l[e];m.unbind(t[0],t[1],t[2])}St.setDocument&&St.setDocument()},isChildOf:function(e,t){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},dumpRng:function(e){return"startContainer: "+e.startContainer.nodeName+", startOffset: "+e.startOffset+", endContainer: "+e.endContainer.nodeName+", endOffset: "+e.endOffset}},s=function(n,r,o){var e={},i=r.keep_values,t={set:function(e,t,n){r.url_converter&&(t=r.url_converter.call(r.url_converter_scope||o(),t,n,e[0])),e.attr("data-mce-"+n,t).attr(n,t)},get:function(e,t){return e.attr("data-mce-"+t)||e.attr(t)}},e={style:{set:function(e,t){null===t||"object"!=typeof t?(i&&e.attr("data-mce-style",t),e.attr("style",t)):e.css(t)},get:function(e){var t=e.attr("data-mce-style")||e.attr("style");return n.serialize(n.parse(t),e[0].nodeName)}}};return i&&(e.href=e.src=t),e}(d,u,function(){return j});return j}(RN=Ei=Ei||{}).DOM=RN(V.document),RN.nodeIndex=Ni;function Ai(e){return"function"==typeof e}var Si=Ei,Ti=Si.DOM,ki=Xt.each,_i=Xt.grep,Ri=function(){var l={},o=[],i={},a=[],f=0;this.isDone=function(e){return 2===l[e]},this.markDone=function(e){l[e]=2},this.add=this.load=function(e,t,n,r){void 0===l[e]&&(o.push(e),l[e]=0),t&&(i[e]||(i[e]=[]),i[e].push({success:t,failure:r,scope:n||this}))},this.remove=function(e){delete l[e],delete i[e]},this.loadQueue=function(e,t,n){this.loadScripts(o,e,t,n)},this.loadScripts=function(n,e,t,r){var u,s=[],c=function(t,e){ki(i[e],function(e){Ai(e[t])&&e[t].call(e.scope)}),i[e]=void 0};a.push({success:e,failure:r,scope:t||this}),(u=function(){var t=_i(n);n.length=0,ki(t,function(e){var t,n,r,o,i,a;2!==l[e]?3!==l[e]?1!==l[e]&&(l[e]=1,f++,t=e,n=function(){l[e]=2,f--,c("success",e),u()},r=function(){l[e]=3,f--,s.push(e),c("failure",e),u()},i=(a=Ti).uniqueId(),(o=V.document.createElement("script")).id=i,o.type="text/javascript",o.src=Xt._addCacheSuffix(t),o.onload=function(){a.remove(i),o&&(o.onreadystatechange=o.onload=o=null),n()},o.onerror=function(){r()},(V.document.getElementsByTagName("head")[0]||V.document.body).appendChild(o)):c("failure",e):c("success",e)}),f||(t=a.slice(0),a.length=0,ki(t,function(e){0===s.length?Ai(e.success)&&e.success.call(e.scope):Ai(e.failure)&&e.failure.call(e.scope,s)}))})()}};Ri.ScriptLoader=new Ri;var Oi=Xt.each;function Bi(){function l(o,n,t,r){o=s(o),Oi(o,function(t){t=c(n,t);f(t.resource,t,void 0,void 0)}),t&&(r?t.call(r):t.call(Ri))}var r=this,o=[],a={},u={},i=[],s=function(e){var t;return(t=u[e]?u[e].dependencies:t)||[]},c=function(e,t){return"object"==typeof t?t:"string"==typeof e?{prefix:"",resource:t,suffix:""}:{prefix:e.prefix,resource:t,suffix:e.suffix}},f=function(e,t,n,r,o){var i;a[e]||(0!==(i="string"==typeof t?t:t.prefix+t.resource+t.suffix).indexOf("/")&&-1===i.indexOf("://")&&(i=Bi.baseURL+"/"+i),a[e]=i.substring(0,i.lastIndexOf("/")),u[e]?l(e,t,n,r):Ri.ScriptLoader.add(i,function(){return l(e,t,n,r)},r,o))};return{items:o,urls:a,lookup:u,_listeners:i,get:function(e){return u[e]?u[e].instance:void 0},dependencies:s,requireLangPack:function(e,t){var n=Bi.language;if(n&&!1!==Bi.languageLoad){if(t)if(-1!==(t=","+t+",").indexOf(","+n.substr(0,2)+","))n=n.substr(0,2);else if(-1===t.indexOf(","+n+","))return;Ri.ScriptLoader.add(a[e]+"/langs/"+n+".js")}},add:function(t,e,r){o.push(e),u[t]={instance:e,dependencies:r};r=K(i,function(e){return e.name===t});return i=r.fail,Oi(r.pass,function(e){e.callback()}),e},remove:function(e){delete a[e],delete u[e]},createUrl:c,addComponents:function(e,t){var n=r.urls[e];Oi(t,function(e){Ri.ScriptLoader.add(n+"/"+e)})},load:f,waitFor:function(e,t){u.hasOwnProperty(e)?t():i.push({name:e,callback:t})}}}(oE=Bi=Bi||{}).PluginManager=oE(),oE.ThemeManager=oE();function Ii(e,t){qr(e).fold(function(){Vr(e).each(function(e){Fi(e,t)})},function(e){Pi(e,t)})}function Li(t,n){Yr(t).fold(function(){Fi(t,n)},function(e){t.dom().insertBefore(n.dom(),e.dom())})}function Mi(t,e){z(e,function(e){Fi(t,e)})}function zi(e){e.dom().textContent="",z(Kr(e),function(e){Ui(e)})}function ji(e){var t,n=Kr(e);0<n.length&&(t=e,z(n,function(e){Pi(t,e)})),Ui(e)}function Vi(n,r){var o=null;return{cancel:function(){null!==o&&(V.clearTimeout(o),o=null)},throttle:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];null===o&&(o=V.setTimeout(function(){n.apply(null,e),o=null},r))}}}function qi(e,n){return void 0===(n=Er(e,n))||""===n?[]:n.split(" ")}function Ji(e,t){var n=[];return z(Kr(e),function(e){n=(n=t(e)?n.concat([e]):n).concat(Ji(e,t))}),n}var Pi=function(t,n){Vr(t).each(function(e){e.dom().insertBefore(n.dom(),t.dom())})},Fi=function(e,t){e.dom().appendChild(t.dom())},Ui=function(t){t=t.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Hi=function(n){var t=n,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return Hi(t)}}},$i=function(e){return void 0!==e.dom().classList},Ki=function(i,r){return o=r,0<(i=U(qi(n=i,r="class"),function(e){return e!==o})).length?wr(n,r,i.join(" ")):Sr(n,r),!1;var n,o},Xi=function(n,i){$i(n)?n.dom().classList.add(i):(i=i=i,i=qi(n=n=n,"class").concat([i]),wr(n,"class",i.join(" ")))},Yi=function(e){0===($i(e)?e.dom().classList:qi(e,"class")).length&&Sr(e,"class")},Gi=function(e,t){return $i(e)&&e.dom().classList.contains(t)},Qi=function(o,n){return n=n,o=void 0===o?V.document:o.dom(),Fr(o)?[]:W(o.querySelectorAll(n),ar.fromDom)};function Zi(e,t,n,r,o){return e(n,r)?_.some(n):D(o)&&o(n)?_.none():t(n,r,o)}function ta(e,t,n){for(var r=e.dom(),o=D(n)?n:q(!1);r.parentNode;){var r=r.parentNode,i=ar.fromDom(r);if(t(i))return _.some(i);if(o(i))break}return _.none()}function ra(e,t,n){return ta(e,function(e){return Lr(e,t)},n)}function oa(o,n){return n=n,o=void 0===o?V.document:o.dom(),Fr(o)?_.none():_.from(o.querySelector(n)).map(ar.fromDom)}function pa(e,t){return ar.fromDom(e.dom().cloneNode(t))}function ha(e){return pa(e,!1)}function va(e){return pa(e,!0)}function Ta(e){return Ea(e)&&Ca(e.data)}function Oa(e){return Ea(e)&&e.data[0]===xa}function Ba(e){return Ea(e)&&e.data[e.data.length-1]===xa}function Pa(e){return e&&e.hasAttribute("data-mce-caret")?(n=(n=e.getElementsByTagName("br"))[n.length-1],jo.isBogus(n)&&n.parentNode.removeChild(n),e.removeAttribute("data-mce-caret"),e.removeAttribute("data-mce-bogus"),e.removeAttribute("style"),e.removeAttribute("_moz_abspos"),e):null;var n}function Ha(e){return!Va(e)&&(Ma(e)?!za(e.parentNode):Ua(e)||Fa(e)||ja(e)||qa(e))}function qa(e){return!1===(jo.isElement(t=e)&&"true"===t.getAttribute("unselectable"))&&La(e);var t}function $a(e,t){return Ha(e)&&function(e,t){for(e=e.parentNode;e&&e!==t;e=e.parentNode){if(qa(e))return!1;if(Ia(e))return!0}return!0}(e,t)}function Xa(e,t){return e=Ka(e),t||(e.left=e.left+e.width),e.right=e.left,e.width=0,e}function Ya(e,t,n){return 0<=e&&e<=Math.min(t.height,n.height)/2}function Ga(e,t){var n=Math.min(t.height/2,e.height/2);return e.bottom-n<t.top||!(e.top>t.bottom)&&Ya(t.top-e.bottom,e,t)}function Ja(e,t){return e.top>t.bottom||!(e.bottom<t.top)&&Ya(t.bottom-e.top,e,t)}function Za(e){var t=e.startContainer,n=e.startOffset;return t.hasChildNodes()&&e.endOffset===n+1?t.childNodes[n]:null}function yu(e){return e&&/[\r\n\t ]/.test(e)}function bu(e){return!!e.setStart&&!!e.setEnd}function xu(e){return 0===e.left&&0===e.right&&0===e.top&&0===e.bottom}var ea,na=function(e,t,n){return Zi(function(e,t){return t(e)},ta,e,t,n)},ia=function(e,t,n){return Zi(Lr,ra,e,t,n)},aa=q("mce-annotation"),ua=q("data-mce-annotation"),sa=q("data-mce-annotation-uid"),ca=function(r,u){function s(e,t){return n=t,(r=e.dom())&&r.hasAttribute&&r.hasAttribute(n)?_.some(Er(e,t)):_.none();var n,r}var t=r.selection.getRng(),a=ar.fromDom(t.startContainer),o=ar.fromDom(r.getBody()),u=u.fold(function(){return"."+aa()},function(e){return"["+ua()+'="'+e+'"]'}),a=Xr(a,t.startOffset).getOr(a),u=ia(a,u,function(e){return Mr(e,o)});return u.bind(function(e){return s(e,""+sa()).bind(function(n){return s(e,""+ua()).map(function(e){var t=la(r,n);return{uid:n,name:e,elements:t}})})})},la=function(n,t){n=ar.fromDom(n.getBody());return Qi(n,"["+sa()+'="'+t+'"]')},ma=function(){return(ma=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ga=0,ya=function(e,n){var a=Ur(e).dom(),i=ar.fromDom(a.createDocumentFragment()),a=(n=n,(a=(a||V.document).createElement("div")).innerHTML=n,Kr(ar.fromDom(a)));Mi(i,a),zi(e),Fi(e,i)},ba="\ufeff",Ca=function(e){return e===ba},xa=ba,wa=function(e){return e.replace(new RegExp(ba,"g"),"")},Na=jo.isElement,Ea=jo.isText,Sa=function(e){return Ea(e)&&(e=e.parentNode),Na(e)&&e.hasAttribute("data-mce-caret")},ka=function(e){return Sa(e)||Ta(e)},_a=function(e){return e.firstChild!==e.lastChild||!jo.isBr(e.firstChild)},Aa=function(e){var t=e.container();return!(!e||!jo.isText(t))&&(t.data.charAt(e.offset())===xa||e.isAtStart()&&Ta(t.previousSibling))},Ra=function(e){var t=e.container();return!(!e||!jo.isText(t))&&(t.data.charAt(e.offset()-1)===xa||e.isAtEnd()&&Ta(t.nextSibling))},Ia=jo.isContentEditableTrue,La=jo.isContentEditableFalse,Fa=jo.isBr,Ma=jo.isText,za=jo.matchNodeNames("script style textarea"),Ua=jo.matchNodeNames("img input textarea hr iframe video audio object"),ja=jo.matchNodeNames("table"),Va=ka,Wa=Math.round,Ka=function(e){return e?{left:Wa(e.left),top:Wa(e.top),bottom:Wa(e.bottom),right:Wa(e.right),width:Wa(e.width),height:Wa(e.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},Qa=function(e,t,n){return t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom},eu=function(e,t){return 1===e.nodeType&&e.hasChildNodes()&&(t>=e.childNodes.length&&(t=e.childNodes.length-1),e=e.childNodes[t]),e},tu=new RegExp("[Ì-Í¯Ò-ÒÒ-ÒÖ-Ö½Ö¿×-××-××Ø-ØÙ-ÙÙ°Û-ÛÛ-Û¤Û§-Û¨Ûª-Û­ÜÜ°-ÝÞ¦-Þ°ß«-ß³à -à à -à £à ¥-à §à ©-à ­à¡-à¡à££-à¤à¤ºà¤¼à¥-à¥à¥à¥-à¥à¥¢-à¥£à¦à¦¼à¦¾à§-à§à§à§à§¢-à§£à¨-à¨à¨¼à©-à©à©-à©à©-à©à©à©°-à©±à©µàª-àªàª¼à«-à«à«-à«à«à«¢-à«£à¬à¬¼à¬¾à¬¿à­-à­à­à­à­à­¢-à­£à®à®¾à¯à¯à¯à°à°¾-à±à±-à±à±-à±à±-à±à±¢-à±£à²à²¼à²¿à³à³à³-à³à³-à³à³¢-à³£à´à´¾àµ-àµàµàµàµ¢-àµ£à·à·à·-à·à·à·à¸±à¸´-à¸ºà¹-à¹àº±àº´-àº¹àº»-àº¼à»-à»à¼-à¼à¼µà¼·à¼¹à½±-à½¾à¾-à¾à¾-à¾à¾-à¾à¾-à¾¼à¿á­-á°á²-á·á¹-áºá½-á¾á-áá-á á±-á´áá-áááá-áá-áá²-á´á-áá²-á³á´-áµá·-á½áá-ááá -á á¢©á¤ -á¤¢á¤§-á¤¨á¤²á¤¹-á¤»á¨-á¨á¨á©á©-á©á© á©¢á©¥-á©¬á©³-á©¼á©¿áª°-áª½áª¾á¬-á¬á¬´á¬¶-á¬ºá¬¼á­á­«-á­³á®-á®á®¢-á®¥á®¨-á®©á®«-á®­á¯¦á¯¨-á¯©á¯­á¯¯-á¯±á°¬-á°³á°¶-á°·á³-á³á³-á³ á³¢-á³¨á³­á³´á³¸-á³¹á·-á·µá·¼-á·¿â-ââ-ââ-â â¡â¢-â¤â¥-â°â³¯-â³±âµ¿â· -â·¿ãª-ã­ã®-ã¯ã-ãê¯ê°-ê²ê´-ê½ê-êê°-ê±ê ê ê ê ¥-ê ¦ê£ê£ -ê£±ê¤¦-ê¤­ê¥-ê¥ê¦-ê¦ê¦³ê¦¶-ê¦¹ê¦¼ê§¥ê¨©-ê¨®ê¨±-ê¨²ê¨µ-ê¨¶ê©ê©ê©¼êª°êª²-êª´êª·-êª¸êª¾-êª¿ê«ê«¬-ê«­ê«¶ê¯¥ê¯¨ê¯­ï¬ï¸-ï¸ï¸ -ï¸¯ï¾-ï¾]"),nu=function(e){return"string"==typeof e&&768<=e.charCodeAt(0)&&tu.test(e)},ru=function(e,t,n){return e.isSome()&&t.isSome()?_.some(n(e.getOrDie(),t.getOrDie())):_.none()},ou=[].slice,uu=jo.isElement,LN=Ha,cu=jo.matchStyleValues("display","block table"),jN=jo.matchStyleValues("float","left right"),fu=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ou.call(arguments);return function(e){for(var t=0;t<n.length;t++)if(!n[t](e))return!1;return!0}}(uu,LN,y(jN)),du=y(jo.matchStyleValues("white-space","pre pre-line pre-wrap")),mu=jo.isText,gu=jo.isBr,pu=Si.nodeIndex,hu=eu,vu=function(e){return"createRange"in e?e.createRange():Si.DOM.createRng()},Cu=function(e){var t=e.startContainer,r=e.startOffset;return!!(yu(e.toString())&&du(t.parentNode)&&jo.isText(t)&&(t=t.data,yu(t[r-1])||yu(t[r+1])))},wu=function(e){var r,o,u,s,t=0<(u=e.getClientRects()).length?Ka(u[0]):Ka(e.getBoundingClientRect());return!bu(e)&&gu(e)&&xu(t)?(s=(r=e).ownerDocument,o=vu(s),u=s.createTextNode("Â "),(s=r.parentNode).insertBefore(u,r),o.setStart(u,0),o.setEnd(u,1),o=Ka(o.getBoundingClientRect()),s.removeChild(u),o):xu(t)&&bu(e)?function(i){var t=i.startContainer,n=i.endContainer,r=i.startOffset,o=i.endOffset;if(t===n&&jo.isText(n)&&0===r&&1===o){i=i.cloneRange();return i.setEndAfter(n),wu(i)}return null}(e):t},Nu=function(e,n){n=Xa(e,n);return n.width=1,n.right=n.left+1,n};function Su(t,n,e){function r(){return e=e||function(t){function o(e){var n;0!==e.height&&(0<r.length&&(n=r[r.length-1],e.left===n.left&&e.top===n.top&&e.bottom===n.bottom&&e.right===n.right)||r.push(e))}function i(e,t){var n=vu(e.ownerDocument);if(t<e.data.length){if(nu(e.data[t]))return r;if(nu(e.data[t-1])&&(n.setStart(e,t),n.setEnd(e,t+1),!Cu(n)))return o(Nu(wu(n),!1)),r}0<t&&(n.setStart(e,t-1),n.setEnd(e,t),Cu(n)||o(Nu(wu(n),!1))),t<e.data.length&&(n.setStart(e,t),n.setEnd(e,t+1),Cu(n)||o(Nu(wu(n),!0)))}var n,r=[];if(mu(t.container()))return i(t.container(),t.offset()),r;if(uu(t.container()))if(t.isAtEnd())n=hu(t.container(),t.offset()),mu(n)&&i(n,n.data.length),fu(n)&&!gu(n)&&o(Nu(wu(n),!1));else{if(n=hu(t.container(),t.offset()),mu(n)&&i(n,0),fu(n)&&t.isAtEnd())return o(Nu(wu(n),!1)),r;t=hu(t.container(),t.offset()-1),!fu(t)||gu(t)||!cu(t)&&!cu(n)&&fu(n)||o(Nu(wu(t),!1)),fu(n)&&o(Nu(wu(n),!0))}return r}(Su(t,n))}return{container:q(t),offset:q(n),toRange:function(){var e;return(e=vu(t.ownerDocument)).setStart(t,n),e.setEnd(t,n),e},getClientRects:r,isVisible:function(){return 0<r().length},isAtStart:function(){return mu(t),0===n},isAtEnd:function(){return mu(t)?n>=t.data.length:n>=t.childNodes.length},isEqual:function(e){return e&&t===e.container()&&n===e.offset()},getNode:function(e){return hu(t,e?n-1:n)}}}(ea=Su=Su||{}).fromRangeStart=function(e){return ea(e.startContainer,e.startOffset)},ea.fromRangeEnd=function(e){return ea(e.endContainer,e.endOffset)},ea.after=function(e){return ea(e.parentNode,pu(e)+1)},ea.before=function(e){return ea(e.parentNode,pu(e))},ea.isAbove=function(e,t){return ru(Z(t.getClientRects()),ee(e.getClientRects()),Ga).getOr(!1)},ea.isBelow=function(e,t){return ru(ee(t.getClientRects()),Z(e.getClientRects()),Ja).getOr(!1)},ea.isAtStart=function(e){return!!e&&e.isAtStart()},ea.isAtEnd=function(e){return!!e&&e.isAtEnd()},ea.isTextPosition=function(e){return!!e&&jo.isText(e.container())},ea.isElementPosition=function(e){return!1===ea.isTextPosition(e)};function Iu(o){var t,r,n;return(Au(o)?"text()":o.nodeName.toLowerCase())+"["+(r=Bu(Ou(t=o)),n=Ht.findIndex(r,Pu(t),t),r=r.slice(0,n+1),o=Ht.reduce(r,function(e,t,n){return Au(t)&&Au(r[n-1])&&e++,e},0),r=Ht.filter(r,jo.matchNodeNames(t.nodeName)),Ht.findIndex(r,Pu(t),t)-o)+"]"}function Lu(e,i){var o,u=[],a=i.container(),r=i.offset();return Au(a)?o=function(e,t){for(;(e=e.previousSibling)&&Au(e);)t+=e.data.length;return t}(a,r):(r>=(i=a.childNodes).length?(o="after",r=i.length-1):o="before",a=i[r]),u.push(Iu(a)),a=function(e,t){var r=[];for(t=t.parentNode;t!==e;t=t.parentNode)r.push(t);return r}(e,a),a=Ht.filter(a,y(jo.isBogus)),(u=u.concat(Ht.map(a,Iu))).reverse().join("/")+","+o}function Fu(r,t){var o;return t?(t=(o=t.split(","))[0].split("/"),o=1<o.length?o[1]:"before",(r=Ht.reduce(t,function(r,o){return(o=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(o))?("text()"===o[1]&&(o[1]="#text"),n=r,r=o[1],o=parseInt(o[2],10),i=Bu(n),i=Ht.filter(i,function(e,t){return!Au(e)||!Au(i[t-1])}),(i=Ht.filter(i,jo.matchNodeNames(r)))[o]):null;var n,i},r))?Au(r)?function(e,t){for(var n,r=e,o=0;Au(r);){if(n=r.data.length,o<=t&&t<=o+n){e=r,t-=o;break}if(!Au(r.nextSibling)){e=r,t=n;break}o+=n,r=r.nextSibling}return Au(e)&&t>e.data.length&&(t=e.data.length),_u(e,t)}(r,parseInt(o,10)):(o="after"===o?Du(r)+1:Du(r),_u(r.parentNode,o)):null):null}function zu(r,t,o){var i,a,u,s,c;jo.isDocumentFragment(o)?(i=r,a=t,s=_.from((u=o).firstChild),c=_.from(u.lastChild),a.insertNode(u),s.each(function(e){return Mu(i,e.previousSibling)}),c.each(function(e){return Mu(i,e.nextSibling)})):(r=r,t.insertNode(o=o),Mu(r,o.previousSibling),Mu(r,o.nextSibling))}function ju(e,i,n,u,c){var a=u[c?"startContainer":"endContainer"],u=u[c?"startOffset":"endOffset"],s=[],c=0,l=e.getRoot();for(jo.isText(a)?s.push(n?function(e,t,n){for(var o=e(t.data.slice(0,n)).length,r=t.previousSibling;r&&jo.isText(r);r=r.previousSibling)o+=e(r.data).length;return o}(i,a,u):u):(u>=(i=a.childNodes).length&&i.length&&(c=1,u=Math.max(0,i.length-1)),s.push(e.nodeIndex(i[u],n)+c));a&&a!==l;a=a.parentNode)s.push(e.nodeIndex(a,n));return s}function Vu(e,t,n){var r=0;return Xt.each(e.select(t),function(e){if("all"!==e.getAttribute("data-mce-bogus"))return e!==n&&void r++}),r}function qu(e){return Hu(e,!0),Hu(e,!1),e}function $u(e,n){return jo.isElement(e)&&(e=eu(e,n),Uu(e))?e:ka(e)?(n=(e=jo.isText(e)&&Sa(e)?e.parentNode:e).previousSibling,Uu(n)?n:(n=e.nextSibling,Uu(n)?n:void 0)):void 0}function Wu(u,c,d){var f=d.getNode(),s=f?f.nodeName:null,l=d.getRng();return Uu(f)||"IMG"===s?{name:s,index:Vu(d.dom,s,f)}:(f=$u((f=l).startContainer,f.startOffset)||$u(f.endContainer,f.endOffset))?{name:s=f.tagName,index:Vu(d.dom,s,f)}:(f=(s=d).dom,(d={}).start=ju(f,u=u,c=c,l=l,!0),s.isCollapsed()||(d.end=ju(f,u,c,l,!1)),d)}function Ku(e,r,n){return r={"data-mce-type":"bookmark",id:r,style:"overflow:hidden;line-height:0px"},n?e.create("span",r,"&#xFEFF;"):e.create("span",r)}function Xu(e,l){var n=e.dom,r=e.getRng(),o=n.uniqueId(),c=e.isCollapsed(),s=e.getNode(),u=s.nodeName;return"IMG"===u?{name:u,index:Vu(n,u,s)}:(s=qu(r.cloneRange()),c||(s.collapse(!1),c=Ku(n,o+"_end",l),zu(n,s,c)),(r=qu(r)).collapse(!0),l=Ku(n,o+"_start",l),zu(n,r,l),e.moveToBookmark({id:o,keep:1}),{id:o})}function Ju(e){return jo.isElement(e)&&e.id===Gu}function rs(e){var t=wa(e);return{count:e.length-t.length,text:t}}function os(e,t){return us(e),t}function fs(e,a,n){var r,o,s=Xa(a.getBoundingClientRect(),n),i="BODY"===e.tagName?(r=e.ownerDocument.documentElement,o=e.scrollLeft||r.scrollLeft,e.scrollTop||r.scrollTop):(i=e.getBoundingClientRect(),o=e.scrollLeft-i.left,e.scrollTop-i.top);return s.left+=o,s.right+=o,s.top+=i,s.bottom+=i,s.width=1,0<(a=a.offsetWidth-a.clientWidth)&&(n&&(a*=-1),s.left+=a,s.right+=a),s}function ds(a,u,e){function l(){!function(){for(var n,r,i,t=gn("*[contentEditable=false]",a),o=0;o<t.length;o++)r=(n=t[o]).previousSibling,Ba(r)&&(1===(i=r.data).length?r.parentNode.removeChild(r):r.deleteData(i.length-1,1)),r=n.nextSibling,Oa(r)&&(1===(i=r.data).length?r.parentNode.removeChild(r):r.deleteData(0,1))}(),s&&(ss.remove(s),s=null),c.get().each(function(e){gn(e.caret).remove(),c.set(_.none())}),clearInterval(t)}function f(){t=he.setInterval(function(){e()?gn("div.mce-visual-caret",a).toggleClass("mce-visual-caret-hidden"):gn("div.mce-visual-caret",a).addClass("mce-visual-caret-hidden")},500)}var t,s,c=Hi(_.none());return{show:function(t,e){var r;if(l(),jo.isElement(i=e)&&/^(TD|TH)$/i.test(i.tagName))return null;if(!u(e))return s=function(e,t){var n,r=e.ownerDocument.createTextNode(xa),o=e.parentNode;if(t){if(n=e.previousSibling,Ea(n)){if(ka(n))return n;if(Ba(n))return n.splitText(n.data.length-1)}o.insertBefore(r,e)}else{if(n=e.nextSibling,Ea(n)){if(ka(n))return n;if(Oa(n))return n.splitText(1),n}e.nextSibling?o.insertBefore(r,e.nextSibling):o.appendChild(r)}return r}(e,t),r=e.ownerDocument.createRange(),ls(s.nextSibling)?(r.setStart(s,0),r.setEnd(s,0)):(r.setStart(s,1),r.setEnd(s,1)),r;s=function(o,t,n){var r;return(r=t.ownerDocument.createElement(o)).setAttribute("data-mce-caret",n?"before":"after"),r.setAttribute("data-mce-bogus","all"),r.appendChild(((o=V.document.createElement("br")).setAttribute("data-mce-bogus","1"),o)),o=t.parentNode,n?o.insertBefore(r,t):t.nextSibling?o.insertBefore(r,t.nextSibling):o.appendChild(r),r}("p",e,t),i=fs(a,e,t),gn(s).css("top",i.top);var i=gn('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(i).appendTo(a)[0];return c.set(_.some({caret:i,element:e,before:t})),c.get().each(function(e){t&&gn(e.caret).addClass("mce-visual-caret-before")}),f(),(r=e.ownerDocument.createRange()).setStart(s,0),r.setEnd(s,0),r},hide:l,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},reposition:function(){c.get().each(function(e){var t=fs(a,e.element,e.before);gn(e.caret).css(t)})},destroy:function(){return he.clearInterval(t)}}}function ms(){return cs.isIE()||cs.isEdge()||cs.isFirefox()}function gs(e){return ls(e)||jo.isTable(e)&&ms()}function Es(e,t,n,r,o){var i=new go(e,r);if(ws(t)){if((ps(e)||ys(e))&&n(e=Ns(i.prev,!0)))return e;for(;e=Ns(i.prev,o);)if(n(e))return e}if(xs(t)){if((ps(e)||ys(e))&&n(e=Ns(i.next,!0)))return e;for(;e=Ns(i.next,o);)if(n(e))return e}return null}function Ts(e,t,n){return Ss(e.container(),n)===Ss(t.container(),n)}function ks(e,r){var n;return r?(n=r.container(),r=r.offset(),bs(n)?n.childNodes[r+e]:null):null}function As(e,t,n){for(var r,i,a,o=e?"previousSibling":"nextSibling";n&&n!==t;){if(r=n[o],vs(r)&&(r=r[o]),ps(r)){if(a=n,Ss(r,i=t)===Ss(a,i))return r;break}if(Cs(r))break;n=n.parentNode}return null}function Os(e,a,n){var r,u=d(As,!0,a),s=d(As,!1,a),o=n.startContainer,i=n.startOffset;if(Sa(o)){if("before"===(a=(o=!bs(o)?o.parentNode:o).getAttribute("data-mce-caret"))&&(r=o.nextSibling,gs(r)))return Rs(r);if("after"===a&&(r=o.previousSibling,gs(r)))return Ds(r)}if(!n.collapsed)return n;if(jo.isText(o)){if(vs(o)){if(1===e){if(r=s(o))return Rs(r);if(r=u(o))return Ds(r)}if(-1===e){if(r=u(o))return Ds(r);if(r=s(o))return Rs(r)}return n}if(Ba(o)&&i>=o.data.length-1)return 1===e&&(r=s(o))?Rs(r):n;if(Oa(o)&&i<=1)return-1===e&&(r=u(o))?Ds(r):n;if(i===o.data.length)return(r=s(o))?Rs(r):n;if(0===i)return(r=u(o))?Ds(r):n}return n}function Bs(e,t){return _.from(ks(e?0:-1,t)).filter(ps)}function Ps(e,t,r){return r=Os(e,t,r),-1===e?Su.fromRangeStart(r):Su.fromRangeEnd(r)}function Ls(e,t){for(;t=e(t);)if(t.isVisible())return t;return t}function Fs(e,n){return!((n=Ts(e,n))||!jo.isBr(e.getNode()))||n}var Tu,_u=Su,Au=jo.isText,Ru=jo.isBogus,Du=Si.nodeIndex,Ou=function(t){t=t.parentNode;return Ru(t)?Ou(t):t},Bu=function(e){return e?Ht.reduce(e.childNodes,function(e,t){return Ru(t)&&"BR"!==t.nodeName?e=e.concat(Bu(t)):e.push(t),e},[]):[]},Pu=function(t){return function(e){return t===e}},Mu=function(e,t){jo.isText(t)&&0===t.data.length&&e.remove(t)},Uu=jo.isContentEditableFalse,Hu=function(e,t){var o=t?"start":"end",n=e[o+"Container"],r=e[o+"Offset"];jo.isElement(n)&&"TR"===n.nodeName&&(n=(o=n.childNodes)[Math.min(t?r:r-1,o.length-1)])&&(r=t?0:n.childNodes.length,e["set"+(t?"Start":"End")](n,r))},Yu={getBookmark:function(e,t,o){return 2===t?Wu(wa,o,e):3===t?(o=(r=e).getRng(),{start:Lu(r.dom.getRoot(),_u.fromRangeStart(o)),end:Lu(r.dom.getRoot(),_u.fromRangeEnd(o))}):t?{rng:e.getRng()}:Xu(e,!1);var r},getUndoBookmark:d(Wu,$,!0),getPersistentBookmark:Xu},Gu="_mce_caret",Qu=function(e,t){for(;t&&t!==e;){if(t.id===Gu)return t;t=t.parentNode}return null},Zu=jo.isElement,es=jo.isText,ts=function(e){var t=e.parentNode;t&&t.removeChild(e)},ns=function(e,t){0===t.length?ts(e):e.nodeValue=t},us=function(e){var t;Zu(e)&&ka(e)&&(_a(e)?e.removeAttribute("data-mce-caret"):ts(e)),es(e)&&(t=wa(function(e){try{return e.nodeValue}catch(t){return""}}(e)),ns(e,t))},ss={removeAndReposition:function(n,r){return _u.isTextPosition(r)?function(e,t){return es(e)&&t.container()===e?(o=rs((n=e).data.substr(0,(r=t).offset())),a=rs(n.data.substr(r.offset())),0<(a=o.text+a.text).length?(ns(n,a),_u(n,r.offset()-o.count)):r):os(e,t);var n,r,o,a}(n,r):(n=n,((r=r).container()===n.parentNode?function(e,t){var i=t.container(),a=(a=te(i.childNodes),(-1===(a=L(a,e))?_.none():_.some(a)).map(function(e){return e<t.offset()?_u(i,t.offset()-1):t}).getOr(t));return us(e),a}:os)(n,r))},remove:us},cs=or.detect().browser,ls=jo.isContentEditableFalse,ps=jo.isContentEditableFalse,hs=jo.matchStyleValues("display","block table table-cell table-caption list-item"),vs=ka,ys=Sa,bs=jo.isElement,Cs=Ha,xs=function(e){return 0<e},ws=function(e){return e<0},Ns=function(e,t){for(var n;n=e(t);)if(!ys(n))return n;return null},Ss=function(e,t){for(;e&&e!==t;){if(hs(e))return e;e=e.parentNode}return null},Cp=function(e,t){var n=t.ownerDocument.createRange();return e?(n.setStartBefore(t),n.setEndBefore(t)):(n.setStartAfter(t),n.setEndAfter(t)),n},Rs=d(Cp,!0),Ds=d(Cp,!1),Is=function(e){return _.from(e.getNode()).map(ar.fromDom)};(QN=Tu=Tu||{})[QN.Backwards=-1]="Backwards",QN[QN.Forwards=1]="Forwards";function Ws(t){return Ua(t)||!!qa(t=t)&&!0!==j(te(t.getElementsByTagName("*")),function(e,t){return e||Ia(t)},!1)}function Xs(e,t){return e.hasChildNodes()&&t<e.childNodes.length?e.childNodes[t]:null}function Ys(e,t){if(xs(e)){if($s(t.previousSibling)&&!Vs(t.previousSibling))return _u.before(t);if(Vs(t))return _u(t,0)}if(ws(e)){if($s(t.nextSibling)&&!Vs(t.nextSibling))return _u.after(t);if(Vs(t))return _u(t,t.data.length)}return!ws(e)||qs(t)?_u.before(t):_u.after(t)}function Js(t){return{next:function(e){return Gs(Tu.Forwards,e,t)},prev:function(e){return Gs(Tu.Backwards,e,t)}}}function nc(e,r,n){return r=Js(r),_.from(e?r.next(n):r.prev(n))}function rc(t,n,r){return nc(t,n,r).bind(function(e){return Ts(r,e,n)&&function(r,t,n){return r?!ec(t,n)&&!(!_u.isTextPosition(r=t)&&jo.isBr(r.getNode()))&&Zs(t)&&Qs(n):!ec(n,t)&&Qs(t)&&Zs(n)}(t,r,e)?nc(t,n,e):_.some(e)})}function oc(t,n,e,r){return rc(t,n,e).bind(function(e){return r(e)?oc(t,n,e,r):_.some(e)})}function cc(e,t){return jo.isElement(t)&&e.isBlock(t)&&!t.innerHTML&&!fe.ie&&(t.innerHTML='<br data-mce-bogus="1" />'),t}function fc(o,i,r){return!(!1!==i.hasChildNodes()||!Qu(o,i)||(o=r,i=(r=i).ownerDocument.createTextNode(xa),r.appendChild(i),o.setStart(i,0),o.setEnd(i,0),0))}function dc(a,t,n,r){var o,i,u,s=n[t?"start":"end"],c=a.getRoot();if(s){for(a=s[0],i=c,o=s.length-1;1<=o;o--){if(u=i.childNodes,fc(c,i,r))return 1;if(s[o]>u.length-1)return!!fc(c,i,r)||function(e,t){return sc.lastPositionIn(e).fold(function(){return!1},function(e){return t.setStart(e.container(),e.offset()),t.setEnd(e.container(),e.offset()),!0})}(i,r);i=u[s[o]]}3===i.nodeType&&(a=Math.min(s[0],i.nodeValue.length)),1===i.nodeType&&(a=Math.min(s[0],i.childNodes.length)),t?r.setStart(i,a):r.setEnd(i,a)}return 1}function mc(e){return jo.isText(e)&&0<e.data.length}function gc(e,t,n){var o,a,u,s,c=e.get(n.id+"_"+t),i=n.keep;if(c){if(a=c.parentNode,o="start"===t?i?c.hasChildNodes()?(a=c.firstChild,1):mc(c.nextSibling)?(a=c.nextSibling,0):mc(c.previousSibling)?(a=c.previousSibling,c.previousSibling.data.length):(a=c.parentNode,e.nodeIndex(c)+1):e.nodeIndex(c):i?c.hasChildNodes()?(a=c.firstChild,1):mc(c.previousSibling)?(a=c.previousSibling,c.previousSibling.data.length):(a=c.parentNode,e.nodeIndex(c)):e.nodeIndex(c),u=a,s=o,!i){for(a=c.previousSibling,i=c.nextSibling,Xt.each(Xt.grep(c.childNodes),function(e){jo.isText(e)&&(e.nodeValue=e.nodeValue.replace(/\uFEFF/g,""))});c=e.get(n.id+"_"+t);)e.remove(c,!0);a&&i&&a.nodeType===i.nodeType&&jo.isText(a)&&!fe.opera&&(o=a.nodeValue.length,a.appendData(i.nodeValue),e.remove(i),u=a,s=o)}return _.some(_u(u,s))}return _.none()}function hc(e,t,n){return Yu.getBookmark(e,t,n)}function vc(t,e){pc(t,e).each(function(e){t.setRng(e)})}function bc(e){return e&&/^(IMG)$/.test(e.nodeName)}function Cc(e){return e&&3===e.nodeType&&/^([\t \r\n]+|)$/.test(e.nodeValue)}function xc(e,t,n){return"color"!==n&&"backgroundColor"!==n||(t=e.toHex(t)),"fontWeight"===n&&700===t&&(t="bold"),""+(t="fontFamily"===n?t.replace(/[\'\"]/g,"").replace(/,\s+/g,","):t)}function Ac(e,t,a,r){var o,i,a=a.nodeValue;return void 0===r&&(r=e?a.length:0),e?(o=a.lastIndexOf(" ",r),-1!==(o=(i=a.lastIndexOf("Â ",r))<o?o:i)&&!t&&(o<r||!e)&&o<=a.length&&o++):(o=a.indexOf(" ",r),i=a.indexOf("Â ",r),o=-1!==o&&(-1===i||o<i)?o:i),o}function Mc(e){return Fc.get(e)}var Ms,Us,js=jo.isContentEditableFalse,Vs=jo.isText,Hs=jo.isElement,qs=jo.isBr,$s=Ha,Ks=$a,Gs=function(e,c,a){var r,o,i,u;if(!Hs(a)||!c)return null;if(c.isEqual(_u.after(a))&&a.lastChild){if(u=_u.after(a.lastChild),ws(e)&&$s(a.lastChild)&&Hs(a.lastChild))return qs(a.lastChild)?_u.before(a.lastChild):u}else u=c;var s,f=u.container(),l=u.offset();if(Vs(f)){if(ws(e)&&0<l)return _u(f,--l);if(xs(e)&&l<f.length)return _u(f,++l);r=f}else{if(ws(e)&&0<l&&(o=Xs(f,l-1),$s(o)))return!Ws(o)&&(i=Es(o,e,Ks,o))?Vs(i)?_u(i,i.data.length):_u.after(i):Vs(o)?_u(o,o.data.length):_u.before(o);if(xs(e)&&l<f.childNodes.length&&(o=Xs(f,l),$s(o)))return qs(o)?(s=a,(l=(c=o).nextSibling)&&$s(l)?Vs(l)?_u(l,0):_u.before(l):Gs(Tu.Forwards,_u.after(c),s)):!Ws(o)&&(i=Es(o,e,Ks,o))?Vs(i)?_u(i,0):_u.before(i):Vs(o)?_u(o,0):_u.after(o);r=o||u.getNode()}return(xs(e)&&u.isAtEnd()||ws(e)&&u.isAtStart())&&(r=Es(r,e,q(!0),a,!0),Ks(r,a))?Ys(e,r):(o=Es(r,e,Ks,a),!(a=Ht.last(U(function(e,t){for(var n=[];e&&e!==t;)n.push(e),e=e.parentNode;return n}(f,a),js)))||o&&a.contains(o)?o?Ys(e,o):null:xs(e)?_u.after(a):_u.before(a))},Qs=function(e){return _u.isTextPosition(e)?0===e.offset():Ha(e.getNode())},Zs=function(e){if(_u.isTextPosition(e)){var t=e.container();return e.offset()===t.data.length}return Ha(e.getNode(!0))},ec=function(e,t){return!_u.isTextPosition(e)&&!_u.isTextPosition(t)&&e.getNode()===t.getNode(!0)},KN=function(n,r){var a,i=n?r.firstChild:r.lastChild;return jo.isText(i)?_.some(_u(i,n?0:i.data.length)):i?Ha(i)?_.some(n?_u.before(i):jo.isBr(a=i)?_u.before(a):_u.after(a)):(r=r,i=i,i=(n=n)?_u.before(i):_u.after(i),nc(n,r,i)):_.none()},tE=d(nc,!0),RN=d(nc,!1),sc={fromPosition:nc,nextPosition:tE,prevPosition:RN,navigate:rc,navigateIgnore:oc,positionIn:KN,firstPositionIn:d(KN,!0),lastPositionIn:d(KN,!1)},pc=function(g,t){var n,o,u,a,f,l,r=g.dom;if(t){if(Xt.isArray(t.start))return f=t,l=(g=r).createRng(),dc(g,!0,f,l)&&dc(g,!1,f,l)?_.some(l):_.none();if("string"==typeof t.start)return _.some((f=t,u=(l=r).createRng(),a=Fu(l.getRoot(),f.start),u.setStart(a.container(),a.offset()),a=Fu(l.getRoot(),f.end),u.setEnd(a.container(),a.offset()),u));if(t.hasOwnProperty("id"))return u=gc(o=r,"start",a=t),a=gc(o,"end",a),ru(u,(u=u,(a=a).isSome()?a:u),function(e,t){var n=o.createRng();return n.setStart(cc(o,e.container()),e.offset()),n.setEnd(cc(o,t.container()),t.offset()),n});if(t.hasOwnProperty("name"))return n=r,_.from(n.select((r=t).name)[r.index]).map(function(e){var t=n.createRng();return t.selectNode(e),t});if(t.hasOwnProperty("rng"))return _.some(t.rng)}return _.none()},yc=function(e){return jo.isElement(e)&&"SPAN"===e.tagName&&"bookmark"===e.getAttribute("data-mce-type")},wc={isInlineBlock:bc,moveStart:function(e,t,n){var r,o,i,a=n.startOffset,u=n.startContainer;if((n.startContainer!==n.endContainer||!bc(n.startContainer.childNodes[n.startOffset]))&&1===u.nodeType)for(a<(i=u.childNodes).length?r=new go(u=i[a],e.getParent(u,e.isBlock)):(r=new go(u=i[i.length-1],e.getParent(u,e.isBlock))).next(!0),o=r.current();o;o=r.next())if(3===o.nodeType&&!Cc(o))return n.setStart(o,0),void t.setRng(n)},getNonWhiteSpaceSibling:function(e,t,n){if(e)for(t=t?"nextSibling":"previousSibling",e=n?e:e[t];e;e=e[t])if(1===e.nodeType||!Cc(e))return e},isTextBlock:function(e,t){return t.nodeType&&(t=t.nodeName),!!e.schema.getTextBlockElements()[t.toLowerCase()]},isValid:function(e,t,n){return e.schema.isValidChild(t,n)},isWhiteSpaceNode:Cc,replaceVars:function(e,n){return"string"!=typeof e?e=e(n):n&&(e=e.replace(/%(\w+)/g,function(e,t){return n[t]||e})),e},isEq:function(e,t){return e=""+((e=e||"").nodeName||e),t=""+((t=t||"").nodeName||t),e.toLowerCase()===t.toLowerCase()},normalizeStyleValue:xc,getStyle:function(e,t,n){return xc(e,e.getStyle(t,n),n)},getTextDecoration:function(t,e){var n;return t.getParent(e,function(e){return(n=t.getStyle(e,"text-decoration"))&&"none"!==n}),n},getParents:function(e,t,n){return e.getParents(t,n,e.getRoot())}},Nc=yc,Ec=wc.getParents,Sc=wc.isWhiteSpaceNode,Tc=wc.isTextBlock,kc=function(e,t){for(void 0===t&&(t=(3===e.nodeType?e:e.childNodes).length);e&&e.hasChildNodes();)(e=e.childNodes[t])&&(t=(3===e.nodeType?e:e.childNodes).length);return{node:e,offset:t}},_c=function(e,t){for(var n=t;n;){if(1===n.nodeType&&e.getContentEditable(n))return"false"===e.getContentEditable(n)?n:t;n=n.parentNode}return t},Rc=function(e,t,n,r,o,i){var a,u,s,c;if(3===n.nodeType){if(-1!==(s=Ac(o,i,n,r)))return{container:n,offset:s};c=n}for(a=new go(n,e.getParent(n,e.isBlock)||t);u=a[o?"prev":"next"]();)if(3!==u.nodeType||Nc(u.parentNode)){if(e.isBlock(u)||wc.isEq(u,"BR"))break}else if(-1!==(s=Ac(o,i,c=u)))return{container:u,offset:s};if(c)return{container:c,offset:r=o?0:c.length}},Dc=function(e,t,n,r,o){var i,a,u,s;for(3===r.nodeType&&0===r.nodeValue.length&&r[o]&&(r=r[o]),i=Ec(e,r),a=0;a<i.length;a++)for(u=0;u<t.length;u++)if(!("collapsed"in(s=t[u])&&s.collapsed!==n.collapsed)&&e.is(i[a],s.selector))return i[a];return r},Oc=function(t,e,n,r){var u,o,i=t.dom,a=i.getRoot();if((o=e[0].wrapper?o:i.getParent(n,e[0].block,a))||(u=i.getParent(n,"LI,TD,TH"),o=i.getParent(3===n.nodeType?n.parentNode:n,function(e){return e!==a&&Tc(t,e)},u)),!(o=o&&e[0].wrapper?Ec(i,o,"ul,ol").reverse()[0]||o:o))for(o=n;o[r]&&!i.isBlock(o[r])&&(o=o[r],!wc.isEq(o,"br")););return o||n},Bc=function(e,t,n,r,o,i,a){var s,c,d,u=s=a?n:o,l=a?"previousSibling":"nextSibling",f=e.getRoot();if(3===u.nodeType&&!Sc(u)&&(a?0<r:i<u.nodeValue.length))return u;for(;;){if(!t[0].block_expand&&e.isBlock(s))return s;for(c=s[l];c;c=c[l])if(!Nc(c)&&!Sc(c)&&("BR"!==(d=c).nodeName||!d.getAttribute("data-mce-bogus")||d.nextSibling))return s;if(s===f||s.parentNode===f){u=s;break}s=s.parentNode}return u},Pc=function(e,t,n,r){var o,i=t.startContainer,a=t.startOffset,u=t.endContainer,s=t.endOffset,c=e.dom;return 1===i.nodeType&&i.hasChildNodes()&&3===(i=eu(i,a)).nodeType&&(a=0),1===u.nodeType&&u.hasChildNodes()&&3===(u=eu(u,t.collapsed?s:s-1)).nodeType&&(s=u.nodeValue.length),i=_c(c,i),u=_c(c,u),(Nc(i.parentNode)||Nc(i))&&(i=Nc(i)?i:i.parentNode,3===(i=t.collapsed?i.previousSibling||i:i.nextSibling||i).nodeType&&(a=t.collapsed?i.length:0)),(Nc(u.parentNode)||Nc(u))&&(u=Nc(u)?u:u.parentNode,3===(u=t.collapsed?u.nextSibling||u:u.previousSibling||u).nodeType&&(s=t.collapsed?0:u.length)),t.collapsed&&((o=Rc(c,e.getBody(),i,a,!0,r))&&(i=o.container,a=o.offset),(o=Rc(c,e.getBody(),u,s,!1,r))&&(u=o.container,s=o.offset)),n[0].inline&&(u=r?u:function(e){var n=kc(e,s);if(n.node){for(;n.node&&0===n.offset&&n.node.previousSibling;)n=kc(n.node.previousSibling);n.node&&0<n.offset&&3===n.node.nodeType&&" "===n.node.nodeValue.charAt(n.offset-1)&&1<n.offset&&(e=n.node).splitText(n.offset-1)}return e}(u)),(n[0].inline||n[0].block_expand)&&(n[0].inline&&3===i.nodeType&&0!==a||(i=Bc(c,n,i,a,u,s,!0)),n[0].inline&&3===u.nodeType&&s!==u.nodeValue.length||(u=Bc(c,n,i,a,u,s,!1))),n[0].selector&&!1!==n[0].expand&&!n[0].inline&&(i=Dc(c,n,t,i,"previousSibling"),u=Dc(c,n,t,u,"nextSibling")),(n[0].block||n[0].selector)&&(i=Oc(e,n,i,"previousSibling"),u=Oc(e,n,u,"nextSibling"),n[0].block&&(c.isBlock(i)||(i=Bc(c,n,i,a,u,s,!0)),c.isBlock(u)||(u=Bc(c,n,i,a,u,s,!1)))),1===i.nodeType&&(a=c.nodeIndex(i),i=i.parentNode),1===u.nodeType&&(s=c.nodeIndex(u)+1,u=u.parentNode),{startContainer:i,startOffset:a,endContainer:u,endOffset:s}},Ic=Xt.each,Lc=function(r,g,o){var n,a,u,s,l=g.startContainer,f=g.startOffset,d=g.endContainer,m=g.endOffset;if(0<(h=r.select("td[data-mce-selected],th[data-mce-selected]")).length)Ic(h,function(e){o([e])});else{var p,h,v=function(e){var t;return 3===(t=e[0]).nodeType&&t===l&&f>=t.nodeValue.length&&e.splice(0,1),t=e[e.length-1],0===m&&0<e.length&&t===d&&3===t.nodeType&&e.splice(e.length-1,1),e},y=function(e,t,n){for(var r=[];e&&e!==n;e=e[t])r.push(e);return r},i=function(e,t){do{if(e.parentNode===t)return e}while(e=e.parentNode)},C=function(e,t,n){var r=n?"nextSibling":"previousSibling";for(u=(a=e).parentNode;a&&a!==t;a=u)u=a.parentNode,(s=y(a===e?a:a[r],r)).length&&(n||s.reverse(),o(v(s)))};if(1===l.nodeType&&l.hasChildNodes()&&(l=l.childNodes[f]),1===d.nodeType&&d.hasChildNodes()&&(p=m,--p>(h=(g=d).childNodes).length-1?p=h.length-1:p<0&&(p=0),d=h[p]||g),l===d)return o(v([l]));for(n=r.findCommonAncestor(l,d),a=l;a;a=a.parentNode){if(a===d)return C(l,n,!0);if(a===n)break}for(a=d;a;a=a.parentNode){if(a===l)return C(d,n);if(a===n)break}r=i(l,n)||l,i=i(d,n)||d,C(l,r,!0),(s=y(r===l?r:r.nextSibling,"nextSibling",i===d?i.nextSibling:i)).length&&o(v(s)),C(d,i)}},Fc=(Ms=mr,{get:function(e){if(!Ms(e))throw new Error("Can only get text value of a text node");return Us(e).getOr("")},getOption:Us=function(e){return Ms(e)?_.from(e.dom().nodeValue):_.none()},set:function(e,t){if(!Ms(e))throw new Error("Can only set raw text value of a text node");e.dom().nodeValue=t}}),Uc=function(c,d,n,r){var i,p=d.uid,p=void 0===p?(i=(new Date).getTime(),"mce-annotation_"+Math.floor(1e9*Math.random())+ ++ga+String(i)):p,d=function(e,t){var n={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}(d,["uid"]),c=ar.fromTag("span",c);Xi(c,aa()),wr(c,""+sa(),p),wr(c,""+ua(),n);var l,p=r(p,d),d=p.attributes,p=p.classes,p=void 0===p?[]:p;return Nr(c,void 0===d?{}:d),l=c,z(p,function(e){Xi(l,e)}),c},jc=function(i,e,t,n,r){function o(e){switch(function(r,o,i,a){return Vr(o).fold(function(){return"skipping"},function(e){return"br"===a||mr(t=o)&&"\ufeff"===Mc(t)?"valid":dr(t=o)&&Gi(t,aa())?"existing":Ju(o)?"caret":wc.isValid(r,i,a)&&wc.isValid(r,lr(e),i)?"valid":"invalid-child";var t})}(i,e,"span",lr(e))){case"invalid-child":c();var t=Kr(e);l(t),c();break;case"valid":var n=s.get().getOrThunk(function(){var e=ha(u);return a.push(e),s.set(_.some(e)),e});Pi(t=e,n=n),Fi(n,t)}}var a=[],u=Uc(i.getDoc(),r,t,n),s=Hi(_.none()),c=function(){s.set(_.none())},l=function(e){z(e,o)};return Lc(i.dom,e,function(t){c(),t=W(t,ar.fromDom),l(t)}),a};function Hc(s){var n,r=(n={},{register:function(e,t){n[e]={name:e,settings:t}},lookup:function(e){return n.hasOwnProperty(e)?_.from(n[e]).map(function(e){return e.settings}):_.none()}});!function(e,n){e.on("init",function(){e.serializer.addNodeFilter("span",function(e){z(e,function(t){_.from(t.attributes.map[ua()]).bind(n.lookup).each(function(e){!1===e.persistent&&t.unwrap()})})})})}(s,r);var o=function(i){function c(e,t){u(e,function(e){return t(e),e})}var n,o,a=Hi({}),u=function(e,r){var n=a.get(),r=r(n.hasOwnProperty(e)?n[e]:{listeners:[],previous:Hi(_.none())});n[e]=r,a.set(n)},t=(n=function(){var o=a.get(),o=(o=gr(o),(o=B.call(o,0)).sort(void 0),o);z(o,function(e){u(e,function(u){var s=u.previous.get();return ca(i,_.some(e)).fold(function(){var t;s.isSome()&&(c(t=e,function(e){z(e.listeners,function(e){return e(!1,t)})}),u.previous.set(_.none()))},function(a){var t,n,r,o=a.uid,i=a.name,a=a.elements;s.is(o)||(n=o,r=a,c(t=i,function(e){z(e.listeners,function(e){return e(!0,t,{uid:n,nodes:W(r,function(e){return e.dom()})})})}),u.previous.set(_.some(o)))}),{previous:u.previous,listeners:u.listeners}})})},o=null,{cancel:function(){null!==o&&(V.clearTimeout(o),o=null)},throttle:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];null!==o&&V.clearTimeout(o),o=V.setTimeout(function(){n.apply(null,e),o=null},30)}});return i.on("remove",function(){t.cancel()}),i.on("nodeChange",function(){t.throttle()}),{addListener:function(e,t){u(e,function(e){return{previous:e.previous,listeners:e.listeners.concat([t])}})}}}(s);return{register:function(e,t){r.register(e,t)},annotate:function(t,n){r.lookup(t).each(function(e){!function(s,c,l,f){s.undoManager.transact(function(){var e,a,u,r=s.selection.getRng();r.collapsed&&(r=Pc(e=s,a=r,[{inline:!0}],3===(r=a).startContainer.nodeType&&r.startContainer.nodeValue.length>=r.startOffset&&"Â "===r.startContainer.nodeValue[r.startOffset]),a.setStart(r.startContainer,r.startOffset),a.setEnd(r.endContainer,r.endOffset),e.selection.setRng(a)),s.selection.getRng().collapsed?(u=Uc(s.getDoc(),f,c,l.decorate),ya(u,"Â "),s.selection.getRng().insertNode(u.dom()),s.selection.select(u.dom())):(a=Yu.getPersistentBookmark(s.selection,!1),u=s.selection.getRng(),jc(s,u,c,l.decorate,f),s.selection.moveToBookmark(a))})}(s,t,e,n)})},annotationChanged:function(e,t){o.addListener(e,t)},remove:function(e){ca(s,_.some(e)).each(function(t){t=t.elements;z(t,ji)})},getAll:function(r){var i,u=(u=r,r=ar.fromDom(s.getBody()),u=Qi(r,"["+ua()+'="'+u+'"]'),i={},z(u,function(e){var t=Er(e,sa()),n=i.hasOwnProperty(t)?i[t]:[];i[t]=n.concat([e])}),i),a=function(e){return W(e,function(e){return e.dom()})};return function(e,r){var o={};return hr(e,function(e,n){n=r(e,n);o[n.k]=n.v}),o}(u,function(e,t){return{k:t,v:a(e)}})}}}function Wc(e){return 0<e.length&&(!(t=e[e.length-1]).firstChild||function(t){return t&&t.firstChild&&t.firstChild===t.lastChild&&("Â "===(t=t.firstChild).data||jo.isBr(t))}(t))?e.slice(0,-1):e;var t}function Kc(n,t){return(n=n.getParent(t,n.isBlock))&&"LI"===n.nodeName?n:null}function Xc(r,t){return r=_u.after(r),(r=Js(t).prev(r))?r.toRange():null}function Jc(x,o,i,b){var g,p,h,v,w,k=(k=o,x=x.serialize(b),k=(b=k.createFragment(x)).firstChild,x=b.lastChild,k&&"META"===k.nodeName&&k.parentNode.removeChild(k),x&&"mce_marker"===x.id&&x.parentNode.removeChild(x),b),E=Kc(o,i.startContainer),x=Wc(function(e){return Xt.grep(e.childNodes,function(e){return"LI"===e.nodeName})}(k.firstChild)),b=o.getRoot();return(k=function(e){var r=_u.fromRangeStart(i),n=Js(o.getRoot()),r=1===e?n.prev(r):n.next(r);return!r||Kc(o,r.getNode())!==E})(1)?function(t,o,a){var u=t.parentNode;return Xt.each(o,function(e){u.insertBefore(e,t)}),o=a,a=_u.before(t),(a=Js(o).next(a))?a.toRange():null}(E,x,b):k(2)?(p=E,v=b,o.insertAfter((h=x).reverse(),p),Xc(h[0],v)):(p=x,h=b,v=g=E,b=(x=i).cloneRange(),x=x.cloneRange(),b.setStartBefore(v),x.setEndAfter(v),x=[b.cloneContents(),x.cloneContents()],(w=g.parentNode).insertBefore(x[0],g),Xt.each(p,function(e){w.insertBefore(e,g)}),w.insertBefore(x[1],g),w.removeChild(g),Xc(p[p.length-1],h))}function el(o){this.compare=function(e,t){if(e.nodeName!==t.nodeName)return!1;function n(n){var r={};return Zc(o.getAttribs(n),function(t){t=t.nodeName.toLowerCase();0!==t.indexOf("_")&&"style"!==t&&0!==t.indexOf("data-")&&(r[t]=o.getAttrib(n,t))}),r}function r(e,t){var n,r;for(r in e)if(e.hasOwnProperty(r)){if(void 0===(n=t[r]))return;if(e[r]!==n)return;delete t[r]}for(r in t)if(t.hasOwnProperty(r))return;return 1}return!(!r(n(e),n(t))||!r(o.parseStyle(o.getAttrib(e,"style")),o.parseStyle(o.getAttrib(t,"style")))||yc(e)||yc(t))}}function rl(n){Gr(n).each(function(t){Hr(t).each(function(e){Co(n)&&wo(t)&&Co(e)&&Ui(t)})})}var Zc=Xt.each,nl=function(e){zi(e),Fi(e,ar.fromHtml('<br data-mce-bogus="1">'))},ol=Xt.makeMap;function il(e){var d=[],u=(e=e||{}).indent,s=ol(e.indent_before||""),c=ol(e.indent_after||""),l=ti.getEncodeFunc(e.entity_encoding||"raw",e.entities),f="html"===e.element_format;return{start:function(e,t,n){var r,o,i,a;if(u&&s[e]&&0<d.length&&0<(a=d[d.length-1]).length&&"\n"!==a&&d.push("\n"),d.push("<",e),t)for(r=0,o=t.length;r<o;r++)i=t[r],d.push(" ",i.name,'="',l(i.value,!0),'"');d[d.length]=!n||f?">":" />",n&&u&&c[e]&&0<d.length&&0<(a=d[d.length-1]).length&&"\n"!==a&&d.push("\n")},end:function(e){var t;d.push("</",e,">"),u&&c[e]&&0<d.length&&0<(t=d[d.length-1]).length&&"\n"!==t&&d.push("\n")},text:function(e,t){0<e.length&&(d[d.length]=t?e:l(e))},cdata:function(e){d.push("<![CDATA[",e,"]]>")},comment:function(e){d.push("\x3c!--",e,"--\x3e")},pi:function(e,t){t?d.push("<?",e," ",l(t),"?>"):d.push("<?",e,"?>"),u&&d.push("\n")},doctype:function(e){d.push("<!DOCTYPE",e,">",u?"\n":"")},reset:function(){d.length=0},getContent:function(){return d.join("").replace(/\n$/,"")}}}function al(t,g){void 0===g&&(g=di());var p=il(t);return(t=t||{}).validate=!("validate"in t)||t.validate,{serialize:function(e){var d=t.validate,f={3:function(e){p.text(e.value,e.raw)},8:function(e){p.comment(e.value)},7:function(e){p.pi(e.name,e.value)},10:function(e){p.doctype(e.value)},4:function(e){p.cdata(e.value)},11:function(e){if(e=e.firstChild)for(;m(e),e=e.next;);}};p.reset();var m=function(e){var t,r,o,i,a,u,s,c,n=f[e.type];if(n)n(e);else{if(t=e.name,n=e.shortEnded,r=e.attributes,d&&r&&1<r.length&&((a=[]).map={},c=g.getElementRule(e.name))){for(u=0,s=c.attributesOrder.length;u<s;u++)(o=c.attributesOrder[u])in r.map&&(i=r.map[o],a.map[o]=i,a.push({name:o,value:i}));for(u=0,s=r.length;u<s;u++)(o=r[u].name)in a.map||(i=r.map[o],a.map[o]=i,a.push({name:o,value:i}));r=a}if(p.start(e.name,r,n),!n){if(e=e.firstChild)for(;m(e),e=e.next;);p.end(t)}}};return 1!==e.type||t.inner?f[11](e):m(e),p.getContent()}}}function cl(e){return e.collapsed?e:sl(e)}function fl(e,t){var n,r,o=e.selection.getRng(),i=o.startContainer,a=o.startOffset;o.collapsed&&(r=a,jo.isText(n=i)&&"Â "===n.nodeValue[r-1])&&jo.isText(i)&&(i.insertData(a-1," "),i.deleteData(a,1),o.setStart(i,a),o.setEnd(i,a),e.selection.setRng(o)),e.selection.setContent(t)}function dl(e,T,n){var r,o,i,a,s,c,l,f,d,g=e.selection,p=e.dom;if(/^ | $/.test(T)&&(T=function(o,t){var n=o.startContainer,r=o.startOffset,o=function(e){return n[e]&&3===n[e].nodeType};return 3===n.nodeType&&(0<r?t=t.replace(/^&nbsp;/," "):o("previousSibling")||(t=t.replace(/^ /,"&nbsp;")),r<n.length?t=t.replace(/&nbsp;(<br>|)$/," "):o("nextSibling")||(t=t.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),t}(g.getRng(),T)),r=e.parser,S=n.merge,o=al({validate:e.settings.validate},e.schema),d='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>',s={content:T,format:"html",selection:!0,paste:n.paste},(s=e.fire("BeforeSetContent",s)).isDefaultPrevented())e.fire("SetContent",{content:s.content,format:"html",selection:!0,paste:n.paste});else{-1===(T=s.content).indexOf("{$caret}")&&(T+="{$caret}"),T=T.replace(/\{\$caret\}/,d);var C,y=(l=g.getRng()).startContainer||(l.parentElement?l.parentElement():null),x=e.getBody();y===x&&g.isCollapsed()&&p.isBlock(x.firstChild)&&((C=x.firstChild)&&!e.schema.getShortEndedElements()[C.nodeName])&&p.isEmpty(x.firstChild)&&((l=p.createRng()).setStart(x.firstChild,0),l.setEnd(x.firstChild,0),g.setRng(l)),g.isCollapsed()||(e.selection.setRng(cl(e.selection.getRng())),e.getDoc().execCommand("Delete",!1,null),k=T,C=(y=e.selection.getRng()).startContainer,x=y.startOffset,3===C.nodeType&&y.collapsed&&("Â "===C.data[x]?(C.deleteData(x,1),/[\u00a0| ]$/.test(k)||(k+=" ")):"Â "===C.data[x-1]&&(C.deleteData(x-1,1),/[\u00a0| ]$/.test(k)||(k=" "+k))),T=k);var S,k={context:(i=g.getNode()).nodeName.toLowerCase(),data:n.data,insert:!0},u=r.parse(T,k);if(!0===n.paste&&function(u,n){var i,s=n.firstChild,c=n.lastChild;return s&&"meta"===s.name&&(s=s.next),i=c=c&&"mce_marker"===c.attr("id")?c.prev:c,u=(n=u).getNonEmptyElements(),i&&(i.isEmpty(u)||(i=i,n.getBlockElements()[i.name]&&i.firstChild&&i.firstChild===i.lastChild&&("br"===(i=i.firstChild).name||"Â "===i.value)))&&(c=c.prev),!(!s||s!==c||"ul"!==s.name&&"ol"!==s.name)}(e.schema,u)&&function(e,t){return!!Kc(e,t)}(p,i))return l=Jc(o,p,e.selection.getRng(),u),e.selection.setRng(l),e.fire("SetContent",s),0;if(function(){for(var t=u;t=t.walk();)1===t.type&&t.attr("data-mce-fragment","1")}(),"mce_marker"===(f=u.lastChild).attr("id"))for(f=(c=f).prev;f;f=f.walk(!0))if(3===f.type||!p.isBlock(f.name)){e.schema.isValidChild(f.parent.name,"span")&&f.parent.insert(c,f,"br"===f.name);break}if(e._selectionOverrides.showBlockCaretContainer(i),k.invalid){for(fl(e,d),i=g.getNode(),a=e.getBody(),9===i.nodeType?i=f=a:f=i;f!==a;)f=(i=f).parentNode;T=i===a?a.innerHTML:p.getOuterHTML(i),T=o.serialize(r.parse(T.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return o.serialize(u)}))),i===a?p.setHTML(a,T):p.setOuterHTML(i,T)}else!function(e,t,n){var r,o;"all"===n.getAttribute("data-mce-bogus")?n.parentNode.insertBefore(e.dom.createFragment(t),n):(r=n.firstChild,o=n.lastChild,!r||r===o&&"BR"===r.nodeName?e.dom.setHTML(n,t):fl(e,t))}(e,T=o.serialize(u),i);!function(e,t){var o,i,n=e.schema.getTextInlineElements(),r=e.dom;t&&(o=e.getBody(),i=new el(r),Xt.each(r.select("*[data-mce-fragment]"),function(e){for(var t=e.parentNode;t&&t!==o;t=t.parentNode)n[e.nodeName.toLowerCase()]&&i.compare(t,e)&&r.remove(e,!0)}))}(e,S),function(n,e){var o,i,r,u=n.dom,s=n.selection;if(e){if(n.selection.scrollIntoView(e),i=function(e){for(var t=n.getBody();e&&e!==t;e=e.parentNode)if("false"===n.dom.getContentEditable(e))return e;return null}(e))return u.remove(e),s.select(i);var c=u.createRng();(i=e.previousSibling)&&3===i.nodeType?(c.setStart(i,i.nodeValue.length),fe.ie||(r=e.nextSibling)&&3===r.nodeType&&(i.appendData(r.data),r.parentNode.removeChild(r))):(c.setStartBefore(e),c.setEndBefore(e)),r=u.getParent(e,u.isBlock),u.remove(e),r&&u.isEmpty(r)&&(n.$(r).empty(),c.setStart(r,0),c.setEnd(r,0),ll(r)||r.getAttribute("data-mce-fragment")||!(o=function(t){t=_u.fromRangeStart(t);if(t=Js(n.getBody()).next(t))return t.toRange()}(c))?u.add(r,u.create("br",{"data-mce-bogus":"1"})):(c=o,u.remove(r))),s.setRng(c)}}(e,p.get("mce_marker")),T=e.getBody(),Xt.each(T.getElementsByTagName("*"),function(e){e.removeAttribute("data-mce-fragment")}),S=e.dom,T=e.selection.getStart(),_.from(S.getParent(T,"td,th")).map(ar.fromDom).each(rl),e.fire("SetContent",s),e.addVisual()}}function pl(e,o,n){var r=e.getParam(o,n);return-1===r.indexOf("=")?r:(o=e.getParam(o,"","hash")).hasOwnProperty(e.id)?o[e.id]:n}function xl(e){return e.getParam("content_security_policy","")}function Nl(t){return t.getParam("force_p_newlines",!1)?"p":!1===(t=t.getParam("forced_root_block","p"))?"":t}function El(e){return e.getParam("forced_root_block_attrs",{})}function Ol(e){return e.getParam("automatic_uploads",!0,"boolean")}function Hl(e,t){return zr(e,t)?na(t,function(e){return No(e)||So(e)},(n=e,function(e){return Mr(n,ar.fromDom(e.dom().parentNode))})):_.none();var n}function ql(r){var t;r.dom.isEmpty(r.getBody())&&(r.setContent(""),r=(r=(t=r).getBody()).firstChild&&t.dom.isBlock(r.firstChild)?r.firstChild:r,t.selection.setCursorLocation(r,0))}function Kl(r,t){return Ha(t)&&!1===(r=r,jo.isText(n=t)&&/^[ \t\r\n]*$/.test(n.data)&&!1===function(o,n){var o=ar.fromDom(o),n=ar.fromDom(n),o=d(Mr,o);return ra(n,"pre,code",o).isSome()}(r,n))||jo.isElement(n=t)&&"A"===n.nodeName&&n.hasAttribute("name")||Xl(t);var n}function Jl(e){return function(e){var t,n,r=0;if(Kl(e,e))return!1;if(!(n=e.firstChild))return!0;t=new go(n,e);do{if(Gl(n))n=t.next(!0);else if(Yl(n))n=t.next();else if(jo.isBr(n))r++,n=t.next();else{if(Kl(e,n))return!1;n=t.next()}}while(n);return r<=1}(e.dom())}function ef(r,t){var n=ar.fromDom(r),r=ar.fromDom(t.container());return Hl(n,r).map(function(e){return Ql(e,t)})}function nf(e,t,n){return n.collapsed?function(o,i,n){var t=ef(o,_u.fromRangeStart(n)),n=t.bind(function(e){return sc.fromPosition(i,o,e.position()).bind(function(e){return ef(o,e).map(function(e){return t=o,n=i,r=e,jo.isBr(r.position().getNode())&&!1===Jl(r.block())?sc.positionIn(!1,r.block().dom()).bind(function(e){return e.isEqual(r.position())?sc.fromPosition(n,t,e).bind(function(e){return ef(t,e)}):_.some(r)}).getOr(r):r;var t,n,r})})});return ru(t,n,Zl).filter(function(t){return!1===Mr((r=t).from().block(),r.to().block())&&Vr((n=t).from().block()).bind(function(t){return Vr(n.to().block()).filter(function(e){return Mr(t,e)})}).isSome()&&(!1===jo.isContentEditableFalse((t=t).from().block().dom())&&!1===jo.isContentEditableFalse(t.to().block().dom()));var n,r})}(e,t,n):_.none()}function sf(n){var t,n=(t=Kr(n),Y(t,Co).fold(function(){return t},function(e){return t.slice(0,e)}));return z(n,Ui),n}function cf(n,t){return n=uf(t,n),X(n.reverse(),Jl).each(Ui)}function lf(e,t,o,r){return Jl(o)?(nl(o),sc.firstPositionIn(o.dom())):(0===U($r(r),function(e){return!Jl(e)}).length&&Jl(t)&&Pi(r,ar.fromTag("br")),o=sc.prevPosition(o.dom(),_u.before(r.dom())),z(sf(t),function(e){Pi(r,e)}),cf(e,t),o)}function ff(e,t,n){if(Jl(n))return Ui(n),Jl(t)&&nl(t),sc.firstPositionIn(t.dom());var r=sc.lastPositionIn(n.dom());return z(sf(t),function(e){Fi(n,e)}),cf(e,t),r}function mf(e,t){sc.positionIn(e,t.dom()).map(function(e){return e.getNode()}).map(ar.fromDom).filter(wo).each(Ui)}function gf(e,t,n){return mf(!0,t),mf(!1,n),function(e,n){return zr(n,e)?(n=uf(e,n),_.from(n[n.length-1])):_.none()}(t,n).fold(d(ff,e,t,n),d(lf,e,t,n))}function pf(e,t,n,r){return t?gf(e,r,n):gf(e,n,r)}function hf(t,n){var e,r=ar.fromDom(t.getBody());return(e=nf(r.dom(),n,t.selection.getRng()).bind(function(e){return pf(r,n,e.from().block(),e.to().block())})).each(function(e){t.selection.setRng(e.toRange())}),e.isSome()}function vf(r,n){return n=ar.fromDom(n),r=d(Mr,r),ta(n,_o,r).isSome()}function bf(e){var n,r,o,t,i=ar.fromDom(e.getBody());return function(n,r){var o=sc.prevPosition(n.dom(),_u.fromRangeStart(r)).isNone(),i=sc.nextPosition(n.dom(),_u.fromRangeEnd(r)).isNone();return!(vf(n=n,(r=r).startContainer)||vf(n,r.endContainer))&&o&&i}(i,e.selection.getRng())?((t=e).setContent(""),t.selection.setCursorLocation(),!0):(n=i,r=e.selection,o=r.getRng(),ru(Hl(n,ar.fromDom(o.startContainer)),Hl(n,ar.fromDom(o.endContainer)),function(e,t){return!1===Mr(e,t)&&(o.deleteContents(),pf(n,!0,e,t).each(function(e){r.setRng(e.toRange())}),!0)}).getOr(!1))}function Cf(e,t){return!e.selection.isCollapsed()&&bf(e)}function wf(e){return Is(e).exists(wo)}function Nf(e,o,n){var r=U(uf(ar.fromDom(n.container()),o),Co),o=Z(r).getOr(o);return sc.fromPosition(e,o.dom(),n).filter(wf)}function Ef(e,t){return Is(t).exists(wo)||Nf(!0,e,t).isSome()}function Sf(e,t){return _.from(t.getNode(!0)).map(ar.fromDom).exists(wo)||Nf(!1,e,t).isSome()}function _f(e){return"Â "===e}function Af(e){return/^[\r\n\t ]$/.test(e)}function Rf(e){return!Af(e)&&!_f(e)}function Vf(e,t,n,r){var o=r.getNode(!1===t);return Hl(ar.fromDom(e),ar.fromDom(n.getNode())).map(function(e){return Jl(e)?jf.remove(e.dom()):jf.moveToElement(o)}).orThunk(function(){return _.some(jf.moveToElement(o))})}function Hf(u,s,c){return sc.fromPosition(s,u,c).bind(function(e){return a=e.getNode(),_o(ar.fromDom(a))||So(ar.fromDom(a))?_.none():(t=u,o=e,i=function(e){return xo(ar.fromDom(e))&&!Ts(r,o,t)},Bs(!(n=s),r=c).fold(function(){return Bs(n,o).fold(q(!1),i)},i)?_.none():s&&jo.isContentEditableFalse(e.getNode())||!1===s&&jo.isContentEditableFalse(e.getNode(!0))?Vf(u,s,c,e):s&&Ff(c)||!1===s&&Lf(c)?_.some(jf.moveToPosition(e)):_.none());var t,n,r,o,i,a})}function $f(e,t,n){var r,o,i,a,u;0!==n&&(a=e.data.slice(t,t+n),u=t+n>=e.data.length,e.replaceData(t,n,(o=0===t,i=u,j((r=a).split(""),function(e,t){return-1!==" \f\n\r\t\v".indexOf(t)||"Â "===t?e.previousCharIsSpace||""===e.str&&o||e.str.length===r.length-1&&i?{previousCharIsSpace:!1,str:e.str+"Â "}:{previousCharIsSpace:!0,str:e.str+" "}:{previousCharIsSpace:!1,str:e.str+t}},{previousCharIsSpace:!1,str:""}).str)))}function Wf(e,t){var o=(o=e.data.slice(t)).length-o.replace(/^\s+/g,"").length;return $f(e,t,o)}function Kf(i,t){return r=i,o=(n=t).container(),i=n.offset(),!1===_u.isTextPosition(n)&&o===r.parentNode&&i>_u.before(r).offset()?_u(t.container(),t.offset()-1):t;var n,r,o}function Xf(e){return Ha(e.previousSibling)?_.some((t=e.previousSibling,jo.isText(t)?_u(t,t.data.length):_u.after(t))):e.previousSibling?sc.lastPositionIn(e.previousSibling):_.none();var t}function Yf(e){return Ha(e.nextSibling)?_.some((t=e.nextSibling,jo.isText(t)?_u(t,0):_u.before(t))):e.nextSibling?sc.firstPositionIn(e.nextSibling):_.none();var t}function Qf(e,t,n){return(e?function(n,r){return Yf(r).orThunk(function(){return Xf(r)}).orThunk(function(){return sc.nextPosition(e=n,_u.after(t=r)).fold(function(){return sc.prevPosition(e,_u.before(t))},_.some);var e,t})}:function(r,o){return Xf(o).orThunk(function(){return Yf(o)}).orThunk(function(){return e=r,n=_u.before((t=o).previousSibling||t.parentNode),sc.prevPosition(e,n).fold(function(){return sc.nextPosition(e,_u.after(t))},_.some);var e,t,n})})(t,n).map(d(Kf,n))}function Zf(t,n,e){e.fold(function(){t.focus()},function(e){t.selection.setRng(e.toRange(),n)})}function ed(e,t){return t&&e.schema.getBlockElements().hasOwnProperty(lr(t))}function td(e){if(Jl(e)){var t=ar.fromHtml('<br data-mce-bogus="1">');return zi(e),Fi(e,t),_.some(_u.before(t.dom()))}return _.none()}function rd(t,n,i,r){void 0===r&&(r=!0);var o,a=Qf(n,t.getBody(),i.dom()),u=ta(i,d(ed,t),(o=t.getBody(),function(e){return e.dom()===o})),s=function(n,t,l){var r,o,i,a=Hr(n).filter(mr),u=qr(n).filter(mr);return Ui(n),r=u,o=t,i=function(r,a,n){var u=r.dom(),s=a.dom(),c=u.data.length,o=s,i=l,a=Jn((r=u).data).length;return r.appendData(o.data),Ui(ar.fromDom(o)),i&&Wf(r,a),n.container()===s?_u(u,c):n},((n=a).isSome()&&r.isSome()&&o.isSome()?_.some(i(n.getOrDie(),r.getOrDie(),o.getOrDie())):_.none()).orThunk(function(){return l&&(a.each(function(o){return t=o.dom(),n=o.dom().length,o=(o=t.data.slice(0,n)).length-Jn(o).length,$f(t,n-o,o);var t,n}),u.each(function(e){return Wf(e.dom(),0)})),t})}(i,a,(i=i,br(t.schema.getTextInlineElements(),lr(i))));t.dom.isEmpty(t.getBody())?(t.setContent(""),t.selection.setCursorLocation()):u.bind(td).fold(function(){r&&Zf(t,n,s)},function(e){r&&Zf(t,n,_.some(e))})}function od(a,u){var e=a.getBody(),t=u,o=a.selection.getRng(),i=Os(t?1:-1,e,o),o=_u.fromRangeStart(i),i=ar.fromDom(e);return(!1===t&&Ff(o)?_.some(jf.remove(o.getNode(!0))):t&&Lf(o)?_.some(jf.remove(o.getNode())):!1===t&&Lf(o)&&Sf(i,o)?Tf(i,o).map(function(e){return jf.remove(e.getNode())}):t&&Ff(o)&&Ef(i,o)?kf(i,o).map(function(e){return jf.remove(e.getNode())}):function(r,e,o){return t=o.getNode(!1===(n=e)),n=n?"after":"before",jo.isElement(t)&&t.getAttribute("data-mce-caret")===n?(n=o.getNode(!1===(t=e)),(t&&jo.isContentEditableFalse(n.nextSibling)?_.some(jf.moveToElement(n.nextSibling)):!1===t&&jo.isContentEditableFalse(n.previousSibling)?_.some(jf.moveToElement(n.previousSibling)):_.none()).fold(function(){return Hf(r,e,o)},_.some)):Hf(r,e,o).bind(function(e){return t=r,n=o,e.fold(function(e){return _.some(jf.remove(e))},function(e){return _.some(jf.moveToElement(e))},function(e){return Ts(n,e,t)?_.none():_.some(jf.moveToPosition(e))});var t,n});var t,n}(e,t,o)).map(function(e){return e.fold(function(e){return o._selectionOverrides.hideFakeCaret(),rd(o,i,ar.fromDom(e)),!0},(r=i=u,function(t){t=r?_u.before(t):_u.after(t);return n.selection.setRng(t.toRange()),!0}),(t=n=o=a,function(e){return t.selection.setRng(e.toRange()),!0}));var t,n,r,o,i}).getOr(!1)}function ad(e,t){return(e.selection.isCollapsed()?od:function(e,t){var n=e.selection.getNode();return!!jo.isContentEditableFalse(n)&&(n=ar.fromDom(e.getBody()),z(Qi(n,".mce-offscreen-selection"),Ui),rd(e,t,ar.fromDom(e.selection.getNode())),ql(e),!0)})(e,t)}function ud(e){var t,n=function(e,t){for(;t&&t!==e;){if(jo.isContentEditableTrue(t)||jo.isContentEditableFalse(t))return t;t=t.parentNode}return null}(e.getBody(),e.selection.getNode());return jo.isContentEditableTrue(n)&&e.dom.isBlock(n)&&e.dom.isEmpty(n)&&(t=e.dom.create("br",{"data-mce-bogus":"1"}),e.dom.setHTML(n,""),n.appendChild(t),e.selection.setRng(_u.before(t).toRange())),!0}function cd(e){return sd(e)&&e.data[0]===xa}function ld(e){return sd(e)&&e.data[e.data.length-1]===xa}function fd(e){return e.ownerDocument.createTextNode(xa)}function dd(e,t){return(e?function(e){if(sd(e.previousSibling))return ld(e.previousSibling)||e.previousSibling.appendData(xa),e.previousSibling;if(sd(e))return cd(e)||e.insertData(0,xa),e;var t=fd(e);return e.parentNode.insertBefore(t,e),t}:function(e){if(sd(e.nextSibling))return cd(e.nextSibling)||e.nextSibling.insertData(0,xa),e.nextSibling;if(sd(e))return ld(e)||e.appendData(xa),e;var t=fd(e);return e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t),t})(t)}function vd(n,e){return e.fold(function(t){ss.remove(n.get());t=md(t);return n.set(t),_.some(_u(t,t.length-1))},function(e){return sc.firstPositionIn(e).map(function(t){if(hd(t,n))return _u(n.get(),1);ss.remove(n.get());t=pd(t,!0);return n.set(t),_u(t,1)})},function(e){return sc.lastPositionIn(e).map(function(t){if(hd(t,n))return _u(n.get(),n.get().length-1);ss.remove(n.get());t=pd(t,!1);return n.set(t),_u(t,t.length-1)})},function(t){ss.remove(n.get());t=gd(t);return n.set(t),_.some(_u(t,1))})}function yd(e,t){for(var n=0;n<e.length;n++){var r=e[n].apply(null,t);if(r.isSome())return r}return _.none()}function xd(e,t,n){var r=Vl.normalizeForwards(n),o=Cd(t,r.container());return Vl.findRootInline(e,o,r).fold(function(){return sc.nextPosition(o,r).bind(d(Vl.findRootInline,e,o)).map(function(e){return bd.before(e)})},_.none)}function wd(e,t){return null===Qu(e,t)}function Ed(e,t,n){var r=Vl.normalizeBackwards(n);return Nd(e,t,r).bind(function(e){return sc.prevPosition(e,r).isNone()?_.some(bd.start(e)):_.none()})}function Sd(e,t,n){var r=Vl.normalizeForwards(n);return Nd(e,t,r).bind(function(e){return sc.nextPosition(e,r).isNone()?_.some(bd.end(e)):_.none()})}function Td(e,t,n){var r=Vl.normalizeBackwards(n),o=Cd(t,r.container());return Vl.findRootInline(e,o,r).fold(function(){return sc.prevPosition(o,r).bind(d(Vl.findRootInline,e,o)).map(function(e){return bd.after(e)})},_.none)}function kd(e){return!1===Vl.isRtl(Ad(e))}function _d(e,t,n){return yd([xd,Ed,Sd,Td],[e,t,n]).filter(kd)}function Dd(e){return e.fold(bd.before,bd.before,bd.after,bd.after)}function Od(n,e,r,t,o,i){return ru(Vl.findRootInline(e,r,t),Vl.findRootInline(e,r,o),function(e,t){return e!==t&&Vl.hasSameParentBlock(r,e,t)?bd.after(n?e:t):i}).getOr(i)}function Bd(e,r){return e.fold(q(!0),function(t){return n=r,!(Rd(t=t)===Rd(n)&&Ad(t)===Ad(n));var n})}function Pd(e,t){return e?t.fold(H(_.some,bd.start),_.none,H(_.some,bd.after),_.none):t.fold(_.none,H(_.some,bd.before),_.none,H(_.some,bd.end))}function zd(e){return e.fold(bd.start,bd.start,bd.end,bd.end)}function Hd(e,t){var n=e.dom.createRng();n.setStart(t.container(),t.offset()),n.setEnd(t.container(),t.offset()),e.selection.setRng(n)}function qd(e){return!1!==e.settings.inline_boundaries}function $d(e,t){e?t.setAttribute("data-mce-selected","inline-boundary"):t.removeAttribute("data-mce-selected")}function Wd(t,e,n){return vd(e,n).map(function(e){return Hd(t,e),n})}function Yd(t,n){return function(e){return vd(n,e).map(function(e){return Xd.setCaretPosition(t,e),!0}).getOr(!1)}}function Gd(r,o,i,a){var u=r.getBody(),s=d(Vl.isInlineTarget,r);r.undoManager.ignore(function(){var e,t,n;r.selection.setRng((e=i,t=a,(n=V.document.createRange()).setStart(e.container(),e.offset()),n.setEnd(t.container(),t.offset()),n)),r.execCommand("Delete"),Ld(s,u,_u.fromRangeStart(r.selection.getRng())).map(zd).map(Yd(r,o))}),r.nodeChanged()}function Qd(e,t,n){if(e.selection.isCollapsed()&&!1!==e.settings.inline_boundaries){var r=_u.fromRangeStart(e.selection.getRng());return function(n,r,i,o){var e,t,a=(e=n.getBody(),t=o.container(),Ss(t,e)||e),u=d(Vl.isInlineTarget,n),s=Ld(u,a,o);return s.bind(function(e){return i?e.fold(q(_.some(zd(e))),_.none,q(_.some(Md(e))),_.none):e.fold(_.none,q(_.some(Md(e))),_.none,q(_.some(zd(e))))}).map(Yd(n,r)).getOrThunk(function(){var t=sc.navigate(i,a,o),e=t.bind(function(e){return Ld(u,a,e)});return(s.isSome()&&e.isSome()?Vl.findRootInline(u,a,o).map(function(e){return!!ru(sc.firstPositionIn(o=e),sc.lastPositionIn(o),function(n,t){var n=Vl.normalizePosition(!0,n),r=Vl.normalizePosition(!1,t);return sc.nextPosition(o,n).map(function(e){return e.isEqual(r)}).getOr(!0)}).getOr(!0)&&(rd(n,i,ar.fromDom(e)),!0);var o}):e.bind(function(e){return t.map(function(e){return i?Gd(n,r,o,e):Gd(n,r,e,o),!0})})).getOr(!1)})}(e,t,n,r)}return!1}function nm(e,t){return ia(ar.fromDom(e),"td,th",t)}function rm(e,t){return ra(e,"table",t)}function om(e){return!1===Mr(e.start(),e.end())}function am(e){return Qi(e,"td,th")}function sm(e,t){return im(t,e).isSome()}function cm(o,i){var a=d(Mr,o),n=i,r=a,o=nm(n.startContainer,r),i=nm(n.endContainer,r);return ru(o,i,Zd).filter(om).filter(function(e){return sm(r,e)}).orThunk(function(){return function(r,e){var t=nm(e.startContainer,r),n=nm(e.endContainer,r);return e.collapsed?_.none():ru(t,n,Zd).fold(function(){return t.fold(function(){return n.bind(function(t){return rm(t,r).bind(function(e){return Z(am(e)).map(function(e){return Zd(e,t)})})})},function(t){return rm(t,r).bind(function(e){return ee(am(e)).map(function(e){return Zd(t,e)})})})},function(e){return sm(r,e)?_.none():(n=r,rm((t=e).start(),n).bind(function(e){return ee(am(e)).map(function(e){return Zd(t.start(),e)})}));var t,n})}(r,n)}).bind(function(e){return im(t=e,a).map(function(e){return em(t,e,am(e))});var t})}function lm(e,t){return Y(e,function(e){return Mr(e,t)})}function fm(n){return ru(lm((r=n).cells(),r.rng().start()),lm(r.cells(),r.rng().end()),function(e,t){return r.cells().slice(e,t+1)}).map(function(e){var t=n.cells();return e.length===t.length?tm.removeTable(n.table()):tm.emptyCells(e)});var r}function bm(r,n){return n=function(e){return Qi(e,"td[data-mce-selected],th[data-mce-selected]")}(n),r=function(e){return U(pm(e),_o)}(r),0<n.length?n:r}function xm(e){return bm(gm(e.selection.getSel()),ar.fromDom(e.getBody()))}function wm(e,t){return z(t,nl),e.selection.setCursorLocation(t[0].dom(),0),!0}function Nm(e,t){return rd(e,!1,t),!0}function Em(n,e,r,t){return Tm(e,t).fold(function(){return t=n,function(e,t){return cm(e,t).bind(fm)}(e,r).map(function(e){return e.fold(d(Nm,t),d(wm,t))});var t},function(e){return km(n,e)}).getOr(!1)}function Sm(e,t){return X(uf(t,e),_o)}function Tm(e,t){return X(uf(t,e),function(e){return"caption"===lr(e)})}function km(e,t){return nl(t),e.selection.setCursorLocation(t.dom(),0),_.some(!0)}function Rm(a,u,e){var s=ar.fromDom(a.getBody());return Tm(s,e).fold(function(){return function(a,u,s,e){var c=_u.fromRangeStart(a.selection.getRng());return Sm(s,e).bind(function(i){return Jl(i)?km(a,i):(n=s,o=i,i=c,sc.navigate(u,a.getBody(),i).bind(function(e){return Sm(n,ar.fromDom(e.getNode())).map(function(e){return!1===Mr(e,o)})}));var n,o})}(a,u,s,e)},function(i){return n=u,r=s,o=i,i=_u.fromRangeStart((t=a).selection.getRng()),Jl(o)?km(t,o):function(u,s,c,l,f){return sc.navigate(c,u.getBody(),f).bind(function(e){return r=l,o=c,i=f,a=e,sc.firstPositionIn(r.dom()).bind(function(t){return sc.lastPositionIn(r.dom()).map(function(e){return o?i.isEqual(t)&&a.isEqual(e):i.isEqual(e)&&a.isEqual(t)})}).getOr(!0)?km(u,l):(t=l,Tm(s,ar.fromDom(e.getNode())).map(function(e){return!1===Mr(e,t)}));var t,r,o,i,a}).or(_.some(!0))}(t,r,n,o,i);var t,n,r,o}).getOr(!1)}function Dm(a,o){var r,i=ar.fromDom(a.selection.getStart(!0)),n=xm(a);return a.selection.isCollapsed()&&0===n.length?Rm(a,o,i):(r=i,o=ar.fromDom((n=a).getBody()),i=n.selection.getRng(),0!==(a=xm(n)).length?wm(n,a):Em(n,o,i,r))}function Bm(e,t,n){var r=e.formatter.get(n);if(r)for(var o=0;o<r.length;o++)if(!1===r[o].inherit&&e.dom.is(t,r[o].selector))return!0;return!1}function Pm(t,e,n,r){var o=t.dom.getRoot();return e!==o&&(e=t.dom.getParent(e,function(e){return!!Bm(t,e,n)||e.parentNode===o||!!Fm(t,e,n,r,!0)}),Fm(t,e,n,r))}function Im(e,t,n){return!!Om(t,n.inline)||!!Om(t,n.block)||(n.selector?1===t.nodeType&&e.is(t,n.selector):void 0)}function Lm(e,t,n,r,o,i){var a,u,s,c=n[r];if(n.onmatch)return n.onmatch(t,n,r);if(c)if(void 0===c.length){for(a in c)if(c.hasOwnProperty(a)){if(u="attributes"===r?e.getAttrib(t,a):wc.getStyle(e,t,a),o&&!u&&!n.exact)return;if((!o||n.exact)&&!Om(u,wc.normalizeStyleValue(e,wc.replaceVars(c[a],i),a)))return}}else for(s=0;s<c.length;s++)if("attributes"===r?e.getAttrib(t,c[s]):wc.getStyle(e,t,c[s]))return n;return n}function Fm(e,t,n,r,o){var i,a,u,s,c=e.formatter.get(n),l=e.dom;if(c&&t)for(a=0;a<c.length;a++)if(i=c[a],Im(e.dom,t,i)&&Lm(l,t,i,"attributes",o,r)&&Lm(l,t,i,"styles",o,r)){if(s=i.classes)for(u=0;u<s.length;u++)if(!e.dom.hasClass(t,s[u]))return;return i}}function Hm(e){return 0<function(e){for(var t=[];e;){if(3===e.nodeType&&e.nodeValue!==jm||1<e.childNodes.length)return[];1===e.nodeType&&t.push(e),e=e.firstChild}return t}(e).length}function qm(e){var t;if(e)for(e=(t=new go(e,e)).current();e;e=t.next())if(3===e.nodeType)return e;return null}function Ym(e,t){return e.appendChild(t),t}function Qm(e,t){return e.schema.getTextInlineElements().hasOwnProperty(lr(t))&&!Ju(t.dom())&&!jo.isBogus(t.dom())}function Zm(e){return 1===Kr(e).length}function tg(r,o){var t,e=ar.fromDom(r.getBody()),n=ar.fromDom(r.selection.getStart()),i=U((t=uf(n,e),Y(t,Co).fold(q(t),function(e){return t.slice(0,e)})),Zm);return ee(i).map(function(e){var t=_u.fromRangeStart(r.selection.getRng());return!(!function(i,a,u){return ru(sc.firstPositionIn(u),sc.lastPositionIn(u),function(e,o){var n=Vl.normalizePosition(!0,e),r=Vl.normalizePosition(!1,o),o=Vl.normalizePosition(!1,a);return(i?sc.nextPosition(u,o).map(function(e){return e.isEqual(r)&&a.isEqual(n)}):sc.prevPosition(u,o).map(function(e){return e.isEqual(n)&&a.isEqual(r)})).getOr(!1)}).getOr(!0)}(o,t,e.dom())||Ju((t=e).dom())&&Hm(t.dom())||(function(o,t,l,r){var a=d(Qm,t),a=W(U(r,a),function(e){return e.dom()});0===a.length?rd(t,o,l):(o=l.dom(),l=a,a=$m(!1),l=Gm(l,a.dom()),Pi(ar.fromDom(o),a),Ui(ar.fromDom(o)),l=_u(l,0),t.selection.setRng(l.toRange()))}(o,r,e,i),0))}).getOr(!1)}function ng(e,t){return!!e.selection.isCollapsed()&&tg(e,t)}function sg(e,t,n,r,o){return t._selectionOverrides.showCaret(e,n,r,o)}function cg(n,r){return n.fire("BeforeObjectSelected",{target:r}).isDefaultPrevented()?null:((r=(n=r).ownerDocument.createRange()).selectNode(n),r)}function lg(e,u,n){var a=Os(1,e.getBody(),u),a=(u=_u.fromRangeStart(a)).getNode();return ug(a)?sg(1,e,a,!u.isAtEnd(),!1):(a=u.getNode(!0),ug(a)?sg(1,e,a,!1,!1):(u=e.dom.getParent(u.getNode(),function(e){return ug(e)||ag(e)}),ug(u)?sg(1,e,u,!1,n):null))}function fg(e,t,n){return t&&t.collapsed&&lg(e,t,n)||t}function dg(e,t){e.selection.setRng(t),function(d,e){Z(Su.fromRangeStart(e).getClientRects()).each(function(u){var s=function(t){if(t.inline)return t.getBody().getBoundingClientRect();t=t.getWin();return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight,width:t.innerWidth,height:t.innerHeight}}(d),c=u.left>s.left&&u.right<s.right?0:u.left<s.left?u.left-s.left:u.right-s.right,u=u.top>s.top&&u.bottom<s.bottom?0:u.top<s.top?u.top-s.top:u.bottom-s.bottom,s=0!==c?0<c?c+4:c-4:0,c=0!==u?0<u?u+4:u-4:0;(u=d).inline?(u.getBody().scrollLeft+=s,u.getBody().scrollTop+=c):u.getWin().scrollBy(s,c)})}(e,e.selection.getRng())}function mg(a,t,u,s,o,c){return s=sg(s,a,c.getNode(!o),o,!0),t.collapsed?(c=t.cloneRange(),o?c.setEnd(s.startContainer,s.startOffset):c.setStart(s.endContainer,s.endOffset),c.deleteContents()):t.deleteContents(),a.selection.setRng(s),a=a.dom,jo.isText(u=u)&&0===u.data.length&&a.remove(u),!0}function gg(e,t){var n=e.selection.getRng();if(!jo.isText(n.commonAncestorContainer))return!1;var r=t?Tu.Forwards:Tu.Backwards,s=Js(e.getBody()),c=d(Ls,s.next),l=d(Ls,s.prev),f=t?c:l,s=t?Lf:Ff,c=Ps(r,e.getBody(),n);return!!(l=Vl.normalizePosition(t,f(c)))&&(s(l)?mg(e,n,c.getNode(),r,t,l):!!((f=f(l))&&s(f)&&Fs(l,f))&&mg(e,n,c.getNode(),r,t,f))}function pg(e,t){e.getDoc().execCommand(t,!1,null)}function yg(o,t,e){function n(n){return r=o,n=n.dom(),r=_r(n,r),_.from(r).filter(function(e){return 0<e.length});var r}return na(ar.fromDom(e),function(e){return n(e).isSome()},function(e){return Mr(ar.fromDom(t),e)}).bind(n)}function Sg(e,t,n){return null!==function(e,t,n){for(;e&&e!==t;){if(n(e))return e;e=e.parentNode}return null}(e,t,n)}function kg(e){return e&&"TABLE"===e.nodeName}function _g(e,t,n){for(var r=new go(t,e.getParent(t.parentNode,e.isBlock)||e.getRoot());t=r[n?"prev":"next"]();)if(jo.isBr(t))return 1}function Ag(e,t,n,r,o){var i,a,s,c,l,f=e.getRoot(),d=e.schema.getNonEmptyElements(),u=e.getParent(o.parentNode,e.isBlock)||f;if(r&&jo.isBr(o)&&t&&e.isEmpty(u))return _.some(Su(o.parentNode,e.nodeIndex(o)));for(i=new go(o,u);s=i[r?"prev":"next"]();){if("false"===e.getContentEditableParent(s)||(l=f,ka(c=s)&&!1===Sg(c,l,Ju)))return _.none();if(jo.isText(s)&&0<s.nodeValue.length)return!1===function(e,t,n){return Sg(e,t,function(e){return e.nodeName===n})}(s,f,"A")?_.some(Su(s,r?s.nodeValue.length:0)):_.none();if(e.isBlock(s)||d[s.nodeName.toLowerCase()])return _.none();a=s}return n&&a?_.some(Su(a,0)):_.none()}function Dg(e,t){var n=t.collapsed,r=t.cloneRange(),o=Su.fromRangeStart(t);return Rg(e,n,!0,r).each(function(e){n&&Su.isAbove(o,e)||r.setStart(e.container(),e.offset())}),n||Rg(e,n,!1,r).each(function(e){r.setEnd(e.container(),e.offset())}),n&&r.collapse(!0),Eg(t,r)?_.none():_.some(r)}function Og(e,t,n){var r=e.create("span",{},"&nbsp;");n.parentNode.insertBefore(r,n),t.scrollIntoView(r),e.remove(r)}function Bg(o,t,n,r){o=o.createRng(),r?(o.setStartBefore(n),o.setEndBefore(n)):(o.setStartAfter(n),o.setEndAfter(n)),t.setRng(o)}function Ig(e,t){var n=ar.fromTag("br");Pi(ar.fromDom(t),n),e.undoManager.add()}function Lg(e,t){!function(e,t){return n=_u.after(t),!!jo.isBr(n.getNode())||sc.nextPosition(e,_u.after(t)).map(function(e){return jo.isBr(e.getNode())}).getOr(!1);var n}(e.getBody(),t)&&Ii(ar.fromDom(t),ar.fromTag("br"));var n=ar.fromTag("br");Ii(ar.fromDom(t),n),Og(e.dom,e.selection,n.dom()),Bg(e.dom,e.selection,n.dom(),!1),e.undoManager.add()}function Mg(e){return e&&"A"===e.nodeName&&"href"in e}function zg(e){return e.fold(q(!1),Mg,Mg,q(!1))}function Ug(e,t){t.fold(o,d(Ig,e),d(Lg,e),o)}function Xg(e,n){return(n=mr(n)?Mc(n).length:Kr(n).length+1)<e?n:e<0?0:e}function Gg(e,t){return!jo.isRestrictedNode(t.dom())&&(zr(e,t)||Mr(e,t))}function Zg(e){return Wg.range(ar.fromDom(e.startContainer),e.startOffset,ar.fromDom(e.endContainer),e.endOffset)}function tp(e){return function(t){t=t.getSelection();return(t&&0!==t.rangeCount?_.from(t.getRangeAt(0)):_.none()).map(Zg)}(jr(e).dom()).filter(Jg(e))}function np(e,t){return _.from(t).filter(Jg(e)).map(Yg)}function rp(e){var t=V.document.createRange();try{return t.setStart(e.start().dom(),e.soffset()),t.setEnd(e.finish().dom(),e.foffset()),_.some(t)}catch(n){return _.none()}}function op(e){return(e.bookmark||_.none()).bind(d(np,ar.fromDom(e.getBody()))).bind(rp)}function sp(e){return Eo(e)||So(e)}var sl=function(a){var u=_u.fromRangeStart(a),s=_u.fromRangeEnd(a),c=a.commonAncestorContainer;return sc.fromPosition(!1,c,s).map(function(i){return!Ts(u,s,c)&&Ts(u,i,c)?(t=u.container(),n=u.offset(),r=i.container(),o=i.offset(),(i=V.document.createRange()).setStart(t,n),i.setEnd(r,o),i):a;var t,n,r,o}).getOr(a)},ll=jo.matchNodeNames("td th"),ml=function(e,r){var o="string"!=typeof(o=r)?(r=Xt.extend({paste:o.paste,data:{paste:o.paste}},o),{content:o.content,details:r}):{content:o,details:{}};dl(e,o.content,o.details)},gl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,oE=function(e,t){if(!t)return t;var n=t.container(),r=t.offset();return e?Ta(n)?jo.isText(n.nextSibling)?_u(n.nextSibling,0):_u.after(n):Aa(t)?_u(n,r+1):t:Ta(n)?jo.isText(n.previousSibling)?_u(n.previousSibling,n.previousSibling.data.length):_u.before(n):Ra(t)?_u(n,r-1):t},Vl={isInlineTarget:function(e,t){return Lr(ar.fromDom(t),e.getParam("inline_boundaries_selector","a[href],code,.mce-annotation","string"))},findRootInline:function(a,o,n){a=a,o=o,a=U(Si.DOM.getParents(n.container(),"*",o),a);return _.from(a[a.length-1])},isRtl:function(t){return"rtl"===Si.DOM.getStyle(t,"direction",!0)||(t=t.textContent,gl.test(t))},isAtZwsp:function(e){return Aa(e)||Ra(e)},normalizePosition:oE,normalizeForwards:d(oE,!0),normalizeBackwards:d(oE,!1),hasSameParentBlock:function(o,r,n){r=Ss(r,o),o=Ss(n,o);return r&&r===o}},Xl=jo.hasAttribute("data-mce-bookmark"),Yl=jo.hasAttribute("data-mce-bogus"),Gl=jo.hasAttributeValue("data-mce-bogus","all"),Ql=MN("block","position"),Zl=MN("from","to"),of=function(e,t){return function(e,t,n){return zr(t,e)?function(e,t){for(var n=D(t)?t:b,r=e.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,a=ar.fromDom(i);if(o.push(a),!0===n(a))break;r=i}return o}(e,function(e){return n(e)||Mr(e,t)}).slice(0,-1):[]}(e,t,q(!1))},af=of,uf=function(e,t){return[e].concat(of(e,t))},LN=function(a){if(!k(a))throw new Error("cases must be an array");if(0===a.length)throw new Error("there must be at least one case");var u=[],n={};return z(a,function(e,r){var t=gr(e);if(1!==t.length)throw new Error("one and only one name per case");var o=t[0],i=e[o];if(void 0!==n[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!k(i))throw new Error("case arguments must be an array");u.push(o),n[o]=function(){var e=arguments.length;if(e!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+e);for(var n=new Array(e),t=0;t<n.length;t++)n[t]=arguments[t];return{fold:function(){if(arguments.length!==a.length)throw new Error("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[r].apply(null,n)},match:function(e){var t=gr(e);if(u.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+t.join(","));if(!J(u,function(e){return F(t,e)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+u.join(", "));return e[o].apply(null,n)},log:function(e){V.console.log(e,{constructors:u,constructor:o,params:n})}}}}),n},Tf=d(Nf,!1),kf=d(Nf,!0),jN=function(n,r,o){return _.from(o.container()).filter(jo.isText).exists(function(e){var t=n?0:-1;return r(e.data.charAt(o.offset()+t))})},Of=d(jN,!0,Af),Bf=d(jN,!1,Af),Pf=function(t){t=t.container();return jo.isText(t)&&0===t.data.length},Cp=function(e,n){n=ks(e,n);return jo.isContentEditableFalse(n)&&!jo.isBogusAll(n)},Lf=d(Cp,0),Ff=d(Cp,-1),QN=function(e,t){return jo.isTable(ks(e,t))},zf=d(QN,0),Uf=d(QN,-1),jf=LN([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),sd=jo.isText,md=d(dd,!0),gd=d(dd,!1),pd=function(e,t){return jo.isText(e.container())?dd(t,e.container()):dd(t,e.getNode())},hd=function(e,n){n=n.get();return n&&e.container()===n&&Ta(n)},bd=LN([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),Cd=function(e,t){return Ss(t,e)||e},Nd=function(e,t,n){return Vl.findRootInline(e,t,n).filter(d(wd,t))},Ad=function(e){return e.fold($,$,$,$)},Rd=function(e){return e.fold(q("before"),q("start"),q("end"),q("after"))},tE=function(a,u,s,c){var e=Vl.normalizePosition(a,c),l=_d(u,s,e);return _d(u,s,e).bind(d(Pd,a)).orThunk(function(){return n=u,r=s,o=l,i=Vl.normalizePosition(t=a,c),sc.fromPosition(t,r,i).map(d(Vl.normalizePosition,t)).fold(function(){return o.map(Dd)},function(e){return _d(n,r,e).map(d(Od,t,n,r,i,e)).filter(d(Bd,o))}).filter(kd);var t,n,r,o,i})},Ld=_d,Fd=tE,Md=(d(tE,!1),d(tE,!0),Dd),Ud=function(e){return D(e.selection.getSel().modify)},jd=function(e,t,n){var r=e?1:-1;return t.setRng(_u(n.container(),n.offset()+r).toRange()),t.getSel().modify("move",e?"forward":"backward","word"),!0},RN=function(e,t,n){return function(){return!!qd(t)&&function(e,t){var r=t.selection.getRng(),r=e?_u.fromRangeEnd(r):_u.fromRangeStart(r);return!!Ud(t)&&(e&&Aa(r)?jd(!0,t.selection,r):!(e||!Ra(r))&&jd(!1,t.selection,r))}(e,t)}},Xd={move:function(a,u,s){return function(){return!!qd(a)&&(n=u,e=s,r=(t=a).getBody(),o=_u.fromRangeStart(t.selection.getRng()),i=d(Vl.isInlineTarget,t),Fd(e,i,r,o).bind(function(e){return Wd(t,n,e)}).isSome());var t,n,e,r,o,i}},moveNextWord:d(RN,!0),movePrevWord:d(RN,!1),setupSelectedState:function(a){var u=Hi(null),s=d(Vl.isInlineTarget,a);return a.on("NodeChange",function(e){var r,o,i;qd(a)&&(i=s,o=a.dom,r=e.parents,o=U(o.select('*[data-mce-selected="inline-boundary"]'),i),i=U(r,i),z(Q(o,i),d($d,!1)),z(Q(i,o),d($d,!0)),function(e,t){var n;e.selection.isCollapsed()&&!0!==e.composing&&t.get()&&(n=_u.fromRangeStart(e.selection.getRng()),_u.isTextPosition(n)&&!1===Vl.isAtZwsp(n)&&(Hd(e,ss.removeAndReposition(t.get(),n)),t.set(null)))}(a,u),function(n,r,o,t){r.selection.isCollapsed()&&(t=U(t,n),z(t,function(e){var t=_u.fromRangeStart(r.selection.getRng());Ld(n,r.getBody(),t).bind(function(e){return Wd(r,o,e)})}))}(s,a,u,e.parents))}),u},setCaretPosition:Hd},Zd=MN("start","end"),em=MN("rng","table","cells"),tm=LN([{removeTable:["element"]},{emptyCells:["cells"]}]),im=function(e,n){return rm(e.start(),n).bind(function(t){return rm(e.end(),n).bind(function(e){return Mr(t,e)?_.some(t):_.none()})})},mm=function(e){var t=[];if(e)for(var n=0;n<e.rangeCount;n++)t.push(e.getRangeAt(n));return t},gm=mm,pm=function(e){return G(e,function(t){t=Za(t);return t?[ar.fromDom(t)]:[]})},Cm=bm,Om=wc.isEq,Mm={matchNode:Fm,matchName:Im,match:function(e,t,n,r){var o;return r?Pm(e,r,t,n):(r=e.selection.getNode(),!!Pm(e,r,t,n)||!((o=e.selection.getStart())===r||!Pm(e,o,t,n)))},matchAll:function(r,o,i){var a=[],u={},e=r.selection.getStart();return r.dom.getParent(e,function(e){for(var n,t=0;t<o.length;t++)n=o[t],!u[n]&&Fm(r,e,n,i)&&(u[n]=!0,a.push(n))},r.dom.getRoot()),a},canApply:function(n,t){var r,o,i,a,u=n.formatter.get(t),s=n.dom;if(u)for(n=n.selection.getStart(),r=wc.getParents(s,n),i=u.length-1;0<=i;i--){if(!(a=u[i].selector)||u[i].defaultBlock)return!0;for(o=r.length-1;0<=o;o--)if(s.is(r[o],a))return!0}return!1},matchesUnInheritedFormatSelector:Bm},zm=function(e,t){return e.splitText(t)},Um=function(o){var t=o.startContainer,n=o.startOffset,r=o.endContainer,o=o.endOffset;return t===r&&jo.isText(t)?0<n&&n<t.nodeValue.length&&(t=(r=zm(t,n)).previousSibling,n<o?(t=r=zm(r,o-=n).previousSibling,o=r.nodeValue.length,n=0):o=0):(jo.isText(t)&&0<n&&n<t.nodeValue.length&&(t=zm(t,n),n=0),jo.isText(r)&&0<o&&o<r.nodeValue.length&&(o=(r=zm(r,o).previousSibling).nodeValue.length)),{startContainer:t,startOffset:n,endContainer:r,endOffset:o}},jm=xa,Vm="_mce_caret",$m=function(e){var t=ar.fromTag("span");return Nr(t,{id:Vm,"data-mce-bogus":"1","data-mce-type":"format-caret"}),e&&Fi(t,ar.fromText(jm)),t},Wm=function(u,t,s){void 0===s&&(s=!0);var a,o=u.dom,i=u.selection;Hm(t)?rd(u,!1,ar.fromDom(t),s):(a=i.getRng(),u=o.getParent(t,o.isBlock),(s=qm(t))&&s.nodeValue.charAt(0)===jm&&s.deleteData(0,1),s=s,a.startContainer===s&&0<a.startOffset&&a.setStart(s,a.startOffset-1),a.endContainer===s&&0<a.endOffset&&a.setEnd(s,a.endOffset-1),o.remove(t,!0),u&&o.isEmpty(u)&&nl(ar.fromDom(u)),i.setRng(a))},Km=function(e,t,n){void 0===n&&(n=!0);var r=e.dom,o=e.selection;if(t)Wm(e,t,n);else if(!(t=Qu(e.getBody(),o.getStart())))for(;t=r.get(Vm);)Wm(e,t,!1)},Xm=function(o,t,n){var r=o.dom,o=r.getParent(n,d(wc.isTextBlock,o));o&&r.isEmpty(o)?n.parentNode.replaceChild(t,n):(function(n){var t=Qi(n,"br"),n=U(function(e){for(var t=[],n=e.dom();n;)t.push(ar.fromDom(n)),n=n.lastChild;return t}(n).slice(-1),wo);t.length===n.length&&z(n,Ui)}(ar.fromDom(n)),r.isEmpty(n)?n.parentNode.replaceChild(t,n):r.insertAfter(t,n))},Gm=function(o,t){var n,r,o=(n=function(e,t){return Ym(e,t.cloneNode(!1))},r=t,function(e,t){for(var n=e.length-1;0<=n;n--)t(e[n])}(o,function(e){r=n(r,e)}),r);return Ym(o,o.ownerDocument.createTextNode(jm))},rg=function(e){for(var t=0,n=0,r=e;r&&r.nodeType;)t+=r.offsetLeft||0,n+=r.offsetTop||0,r=r.offsetParent;return{x:t,y:n}},ag=jo.isContentEditableTrue,ug=jo.isContentEditableFalse,hg=function(e){ad(e,!1)||gg(e,!1)||Qd(e,!1)||hf(e,!1)||Dm(e)||Cf(e)||ng(e,!1)||(pg(e,"Delete"),ql(e))},vg=function(e){ad(e,!0)||gg(e,!0)||Qd(e,!0)||hf(e,!0)||Dm(e)||Cf(e)||ng(e,!0)||pg(e,"ForwardDelete")},KN=function(o){return function(r,e){return _.from(e).map(ar.fromDom).filter(dr).bind(function(n){return yg(o,r,n.dom()).or((t=o,n=n.dom(),_.from(Si.DOM.getStyle(n,t,!0))));var t}).getOr("")}},Cg={getFontSize:KN("font-size"),getFontFamily:H(function(e){return e.replace(/[\'\"\\]/g,"").replace(/,\s+/g,",")},KN("font-family")),toPt:function(e,o){return/[0-9.]+px$/.test(e)?(n=72*parseInt(e,10)/96,o=Math.pow(10,o||0),Math.round(n*o)/o+"pt"):e;var n}},xg=function(e){return sc.firstPositionIn(e.getBody()).map(function(t){t=t.container();return jo.isText(t)?t.parentNode:t})},wg=function(o){return _.from(o.selection.getRng()).bind(function(e){var r=o.getBody();return e.startContainer===r&&0===e.startOffset?_.none():_.from(o.selection.getStart(!0))})},Ng=function(o,t){if(/^[0-9\.]+$/.test(t)){var n=parseInt(t,10);if(1<=n&&n<=7){var r=function(e){return Xt.explode(e.getParam("font_size_style_values",""))}(o),o=function(e){return Xt.explode(e.getParam("font_size_classes",""))}(o);return o?o[n-1]||t:r[n-1]||t}return t}return t},Eg=function(e,t){return e&&t&&e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},Rg=function(e,t,n,l){var a,u,f,g=e.getRoot(),p=!1,o=l[(n?"start":"end")+"Container"],i=l[(n?"start":"end")+"Offset"],l=jo.isElement(o)&&i===o.childNodes.length,s=e.schema.getNonEmptyElements(),c=n;if(ka(o))return _.none();if(jo.isElement(o)&&i>o.childNodes.length-1&&(c=!1),jo.isDocument(o)&&(o=g,i=0),o===g){if(c&&(u=o.childNodes[0<i?i-1:0])){if(ka(u))return _.none();if(s[u.nodeName]||kg(u))return _.none()}if(o.hasChildNodes()){if(i=Math.min(!c&&0<i?i-1:i,o.childNodes.length-1),o=o.childNodes[i],i=jo.isText(o)&&l?o.data.length:0,!t&&o===g.lastChild&&kg(o))return _.none();if(function(e,t){for(;t&&t!==e;){if(jo.isContentEditableFalse(t))return 1;t=t.parentNode}}(g,o)||ka(o))return _.none();if(o.hasChildNodes()&&!1===kg(o)){a=new go(u=o,g);do{if(jo.isContentEditableFalse(u)||ka(u)){p=!1;break}if(jo.isText(u)&&0<u.nodeValue.length){i=c?0:u.nodeValue.length,o=u,p=!0;break}if(s[u.nodeName.toLowerCase()]&&(!(f=u)||!/^(TD|TH|CAPTION)$/.test(f.nodeName))){i=e.nodeIndex(u),o=u.parentNode,c||i++,p=!0;break}}while(u=c?a.next():a.prev())}}}return t&&(jo.isText(o)&&0===i&&Ag(e,l,t,!0,o).each(function(e){o=e.container(),i=e.offset(),p=!0}),jo.isElement(o)&&(!(u=!(u=o.childNodes[i])?o.childNodes[i-1]:u)||!jo.isBr(u)||u.previousSibling&&"A"===u.previousSibling.nodeName||_g(e,u,!1)||_g(e,u,!0)||Ag(e,l,t,!0,u).each(function(e){o=e.container(),i=e.offset(),p=!0}))),c&&!t&&jo.isText(o)&&i===o.nodeValue.length&&Ag(e,l,t,!1,o).each(function(e){o=e.container(),i=e.offset(),p=!0}),p?_.some(Su(o,i)):_.none()},jg=function(e,t){var n,r,i=(r=d(Vl.isInlineTarget,n=e),i=_u.fromRangeStart(n.selection.getRng()),Ld(r,n.getBody(),i).filter(zg));i.isSome()?i.each(d(Ug,e)):function(e,m){var n,r,o=e.selection,i=e.dom,a=o.getRng();Dg(i,a).each(function(e){a.setStart(e.startContainer,e.startOffset),a.setEnd(e.endContainer,e.endOffset)});var u=a.startOffset,s=a.startContainer;1===s.nodeType&&s.hasChildNodes()&&(d=u>s.childNodes.length-1,s=s.childNodes[Math.min(u,s.childNodes.length-1)]||s,u=d&&3===s.nodeType?s.nodeValue.length:0);var l=i.getParent(s,i.isBlock),f=l?i.getParent(l.parentNode,i.isBlock):null,d=f?f.nodeName.toUpperCase():"",m=m&&m.ctrlKey;"LI"!==d||m||(l=f),s&&3===s.nodeType&&u>=s.nodeValue.length&&(function(e){for(var r,o=new go(s,l),i=e.getNonEmptyElements();r=o.next();)if(i[r.nodeName.toLowerCase()]||0<r.length)return 1}(e.schema)||(n=i.create("br"),a.insertNode(n),a.setStartAfter(n),a.setEndAfter(n),r=!0)),n=i.create("br"),zu(i,a,n),Og(i,o,n),Bg(i,o,n,r),e.undoManager.add()}(e,t)},oE={create:MN("start","soffset","finish","foffset")},jN=LN([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),qg=(jN.before,jN.on,jN.after,function(e){return e.fold($,$,$)}),$g=LN([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Wg={domRange:$g.domRange,relative:$g.relative,exact:$g.exact,exactFromRange:function(e){return $g.exact(e.start(),e.soffset(),e.finish(),e.foffset())},getWin:function(t){t=t.match({domRange:function(e){return ar.fromDom(e.startContainer)},relative:function(e,t){return qg(e)},exact:function(e,t,n,r){return e}});return jr(t)},range:oE.create},Kg=or.detect().browser,Yg=function(e){return Wg.range(e.start(),Xg(e.soffset(),e.start()),e.finish(),Xg(e.foffset(),e.finish()))},Jg=function(t){return function(e){return Gg(t,e.start())&&Gg(t,e.finish())}},ip=function(e){var t=function(e){return!0===e.inline||Kg.isIE()}(e)?tp(ar.fromDom(e.getBody())):_.none();e.bookmark=t.isSome()?t:e.bookmark},ap=function(t){op(t).each(function(e){t.selection.setRng(e)})},up=op,lp=function(e,t){var n=e.settings,r=e.dom,o=e.selection,i=e.formatter,a=/[a-z%]+$/i.exec(n.indentation)[0],u=parseInt(n.indentation,10),s=e.getParam("indent_use_margin",!1);e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList")||n.forced_root_block||r.getParent(o.getNode(),r.isBlock)||i.apply("div"),z(function(e){return U(W(e.selection.getSelectedBlocks(),ar.fromDom),function(e){return!sp(e)&&!Vr(e).map(sp).getOr(!1)})}(e),function(e){!function(e,t,a,r,o,i){var u;"false"!==e.getContentEditable(i)&&(a=a?"margin":"padding",a="TABLE"===i.nodeName?"margin":a,a+="rtl"===e.getStyle(i,"direction",!0)?"Right":"Left","outdent"===t?(u=Math.max(0,parseInt(i.style[a]||0,10)-r),e.setStyle(i,a,u?u+o:"")):(u=parseInt(i.style[a]||0,10)+r+o,e.setStyle(i,a,u)))}(r,t,s,u,a,e.dom())})},fp=Xt.each,dp=Xt.extend,mp=Xt.map,gp=Xt.inArray;function pp(s){var o,i,a,t,c={state:{},exec:{},value:{}},n=s.settings;s.on("PreInit",function(){o=s.dom,i=s.selection,n=s.settings,a=s.formatter});function r(e){var t;if(!s.quirks.isHidden()&&!s.removed){if(e=e.toLowerCase(),t=c.state[e])return t(e);try{return s.getDoc().queryCommandState(e)}catch(n){}return!1}}function e(e,n){n=n||"exec",fp(e,function(t,e){fp(e.toLowerCase().split(","),function(e){c[n][e]=t})})}function u(e,t,n){e=e.toLowerCase(),c.value[e]=function(){return t.call(n||s)}}dp(this,{execCommand:function(t,n,r,o){var i,a=!1;if(!s.removed){if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(t)||o&&o.skip_focus?ap(s):s.focus(),(o=s.fire("BeforeExecCommand",{command:t,ui:n,value:r})).isDefaultPrevented())return!1;if(i=t.toLowerCase(),o=c.exec[i])return o(i,n,r),s.fire("ExecCommand",{command:t,ui:n,value:r}),!0;if(fp(s.plugins,function(e){if(e.execCommand&&e.execCommand(t,n,r))return s.fire("ExecCommand",{command:t,ui:n,value:r}),!(a=!0)}),a)return a;if(s.theme&&s.theme.execCommand&&s.theme.execCommand(t,n,r))return s.fire("ExecCommand",{command:t,ui:n,value:r}),!0;try{a=s.getDoc().execCommand(t,n,r)}catch(u){}return!!a&&(s.fire("ExecCommand",{command:t,ui:n,value:r}),!0)}},queryCommandState:r,queryCommandValue:function(e){var t;if(!s.quirks.isHidden()&&!s.removed){if(e=e.toLowerCase(),t=c.value[e])return t(e);try{return s.getDoc().queryCommandValue(e)}catch(n){}}},queryCommandSupported:function(e){if(e=e.toLowerCase(),c.exec[e])return!0;try{return s.getDoc().queryCommandSupported(e)}catch(t){}return!1},addCommands:e,addCommand:function(e,o,i){e=e.toLowerCase(),c.exec[e]=function(e,t,n,r){return o.call(i||s,t,n,r)}},addQueryStateHandler:function(e,t,n){e=e.toLowerCase(),c.state[e]=function(){return t.call(n||s)}},addQueryValueHandler:u,hasCustomCommand:function(e){return e=e.toLowerCase(),!!c.exec[e]}});function l(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=null),s.getDoc().execCommand(e,t,n)}function f(e){return a.match(e)}function d(e,t){a.toggle(e,t?{value:t}:void 0),s.nodeChanged()}function m(e){t=i.getBookmark(e)}function g(){i.moveToBookmark(t)}e({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){s.undoManager.add()},"Cut,Copy,Paste":function(r){var t,n=s.getDoc();try{l(r)}catch(o){t=!0}!(t="paste"===r&&!n.queryCommandEnabled(r)||t)&&n.queryCommandSupported(r)||(r=s.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead."),fe.mac&&(r=r.replace(/Ctrl\+/g,"â+")),s.notificationManager.open({text:r,type:"error"}))},unlink:function(){var e;i.isCollapsed()?(e=s.dom.getParent(s.selection.getStart(),"a"))&&s.dom.remove(e,!0):a.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(e){var t=e.substring(7);"full"===t&&(t="justify"),fp("left,center,right,justify".split(","),function(e){t!==e&&a.remove("align"+e)}),"none"!==t&&d("align"+t)},"InsertUnorderedList,InsertOrderedList":function(n){var t;l(n),(t=o.getParent(i.getNode(),"ol,ul"))&&(n=t.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName)&&(m(),o.split(n,t),g()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){d(e)},"ForeColor,HiliteColor":function(e,t,n){d(e,n)},FontName:function(e,t,n){var r;(r=s).formatter.toggle("fontname",{value:Ng(r,n)}),r.nodeChanged()},FontSize:function(e,t,n){var r;(r=s).formatter.toggle("fontsize",{value:Ng(r,n)}),r.nodeChanged()},RemoveFormat:function(e){a.remove(e)},mceBlockQuote:function(){d("blockquote")},FormatBlock:function(e,t,n){return d(n||"p")},mceCleanup:function(){var e=i.getBookmark();s.setContent(s.getContent()),i.moveToBookmark(e)},mceRemoveNode:function(e,t,r){r=r||i.getNode();r!==s.getBody()&&(m(),s.dom.remove(r,!0),g())},mceSelectNodeDepth:function(e,t,n){var r=0;o.getParent(i.getNode(),function(e){if(1===e.nodeType&&r++===n)return i.select(e),!1},s.getBody())},mceSelectNode:function(e,t,n){i.select(n)},mceInsertContent:function(e,t,n){ml(s,n)},mceInsertRawHTML:function(e,t,n){i.setContent("tiny_mce_marker");var r=s.getContent();s.setContent(r.replace(/tiny_mce_marker/g,function(){return n}))},mceToggleFormat:function(e,t,n){d(n)},mceSetContent:function(e,t,n){s.setContent(n)},"Indent,Outdent":function(e){lp(s,e)},mceRepaint:function(){},InsertHorizontalRule:function(){s.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){s.hasVisual=!s.hasVisual,s.addVisual()},mceReplaceContent:function(e,t,n){s.execCommand("mceInsertContent",!1,n.replace(/\{\$selection\}/g,i.getContent({format:"text"})))},mceInsertLink:function(e,t,n){var r;"string"==typeof n&&(n={href:n}),r=o.getParent(i.getNode(),"a"),n.href=n.href.replace(" ","%20"),r&&n.href||a.remove("link"),n.href&&a.apply("link",n,r)},selectAll:function(){var t,e=o.getParent(i.getStart(),jo.isContentEditableTrue);e&&((t=o.createRng()).selectNodeContents(e),i.setRng(t))},delete:function(){hg(s)},forwardDelete:function(){vg(s)},mceNewDocument:function(){s.setContent("")},InsertLineBreak:function(e,t,n){return jg(s,n),!0}});function p(n){return function(){var t=i.isCollapsed()?[o.getParent(i.getNode(),o.isBlock)]:i.getSelectedBlocks(),t=mp(t,function(e){return!!a.matchNode(e,n)});return-1!==gp(t,!0)}}e({JustifyLeft:p("alignleft"),JustifyCenter:p("aligncenter"),JustifyRight:p("alignright"),JustifyFull:p("alignjustify"),"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":f,mceBlockQuote:function(){return f("blockquote")},Outdent:function(){var e;if(n.inline_styles){if((e=o.getParent(i.getStart(),o.isBlock))&&0<parseInt(e.style.paddingLeft,10))return!0;if((e=o.getParent(i.getEnd(),o.isBlock))&&0<parseInt(e.style.paddingLeft,10))return!0}return r("InsertUnorderedList")||r("InsertOrderedList")||!n.inline_styles&&!!o.getParent(i.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(e){var t=o.getParent(i.getNode(),"ul,ol");return t&&("insertunorderedlist"===e&&"UL"===t.tagName||"insertorderedlist"===e&&"OL"===t.tagName)}},"state"),e({Undo:function(){s.undoManager.undo()},Redo:function(){s.undoManager.redo()}}),u("FontName",function(){return wg(t=s).fold(function(){return xg(t).map(function(e){return Cg.getFontFamily(t.getBody(),e)}).getOr("")},function(e){return Cg.getFontFamily(t.getBody(),e)});var t},this),u("FontSize",function(){return wg(t=s).fold(function(){return xg(t).map(function(e){return Cg.getFontSize(t.getBody(),e)}).getOr("")},function(e){return Cg.getFontSize(t.getBody(),e)});var t},this)}function vp(a){function f(){return!1}function d(){return!0}function r(e,t,n,r){var o,i,a;if(t=!1===t?f:t)for(t={func:t},r&&Xt.extend(t,r),a=(i=e.toLowerCase().split(" ")).length;a--;)e=i[a],(o=l[e])||(o=l[e]=[],s(e,!0)),n?o.unshift(t):o.push(t);return c}function m(e,t){var n,r,o,i,a;if(e)for(n=(i=e.toLowerCase().split(" ")).length;n--;){if(e=i[n],r=l[e],!e){for(o in l)s(o,!1),delete l[o];return c}if(r){if(t)for(a=r.length;a--;)r[a].func===t&&(r=r.slice(0,a).concat(r.slice(a+1)),l[e]=r);else r.length=0;r.length||(s(e,!1),delete l[e])}}else{for(e in l)s(e,!1);l={}}return c}var c=this,l={},u=(a=a||{}).scope||c,s=a.toggleEvent||f;c.fire=function(e,t){var n,r,o,i;if(e=e.toLowerCase(),(t=t||{}).type=e,t.target||(t.target=u),t.preventDefault||(t.preventDefault=function(){t.isDefaultPrevented=d},t.stopPropagation=function(){t.isPropagationStopped=d},t.stopImmediatePropagation=function(){t.isImmediatePropagationStopped=d},t.isDefaultPrevented=f,t.isPropagationStopped=f,t.isImmediatePropagationStopped=f),a.beforeFire&&a.beforeFire(t),n=l[e])for(r=0,o=n.length;r<o;r++){if((i=n[r]).once&&m(e,i.func),t.isImmediatePropagationStopped())return t.stopPropagation(),t;if(!1===i.func.call(u,t))return t.preventDefault(),t}return t},c.on=r,c.off=m,c.once=function(e,t,n){return r(e,t,n,{once:!0})},c.has=function(e){return e=e.toLowerCase(),!(!l[e]||0===l[e].length)}}var hp=Xt.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend"," ");vp.isNative=function(e){return!!hp[e.toLowerCase()]};function bp(n){return n._eventDispatcher||(n._eventDispatcher=new vp({scope:n,toggleEvent:function(e,t){vp.isNative(e)&&n.toggleNativeEvent&&n.toggleNativeEvent(e,t)}})),n._eventDispatcher}function _p(e,t,n){try{e.getDoc().execCommand(t,!1,n)}catch(r){}}function Rp(e,t){(function(e,t,n){var r,o;Gi(e,t)&&!1===n?(o=t,$i(r=e)?r.dom().classList.remove(o):Ki(r,o),Yi(r)):n&&Xi(e,t)})(ar.fromDom(e.getBody()),"mce-content-readonly",t),t?(e.selection.controlSelection.hideResizeRect(),e.readonly=!0,e.getBody().contentEditable="false"):(e.readonly=!1,e.getBody().contentEditable="true",_p(e,"StyleWithCSS",!1),_p(e,"enableInlineTableEditing",!1),_p(e,"enableObjectResizing",!1),e.focus(),e.nodeChanged())}function Bp(e,t){return"selectionchange"===t?e.getDoc():!e.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(t)?e.getDoc().documentElement:e.settings.event_root?(e.eventRoot||(e.eventRoot=Op.select(e.settings.event_root)[0]),e.eventRoot):e.getBody()}function Pp(e,t,n){e.hidden||e.readonly?!0===e.readonly&&n.preventDefault():e.fire(t,n)}function Ip(i,a){var e,t;i.delegates||(i.delegates={}),i.delegates[a]||i.removed||(e=Bp(i,a),i.settings.event_root?(yp||(yp={},i.editorManager.on("removeEditor",function(){if(!i.editorManager.activeEditor&&yp){for(var e in yp)i.dom.unbind(Bp(i,e));yp=null}})),yp[a]||(yp[a]=t=function(e){for(var t=e.target,n=i.editorManager.get(),r=n.length;r--;){var o=n[r].getBody();o!==t&&!Op.isChildOf(t,o)||Pp(n[r],a,e)}},Op.bind(e,a,t))):(Op.bind(e,a,t=function(e){Pp(i,a,e)}),i.delegates[a]=t))}function Vp(n){return n=k(n)?n.join(" "):n,n=W(S(n)?n.split(" "):[],Gn),U(n,function(e){return 0<e.length})}function Wp(e,t,n){return _.from(t.settings[n]).filter(e)}var yp,Cp={fire:function(e,t,n){if(this.removed&&"remove"!==e&&"detach"!==e)return t;if(t=bp(this).fire(e,t,n),!1!==n&&this.parent)for(var r=this.parent();r&&!t.isPropagationStopped();)r.fire(e,t,!1),r=r.parent();return t},on:function(e,t,n){return bp(this).on(e,t,n)},off:function(e,t){return bp(this).off(e,t)},once:function(e,t){return bp(this).once(e,t)},hasEventListeners:function(e){return bp(this).has(e)}},wp=function(e,t){return e.fire("PostProcess",t)},Op=Si.DOM,QN={bindPendingEventDelegates:function(){var t=this;Xt.each(t._pendingNativeEvents,function(e){Ip(t,e)})},toggleNativeEvent:function(e,t){var n=this;"focus"!==e&&"blur"!==e&&(t?n.initialized?Ip(n,e):n._pendingNativeEvents?n._pendingNativeEvents.push(e):n._pendingNativeEvents=[e]:n.initialized&&(n.dom.unbind(Bp(n,e),e,n.delegates[e]),delete n.delegates[e]))},unbindAllNativeEvents:function(){var e,t=this,n=t.getBody(),r=t.dom;if(t.delegates){for(e in t.delegates)t.dom.unbind(Bp(t,e),e,t.delegates[e]);delete t.delegates}!t.inline&&n&&r&&(n.onload=null,r.unbind(t.getWin()),r.unbind(t.getDoc())),r&&(r.unbind(n),r.unbind(t.getContainer()))}},tE=QN=Xt.extend({},Cp,QN),Mp=MN("sections","settings"),zp=or.detect().deviceType.isTouch(),Up=["lists","autolink","autosave"],jp={theme:"mobile"},Hp=function(e,t){return e.sections().hasOwnProperty(t)},qp=function(e,t,s,r){var i=Vp(s.forced_plugins),s=Vp(r.plugins),s=(s=e&&Hp(t,"mobile")?U(s,d(F,Up)):s,[].concat(Vp(i)).concat(Vp(s)));return Xt.extend(r,{plugins:s.join(" ")})},Xp=Xt.each,Yp=Xt.explode,Gp={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},Jp=Xt.makeMap("alt,ctrl,shift,meta,access");function Qp(i){function s(o,t,n,r){return(o=Xt.map(Yp(o,">"),u))[o.length-1]=Xt.extend(o[o.length-1],{func:n,scope:r||i}),Xt.extend(o[0],{desc:i.translate(t),subpatterns:o.slice(1)})}function o(e,t){return!!t&&t.ctrl===e.ctrlKey&&t.meta===e.metaKey&&t.alt===e.altKey&&t.shift===e.shiftKey&&!!(e.keyCode===t.keyCode||e.charCode&&e.charCode===t.charCode)&&(e.preventDefault(),!0)}function c(e){return e.func?e.func.call(e.scope):null}var a={},r=[],u=function(e){var t,n,r={};for(n in Xp(Yp(e,"+"),function(e){e in Jp?r[e]=!0:/^[0-9]{2,}$/.test(e)?r.keyCode=parseInt(e,10):(r.charCode=e.charCodeAt(0),r.keyCode=Gp[e]||e.toUpperCase().charCodeAt(0))}),t=[r.keyCode],Jp)r[n]?t.push(n):r[n]=!1;return r.id=t.join(","),r.access&&(r.alt=!0,fe.mac?r.ctrl=!0:r.shift=!0),r.meta&&(fe.mac?r.meta=!0:(r.ctrl=!0,r.meta=!1)),r};i.on("keyup keypress keydown",function(t){(t.altKey||t.ctrlKey||t.metaKey||"keydown"===t.type&&112<=t.keyCode&&t.keyCode<=123)&&!t.isDefaultPrevented()&&(Xp(a,function(e){if(o(t,e))return r=e.subpatterns.slice(0),"keydown"===t.type&&c(e),!0}),o(t,r[0])&&(1===r.length&&"keydown"===t.type&&c(r[0]),r.shift()))}),this.add=function(e,n,r,o){var t;return"string"==typeof(t=r)?r=function(){i.execCommand(t,!1,null)}:Xt.isArray(t)&&(r=function(){i.execCommand(t[0],t[1],t[2])}),Xp(Yp(Xt.trim(e.toLowerCase())),function(t){t=s(t,n,r,o);a[t.id]=t}),!0},this.remove=function(t){t=s(t);return!!a[t.id]&&(delete a[t.id],!0)}}function nh(t,e){th(ar.fromDom(t.getBody()),e).bind(function(e){return sc.firstPositionIn(e.dom())}).fold(function(){t.selection.normalize()},function(e){return t.selection.setRng(e.toRange())})}function rh(e){if(e.setActive)try{e.setActive()}catch(t){e.focus()}else e.focus()}function ih(e){return e.inline?function(t){var t=t.getBody();return t&&(t=ar.fromDom(t),Zp(t)||eh(t).isSome())}(e):e.iframeElement&&Zp(ar.fromDom(e.iframeElement))}function ah(e){return e.editorManager.setActive(e)}function ph(u,f,l){var a=ar.fromDom(u.getBody()),d=u.inline?a:ar.fromDom(a.dom().ownerDocument.documentElement),l=(m=(m=u.inline,a=f,u=l,l=(f=d).dom().getBoundingClientRect(),{x:a-(m?l.left+f.dom().clientLeft+gh(f):0),y:u-(m?l.top+f.dom().clientTop+mh(f):0)})).x,f=m.y,d=fh(m=d),m=dh(m);return 0<=l&&0<=f&&l<=d&&f<=m}var Zp=function(e){var t=Ur(e).dom();return e.dom()===t.activeElement},eh=function(t){return n=void 0!==(n=Ur(t))?n.dom():V.document,_.from(n.activeElement).map(ar.fromDom).filter(function(e){return t.dom().contains(e.dom())});var n},th=function(t,e){return(e.collapsed?_.from(eu(e.startContainer,e.startOffset)).map(ar.fromDom):_.none()).bind(function(e){return ko(e)?_.some(e):!1===zr(t,e)?_.some(t):_.none()})},sh=ih,RN=function(e,t){return t.dom()[e]},KN=function(e,t){return parseInt(kr(t,e),10)},fh=d(RN,"clientWidth"),dh=d(RN,"clientHeight"),mh=d(KN,"margin-top"),gh=d(KN,"margin-left"),hh=function(n){n=n.inline?n.getBody():n.getContentAreaContainer();return _.from(n).map(ar.fromDom).map(function(e){return zr(Ur(e),e)}).getOr(!1)};function vh(n){function a(){0<o.length&&i().reposition(o)}function u(t){Y(o,function(e){return e===t}).each(function(e){o.splice(e,1)})}function r(r){if(!n.removed&&hh(n))return X(o,function(t){return!((t=i().getArgs(t)).type!==r.type||t.text!==r.text||t.progressBar||t.timeout||r.progressBar||r.timeout)}).getOrThunk(function(){n.editorManager.setActive(n);var t=i().open(r,function(){u(t),a()});return o.push(t),a(),t})}var t,o=[],i=function(){var e=n.theme;return e&&e.getNotificationManagerImpl?e.getNotificationManagerImpl():{open:e=function(){throw new Error("Theme did not provide a NotificationManager implementation.")},close:e,reposition:e,getArgs:e}};return(t=n).on("SkinLoaded",function(){var e=t.settings.service_message;e&&r({text:e,type:"warning",timeout:0,icon:""})}),t.on("ResizeEditor ResizeWindow",function(){he.requestAnimationFrame(a)}),t.on("remove",function(){z(o.slice(),function(e){i().close(e)})}),{open:r,close:function(){_.from(o[0]).each(function(e){i().close(e),u(e),a()})},getNotifications:function(){return o}}}function yh(r){function i(){var e=r.theme;return e&&e.getWindowManagerImpl?e.getWindowManagerImpl():{open:e=function(){throw new Error("Theme did not provide a WindowManager implementation.")},alert:e,confirm:e,close:e,getParams:e,setParams:e}}function a(e,t){return function(){return t?t.apply(e,arguments):void 0}}function u(e){o.push(e),r.fire("OpenWindow",{win:e})}function s(n){Y(o,function(e){return e===n}).each(function(e){o.splice(e,1),r.fire("CloseWindow",{win:n}),0===o.length&&r.focus()})}function e(){return _.from(o[o.length-1])}var o=[];return r.on("remove",function(){z(o.slice(0),function(e){i().close(e)})}),{windows:o,open:function(e,n){r.editorManager.setActive(r),ip(r);n=i().open(e,n,s);return u(n),n},alert:function(e,r,n){r=i().alert(e,a(n||this,r),s);u(r)},confirm:function(e,r,n){r=i().confirm(e,a(n||this,r),s);u(r)},close:function(){e().each(function(e){i().close(e),s(e)})},getParams:function(){return e().map(i().getParams).getOr(null)},setParams:function(t){e().each(function(e){i().setParams(e,t)})},getWindows:function(){return o}}}function Eh(e,t){e.notificationManager.open({type:"error",text:t})}function Sh(e,t){e._skinLoaded?Eh(e,t):e.on("SkinLoaded",function(){Eh(e,t)})}function Th(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=V.window.console;r&&(r.error||r.log).apply(r,arguments)}var bh={},Ch="en",xh={setCode:function(e){e&&(Ch=e,this.rtl=!!this.data[e]&&"rtl"===this.data[e]._dir)},getCode:function(){return Ch},rtl:!1,add:function(e,t){var r,n=bh[e];for(r in n||(bh[e]=n={}),t)n[r]=t[r];this.setCode(e)},translate:function(e){function n(e){return Xt.is(e,"function")?Object.prototype.toString.call(e):r(e)?"":""+e}function r(e){return""===e||null===e||Xt.is(e,"undefined")}function o(e){return e=n(e),Xt.hasOwn(t,e)?n(t[e]):e}var i,t=bh[Ch]||{};return r(e)?"":Xt.is(e,"object")&&Xt.hasOwn(e,"raw")?n(e.raw):(Xt.is(e,"array")&&(i=e.slice(1),e=o(e[0]).replace(/\{([0-9]+)\}/g,function(e,t){return Xt.hasOwn(i,t)?n(i[t]):e})),o(e).replace(/{context:\w+}$/,""))},data:bh},wh=Bi.PluginManager,kh={pluginLoadError:function(e,t){Sh(e,function(n,t){n=function(e,t){for(var n in wh.urls)if(wh.urls[n]+"/plugin"+t+".js"===e)return n;return null}(t,n.suffix);return n?xh.translate(["Failed to load plugin: {0} from url {1}",n,t]):xh.translate(["Failed to load plugin url: {0}",t])}(e,t))},pluginInitError:function(e,r,n){r=xh.translate(["Failed to initialize plugin: {0}",r]);Th(r,n),Sh(e,r)},uploadError:function(e,t){Sh(e,xh.translate(["Failed to upload image: {0}",t]))},displayError:Sh,initError:Th},_h=Bi.PluginManager,Ah=Bi.ThemeManager;function Rh(){return new(oe.getOrDie("XMLHttpRequest"))}function Dh(u,s){function n(e,r,o,t){var i,n;(i=Rh()).open("POST",s.url),i.withCredentials=s.credentials,i.upload.onprogress=function(e){t(e.loaded/e.total*100)},i.onerror=function(){o("Image upload failed due to a XHR Transport error. Code: "+i.status)},i.onload=function(){var t,n;i.status<200||300<=i.status?o("HTTP Error: "+i.status):(n=JSON.parse(i.responseText))&&"string"==typeof n.location?r((t=s.basePath,n=n.location,t?t.replace(/\/$/,"")+"/"+n.replace(/^\//,""):n)):o("Invalid JSON: "+i.responseText)},(n=new V.FormData).append("file",e.blob(),e.filename()),i.send(n)}function c(e,t){return{url:t,blobInfo:e,status:!0}}function l(e,t){return{url:"",blobInfo:e,status:!1,error:t}}function f(e,t){Xt.each(r[e],function(e){e(t)}),delete r[e]}var r={};return!1===D(s.handler)&&(s.handler=n),{upload:function(e,t){return s.url||s.handler!==n?function(e,n){return e=Xt.grep(e,function(e){return!u.isUploaded(e.blobUri())}),de.all(Xt.map(e,function(e){return u.isPending(e.blobUri())?(t=e.blobUri(),new de(function(e){r[t]=r[t]||[],r[t].push(e)})):(o=e,i=s.handler,a=n,u.markPending(o.blobUri()),new de(function(t){var n;try{var r=function(){n&&n.close()};i(o,function(e){r(),u.markUploaded(o.blobUri(),e),f(o.blobUri(),c(o,e)),t(c(o,e))},function(e){r(),u.removeFailed(o.blobUri()),f(o.blobUri(),l(o,e)),t(l(o,e))},function(e){e<0||100<e||(n=n||a()).progressBar.value(e)})}catch(e){t(l(o,e.message))}}));var o,i,a,t}))}(e,t):new de(function(e){e([])})}}}function Bh(n){var t,r=decodeURIComponent(n).split(",");return{type:t=(n=/data:([^;]+)/.exec(r[0]))?n[1]:t,data:r[1]}}function Ph(a){return new de(function(e){var t,n,r,o,i=Bh(a);try{t=function(e){return oe.getOrDie("atob")(e)}(i.data)}catch(iE){return void e(new V.Blob([]))}for(o=t.length,n=new(oe.getOrDie("Uint8Array"))(o),r=0;r<n.length;r++)n[r]=t.charCodeAt(r);e(new V.Blob([n],{type:i.type}))})}var Ih=function(e){return 0===e.indexOf("blob:")?(i=e,new de(function(e,t){function n(){t("Cannot convert "+i+" to Blob. Resource might not exist or is inaccessible.")}try{var r=Rh();r.open("GET",i,!0),r.responseType="blob",r.onload=function(){200===this.status?e(this.response):n()},r.onerror=n,r.send()}catch(o){n()}})):0===e.indexOf("data:")?Ph(e):null;var i},Lh=function(n){return new de(function(e){var t=new(oe.getOrDie("FileReader"));t.onloadend=function(){e(t.result)},t.readAsDataURL(n)})},Fh=Bh,Mh=0,zh=function(e){return(e||"blobid")+Mh++},Vh=0,Hh_uuid=function(t){return t+Vh+++(t=function(){return Math.round(4294967295*Math.random()).toString(36)},"s"+(new Date).getTime().toString(36)+t()+t()+t())};function qh(u){function g(e,t,n){for(var r=0;-1!==(r=e.indexOf(t,r))&&(e=e.substring(0,r)+n+e.substr(r+t.length),r+=n.length-t.length+1),-1!==r;);return e}function h(t,n){z(u.undoManager.data,function(e){"fragmented"===e.type?e.fragments=W(e.fragments,function(e){return p(e,t,n)}):e.content=p(e.content,t,n)})}function b(n){return i=i||Dh(f,{url:u.getParam("images_upload_url","","string"),basePath:u.getParam("images_upload_base_path","","string"),credentials:u.getParam("images_upload_credentials",!1,"boolean"),handler:u.getParam("images_upload_handler",null,"function")}),w().then(m(function(r){var e=W(r,function(e){return e.blobInfo});return i.upload(e,v).then(m(function(t){t=W(t,function(e,n){n=r[n].image;return e.status&&u.getParam("images_replace_blob_uris",!0,"boolean")?y(n,e.url):e.error&&kh.uploadError(u,e.error),{element:n,status:e.status}});return n&&n(t),t}))}))}function C(e){if(Ol(u))return b(e)}function x(t){return!1!==J(d,function(e){return e(t)})&&(0!==t.getAttribute("src").indexOf("data:")||u.getParam("images_dataimg_filter",q(!0),"function")(t))}function N(e){return e.replace(/src="(blob:[^"]+)"/g,function(e,n){var r=f.getResultUri(n);if(r)return'src="'+r+'"';r=l.getByUri(n);return(r=r||j(u.editorManager.get(),function(e,t){return e||t.editorUpload&&t.editorUpload.blobCache.getByUri(n)},null))?'src="data:'+r.blob().type+";base64,"+r.base64()+'"':e})}var n,o,t,e,i,r,a,s,c,l=(n=[],o=function(e){var t,n;if(!e.blob||!e.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");return t=e.id||Hh_uuid("blobid"),n=e.name||t,{id:q(t),name:q(n),filename:q(n+"."+({"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"}[e.blob.type.toLowerCase()]||"dat")),blob:q(e.blob),base64:q(e.base64),blobUri:q(e.blobUri||ae_createObjectURL(e.blob)),uri:q(e.uri)}},{create:function(e,t,n,r){if(S(e))return o({id:e,name:r,blob:t,base64:n});if(T(e))return o(e);throw new Error("Unknown input type")},add:function(e){t(e.id())||n.push(e)},get:t=function(t){return e(function(e){return e.id()===t})},getByUri:function(t){return e(function(e){return e.blobUri()===t})},findFirst:e=function(e){return U(n,e)[0]},removeByUri:function(t){n=U(n,function(e){return e.blobUri()!==t||(ae_revokeObjectURL(e.blobUri()),!1)})},destroy:function(){z(n,function(e){ae_revokeObjectURL(e.blobUri())}),n=[]}}),f=(a={},s=function(e,t){return{status:e,resultUri:t}},{hasBlobUri:c=function(e){return e in a},getResultUri:function(t){t=a[t];return t?t.resultUri:null},isPending:function(e){return!!c(e)&&1===a[e].status},isUploaded:function(e){return!!c(e)&&2===a[e].status},markPending:function(e){a[e]=s(1,null)},markUploaded:function(e,t){a[e]=s(2,t)},removeFailed:function(e){delete a[e]},destroy:function(){a={}}}),d=[],m=function(t){return function(e){return u.selection?t(e):[]}},p=function(e,t,n){return e=g(e,'src="'+t+'"','src="'+n+'"'),g(e,'data-mce-src="'+t+'"','data-mce-src="'+n+'"')},v=function(){return u.notificationManager.open({text:u.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})},y=function(e,t){l.removeByUri(e.src),h(e.src,t),u.$(e).attr({src:u.getParam("images_reuse_filename",!1,"boolean")?t+"?"+(new Date).getTime():t,"data-mce-src":u.convertURL(t,"src")})},w=function(){var o,i,a;return r||(o=f,i=l,a={},r={findAll:function(r,n){n=n||q(!0);r=U(function(e){return e?te(e.getElementsByTagName("img")):[]}(r),function(e){var t=e.src;return!!fe.fileApi&&!e.hasAttribute("data-mce-bogus")&&!e.hasAttribute("data-mce-placeholder")&&!(!t||t===fe.transparentSrc)&&(0===t.indexOf("blob:")?!o.isUploaded(t)&&n(e):0===t.indexOf("data:")&&n(e))}),r=W(r,function(n){if(a[n.src])return new de(function(t){a[n.src].then(function(e){return"string"==typeof e?e:void t({image:n,blobInfo:e.blobInfo})})});var e=new de(function(e,t){!function(n,r,o,t){var i,a;0!==r.src.indexOf("blob:")?(i=Fh(r.src).data,(a=n.findFirst(function(e){return e.base64()===i}))?o({image:r,blobInfo:a}):Ih(r.src).then(function(e){a=n.create(zh(),e,i),n.add(a),o({image:r,blobInfo:a})},function(e){t(e)})):(a=n.getByUri(r.src))?o({image:r,blobInfo:a}):Ih(r.src).then(function(t){Lh(t).then(function(e){i=Fh(e).data,a=n.create(zh(),t,i),n.add(a),o({image:r,blobInfo:a})})},function(e){t(e)})}(i,n,e,t)}).then(function(e){return delete a[e.image.src],e}).catch(function(e){return delete a[n.src],e});return a[n.src]=e});return de.all(r)}}),r.findAll(u.getBody(),x).then(m(function(e){return e=U(e,function(e){return"string"!=typeof e||(kh.displayError(u,e),!1)}),z(e,function(e){h(e.image.src,e.blobInfo.blobUri()),e.image.src=e.blobInfo.blobUri(),e.image.removeAttribute("data-mce-src")}),e}))};return u.on("setContent",function(){(Ol(u)?C:w)()}),u.on("RawSaveContent",function(e){e.content=N(e.content)}),u.on("getContent",function(e){e.source_view||"raw"===e.format||(e.content=N(e.content))}),u.on("PostRender",function(){u.parser.addNodeFilter("img",function(e){z(e,function(e){var n=e.attr("src");l.getByUri(n)||(n=f.getResultUri(n))&&e.attr("src",n)})})}),{blobCache:l,addFilter:function(e){d.push(e)},uploadImages:b,uploadImagesAuto:C,scanForImages:w,destroy:function(){l.destroy(),f.destroy(),r=i=null}}}function $h(e,t){return e.hasOwnProperty(t.nodeName)}function Kh(e){var t,a,u,s,n=e.settings,m=e.dom,g=e.selection,h=(r=e.schema).getBlockElements(),v=g.getStart(),y=e.getBody(),f=n.forced_root_block;if(v&&jo.isElement(v)&&f&&(o=y.nodeName.toLowerCase(),r.isValidChild(o,f.toLowerCase())&&(b=h,c=y,i=v,!M(af(ar.fromDom(i),ar.fromDom(c)),function(e){return $h(b,e.dom())})))){for(var b,w,N,n=(t=g.getRng()).startContainer,r=t.startOffset,o=t.endContainer,i=t.endOffset,c=sh(e),v=y.firstChild;v;)if(w=h,N=v,jo.isText(N)||jo.isElement(N)&&!$h(w,N)&&!yc(N)){if(function(e,t){if(jo.isText(t)){if(0===t.nodeValue.length)return!0;if(/^\s+$/.test(t.nodeValue)&&(!t.nextSibling||$h(e,t.nextSibling)))return!0}return!1}(h,v)){v=(u=v).nextSibling,m.remove(u);continue}a||(a=m.create(f,e.settings.forced_root_block_attrs),v.parentNode.insertBefore(a,v),s=!0),v=(u=v).nextSibling,a.appendChild(u)}else a=null,v=v.nextSibling;s&&c&&(t.setStart(n,r),t.setEnd(o,i),g.setRng(t),e.nodeChanged())}}function Xh(e){e.settings.forced_root_block&&e.on("NodeChange",d(Kh,e))}function Yh(t){return Yr(t).fold(q([t]),function(e){return[t].concat(Yh(e))})}function Gh(t){return Gr(t).fold(q([t]),function(e){return"br"===lr(e)?Hr(e).map(function(e){return[t].concat(Gh(e))}).getOr([]):[t].concat(Gh(e))})}function Qh(e,t,n,r){var o=n,i=new go(n,o),a=e.schema.getNonEmptyElements();do{if(3===n.nodeType&&0!==Xt.trim(n.nodeValue).length)return r?t.setStart(n,0):t.setEnd(n,n.nodeValue.length),0;if(a[n.nodeName]&&!/^(TD|TH)$/.test(n.nodeName))return r?t.setStartBefore(n):"BR"===n.nodeName?t.setEndBefore(n):t.setEndAfter(n),0;if(fe.ie&&fe.ie<11&&e.isBlock(n)&&e.isEmpty(n))return r?t.setStart(n,0):t.setEnd(n,0),0}while(n=r?i.next():i.prev());"BODY"===o.nodeName&&(r?t.setStart(o,0):t.setEnd(o,o.childNodes.length))}function Zh(t){return(t=t.selection.getSel())&&0<t.rangeCount}function ev(i){var r,o=[];"onselectionchange"in i.getDoc()||i.on("NodeChange Click MouseUp KeyUp Focus",function(e){var n={startContainer:(n=i.selection.getRng()).startContainer,startOffset:n.startOffset,endContainer:n.endContainer,endOffset:n.endOffset};"nodechange"!==e.type&&Eg(n,r)||i.fire("SelectionChange"),r=n}),i.on("contextmenu",function(){i.fire("SelectionChange")}),i.on("SelectionChange",function(){var e=i.selection.getStart(!0);!e||!fe.range&&i.selection.isCollapsed()||Zh(i)&&!function(e){var t,n;if((n=i.$(e).parentsUntil(i.getBody()).add(e)).length===o.length){for(t=n.length;0<=t&&n[t]===o[t];t--);if(-1===t)return o=n,1}return o=n,0}(e)&&i.dom.isChildOf(e,i.getBody())&&i.nodeChanged({selectionChange:!0})}),i.on("MouseUp",function(e){!e.isDefaultPrevented()&&Zh(i)&&("IMG"===i.selection.getNode().nodeName?he.setEditorTimeout(i,function(){i.nodeChanged()}):i.nodeChanged())}),this.nodeChanged=function(e){var n,r,t=i.selection;i.initialized&&t&&!i.settings.disable_nodechange&&!i.readonly&&(r=i.getBody(),(t=t.getStart(!0)||r).ownerDocument===i.getDoc()&&i.dom.isChildOf(t,r)||(t=r),n=[],i.dom.getParent(t,function(e){return e===r||void n.push(e)}),(e=e||{}).element=t,e.parents=n,i.fire("NodeChange",e))}}function ov(e){return j(e,function(e,t){return e.concat(function(t){function e(e){return W(e,function(e){return(e=Ka(e)).node=t,e})}if(jo.isElement(t))return e(t.getClientRects());if(jo.isText(t)){var n=t.ownerDocument.createRange();return n.setStart(t,0),n.setEnd(t,t.data.length),e(n.getClientRects())}}(t))},[])}var tv,rv={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,END:35,HOME:36,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e)},metaKeyPressed:function(e){return fe.mac?e.metaKey:e.ctrlKey&&!e.altKey}};(jN=tv=tv||{})[jN.Up=-1]="Up",jN[jN.Down=1]="Down";function sv(n){return function(e){return e.line>n}}function cv(n){return function(e){return e.line===n}}function dv(e,t){return Math.abs(e.left-t)}function mv(e,t){return Math.abs(e.right-t)}function gv(e,t){return e>=t.left&&e<=t.right}function pv(e,o){return Ht.reduce(e,function(e,t){var n=Math.min(dv(e,o),mv(e,o)),r=Math.min(dv(t,o),mv(t,o));return gv(o,t)||!gv(o,e)&&(r===n&&lv(t.node)||r<n)?t:e})}function hv(e,t,n,r){for(;r=fv(r,e,$a,t);)if(n(r))return}function yv(t,n,e){if(!e.collapsed){if(fe.ie&&fe.ie<=11&&e.startOffset===e.endOffset-1&&e.startContainer===e.endContainer){var r=e.startContainer.childNodes[e.startOffset];if(jo.isElement(r))return M(r.getClientRects(),function(e){return Qa(e,t,n)})}return M(e.getClientRects(),function(e){return Qa(e,t,n)})}}function bv(n){var o=n.getBoundingClientRect(),n=(r=n.ownerDocument).documentElement,r=r.defaultView;return{top:o.top+r.pageYOffset-n.clientTop,left:o.left+r.pageXOffset-n.clientLeft}}function Ev(u,s){return function(e){var t,n,o,r;0===e.button&&(t=X(s.dom.getParents(e.target),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ou.call(arguments);return function(e){for(var t=0;t<n.length;t++)if(n[t](e))return!0;return!1}}(xv,wv)).getOr(null),o=s.getBody(),xv(r=t)&&r!==o&&(n=s.dom.getPos(t),r=s.getBody(),o=s.getDoc().documentElement,u.element=t,u.screenX=e.screenX,u.screenY=e.screenY,u.maxX=(s.inline?r.scrollWidth:o.offsetWidth)-2,u.maxY=(s.inline?r.scrollHeight:o.offsetHeight)-2,u.relX=e.pageX-n.x,u.relY=e.pageY-n.y,u.width=t.offsetWidth,u.height=t.offsetHeight,u.ghost=function(e,i,n,r){var o=i.cloneNode(!0);e.dom.setStyles(o,{width:n,height:r}),e.dom.setAttrib(o,"data-mce-selected",null);i=e.dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return e.dom.setStyles(i,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:n,height:r}),e.dom.setStyles(o,{margin:0,boxSizing:"border-box"}),i.appendChild(o),i}(s,t,u.width,u.height)))}}function Tv(e){e.dragging=!1,e.element=null,Nv(e.ghost)}function kv(e){var s,l,f,c={},t=Si.DOM,a=V.document,n=Ev(c,e),p=c,h=e,v=he.throttle(function(e,t){h._selectionOverrides.hideFakeCaret(),h.selection.placeCaretAt(e,t)},0),r=function(e){var t,r,i,a,n,s,u,o=Math.max(Math.abs(e.screenX-p.screenX),Math.abs(e.screenY-p.screenY));if(p.element&&!p.dragging&&10<o){if(h.fire("dragstart",{target:p.element}).isDefaultPrevented())return;p.dragging=!0,h.focus()}p.dragging&&(i=p,n={pageX:(a=function(e,o){return n=e.inline?bv(e.getBody()):{left:0,top:0},r=(i=e).getBody(),r=i.inline?{left:r.scrollLeft,top:r.scrollTop}:{left:0,top:0},{pageX:(o=function(u,t){if(t.target.ownerDocument===u.getDoc())return{left:t.pageX,top:t.pageY};var o,i,n=bv(u.getContentAreaContainer()),r=(i=(o=u).getBody(),r=o.getDoc().documentElement,u={left:i.scrollLeft,top:i.scrollTop},r={left:i.scrollLeft||r.scrollLeft,top:i.scrollTop||r.scrollTop},o.inline?u:r);return{left:t.pageX-n.left+r.left,top:t.pageY-n.top+r.top}}(e,o)).left-n.left+r.left,pageY:o.top-n.top+r.top};var n,i,r}(h,e)).pageX-i.relX,pageY:a.pageY+5},s=p.ghost,u=h.getBody(),s.parentNode!==u&&u.appendChild(s),t=p.ghost,r=p.width,o=p.height,i=p.maxX,a=p.maxY,s=u=0,t.style.left=(n=n).pageX+"px",t.style.top=n.pageY+"px",a<n.pageY+o&&(s=n.pageY+o-a),t.style.width=r-(u=i<n.pageX+r?n.pageX+r-i:u)+"px",t.style.height=o-s+"px",v(e.clientX,e.clientY))},o=function(n){var t,i,o,u;!l.dragging||((o=3===(u=(i=f).selection.getSel().getRangeAt(0).startContainer).nodeType?u.parentNode:u)===(u=l.element)||i.dom.isChildOf(o,u)||xv(o))||((o=l.element.cloneNode(!0)).removeAttribute("data-mce-selected"),t=o,(n=f.fire("drop",{targetClone:t,clientX:n.clientX,clientY:n.clientY})).isDefaultPrevented()||(t=n.targetClone,f.undoManager.transact(function(){Nv(l.element),f.insertContent(f.dom.getOuterHTML(t)),f._selectionOverrides.hideFakeCaret()}))),Tv(l)},u=l=c,i=function(){u.dragging&&s.fire("dragend"),Tv(u)};(s=f=e).on("mousedown",n),e.on("mousemove",r),e.on("mouseup",o),t.bind(a,"mousemove",r),t.bind(a,"mouseup",i),e.on("remove",function(){t.unbind(a,"mousemove",r),t.unbind(a,"mouseup",i)})}function Ov(e,t){for(var n=e.getBody();t&&t!==n;){if(Rv(t)||Dv(t))return t;t=t.parentNode}return null}function Bv(g){function u(e){e&&g.selection.setRng(e)}function s(){return g.selection.getRng()}function v(e,t,n,r){return void 0===r&&(r=!0),g.fire("ShowCaret",{target:t,direction:e,before:n}).isDefaultPrevented()?null:(r&&g.selection.scrollIntoView(t,-1===e),o.show(n,t))}function y(e,t){return t=Os(e,a,t),-1===e?_u.fromRangeStart(t):_u.fromRangeEnd(t)}function b(e){return n(e.startContainer)||n(e.endContainer)}function l(e,l){var n,o,s,f,d=g.$,m=g.dom;if(!e)return null;if(e.collapsed){if(!b(e))if(!1===l){if(f=y(-1,e),gs(f.getNode(!0)))return v(-1,f.getNode(!0),!1,!1);if(gs(f.getNode()))return v(-1,f.getNode(),!f.isAtEnd(),!1)}else{if(f=y(1,e),gs(f.getNode()))return v(1,f.getNode(),!f.isAtEnd(),!1);if(gs(f.getNode(!0)))return v(1,f.getNode(!0),!1,!1)}return null}return s=e.startContainer,o=e.startOffset,l=e.endOffset,3===s.nodeType&&0===o&&Dv(s.parentNode)&&(s=s.parentNode,o=m.nodeIndex(s),s=s.parentNode),1!==s.nodeType?null:(l===o+1&&s===e.endContainer&&(n=s.childNodes[o]),Dv(n)?(l=f=n.cloneNode(!0),(s=g.fire("ObjectSelected",{target:n,targetClone:l=f})).isDefaultPrevented()?null:(o=oa(ar.fromDom(g.getBody()),"#"+h).fold(function(){return d([])},function(e){return d([e.dom()])}),l=s.targetClone,0===o.length&&(o=d('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",h)).appendTo(g.getBody()),e=g.dom.createRng(),l===f&&fe.ie?(o.empty().append('<p style="font-size: 0" data-mce-bogus="all">Â </p>').append(l),e.setStartAfter(o[0].firstChild.firstChild),e.setEndAfter(l)):(o.empty().append("Â ").append(l).append("Â "),e.setStart(o[0].firstChild,1),e.setEnd(o[0].lastChild,0)),o.css({top:m.getPos(n,g.getBody()).y}),o[0].focus(),(o=g.selection.getSel()).removeAllRanges(),o.addRange(e),z(Qi(ar.fromDom(g.getBody()),"*[data-mce-selected]"),function(e){Sr(e,"data-mce-selected")}),n.setAttribute("data-mce-selected","1"),p=n,C(),e)):null)}function f(){p&&(p.removeAttribute("data-mce-selected"),oa(ar.fromDom(g.getBody()),"#"+h).each(Ui),p=null),oa(ar.fromDom(g.getBody()),"#"+h).each(Ui),p=null}function C(){o.hide()}var p,e,t,a=g.getBody(),o=ds(g.getBody(),function(e){return g.dom.isBlock(e)},function(){return sh(g)}),h="sel-"+g.dom.uniqueId(),n=function(e){return ka(e)||Oa(e)||Ba(e)};return fe.ceFalse&&(function(){g.on("mouseup",function(e){var t=s();t.collapsed&&ph(g,e.clientX,e.clientY)&&u(lg(g,t,!1))}),g.on("click",function(e){var t;(t=Ov(g,e.target))&&(Dv(t)&&(e.preventDefault(),g.focus()),Rv(t)&&g.dom.isChildOf(t,g.selection.getNode())&&f())}),g.on("blur NewBlock",function(){f()}),g.on("ResizeWindow FullscreenStateChanged",function(){return o.reposition()});var n,t,e,r=!1;(n=g).on("touchstart",function(){r=!1}),n.on("touchmove",function(){r=!0}),n.on("touchend",function(e){var t=Ov(n,e.target);Dv(t)&&(r||(e.preventDefault(),l(cg(n,t))))}),g.on("mousedown",function(e){var t,o=e.target;o!==a&&"HTML"!==o.nodeName&&!g.dom.isChildOf(o,a)||!1===ph(g,e.clientX,e.clientY)||((t=Ov(g,o))?Dv(t)?(e.preventDefault(),l(cg(g,t))):(f(),Rv(t)&&e.shiftKey||yv(e.clientX,e.clientY,g.selection.getRng())||(C(),g.selection.placeCaretAt(e.clientX,e.clientY))):!1===gs(o)&&(f(),C(),(o=function(c,i,n){var u,s,o=ov(U(te(c.getElementsByTagName("*")),gs)),a=U(o,function(e){return n>=e.top&&n<=e.bottom});return(o=pv(a,i))&&(o=pv((a=c,c=function(t,n){n=U(ov([n]),function(e){return!t(e,u)});return s=s.concat(n),0===n.length},(s=[]).push(u=o),hv(tv.Up,a,d(c,Ga),u.node),hv(tv.Down,a,d(c,Ja),u.node),s),i))&&gs(o.node)?{node:(o=o).node,before:dv(o,i=i)<mv(o,i)}:null}(a,e.clientX,e.clientY))&&!function(e,r){var o=g.dom.getParent(e,g.dom.isBlock),r=g.dom.getParent(r,g.dom.isBlock);return!(!o||!g.dom.isChildOf(o,r)||!1!==Dv(Ov(g,o)))||o&&(r=r,!(g.dom.getParent(o,g.dom.isBlock)===g.dom.getParent(r,g.dom.isBlock)))&&function(){var t=Js(o);if(!o.firstChild)return!1;var r=_u.before(o.firstChild),r=t.next(r);return r&&!Lf(r)&&!Ff(r)}()}(e.target,o.node)&&(e.preventDefault(),o=v(1,o.node,o.before,!1),g.getBody().focus(),u(o))))}),g.on("keypress",function(e){rv.modifierPressed(e)||(e.keyCode,Dv(g.selection.getNode())&&e.preventDefault())}),g.on("getSelectionRange",function(e){var t=e.range;p&&(p.parentNode?((t=t.cloneRange()).selectNode(p),e.range=t):p=null)}),g.on("setSelectionRange",function(e){e.range=function(a){var t=g.schema.getShortEndedElements(),n=g.dom.createRng(),r=a.startContainer,o=a.startOffset,i=a.endContainer,a=a.endOffset;return br(t,r.nodeName.toLowerCase())?0===o?n.setStartBefore(r):n.setStartAfter(r):n.setStart(r,o),br(t,i.nodeName.toLowerCase())?0===a?n.setEndBefore(i):n.setEndAfter(i):n.setEnd(i,a),n}(e.range);var t=l(e.range,e.forward);t&&(e.range=t)}),g.on("AfterSetSelectionRange",function(t){var t=t.range;b(t)||"mcepastebin"===t.startContainer.parentNode.id||C(),t=t.startContainer.parentNode,g.dom.hasClass(t,"mce-offscreen-selection")||f()}),g.on("copy",function(e){var r,n=e.clipboardData;e.isDefaultPrevented()||!e.clipboardData||fe.ie||(r=(r=g.dom.get(h))?r.getElementsByTagName("*")[0]:r)&&(e.preventDefault(),n.clearData(),n.setData("text/html",r.outerHTML),n.setData("text/plain",r.outerText))}),function(e){var n;kv(e),(n=e).on("drop",function(e){var t=void 0!==e.clientX?n.getDoc().elementFromPoint(e.clientX,e.clientY):null;(xv(t)||xv(n.dom.getContentEditableParent(t)))&&e.preventDefault()})}(g),e=Vi(function(){var e;!t.removed&&t.selection.getRng().collapsed&&(e=fg(t,t.selection.getRng(),!1),t.selection.setRng(e))},0),(t=g).on("focus",function(){e.throttle()}),t.on("blur",function(){e.cancel()})}(),t=".mce-content-body",(e=g.contentStyles).push(o.getCss()),e.push(t+" .mce-offscreen-selection {position: absolute;left: -9999999999px;max-width: 1000000px;}"+t+" *[contentEditable=false] {cursor: default;}"+t+" *[contentEditable=true] {cursor: text;}")),{showCaret:v,showBlockCaretContainer:function(e){e.hasAttribute("data-mce-caret")&&(Pa(e),u(s()),g.selection.scrollIntoView(e[0]))},hideFakeCaret:C,destroy:function(){o.destroy(),p=null}}}function Iv(e,t,n){var r,o,i,u=1,a=e.getShortEndedElements();for((i=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g).lastIndex=r=n;o=i.exec(t);){if(r=i.lastIndex,"/"===o[1])u--;else if(!o[1]){if(o[2]in a)continue;u++}if(0===u)break}return r}var oE=function(o,i,a,e,u,n){function r(e){var t,n,r=ov([e]);for(-1===o&&(r=r.reverse()),t=0;t<r.length;t++)if(n=r[t],!a(n,s)){if(0<l.length&&i(n,Ht.last(l))&&c++,n.line=c,u(n))return!0;l.push(n)}}var s,c=0,l=[];return(s=Ht.last(n.getClientRects()))&&(r(n=n.getNode()),function(e,t,n,r){for(;r=Es(r,e,$a,t);)if(n(r))return}(o,e,r,n)),l},av=d(oE,tv.Up,Ga,Ja),uv=d(oE,tv.Down,Ja,Ga),lv=jo.isContentEditableFalse,fv=Es,xv=jo.isContentEditableFalse,wv=jo.isContentEditableTrue,Nv=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},Rv=jo.isContentEditableTrue,Dv=jo.isContentEditableFalse;function Fv(z,U){void 0===U&&(U=di());function e(){}!1!==(z=z||{}).fix_self_closing&&(z.fix_self_closing=!0);var j=z.comment||e,V=z.cdata||e,H=z.text||e,q=z.start||e,$=z.end||e,W=z.pi||e,K=z.doctype||e;return{parse:function(e){for(var t,n,d,o,i,a,m,c,l,f,h,v,y,b,C,x,w,_,R=0,D=[],O=0,B=ti.decode,P=Xt.makeMap("src,href,data,background,formaction,poster,xlink:href"),I=/((java|vb)script|mhtml):/i,L=function(e){for(var n,t=D.length;t--&&D[t].name!==e;);if(0<=t){for(n=D.length-1;t<=n;n--)(e=D[n]).valid&&$(e.name);D.length=t}},F=function(e,t,n,r,s){var i,a,c;if(n=(t=t.toLowerCase())in g?t:B(n||r||s||""),p&&!m&&0==(0===(c=t).indexOf("data-")||0===c.indexOf("aria-"))){if(!(i=y[t])&&b){for(a=b.length;a--&&!(i=b[a]).pattern.test(t););-1===a&&(i=null)}if(!i)return;if(i.validValues&&!(n in i.validValues))return}if(P[t]&&!z.allow_script_urls){var s=n.replace(/[\s\u0000-\u001F]+/g,"");try{s=decodeURIComponent(s)}catch(f){s=unescape(s)}if(I.test(s))return;if(c=s,!(s=z).allow_html_data_urls&&(/^data:image\//i.test(c)?!1===s.allow_svg_data_urls&&/^data:image\/svg\+xml/i.test(c):/^data:/i.test(c)))return}m&&(t in P||0===t.indexOf("on"))||(d.map[t]=n,d.push({name:t,value:n}))},S=new RegExp("<(?:(?:!--([\\w\\W]*?)--!?>)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),T=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,s=U.getShortEndedElements(),E=z.self_closing_elements||U.getSelfClosingElements(),g=U.getBoolAttrs(),p=z.validate,u=z.remove_internals,A=z.fix_self_closing,k=U.getSpecialElements(),N=e+">";t=S.exec(N);){if(R<t.index&&H(B(e.substr(R,t.index-R))),n=t[6])L(n=":"===(n=n.toLowerCase()).charAt(0)?n.substr(1):n);else if(n=t[7]){if(t.index+t[0].length>e.length){H(B(e.substr(t.index))),R=t.index+t[0].length;continue}c=(n=":"===(n=n.toLowerCase()).charAt(0)?n.substr(1):n)in s,A&&E[n]&&0<D.length&&D[D.length-1].name===n&&L(n);var r=function(o,r){o=o.exec(r);if(o){r=o[1],o=o[2];return"string"==typeof r&&"data-mce-bogus"===r.toLowerCase()?o:null}return null}(T,t[8]);if(null!==r){if("all"===r){R=Iv(U,e,S.lastIndex),S.lastIndex=R;continue}f=!1}if(!p||(l=U.getElementRule(n))){if(f=!0,p&&(y=l.attributes,b=l.attributePatterns),(v=t[8])?((m=-1!==v.indexOf("data-mce-type"))&&u&&(f=!1),(d=[]).map={},v.replace(T,F)):(d=[]).map={},p&&!m){if(C=l.attributesRequired,x=l.attributesDefault,w=l.attributesForced,l.removeEmptyAttrs&&!d.length&&(f=!1),w)for(o=w.length;o--;)a=(h=w[o]).name,"{$uid}"===(_=h.value)&&(_="mce_"+O++),d.map[a]=_,d.push({name:a,value:_});if(x)for(o=x.length;o--;)(a=(h=x[o]).name)in d.map||("{$uid}"===(_=h.value)&&(_="mce_"+O++),d.map[a]=_,d.push({name:a,value:_}));if(C){for(o=C.length;o--&&!(C[o]in d.map););-1===o&&(f=!1)}if(h=d.map["data-mce-bogus"]){if("all"===h){R=Iv(U,e,S.lastIndex),S.lastIndex=R;continue}f=!1}}f&&q(n,d,c)}else f=!1;if(r=k[n]){r.lastIndex=R=t.index+t[0].length,R=(t=r.exec(e))?(f&&(i=e.substr(R,t.index-R)),t.index+t[0].length):(i=e.substr(R),e.length),f&&(0<i.length&&H(i,!0),$(n)),S.lastIndex=R;continue}c||(v&&v.indexOf("/")===v.length-1?f&&$(n):D.push({name:n,valid:f}))}else(n=t[1])?(">"===n.charAt(0)&&(n=" "+n),z.allow_conditional_comments||"[if"!==n.substr(0,3).toLowerCase()||(n=" "+n),j(n)):(n=t[2])?V(function(e){for(var t=e;/<!--|--!?>/g.test(t);)t=t.replace(/<!--|--!?>/g,"");return t}(n)):(n=t[3])?K(n):(n=t[4])&&W(n,t[5]);R=t.index+t[0].length}for(R<e.length&&H(B(e.substr(R))),o=D.length-1;0<=o;o--)(n=D[o]).valid&&$(n.name)}}}(Fv=Fv||{}).findEndTag=Iv;function qv(g,p){function c(e,t,n,r,o){var i=function(e,t,n,r){var o=t-e,i=r-n;if(0===o||0===i)return null;var a,u,s,c,l,f=o-i,d=i+o,m=(d%2==0?d:d+1)/2;for(h[1+m]=e,v[1+m]=t+1,a=0;a<=m;++a){for(u=-a;u<=a;u+=2){for(s=u+m,u===-a||u!==a&&h[s-1]<h[s+1]?h[s]=h[s+1]:h[s]=h[s-1]+1,l=(c=h[s])-e+n-u;c<t&&l<r&&g[c]===p[l];)h[s]=++c,++l;if(f%2!=0&&f-a<=u&&u<=f+a&&v[s-f]<=h[s])return y(v[s-f],u+e-n,t,r)}for(u=f-a;u<=f+a;u+=2){for(s=u+m-f,u===f-a||u!==f+a&&v[s+1]<=v[s-1]?v[s]=v[s+1]-1:v[s]=v[s-1],l=(c=v[s]-1)-e+n-u;e<=c&&n<=l&&g[c]===p[l];)v[s]=c--,l--;if(f%2==0&&-a<=u&&u<=a&&v[s]<=h[s+f])return y(v[s],u+e-n,t,r)}}}(e,t,n,r);if(null===i||i.start===t&&i.diag===t-r||i.end===e&&i.diag===e-n)for(var a=e,u=n;a<t||u<r;)a<t&&u<r&&g[a]===p[u]?(o.push([0,g[a]]),++a,++u):r-n<t-e?(o.push([2,g[a]]),++a):(o.push([1,p[u]]),++u);else{c(e,i.start,n,i.start-i.diag,o);for(var s=i.start;s<i.end;++s)o.push([0,g[s]]);c(i.end,t,i.end-i.diag,r,o)}}var t=g.length+p.length+2,h=new Array(t),v=new Array(t),y=function(e,t,n,r){for(var o=e;o-t<r&&o<n&&g[o]===p[o-t];)++o;return{start:e,end:o,diag:t}},t=[];return c(0,g.length,0,p.length,t),t}function $v(e){return jo.isElement(e)?e.outerHTML:jo.isText(e)?ti.encodeRaw(e.data,!1):jo.isComment(e)?"\x3c!--"+e.data+"--\x3e":""}function ey(n){var r,t=Kv(n.getBody());return-1!==(t=(r=G(t,function(t){t=Uv.trimInternal(n.serializer,t);return 0<t.length?[t]:[]})).join("")).indexOf("</iframe>")?Gv(r):Jv(t)}function ty(e,t,n){"fragmented"===t.type?Xv(t.fragments,e.getBody()):e.setContent(t.content,{format:"raw"}),e.selection.moveToBookmark(n?t.beforeBookmark:t.bookmark)}function ny(e,n){return!(!e||!n)&&(r=n,Qv(e)===Qv(r)||(n=n,Zv(e)===Zv(n)));var r}var Mv=Fv,QN=function(s,c){for(var r,o,n,l=c,f=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,d=s.schema,c=s.getTempAttrs(),s=l,c=new RegExp(["\\s?("+c.join("|")+')="[^"]+"'].join("|"),"gi"),l=s.replace(c,""),a=d.getShortEndedElements();n=f.exec(l);)r=f.lastIndex,o=n[0].length,n=a[n[1]]?r:Mv.findEndTag(d,l,r),l=l.substring(0,r-o)+l.substring(n),f.lastIndex=r-o;return wa(l)},Uv={trimExternal:QN,trimInternal:QN},Kv=function(e){return U(W(te(e.childNodes),$v),function(e){return 0<e.length})},Xv=function(n,t){var i=W(te(t.childNodes),$v),n=qv(i,n),r=t,o=0;return z(n,function(e){0===e[0]?o++:1===e[0]?(function(e,r,o){r=function(e){var n,r=V.document.createElement("div"),t=V.document.createDocumentFragment();for(e&&(r.innerHTML=e);n=r.firstChild;)t.appendChild(n);return t}(r);e.hasChildNodes()&&o<e.childNodes.length?(o=e.childNodes[o]).parentNode.insertBefore(r,o):e.appendChild(r)}(r,e[1],o),o++):2===e[0]&&function(e,n){e.hasChildNodes()&&n<e.childNodes.length&&(n=e.childNodes[n]).parentNode.removeChild(n)}(r,o)}),t},Yv=Hi(_.none()),Gv=function(e){return{type:"fragmented",fragments:e,content:"",bookmark:null,beforeBookmark:null}},Jv=function(e){return{type:"complete",fragments:null,content:e,bookmark:null,beforeBookmark:null}},Qv=function(e){return"fragmented"===e.type?e.fragments.join(""):e.content},Zv=function(e){var t=ar.fromTag("body",Yv.get().getOrThunk(function(){var e=V.document.implementation.createHTMLDocument("undo");return Yv.set(_.some(e)),e}));return ya(t,Qv(e)),z(Qi(t,"*[data-mce-bogus]"),ji),t.dom().innerHTML};function ry(u){function d(e){u.setDirty(e)}function a(e){i(!1),o.add({},e)}function n(){o.typing&&(i(!1),o.add())}var s,r,o=this,c=0,l=[],t=0,f=function(){return 0===t},i=function(e){f()&&(o.typing=e)};return u.on("init",function(){o.add()}),u.on("BeforeExecCommand",function(t){t=t.command;"Undo"!==t&&"Redo"!==t&&"mceRepaint"!==t&&(n(),o.beforeChange())}),u.on("ExecCommand",function(e){var t=e.command;"Undo"!==t&&"Redo"!==t&&"mceRepaint"!==t&&a(e)}),u.on("ObjectResizeStart Cut",function(){o.beforeChange()}),u.on("SaveContent ObjectResized blur",a),u.on("DragEnd",a),u.on("KeyUp",function(e){var t=e.keyCode;e.isDefaultPrevented()||((33<=t&&t<=36||37<=t&&t<=40||45===t||e.ctrlKey)&&(a(),u.nodeChanged()),46!==t&&8!==t||u.nodeChanged(),r&&o.typing&&!1===ny(ey(u),l[0])&&(!1===u.isDirty()&&(d(!0),u.fire("change",{level:l[0],lastLevel:null})),u.fire("TypingUndo"),r=!1,u.nodeChanged()))}),u.on("KeyDown",function(e){var n,t=e.keyCode;e.isDefaultPrevented()||(33<=t&&t<=36||37<=t&&t<=40||45===t?o.typing&&a(e):(n=e.ctrlKey&&!e.altKey||e.metaKey,!(t<16||20<t)||224===t||91===t||o.typing||n||(o.beforeChange(),i(!0),o.add({},e),r=!0)))}),u.on("MouseDown",function(e){o.typing&&a(e)}),u.on("input",function(e){e.inputType&&("insertReplacementText"===e.inputType||"insertText"===e.inputType&&null===e.data)&&a(e)}),u.addShortcut("meta+z","","Undo"),u.addShortcut("meta+y,meta+shift+z","","Redo"),u.on("AddUndo Undo Redo ClearUndos",function(e){e.isDefaultPrevented()||u.nodeChanged()}),o={data:l,typing:!1,beforeChange:function(){f()&&(s=Yu.getUndoBookmark(u.selection))},add:function(e,a){var n,i=u.settings,r=ey(u);if(e=Xt.extend(e=e||{},r),!1===f()||u.removed)return null;if(r=l[c],u.fire("BeforeAddUndo",{level:e,lastLevel:r,originalEvent:a}).isDefaultPrevented())return null;if(r&&ny(r,e))return null;if(l[c]&&(l[c].beforeBookmark=s),i.custom_undo_redo_levels&&l.length>i.custom_undo_redo_levels){for(n=0;n<l.length-1;n++)l[n]=l[n+1];l.length--,c=l.length}e.bookmark=Yu.getUndoBookmark(u.selection),c<l.length-1&&(l.length=c+1),l.push(e),c=l.length-1;a={level:e,lastLevel:r,originalEvent:a};return u.fire("AddUndo",a),0<c&&(d(!0),u.fire("change",a)),e},undo:function(){var e;return o.typing&&(o.add(),o.typing=!1,i(!1)),0<c&&(e=l[--c],ty(u,e,!0),d(!0),u.fire("undo",{level:e})),e},redo:function(){var e;return c<l.length-1&&(e=l[++c],ty(u,e,!1),d(!0),u.fire("redo",{level:e})),e},clear:function(){l=[],c=0,o.typing=!1,o.data=l,u.fire("ClearUndos")},hasUndo:function(){return 0<c||o.typing&&l[0]&&!ny(ey(u),l[0])},hasRedo:function(){return c<l.length-1&&!o.typing},transact:function(e){return n(),o.beforeChange(),o.ignore(e),o.add()},ignore:function(e){try{t++,e()}finally{t--}},extra:function(n,t){var r;o.transact(n)&&(r=l[c].bookmark,n=l[c-1],ty(u,n,!0),o.transact(t)&&(l[c-1].beforeBookmark=r))}}}var ay={},uy=Ht.filter,sy=Ht.each,RN=function(e){var n,r=e.selection.getRng(),t=jo.matchNodeNames("pre");r.collapsed||(n=e.selection.getSelectedBlocks(),sy(uy(uy(n,t),function(e){return t(e.previousSibling)&&-1!==Ht.indexOf(n,e.previousSibling)}),function(n){var t=n.previousSibling;gn(n=n).remove(),gn(t).append("<br><br>").append(n.childNodes)}))};ay["pre"]||(ay.pre=[]),ay.pre.push(RN);function vy(e,t,n,r){return!(t=wc.getNonWhiteSpaceSibling(t,n,r))||"BR"===t.nodeName||e.isBlock(t)}function Ny(e,t){for(var n=e;n;n=n[t]){if(3===n.nodeType&&0!==n.nodeValue.length)return e;if(1===n.nodeType&&!yc(n))return n}return e}function Fy(g,p,h,r){function b(n,e){var t;e=e||y,n&&(e.onformat&&e.onformat(n,e,h,r),Ly(e.styles,function(e,t){i.setStyle(n,t,wc.replaceVars(e,h))}),e.styles&&(t=i.getAttrib(n,"style"))&&n.setAttribute("data-mce-style",t),Ly(e.attributes,function(e,t){i.setAttrib(n,t,wc.replaceVars(e,h))}),Ly(e.classes,function(e){e=wc.replaceVars(e,h),i.hasClass(n,e)||i.addClass(n,e)}))}function C(e,t){var n=!1;return!!y.selector&&(Ly(e,function(e){if(!("collapsed"in e&&e.collapsed!==o))return i.is(t,e.selector)&&!Ju(t)?(b(t,e),!(n=!0)):void 0}),n)}function a(s,e,t,c){var d=[],m=!0,l=y.inline||y.block,f=s.create(l);b(f),Lc(s,e,function(e){var a,u=function(e){var r,o=m,t=e.nodeName.toLowerCase(),n=e.parentNode.nodeName.toLowerCase();if(1===e.nodeType&&s.getContentEditable(e)&&(o=m,m="true"===s.getContentEditable(e),r=!0),wc.isEq(t,"br"))return a=0,void(y.block&&s.remove(e));if(y.wrapper&&Mm.matchNode(g,e,p,h))a=0;else{if(m&&!r&&y.block&&!y.wrapper&&wc.isTextBlock(g,t)&&wc.isValid(g,n,l))return e=s.rename(e,l),b(e),d.push(e),void(a=0);if(y.selector){var i=C(v,e);if(!y.inline||i)return void(a=0)}!m||r||!wc.isValid(g,l,t)||!wc.isValid(g,n,l)||!c&&3===e.nodeType&&1===e.nodeValue.length&&65279===e.nodeValue.charCodeAt(0)||Ju(e)||y.inline&&s.isBlock(e)?(a=0,Ly(Xt.grep(e.childNodes),u),r&&(m=o),a=0):(a||(a=s.clone(f,!1),e.parentNode.insertBefore(a,e),d.push(a)),a.appendChild(e))}};Ly(e,u)}),!0===y.links&&Ly(d,function(e){var t=function(e){"A"===e.nodeName&&b(e,y),Ly(Xt.grep(e.childNodes),t)};t(e)}),Ly(d,function(e){var r,o,i,n=0;Ly(e.childNodes,function(e){wc.isWhiteSpaceNode(e)||yc(e)||n++}),o=n,!(1<d.length)&&s.isBlock(e)||0!==o?(y.inline||y.wrapper)&&(y.exact||1!==o||((o=function(e){var n=!1;return Ly(e.childNodes,function(e){if((t=e)&&1===t.nodeType&&!yc(t)&&!Ju(t)&&!jo.isBogus(t))return n=e,!1;var t}),n}(r=e))&&!yc(o)&&Mm.matchName(s,o,y)&&(i=s.clone(o,!1),b(i),s.replace(i,r,!0),s.remove(o,1)),e=i||r),function(n,e,r,o){xy(e,function(t){xy(n.dom.select(t.inline,o),function(e){wy(e)&&by(n,t,r,e,t.exact?e:null)}),function(r,e){var n;e.clear_child_styles&&(n=e.links?"*:not(a)":"*",xy(r.select(n,o),function(n){wy(n)&&xy(e.styles,function(e,t){r.setStyle(n,t,"")})}))}(n.dom,t)})}(g,v,h,e),function(t,n,r,o,i){Mm.matchNode(t,i.parentNode,r,o)&&by(t,n,o,i)||n.merge_with_parents&&t.dom.getParent(i.parentNode,function(e){if(Mm.matchNode(t,e,r,o))return by(t,n,o,i),!0})}(g,y,p,h,e),function(e,t,n,r){t.styles&&t.styles.backgroundColor&&Sy(r,Ty(e,"fontSize"),ky(e,"backgroundColor",wc.replaceVars(t.styles.backgroundColor,n)))}(s,y,h,e),function(e,t,r){"sub"!==t.inline&&"sup"!==t.inline||(Sy(r,Ty(e,"fontSize"),ky(e,"fontSize","")),e.remove(e.select("sup"===t.inline?"sub":"sup",r),!0))}(s,y,e),function(e,t,r){r&&!1!==t.merge_siblings&&(r=Ey(e,wc.getNonWhiteSpaceSibling(r),r),Ey(e,r,wc.getNonWhiteSpaceSibling(r,!0)))}(s,y,e)):s.remove(e,1)})}var e,u,v=g.formatter.get(p),y=v[0],o=!r&&g.selection.isCollapsed(),i=g.dom,n=g.selection;if("false"!==i.getContentEditable(n.getNode()))y&&(r?r.nodeType?C(v,r)||((e=i.createRng()).setStartBefore(r),e.setEndAfter(r),a(i,Pc(g,e,v),0,!0)):a(i,r,0,!0):o&&y.inline&&!i.select("td[data-mce-selected],th[data-mce-selected]").length?function(e,t,n){var r,o,i,c=e.selection,a=(r=c.getRng(!0)).startOffset,l=r.startContainer.nodeValue;(o=Qu(e.getBody(),c.getStart()))&&(i=qm(o));var f,d=/[^\s\u00a0\u00ad\u200b\ufeff]/;l&&0<a&&a<l.length&&d.test(l.charAt(a))&&d.test(l.charAt(a-1))?(f=c.getBookmark(),r.collapse(!0),r=Pc(e,r,e.formatter.get(t)),r=Um(r),e.formatter.apply(t,n,r),c.moveToBookmark(f)):(o&&i.nodeValue===jm||(l=e.getDoc(),f=$m(!0).dom(),i=(o=l.importNode(f,!0)).firstChild,r.insertNode(o),a=1),e.formatter.apply(t,n,o),c.setCursorLocation(i,a))}(g,p,h):(u=g.selection.getNode(),g.settings.forced_root_block||!v[0].defaultBlock||i.getParent(u,i.isBlock)||Fy(g,v[0].defaultBlock),g.selection.setRng(cl(g.selection.getRng())),e=Yu.getPersistentBookmark(g.selection,!0),a(i,Pc(g,n.getRng(),v)),y.styles&&function(e,t,r){(t.styles.color||t.styles.textDecoration)&&(Xt.walk(r,d(Ay,e),"childNodes"),Ay(e,r))}(i,y,u),n.moveToBookmark(e),wc.moveStart(i,n,n.getRng()),g.nodeChanged()),function(e,t){sy(ay[e],function(e){e(t)})}(p,g));else{r=n.getNode();for(var s=0,c=v.length;s<c;s++)if(v[s].ceFalseOverride&&i.is(r,v[s].selector))return void b(r,v[s])}}function Uy(e,s,c,r,o){var i,a,u,l,f,d;null===s.get()&&(a=e,u={},(i=s).set({}),a.on("NodeChange",function(n){var r=wc.getParents(a.dom,n.element),o={},r=Xt.grep(r,function(e){return 1===e.nodeType&&!e.getAttribute("data-mce-bogus")});zy(i.get(),function(e,n){zy(r,function(t){return a.formatter.matchNode(t,n,{},e.similar)?(u[n]||(zy(e,function(e){e(!0,{node:t,format:n,parents:r})}),u[n]=e),o[n]=e,!1):!Mm.matchesUnInheritedFormatSelector(a,t,n)&&void 0})}),zy(u,function(e,t){o[t]||(delete u[t],zy(e,function(e){e(!1,{node:n.element,format:t,parents:r})}))})})),c=c,l=r,f=o,d=(s=s).get(),zy(c.split(","),function(e){d[e]||(d[e]=[],d[e].similar=f),d[e].push(l)}),s.set(d)}function $y(e){var t,a={classes:[],attrs:{}};return"*"!==(e=a.selector=Xt.trim(e))&&(t=e.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function(e,t,n,r,i){switch(t){case"#":a.attrs.id=n;break;case".":a.classes.push(n);break;case":":-1!==Xt.inArray("checked disabled enabled read-only required".split(" "),n)&&(a.attrs[n]=n)}return"["!==r||(i=i.match(/([\w\-]+)(?:\=\"([^\"]+))?/))&&(a.attrs[i[1]]=i[2]),""})),a.name=t||"div",a}function Ky(n,e){var t,o,r,a,u,s="";if(!1===(u=n.settings.preview_styles))return"";function c(e){return e.replace(/%(\w+)/g,"")}if("string"!=typeof u&&(u="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"),"string"==typeof e){if(!(e=n.formatter.get(e)))return;e=e[0]}return"preview"in e&&!1===(u=e.preview)?"":(t=e.block||e.inline||"span",r=(r=Wy(e.selector)).length?(r[0].name||(r[0].name=t),t=e.selector,qy(r,n)):qy([t],n),o=Hy.select(t,r)[0]||r.firstChild,Vy(e.styles,function(e,t){(e=c(e))&&Hy.setStyle(o,t,e)}),Vy(e.attributes,function(e,t){(e=c(e))&&Hy.setAttrib(o,t,e)}),Vy(e.classes,function(e){e=c(e),Hy.hasClass(o,e)||Hy.addClass(o,e)}),n.fire("PreviewFormats"),Hy.setStyles(r,{position:"absolute",left:-65535}),n.getBody().appendChild(r),a=Hy.getStyle(n.getBody(),"fontSize",!0),a=/px$/.test(a)?parseInt(a,10):0,Vy(u.split(" "),function(e){var t=Hy.getStyle(o,e,!0);if(!("background-color"===e&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(t)&&(t=Hy.getStyle(n.getBody(),e,!0),"#ffffff"===Hy.toHex(t).toLowerCase())||"color"===e&&"#000000"===Hy.toHex(t).toLowerCase())){if("font-size"===e&&/em|%$/.test(t)){if(0===a)return;t=parseFloat(t)/(/%$/.test(t)?100:1)*a+"px"}"border"===e&&t&&(s+="padding:0 2px;"),s+=e+":"+t+";"}}),n.fire("AfterPreviewFormats"),Hy.remove(r),s)}function Xy(e,i,n,r,o){i=i.get(n),!Mm.match(e,n,r,o)||"toggle"in i[0]&&!i[0].toggle?My.applyFormat(e,n,r,o):Cy(e,n,r,o)}var ly=/^(src|href|style)$/,fy=Xt.each,dy=wc.isEq,my=function(e,t,n){return e.isChildOf(t,n)&&t!==n&&!e.isBlock(n)},gy=function(e,i,n){var r=i[n?"startContainer":"endContainer"],o=i[n?"startOffset":"endOffset"];return jo.isElement(r)&&(i=r.childNodes.length-1,!n&&o&&o--,r=r.childNodes[i<o?i:o]),jo.isText(r)&&n&&o>=r.nodeValue.length&&(r=new go(r,e.getBody()).next()||r),r=jo.isText(r)&&!n&&0===o?new go(r,e.getBody()).prev()||r:r},py=function(e,t,n,o){o=e.create(n,o);return t.parentNode.insertBefore(o,t),o.appendChild(t),o},hy=function(e,i,n,a,u){i=ar.fromDom(i),a=ar.fromDom(e.create(a,u)),u=(n?Wr:$r)(i);return Mi(a,u),n?(Pi(i,a),Li(a,i)):(Ii(i,a),Fi(a,i)),a.dom()},yy=function(g,n,r,o,i){var t,a,u,d,m,p,h,v,y,b=g.dom,c=b;if(!(dy(m=o,(h=n).inline)||dy(m,h.block)||h.selector&&(jo.isElement(m)&&c.is(m,h.selector))||n.links&&"A"===o.tagName))return!1;if("all"!==n.remove)for(fy(n.styles,function(e,t){e=wc.normalizeStyleValue(b,wc.replaceVars(e,r),t),"number"==typeof t&&(t=e,i=0),!n.remove_similar&&i&&!dy(wc.getStyle(b,i,t),e)||b.setStyle(o,t,""),u=1}),u&&""===b.getAttrib(o,"style")&&(o.removeAttribute("style"),o.removeAttribute("data-mce-style")),fy(n.attributes,function(e,t){var n;e=wc.replaceVars(e,r),"number"==typeof t&&(t=e,i=0),i&&!dy(b.getAttrib(i,t),e)||("class"===t&&(e=b.getAttrib(o,t))&&(n="",fy(e.split(/\s+/),function(e){/mce\-\w+/.test(e)&&(n+=(n?" ":"")+e)}),n)?b.setAttrib(o,t,n):("class"===t&&o.removeAttribute("className"),ly.test(t)&&o.removeAttribute("data-mce-"+t),o.removeAttribute(t)))}),fy(n.classes,function(e){e=wc.replaceVars(e,r),i&&!b.hasClass(i,e)||b.removeClass(o,e)}),a=b.getAttribs(o),t=0;t<a.length;t++){var C=a[t].nodeName;if(0!==C.indexOf("_")&&0!==C.indexOf("data-"))return!1}return"none"!==n.remove?(h=(m=o).parentNode,v=(d=g).dom,y=d.settings.forced_root_block,(g=n).block&&(y?h===v.getRoot()&&(g.list_block&&dy(m,g.list_block)||fy(Xt.grep(m.childNodes),function(e){wc.isValid(d,y,e.nodeName.toLowerCase())?p?p.appendChild(e):(p=py(v,e,y),v.setAttribs(p,d.settings.forced_root_block_attrs)):p=0})):v.isBlock(m)&&!v.isBlock(h)&&(vy(v,m,!1)||vy(v,m.firstChild,!0,1)||m.insertBefore(v.create("br"),m.firstChild),vy(v,m,!0)||vy(v,m.lastChild,!1,1)||m.appendChild(v.create("br")))),g.selector&&g.inline&&!dy(g.inline,m)||v.remove(m,1),!0):void 0},by=yy,Cy=function(s,c,l,e,f){function i(e){var n,r,o,i,a,u=(r=c,o=l,i=f,fy(wc.getParents((n=s).dom,e.parentNode).reverse(),function(e){var t;a||"_start"===e.id||"_end"===e.id||(t=Mm.matchNode(n,e,r,o,i))&&!1!==t.split&&(a=e)}),a);return function(e,t,n,r,o,a,u){var s,c,l,f,d,m,g=e.dom;if(n){for(m=n.parentNode,s=r.parentNode;s&&s!==m;s=s.parentNode){for(c=g.clone(s,!1),d=0;d<t.length;d++)if(yy(e,t[d],u,c,c)){c=0;break}c&&(l&&c.appendChild(l),f=f||c,l=c)}a.mixed&&g.isBlock(n)||(r=g.split(n,r)),l&&(o.parentNode.insertBefore(l,o),f.appendChild(o))}return r}(s,d,u,e,e,m,l)}function p(e){var t,n=u.get(e?"_start":"_end"),r=n[e?"firstChild":"lastChild"];return yc(t=r)&&jo.isElement(t)&&("_start"===t.id||"_end"===t.id)&&(r=r[e?"firstChild":"lastChild"]),jo.isText(r)&&0===r.data.length&&(r=e?n.previousSibling||n.nextSibling:n.nextSibling||n.previousSibling),u.remove(n,!0),r}function o(e){var t,n,r=e.commonAncestorContainer;if(e=Pc(s,e,d,!0),m.split){if(e=Um(e),(t=gy(s,e,!0))!==(n=gy(s,e))){if(/^(TR|TH|TD)$/.test(t.nodeName)&&t.firstChild&&(t="TR"===t.nodeName?t.firstChild.firstChild||t:t.firstChild||t),r&&/^T(HEAD|BODY|FOOT|R)$/.test(r.nodeName)&&/^(TH|TD)$/.test(n.nodeName)&&n.firstChild&&(n=n.firstChild||n),my(u,t,n)){var o=_.from(t.firstChild).getOr(t);return i(hy(u,o,!0,"span",{id:"_start","data-mce-type":"bookmark"})),p(!0),0}if(my(u,n,t))return o=_.from(n.lastChild).getOr(n),i(hy(u,o,!1,"span",{id:"_end","data-mce-type":"bookmark"})),p(!1),0;t=py(u,t,"span",{id:"_start","data-mce-type":"bookmark"}),n=py(u,n,"span",{id:"_end","data-mce-type":"bookmark"}),i(t),i(n),t=p(!0),n=p()}else t=n=i(t);e.startContainer=t.parentNode||t,e.startOffset=u.nodeIndex(t),e.endContainer=n.parentNode||n,e.endOffset=u.nodeIndex(n)+1}Lc(u,e,function(e){fy(e,function(e){g(e),jo.isElement(e)&&"underline"===s.dom.getStyle(e,"text-decoration")&&e.parentNode&&"underline"===wc.getTextDecoration(u,e.parentNode)&&yy(s,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,e)})})}var t,d=s.formatter.get(c),m=d[0],a=!0,u=s.dom,r=s.selection,g=function(e){var t,n,r,o,i;if(jo.isElement(e)&&u.getContentEditable(e)&&(o=a,a="true"===u.getContentEditable(e),i=!0),t=Xt.grep(e.childNodes),a&&!i)for(n=0,r=d.length;n<r&&!yy(s,d[n],l,e,e);n++);if(m.deep&&t.length){for(n=0,r=t.length;n<r;n++)g(t[n]);i&&(a=o)}};if(e)e.nodeType?((t=u.createRng()).setStartBefore(e),t.setEndAfter(e),o(t)):o(e);else if("false"!==u.getContentEditable(r.getNode()))r.isCollapsed()&&m.inline&&!u.select("td[data-mce-selected],th[data-mce-selected]").length?function(e,t,n,r){var u,s,c,h,v,f=e.dom,d=e.selection,m=[],l=d.getRng(),o=l.startContainer,i=l.startOffset;for(3===(s=o).nodeType&&(i!==o.nodeValue.length&&(u=!0),s=s.parentNode);s;){if(Mm.matchNode(e,s,t,n,r)){c=s;break}s.nextSibling&&(u=!0),m.push(s),s=s.parentNode}c&&(u?(v=d.getBookmark(),l.collapse(!0),h=Pc(e,l,e.formatter.get(t),!0),h=Um(h),e.formatter.remove(t,n,h),d.moveToBookmark(v)):(l=Qu(e.getBody(),c),h=$m(!1).dom(),v=Gm(m,h),Xm(e,h,l||c),Wm(e,l,!1),d.setCursorLocation(v,1),f.isEmpty(c)&&f.remove(c)))}(s,c,l,f):(t=Yu.getPersistentBookmark(s.selection,!0),o(r.getRng()),r.moveToBookmark(t),m.inline&&Mm.match(s,c,l,r.getStart())&&wc.moveStart(u,r,r.getRng()),s.nodeChanged());else{e=r.getNode();for(var h=0,v=d.length;h<v&&(!d[h].ceFalseOverride||!yy(s,d[h],l,e,e));h++);}},xy=Xt.each,wy=function(e){return e&&1===e.nodeType&&!yc(e)&&!Ju(e)&&!jo.isBogus(e)},Ey=function(e,t,n){var r,o,i=new el(e);if(t&&n&&(t=Ny(t,"previousSibling"),n=Ny(n,"nextSibling"),i.compare(t,n))){for(r=t.nextSibling;r&&r!==n;)r=(o=r).nextSibling,t.appendChild(o);return e.remove(n),Xt.each(Xt.grep(n.childNodes),function(e){t.appendChild(e)}),t}return n},Sy=function(e,t,n){xy(e.childNodes,function(e){wy(e)&&(t(e)&&n(e),e.hasChildNodes()&&Sy(e,t,n))})},Ty=function(n,e){return d(function(e,t){return!(!t||!wc.getStyle(n,t,e))},e)},ky=function(r,e,t){return d(function(e,t,n){r.setStyle(n,e,t),""===n.getAttribute("style")&&n.removeAttribute("style"),function(e,t){"SPAN"===t.nodeName&&0===e.getAttribs(t).length&&e.remove(t,!0)}(r,n)},e,t)},Ay=function(e,t){var n;1===t.nodeType&&t.parentNode&&1===t.parentNode.nodeType&&(n=wc.getTextDecoration(e,t.parentNode),e.getStyle(t,"color")&&n?e.setStyle(t,"text-decoration",n):e.getStyle(t,"text-decoration")===n&&e.setStyle(t,"text-decoration",null))},Ly=Xt.each,My={applyFormat:Fy},zy=Xt.each,jy_get=function(r){var t={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(n,e,t){Xt.each(t,function(e,t){r.setAttrib(n,t,e)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Xt.each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(e){t[e]={block:e,remove:"all"}}),t},Vy=Xt.each,Hy=Si.DOM,qy=function(e,r){function g(r){var t,n;return o="string"==typeof r?{name:r,classes:[],attrs:{}}:r,n=t=Hy.create(o.name),(r=o).classes.length&&Hy.addClass(n,r.classes.join(" ")),Hy.setAttribs(n,r.attrs),t}function p(n,e,t){var r,o,f=0<e.length&&e[0],d=f&&f.name,u=d,i="string"!=typeof(i=n)?i.nodeName.toLowerCase():i;if(i=!(!(i=(i=m.getElementRule(i))&&i.parentsRequired)||!i.length)&&(u&&-1!==Xt.inArray(i,u)?u:i[0]))d===i?(o=e[0],e=e.slice(1)):o=i;else if(f)o=e[0],e=e.slice(1);else if(!t)return n;return o&&(r=g(o)).appendChild(n),t&&(r||(r=Hy.create("div")).appendChild(n),Xt.each(t,function(t){t=g(t);r.insertBefore(t,n)})),p(r,e,o&&o.siblings)}var n,o,m=r&&r.schema||di({});return e&&e.length?(o=e[0],n=g(o),(r=Hy.create("div")).appendChild(p(n,e.slice(1),o.siblings)),r):""},Wy=function(e){return e&&"string"==typeof e?(e=(e=e.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Xt.map(e.split(/(?:>|\s+(?![^\[\]]+\]))/),function(n){var t=Xt.map(n.split(/(?:~\+|~|\+)/),$y),n=t.pop();return t.length&&(n.siblings=t),n}).reverse()):[]};function Gy(e){var n,r,o=(n={},(r=function(e,t){e&&("string"!=typeof e?Xt.each(e,function(e,t){r(t,e)}):(t=t.length?t:[t],Xt.each(t,function(e){void 0===e.deep&&(e.deep=!e.selector),void 0===e.split&&(e.split=!e.selector||e.inline),void 0===e.remove&&e.selector&&!e.inline&&(e.remove="none"),e.selector&&e.inline&&(e.mixed=!0,e.block_expand=!0),"string"==typeof e.classes&&(e.classes=e.classes.split(/\s+/))}),n[e]=t))})(jy_get((i=e).dom)),r(i.settings.formats),{get:function(e){return e?n[e]:n},register:r,unregister:function(e){return e&&n[e]&&delete n[e],n}}),i=Hi(null);return function(e){e.addShortcut("meta+b","","Bold"),e.addShortcut("meta+i","","Italic"),e.addShortcut("meta+u","","Underline");for(var t=1;t<=6;t++)e.addShortcut("access+"+t,"",["FormatBlock",!1,"h"+t]);e.addShortcut("access+7","",["FormatBlock",!1,"p"]),e.addShortcut("access+8","",["FormatBlock",!1,"div"]),e.addShortcut("access+9","",["FormatBlock",!1,"address"])}(e),function(i){i.on("mouseup keydown",function(o){var t=i,n=o.keyCode,r=t.selection,o=t.getBody();Km(t,null,!1),8!==n&&46!==n||!r.isCollapsed()||r.getStart().innerHTML!==jm||Km(t,Qu(o,r.getStart())),37!==n&&39!==n||Km(t,Qu(o,r.getStart()))})}(e),{get:o.get,register:o.register,unregister:o.unregister,apply:d(My.applyFormat,e),remove:d(Cy,e),toggle:d(Xy,e,o),match:d(Mm.match,e),matchAll:d(Mm.matchAll,e),matchNode:d(Mm.matchNode,e),canApply:d(Mm.canApply,e),formatChanged:d(Uy,e,i),getCssText:d(Ky,e)}}function rb(e,t){var n,r=gi();t.convert_fonts_to_spans&&function(e,a,u){e.addNodeFilter("font",function(e){z(e,function(e){var t,n=a.parse(e.attr("style")),r=e.attr("color"),o=e.attr("face"),i=e.attr("size");r&&(n.color=r),o&&(n["font-family"]=o),i&&(n["font-size"]=u[parseInt(e.attr("size"),10)-1]),e.name="span",e.attr("style",a.serialize(n)),t=e,z(["color","face","size"],function(e){t.attr(e,null)})})})}(e,r,Xt.explode(t.font_size_legacy_values)),n=r,e.addNodeFilter("strike",function(e){z(e,function(e){var t=n.parse(e.attr("style"));t["text-decoration"]="line-through",e.name="span",e.attr("style",n.serialize(t))})})}function ub(e,t,n){var r,o,i=n?"lastChild":"firstChild",a=n?"prev":"next";if(e[i])return e[i];if(e!==t){if(r=e[a])return r;for(o=e.parent;o&&o!==t;o=o.parent)if(r=o[a])return r}}var Qy=Object.prototype.hasOwnProperty,Zy=function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var n={},r=0;r<e.length;r++){var i,o=e[r];for(i in o)Qy.call(o,i)&&(n[i]=(n[i],o[i]))}return n},eb={register:function(t,s,c){t.addAttributeFilter("data-mce-tabindex",function(e,t){for(var n,r=e.length;r--;)(n=e[r]).attr("tabindex",n.attributes.map["data-mce-tabindex"]),n.attr(t,null)}),t.addAttributeFilter("src,href,style",function(e,t){for(var n,r,o=e.length,i="data-mce-"+t,a=s.url_converter,u=s.url_converter_scope;o--;)void 0!==(r=(n=e[o]).attributes.map[i])?(n.attr(t,0<r.length?r:null),n.attr(i,null)):(r=n.attributes.map[t],"style"===t?r=c.serializeStyle(c.parseStyle(r),n.name):a&&(r=a.call(u,r,t,n.name)),n.attr(t,0<r.length?r:null))}),t.addAttributeFilter("class",function(e){for(var t,n,r=e.length;r--;)(t=e[r]).attr("class")&&(n=t.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),t.attr("class",0<n.length?n:null))}),t.addAttributeFilter("data-mce-type",function(e,t,n){for(var r,o=e.length;o--;)"bookmark"!==(r=e[o]).attributes.map["data-mce-type"]||n.cleanup||(_.from(r.firstChild).exists(function(e){return!Ca(e.value)})?r.unwrap():r.remove())}),t.addNodeFilter("noscript",function(e){for(var t,n=e.length;n--;)(t=e[n].firstChild)&&(t.value=ti.decode(t.value))}),t.addNodeFilter("script,style",function(e,t){for(var n,r,o,i=e.length,a=function(e){return e.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")};i--;)r=(n=e[i]).firstChild?n.firstChild.value:"","script"===t?((o=n.attr("type"))&&n.attr("type","mce-no/type"===o?null:o.replace(/^mce\-/,"")),"xhtml"===s.element_format&&0<r.length&&(n.firstChild.value="// <![CDATA[\n"+a(r)+"\n// ]]>")):"xhtml"===s.element_format&&0<r.length&&(n.firstChild.value="\x3c!--\n"+a(r)+"\n--\x3e")}),t.addNodeFilter("#comment",function(e){for(var t,n=e.length;n--;)0===(t=e[n]).value.indexOf("[CDATA[")?(t.name="#cdata",t.type=4,t.value=t.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===t.value.indexOf("mce:protected ")&&(t.name="#text",t.type=3,t.raw=!0,t.value=unescape(t.value).substr(14))}),t.addNodeFilter("xml:namespace,input",function(e,t){for(var n,r=e.length;r--;)7===(n=e[r]).type?n.remove():1===n.type&&("input"!==t||"type"in n.attributes.map||n.attr("type","text"))}),t.addAttributeFilter("data-mce-type",function(e){z(e,function(e){"format-caret"===e.attr("data-mce-type")&&(e.isEmpty(t.schema.getNonEmptyElements())?e.remove():e.unwrap())})}),t.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)})},trimTrailingBr:function(t){function r(e){return e&&"br"===e.name}var n;r(t=t.lastChild)&&r(n=t.prev)&&(t.remove(),n.remove())}},tb_process=function(a,t,o){return c=o,a&&a.hasEventListeners("PreProcess")&&!c.no_events?(i=o,c=(r=a).dom,o=(o=t).cloneNode(!0),(a=V.document.implementation).createHTMLDocument&&(u=a.createHTMLDocument(""),Xt.each("BODY"===o.nodeName?o.childNodes:[o],function(e){u.body.appendChild(u.importNode(e,!0))}),o="BODY"!==o.nodeName?u.body.firstChild:u.body,s=c.doc,c.doc=u),function(e,t){e.fire("PreProcess",t)}(r,Zy(i,{node:o})),s&&(c.doc=s),o):t;var r,i,u,s,c},ob={register:function(e,t){t.inline_styles&&rb(e,t)}},ib=/^[ \t\r\n]*$/,ab={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},sb=function(){function a(e,t){this.name=e,1===(this.type=t)&&(this.attributes=[],this.attributes.map={})}return a.create=function(e,t){var r,n=new a(e,ab[e]||1);if(t)for(r in t)n.attr(r,t[r]);return n},a.prototype.replace=function(e){return e.parent&&e.remove(),this.insert(e,this),this.remove(),this},a.prototype.attr=function(e,t){var n,r;if("string"!=typeof e){for(r in e)this.attr(r,e[r]);return this}if(n=this.attributes){if(void 0===t)return n.map[e];if(null===t){if(e in n.map)for(delete n.map[e],r=n.length;r--;)if(n[r].name===e)return n=n.splice(r,1),this;return this}if(e in n.map){for(r=n.length;r--;)if(n[r].name===e){n[r].value=t;break}}else n.push({name:e,value:t});return n.map[e]=t,this}},a.prototype.clone=function(){var e,t,n,r,o,i=new a(this.name,this.type);if(n=this.attributes){for((o=[]).map={},e=0,t=n.length;e<t;e++)"id"!==(r=n[e]).name&&(o[o.length]={name:r.name,value:r.value},o.map[r.name]=r.value);i.attributes=o}return i.value=this.value,i.shortEnded=this.shortEnded,i},a.prototype.wrap=function(e){return this.parent.insert(e,this),e.append(this),this},a.prototype.unwrap=function(){for(var t,e=this.firstChild;e;)t=e.next,this.insert(e,this,!0),e=t;this.remove()},a.prototype.remove=function(){var e=this.parent,t=this.next,n=this.prev;return e&&(e.firstChild===this?(e.firstChild=t)&&(t.prev=null):n.next=t,e.lastChild===this?(e.lastChild=n)&&(n.next=null):t.prev=n,this.parent=this.next=this.prev=null),this},a.prototype.append=function(e){var t;return e.parent&&e.remove(),(t=this.lastChild)?((t.next=e).prev=t,this.lastChild=e):this.lastChild=this.firstChild=e,e.parent=this,e},a.prototype.insert=function(e,t,n){var r;return e.parent&&e.remove(),r=t.parent||this,n?(t===r.firstChild?r.firstChild=e:t.prev.next=e,e.prev=t.prev,(e.next=t).prev=e):(t===r.lastChild?r.lastChild=e:t.next.prev=e,e.next=t.next,(e.prev=t).next=e),e.parent=r,e},a.prototype.getAll=function(e){for(var n=[],t=this.firstChild;t;t=ub(t,this))t.name===e&&n.push(t);return n},a.prototype.empty=function(){var e,t,n;if(this.firstChild){for(e=[],n=this.firstChild;n;n=ub(n,this))e.push(n);for(t=e.length;t--;)(n=e[t]).parent=n.firstChild=n.lastChild=n.next=n.prev=null}return this.firstChild=this.lastChild=null,this},a.prototype.isEmpty=function(e,t,n){var r,o,i=this.firstChild;if(t=t||{},i)do{if(1===i.type){if(i.attributes.map["data-mce-bogus"])continue;if(e[i.name])return!1;for(r=i.attributes.length;r--;)if("name"===(o=i.attributes[r].name)||0===o.indexOf("data-mce-bookmark"))return!1}if(8===i.type)return!1;if(3===i.type&&!ib.test(i.value))return!1;if(3===i.type&&i.parent&&t[i.parent.name]&&ib.test(i.value))return!1;if(n&&n(i))return!1}while(i=ub(i,this));return!0},a.prototype.walk=function(e){return ub(this,null,e)},a}(),cb=function(e,t,n,r){(e.padd_empty_with_br||t.insert)&&n[r.name]?r.empty().append(new sb("br",1)).shortEnded=!0:r.empty().append(new sb("#text",3)).value="Â "},lb=function(e){return fb(e,"#text")&&"Â "===e.firstChild.value},fb=function(e,t){return e&&e.firstChild&&e.firstChild===e.lastChild&&e.firstChild.name===t},db=function(r,e,t,n){return n.isEmpty(e,t,function(n){return(n=r.getElementRule(n.name))&&n.paddEmpty})},mb=function(e,t){return e&&(t[e.name]||"br"===e.name)},gb=function(e,p){var h=e.schema;p.remove_trailing_brs&&e.addNodeFilter("br",function(e,t,n){var r,o,i,a,u,s,c,l,f=e.length,d=Xt.extend({},h.getBlockElements()),m=h.getNonEmptyElements(),g=h.getWhiteSpaceElements();for(d.body=1,r=0;r<f;r++)if(i=(o=e[r]).parent,d[o.parent.name]&&o===i.lastChild){for(u=o.prev;u;){if("span"!==(s=u.name)||"bookmark"!==u.attr("data-mce-type")){if("br"!==s)break;if("br"===s){o=null;break}}u=u.prev}o&&(o.remove(),db(h,m,g,i)&&(c=h.getElementRule(i.name))&&(c.removeEmpty?i.remove():c.paddEmpty&&cb(p,n,d,i)))}else{for(a=o;i&&i.firstChild===a&&i.lastChild===a&&!d[(a=i).name];)i=i.parent;a===i&&!0!==p.padd_empty_with_br&&((l=new sb("#text",3)).value="Â ",o.replace(l))}}),e.addAttributeFilter("href",function(e){var r,o=e.length;if(!p.allow_unsafe_link_target)for(;o--;)"a"===(r=e[o]).name&&"_blank"===r.attr("target")&&r.attr("rel",(r=(r=r.attr("rel"))?Xt.trim(r):"",/\b(noopener)\b/g.test(r)?r:r.split(" ").filter(function(e){return 0<e.length}).concat(["noopener"]).sort().join(" ")))}),p.allow_html_in_named_anchor||e.addAttributeFilter("id,name",function(e){for(var t,n,r,o,i=e.length;i--;)if("a"===(o=e[i]).name&&o.firstChild&&!o.attr("href"))for(r=o.parent,t=o.lastChild;n=t.prev,r.insert(t,o),t=n;);}),p.fix_list_elements&&e.addNodeFilter("ul,ol",function(e){for(var t,o,r=e.length;r--;)"ul"!==(o=(t=e[r]).parent).name&&"ol"!==o.name||(t.prev&&"li"===t.prev.name?t.prev.append(t):((o=new sb("li",1)).attr("style","list-style-type: none"),t.wrap(o)))}),p.validate&&h.getValidClasses()&&e.addAttributeFilter("class",function(e){for(var t,n,r,o,i,a,u,s=e.length,c=h.getValidClasses();s--;){for(n=(t=e[s]).attr("class").split(" "),i="",r=0;r<n.length;r++)o=n[r],u=!1,(a=c["*"])&&a[o]&&(u=!0),a=c[t.name],(u=!u&&a&&a[o]?!0:u)&&(i&&(i+=" "),i+=o);i.length||(i=null),t.attr("class",i)}})},pb=Xt.makeMap,hb=Xt.each,vb=Xt.explode,yb=Xt.extend;function bb(T,k){void 0===k&&(k=di());var _={},A=[],R={},D={};(T=T||{}).validate=!("validate"in T)||T.validate,T.root_name=T.root_name||"body";function O(e){var t,n,r;(n=e.name)in _&&((r=R[n])?r.push(e):R[n]=[e]),t=A.length;for(;t--;)(n=A[t].name)in e.attributes.map&&((r=D[n])?r.push(e):D[n]=[e]);return e}var e={schema:k,addAttributeFilter:function(e,n){hb(vb(e),function(e){for(var t=0;t<A.length;t++)if(A[t].name===e)return void A[t].callbacks.push(n);A.push({name:e,callbacks:[n]})})},getAttributeFilters:function(){return[].concat(A)},addNodeFilter:function(e,n){hb(vb(e),function(e){var t=_[e];t||(_[e]=t=[]),t.push(n)})},getNodeFilters:function(){var t,e=[];for(t in _)_.hasOwnProperty(t)&&e.push({name:t,callbacks:_[t]});return e},filterNode:O,parse:function(e,a){var n,r,o,i,u,s,c,d,m=[];a=a||{},R={},D={};function N(e,n){var r=new sb(e,n);return e in _&&((n=R[e])?n.push(r):R[e]=[r]),r}function E(e){for(var o,i=k.getBlockElements(),t=e.prev;t&&3===t.type;){if(0<(o=t.value.replace(C,"")).length)return t.value=o,0;if(o=t.next){if(3===o.type&&o.value.length){t=t.prev;continue}if(!i[o.name]&&"script"!==o.name&&"style"!==o.name){t=t.prev;continue}}o=t.prev,t.remove(),t=o}}var l=yb(pb("script,style,head,html,body,title,meta,param"),k.getBlockElements()),g=k.getNonEmptyElements(),p=k.children,h=T.validate,v=("forced_root_block"in a?a:T).forced_root_block,y=k.getWhiteSpaceElements(),b=/^[ \t\r\n]+/,C=/[ \t\r\n]+$/,x=/[ \t\r\n]+/g,w=/^[ \t\r\n]+$/,f=y.hasOwnProperty(a.context)||y.hasOwnProperty(T.root_name),t=Mv({validate:h,allow_script_urls:T.allow_script_urls,allow_conditional_comments:T.allow_conditional_comments,self_closing_elements:function(e){var t,n={};for(t in e)"li"!==t&&"p"!==t&&(n[t]=e[t]);return n}(k.getSelfClosingElements()),cdata:function(e){d.append(N("#cdata",4)).value=e},text:function(e,t){var n;f||(e=e.replace(x," "),mb(d.lastChild,l)&&(e=e.replace(b,""))),0!==e.length&&((n=N("#text",3)).raw=!!t,d.append(n).value=e)},comment:function(e){d.append(N("#comment",8)).value=e},pi:function(e,t){d.append(N(e,7)).value=t,E(d)},doctype:function(e){d.append(N("#doctype",10)).value=e,E(d)},start:function(e,t,n){var r,o,a,u;if(u=h?k.getElementRule(e):{}){for((r=N(u.outputName||e,1)).attributes=t,r.shortEnded=n,d.append(r),(u=p[d.name])&&p[r.name]&&!u[r.name]&&m.push(r),o=A.length;o--;)(a=A[o].name)in t.map&&((s=D[a])?s.push(r):D[a]=[r]);l[e]&&E(r),n||(d=r),!f&&y[e]&&(f=!0)}},end:function(i){var t,n,r,o;if(n=h?k.getElementRule(i):{}){if(l[i]&&!f){if((t=d.firstChild)&&3===t.type)if(0<(r=t.value.replace(b,"")).length)t.value=r,t=t.next;else for(o=t.next,t.remove(),t=o;t&&3===t.type;)r=t.value,o=t.next,0!==r.length&&!w.test(r)||(t.remove(),t=o),t=o;if((t=d.lastChild)&&3===t.type)if(0<(r=t.value.replace(C,"")).length)t.value=r,t=t.prev;else for(o=t.prev,t.remove(),t=o;t&&3===t.type;)r=t.value,o=t.prev,0!==r.length&&!w.test(r)||(t.remove(),t=o),t=o}if(f&&y[i]&&(f=!1),n.removeEmpty&&db(k,g,y,d)&&!d.attributes.map.name&&!d.attr("id"))return i=d.parent,l[d.name]?d.empty().remove():d.unwrap(),void(d=i);n.paddEmpty&&(lb(d)||db(k,g,y,d))&&cb(T,a,l,d),d=d.parent}}},k),S=d=new sb(a.context||T.root_name,11);if(t.parse(e),h&&m.length&&(a.context?a.invalid=!0:function(e){for(var n,r,o,i,a,u,s,c,p,h,d=pb("tr,td,th,tbody,thead,tfoot,table"),l=k.getNonEmptyElements(),f=k.getWhiteSpaceElements(),m=k.getTextBlockElements(),g=k.getSpecialElements(),t=0;t<e.length;t++)if((n=e[t]).parent&&!n.fixed)if(m[n.name]&&"li"===n.parent.name){for(p=n.next;p&&m[p.name];)p.name="li",p.fixed=!0,n.parent.insert(p,n.parent),p=p.next;n.unwrap(n)}else{for(o=[n],r=n.parent;r&&!k.isValidChild(r.name,n.name)&&!d[r.name];r=r.parent)o.push(r);if(r&&1<o.length){for(o.reverse(),i=a=O(o[0].clone()),c=0;c<o.length-1;c++){for(k.isValidChild(a.name,o[c].name)?(u=O(o[c].clone()),a.append(u)):u=a,s=o[c].firstChild;s&&s!==o[c+1];)h=s.next,u.append(s),s=h;a=u}db(k,l,f,i)?r.insert(n,o[0],!0):(r.insert(i,o[0],!0),r.insert(n,i)),r=o[0],(db(k,l,f,r)||fb(r,"br"))&&r.empty().remove()}else if(n.parent){if("li"===n.name){if((p=n.prev)&&("ul"===p.name||"ul"===p.name)){p.append(n);continue}if((p=n.next)&&("ul"===p.name||"ul"===p.name)){p.insert(n,p.firstChild,!0);continue}n.wrap(O(new sb("ul",1)));continue}k.isValidChild(n.parent.name,"div")&&k.isValidChild("div",n.name)?n.wrap(O(new sb("div",1))):g[n.name]?n.empty().remove():n.unwrap()}}}(m)),v&&("body"===S.name||a.isRootContent)&&function(){function r(e){e&&((n=e.firstChild)&&3===n.type&&(n.value=n.value.replace(b,"")),(n=e.lastChild)&&3===n.type&&(n.value=n.value.replace(C,"")))}var e,t,n=S.firstChild;if(k.isValidChild(S.name,v.toLowerCase())){for(;n;)e=n.next,3===n.type||1===n.type&&"p"!==n.name&&!l[n.name]&&!n.attr("data-mce-type")?(t||((t=N(v,1)).attr(T.forced_root_block_attrs),S.insert(t,n)),t.append(n)):(r(t),t=null),n=e;r(t)}}(),!a.invalid){for(c in R){for(s=_[c],i=(n=R[c]).length;i--;)n[i].parent||n.splice(i,1);for(r=0,o=s.length;r<o;r++)s[r](n,c,a)}for(r=0,o=A.length;r<o;r++)if((s=A[r]).name in D){for(i=(n=D[s.name]).length;i--;)n[i].parent||n.splice(i,1);for(i=0,u=s.callbacks.length;i<u;i++)s.callbacks[i](n,s.name,a)}}return S}};return gb(e,T),ob.register(e,T),e}function Cb(e,t,n){-1===Xt.inArray(t,n)&&(e.addAttributeFilter(n,function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}),t.push(n))}function Eb(e,r){var a,u,s,c,l,n,r=(a=e,n=["data-mce-selected"],s=(u=r)&&u.dom?u.dom:Si.DOM,c=u&&u.schema?u.schema:di(a),a.entity_encoding=a.entity_encoding||"named",a.remove_trailing_brs=!("remove_trailing_brs"in a)||a.remove_trailing_brs,l=bb(a,c),eb.register(l,a,s),{schema:c,addNodeFilter:l.addNodeFilter,addAttributeFilter:l.addAttributeFilter,serialize:function(i,n){n=Zy({format:"html"},n||{}),i=tb_process(u,i,n),i=function(r,t,n){r=wa(n.getInner?t.innerHTML:r.getOuterHTML(t));return n.selection||Ao(ar.fromDom(t))?r:Xt.trim(r)}(s,i,n),i=function(e,t,o){o=o.selection?Zy({forced_root_block:!1},o):o,o=e.parse(t,o);return eb.trimTrailingBr(o),o}(l,i,n);return"tree"===n.format?i:function(e,t,n,s,o){s=s,s=al(t,n).serialize(s);return!o.no_events&&e?wp(e,Zy(o,{content:s})).content:s}(u,a,c,i,n)},addRules:function(e){c.addValidElements(e)},setRules:function(e){c.setValidElements(e)},addTempAttr:d(Cb,l,n),getTempAttrs:function(){return n}});return{schema:r.schema,addNodeFilter:r.addNodeFilter,addAttributeFilter:r.addAttributeFilter,serialize:r.serialize,addRules:r.addRules,setRules:r.setRules,addTempAttr:r.addTempAttr,getTempAttrs:r.getTempAttrs}}function Sb(e){return{getBookmark:d(hc,e),moveToBookmark:d(vc,e)}}(Sb=Sb||{}).isBookmarkNode=yc;function Db(r,a){var u,s,c,f,d,m,g,p,h,v,y,i,b,C,x,w,N=a.dom,E=Xt.each,S=a.getDoc(),T=V.document,k=Math.abs,_=Math.round,A=a.getBody(),l={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},e=".mce-content-body";function R(e){return e&&("IMG"===e.nodeName||a.dom.is(e,"figure.image"))}function n(e){var r=e.target,t=e,n=a.selection.getRng();!R(t.target)||yv(t.clientX,t.clientY,n)||e.isDefaultPrevented()||a.selection.select(r)}function o(e){var r,o,n;I(),M(),n=N.getPos(e,A),g=n.x,p=n.y,n=e.getBoundingClientRect(),r=n.width||n.right-n.left,o=n.height||n.bottom-n.top,u!==e&&(u=e,b=C=0),n=a.fire("ObjectSelected",{target:e}),O(e)&&!n.isDefaultPrevented()?E(l,function(n,e){var t;(t=N.get("mceResizeHandle"+e))&&N.remove(t),t=N.add(A,"div",{id:"mceResizeHandle"+e,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+e+"-resize; margin:0; padding:0"}),11===fe.ie&&(t.contentEditable=!1),N.bind(t,"mousedown",function(e){e.stopImmediatePropagation(),e.preventDefault(),d=e.screenX,m=e.screenY,h=D(u).clientWidth,v=D(u).clientHeight,y=v/h,(f=n).startPos={x:r*n[0]+g,y:o*n[1]+p},x=A.scrollWidth,w=A.scrollHeight,s=u.cloneNode(!0),N.addClass(s,"mce-clonedresizable"),N.setAttrib(s,"data-mce-bogus","all"),s.contentEditable=!1,s.unSelectabe=!0,N.setStyles(s,{left:g,top:p,margin:0}),s.removeAttribute("data-mce-selected"),A.appendChild(s),N.bind(S,"mousemove",B),N.bind(S,"mouseup",P),T!==S&&(N.bind(T,"mousemove",B),N.bind(T,"mouseup",P)),c=N.add(A,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},h+" &times; "+v)}),n.elm=t,N.setStyles(t,{left:r*n[0]+g-t.offsetWidth/2,top:o*n[1]+p-t.offsetHeight/2})}):I(),u.setAttribute("data-mce-selected","1")}function L(t){function n(e,t){if(e)do{if(e===t)return 1}while(e=e.parentNode)}i||a.removed||(E(N.select("img[data-mce-selected],hr[data-mce-selected]"),function(e){e.removeAttribute("data-mce-selected")}),t="mousedown"===t.type?t.target:r.getNode(),n(t=N.$(t).closest("table,img,figure.image,hr")[0],A)&&(z(),n(r.getStart(!0),t)&&n(r.getEnd(!0),t))?o(t):I())}function F(e){return Ab(function(e,t){for(;t&&t!==e;){if(Rb(t)||Ab(t))return t;t=t.parentNode}return null}(a.getBody(),e))}function z(){try{a.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(e){}}a.contentStyles.push(e+" div.mce-resizehandle {position: absolute;border: 1px solid black;box-sizing: content-box;background: #FFF;width: 7px;height: 7px;z-index: 10000}"+e+" .mce-resizehandle:hover {background: #000}"+e+" img[data-mce-selected],"+e+" hr[data-mce-selected] {outline: 1px solid black;resize: none}"+e+" .mce-clonedresizable {position: absolute;"+(fe.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}"+e+" .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}");var D=function(e){return a.dom.is(e,"figure.image")?e.querySelector("img"):e},O=function(e){var t=a.settings.object_resizing;return!1!==t&&!fe.iOS&&("string"!=typeof t&&(t="table,img,figure.image,div"),"false"!==e.getAttribute("data-mce-resize")&&e!==a.getBody()&&Lr(ar.fromDom(e),t))},B=function(o){var r,t=o.screenX-d,n=o.screenY-m;b=t*f[2]+h,C=n*f[3]+v,b=b<5?5:b,C=C<5?5:C,(R(u)&&!1!==a.settings.resize_img_proportional?!rv.modifierPressed(o):rv.modifierPressed(o)||R(u)&&f[2]*f[3]!=0)&&(k(t)>k(n)?(C=_(b*y),b=_(C/y)):(b=_(C/y),C=_(b*y))),N.setStyles(D(s),{width:b,height:C}),r=0<(r=f.startPos.x+t)?r:0,o=0<(o=f.startPos.y+n)?o:0,N.setStyles(c,{left:r,top:o,display:"block"}),c.innerHTML=b+" &times; "+C,f[2]<0&&s.clientWidth<=b&&N.setStyle(s,"left",g+(h-b)),f[3]<0&&s.clientHeight<=C&&N.setStyle(s,"top",p+(v-C)),(t=A.scrollWidth-x)+(n=A.scrollHeight-w)!=0&&N.setStyles(c,{left:r-t,top:o-n}),i||(function(e,t,n,r){e.fire("ObjectResizeStart",{target:t,width:n,height:r})}(a,u,h,v),i=!0)},P=function(){i=!1;function e(e,t){t&&(u.style[e]||!a.schema.isValid(u.nodeName.toLowerCase(),e)?N.setStyle(D(u),e,t):N.setAttrib(D(u),e,t))}e("width",b),e("height",C),N.unbind(S,"mousemove",B),N.unbind(S,"mouseup",P),T!==S&&(N.unbind(T,"mousemove",B),N.unbind(T,"mouseup",P)),N.remove(s),N.remove(c),o(u),function(e,t,n,r){e.fire("ObjectResized",{target:t,width:n,height:r})}(a,u,b,C),N.setAttrib(u,"style",N.getAttrib(u,"style")),a.nodeChanged()},I=function(){var e,t;for(e in M(),u&&u.removeAttribute("data-mce-selected"),l)(t=N.get("mceResizeHandle"+e))&&(N.unbind(t),N.remove(t))},M=function(){for(var t in l){t=l[t];t.elm&&(N.unbind(t.elm),delete t.elm)}};return a.on("init",function(){z(),fe.ie&&11<=fe.ie&&(a.on("mousedown click",function(e){var t=e.target,n=t.nodeName;i||!/^(TABLE|IMG|HR)$/.test(n)||F(t)||(2!==e.button&&a.selection.select(t,"TABLE"===n),"mousedown"===e.type&&a.nodeChanged())}),a.dom.bind(A,"mscontrolselect",function(e){function t(e){he.setEditorTimeout(a,function(){a.selection.select(e)})}if(F(e.target))return e.preventDefault(),void t(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"===e.target.tagName&&t(e.target))}));var t=he.throttle(function(e){a.composing||L(e)});a.on("nodechange ResizeEditor ResizeWindow drop FullscreenStateChanged",t),a.on("keyup compositionend",function(e){u&&"TABLE"===u.nodeName&&t(e)}),a.on("hide blur",I),a.on("contextmenu",n)}),a.on("remove",M),{isResizable:O,showResizeRect:o,hideResizeRect:I,updateResizeRect:L,destroy:function(){u=s=null}}}function Ob(e){return jo.isContentEditableTrue(e)||jo.isContentEditableFalse(e)}function Bb(i,a,u){var r,o,s=u;if(s.caretPositionFromPoint)(o=s.caretPositionFromPoint(i,a))&&((r=u.createRange()).setStart(o.offsetNode,o.offset),r.collapse(!0));else if(u.caretRangeFromPoint)r=u.caretRangeFromPoint(i,a);else if(s.body.createTextRange){r=s.body.createTextRange();try{r.moveToPoint(i,a),r.collapse(!0)}catch(c){r=function(e,n,t){var i=t.elementFromPoint(e,n),o=t.body.createTextRange();if(i&&"HTML"!==i.tagName||(i=t.body),o.moveToElementText(i),0<(i=(i=Xt.toArray(o.getClientRects())).sort(function(e,t){return(e=Math.abs(Math.max(e.top-n,e.bottom-n)))-Math.abs(Math.max(t.top-n,t.bottom-n))})).length){n=(i[0].bottom+i[0].top)/2;try{return o.moveToPoint(e,n),o.collapse(!0),o}catch(a){}}return null}(i,a,u)}return i=r,a=u.body,u=i&&i.parentElement?i.parentElement():null,jo.isContentEditableFalse(function(e,t,n){for(;e&&e!==t;){if(n(e))return e;e=e.parentNode}return null}(u,a,Ob))?null:i}return r}function Ib(e,t){var n=(t||V.document).createDocumentFragment();return z(e,function(e){n.appendChild(e.dom())}),ar.fromDom(n)}function zb(e,n){return n=parseInt(Er(e,n),10),isNaN(n)?1:n}function Ub(e){return j(e,function(e,t){return t.cells().length>e?t.cells().length:e},0)}function jb(e,t){for(var n=e.rows(),r=0;r<n.length;r++)for(var o=n[r].cells(),i=0;i<o.length;i++)if(Mr(o[i],t))return _.some(Mb(i,r));return _.none()}function Vb(e,t,n,r,o){for(var i=[],a=e.rows(),u=n;u<=o;u++){var c=a[u].cells(),c=t<r?c.slice(t,r+1):c.slice(r,t+1);i.push(Fb(a[u].element(),c))}return i}function Hb(e){var o=Lb(ha(e),0,[]);return z(Qi(e,"tr"),function(n,r){z(Qi(n,"td,th"),function(e,t){!function(e,t,n,r,o){for(var i=zb(o,"rowspan"),a=zb(o,"colspan"),u=e.rows(),s=n;s<n+i;s++){u[s]||(u[s]=Fb(va(r),[]));for(var c=t;c<t+a;c++)u[s].cells()[c]=s===n&&c===t?o:ha(o)}}(o,function(e,t,n){for(;r=t,o=n,i=void 0,((i=e.rows())[o]?i[o].cells():[])[r];)t++;var r,o,i;return t}(o,t,r),r,n,e)})}),Lb(o.element(),Ub(o.rows()),o.rows())}function Wb(n,t){return X(n,function(n){return"li"===lr(n)&&(o=n,ru((a=(r=t).startContainer,n=r.startOffset,jo.isText(a)?0===n?_.some(ar.fromDom(a)):_.none():_.from(a.childNodes[n]).map(ar.fromDom)),(n=r.endContainer,r=r.endOffset,jo.isText(n)?r===n.data.length?_.some(ar.fromDom(n)):_.none():_.from(n.childNodes[r-1]).map(ar.fromDom)),function(n,r){n=X(Yh(o),d(Mr,n)),r=X(Gh(o),d(Mr,r));return n.isSome()&&r.isSome()}).getOr(!1));var o,r,a}).fold(q([]),function(e){return X(n,function(e){return"ul"===lr(e)||"ol"===lr(e)}).map(function(e){return[ar.fromTag("li"),ar.fromTag(lr(e))]}).getOr([])})}function Xb(){return Ib([])}function Yb(e,r){return o=ar.fromDom(r.cloneContents()),r=function(i,a){var n,u=ar.fromDom(a.commonAncestorContainer),o=uf(u,i),i=U(o,function(e){return xo(e)||bo(e)}),a=Wb(o,a),u=i.concat(a.length?a:So(n=u)?Vr(n).filter(Eo).fold(q([]),function(e){return[n,e]}):Eo(n)?[n]:[]);return W(u,ha)}(e,r),o=j(r,function(e,t){return Fi(t,e),t},o),0<r.length?Ib([o]):o;var o}function Gb(e,o){return n=o[0],ra(n,"table",d(Mr,e)).bind(function(e){var t=o[0],n=o[o.length-1];return function(l,e,t){return jb(l,e).bind(function(c){return jb(l,t).map(function(s){return t=l,u=s,o=(a=c).x(),s=a.y(),a=u.x(),s=s<(u=u.y())?Vb(t,o,s,a,u):Vb(t,o,u,a,s),Lb(t.element(),Ub(s),s);var t,o,a,u})})}(Hb(e),t,n).map(function(n){return Ib([(n=W((o=r=n).rows(),function(n){var t=W(n.cells(),function(t){t=va(t);return Sr(t,"colspan"),Sr(t,"rowspan"),t}),n=ha(n.element());return Mi(n,t),n}),r=ha(o.element()),o=ar.fromTag("tbody"),Mi(o,n),Fi(r,o),r)]);var r,o})}).getOrThunk(Xb);var n}function tC(e,t,n){return eC(e,t,!0,n,function(e,t){return Math.min(e.dom().childNodes.length,t)})}function nC(e,t,n){return eC(e,t,!1,n,function(e,t){return 0<t?t-1:t})}function rC(e,t){for(var n=e;e&&jo.isText(e)&&0===e.length;)e=t?e.nextSibling:e.previousSibling;return e||n}function iC(e){return!!e.select}function aC(e){return!(!e||!e.ownerDocument)&&zr(ar.fromDom(e.ownerDocument),ar.fromDom(e))}function uC(u,s,e,c){function r(e,t){return function(e,t,c){var o,a,u=(a=t,ma(ma({format:"html"},c),{set:!0,selection:!0,content:a})),l=e.selection.getRng(),c=e.getDoc();if(u.no_events||!(u=e.fire("BeforeSetContent",u)).isDefaultPrevented()){if(t=function(e,n){if("raw"===n.format)return n.content;n=e.parser.parse(n.content,ma({isRootContent:!0,forced_root_block:!1},n));return al({validate:e.validate},e.schema).serialize(n)}(e,u),l.insertNode){t+='<span id="__caret">_</span>',l.startContainer===c&&l.endContainer===c?c.body.innerHTML=t:(l.deleteContents(),0===c.body.childNodes.length?c.body.innerHTML=t:l.createContextualFragment?l.insertNode(l.createContextualFragment(t)):(o=c.createDocumentFragment(),a=c.createElement("div"),o.appendChild(a),a.outerHTML=t,l.insertNode(o))),o=e.dom.get("__caret"),(l=c.createRange()).setStartBefore(o),l.setEndBefore(o),e.selection.setRng(l),e.dom.remove("__caret");try{e.selection.setRng(l)}catch(f){}}else{l=l;l.item&&(c.execCommand("Delete",!1,null),l=e.selection.getRng()),/^\s+/.test(t)?(l.pasteHTML('<span id="__mce_tmp">_</span>'+t),e.dom.remove("__mce_tmp")):l.pasteHTML(t)}u.no_events||e.fire("SetContent",u)}else e.fire("SetContent",u)}(c,e,t)}function o(e){var t=m();t.collapse(!!e),i(t)}function m(){function o(e,t,n){try{return t.compareBoundaryPoints(e,n)}catch(r){return-1}}var e,t,n;if(!s)return null;if(null==(n=s.document))return null;if(void 0!==c.bookmark&&!1===sh(c)){var i=up(c);if(i.isSome())return i.map(function(e){return Pb(c,[e])[0]}).getOr(n.createRange())}try{(e=d())&&!jo.isRestrictedNode(e.anchorNode)&&(t=0<e.rangeCount?e.getRangeAt(0):(e.createRange?e:n).createRange())}catch(a){}return(t=!(t=Pb(c,[t])[0])?n.createRange?n.createRange():n.body.createTextRange():t).setStart&&9===t.startContainer.nodeType&&t.collapsed&&(n=u.getRoot(),t.setStart(n,0),t.setEnd(n,0)),l&&f&&(0===o(t.START_TO_START,t,l)&&0===o(t.END_TO_END,t,l)?t=f:f=l=null),t}function i(e,t){var r;if((n=e)&&(iC(n)||aC(n.startContainer)&&aC(n.endContainer))){var n=iC(e)?e:null;if(n){f=null;try{n.select()}catch(a){}}else{if(n=d(),e=c.fire("SetSelectionRange",{range:e,forward:t}).range,n){f=e;try{n.removeAllRanges(),n.addRange(e)}catch(a){}!1===t&&n.extend&&(n.collapse(e.endContainer,e.endOffset),n.extend(e.startContainer,e.startOffset)),l=0<n.rangeCount?n.getRangeAt(0):null}e.collapsed||e.startContainer!==e.endContainer||!n.setBaseAndExtent||fe.ie||e.endOffset-e.startOffset<2&&e.startContainer.hasChildNodes()&&(r=e.startContainer.childNodes[e.startOffset])&&"IMG"===r.tagName&&(n.setBaseAndExtent(e.startContainer,e.startOffset,e.endContainer,e.endOffset),n.anchorNode===e.startContainer&&n.focusNode===e.endContainer||n.setBaseAndExtent(r,0,r,1)),c.fire("AfterSetSelectionRange",{range:e,forward:t})}}}function g(){var e,t,n=d();return!(n&&n.anchorNode&&n.focusNode)||((e=u.createRng()).setStart(n.anchorNode,n.anchorOffset),e.collapse(!0),(t=u.createRng()).setStart(n.focusNode,n.focusOffset),t.collapse(!0),e.compareBoundaryPoints(e.START_TO_START,t)<=0)}var l,f,a,d=function(){return s.getSelection?s.getSelection():s.document.selection},p={bookmarkManager:null,controlSelection:null,dom:u,win:s,serializer:e,editor:c,collapse:o,setCursorLocation:function(e,t){var n=u.createRng();e?(n.setStart(e,t),n.setEnd(e,t),i(n),o(!1)):(Qh(u,n,c.getBody(),!0),i(n))},getContent:function(e){return function(e,t){if((t=void 0===t?{}:t).get=!0,t.format=t.format||"html",t.selection=!0,(t=e.fire("BeforeGetContent",t)).isDefaultPrevented())return e.fire("GetContent",t),t.content;if("text"===t.format)return c=e,_.from(c.selection.getRng()).map(function(n){var t=c.dom.add(c.getBody(),"div",{"data-mce-bogus":"all",style:"overflow: hidden; opacity: 0;"},n.cloneContents()),n=wa(t.innerText);return c.dom.remove(t),n}).getOr("");t.getInner=!0;var n,o,a,s,c,l=(l=t,o=(n=e).selection.getRng(),a=n.dom.create("body"),s=n.selection.getSel(),s=Pb(n,gm(s)),(o=l.contextual?Jb(ar.fromDom(n.getBody()),s).dom():o.cloneContents())&&a.appendChild(o),n.selection.serializer.serialize(a,l));return"tree"===t.format?l:(t.content=e.selection.isCollapsed()?"":l,e.fire("GetContent",t),t.content)}(c,e)},setContent:r,getBookmark:function(e,t){return n.getBookmark(e,t)},moveToBookmark:function(e){return n.moveToBookmark(e)},select:function(e,t){var r=u,o=t;return _.from(e).map(function(e){var t=r.nodeIndex(e),n=r.createRng();return n.setStart(e.parentNode,t),n.setEnd(e.parentNode,t+1),o&&(Qh(r,n,e,!0),Qh(r,n,e,!1)),n}).each(i),e},isCollapsed:function(){var e=m(),t=d();return!(!e||e.item)&&(e.compareEndPoints?0===e.compareEndPoints("StartToEnd",e):!t||e.collapsed)},isForward:g,setNode:function(e){return r(u.getOuterHTML(e)),e},getNode:function(){return e=c.getBody(),(t=m())?(r=t.startContainer,o=t.endContainer,i=t.startOffset,a=t.endOffset,n=t.commonAncestorContainer,!t.collapsed&&(r===o&&a-i<2&&r.hasChildNodes()&&(n=r.childNodes[i]),3===r.nodeType&&3===o.nodeType&&(r=r.length===i?rC(r.nextSibling,!0):r.parentNode,o=0===a?rC(o.previousSibling,!1):o.parentNode,r&&r===o))?r:n&&3===n.nodeType?n.parentNode:n):e;var e,t,n,r,o,i,a},getSel:d,setRng:i,getRng:m,getStart:function(e){return tC(c.getBody(),m(),e)},getEnd:function(e){return nC(c.getBody(),m(),e)},getSelectedBlocks:function(e,t){return function(e,t,n,r){var o,a=[],i=e.getRoot();if(n=e.getParent(n||tC(i,t,t.collapsed),e.isBlock),r=e.getParent(r||nC(i,t,t.collapsed),e.isBlock),n&&n!==i&&a.push(n),n&&r&&n!==r)for(var u=new go(n,i);(o=u.next())&&o!==r;)e.isBlock(o)&&a.push(o);return r&&n!==r&&r!==i&&a.push(r),a}(u,m(),e,t)},normalize:function(){var e=m();if(function(e){return 1<mm(e).length}(d())||!Zh(c))return e;var n=Dg(u,e);return n.each(function(e){i(e,g())}),n.getOr(e)},selectorChanged:function(e,t){var i;return a||(a={},i={},c.on("NodeChange",function(e){var n=e.element,r=u.getParents(n,null,u.getRoot()),o={};oC(a,function(e,n){oC(r,function(t){if(u.is(t,n))return i[n]||(oC(e,function(e){e(!0,{node:t,selector:n,parents:r})}),i[n]=e),o[n]=e,!1})}),oC(i,function(e,t){o[t]||(delete i[t],oC(e,function(e){e(!1,{node:n,selector:t,parents:r})}))})})),a[e]||(a[e]=[]),a[e].push(t),p},getScrollContainer:function(){for(var e,t=u.getRoot();t&&"BODY"!==t.nodeName;){if(t.scrollHeight>t.clientHeight){e=t;break}t=t.parentNode}return e},scrollIntoView:function(e,t){return function(e,t,n){var r,i,a,s=e.dom,c=s.getRoot(),l=0,u={elm:t,alignToTop:n};if(e.fire("scrollIntoView",u),!u.isDefaultPrevented()&&jo.isElement(t)){if(!1===n&&(l=t.offsetHeight),"BODY"!==c.nodeName){var o=e.selection.getScrollContainer();if(o)return r=rg(t).y-rg(o).y+l,a=o.clientHeight,void((r<(i=o.scrollTop)||i+a<r+25)&&(o.scrollTop=r<i?r:r-a+25))}o=s.getViewPort(e.getWin()),r=s.getPos(t).y+l,i=o.y,a=o.h,(r<o.y||i+a<r+25)&&e.getWin().scrollTo(0,r<i?r:r-a+25)}}(c,e,t)},placeCaretAt:function(e,t){return i(Bb(e,t,c.getDoc()))},getBoundingClientRect:function(){var e=m();return e.collapsed?_u.fromRangeStart(e).getClientRects()[0]:e.getBoundingClientRect()},destroy:function(){s=l=f=null,t.destroy()}},n=_b(p),t=Db(p,c);return p.bookmarkManager=n,p.controlSelection=t,p}var Tb,_b=Sb,Ab=jo.isContentEditableFalse,Rb=jo.isContentEditableTrue,Pb=function(n,e){return W(e,function(e){var t=n.fire("GetSelectionRange",{range:e});return t.range!==e?t.range:e})},Lb=MN("element","width","rows"),Fb=MN("element","cells"),Mb=MN("x","y"),Jb=function(n,r){var o=Cm(r,n);return 0<o.length?Gb(n,o):(n=n,0<(r=r).length&&r[0].collapsed?Xb():Yb(n,r[0]))},eC=function(e,t,n,r,o){var i=n?t.startContainer:t.endContainer,a=n?t.startOffset:t.endOffset;return _.from(i).map(ar.fromDom).map(function(e){return r&&t.collapsed?e:Xr(e,o(e,a)).getOr(e)}).bind(function(e){return dr(e)?_.some(e):Vr(e)}).map(function(e){return e.dom()}).getOr(e)},oC=Xt.each;(KN=Tb=Tb||{})[KN.Br=0]="Br",KN[KN.Block=1]="Block",KN[KN.Wrap=2]="Wrap",KN[KN.Eol=3]="Eol";function sC(e,t){return e===Tu.Backwards?t.reverse():t}function fC(e,i){return j(e,function(e,o){return e.fold(function(){return _.some(o)},function(r){return ru(Z(r.getClientRects()),Z(o.getClientRects()),function(n,t){n=Math.abs(i-n.left);return Math.abs(i-t.left)<=n?o:r}).or(e)})},_.none())}function dC(t,e){return Z(e.getClientRects()).bind(function(e){return fC(t,e.left)})}function xC(e,t,o){var r,c=Js(e.getBody()),s=d(Ls,c.next),c=d(Ls,c.prev);o.collapsed&&e.settings.forced_root_block&&(r=e.dom.getParent(o.startContainer,"PRE"))&&((1===t?s:c)(_u.fromRangeStart(o))||(o=e.dom.create(Nl(e)),(!fe.ie||11<=fe.ie)&&(o.innerHTML='<br data-mce-bogus="1">'),o=o,1===t?e.$(r).after(o):e.$(r).before(o),e.selection.select(o,!0),e.selection.collapse()))}function wC(l,f){return function(){var e,t,a,s,c=(t=f,a=Js((e=l).getBody()),c=d(Ls,a.next),s=d(Ls,a.prev),a=t?Tu.Forwards:Tu.Backwards,c=t?c:s,s=e.selection.getRng(),(c=function(e,t,l,r){var o=e===Tu.Forwards,i=o?Lf:Ff;if(!r.collapsed){var c=yC(r);if(vC(c))return sg(e,t,c,e===Tu.Backwards,!0)}var u=Sa(r.startContainer),c=Ps(e,t.getBody(),r);if(i(c))return cg(t,c.getNode(!o));c=Vl.normalizePosition(o,l(c));if(!c)return u?r:null;if(i(c))return sg(e,t,c.getNode(!o),o,!0);l=l(c);return l&&i(l)&&Fs(c,l)?sg(e,t,l.getNode(!o),o,!0):u?fg(t,c.toRange(),!0):null}(a,e,c,s))?c:(c=xC(e,a,s),null));return!!c&&(dg(l,c),!0)}}function NC(u,s){return function(){var e,r,i,a=(r=s?1:-1,a=s?uv:av,i=(e=u).selection.getRng(),(a=function(e,t,l,f){var m=yC(f),u=Ps(e,t.getBody(),f),c=l(t.getBody(),sv(1),u),f=U(c,cv(1)),l=Ht.last(u.getClientRects());if((Lf(u)||zf(u))&&(m=u.getNode()),(Ff(u)||Uf(u))&&(m=u.getNode(!0)),!l)return null;if(c=l.left,(u=pv(f,c))&&vC(u.node))return l=Math.abs(c-u.left),f=Math.abs(c-u.right),sg(e,t,u.node,l<f,!0);if(m){m=function(e,l,n,r){function m(e){return Ht.last(e.getClientRects())}var o,i,a,s,l=Js(l),f=[],d=0,u=1===e?(o=l.next,i=Ja,a=Ga,_u.after(r)):(o=l.prev,i=Ga,a=Ja,_u.before(r)),c=m(u);do{if(u.isVisible()&&!a(s=m(u),c)){if(0<f.length&&i(s,Ht.last(f))&&d++,(s=Ka(s)).position=u,s.line=d,n(s))return f;f.push(s)}}while(u=o(u));return f}(e,t.getBody(),sv(1),m);return(u=pv(U(m,cv(1)),c))?fg(t,u.position.toRange(),!0):(u=Ht.last(U(m,cv(0))))?fg(t,u.position.toRange(),!0):void 0}}(r,e,a,i))?a:(a=xC(e,r,i),null));return!!a&&(dg(u,a),!0)}}function EC(r,o){return function(){var t,n=o?_u.fromRangeEnd(r.selection.getRng()):_u.fromRangeStart(r.selection.getRng()),n=(o?gC:mC)(r.getBody(),n);return(o?ee:Z)(n.positions).filter((t=o,function(e){return(t?Ff:Lf)(e)})).fold(q(!1),function(e){return r.selection.setRng(e.toRange()),!0})}}function IC(u,s,c){var e=function(n,t){n=t.getNode(n);return jo.isElement(n)&&"TABLE"===n.nodeName?_.some(n):_.none()}(!!s,c),t=!1===s;e.fold(function(){return dg(u,c.toRange())},function(a){return sc.positionIn(t,u.getBody()).filter(function(e){return e.isEqual(c)}).fold(function(){return dg(u,c.toRange())},function(e){var r,i,n=s,o=a,t=c;(i=Nl(r=u))?r.undoManager.transact(function(){var e=ar.fromTag(i);Nr(e,El(r)),Fi(e,ar.fromTag("br")),(n?Ii:Pi)(ar.fromDom(o),e);var t=r.dom.createRng();t.setStart(e.dom(),0),t.setEnd(e.dom(),0),dg(r,t)}):dg(r,t.toRange())})})}function LC(e,t,n,r){var o,i,a,u,s,c,d=e.selection.getRng(),f=_u.fromRangeStart(d),d=e.getBody();if(t||!DC(r,f))return!(!t||!OC(r,f)||(o=d,m=function(t,n){return ee(n.getClientRects()).bind(function(e){return kC(t,e.left,e.top)}).bind(function(e){return dC(sc.firstPositionIn(t=e).map(function(e){return[e].concat(gC(t,e).positions)}).getOr([]),n);var t})}(i=n,a=f).orThunk(function(){return Z(a.getClientRects()).bind(function(e){return fC(hC(o,_u.after(i)),e.left)})}).getOr(_u.after(i)),IC(e,t,m),0));var m=(u=d,function(t,n){return Z(n.getClientRects()).bind(function(e){return TC(t,e.left,e.top)}).bind(function(e){return dC(sc.lastPositionIn(t=e).map(function(e){return mC(t,e).positions.concat(e)}).getOr([]),n);var t})}(s=n,c=f).orThunk(function(){return Z(c.getClientRects()).bind(function(e){return fC(pC(u,_u.before(s)),e.left)})}).getOr(_u.before(s)));return IC(e,t,m),!0}function FC(t,n){return function(){return _.from(t.dom.getParent(t.selection.getNode(),"td,th")).bind(function(e){return _.from(t.dom.getParent(e,"table")).map(function(e){return function(e,l,n){var o,a,u,s=e.selection.getRng(),c=l?1:-1;if(ms()&&(o=l,a=n,u=_u.fromRangeStart(s),sc.positionIn(!o,a).map(function(e){return e.isEqual(u)}).getOr(!1))){l=sg(c,e,n,!l,!0);return dg(e,l),!0}return!1}(t,n,e)})}).getOr(!1)}}function MC(n,r){return function(){return _.from(n.dom.getParent(n.selection.getNode(),"td,th")).bind(function(t){return _.from(n.dom.getParent(t,"table")).map(function(e){return LC(n,r,e,t)})}).getOr(!1)}}function zC(e){return F(["figcaption"],lr(e))}function UC(e){var t=V.document.createRange();return t.setStartBefore(e.dom()),t.setEndBefore(e.dom()),t}function jC(e,t,n){(n?Fi:Li)(e,t)}function qC(t,n){var i=ar.fromDom(t.getBody()),a=_u.fromRangeStart(t.selection.getRng()),u=Nl(t),s=El(t),e=a,o=d(Mr,i);return na(ar.fromDom(e.container()),Co,o).filter(zC).exists(function(){if(function(r,o,n){return o?(o=r.dom(),gC(o,n).breakAt.isNone()):(r=r.dom(),mC(r,n).breakAt.isNone())}(i,n,a)){var e=function(i,c,s,u){return""===c?(l=i,f=u,o=ar.fromTag("br"),jC(l,o,f),UC(o)):(o=i,i=u,u=s,s=ar.fromTag(c),c=ar.fromTag("br"),Nr(s,u),Fi(s,c),jC(o,s,i),UC(c));var l,f,o}(i,u,s,n);return t.selection.setRng(e),!0}return!1})}function $C(e,t){return function(){return!!e.selection.isCollapsed()&&qC(e,t)}}function KC(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,r)}}function XC(e,t){return X(function(e,r){return G(W(e,function(e){return Zy({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:o},e)}),function(e){return r.keyCode===e.keyCode&&r.shiftKey===e.shiftKey&&r.altKey===e.altKey&&r.ctrlKey===e.ctrlKey&&r.metaKey===e.metaKey?[e]:[]})}(e,t),function(e){return e.action()})}function JC(e){return _.from(e.dom.getParent(e.selection.getStart(!0),e.dom.isBlock))}function QC(e,t){var n,r,o,s,i=t,a=e.dom,u=e.schema.getMoveCaretBeforeOnEnterElements();if(t){if(!/^(LI|DT|DD)$/.test(t.nodeName)||(s=function(e){for(;e;){if(1===e.nodeType||3===e.nodeType&&e.data&&/[\r\n\s]/.test(e.data))return e;e=e.nextSibling}}(t.firstChild))&&/^(UL|OL|DL)$/.test(s.nodeName)&&t.insertBefore(a.doc.createTextNode("Â "),t.firstChild),o=a.createRng(),t.normalize(),t.hasChildNodes()){for(n=new go(t,t);r=n.current();){if(jo.isText(r)){o.setStart(r,0),o.setEnd(r,0);break}if(u[r.nodeName.toLowerCase()]){o.setStartBefore(r),o.setEndBefore(r);break}i=r,r=n.next()}r||(o.setStart(i,0),o.setEnd(i,0))}else jo.isBr(t)?t.nextSibling&&a.isBlock(t.nextSibling)?(o.setStartBefore(t),o.setEndBefore(t)):(o.setStartAfter(t),o.setEndAfter(t)):(o.setStart(t,0),o.setEnd(t,0));e.selection.setRng(o),a.remove(void 0),e.selection.scrollIntoView(t)}}function rx(e,t){return e&&e.parentNode&&e.parentNode.nodeName===t}function ox(e){return e&&/^(OL|UL|LI)$/.test(e.nodeName)}function ix(e){var t=e.parentNode;return/^(LI|DT|DD)$/.test(t.nodeName)?t:e}function ax(e,t,n){for(var r=e[n?"firstChild":"lastChild"];r&&!jo.isElement(r);)r=r[n?"nextSibling":"previousSibling"];return r===t}function sx(e){e.innerHTML='<br data-mce-bogus="1">'}function cx(e,t){return e.nodeName===t||e.previousSibling&&e.previousSibling.nodeName===t}function lx(e,t){return t&&e.isBlock(t)&&!/^(TD|TH|CAPTION|FORM)$/.test(t.nodeName)&&!/^(fixed|absolute)/i.test(t.style.position)&&"true"!==e.getContentEditable(t)}function fx(e,t,n){return!1===jo.isText(t)?n:e?1===n&&t.data.charAt(n-1)===xa?0:n:n===t.data.length-1&&t.data.charAt(n)===xa?t.data.length:n}function dx(e,t){for(var r,o=e.getRoot(),n=t;n!==o&&"false"!==e.getContentEditable(n);)"true"===e.getContentEditable(n)&&(r=n),n=n.parentNode;return n!==o?r:o}function gx(e,t){var n=Nl(e);n&&n.toLowerCase()===t.tagName.toLowerCase()&&function(o,i,a){_.from(a.style).map(o.dom.parseStyle).each(function(n){var t=function(){var t={},n=ar.fromDom(i).dom();if(Cr(n))for(var r=0;r<n.style.length;r++){var o=n.style.item(r);t[o]=n.style[o]}return t}(),n=ma(ma({},t),n);o.dom.setStyles(i,n)});var t=_.from(a.class).map(function(e){return e.split(/\s+/)}),n=_.from(i.className).map(function(e){return U(e.split(/\s+/),function(e){return""!==e})});ru(t,n,function(t,r){r=U(r,function(e){return!F(t,e)}),r=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r}(t,r);o.dom.setAttrib(i,"class",r.join(" "))});var r=["style","class"],a=yr(a,function(e,t){return!F(r,t)}).t;o.dom.setAttribs(i,a)}(e,t,El(e))}function px(a,p){function S(e){var t,n,o=s,i=w.getTextInlineElements(),r=t=e||"TABLE"===f||"HR"===f?x.create(e||m):c.cloneNode(!1);if(!1===a.getParam("keep_styles",!0))x.setAttrib(t,"style",null),x.setAttrib(t,"class",null);else for(;i[o.nodeName]&&(Ju(o)||yc(o)||(n=o.cloneNode(!1),x.setAttrib(n,"id",""),t.hasChildNodes()?n.appendChild(t.firstChild):r=n,t.appendChild(n))),(o=o.parentNode)&&o!==u;);return gx(a,t),sx(r),t}function k(){r=/^(H[1-6]|PRE|FIGURE)$/.test(f)&&"HGROUP"!==d?S(m):S(),a.getParam("end_container_on_empty_block",!1)&&lx(x,l)&&x.isEmpty(c)?r=x.split(l,c):x.insertAfter(r,c),QC(a,r)}var u,s,i,c,r,l,f,d,m,g,v,x=a.dom,w=a.schema,N=w.getNonEmptyElements(),E=a.selection.getRng(),h=function(e){var t,n,r,o=fx(e,s,i);if(jo.isText(s)&&(e?0<o:o<s.nodeValue.length))return!1;if(s.parentNode===c&&g&&!e)return!0;if(e&&jo.isElement(s)&&s===c.firstChild)return!0;if(cx(s,"TABLE")||cx(s,"HR"))return g&&!e||!g&&e;for(t=new go(s,c),jo.isText(s)&&(e&&0===o?t.prev():e||o!==s.nodeValue.length||t.next());n=t.current();){if(jo.isElement(n)){if(!n.getAttribute("data-mce-bogus")&&(r=n.nodeName.toLowerCase(),N[r]&&"br"!==r))return!1}else if(jo.isText(n)&&!/^[ \t\r\n]*$/.test(n.nodeValue))return!1;e?t.prev():t.next()}return!0};Dg(x,E).each(function(e){E.setStart(e.startContainer,e.startOffset),E.setEnd(e.endContainer,e.endOffset)}),s=E.startContainer,i=E.startOffset,m=Nl(a),v=p.shiftKey,jo.isElement(s)&&s.hasChildNodes()&&(g=i>s.childNodes.length-1,s=s.childNodes[Math.min(i,s.childNodes.length-1)]||s,i=g&&jo.isText(s)?s.nodeValue.length:0),(u=dx(x,s))&&((m&&!v||!m&&v)&&(s=function(e,g,n,r,o){var i,a,u,s,c,l,d=g||"P",m=e.dom,g=dx(m,r);if(!(a=m.getParent(r,m.isBlock))||!lx(m,a)){if(l=((a=a||g)===e.getBody()||(l=a)&&/^(TD|TH|CAPTION)$/.test(l.nodeName)?a:a.parentNode).nodeName.toLowerCase(),!a.hasChildNodes())return i=m.create(d),gx(e,i),a.appendChild(i),n.setStart(i,0),n.setEnd(i,0),i;for(s=r;s.parentNode!==a;)s=s.parentNode;for(;s&&!m.isBlock(s);)s=(u=s).previousSibling;if(u&&e.schema.isValidChild(l,d.toLowerCase())){for(i=m.create(d),gx(e,i),u.parentNode.insertBefore(i,u),s=u;s&&!m.isBlock(s);)c=s.nextSibling,i.appendChild(s),s=c;n.setStart(r,o),n.setEnd(r,o)}}return r}(a,m,E,s,i)),c=x.getParent(s,x.isBlock),l=c?x.getParent(c.parentNode,x.isBlock):null,f=c?c.nodeName.toUpperCase():"","LI"!==(d=l?l.nodeName.toUpperCase():"")||p.ctrlKey||(l=(c=l).parentNode,f=d),/^(LI|DT|DD)$/.test(f)&&x.isEmpty(c)?function(e,l,n,r,o){var u,i=e.dom,d=e.selection.getRng();n!==e.getBody()&&(l=(o=ox(u=n)&&ox(u.parentNode)?"LI":o)?l(o):i.create("BR"),ax(n,r,!0)&&ax(n,r,!1)?rx(n,"LI")?i.insertAfter(l,ix(n)):i.replace(l,n):ax(n,r,!0)?rx(n,"LI")?(i.insertAfter(l,ix(n)),l.appendChild(i.doc.createTextNode(" ")),l.appendChild(n)):n.parentNode.insertBefore(l,n):ax(n,r,!1)?i.insertAfter(l,ix(n)):(n=ix(n),(d=d.cloneRange()).setStartAfter(r),d.setEndAfter(n),d=d.extractContents(),"LI"===o&&(d.firstChild&&"LI"===d.firstChild.nodeName)?(l=d.firstChild,i.insertAfter(d,n)):(i.insertAfter(d,n),i.insertAfter(l,n))),i.remove(r),QC(e,l))}(a,S,l,c,m):m&&c===a.getBody()||(m=m||"P",Sa(c)?(r=Pa(c),x.isEmpty(c)&&sx(c),gx(a,r),QC(a,r)):h()?k():h(!0)?(r=c.parentNode.insertBefore(S(),c),QC(a,cx(c,"HR")?r:c)):((p=(v=E).cloneRange()).setStart(v.startContainer,fx(!0,v.startContainer,v.startOffset)),p.setEnd(v.endContainer,fx(!1,v.endContainer,v.endOffset)),(h=p.cloneRange()).setEndAfter(c),v=h.extractContents(),z(Ji(ar.fromDom(v),mr),function(t){t=t.dom();t.nodeValue=wa(t.nodeValue)}),function(e){for(;jo.isText(e)&&(e.nodeValue=e.nodeValue.replace(/^[\r\n]+/,"")),e=e.firstChild;);}(v),r=v.firstChild,x.insertAfter(v,c),function(e,t,n){var r,u,o=n,i=[];if(o){for(;o=o.firstChild;){if(e.isBlock(o))return;jo.isElement(o)&&!t[o.nodeName.toLowerCase()]&&i.push(o)}for(r=i.length;r--;)!(o=i[r]).hasChildNodes()||o.firstChild===o.lastChild&&""===o.firstChild.nodeValue?e.remove(o):(u=o)&&"A"===u.nodeName&&e.isEmpty(u)&&e.remove(o)}}(x,N,r),p=x,(h=c).normalize(),(v=h.lastChild)&&!/^(left|right)$/gi.test(p.getStyle(v,"float",!0))||p.add(h,"br"),x.isEmpty(c)&&sx(c),r.normalize(),x.isEmpty(r)?(x.remove(r),k()):(gx(a,r),QC(a,r))),x.setAttrib(r,"id",""),a.fire("NewBlock",{newBlock:r})))}function hx(e,t){return ex(e).filter(function(e){return 0<t.length&&Lr(ar.fromDom(e),t)}).isSome()}function Cx(e,argument_1){return hx(e,e.getParam("no_newline_selector",""))}function xx(n){return function(e,t){return""===Nl(e)===n}}function wx(n){return function(e,t){return function(e){return JC(e).filter(function(e){return So(ar.fromDom(e))}).isSome()}(e)===n}}function Nx(n,r){return function(e,t){return function(e){return JC(e).fold(q(""),function(e){return e.nodeName.toUpperCase()})}(e)===n.toUpperCase()===r}}function Ex(e){return Nx("pre",e)}function Sx(n){return function(e,t){return e.getParam("br_in_pre",!0)===n}}function Tx(e,argument_1){return hx(e,e.getParam("br_newline_selector",".mce-toc h2,figcaption,caption"))}function kx(e,t){return t}function _x(e){var t=Nl(e),n=function(e,t){for(var r,o=e.getRoot(),n=t;n!==o&&"false"!==e.getContentEditable(n);)"true"===e.getContentEditable(n)&&(r=n),n=n.parentNode;return n!==o?r:o}(e.dom,e.selection.getStart());return n&&e.schema.isValidChild(n.nodeName,t||"P")}function Ax(e,t){return function(n,r){return j(e,function(e,t){return e&&t(n,r)},!0)?_.some(t):_.none()}}function Dx(e,t){!function(e,t){return yd([Ax([Cx],bx.none()),Ax([Nx("summary",!0)],bx.br()),Ax([Ex(!0),Sx(!1),kx],bx.br()),Ax([Ex(!0),Sx(!1)],bx.block()),Ax([Ex(!0),Sx(!0),kx],bx.block()),Ax([Ex(!0),Sx(!0)],bx.br()),Ax([wx(!0),kx],bx.br()),Ax([wx(!0)],bx.block()),Ax([xx(!0),kx,_x],bx.block()),Ax([xx(!0)],bx.br()),Ax([Tx],bx.br()),Ax([xx(!1),kx],bx.br()),Ax([_x],bx.block())],[e,t.shiftKey]).getOr(bx.none())}(e,t).fold(function(){jg(e,t)},function(){px(e,t)},o)}function Lx(e,t,n){return sc.navigateIgnore(e,t,n,Pf)}function Fx(e,t){return X(uf(ar.fromDom(t.container()),e),Co)}function qx(e){return Su.isTextPosition(e)&&!e.isAtStart()&&!e.isAtEnd()}function $x(e,n){return n=U(uf(ar.fromDom(n.container()),e),Co),Z(n).getOr(e)}function Wx(e,t){return qx(t)?Bf(t):Bf(t)||sc.prevPosition($x(e,t).dom(),t).exists(Bf)}function Kx(e,t){return qx(t)?Of(t):Of(t)||sc.nextPosition($x(e,t).dom(),t).exists(Of)}function Xx(e){return Is(e).bind(function(e){return na(e,dr)}).exists(function(t){return t=kr(t,"white-space"),F(["pre","pre-wrap"],t)})}function Jx(e,t){return n=e,!Xx(r=t)&&(Ux(n,r)||Vx(n,r)||Sf(n,r)||Wx(n,r))||function(e,o){var r,i=(r=(i=o).container(),o=i.offset(),jo.isText(r)&&o<r.data.length?Su(r,o+1):i);return!Xx(i)&&(jx(e,i)||Hx(e,i)||Ef(e,i)||Kx(e,i))}(e,t);var n,r}function Qx(e,t){return _f(e.charAt(t))}function Zx(t){return t=t.container(),jo.isText(t)&&Yn(t.data,"Â ")}function tw(l,e){return _.some(e).filter(Zx).bind(function(e){var n,o=e.container(),i=l,r=(n=o).data,t=Su(n,0);return(Qx(r,0)&&!Jx(i,t)?(n.data=" "+r.slice(1),1):function(e){var n,t=e.data,r=(n=t.split(""),W(n,function(e,t){return _f(e)&&0<t&&t<n.length-1&&Rf(n[t-1])&&Rf(n[t+1])?" ":e}).join(""));return r!==t&&(e.data=r,!0)}(o))||(t=l,r=(n=o).data,o=Su(n,r.length-1),Qx(r,r.length-1)&&!Jx(t,o)&&(n.data=r.slice(0,-1)+" ",1))?_.some(e):_.none()})}function nw(t){var e=ar.fromDom(t.getBody());t.selection.isCollapsed()&&tw(e,Su.fromRangeStart(t.selection.getRng())).each(function(e){t.selection.setRng(e.toRange())})}function rw(r,o){return function(n){return t=r,(!Xx(n=n)&&(function(e,t){return r=t,sc.prevPosition(e.dom(),r).isNone()||(r=t,sc.nextPosition(e.dom(),r).isNone())||Ux(e,t)||jx(e,t)||Sf(e,t)||Ef(e,t);var r}(t,n)||Wx(t,n)||Kx(t,n))?Px:Ix)(o);var t}}function ow(e){var t,n,r=_u.fromRangeStart(e.selection.getRng()),o=ar.fromDom(e.getBody());if(e.selection.isCollapsed()){var i=d(Vl.isInlineTarget,e),a=_u.fromRangeStart(e.selection.getRng());return Ld(i,e.getBody(),a).bind((n=o,function(e){return e.fold(function(e){return sc.prevPosition(n.dom(),_u.before(e))},function(e){return sc.firstPositionIn(e)},function(e){return sc.lastPositionIn(e)},function(e){return sc.nextPosition(n.dom(),_u.after(e))})})).bind(rw(o,r)).exists((t=e,function(e){return t.selection.setRng(e.toRange()),t.nodeChanged(),!0}))}return!1}function aw(e,t){t.hasAttribute("data-mce-caret")&&(Pa(t),e.selection.setRng(e.selection.getRng()),e.selection.scrollIntoView(t))}function uw(e,t){var r=oa(ar.fromDom(e.getBody()),"*[data-mce-caret]").fold(q(null),function(e){return e.dom()});if(r)return"compositionstart"===t.type?(t.preventDefault(),t.stopPropagation(),void aw(e,r)):void(_a(r)&&(aw(e,r),e.undoManager.add()))}function dw(e){var r,o,i,a,t=Xd.setupSelectedState(e);(function(e){e.on("keyup compositionstart",d(uw,e))})(e),a=t,(i=e).on("keydown",function(o){var t,n,r;!1===o.isDefaultPrevented()&&(t=i,n=a,r=o,o=or.detect().os,XC([{keyCode:rv.RIGHT,action:wC(t,!0)},{keyCode:rv.LEFT,action:wC(t,!1)},{keyCode:rv.UP,action:NC(t,!1)},{keyCode:rv.DOWN,action:NC(t,!0)},{keyCode:rv.RIGHT,action:FC(t,!0)},{keyCode:rv.LEFT,action:FC(t,!1)},{keyCode:rv.UP,action:MC(t,!1)},{keyCode:rv.DOWN,action:MC(t,!0)},{keyCode:rv.RIGHT,action:Xd.move(t,n,!0)},{keyCode:rv.LEFT,action:Xd.move(t,n,!1)},{keyCode:rv.RIGHT,ctrlKey:!o.isOSX(),altKey:o.isOSX(),action:Xd.moveNextWord(t,n)},{keyCode:rv.LEFT,ctrlKey:!o.isOSX(),altKey:o.isOSX(),action:Xd.movePrevWord(t,n)},{keyCode:rv.UP,action:$C(t,!1)},{keyCode:rv.DOWN,action:$C(t,!0)}],r).each(function(e){r.preventDefault()}))}),function(o,i){o.on("keydown",function(t){var n,r;!1===t.isDefaultPrevented()&&(n=i,r=t,XC([{keyCode:rv.BACKSPACE,action:KC(ad,t=o,!1)},{keyCode:rv.DELETE,action:KC(ad,t,!0)},{keyCode:rv.BACKSPACE,action:KC(gg,t,!1)},{keyCode:rv.DELETE,action:KC(gg,t,!0)},{keyCode:rv.BACKSPACE,action:KC(Qd,t,n,!1)},{keyCode:rv.DELETE,action:KC(Qd,t,n,!0)},{keyCode:rv.BACKSPACE,action:KC(Dm,t,!1)},{keyCode:rv.DELETE,action:KC(Dm,t,!0)},{keyCode:rv.BACKSPACE,action:KC(Cf,t,!1)},{keyCode:rv.DELETE,action:KC(Cf,t,!0)},{keyCode:rv.BACKSPACE,action:KC(hf,t,!1)},{keyCode:rv.DELETE,action:KC(hf,t,!0)},{keyCode:rv.BACKSPACE,action:KC(ng,t,!1)},{keyCode:rv.DELETE,action:KC(ng,t,!0)}],r).each(function(e){r.preventDefault()}))}),o.on("keyup",function(t){var n;!1===t.isDefaultPrevented()&&(n=t,XC([{keyCode:rv.BACKSPACE,action:KC(ud,t=o)},{keyCode:rv.DELETE,action:KC(ud,t)}],n))})}(e,t),(o=e).on("keydown",function(r){var t,n;r.keyCode===rv.ENTER&&(t=o,(n=r).isDefaultPrevented()||(n.preventDefault(),(r=t.undoManager).typing&&(r.typing=!1,r.add()),t.undoManager.transact(function(){!1===t.selection.isCollapsed()&&t.execCommand("Delete"),Dx(t,n)})))}),(r=e).on("keydown",function(e){var n;!1===e.isDefaultPrevented()&&(n=e,XC([{keyCode:rv.SPACEBAR,action:KC(ow,r)}],n).each(function(e){n.preventDefault()}))}),function(t){var e=t,n=Vi(function(){e.composing||nw(e)},0);cw.isIE()&&(e.on("keypress",function(e){n.throttle()}),e.on("remove",function(e){n.cancel()})),t.on("input",function(e){!1===e.isComposing&&nw(t)})}(e),function(r){r.on("keydown",function(e){var n;!1===e.isDefaultPrevented()&&(n=e,XC([{keyCode:rv.END,action:EC(r,!0)},{keyCode:rv.HOME,action:EC(r,!1)}],n).each(function(e){n.preventDefault()}))})}(e)}var jN=function(e,t,n,r){for(var o,a,l=Js(n),f=r,d=[];f&&(a=l,m=f,o=t===Tu.Forwards?a.next(m):a.prev(m));){if(jo.isBr(o.getNode(!1)))return t===Tu.Forwards?{positions:sC(t,d).concat([o]),breakType:Tb.Br,breakAt:_.some(o)}:{positions:sC(t,d),breakType:Tb.Br,breakAt:_.some(o)};if(o.isVisible()){if(e(f,o)){var m=(a=f,m=o,jo.isBr(m.getNode(t===Tu.Forwards))?Tb.Br:!1===Ts(a,m)?Tb.Block:Tb.Wrap);return{positions:sC(t,d),breakType:m,breakAt:_.some(o)}}d.push(o),f=o}else f=o}return{positions:sC(t,d),breakType:Tb.Eol,breakAt:_.none()}},oE=function(n,r,o,e){return r(o,e).breakAt.map(function(e){var t=r(o,e).positions;return n===Tu.Backwards?t.concat(e):[e].concat(t)}).getOr([])},mC=d(jN,Su.isAbove,-1),gC=d(jN,Su.isBelow,1),pC=d(oE,-1,mC),hC=d(oE,1,gC),vC=jo.isContentEditableFalse,yC=Za,QN=function(e,t,l,r,o){var i,l=Qi(ar.fromDom(l),"td,th,caption").map(function(e){return e.dom()}),l=U((i=e,G(l,function(e){var t,r={left:(t=Ka(e.getBoundingClientRect())).left-(r=-1),top:t.top-r,right:t.right+-2,bottom:t.bottom+-2,width:t.width+r,height:t.height+r};return[{x:r.left,y:i(r),cell:e},{x:r.right,y:i(r),cell:e}]})),function(e){return t(e,o)}),u=r,s=o;return j(l,function(e,r){return e.fold(function(){return _.some(r)},function(e){var t=Math.sqrt(Math.abs(e.x-u)+Math.abs(e.y-s)),n=Math.sqrt(Math.abs(r.x-u)+Math.abs(r.y-s));return _.some(n<t?r:e)})},_.none()).map(function(e){return e.cell})},TC=d(QN,function(e){return e.bottom},function(e,t){return e.y<t}),kC=d(QN,function(e){return e.top},function(e,t){return e.y>t}),RN=function(e,t,n){var r,o,u=e(t,n);return u.breakType===Tb.Wrap&&0===u.positions.length||!jo.isBr(n.getNode())&&u.breakType===Tb.Br&&1===u.positions.length?(r=e,o=t,!u.breakAt.map(function(e){return r(o,e).breakAt.isSome()}).getOr(!1)):u.breakAt.isNone()},DC=d(RN,mC),OC=d(RN,gC),ex=JC,bx=LN([{br:[]},{block:[]},{none:[]}]),MN=function(n,r){var e=r.container(),t=r.offset();return jo.isText(e)?(e.insertData(t,n),_.some(Su(e,t+n.length))):Is(r).map(function(e){var t=ar.fromText(n);return(r.isAtEnd()?Ii:Pi)(e,t),Su(t.dom(),n.length)})},Px=d(MN,"Â "),Ix=d(MN," "),KN=function(e,n,r){return Lx(e,n.dom(),r).forall(function(t){return Fx(n,r).fold(function(){return!1===Ts(t,r,n.dom())},function(e){return!1===Ts(t,r,n.dom())&&zr(e,ar.fromDom(t.container()))})})},jN=function(t,n,r){return Fx(n,r).fold(function(){return Lx(t,n.dom(),r).forall(function(e){return!1===Ts(e,r,n.dom())})},function(e){return Lx(t,e.dom(),r).isNone()})},Ux=d(jN,!1),jx=d(jN,!0),Vx=d(KN,!1),Hx=d(KN,!0),cw=or.detect().browser;function gw(e){return jo.isElement(e)&&No(ar.fromDom(e))}function pw(t){t.on("click",function(e){3<=e.detail&&function(e){var o,t=e.selection.getRng(),n=Su.fromRangeStart(t),r=Su.fromRangeEnd(t);Su.isElementPosition(n)&&(o=n.container(),gw(o)&&sc.firstPositionIn(o).each(function(e){return t.setStart(e.container(),e.offset())})),Su.isElementPosition(r)&&(o=n.container(),gw(o)&&sc.lastPositionIn(o).each(function(e){return t.setEnd(e.container(),e.offset())})),e.selection.setRng(cl(t))}(t)})}function yw(e){var t;e.bindPendingEventDelegates(),e.initialized=!0,e.fire("init"),e.focus(!0),e.nodeChanged({initial:!0}),e.execCallback("init_instance_callback",e),(t=e).settings.auto_focus&&he.setEditorTimeout(t,function(){var e;(e=!0===t.settings.auto_focus?t:t.editorManager.get(t.settings.auto_focus)).destroyed||e.focus()},100)}function bw(t,l){var r,u,f=t.settings,s=t.getElement(),c=t.getDoc();f.inline||(t.getElement().style.visibility=t.orgVisibility),l||f.content_editable||(c.open(),c.write(t.iframeHTML),c.close()),f.content_editable&&(t.on("remove",function(){var e=this.getBody();vw.removeClass(e,"mce-content-body"),vw.removeClass(e,"mce-edit-focus"),vw.setAttrib(e,"contentEditable",null)}),vw.addClass(s,"mce-content-body"),t.contentDocument=c=f.content_document||V.document,t.contentWindow=f.content_window||V.window,t.bodyElement=s,f.content_document=f.content_window=null,f.root_name=s.nodeName.toLowerCase()),(l=t.getBody()).disabled=!0,t.readonly=f.readonly,t.readonly||(t.inline&&"static"===vw.getStyle(l,"position",!0)&&(l.style.position="relative"),l.contentEditable=t.getParam("content_editable_state",!0)),l.disabled=!1,t.editorUpload=qh(t),t.schema=di(f),t.dom=Si(c,{keep_values:!0,url_converter:t.convertURL,url_converter_scope:t,hex_colors:f.force_hex_style_colors,class_filter:f.class_filter,update_styles:!0,root_element:t.inline?t.getBody():null,collect:f.content_editable,schema:t.schema,contentCssCors:t.getParam("content_css_cors",!1,"boolean"),onSetAttrib:function(e){t.fire("SetAttrib",e)}}),t.parser=((s=bb((u=t).settings,u.schema)).addAttributeFilter("src,href,style,tabindex",function(e,t){for(var n,r,o,i=e.length,a=u.dom;i--;)if(r=(n=e[i]).attr(t),!n.attributes.map[o="data-mce-"+t]){if(0===r.indexOf("data:")||0===r.indexOf("blob:"))continue;"style"===t?((r=a.serializeStyle(a.parseStyle(r),n.name)).length||(r=null),n.attr(o,r),n.attr(t,r)):"tabindex"===t?(n.attr(o,r),n.attr(t,null)):n.attr(o,u.convertURL(r,t,n.name))}}),s.addNodeFilter("script",function(e){for(var t,n,r=e.length;r--;)0!==(n=(t=e[r]).attr("type")||"no/type").indexOf("mce-")&&t.attr("type","mce-"+n)}),s.addNodeFilter("#cdata",function(e){for(var t,n=e.length;n--;)(t=e[n]).type=8,t.name="#comment",t.value="[CDATA["+t.value+"]]"}),s.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(e){for(var t,n=e.length,r=u.schema.getNonEmptyElements();n--;)(t=e[n]).isEmpty(r)&&0===t.getAll("br").length&&(t.append(new sb("br",1)).shortEnded=!0)}),s),t.serializer=Eb(f,t),t.selection=uC(t.dom,t.getWin(),t.serializer,t),t.annotator=Hc(t),t.formatter=Gy(t),t.undoManager=ry(t),t._nodeChangeDispatcher=new ev(t),t._selectionOverrides=Bv(t),function(n){var t;(t=n).on("click",function(e){t.dom.getParent(e.target,"details")&&e.preventDefault()}),(n=n).parser.addNodeFilter("details",function(e){z(e,function(e){e.attr("data-mce-open",e.attr("open")),e.attr("open","open")})}),n.serializer.addNodeFilter("details",function(e){z(e,function(e){var t=e.attr("data-mce-open");e.attr("open",S(t)?t:null),e.attr("data-mce-open",null)})})}(t),pw(t),dw(t),Xh(t),t.fire("PreInit"),f.browser_spellcheck||f.gecko_spellcheck||(c.body.spellcheck=!1,vw.setAttrib(l,"spellcheck","false")),t.quirks=function(u){function h(e,t){try{u.getDoc().execCommand(e,!1,t)}catch(n){}}function v(e){return e.isDefaultPrevented()}function y(){u.shortcuts.add("meta+a",null,"SelectAll")}function b(){u.on("keydown",function(e){if(!v(e)&&e.keyCode===c&&d.isCollapsed()&&0===d.getRng().startOffset){var t=d.getNode().previousSibling;if(t&&t.nodeName&&"table"===t.nodeName.toLowerCase())return e.preventDefault(),!1}})}var s,n,r,o=Xt.each,c=rv.BACKSPACE,l=rv.DELETE,f=u.dom,d=u.selection,e=u.settings,t=u.parser,i=fe.gecko,C=fe.ie,m=fe.webkit,g="data:text/mce-internal,",p=C?"Text":"URL",C=function(){u.inline||(u.contentStyles.push("body {min-height: 150px}"),u.on("click",function(t){"HTML"===t.target.nodeName&&(11<fe.ie?u.getBody().focus():(t=u.selection.getRng(),u.getBody().focus(),u.selection.setRng(t),u.selection.normalize(),u.nodeChanged()))}))};return u.on("keydown",function(r){var t,n,o,i;if(!v(r)&&r.keyCode===rv.BACKSPACE&&(n=(t=d.getRng()).startContainer,r=t.startOffset,o=f.getRoot(),i=n,t.collapsed&&0===r)){for(;i&&i.parentNode&&i.parentNode.firstChild===i&&i.parentNode!==o;)i=i.parentNode;"BLOCKQUOTE"===i.tagName&&(u.formatter.toggle("blockquote",null,i),(t=f.createRng()).setStart(n,0),t.setEnd(n,0),d.setRng(t))}}),s=function(n){var t=f.create("body"),n=n.cloneContents();return t.appendChild(n),d.serializer.serialize(t,{format:"html"})},u.on("keydown",function(e){var n,o,i=e.keyCode;v(e)||i!==l&&i!==c||(o=u.selection.isCollapsed(),n=u.getBody(),o&&!f.isEmpty(n)||!o&&(i=u.selection.getRng(),o=s(i),(i=f.createRng()).selectNode(u.getBody()),o!==s(i))||(e.preventDefault(),u.setContent(""),n.firstChild&&f.isBlock(n.firstChild)?u.selection.setCursorLocation(n.firstChild,0):u.selection.setCursorLocation(n,0),u.nodeChanged()))}),fe.windowsPhone||u.on("keyup focusin mouseup",function(e){rv.modifierPressed(e)||d.normalize()},!0),m&&(u.settings.content_editable||f.bind(u.getDoc(),"mousedown mouseup",function(e){var t;e.target===u.getDoc().documentElement&&(t=d.getRng(),u.getBody().focus(),"mousedown"===e.type?ka(t.startContainer)||d.placeCaretAt(e.clientX,e.clientY):d.setRng(t))}),u.on("click",function(e){var t=e.target;/^(IMG|HR)$/.test(t.nodeName)&&"false"!==f.getContentEditableParent(t)&&(e.preventDefault(),u.selection.select(t),u.nodeChanged()),"A"===t.nodeName&&f.hasClass(t,"mce-item-anchor")&&(e.preventDefault(),d.select(t))}),e.forced_root_block&&u.on("init",function(){h("DefaultParagraphSeparator",e.forced_root_block)}),u.on("init",function(){u.dom.bind(u.getBody(),"submit",function(e){e.preventDefault()})}),b(),t.addNodeFilter("br",function(e){for(var t=e.length;t--;)"Apple-interchange-newline"===e[t].attr("class")&&e[t].remove()}),fe.iOS?(u.inline||u.on("keydown",function(){V.document.activeElement===V.document.body&&u.getWin().focus()}),C(),u.on("click",function(e){var t=e.target;do{if("A"===t.tagName)return void e.preventDefault()}while(t=t.parentNode)}),u.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")):y()),11<=fe.ie&&(C(),b()),fe.ie&&(y(),h("AutoUrlDetect",!1),u.on("dragstart",function(r){var t;(t=r).dataTransfer&&(u.selection.isCollapsed()&&"IMG"===t.target.tagName&&d.select(t.target),0<(r=u.selection.getContent()).length&&(r=g+escape(u.id)+","+escape(r),t.dataTransfer.setData(p,r)))}),u.on("drop",function(n){var r;v(n)||(r=n.dataTransfer&&(r=n.dataTransfer.getData(p))&&0<=r.indexOf(g)?(r=r.substr(g.length).split(","),{id:unescape(r[0]),html:unescape(r[1])}):null)&&r.id!==u.id&&(n.preventDefault(),n=Bb(n.x,n.y,u.getDoc()),d.setRng(n),r=r.html,u.queryCommandSupported("mceInsertClipboardContent")?u.execCommand("mceInsertClipboardContent",!1,{content:r,internal:!0}):u.execCommand("mceInsertContent",!1,r))})),i&&(u.on("keydown",function(e){if(!v(e)&&e.keyCode===c&&u.getBody().getElementsByTagName("hr").length&&d.isCollapsed()&&0===d.getRng().startOffset){var t=d.getNode(),n=t.previousSibling;if("HR"===t.nodeName)return f.remove(t),void e.preventDefault();n&&n.nodeName&&"hr"===n.nodeName.toLowerCase()&&(f.remove(n),e.preventDefault())}}),V.Range.prototype.getClientRects||u.on("mousedown",function(e){var t;v(e)||"HTML"!==e.target.nodeName||((t=u.getBody()).blur(),he.setEditorTimeout(u,function(){t.focus()}))}),n=function(){var e=f.getAttribs(d.getStart().cloneNode(!1));return function(){var t=d.getStart();t!==u.getBody()&&(f.setAttrib(t,"style",null),o(e,function(e){t.setAttributeNode(e.cloneNode(!0))}))}},r=function(){return!d.isCollapsed()&&f.getParent(d.getStart(),f.isBlock)!==f.getParent(d.getEnd(),f.isBlock)},u.on("keypress",function(e){var t;if(!v(e)&&(8===e.keyCode||46===e.keyCode)&&r())return t=n(),u.getDoc().execCommand("delete",!1,null),t(),e.preventDefault(),!1}),f.bind(u.getDoc(),"cut",function(e){var t;!v(e)&&r()&&(t=n(),he.setEditorTimeout(u,function(){t()}))}),e.readonly||u.on("BeforeExecCommand MouseDown",function(){h("StyleWithCSS",!1),h("enableInlineTableEditing",!1),e.object_resizing||h("enableObjectResizing",!1)}),u.on("SetContent ExecCommand",function(e){"setcontent"!==e.type&&"mceInsertLink"!==e.command||o(f.select("a"),function(e){var t=e.parentNode,n=f.getRoot();if(t.lastChild===e){for(;t&&!f.isBlock(t);){if(t.parentNode.lastChild!==t||t===n)return;t=t.parentNode}f.add(t,"br",{"data-mce-bogus":1})}})}),u.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"),fe.mac&&u.on("keydown",function(e){!rv.metaKeyPressed(e)||e.shiftKey||37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),u.selection.getSel().modify("move",37===e.keyCode?"backward":"forward","lineboundary"))}),b()),{refreshContentEditable:function(){},isHidden:function(){var e;return!i||u.removed?0:!(e=u.selection.getSel())||!e.rangeCount||0===e.rangeCount}}}(t),t.fire("PostRender"),f.directionality&&(l.dir=f.directionality),f.nowrap&&(l.style.whiteSpace="nowrap"),f.protect&&t.on("BeforeSetContent",function(t){Xt.each(f.protect,function(e){t.content=t.content.replace(e,function(e){return"\x3c!--mce:protected "+escape(e)+"--\x3e"})})}),t.on("SetContent",function(){t.addVisual(t.getBody())}),t.load({initial:!0,format:"html"}),t.startContent=t.getContent({format:"raw"}),t.on("compositionstart compositionend",function(e){t.composing="compositionstart"===e.type}),0<t.contentStyles.length&&(r="",Xt.each(t.contentStyles,function(e){r+=e+"\r\n"}),t.dom.addStyle(r)),(t.inline?vw:t.dom).styleSheetLoader.loadAll(t.contentCSS,function(e){yw(t)},function(e){yw(t)}),f.content_style&&(s=f.content_style,c=ar.fromDom(t.getDoc().head),l=ar.fromTag("style"),wr(l,"type","text/css"),Fi(l,ar.fromText(s)),Fi(c,l))}function xw(e,t){var m=e.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),l=(f=e.id,g=m,d=t.height,p=e.getParam("iframe_attrs",{}),m=ar.fromTag("iframe"),Nr(m,p),Nr(m,{id:f+"_ifr",frameBorder:"0",allowTransparency:"true",title:g}),function(e,t){var n=e.dom();hr(t,function(e,t){!function(e,t,n){if(!S(n))throw V.console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);Cr(e)&&e.style.setProperty(t,n)}(n,t,e)})}(m,{width:"100%",height:("number"==typeof d?d+"px":d)||"",display:"block"}),m.dom());l.onload=function(){l.onload=null,e.fire("load")};var f,d,g,p=function(e,t){if(V.document.domain!==V.window.location.hostname&&fe.ie&&fe.ie<12){var r=Hh_uuid("mce");e[r]=function(){bw(e)};r='javascript:(function(){document.open();document.domain="'+V.document.domain+'";var ed = window.parent.tinymce.get("'+e.id+'");document.write(ed.iframeHTML);document.close();ed.'+r+"(true);})()";return Cw.setAttrib(t,"src",r),!0}return!1}(e,l);return e.contentAreaContainer=t.iframeContainer,e.iframeElement=l,e.iframeHTML=(g=(f=e).getParam("doctype","<!DOCTYPE html>")+"<html><head>",f.getParam("document_base_url","")!==f.documentBaseUrl&&(g+='<base href="'+f.documentBaseURI.getURI()+'" />'),g+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',d=function(e){return pl(e,"body_id","tinymce")}(f),m=function(e){return pl(e,"body_class","")}(f),xl(f)&&(g+='<meta http-equiv="Content-Security-Policy" content="'+xl(f)+'" />'),g+='</head><body id="'+d+'" class="mce-content-body '+m+'" data-id="'+f.id+'"><br></body></html>'),Cw.add(t.iframeContainer,l),p}function Ew(t,n,e){var r=_h.get(e),o=_h.urls[e]||t.documentBaseUrl.replace(/\/$/,"");if(e=Xt.trim(e),r&&-1===Xt.inArray(n,e)&&(Xt.each(_h.dependencies(e),function(e){Ew(t,n,e)}),!t.plugins[e]))try{var i=new r(t,o,t.$);(t.plugins[e]=i).init&&(i.init(t,o),n.push(e))}catch(iE){kh.pluginInitError(t,e,iE)}}function Sw(e){return e.replace(/^\-/,"")}function Tw(e){return{editorContainer:e,iframeContainer:e}}function _w(e){var o,t,u,r,l,f,n=e.settings,s=e.getElement();return e.orgDisplay=s.style.display,S(n.theme)?(l=(o=e).settings,f=o.getElement(),r=l.width||Nw.getStyle(f,"width")||"100%",t=l.height||Nw.getStyle(f,"height")||f.offsetHeight,u=l.min_height||100,(s=/^[0-9\.]+(|px)$/i).test(""+r)&&(r=Math.max(parseInt(r,10),100)),s.test(""+t)&&(t=Math.max(parseInt(t,10),u)),r=o.theme.renderUI({targetNode:f,width:r,height:t,deltaWidth:l.delta_width,deltaHeight:l.delta_height}),l.content_editable||(t=(r.iframeHeight||t)+("number"==typeof t?r.deltaHeight||0:""))<u&&(t=u),r.height=t,r):D(n.theme)?(r=(t=e).getElement(),(n=t.settings.theme(t,r)).editorContainer.nodeType&&(n.editorContainer.id=n.editorContainer.id||t.id+"_parent"),n.iframeContainer&&n.iframeContainer.nodeType&&(n.iframeContainer.id=n.iframeContainer.id||t.id+"_iframecontainer"),n.height=n.iframeHeight||r.offsetHeight,n):function(t){var n=t.getElement();return t.inline?Tw(null):(t=n,n=Nw.create("div"),Nw.insertAfter(n,t),Tw(n))}(e)}function Ow(i,a){var u=Ri.ScriptLoader;!function(e,t,n,r){var a=t.settings,i=a.theme;S(i)?(Dw(i)||Ah.urls.hasOwnProperty(i)||((a=a.theme_url)?Ah.load(i,t.documentBaseURI.toAbsolute(a)):Ah.load(i,"themes/"+i+"/theme"+n+".js")),e.loadQueue(function(){Ah.waitFor(i,r)})):r()}(u,i,a,function(){var t,n,r,o,e=u;(n=(t=i).settings).language&&"en"!==n.language&&!n.language_url&&(n.language_url=t.editorManager.baseURL+"/langs/"+n.language+".js"),n.language_url&&!t.editorManager.i18n.data[n.language]&&e.add(n.language_url),r=i.settings,o=a,Xt.isArray(r.plugins)&&(r.plugins=r.plugins.join(" ")),Xt.each(r.external_plugins,function(e,t){_h.load(t,e),r.plugins+=" "+t}),Xt.each(r.plugins.split(/[ ,]/),function(e){var t;(e=Xt.trim(e))&&!_h.urls[e]&&(Dw(e)?(e=e.substr(1,e.length),t=_h.dependencies(e),Xt.each(t,function(e){e=_h.createUrl({prefix:"plugins/",resource:e,suffix:"/plugin"+o+".js"},e),_h.load(e.resource,e)})):_h.load(e,{prefix:"plugins/",resource:e,suffix:"/plugin"+o+".js"}))}),u.loadQueue(function(){i.removed||Aw(i)},i,function(e){kh.pluginLoadError(i,e[0]),i.removed||Aw(i)})})}function zw(r,e){var t,n,i,o=this;r=Lw(r),t=(e=o.settings=e||{}).base_uri,/^([\w\-]+):([^\/]{2})/i.test(r)||/^\s*#/.test(r)?o.source=r:(i=0===r.indexOf("//"),0!==r.indexOf("/")||i||(r=(t&&t.protocol||"http")+"://mce_host"+r),/^[\w\-]*:?\/\//.test(r)||(n=e.base_uri?e.base_uri.path:new zw(V.document.location.href).directory,r=""==e.base_uri.protocol?"//mce_host"+o.toAbsPath(n,r):(r=/([^#?]*)([#?]?.*)/.exec(r),(t&&t.protocol||"http")+"://mce_host"+o.toAbsPath(n,r[1])+r[2])),r=r.replace(/@@/g,"(mce_at)"),r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(r),Iw(Fw,function(e,n){n=(n=r[n])&&n.replace(/\(mce_at\)/g,"@@");o[e]=n}),t&&(o.protocol||(o.protocol=t.protocol),o.userInfo||(o.userInfo=t.userInfo),o.port||"mce_host"!==o.host||(o.port=t.port),o.host&&"mce_host"!==o.host||(o.host=t.host),o.source=""),i&&(o.protocol=""))}var vw=Si.DOM,Cw=Si.DOM,Nw=Si.DOM,Aw=function(t){var e,o,i,a,u=t.settings,r=t.getElement();return t.rtl=u.rtl_ui||t.editorManager.i18n.rtl,t.editorManager.i18n.setCode(u.language),u.aria_label=u.aria_label||Nw.getAttrib(r,"aria-label",t.getLang("aria.rich_text_area")),t.fire("ScriptsLoaded"),o=(e=t).settings.theme,S(o)?(e.settings.theme=Sw(o),r=Ah.get(o),e.theme=new r(e,Ah.urls[o]),e.theme.init&&e.theme.init(e,Ah.urls[o]||e.documentBaseUrl.replace(/\/$/,""),e.$)):e.theme={},i=t,a=[],Xt.each(i.settings.plugins.split(/[ ,]/),function(e){Ew(i,a,Sw(e))}),e=_w(t),t.editorContainer=e.editorContainer||null,u.content_css&&Xt.each(Xt.explode(u.content_css),function(e){t.contentCSS.push(t.documentBaseURI.toAbsolute(e))}),u.content_editable?bw(t):function(e,t){var n=xw(e,t);t.editorContainer&&(Cw.get(t.editorContainer).style.display=e.orgDisplay,e.hidden=Cw.isHidden(t.editorContainer)),e.getElement().style.display="none",Cw.setAttrib(e.id,"aria-hidden","true"),n||bw(e)}(t,e)},Rw=Si.DOM,Dw=function(e){return"-"===e.charAt(0)},Iw=Xt.each,Lw=Xt.trim,Fw="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),Mw={ftp:21,http:80,https:443,mailto:25};zw.prototype={setPath:function(e){e=/^(.*?)\/?(\w+)?$/.exec(e),this.path=e[0],this.directory=e[1],this.file=e[2],this.source="",this.getURI()},toRelative:function(e){if("./"===e)return e;if("mce_host"!==(e=new zw(e,{base_uri:this})).host&&this.host!==e.host&&e.host||this.port!==e.port||this.protocol!==e.protocol&&""!==e.protocol)return e.getURI();var t=this.getURI(),r=e.getURI();return t===r||"/"===t.charAt(t.length-1)&&t.substr(0,t.length-1)===r?t:(t=this.toRelPath(this.path,e.path),e.query&&(t+="?"+e.query),e.anchor&&(t+="#"+e.anchor),t)},toAbsolute:function(e,t){return(e=new zw(e,{base_uri:this})).getURI(t&&this.isSameOrigin(e))},isSameOrigin:function(e){if(this.host==e.host&&this.protocol==e.protocol){if(this.port==e.port)return!0;var t=Mw[this.protocol];if(t&&(this.port||t)==(e.port||t))return!0}return!1},toRelPath:function(e,t){var n,r,o,i=0,a="";if(e=(e=e.substring(0,e.lastIndexOf("/"))).split("/"),n=t.split("/"),e.length>=n.length)for(r=0,o=e.length;r<o;r++)if(r>=n.length||e[r]!==n[r]){i=r+1;break}if(e.length<n.length)for(r=0,o=n.length;r<o;r++)if(r>=e.length||e[r]!==n[r]){i=r+1;break}if(1===i)return t;for(r=0,o=e.length-(i-1);r<o;r++)a+="../";for(r=i-1,o=n.length;r<o;r++)a+=r!==i-1?"/"+n[r]:n[r];return a},toAbsPath:function(o,t){var n,i=0,a=[],r=/\/$/.test(t)?"/":"";for(o=o.split("/"),t=t.split("/"),Iw(o,function(e){e&&a.push(e)}),o=a,n=t.length-1,a=[];0<=n;n--)0!==t[n].length&&"."!==t[n]&&(".."!==t[n]?0<i?i--:a.push(t[n]):i++);return 0!==(o=(n=o.length-i)<=0?a.reverse().join("/"):o.slice(0,n).join("/")+"/"+a.reverse().join("/")).indexOf("/")&&(o="/"+o),r&&o.lastIndexOf("/")!==o.length-1&&(o+=r),o},getURI:function(e){var t,n=this;return n.source&&!e||(t="",e||(n.protocol?t+=n.protocol+"://":t+="//",n.userInfo&&(t+=n.userInfo+"@"),n.host&&(t+=n.host),n.port&&(t+=":"+n.port)),n.path&&(t+=n.path),n.query&&(t+="?"+n.query),n.anchor&&(t+="#"+n.anchor),n.source=t),n.source}},zw.parseDataUri=function(e){var t,n;return e=decodeURIComponent(e).split(","),{type:t=(n=/data:([^;]+)/.exec(e[0]))?n[1]:t,data:e[1]}},zw.getDocumentBaseUrl=function(t){t=0!==t.protocol.indexOf("http")&&"file:"!==t.protocol?t.href:t.protocol+"//"+t.host+t.pathname;return/^[^:]+:\/\/\/?[^\/]+\//.test(t)&&(t=t.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(t)||(t+="/")),t};function Hw(e){return e instanceof sb}function qw(e,t){var r;e.dom.setHTML(e.getBody(),t),sh(r=e)&&sc.firstPositionIn(r.getBody()).each(function(n){var t=n.getNode(),n=jo.isTable(t)?sc.firstPositionIn(t).getOr(n):n;r.selection.setRng(n.toRange())})}function $w(u,s,c){return(c=void 0===c?{}:c).format=c.format||"html",c.set=!0,c.content=Hw(s)?"":s,Hw(s)||c.no_events||(u.fire("BeforeSetContent",c),s=c.content),_.from(u.getBody()).fold(q(s),function(i){return Hw(s)?function(e,t,n,r){!function(e,t,r){r=function(e,n,t){var a,r={},o={},i=[];for(a in t.firstChild&&jw(t.firstChild,function(t){z(e,function(e){e.name===t.name&&(r[e.name]?r[e.name].nodes.push(t):r[e.name]={filter:e,nodes:[t]})}),z(n,function(e){"string"==typeof t.attr(e.name)&&(o[e.name]?o[e.name].nodes.push(t):o[e.name]={filter:e,nodes:[t]})})}),r)r.hasOwnProperty(a)&&i.push(r[a]);for(a in o)o.hasOwnProperty(a)&&i.push(o[a]);return i}(e,t,r);z(r,function(t){z(t.filter.callbacks,function(e){e(t.nodes,t.filter.name,{})})})}(e.parser.getNodeFilters(),e.parser.getAttributeFilters(),n);var o=al({validate:e.validate},e.schema).serialize(n);return r.content=Ao(ar.fromDom(t))?o:Xt.trim(o),qw(e,r.content),r.no_events||e.fire("SetContent",r),n}(u,i,s,c):(t=u,n=i,o=c,0===(r=s).length||/^\s+$/.test(r)?(a='<br data-mce-bogus="1">',"TABLE"===n.nodeName?r="<tr><td>"+a+"</td></tr>":/^(UL|OL)$/.test(n.nodeName)&&(r="<li>"+a+"</li>"),r=(i=Nl(t))&&t.schema.isValidChild(n.nodeName.toLowerCase(),i.toLowerCase())?t.dom.createHTML(i,t.settings.forced_root_block_attrs,r=a):r||'<br data-mce-bogus="1">',qw(t,r),t.fire("SetContent",o)):("raw"!==o.format&&(r=al({validate:t.validate},t.schema).serialize(t.parser.parse(r,{isRootContent:!0,insert:!0}))),o.content=Ao(ar.fromDom(n))?r:Xt.trim(r),qw(t,o.content),o.no_events||t.fire("SetContent",o)),o.content);var t,n,r,o,a})}function Kw(e){return _.from(e).each(function(e){return e.destroy()})}function tN(e,t,n){var l=this,c=l.documentBaseUrl=n.documentBaseURL,d=n.baseURI,a=n.defaultSettings,u=t,c={id:e,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:c,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,render_ui:!0,indentation:"40px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:l.convertURL,url_converter_scope:l,ie7_compat:!0};t=function(e,f,n,m){var o,a,g,h=(o=["mobile"],g=yr(m,function(e,t){return F(o,t)}),Mp(g.t,g.f)),v=Xt.extend(f,n,h.settings(),(m=e,f=(g=h).settings().inline,m&&Hp(g,"mobile")&&!f?(v="mobile",a=jp,v=(f=h.sections()).hasOwnProperty(v)?f[v]:{},Xt.extend({},a,v)):{}),{validate:!0,content_editable:h.settings().inline,external_plugins:(a=n,v=h.settings().external_plugins||{},a&&a.external_plugins?Xt.extend({},a.external_plugins,v):v)});return qp(e,h,n,v)}(zp,c,a,u),l.settings=t,Bi.language=t.language||"en",Bi.languageLoad=t.language_load,Bi.baseURL=n.baseURL,l.id=e,l.setDirty(!1),l.plugins={},l.documentBaseURI=new zw(t.document_base_url,{base_uri:d}),l.baseURI=d,l.contentCSS=[],l.contentStyles=[],l.shortcuts=new Qp(l),l.loadedCSS={},l.editorCommands=new pp(l),l.suffix=n.suffix,l.editorManager=n,l.inline=t.inline,l.buttons={},l.menuItems={},t.cache_suffix&&(fe.cacheSuffix=t.cache_suffix.replace(/^[\?\&]+/,"")),!1===t.override_viewport&&(fe.overrideViewPort=!1),n.fire("SetupEditor",{editor:l}),l.execCallback("setup",l),l.$=gn.overrideDefaults(function(){return{context:l.inline?l.getBody():l.getDoc(),element:l.getBody()}})}var jw=function(e,t){t(e),e.firstChild&&jw(e.firstChild,t),e.next&&jw(e.next,t)},Ww=Si.DOM,Gw=Si.DOM,Jw=Xt.extend,Qw=Xt.each,Zw=Xt.resolve,eN=fe.ie;Jw(tN.prototype={render:function(){function r(){Rw.unbind(V.window,"ready",r),t.render()}var t,o,e,n;e=(t=this).settings,n=t.id,Se.Event.domLoaded?t.getElement()&&fe.contentEditable&&(e.inline?t.inline=!0:(t.orgVisibility=t.getElement().style.visibility,t.getElement().style.visibility="hidden"),(o=t.getElement().form||Rw.getParent(n,"form"))&&(t.formElement=o,e.hidden_input&&!/TEXTAREA|INPUT/i.test(t.getElement().nodeName)&&(Rw.insertAfter(Rw.create("input",{type:"hidden",name:n}),n),t.hasHiddenInput=!0),t.formEventDelegate=function(e){t.fire(e.type,e)},Rw.bind(o,"submit reset",t.formEventDelegate),t.on("reset",function(){t.setContent(t.startContent,{format:"raw"})}),!e.submit_patch||o.submit.nodeType||o.submit.length||o._mceOldSubmit||(o._mceOldSubmit=o.submit,o.submit=function(){return t.editorManager.triggerSave(),t.setDirty(!1),o._mceOldSubmit(o)})),t.windowManager=yh(t),t.notificationManager=vh(t),"xml"===e.encoding&&t.on("GetContent",function(e){e.save&&(e.content=Rw.encode(e.content))}),e.add_form_submit_trigger&&t.on("submit",function(){t.initialized&&t.save()}),e.add_unload_trigger&&(t._beforeUnload=function(){!t.initialized||t.destroyed||t.isHidden()||t.save({format:"raw",no_events:!0,set_dirty:!1})},t.editorManager.on("BeforeUnload",t._beforeUnload)),t.editorManager.add(t),Ow(t,t.suffix)):Rw.bind(V.window,"ready",r)},focus:function(e){!function(e,t){e.removed||(t?ah:function(t){var u=t.selection,n=t.settings.content_editable,r=t.getBody(),o=u.getRng();t.quirks.refreshContentEditable();var i,u=(i=t,u=u.getNode(),i.dom.getParent(u,function(e){return"true"===i.dom.getContentEditable(e)}));if(t.$.contains(r,u))return rh(u),nh(t,o),ah(t);void 0!==t.bookmark&&!1===ih(t)&&up(t).each(function(e){t.selection.setRng(e),o=e}),n||(fe.opera||rh(r),t.getWin().focus()),(fe.gecko||n)&&(rh(r),nh(t,o)),ah(t)})(e)}(this,e)},hasFocus:function(){return sh(this)},execCallback:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,o=this.settings[e];if(o)return this.callbackLookup&&(r=this.callbackLookup[e])&&(o=r.func,r=r.scope),"string"==typeof o&&(r=(r=o.replace(/\.\w+$/,""))?Zw(r):0,o=Zw(o),this.callbackLookup=this.callbackLookup||{},this.callbackLookup[e]={func:o,scope:r}),o.apply(r||this,Array.prototype.slice.call(arguments,1))},translate:function(e){var n,r;return e&&Xt.is(e,"string")&&(n=this.settings.language||"en",e=(r=this.editorManager.i18n).data[n+"."+e]||e.replace(/\{\#([^\}]+)\}/g,function(e,t){return r.data[n+"."+t]||"{#"+t+"}"})),this.editorManager.translate(e)},getLang:function(e,t){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+e]||(void 0!==t?t:"{#"+e+"}")},getParam:function(e,t,n){return function(e,t,n,r){var o,i,a,u=t in e.settings?e.settings[t]:n;return"hash"===r?(a={},"string"==typeof(i=u)?z(0<i.indexOf("=")?i.split(/[;,](?![^=;,]*(?:[;,]|$))/):i.split(","),function(t){t=t.split("=");1<t.length?a[Xt.trim(t[0])]=Xt.trim(t[1]):a[Xt.trim(t[0])]=Xt.trim(t)}):a=i,a):"string"===r?Wp(S,e,t).getOr(n):"number"===r?Wp(O,e,t).getOr(n):"boolean"===r?Wp(R,e,t).getOr(n):"object"===r?Wp(T,e,t).getOr(n):"array"===r?Wp(k,e,t).getOr(n):"string[]"===r?Wp((o=S,function(e){return k(e)&&J(e,o)}),e,t).getOr(n):"function"===r?Wp(D,e,t).getOr(n):u}(this,e,t,n)},nodeChanged:function(e){this._nodeChangeDispatcher.nodeChanged(e)},addButton:function(e,t){var n=this;t.cmd&&(t.onclick=function(){n.execCommand(t.cmd)}),t.stateSelector&&void 0===t.active&&(t.active=!1),t.text||t.icon||(t.icon=e),t.tooltip=t.tooltip||t.title,n.buttons[e]=t},addSidebar:function(e,t){return function(e,t,n){var r=e.sidebars||[];r.push({name:t,settings:n}),e.sidebars=r}(this,e,t)},addMenuItem:function(e,t){var n=this;t.cmd&&(t.onclick=function(){n.execCommand(t.cmd)}),n.menuItems[e]=t},addContextToolbar:function(e,t){var n,r=this;r.contextToolbars=r.contextToolbars||[],"string"==typeof e&&(n=e,e=function(e){return r.dom.is(e,n)}),r.contextToolbars.push({id:Hh_uuid("mcet"),predicate:e,items:t})},addCommand:function(e,t,n){this.editorCommands.addCommand(e,t,n)},addQueryStateHandler:function(e,t,n){this.editorCommands.addQueryStateHandler(e,t,n)},addQueryValueHandler:function(e,t,n){this.editorCommands.addQueryValueHandler(e,t,n)},addShortcut:function(e,t,n,r){this.shortcuts.add(e,t,n,r)},execCommand:function(e,t,n,r){return this.editorCommands.execCommand(e,t,n,r)},queryCommandState:function(e){return this.editorCommands.queryCommandState(e)},queryCommandValue:function(e){return this.editorCommands.queryCommandValue(e)},queryCommandSupported:function(e){return this.editorCommands.queryCommandSupported(e)},show:function(){this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable=!0:(Gw.show(this.getContainer()),Gw.hide(this.id)),this.load(),this.fire("show"))},hide:function(){var e=this,t=e.getDoc();e.hidden||(eN&&t&&!e.inline&&t.execCommand("SelectAll"),e.save(),e.inline?(e.getBody().contentEditable=!1,e===e.editorManager.focusedEditor&&(e.editorManager.focusedEditor=null)):(Gw.hide(e.getContainer()),Gw.setStyle(e.id,"display",e.orgDisplay)),e.hidden=!0,e.fire("hide"))},isHidden:function(){return!!this.hidden},setProgressState:function(e,t){this.fire("ProgressState",{state:e,time:t})},load:function(e){var t,n=this.getElement();return this.removed?"":n?((e=e||{}).load=!0,t=this.setContent(void 0!==n.value?n.value:n.innerHTML,e),e.element=n,e.no_events||this.fire("LoadContent",e),e.element=n=null,t):void 0},save:function(e){var t,n,r=this,o=r.getElement();if(o&&r.initialized&&!r.removed)return(e=e||{}).save=!0,e.element=o,e.content=r.getContent(e),e.no_events||r.fire("SaveContent",e),"raw"===e.format&&r.fire("RawSaveContent",e),t=e.content,/TEXTAREA|INPUT/i.test(o.nodeName)?o.value=t:(!e.is_removing&&r.inline||(o.innerHTML=t),(n=Gw.getParent(r.id,"form"))&&Qw(n.elements,function(e){if(e.name===r.id)return e.value=t,!1})),e.element=o=null,!1!==e.set_dirty&&r.setDirty(!1),t},setContent:function(e,t){return $w(this,e,t)},getContent:function(e){return void 0===(n=e)&&(n={}),_.from((t=this).getBody()).fold(q("tree"===n.format?new sb("body",11):""),function(e){return function(e,t,n){var r,i,u;if(t.format=t.format||"html",t.get=!0,t.getInner=!0,t.no_events||e.fire("BeforeGetContent",t),"raw"===t.format)r=Xt.trim(Uv.trimExternal(e.serializer,n.innerHTML));else if("text"===t.format)r=wa(n.innerText||n.textContent);else{if("tree"===t.format)return e.serializer.serialize(n,t);i=(u=e).serializer.serialize(n,t),u=Nl(u),u=new RegExp("^(<"+u+"[^>]*>(&nbsp;|&#160;|\\s|Â |<br \\/>|)<\\/"+u+">[\r\n]*|<br \\/>[\r\n]*)$"),r=i.replace(u,"")}return"text"===t.format||Ao(ar.fromDom(n))?t.content=r:t.content=Xt.trim(r),t.no_events||e.fire("GetContent",t),t.content}(t,n,e)});var t,n},insertContent:function(e,t){t&&(e=Jw({content:e},t)),this.execCommand("mceInsertContent",!1,e)},isDirty:function(){return!this.isNotDirty},setDirty:function(e){var t=!this.isNotDirty;this.isNotDirty=!e,e&&e!==t&&this.fire("dirty")},setMode:function(e){var t,n;(n=e)!==function(e){return e.readonly?"readonly":"design"}(t=this)&&(t.initialized?Rp(t,"readonly"===n):t.on("init",function(){Rp(t,"readonly"===n)}),function(e,t){e.fire("SwitchMode",{mode:t})}(t,n))},getContainer:function(){return this.container||(this.container=Gw.get(this.editorContainer||this.id+"_parent")),this.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return this.targetElm||(this.targetElm=Gw.get(this.id)),this.targetElm},getWin:function(){var e;return this.contentWindow||(e=this.iframeElement)&&(this.contentWindow=e.contentWindow),this.contentWindow},getDoc:function(){var e;return this.contentDocument||(e=this.getWin())&&(this.contentDocument=e.document),this.contentDocument},getBody:function(){var e=this.getDoc();return this.bodyElement||(e?e.body:null)},convertURL:function(e,t,n){var r=this.settings;return r.urlconverter_callback?this.execCallback("urlconverter_callback",e,n,!0,t):!r.convert_urls||n&&"LINK"===n.nodeName||0===e.indexOf("file:")||0===e.length?e:r.relative_urls?this.documentBaseURI.toRelative(e):this.documentBaseURI.toAbsolute(e,r.remove_script_host)},addVisual:function(e){var n,r=this,o=r.settings,i=r.dom;e=e||r.getBody(),void 0===r.hasVisual&&(r.hasVisual=o.visual),Qw(i.select("table,a",e),function(e){var t;switch(e.nodeName){case"TABLE":return n=o.visual_table_class||"mce-item-table",void((t=i.getAttrib(e,"border"))&&"0"!==t||!r.hasVisual?i.removeClass(e,n):i.addClass(e,n));case"A":return void(i.getAttrib(e,"href")||(t=i.getAttrib(e,"name")||e.id,n=o.visual_anchor_class||"mce-item-anchor",t&&r.hasVisual?i.addClass(e,n):i.removeClass(e,n)))}}),r.fire("VisualAid",{element:e,hasVisual:r.hasVisual})},remove:function(){var e,t,n,r,o;(e=this).removed||(t=e._selectionOverrides,n=e.editorUpload,r=e.getBody(),o=e.getElement(),r&&e.save({is_removing:!0}),e.removed=!0,e.unbindAllNativeEvents(),e.hasHiddenInput&&o&&Ww.remove(o.nextSibling),e.fire("remove"),e.editorManager.remove(e),!e.inline&&r&&Ww.setStyle(e.id,"display",e.orgDisplay),e.fire("detach"),Ww.remove(e.getContainer()),Kw(t),Kw(n),e.destroy())},destroy:function(e){!function(e,t){var o=e.selection,r=e.dom;e.destroyed||(t||e.removed?(t||(e.editorManager.off("beforeunload",e._beforeUnload),e.theme&&e.theme.destroy&&e.theme.destroy(),Kw(o),Kw(r)),(r=(o=e).formElement)&&(r._mceOldSubmit&&(r.submit=r._mceOldSubmit,r._mceOldSubmit=null),Ww.unbind(r,"submit reset",o.formEventDelegate)),(o=e).contentAreaContainer=o.formElement=o.container=o.editorContainer=null,o.bodyElement=o.contentDocument=o.contentWindow=null,o.iframeElement=o.targetElm=null,o.selection&&(o.selection=o.selection.win=o.selection.dom=o.selection.dom.doc=null),e.destroyed=!0):e.remove())}(this,e)},uploadImages:function(e){return this.editorUpload.uploadImages(e)},_scanForImages:function(){return this.editorUpload.scanForImages()}},tE);function fN(r,t){t=t.editor,uN(t),t.on("focusin",function(){var e=r.focusedEditor;e!==this&&(e&&e.fire("blur",{focusedEditor:this}),r.setActive(this),(r.focusedEditor=this).fire("focus",{blurredEditor:e}),this.focus(!0))}),t.on("focusout",function(){var t=this;he.setEditorTimeout(t,function(){var e=r.focusedEditor;lN(t,function(){try{return V.document.activeElement}catch(e){return V.document.body}}())||e!==t||(t.fire("blur",{focusedEditor:null}),r.focusedEditor=null)})}),nN||(nN=function(t){var n=r.activeEditor,t=t.target;n&&t.ownerDocument===V.document&&(t===V.document.body||lN(n,t)||r.focusedEditor!==n||(n.fire("blur",{focusedEditor:null}),r.focusedEditor=null))},sN.bind(V.document,"focusin",nN))}function dN(e,t){e.focusedEditor===t.editor&&(e.focusedEditor=null),e.activeEditor||(sN.unbind(V.document,"focusin",nN),nN=null)}function wN(t){var n=t.type;hN(oN.get(),function(e){switch(n){case"scroll":e.fire("ScrollWindow",t);break;case"resize":e.fire("ResizeWindow",t)}})}function NN(e){e!==bN&&(e?gn(window).on("resize scroll",wN):gn(window).off("resize scroll",wN),bN=e)}function EN(t){var e=xN;delete CN[t.id];for(var n=0;n<CN.length;n++)if(CN[n]===t){CN.splice(n,1);break}return xN=U(xN,function(e){return t!==e}),oN.activeEditor===t&&(oN.activeEditor=0<xN.length?xN[0]:null),oN.focusedEditor===t&&(oN.focusedEditor=null),e.length!==xN.length}var nN,rN,oN,iN={isEditorUIElement:function(e){return-1!==e.className.toString().indexOf("mce-")}},uN=function(e){var t,n,r,o=Vi(function(){ip(e)},0);e.inline&&(t=e,n=o,r=function(){n.throttle()},Si.DOM.bind(V.document,"mouseup",r),t.on("remove",function(){Si.DOM.unbind(V.document,"mouseup",r)})),e.on("init",function(){!function(n,e){var t,r;or.detect().browser.isIE()?(r=n).on("focusout",function(){ip(r)}):(t=e,n.on("mouseup touchend",function(e){t.throttle()})),n.on("keyup nodechange",function(e){"nodechange"===e.type&&e.selectionChange||ip(n)})}(e,o)}),e.on("remove",function(){o.cancel()})},sN=Si.DOM,lN=function(t,e){var n=t?t.settings.custom_ui_selector:"";return null!==sN.getParent(e,function(e){return function(e){return iN.isEditorUIElement(e)}(e)||!!n&&t.dom.is(e,n)})},gN=Si.DOM,pN=Xt.explode,hN=Xt.each,vN=Xt.extend,yN=0,bN=!1,CN=[],xN=[];vN(oN={defaultSettings:{},$:gn,majorVersion:"4",minorVersion:"9.11",releaseDate:"2020-07-13",editors:CN,i18n:xh,activeEditor:null,settings:{},setup:function(){var e,n="",t=zw.getDocumentBaseUrl(V.document.location);/^[^:]+:\/\/\/?[^\/]+\//.test(t)&&(t=t.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(t)||(t+="/"));var r=window.tinymce||window.tinyMCEPreInit;if(r)e=r.base||r.baseURL,n=r.suffix;else{for(var a,o=V.document.getElementsByTagName("script"),i=0;i<o.length;i++)if(""!==(a=o[i].src||"")){var u=a.substring(a.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(a)){-1!==u.indexOf(".min")&&(n=".min"),e=a.substring(0,a.lastIndexOf("/"));break}}!e&&V.document.currentScript&&(-1!==(a=V.document.currentScript.src).indexOf(".min")&&(n=".min"),e=a.substring(0,a.lastIndexOf("/")))}this.baseURL=new zw(t).toAbsolute(e),this.documentBaseURL=t,this.baseURI=new zw(this.baseURL),this.suffix=n,function(e){e.on("AddEditor",d(fN,e)),e.on("RemoveEditor",d(dN,e))}(this)},overrideDefaults:function(e){var n;(n=e.base_url)&&(this.baseURL=new zw(this.documentBaseURL).toAbsolute(n.replace(/\/+$/,"")),this.baseURI=new zw(this.baseURL)),n=e.suffix,e.suffix&&(this.suffix=n);var o,r=(this.defaultSettings=e).plugin_base_urls;for(o in r)Bi.PluginManager.urls[o]=r[o]},init:function(r){var n,s=this,u=Xt.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu"," "),c=function(e){var t=e.id;return t||(t=(t=e.name)&&!gN.get(t)?e.name:gN.uniqueId(),e.setAttribute("id",t)),t},l=function(e,t){return t.constructor===RegExp?t.test(e.className):gN.hasClass(e,t)},f=function(e){n=e},e=function(){function n(e,r,n){r=new tN(e,r,s),a.push(r),r.on("init",function(){++i===o.length&&f(a)}),r.targetElm=r.targetElm||n,r.render()}var o,i=0,a=[];gN.unbind(window,"ready",e),function(){var t=r.onpageload;t&&t.apply(s,Array.prototype.slice.call(arguments,2))}("onpageload"),o=gn.unique(function(t){var e,n=[];if(fe.ie&&fe.ie<11)return kh.initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(t.types)return hN(t.types,function(e){n=n.concat(gN.select(e.selector))}),n;if(t.selector)return gN.select(t.selector);if(t.target)return[t.target];switch(t.mode){case"exact":0<(e=t.elements||"").length&&hN(pN(e),function(t){var e;(e=gN.get(t))?n.push(e):hN(V.document.forms,function(e){hN(e.elements,function(e){e.name===t&&(t="mce_editor_"+yN++,gN.setAttrib(e,"id",t),n.push(e))})})});break;case"textareas":case"specific_textareas":hN(gN.select("textarea"),function(e){t.editor_deselector&&l(e,t.editor_deselector)||t.editor_selector&&!l(e,t.editor_selector)||n.push(e)})}return n}(r)),r.types?hN(r.types,function(t){Xt.each(o,function(e){return!gN.is(e,t.selector)||(n(c(e),vN({},r,t),e),!1)})}):(Xt.each(o,function(t){(t=s.get(t.id))&&t.initialized&&!(t.getContainer()||t.getBody()).parentNode&&(EN(t),t.unbindAllNativeEvents(),t.destroy(!0),t.removed=!0)}),0===(o=Xt.grep(o,function(e){return!s.get(e.id)})).length?f([]):hN(o,function(e){var t=e;r.inline&&t.tagName.toLowerCase()in u?kh.initError("Could not initialize inline editor on invalid inline target element",e):n(c(e),r,e)}))};return s.settings=r,gN.bind(window,"ready",e),new de(function(t){n?t(n):f=function(e){t(e)}})},get:function(t){return 0===arguments.length?xN.slice(0):S(t)?X(xN,function(e){return e.id===t}).getOr(null):O(t)&&xN[t]?xN[t]:null},add:function(e){var t=this;return CN[e.id]===e||(null===t.get(e.id)&&("length"!==e.id&&(CN[e.id]=e),CN.push(e),xN.push(e)),NN(!0),t.activeEditor=e,t.fire("AddEditor",{editor:e}),rN||(rN=function(){t.fire("BeforeUnload")},gN.bind(window,"beforeunload",rN))),e},createEditor:function(e,t){return this.add(new tN(e,t,this))},remove:function(e){var t,n,r=this;if(e){if(!S(e))return n=e,A(r.get(n.id))?null:(EN(n)&&r.fire("RemoveEditor",{editor:n}),0===xN.length&&gN.unbind(window,"beforeunload",rN),n.remove(),NN(0<xN.length),n);hN(gN.select(e),function(e){(n=r.get(e.id))&&r.remove(n)})}else for(t=xN.length-1;0<=t;t--)r.remove(xN[t])},execCommand:function(e,t,n){var r=this.get(n);switch(e){case"mceAddEditor":return this.get(n)||new tN(n,this.settings,this).render(),!0;case"mceRemoveEditor":return r&&r.remove(),!0;case"mceToggleEditor":return r?r.isHidden()?r.show():r.hide():this.execCommand("mceAddEditor",0,n),!0}return!!this.activeEditor&&this.activeEditor.execCommand(e,t,n)},triggerSave:function(){hN(xN,function(e){e.save()})},addI18n:function(e,t){xh.add(e,t)},translate:function(e){return xh.translate(e)},setActive:function(e){var t=this.activeEditor;this.activeEditor!==e&&(t&&t.fire("deactivate",{relatedTarget:e}),e.fire("activate",{relatedTarget:t})),this.activeEditor=e}},Cp),oN.setup();oE=oN;function kN(n){return{walk:function(e,t){return Lc(n,e,t)},split:Um,normalize:function(t){return Dg(n,t).fold(q(!1),function(e){return t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),!0})}}}(QN=kN=kN||{}).compareRanges=Eg,QN.getCaretRangeFromPoint=Bb,QN.getSelectedNode=Za,QN.getNode=eu;function PN(u,s,n){var r=s.x,o=s.y,i=u.w,a=u.h,u=s.w,s=s.h;return"b"===(n=(n||"").split(""))[0]&&(o+=s),"r"===n[1]&&(r+=u),"c"===n[0]&&(o+=BN(s/2)),"c"===n[1]&&(r+=BN(u/2)),"b"===n[3]&&(o-=a),"r"===n[4]&&(r-=i),"c"===n[3]&&(o-=BN(a/2)),"c"===n[4]&&(r-=BN(i/2)),IN(r,o,i,a)}function IN(e,t,n,r){return{x:e,y:t,w:n,h:r}}var _N,AN,RN=kN,DN=Math.min,ON=Math.max,BN=Math.round,LN={inflate:function(e,t,n){return IN(e.x-t,e.y-n,e.w+2*t,e.h+2*n)},relativePosition:PN,findBestRelativePosition:function(e,t,n,r){for(var o,i=0;i<r.length;i++)if((o=PN(e,t,r[i])).x>=n.x&&o.x+o.w<=n.w+n.x&&o.y>=n.y&&o.y+o.h<=n.h+n.y)return r[i];return null},intersect:function(e,i){var n=ON(e.x,i.x),r=ON(e.y,i.y),o=DN(e.x+e.w,i.x+i.w),i=DN(e.y+e.h,i.y+i.h);return o-n<0||i-r<0?null:IN(n,r,o-n,i-r)},clamp:function(r,o,n){var u=r.x,s=r.y,c=r.x+r.w,l=r.y+r.h,i=o.x+o.w,a=o.y+o.h,r=ON(0,o.x-u),o=ON(0,o.y-s),i=ON(0,c-i),a=ON(0,l-a);return u+=r,s+=o,n&&(c+=r,l+=o,u-=i,s-=a),IN(u,s,(c-=i)-u,(l-=a)-s)},create:IN,fromClientRect:function(e){return IN(e.left,e.top,e.width,e.height)}},FN={},MN={add:function(e,t){FN[e.toLowerCase()]=t},has:function(e){return!!FN[e.toLowerCase()]},get:function(e){var n=e.toLowerCase(),n=FN.hasOwnProperty(n)?FN[n]:null;if(null===n)throw new Error("Could not find module for type: "+e);return n},create:function(e,t){var n;if("string"==typeof e?(t=t||{}).type=e:e=(t=e).type,e=e.toLowerCase(),!(n=FN[e]))throw new Error("Could not find control by type: "+e);return(n=new n(t)).type=e,n}},zN=Xt.each,UN=Xt.extend,jN=function(){};jN.extend=_N=function(n){function i(){var e,t,n;if(!AN&&(this.init&&this.init.apply(this,arguments),t=this.Mixins))for(e=t.length;e--;)(n=t[e]).init&&n.init.apply(this,arguments)}function a(){return this}var e,t,r,o=this.prototype;for(t in AN=!0,e=new this,AN=!1,n.Mixins&&(zN(n.Mixins,function(e){for(var t in e)"init"!==t&&(n[t]=e[t])}),o.Mixins&&(n.Mixins=o.Mixins.concat(n.Mixins))),n.Methods&&zN(n.Methods.split(","),function(e){n[e]=a}),n.Properties&&zN(n.Properties.split(","),function(e){var t="_"+e;n[e]=function(e){return void 0!==e?(this[t]=e,this):this[t]}}),n.Statics&&zN(n.Statics,function(e,t){i[t]=e}),n.Defaults&&o.Defaults&&(n.Defaults=UN({},o.Defaults,n.Defaults)),n)"function"==typeof(r=n[t])&&o[t]?e[t]=function(n,r){return function(){var e,t=this._super;return this._super=o[n],e=r.apply(this,arguments),this._super=t,e}}(t,r):e[t]=r;return i.prototype=e,(i.constructor=i).extend=_N,i};function $N(e,n){var r,o,t,i;if(n=n||'"',null===e)return"null";if("string"==(t=typeof e))return o="\bb\tt\nn\ff\rr\"\"''\\\\",n+e.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(e,t){return'"'===n&&"'"===e?e:(r=o.indexOf(t))+1?"\\"+o.charAt(r+1):(e=t.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e)})+n;if("object"!=t)return""+e;if(e.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(e)){for(r=0,o="[";r<e.length;r++)o+=(0<r?",":"")+$N(e[r],n);return o+"]"}for(i in o="{",e)e.hasOwnProperty(i)&&(o+="function"!=typeof e[i]?(1<o.length?","+n:n)+i+n+":"+$N(e[i],n):"");return o+"}"}var VN=Math.min,HN=Math.max,qN=Math.round,WN={serialize:$N,parse:function(e){try{return JSON.parse(e)}catch(t){}}},KN={callbacks:{},count:0,send:function(t){var n=this,r=Si.DOM,o=(void 0!==t.count?t:n).count,i="tinymce_jsonp_"+o;n.callbacks[o]=function(e){r.remove(i),delete n.callbacks[o],t.callback(e)},r.add(r.doc.body,"script",{id:i,src:t.url,type:"text/javascript"}),n.count++}},XN={send:function(e){var t,n=0,r=function(){!e.async||4===t.readyState||1e4<n++?(e.success&&n<1e4&&200===t.status?e.success.call(e.success_scope,""+t.responseText,t,e):e.error&&e.error.call(e.error_scope,1e4<n?"TIMED_OUT":"GENERAL",t,e),t=null):setTimeout(r,10)};if(e.scope=e.scope||this,e.success_scope=e.success_scope||e.scope,e.error_scope=e.error_scope||e.scope,e.async=!1!==e.async,e.data=e.data||"",XN.fire("beforeInitialize",{settings:e}),t=Rh()){if(t.overrideMimeType&&t.overrideMimeType(e.content_type),t.open(e.type||(e.data?"POST":"GET"),e.url,e.async),e.crossDomain&&(t.withCredentials=!0),e.content_type&&t.setRequestHeader("Content-Type",e.content_type),e.requestheaders&&Xt.each(e.requestheaders,function(e){t.setRequestHeader(e.key,e.value)}),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),(t=XN.fire("beforeSend",{xhr:t,settings:e}).xhr).send(e.data),!e.async)return r();setTimeout(r,10)}}};Xt.extend(XN,Cp);function eE(e){this.settings=ZN({},e),this.count=0}var YN,GN,JN,ZN=Xt.extend;eE.sendRPC=function(e){return(new eE).send(e)},eE.prototype={send:function(n){var r=n.error,o=n.success;(n=ZN(this.settings,n)).success=function(e,t){(e=void 0===(e=WN.parse(e))?{error:"JSON Parse error."}:e).error?r.call(n.error_scope||n.scope,e.error,t):o.call(n.success_scope||n.scope,e.result)},n.error=function(e,t){r&&r.call(n.error_scope||n.scope,e,t)},n.data=WN.serialize({id:n.id||"c"+this.count++,method:n.method,params:n.params}),n.content_type="application/json",XN.send(n)}};try{YN=V.window.localStorage}catch(iE){GN={},JN=[],QN={getItem:function(e){return GN[e]||null},setItem:function(e,t){JN.push(e),GN[e]=String(t)},key:function(e){return JN[e]},removeItem:function(t){JN=JN.filter(function(e){return e===t}),delete GN[t]},clear:function(){JN=[],GN={}},length:0},Object.defineProperty(QN,"length",{get:function(){return JN.length},configurable:!1,enumerable:!1}),YN=QN}tE={geom:{Rect:LN},util:{Promise:de,Delay:he,Tools:Xt,VK:rv,URI:zw,Class:jN,EventDispatcher:vp,Observable:Cp,I18n:xh,XHR:XN,JSON:WN,JSONRequest:eE,JSONP:KN,LocalStorage:YN,Color:function(e){function t(e){var t;return"object"==typeof e?"r"in e?(u=e.r,s=e.g,c=e.b):"v"in e&&function(r,a,n){var o,i;if(r=(parseInt(r,10)||0)%360,a=parseInt(a,10)/100,n=parseInt(n,10)/100,a=HN(0,VN(a,1)),n=HN(0,VN(n,1)),0!==a){switch(r=r/60,i=(o=n*a)*(1-Math.abs(r%2-1)),a=n-o,Math.floor(r)){case 0:u=o,s=i,c=0;break;case 1:u=i,s=o,c=0;break;case 2:u=0,s=o,c=i;break;case 3:u=0,s=i,c=o;break;case 4:u=i,s=0,c=o;break;case 5:u=o,s=0,c=i;break;default:u=s=c=0}u=qN(255*(u+a)),s=qN(255*(s+a)),c=qN(255*(c+a))}else u=s=c=qN(255*n)}(e.h,e.s,e.v):(t=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(e))?(u=parseInt(t[1],10),s=parseInt(t[2],10),c=parseInt(t[3],10)):(t=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(e))?(u=parseInt(t[1],16),s=parseInt(t[2],16),c=parseInt(t[3],16)):(t=/#([0-F])([0-F])([0-F])/gi.exec(e))&&(u=parseInt(t[1]+t[1],16),s=parseInt(t[2]+t[2],16),c=parseInt(t[3]+t[3],16)),u=u<0?0:255<u?255:u,s=s<0?0:255<s?255:s,c=c<0?0:255<c?255:c,n}var n={},u=0,s=0,c=0;return e&&t(e),n.toRgb=function(){return{r:u,g:s,b:c}},n.toHsv=function(){return e=u,t=s,n=c,o=0,(i=VN(e/=255,VN(t/=255,n/=255)))===(a=HN(e,HN(t,n)))?{h:0,s:0,v:100*(o=i)}:(r=(a-i)/a,{h:qN(60*((e===i?3:n===i?1:5)-(e===i?t-n:n===i?e-t:n-e)/((o=a)-i))),s:qN(100*r),v:qN(100*o)});var e,t,n,r,o,i,a},n.toHex=function(){function e(e){return 1<(e=parseInt(e,10).toString(16)).length?e:"0"+e}return"#"+e(u)+e(s)+e(c)},n.parse=t,n}},dom:{EventUtils:Se,Sizzle:St,DomQuery:gn,TreeWalker:go,DOMUtils:Si,ScriptLoader:Ri,RangeUtils:RN,Serializer:Eb,ControlSelection:Db,BookmarkManager:_b,Selection:uC,Event:Se.Event},html:{Styles:gi,Entities:ti,Node:sb,Schema:di,SaxParser:Mv,DomParser:bb,Writer:il,Serializer:al},ui:{Factory:MN},Env:fe,AddOnManager:Bi,Annotator:Hc,Formatter:Gy,UndoManager:ry,EditorCommands:pp,WindowManager:yh,NotificationManager:vh,EditorObservable:tE,Shortcuts:Qp,Editor:tN,FocusManager:iN,EditorManager:oE,DOM:Si.DOM,ScriptLoader:Ri.ScriptLoader,PluginManager:Bi.PluginManager,ThemeManager:Bi.ThemeManager,trim:Xt.trim,isArray:Xt.isArray,is:Xt.is,toArray:Xt.toArray,makeMap:Xt.makeMap,each:Xt.each,map:Xt.map,grep:Xt.grep,inArray:Xt.inArray,extend:Xt.extend,create:Xt.create,walk:Xt.walk,createNS:Xt.createNS,resolve:Xt.resolve,explode:Xt.explode,_addCacheSuffix:Xt._addCacheSuffix,isOpera:fe.opera,isWebKit:fe.webkit,isIE:fe.ie,isGecko:fe.gecko,isMac:fe.mac},oE=Xt.extend(oE,tE),tE=oE;window.tinymce=tE,window.tinyMCE=tE,function(e){if("object"==typeof module)try{module.exports=e}catch(t){}}(oE)}(window),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.Handlebars=factory():root.Handlebars=factory()}(this,function(){return modules=[function(module,exports,_handlebarsNoConflict2){"use strict";var _interopRequireDefault=_handlebarsNoConflict2(1).default;exports.__esModule=!0;var inst=_interopRequireDefault(_handlebarsNoConflict2(2)),_handlebarsCompilerAst2=_interopRequireDefault(_handlebarsNoConflict2(45)),_handlebarsCompilerBase=_handlebarsNoConflict2(46),_handlebarsCompilerCompiler=_handlebarsNoConflict2(51),_handlebarsCompilerJavascriptCompiler2=_interopRequireDefault(_handlebarsNoConflict2(52)),_handlebarsCompilerVisitor2=_interopRequireDefault(_handlebarsNoConflict2(49)),_handlebarsNoConflict2=_interopRequireDefault(_handlebarsNoConflict2(44)),_create=inst.default.create;function create(){var hb=_create();return hb.compile=function(input,options){return _handlebarsCompilerCompiler.compile(input,options,hb)},hb.precompile=function(input,options){return _handlebarsCompilerCompiler.precompile(input,options,hb)},hb.AST=_handlebarsCompilerAst2.default,hb.Compiler=_handlebarsCompilerCompiler.Compiler,hb.JavaScriptCompiler=_handlebarsCompilerJavascriptCompiler2.default,hb.Parser=_handlebarsCompilerBase.parser,hb.parse=_handlebarsCompilerBase.parse,hb.parseWithoutProcessing=_handlebarsCompilerBase.parseWithoutProcessing,hb}inst=create();inst.create=create,_handlebarsNoConflict2.default(inst),inst.Visitor=_handlebarsCompilerVisitor2.default,inst.default=inst,exports.default=inst,module.exports=exports.default},function(module,exports){"use strict";exports.default=function(obj){return obj&&obj.__esModule?obj:{default:obj}},exports.__esModule=!0},function(module,exports,inst){"use strict";var _interopRequireWildcard=inst(3).default,_handlebarsNoConflict2=inst(1).default;exports.__esModule=!0;var base=_interopRequireWildcard(inst(4)),_handlebarsSafeString2=_handlebarsNoConflict2(inst(37)),_handlebarsException2=_handlebarsNoConflict2(inst(6)),Utils=_interopRequireWildcard(inst(5)),runtime=_interopRequireWildcard(inst(38)),_handlebarsNoConflict2=_handlebarsNoConflict2(inst(44));function create(){var hb=new base.HandlebarsEnvironment;return Utils.extend(hb,base),hb.SafeString=_handlebarsSafeString2.default,hb.Exception=_handlebarsException2.default,hb.Utils=Utils,hb.escapeExpression=Utils.escapeExpression,hb.VM=runtime,hb.template=function(spec){return runtime.template(spec,hb)},hb}inst=create();inst.create=create,_handlebarsNoConflict2.default(inst),inst.default=inst,exports.default=inst,module.exports=exports.default},function(module,exports){"use strict";exports.default=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj},exports.__esModule=!0},function(module,exports,log){"use strict";var _logger2=log(1).default;exports.__esModule=!0,exports.HandlebarsEnvironment=HandlebarsEnvironment;var _utils=log(5),_exception2=_logger2(log(6)),_helpers=log(10),_decorators=log(30),_logger2=_logger2(log(32)),_internalProtoAccess=log(33);exports.VERSION="4.7.7";exports.COMPILER_REVISION=8;exports.LAST_COMPATIBLE_COMPILER_REVISION=7;exports.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};function HandlebarsEnvironment(helpers,partials,decorators){this.helpers=helpers||{},this.partials=partials||{},this.decorators=decorators||{},_helpers.registerDefaultHelpers(this),_decorators.registerDefaultDecorators(this)}HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:_logger2.default,log:_logger2.default.log,registerHelper:function(name,fn){if("[object Object]"===_utils.toString.call(name)){if(fn)throw new _exception2.default("Arg not supported with multiple helpers");_utils.extend(this.helpers,name)}else this.helpers[name]=fn},unregisterHelper:function(name){delete this.helpers[name]},registerPartial:function(name,partial){if("[object Object]"===_utils.toString.call(name))_utils.extend(this.partials,name);else{if(void 0===partial)throw new _exception2.default('Attempting to register a partial called "'+name+'" as undefined');this.partials[name]=partial}},unregisterPartial:function(name){delete this.partials[name]},registerDecorator:function(name,fn){if("[object Object]"===_utils.toString.call(name)){if(fn)throw new _exception2.default("Arg not supported with multiple decorators");_utils.extend(this.decorators,name)}else this.decorators[name]=fn},unregisterDecorator:function(name){delete this.decorators[name]},resetLoggedPropertyAccesses:function(){_internalProtoAccess.resetLoggedProperties()}};log=_logger2.default.log;exports.log=log,exports.createFrame=_utils.createFrame,exports.logger=_logger2.default},function(module,exports){"use strict";exports.__esModule=!0,exports.extend=extend,exports.indexOf=function(array,value){for(var i=0,len=array.length;i<len;i++)if(array[i]===value)return i;return-1},exports.escapeExpression=function(string){if("string"!=typeof string){if(string&&string.toHTML)return string.toHTML();if(null==string)return"";if(!string)return string+"";string=""+string}return possible.test(string)?string.replace(badChars,escapeChar):string},exports.isEmpty=function(value){return!value&&0!==value||!(!isArray(value)||0!==value.length)},exports.createFrame=function(object){var frame=extend({},object);return frame._parent=object,frame},exports.blockParams=function(params,ids){return params.path=ids,params},exports.appendContextPath=function(contextPath,id){return(contextPath?contextPath+".":"")+id};var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},badChars=/[&<>"'`=]/g,possible=/[&<>"'`=]/;function escapeChar(chr){return escape[chr]}function extend(obj){for(var i=1;i<arguments.length;i++)for(var key in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],key)&&(obj[key]=arguments[i][key]);return obj}var toString=Object.prototype.toString;exports.toString=toString;var isFunction=function(value){return"function"==typeof value};isFunction(/x/)&&(exports.isFunction=isFunction=function(value){return"function"==typeof value&&"[object Function]"===toString.call(value)}),exports.isFunction=isFunction;var isArray=Array.isArray||function(value){return!(!value||"object"!=typeof value)&&"[object Array]"===toString.call(value)};exports.isArray=isArray},function(module,exports,__webpack_require__){"use strict";var _Object$defineProperty=__webpack_require__(7).default;exports.__esModule=!0;var errorProps=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function Exception(message,endColumn){var loc=endColumn&&endColumn.loc,line=void 0,endLineNumber=void 0,column=void 0,endColumn=void 0;loc&&(line=loc.start.line,endLineNumber=loc.end.line,column=loc.start.column,endColumn=loc.end.column,message+=" - "+line+":"+column);for(var tmp=Error.prototype.constructor.call(this,message),idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]];Error.captureStackTrace&&Error.captureStackTrace(this,Exception);try{loc&&(this.lineNumber=line,this.endLineNumber=endLineNumber,_Object$defineProperty?(Object.defineProperty(this,"column",{value:column,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:endColumn,enumerable:!0})):(this.column=column,this.endColumn=endColumn))}catch(nop){}}Exception.prototype=new Error,exports.default=Exception,module.exports=exports.default},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(8),__esModule:!0}},function(module,exports,__webpack_require__){var $=__webpack_require__(9);module.exports=function(it,key,desc){return $.setDesc(it,key,desc)}},function(module,exports){var $Object=Object;module.exports={create:$Object.create,getProto:$Object.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:$Object.getOwnPropertyDescriptor,setDesc:$Object.defineProperty,setDescs:$Object.defineProperties,getKeys:$Object.keys,getNames:$Object.getOwnPropertyNames,getSymbols:$Object.getOwnPropertySymbols,each:[].forEach}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0,exports.registerDefaultHelpers=function(instance){_helpersBlockHelperMissing2.default(instance),_helpersEach2.default(instance),_helpersHelperMissing2.default(instance),_helpersIf2.default(instance),_helpersLog2.default(instance),_helpersLookup2.default(instance),_helpersWith2.default(instance)},exports.moveHelperToHooks=function(instance,helperName,keepHelper){instance.helpers[helperName]&&(instance.hooks[helperName]=instance.helpers[helperName],keepHelper||delete instance.helpers[helperName])};var _helpersBlockHelperMissing2=_interopRequireDefault(__webpack_require__(11)),_helpersEach2=_interopRequireDefault(__webpack_require__(12)),_helpersHelperMissing2=_interopRequireDefault(__webpack_require__(25)),_helpersIf2=_interopRequireDefault(__webpack_require__(26)),_helpersLog2=_interopRequireDefault(__webpack_require__(27)),_helpersLookup2=_interopRequireDefault(__webpack_require__(28)),_helpersWith2=_interopRequireDefault(__webpack_require__(29))},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _utils=__webpack_require__(5);exports.default=function(instance){instance.registerHelper("blockHelperMissing",function(context,options){var data=options.inverse,fn=options.fn;return!0===context?fn(this):!1===context||null==context?data(this):_utils.isArray(context)?0<context.length?(options.ids&&(options.ids=[options.name]),instance.helpers.each(context,options)):data(this):(options.data&&options.ids&&((data=_utils.createFrame(options.data)).contextPath=_utils.appendContextPath(options.data.contextPath,options.name),options={data:data}),fn(context,options))})},module.exports=exports.default},function(module,exports,__webpack_require__){!function(global){"use strict";var _Object$keys=__webpack_require__(13).default,_interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0;var _utils=__webpack_require__(5),_exception2=_interopRequireDefault(__webpack_require__(6));exports.default=function(instance){instance.registerHelper("each",function(context,options){if(!options)throw new _exception2.default("Must pass iterator to #each");var priorKey,fn=options.fn,inverse=options.inverse,i=0,ret="",data=void 0,contextPath=void 0;function execIteration(field,index,last){data&&(data.key=field,data.index=index,data.first=0===index,data.last=!!last,contextPath&&(data.contextPath=contextPath+field)),ret+=fn(context[field],{data:data,blockParams:_utils.blockParams([context[field],field],[contextPath+field,null])})}if(options.data&&options.ids&&(contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])+"."),_utils.isFunction(context)&&(context=context.call(this)),options.data&&(data=_utils.createFrame(options.data)),context&&"object"==typeof context)if(_utils.isArray(context))for(var j=context.length;i<j;i++)i in context&&execIteration(i,i,i===context.length-1);else if(global.Symbol&&context[global.Symbol.iterator]){for(var newContext=[],iterator=context[global.Symbol.iterator](),it=iterator.next();!it.done;it=iterator.next())newContext.push(it.value);for(j=(context=newContext).length;i<j;i++)execIteration(i,i,i===context.length-1)}else priorKey=void 0,_Object$keys(context).forEach(function(key){void 0!==priorKey&&execIteration(priorKey,i-1),priorKey=key,i++}),void 0!==priorKey&&execIteration(priorKey,i-1,!0);return ret=0===i?inverse(this):ret})},module.exports=exports.default}.call(exports,function(){return this}())},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(14),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(15),module.exports=__webpack_require__(21).Object.keys},function(module,exports,__webpack_require__){var toObject=__webpack_require__(16);__webpack_require__(18)("keys",function($keys){return function(it){return $keys(toObject(it))}})},function(module,exports,__webpack_require__){var defined=__webpack_require__(17);module.exports=function(it){return Object(defined(it))}},function(module,exports){module.exports=function(it){if(null==it)throw TypeError("Can't call method on  "+it);return it}},function(module,exports,__webpack_require__){var $export=__webpack_require__(19),core=__webpack_require__(21),fails=__webpack_require__(24);module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn),$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}},function(module,exports,__webpack_require__){function $export(type,name,source){var key,own,out,IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,IS_WRAP=type&$export.W,exports=IS_GLOBAL?core:core[name]||(core[name]={}),target=IS_GLOBAL?global:IS_STATIC?global[name]:(global[name]||{}).prototype;for(key in source=IS_GLOBAL?name:source)(own=!IS_FORCED&&target&&key in target)&&key in exports||(out=(own?target:source)[key],exports[key]=IS_GLOBAL&&"function"!=typeof target[key]?source[key]:IS_BIND&&own?ctx(out,global):IS_WRAP&&target[key]==out?function(C){function F(param){return this instanceof C?new C(param):C(param)}return F.prototype=C.prototype,F}(out):IS_PROTO&&"function"==typeof out?ctx(Function.call,out):out,IS_PROTO&&((exports.prototype||(exports.prototype={}))[key]=out))}var global=__webpack_require__(20),core=__webpack_require__(21),ctx=__webpack_require__(22);$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,module.exports=$export},function(global,exports){global=global.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global)},function(core,exports){core=core.exports={version:"1.2.6"};"number"==typeof __e&&(__e=core)},function(module,exports,__webpack_require__){var aFunction=__webpack_require__(23);module.exports=function(fn,that,length){if(aFunction(fn),void 0===that)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},function(module,exports){module.exports=function(it){if("function"!=typeof it)throw TypeError(it+" is not a function!");return it}},function(module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return!0}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0;var _exception2=_interopRequireDefault(__webpack_require__(6));exports.default=function(instance){instance.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new _exception2.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0;var _utils=__webpack_require__(5),_exception2=_interopRequireDefault(__webpack_require__(6));exports.default=function(instance){instance.registerHelper("if",function(conditional,options){if(2!=arguments.length)throw new _exception2.default("#if requires exactly one argument");return _utils.isFunction(conditional)&&(conditional=conditional.call(this)),!options.hash.includeZero&&!conditional||_utils.isEmpty(conditional)?options.inverse(this):options.fn(this)}),instance.registerHelper("unless",function(conditional,options){if(2!=arguments.length)throw new _exception2.default("#unless requires exactly one argument");return instance.helpers.if.call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash})})},module.exports=exports.default},function(module,exports){"use strict";exports.__esModule=!0,exports.default=function(instance){instance.registerHelper("log",function(){for(var args=[void 0],options=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)args.push(arguments[i]);var level=1;null!=options.hash.level?level=options.hash.level:options.data&&null!=options.data.level&&(level=options.data.level),args[0]=level,instance.log.apply(instance,args)})},module.exports=exports.default},function(module,exports){"use strict";exports.__esModule=!0,exports.default=function(instance){instance.registerHelper("lookup",function(obj,field,options){return obj&&options.lookupProperty(obj,field)})},module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0;var _utils=__webpack_require__(5),_exception2=_interopRequireDefault(__webpack_require__(6));exports.default=function(instance){instance.registerHelper("with",function(context,options){if(2!=arguments.length)throw new _exception2.default("#with requires exactly one argument");_utils.isFunction(context)&&(context=context.call(this));var fn=options.fn;if(_utils.isEmpty(context))return options.inverse(this);var data=options.data;return options.data&&options.ids&&((data=_utils.createFrame(options.data)).contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])),fn(context,{data:data,blockParams:_utils.blockParams([context],[data&&data.contextPath])})})},module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0,exports.registerDefaultDecorators=function(instance){_decoratorsInline2.default(instance)};var _decoratorsInline2=_interopRequireDefault(__webpack_require__(31))},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _utils=__webpack_require__(5);exports.default=function(instance){instance.registerDecorator("inline",function(fn,props,container,options){var ret=fn;return props.partials||(props.partials={},ret=function(context,ret){var original=container.partials;container.partials=_utils.extend({},original,props.partials);ret=fn(context,ret);return container.partials=original,ret}),props.partials[options.args[0]]=options.fn,ret})},module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _utils=__webpack_require__(5),logger={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(level){var levelMap;return level="string"==typeof level?0<=(levelMap=_utils.indexOf(logger.methodMap,level.toLowerCase()))?levelMap:parseInt(level,10):level},log:function(method){if(method=logger.lookupLevel(method),"undefined"!=typeof console&&logger.lookupLevel(logger.level)<=method){method=logger.methodMap[method];console[method]||(method="log");for(var _len=arguments.length,message=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)message[_key-1]=arguments[_key];console[method].apply(console,message)}}};exports.default=logger,module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _Object$create=__webpack_require__(34).default,_Object$keys=__webpack_require__(13).default,_interopRequireWildcard=__webpack_require__(3).default;exports.__esModule=!0,exports.createProtoAccessControl=function(runtimeOptions){var defaultMethodWhiteList=_Object$create(null);defaultMethodWhiteList.constructor=!1,defaultMethodWhiteList.__defineGetter__=!1,defaultMethodWhiteList.__defineSetter__=!1,defaultMethodWhiteList.__lookupGetter__=!1;var defaultPropertyWhiteList=_Object$create(null);return defaultPropertyWhiteList.__proto__=!1,{properties:{whitelist:_createNewLookupObject.createNewLookupObject(defaultPropertyWhiteList,runtimeOptions.allowedProtoProperties),defaultValue:runtimeOptions.allowProtoPropertiesByDefault},methods:{whitelist:_createNewLookupObject.createNewLookupObject(defaultMethodWhiteList,runtimeOptions.allowedProtoMethods),defaultValue:runtimeOptions.allowProtoMethodsByDefault}}},exports.resultIsAllowed=function(result,protoAccessControl,propertyName){return checkWhiteList("function"==typeof result?protoAccessControl.methods:protoAccessControl.properties,propertyName)},exports.resetLoggedProperties=function(){_Object$keys(loggedProperties).forEach(function(propertyName){delete loggedProperties[propertyName]})};var _createNewLookupObject=__webpack_require__(36),logger=_interopRequireWildcard(__webpack_require__(32)),loggedProperties=_Object$create(null);function checkWhiteList(protoAccessControlForType,propertyName){return void 0!==protoAccessControlForType.whitelist[propertyName]?!0===protoAccessControlForType.whitelist[propertyName]:void 0!==protoAccessControlForType.defaultValue?protoAccessControlForType.defaultValue:(function(propertyName){!0!==loggedProperties[propertyName]&&(loggedProperties[propertyName]=!0,logger.log("error",'Handlebars: Access has been denied to resolve the property "'+propertyName+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(propertyName),!1)}},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(35),__esModule:!0}},function(module,exports,__webpack_require__){var $=__webpack_require__(9);module.exports=function(P,D){return $.create(P,D)}},function(module,exports,__webpack_require__){"use strict";var _Object$create=__webpack_require__(34).default;exports.__esModule=!0,exports.createNewLookupObject=function(){for(var _len=arguments.length,sources=Array(_len),_key=0;_key<_len;_key++)sources[_key]=arguments[_key];return _utils.extend.apply(void 0,[_Object$create(null)].concat(sources))};var _utils=__webpack_require__(5)},function(module,exports){"use strict";function SafeString(string){this.string=string}exports.__esModule=!0,SafeString.prototype.toString=SafeString.prototype.toHTML=function(){return""+this.string},exports.default=SafeString,module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _Object$seal=__webpack_require__(39).default,_Object$keys=__webpack_require__(13).default,_interopRequireWildcard=__webpack_require__(3).default,_interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0,exports.checkRevision=function(compilerInfo){var compilerVersions=compilerInfo&&compilerInfo[0]||1,runtimeVersions=_base.COMPILER_REVISION;if(!(compilerVersions>=_base.LAST_COMPATIBLE_COMPILER_REVISION&&compilerVersions<=_base.COMPILER_REVISION)){if(compilerVersions<_base.LAST_COMPATIBLE_COMPILER_REVISION){runtimeVersions=_base.REVISION_CHANGES[runtimeVersions],compilerVersions=_base.REVISION_CHANGES[compilerVersions];throw new _exception2.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").")}throw new _exception2.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+compilerInfo[1]+").")}},exports.template=function(templateSpec,env){if(!env)throw new _exception2.default("No environment passed to template");if(!templateSpec||!templateSpec.main)throw new _exception2.default("Unknown template object: "+typeof templateSpec);templateSpec.main.decorator=templateSpec.main_d,env.VM.checkRevision(templateSpec.compiler);var templateWasPrecompiledWithCompilerV7=templateSpec.compiler&&7===templateSpec.compiler[0];var container={strict:function(obj,name,loc){if(!(obj&&name in obj))throw new _exception2.default('"'+name+'" not defined in '+obj,{loc:loc});return container.lookupProperty(obj,name)},lookupProperty:function(parent,propertyName){var result=parent[propertyName];return null==result||Object.prototype.hasOwnProperty.call(parent,propertyName)||_internalProtoAccess.resultIsAllowed(result,container.protoAccessControl,propertyName)?result:void 0},lookup:function(depths,name){for(var len=depths.length,i=0;i<len;i++)if(null!=(depths[i]&&container.lookupProperty(depths[i],name)))return depths[i][name]},lambda:function(current,context){return"function"==typeof current?current.call(context):current},escapeExpression:Utils.escapeExpression,invokePartial:function(partial,context,options){options.hash&&(context=Utils.extend({},context,options.hash),options.ids&&(options.ids[0]=!0)),partial=env.VM.resolvePartial.call(this,partial,context,options);var extendedOptions=Utils.extend({},options,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),result=env.VM.invokePartial.call(this,partial,context,extendedOptions);if(null==result&&env.compile&&(options.partials[options.name]=env.compile(partial,templateSpec.compilerOptions,env),result=options.partials[options.name](context,extendedOptions)),null==result)throw new _exception2.default("The partial "+options.name+" could not be compiled when running in runtime-only mode");if(options.indent){for(var lines=result.split("\n"),i=0,l=lines.length;i<l&&(lines[i]||i+1!==l);i++)lines[i]=options.indent+lines[i];result=lines.join("\n")}return result},fn:function(i){var ret=templateSpec[i];return ret.decorator=templateSpec[i+"_d"],ret},programs:[],program:function(i,data,declaredBlockParams,blockParams,depths){var programWrapper=this.programs[i],fn=this.fn(i);return programWrapper=data||depths||blockParams||declaredBlockParams?wrapProgram(this,i,fn,data,declaredBlockParams,blockParams,depths):programWrapper||(this.programs[i]=wrapProgram(this,i,fn))},data:function(value,depth){for(;value&&depth--;)value=value._parent;return value},mergeIfNeeded:function(param,common){var obj=param||common;return obj=param&&common&&param!==common?Utils.extend({},common,param):obj},nullContext:_Object$seal({}),noop:env.VM.noop,compilerInfo:templateSpec.compiler};function ret(context){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],data=options.data;ret._setup(options),!options.partial&&templateSpec.useData&&(data=function(context,data){data&&"root"in data||((data=data?_base.createFrame(data):{}).root=context);return data}(context,data));var depths=void 0,blockParams=templateSpec.useBlockParams?[]:void 0;function main(context){return""+templateSpec.main(container,context,container.helpers,container.partials,data,blockParams,depths)}return templateSpec.useDepths&&(depths=options.depths?context!=options.depths[0]?[context].concat(options.depths):options.depths:[context]),(main=executeDecorators(templateSpec.main,main,container,options.depths||[],data,blockParams))(context,options)}return ret.isTop=!0,ret._setup=function(keepHelperInHelpers){var mergedHelpers;keepHelperInHelpers.partial?(container.protoAccessControl=keepHelperInHelpers.protoAccessControl,container.helpers=keepHelperInHelpers.helpers,container.partials=keepHelperInHelpers.partials,container.decorators=keepHelperInHelpers.decorators,container.hooks=keepHelperInHelpers.hooks):(function(mergedHelpers,container){_Object$keys(mergedHelpers).forEach(function(helperName){var helper=mergedHelpers[helperName];mergedHelpers[helperName]=function(helper,container){var lookupProperty=container.lookupProperty;return _internalWrapHelper.wrapHelper(helper,function(options){return Utils.extend({lookupProperty:lookupProperty},options)})}(helper,container)})}(mergedHelpers=Utils.extend({},env.helpers,keepHelperInHelpers.helpers),container),container.helpers=mergedHelpers,templateSpec.usePartial&&(container.partials=container.mergeIfNeeded(keepHelperInHelpers.partials,env.partials)),(templateSpec.usePartial||templateSpec.useDecorators)&&(container.decorators=Utils.extend({},env.decorators,keepHelperInHelpers.decorators)),container.hooks={},container.protoAccessControl=_internalProtoAccess.createProtoAccessControl(keepHelperInHelpers),keepHelperInHelpers=keepHelperInHelpers.allowCallsToHelperMissing||templateWasPrecompiledWithCompilerV7,_helpers.moveHelperToHooks(container,"helperMissing",keepHelperInHelpers),_helpers.moveHelperToHooks(container,"blockHelperMissing",keepHelperInHelpers))},ret._child=function(i,data,blockParams,depths){if(templateSpec.useBlockParams&&!blockParams)throw new _exception2.default("must pass block params");if(templateSpec.useDepths&&!depths)throw new _exception2.default("must pass parent depths");return wrapProgram(container,i,templateSpec[i],data,0,blockParams,depths)},ret},exports.wrapProgram=wrapProgram,exports.resolvePartial=function(partial,context,options){partial?partial.call||options.name||(options.name=partial,partial=options.partials[partial]):partial="@partial-block"===options.name?options.data["partial-block"]:options.partials[options.name];return partial},exports.invokePartial=function(partial,context,options){var currentPartialBlock=options.data&&options.data["partial-block"];options.partial=!0,options.ids&&(options.data.contextPath=options.ids[0]||options.data.contextPath);var partialBlock=void 0;options.fn&&options.fn!==noop&&function(){options.data=_base.createFrame(options.data);var fn=options.fn;partialBlock=options.data["partial-block"]=function(context){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return options.data=_base.createFrame(options.data),options.data["partial-block"]=currentPartialBlock,fn(context,options)},fn.partials&&(options.partials=Utils.extend({},options.partials,fn.partials))}();void 0===partial&&partialBlock&&(partial=partialBlock);{if(void 0===partial)throw new _exception2.default("The partial "+options.name+" could not be found");if(partial instanceof Function)return partial(context,options)}},exports.noop=noop;var Utils=_interopRequireWildcard(__webpack_require__(5)),_exception2=_interopRequireDefault(__webpack_require__(6)),_base=__webpack_require__(4),_helpers=__webpack_require__(10),_internalWrapHelper=__webpack_require__(43),_internalProtoAccess=__webpack_require__(33);function wrapProgram(container,i,fn,data,declaredBlockParams,blockParams,depths){function prog(context){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],currentDepths=depths;return!depths||context==depths[0]||context===container.nullContext&&null===depths[0]||(currentDepths=[context].concat(depths)),fn(container,context,container.helpers,container.partials,options.data||data,blockParams&&[options.blockParams].concat(blockParams),currentDepths)}return(prog=executeDecorators(fn,prog,container,depths,data,blockParams)).program=i,prog.depth=depths?depths.length:0,prog.blockParams=declaredBlockParams||0,prog}function noop(){return""}function executeDecorators(props,prog,container,depths,data,blockParams){return props.decorator&&(prog=props.decorator(prog,props={},container,depths&&depths[0],data,blockParams,depths),Utils.extend(prog,props)),prog}},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(40),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(41),module.exports=__webpack_require__(21).Object.seal},function(module,exports,__webpack_require__){var isObject=__webpack_require__(42);__webpack_require__(18)("seal",function($seal){return function(it){return $seal&&isObject(it)?$seal(it):it}})},function(module,exports){module.exports=function(it){return"object"==typeof it?null!==it:"function"==typeof it}},function(module,exports){"use strict";exports.__esModule=!0,exports.wrapHelper=function(helper,transformOptionsFn){return"function"==typeof helper?function(){var options=arguments[arguments.length-1];return arguments[arguments.length-1]=transformOptionsFn(options),helper.apply(this,arguments)}:helper}},function(module,exports){!function(global){"use strict";exports.__esModule=!0,exports.default=function(Handlebars){var root=void 0!==global?global:window,$Handlebars=root.Handlebars;Handlebars.noConflict=function(){return root.Handlebars===Handlebars&&(root.Handlebars=$Handlebars),Handlebars}},module.exports=exports.default}.call(exports,function(){return this}())},function(module,exports){"use strict";exports.__esModule=!0;var AST={helpers:{helperExpression:function(node){return"SubExpression"===node.type||("MustacheStatement"===node.type||"BlockStatement"===node.type)&&!!(node.params&&node.params.length||node.hash)},scopedId:function(path){return/^\.|this\b/.test(path.original)},simpleId:function(path){return 1===path.parts.length&&!AST.helpers.scopedId(path)&&!path.depth}}};exports.default=AST,module.exports=exports.default},function(module,exports,_utils){"use strict";var _interopRequireDefault=_utils(1).default,Helpers=_utils(3).default;exports.__esModule=!0,exports.parseWithoutProcessing=parseWithoutProcessing,exports.parse=function(ast,options){ast=parseWithoutProcessing(ast,options);return new _whitespaceControl2.default(options).accept(ast)};var _parser2=_interopRequireDefault(_utils(47)),_whitespaceControl2=_interopRequireDefault(_utils(48)),Helpers=Helpers(_utils(50)),_utils=_utils(5);exports.parser=_parser2.default;var yy={};function parseWithoutProcessing(input,options){return"Program"===input.type?input:((_parser2.default.yy=yy).locInfo=function(locInfo){return new yy.SourceLocation(options&&options.srcName,locInfo)},_parser2.default.parse(input))}_utils.extend(yy,Helpers)},function(module,exports){"use strict";exports.__esModule=!0;var handlebars,lexer,handlebars=(lexer=function(){var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input){return this._input=input,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];return this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch,ch.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(r){var len=r.length,lines=r.split(/(?:\r\n?|\n)/g);this._input=r+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len-1),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this},more:function(){return this._more=!0,this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(20<past.length?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(20<next.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;var match,tempMatch,index,token;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length&&(!(tempMatch=this._input.match(this.rules[rules[i]]))||match&&!(tempMatch[0].length>match[0].length)||(match=tempMatch,index=i,this.options.flex));i++);return match?((token=match[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=token.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:token?token[token.length-1].length-token[token.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return void 0!==r?r:this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(condition){this.begin(condition)},options:{},performAction:function(yy,yy_,$avoiding_name_collisions,YY_START){function strip(start,end){return yy_.yytext=yy_.yytext.substring(start,yy_.yyleng-end+start)}switch($avoiding_name_collisions){case 0:if("\\\\"===yy_.yytext.slice(-2)?(strip(0,1),this.begin("mu")):"\\"===yy_.yytext.slice(-1)?(strip(0,1),this.begin("emu")):this.begin("mu"),yy_.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(strip(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(yy_.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return yy_.yytext=strip(1,2).replace(/\\"/g,'"'),80;case 32:return yy_.yytext=strip(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return yy_.yytext=yy_.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}}};return lexer}(),(handlebars={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];case 2:this.$=yy.prepareProgram($$[$0]);break;case 3:case 4:case 5:case 6:case 7:case 8:this.$=$$[$0];break;case 9:this.$={type:"CommentStatement",value:yy.stripComment($$[$0]),strip:yy.stripFlags($$[$0],$$[$0]),loc:yy.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:$$[$0],value:$$[$0],loc:yy.locInfo(this._$)};break;case 11:this.$=yy.prepareRawBlock($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 12:this.$={path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1]};break;case 13:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],!1,this._$);break;case 14:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],!0,this._$);break;case 15:this.$={open:$$[$0-5],path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 16:case 17:this.$={path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 18:this.$={strip:yy.stripFlags($$[$0-1],$$[$0-1]),program:$$[$0]};break;case 19:var program=yy.prepareBlock($$[$0-2],$$[$0-1],$$[$0],$$[$0],!1,this._$),program=yy.prepareProgram([program],$$[$0-1].loc);program.chained=!0,this.$={strip:$$[$0-2].strip,program:program,chain:!0};break;case 20:this.$=$$[$0];break;case 21:this.$={path:$$[$0-1],strip:yy.stripFlags($$[$0-2],$$[$0])};break;case 22:case 23:this.$=yy.prepareMustache($$[$0-3],$$[$0-2],$$[$0-1],$$[$0-4],yy.stripFlags($$[$0-4],$$[$0]),this._$);break;case 24:this.$={type:"PartialStatement",name:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],indent:"",strip:yy.stripFlags($$[$0-4],$$[$0]),loc:yy.locInfo(this._$)};break;case 25:this.$=yy.preparePartialBlock($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 26:this.$={path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],strip:yy.stripFlags($$[$0-4],$$[$0])};break;case 27:case 28:this.$=$$[$0];break;case 29:this.$={type:"SubExpression",path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],loc:yy.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:$$[$0],loc:yy.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:yy.id($$[$0-2]),value:$$[$0],loc:yy.locInfo(this._$)};break;case 32:this.$=yy.id($$[$0-1]);break;case 33:case 34:this.$=$$[$0];break;case 35:this.$={type:"StringLiteral",value:$$[$0],original:$$[$0],loc:yy.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number($$[$0]),original:Number($$[$0]),loc:yy.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===$$[$0],original:"true"===$$[$0],loc:yy.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:yy.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:yy.locInfo(this._$)};break;case 40:case 41:this.$=$$[$0];break;case 42:this.$=yy.preparePath(!0,$$[$0],this._$);break;case 43:this.$=yy.preparePath(!1,$$[$0],this._$);break;case 44:$$[$0-2].push({part:yy.id($$[$0]),original:$$[$0],separator:$$[$0-1]}),this.$=$$[$0-2];break;case 45:this.$=[{part:yy.id($$[$0]),original:$$[$0]}];break;case 46:this.$=[];break;case 47:$$[$0-1].push($$[$0]);break;case 48:this.$=[];break;case 49:$$[$0-1].push($$[$0]);break;case 50:this.$=[];break;case 51:$$[$0-1].push($$[$0]);break;case 58:this.$=[];break;case 59:$$[$0-1].push($$[$0]);break;case 64:this.$=[];break;case 65:$$[$0-1].push($$[$0]);break;case 70:this.$=[];break;case 71:$$[$0-1].push($$[$0]);break;case 78:this.$=[];break;case 79:$$[$0-1].push($$[$0]);break;case 82:this.$=[];break;case 83:$$[$0-1].push($$[$0]);break;case 86:this.$=[];break;case 87:$$[$0-1].push($$[$0]);break;case 90:this.$=[];break;case 91:$$[$0-1].push($$[$0]);break;case 94:this.$=[];break;case 95:$$[$0-1].push($$[$0]);break;case 98:this.$=[$$[$0]];break;case 99:$$[$0-1].push($$[$0]);break;case 100:this.$=[$$[$0]];break;case 101:$$[$0-1].push($$[$0])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(str,hash){throw new Error(str)},parse:function(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0;this.lexer.setInput(input),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===(this.yy.parser=this).lexer.yylloc&&(this.lexer.yylloc={});var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var symbol,preErrorSymbol,state,action,r,p,newState,expected,token,yyval={};;){if(state=stack[stack.length-1],void 0===(action=this.defaultActions[state]||(null==symbol&&(token=void 0,symbol=token="number"!=typeof(token=self.lexer.lex()||1)&&self.symbols_[token]||token),table[state]&&table[state][symbol]))||!action.length||!action[0]){var errStr="";if(!recovering){for(p in expected=[],table[state])this.terminals_[p]&&2<p&&expected.push("'"+this.terminals_[p]+"'");errStr=this.lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&1<action.length)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(this.lexer.yytext),lstack.push(this.lexer.yylloc),stack.push(action[1]),symbol=null,preErrorSymbol?(symbol=preErrorSymbol,preErrorSymbol=null):(yyleng=this.lexer.yyleng,yytext=this.lexer.yytext,yylineno=this.lexer.yylineno,yyloc=this.lexer.yylloc,0<recovering&&recovering--);break;case 2:if(newState=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-newState],yyval._$={first_line:lstack[lstack.length-(newState||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(newState||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(newState||1)].range[0],lstack[lstack.length-1].range[1]]),void 0!==(r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack)))return r;newState&&(stack=stack.slice(0,-1*newState*2),vstack=vstack.slice(0,-1*newState),lstack=lstack.slice(0,-1*newState)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}}).lexer=lexer,new((Parser.prototype=handlebars).Parser=Parser));function Parser(){this.yy={}}exports.default=handlebars,module.exports=exports.default},function(module,exports,_visitor2){"use strict";var _interopRequireDefault=_visitor2(1).default;exports.__esModule=!0;_visitor2=_interopRequireDefault(_visitor2(49));function WhitespaceControl(){this.options=arguments.length<=0||void 0===arguments[0]?{}:arguments[0]}function isPrevWhitespace(body,sibling,isRoot){var prev=body[(sibling=void 0===sibling?body.length:sibling)-1],sibling=body[sibling-2];return prev?"ContentStatement"===prev.type?(sibling||!isRoot?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(prev.original):void 0:isRoot}function isNextWhitespace(body,sibling,isRoot){var next=body[(sibling=void 0===sibling?-1:sibling)+1],sibling=body[sibling+2];return next?"ContentStatement"===next.type?(sibling||!isRoot?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(next.original):void 0:isRoot}function omitRight(current,original,multiple){current=current[null==original?0:original+1];!current||"ContentStatement"!==current.type||!multiple&&current.rightStripped||(original=current.value,current.value=current.value.replace(multiple?/^\s+/:/^[ \t]*\r?\n?/,""),current.rightStripped=current.value!==original)}function omitLeft(current,original,multiple){current=current[null==original?current.length-1:original-1];if(current&&"ContentStatement"===current.type&&(multiple||!current.leftStripped)){original=current.value;return current.value=current.value.replace(multiple?/\s+$/:/[ \t]+$/,""),current.leftStripped=current.value!==original,current.leftStripped}}(WhitespaceControl.prototype=new _visitor2.default).Program=function(program){var doStandalone=!this.options.ignoreStandalone,isRoot=!this.isRootSeen;this.isRootSeen=!0;for(var body=program.body,i=0,l=body.length;i<l;i++){var _isPrevWhitespace,openStandalone,closeStandalone,inlineStandalone,current=body[i],strip=this.accept(current);strip&&(_isPrevWhitespace=isPrevWhitespace(body,i,isRoot),inlineStandalone=isNextWhitespace(body,i,isRoot),openStandalone=strip.openStandalone&&_isPrevWhitespace,closeStandalone=strip.closeStandalone&&inlineStandalone,inlineStandalone=strip.inlineStandalone&&_isPrevWhitespace&&inlineStandalone,strip.close&&omitRight(body,i,!0),strip.open&&omitLeft(body,i,!0),doStandalone&&inlineStandalone&&(omitRight(body,i),omitLeft(body,i)&&"PartialStatement"===current.type&&(current.indent=/([ \t]+$)/.exec(body[i-1].original)[1])),doStandalone&&openStandalone&&(omitRight((current.program||current.inverse).body),omitLeft(body,i)),doStandalone&&closeStandalone&&(omitRight(body,i),omitLeft((current.inverse||current.program).body)))}return program},WhitespaceControl.prototype.BlockStatement=WhitespaceControl.prototype.DecoratorBlock=WhitespaceControl.prototype.PartialBlockStatement=function(block){this.accept(block.program),this.accept(block.inverse);var program=block.program||block.inverse,inverseStrip=block.program&&block.inverse,firstInverse=inverseStrip,lastInverse=inverseStrip;if(inverseStrip&&inverseStrip.chained)for(firstInverse=inverseStrip.body[0].program;lastInverse.chained;)lastInverse=lastInverse.body[lastInverse.body.length-1].program;var strip={open:block.openStrip.open,close:block.closeStrip.close,openStandalone:isNextWhitespace(program.body),closeStandalone:isPrevWhitespace((firstInverse||program).body)};return block.openStrip.close&&omitRight(program.body,null,!0),inverseStrip?((inverseStrip=block.inverseStrip).open&&omitLeft(program.body,null,!0),inverseStrip.close&&omitRight(firstInverse.body,null,!0),block.closeStrip.open&&omitLeft(lastInverse.body,null,!0),!this.options.ignoreStandalone&&isPrevWhitespace(program.body)&&isNextWhitespace(firstInverse.body)&&(omitLeft(program.body),omitRight(firstInverse.body))):block.closeStrip.open&&omitLeft(program.body,null,!0),strip},WhitespaceControl.prototype.Decorator=WhitespaceControl.prototype.MustacheStatement=function(mustache){return mustache.strip},WhitespaceControl.prototype.PartialStatement=WhitespaceControl.prototype.CommentStatement=function(strip){strip=strip.strip||{};return{inlineStandalone:!0,open:strip.open,close:strip.close}},exports.default=WhitespaceControl,module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0;var _exception2=_interopRequireDefault(__webpack_require__(6));function Visitor(){this.parents=[]}function visitSubExpression(mustache){this.acceptRequired(mustache,"path"),this.acceptArray(mustache.params),this.acceptKey(mustache,"hash")}function visitBlock(block){visitSubExpression.call(this,block),this.acceptKey(block,"program"),this.acceptKey(block,"inverse")}function visitPartial(partial){this.acceptRequired(partial,"name"),this.acceptArray(partial.params),this.acceptKey(partial,"hash")}Visitor.prototype={constructor:Visitor,mutating:!1,acceptKey:function(node,name){var value=this.accept(node[name]);if(this.mutating){if(value&&!Visitor.prototype[value.type])throw new _exception2.default('Unexpected node type "'+value.type+'" found when accepting '+name+" on "+node.type);node[name]=value}},acceptRequired:function(node,name){if(this.acceptKey(node,name),!node[name])throw new _exception2.default(node.type+" requires "+name)},acceptArray:function(array){for(var i=0,l=array.length;i<l;i++)this.acceptKey(array,i),array[i]||(array.splice(i,1),i--,l--)},accept:function(object){if(object){if(!this[object.type])throw new _exception2.default("Unknown type: "+object.type,object);this.current&&this.parents.unshift(this.current),this.current=object;var ret=this[object.type](object);return this.current=this.parents.shift(),!this.mutating||ret?ret:!1!==ret?object:void 0}},Program:function(program){this.acceptArray(program.body)},MustacheStatement:visitSubExpression,Decorator:visitSubExpression,BlockStatement:visitBlock,DecoratorBlock:visitBlock,PartialStatement:visitPartial,PartialBlockStatement:function(partial){visitPartial.call(this,partial),this.acceptKey(partial,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:visitSubExpression,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(hash){this.acceptArray(hash.pairs)},HashPair:function(pair){this.acceptRequired(pair,"value")}},exports.default=Visitor,module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0,exports.SourceLocation=function(source,locInfo){this.source=source,this.start={line:locInfo.first_line,column:locInfo.first_column},this.end={line:locInfo.last_line,column:locInfo.last_column}},exports.id=function(token){return/^\[.*\]$/.test(token)?token.substring(1,token.length-1):token},exports.stripFlags=function(open,close){return{open:"~"===open.charAt(2),close:"~"===close.charAt(close.length-3)}},exports.stripComment=function(comment){return comment.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")},exports.preparePath=function(data,parts,loc){loc=this.locInfo(loc);for(var original=data?"@":"",dig=[],depth=0,i=0,l=parts.length;i<l;i++){var part=parts[i].part,isLiteral=parts[i].original!==part;if(original+=(parts[i].separator||"")+part,isLiteral||".."!==part&&"."!==part&&"this"!==part)dig.push(part);else{if(0<dig.length)throw new _exception2.default("Invalid path: "+original,{loc:loc});".."===part&&depth++}}return{type:"PathExpression",data:data,depth:depth,parts:dig,original:original,loc:loc}},exports.prepareMustache=function(path,params,hash,open,strip,locInfo){var escaped=open.charAt(3)||open.charAt(2),escaped="{"!==escaped&&"&"!==escaped;return{type:/\*/.test(open)?"Decorator":"MustacheStatement",path:path,params:params,hash:hash,escaped:escaped,strip:strip,loc:this.locInfo(locInfo)}},exports.prepareRawBlock=function(openRawBlock,program,close,locInfo){validateClose(openRawBlock,close),locInfo=this.locInfo(locInfo);program={type:"Program",body:program,strip:{},loc:locInfo};return{type:"BlockStatement",path:openRawBlock.path,params:openRawBlock.params,hash:openRawBlock.hash,program:program,openStrip:{},inverseStrip:{},closeStrip:{},loc:locInfo}},exports.prepareBlock=function(openBlock,program,inverseAndProgram,close,inverted,locInfo){close&&close.path&&validateClose(openBlock,close);var decorator=/\*/.test(openBlock.open);program.blockParams=openBlock.blockParams;var inverse=void 0,inverseStrip=void 0;if(inverseAndProgram){if(decorator)throw new _exception2.default("Unexpected inverse block on decorator",inverseAndProgram);inverseAndProgram.chain&&(inverseAndProgram.program.body[0].closeStrip=close.strip),inverseStrip=inverseAndProgram.strip,inverse=inverseAndProgram.program}inverted&&(inverted=inverse,inverse=program,program=inverted);return{type:decorator?"DecoratorBlock":"BlockStatement",path:openBlock.path,params:openBlock.params,hash:openBlock.hash,program:program,inverse:inverse,openStrip:openBlock.strip,inverseStrip:inverseStrip,closeStrip:close&&close.strip,loc:this.locInfo(locInfo)}},exports.prepareProgram=function(statements,loc){{var firstLoc,lastLoc;!loc&&statements.length&&(firstLoc=statements[0].loc,lastLoc=statements[statements.length-1].loc,firstLoc&&lastLoc&&(loc={source:firstLoc.source,start:{line:firstLoc.start.line,column:firstLoc.start.column},end:{line:lastLoc.end.line,column:lastLoc.end.column}}))}return{type:"Program",body:statements,strip:{},loc:loc}},exports.preparePartialBlock=function(open,program,close,locInfo){return validateClose(open,close),{type:"PartialBlockStatement",name:open.path,params:open.params,hash:open.hash,program:program,openStrip:open.strip,closeStrip:close&&close.strip,loc:this.locInfo(locInfo)}};var _exception2=_interopRequireDefault(__webpack_require__(6));function validateClose(open,close){if(close=close.path?close.path.original:close,open.path.original!==close){var errorNode={loc:open.path.loc};throw new _exception2.default(open.path.original+" doesn't match "+close,errorNode)}}},function(module,exports,__webpack_require__){"use strict";var _Object$create=__webpack_require__(34).default,_interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0,exports.Compiler=Compiler,exports.precompile=function(environment,options,env){if(null==environment||"string"!=typeof environment&&"Program"!==environment.type)throw new _exception2.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+environment);"data"in(options=options||{})||(options.data=!0);options.compat&&(options.useDepths=!0);environment=env.parse(environment,options),environment=(new env.Compiler).compile(environment,options);return(new env.JavaScriptCompiler).compile(environment,options)},exports.compile=function(input,options,env){void 0===options&&(options={});if(null==input||"string"!=typeof input&&"Program"!==input.type)throw new _exception2.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);"data"in(options=_utils.extend({},options))||(options.data=!0);options.compat&&(options.useDepths=!0);var compiled=void 0;function compileInput(){var templateSpec=env.parse(input,options),templateSpec=(new env.Compiler).compile(templateSpec,options),templateSpec=(new env.JavaScriptCompiler).compile(templateSpec,options,void 0,!0);return env.template(templateSpec)}function ret(context,execOptions){return(compiled=compiled||compileInput()).call(this,context,execOptions)}return ret._setup=function(setupOptions){return(compiled=compiled||compileInput())._setup(setupOptions)},ret._child=function(i,data,blockParams,depths){return(compiled=compiled||compileInput())._child(i,data,blockParams,depths)},ret};var _exception2=_interopRequireDefault(__webpack_require__(6)),_utils=__webpack_require__(5),_ast2=_interopRequireDefault(__webpack_require__(45)),slice=[].slice;function Compiler(){}function transformLiteralToPath(sexpr){var literal;sexpr.path.parts||(literal=sexpr.path,sexpr.path={type:"PathExpression",data:!1,depth:0,parts:[literal.original+""],original:literal.original+"",loc:literal.loc})}Compiler.prototype={compiler:Compiler,equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len)return!1;for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||!function argEquals(a,b){if(a===b)return!0;if(_utils.isArray(a)&&_utils.isArray(b)&&a.length===b.length){for(var i=0;i<a.length;i++)if(!argEquals(a[i],b[i]))return!1;return!0}}(opcode.args,otherOpcode.args))return!1}for(len=this.children.length,i=0;i<len;i++)if(!this.children[i].equals(other.children[i]))return!1;return!0},guid:0,compile:function(program,options){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=options,this.stringParams=options.stringParams,this.trackIds=options.trackIds,options.blockParams=options.blockParams||[],options.knownHelpers=_utils.extend(_Object$create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},options.knownHelpers),this.accept(program)},compileProgram:function(guid){var result=(new this.compiler).compile(guid,this.options),guid=this.guid++;return this.usePartial=this.usePartial||result.usePartial,this.children[guid]=result,this.useDepths=this.useDepths||result.useDepths,guid},accept:function(ret){if(!this[ret.type])throw new _exception2.default("Unknown type: "+ret.type,ret);this.sourceNode.unshift(ret);ret=this[ret.type](ret);return this.sourceNode.shift(),ret},Program:function(program){this.options.blockParams.unshift(program.blockParams);for(var body=program.body,bodyLength=body.length,i=0;i<bodyLength;i++)this.accept(body[i]);return this.options.blockParams.shift(),this.isSimple=1===bodyLength,this.blockParams=program.blockParams?program.blockParams.length:0,this},BlockStatement:function(block){transformLiteralToPath(block);var program=block.program,inverse=block.inverse,program=program&&this.compileProgram(program),inverse=inverse&&this.compileProgram(inverse),type=this.classifySexpr(block);"helper"===type?this.helperSexpr(block,program,inverse):"simple"===type?(this.simpleSexpr(block),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("blockValue",block.path.original)):(this.ambiguousSexpr(block,program,inverse),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(path){var params=path.program&&this.compileProgram(path.program),params=this.setupFullMustacheParams(path,params,void 0),path=path.path;this.useDecorators=!0,this.opcode("registerDecorator",params.length,path.original)},PartialStatement:function(indent){this.usePartial=!0;var program=(program=indent.program)&&this.compileProgram(indent.program),isDynamic=indent.params;if(1<isDynamic.length)throw new _exception2.default("Unsupported number of partial arguments: "+isDynamic.length,indent);isDynamic.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):isDynamic.push({type:"PathExpression",parts:[],depth:0}));var partialName=indent.name.original,isDynamic="SubExpression"===indent.name.type;isDynamic&&this.accept(indent.name),this.setupFullMustacheParams(indent,program,void 0,!0);indent=indent.indent||"";this.options.preventIndent&&indent&&(this.opcode("appendContent",indent),indent=""),this.opcode("invokePartial",isDynamic,partialName,indent),this.opcode("append")},PartialBlockStatement:function(partialBlock){this.PartialStatement(partialBlock)},MustacheStatement:function(mustache){this.SubExpression(mustache),mustache.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(decorator){this.DecoratorBlock(decorator)},ContentStatement:function(content){content.value&&this.opcode("appendContent",content.value)},CommentStatement:function(){},SubExpression:function(sexpr){transformLiteralToPath(sexpr);var type=this.classifySexpr(sexpr);"simple"===type?this.simpleSexpr(sexpr):"helper"===type?this.helperSexpr(sexpr):this.ambiguousSexpr(sexpr)},ambiguousSexpr:function(isBlock,program,inverse){var path=isBlock.path,name=path.parts[0],isBlock=null!=program||null!=inverse;this.opcode("getContext",path.depth),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),path.strict=!0,this.accept(path),this.opcode("invokeAmbiguous",name,isBlock)},simpleSexpr:function(path){path=path.path;path.strict=!0,this.accept(path),this.opcode("resolvePossibleLambda")},helperSexpr:function(sexpr,path,name){var params=this.setupFullMustacheParams(sexpr,path,name),path=sexpr.path,name=path.parts[0];if(this.options.knownHelpers[name])this.opcode("invokeKnownHelper",params.length,name);else{if(this.options.knownHelpersOnly)throw new _exception2.default("You specified knownHelpersOnly, but used the unknown helper "+name,sexpr);path.strict=!0,path.falsy=!0,this.accept(path),this.opcode("invokeHelper",params.length,path.original,_ast2.default.helpers.simpleId(path))}},PathExpression:function(path){this.addDepth(path.depth),this.opcode("getContext",path.depth);var name=path.parts[0],scoped=_ast2.default.helpers.scopedId(path),blockParamId=!path.depth&&!scoped&&this.blockParamIndex(name);blockParamId?this.opcode("lookupBlockParam",blockParamId,path.parts):name?path.data?(this.options.data=!0,this.opcode("lookupData",path.depth,path.parts,path.strict)):this.opcode("lookupOnContext",path.parts,path.falsy,path.strict,scoped):this.opcode("pushContext")},StringLiteral:function(string){this.opcode("pushString",string.value)},NumberLiteral:function(number){this.opcode("pushLiteral",number.value)},BooleanLiteral:function(bool){this.opcode("pushLiteral",bool.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(hash){var pairs=hash.pairs,i=0,l=pairs.length;for(this.opcode("pushHash");i<l;i++)this.pushParam(pairs[i].value);for(;i--;)this.opcode("assignToHash",pairs[i].key);this.opcode("popHash")},opcode:function(name){this.opcodes.push({opcode:name,args:slice.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(depth){depth&&(this.useDepths=!0)},classifySexpr:function(options){var _name=_ast2.default.helpers.simpleId(options.path),isEligible=_name&&!!this.blockParamIndex(options.path.parts[0]),isHelper=!isEligible&&_ast2.default.helpers.helperExpression(options),isEligible=!isEligible&&(isHelper||_name);return isEligible&&!isHelper&&(_name=options.path.parts[0],(options=this.options).knownHelpers[_name]?isHelper=!0:options.knownHelpersOnly&&(isEligible=!1)),isHelper?"helper":isEligible?"ambiguous":"simple"},pushParams:function(params){for(var i=0,l=params.length;i<l;i++)this.pushParam(params[i])},pushParam:function(val){var blockParamIndex,blockParamChild,value=null!=val.value?val.value:val.original||"";this.stringParams?(value.replace&&(value=value.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),val.depth&&this.addDepth(val.depth),this.opcode("getContext",val.depth||0),this.opcode("pushStringParam",value,val.type),"SubExpression"===val.type&&this.accept(val)):(this.trackIds&&(blockParamIndex=void 0,(blockParamIndex=val.parts&&!_ast2.default.helpers.scopedId(val)&&!val.depth?this.blockParamIndex(val.parts[0]):blockParamIndex)?(blockParamChild=val.parts.slice(1).join("."),this.opcode("pushId","BlockParam",blockParamIndex,blockParamChild)):((value=val.original||value).replace&&(value=value.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",val.type,value))),this.accept(val))},setupFullMustacheParams:function(sexpr,program,inverse,omitEmpty){var params=sexpr.params;return this.pushParams(params),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),sexpr.hash?this.accept(sexpr.hash):this.opcode("emptyHash",omitEmpty),params},blockParamIndex:function(name){for(var depth=0,len=this.options.blockParams.length;depth<len;depth++){var blockParams=this.options.blockParams[depth],param=blockParams&&_utils.indexOf(blockParams,name);if(blockParams&&0<=param)return[depth,param]}}}},function(module,exports,__webpack_require__){"use strict";var _Object$keys=__webpack_require__(13).default,_interopRequireDefault=__webpack_require__(1).default;exports.__esModule=!0;var _base=__webpack_require__(4),_exception2=_interopRequireDefault(__webpack_require__(6)),_utils=__webpack_require__(5),_codeGen2=_interopRequireDefault(__webpack_require__(53));function Literal(value){this.value=value}function JavaScriptCompiler(){}JavaScriptCompiler.prototype={nameLookup:function(parent,name){return this.internalNameLookup(parent,name)},depthedLookup:function(name){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(name),")"]},compilerInfo:function(){var revision=_base.COMPILER_REVISION;return[revision,_base.REVISION_CHANGES[revision]]},appendToBuffer:function(source,location,explicit){return _utils.isArray(source)||(source=[source]),source=this.source.wrap(source,location),this.environment.isSimple?["return ",source,";"]:explicit?["buffer += ",source,";"]:(source.appendToBuffer=!0,source)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(parent,name){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",parent,",",JSON.stringify(name),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(_context,options,context,asObject){this.environment=_context,this.options=options,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!asObject,this.name=this.environment.name,this.isChild=!!context,this.context=context||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(_context,options),this.useDepths=this.useDepths||_context.useDepths||_context.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||_context.useBlockParams;var opcode,opcodes=_context.opcodes,firstLoc=void 0,i=void 0,l=void 0;for(i=0,l=opcodes.length;i<l;i++)opcode=opcodes[i],this.source.currentLocation=opcode.loc,firstLoc=firstLoc||opcode.loc,this[opcode.opcode].apply(this,opcode.args);if(this.source.currentLocation=firstLoc,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new _exception2.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),";\n"]),this.decorators.push("return fn;"),asObject?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));_context=this.createFunctionContext(asObject);if(this.isChild)return _context;var ret={compiler:this.compilerInfo(),main:_context};this.decorators&&(ret.main_d=this.decorators,ret.useDecorators=!0);for(var _context=this.context,programs=_context.programs,decorators=_context.decorators,i=0,l=programs.length;i<l;i++)programs[i]&&(ret[i]=programs[i],decorators[i]&&(ret[i+"_d"]=decorators[i],ret.useDecorators=!0));return this.environment.usePartial&&(ret.usePartial=!0),this.options.data&&(ret.useData=!0),this.useDepths&&(ret.useDepths=!0),this.useBlockParams&&(ret.useBlockParams=!0),this.options.compat&&(ret.compat=!0),asObject?ret.compilerOptions=this.options:(ret.compiler=JSON.stringify(ret.compiler),this.source.currentLocation={start:{line:1,column:0}},ret=this.objectLiteral(ret),options.srcName?(ret=ret.toStringWithSourceMap({file:options.destName})).map=ret.map&&ret.map.toString():ret=ret.toString()),ret},preamble:function(){this.lastContext=0,this.source=new _codeGen2.default(this.options.srcName),this.decorators=new _codeGen2.default(this.options.srcName)},createFunctionContext:function(asObject){var _this=this,varDeclarations="",source=this.stackVars.concat(this.registers.list);0<source.length&&(varDeclarations+=", "+source.join(", "));var aliasCount=0;_Object$keys(this.aliases).forEach(function(alias){var node=_this.aliases[alias];node.children&&1<node.referenceCount&&(varDeclarations+=", alias"+ ++aliasCount+"="+alias,node.children[0]="alias"+aliasCount)}),this.lookupPropertyFunctionIsUsed&&(varDeclarations+=", "+this.lookupPropertyFunctionVarDeclaration());var params=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&params.push("blockParams"),this.useDepths&&params.push("depths");source=this.mergeSource(varDeclarations);return asObject?(params.push(source),Function.apply(this,params)):this.source.wrap(["function(",params.join(","),") {\n  ",source,"}"])},mergeSource:function(varDeclarations){var isSimple=this.environment.isSimple,appendOnly=!this.forceBuffer,appendFirst=void 0,sourceSeen=void 0,bufferStart=void 0,bufferEnd=void 0;return this.source.each(function(line){line.appendToBuffer?(bufferStart?line.prepend("  + "):bufferStart=line,bufferEnd=line):(bufferStart&&(sourceSeen?bufferStart.prepend("buffer += "):appendFirst=!0,bufferEnd.add(";"),bufferStart=bufferEnd=void 0),sourceSeen=!0,isSimple||(appendOnly=!1))}),appendOnly?bufferStart?(bufferStart.prepend("return "),bufferEnd.add(";")):sourceSeen||this.source.push('return "";'):(varDeclarations+=", buffer = "+(appendFirst?"":this.initializeBuffer()),bufferStart?(bufferStart.prepend("return buffer + "),bufferEnd.add(";")):this.source.push("return buffer;")),varDeclarations&&this.source.prepend("var "+varDeclarations.substring(2)+(appendFirst?"":";\n")),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return"\n      lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    }\n    ".trim()},blockValue:function(blockName){var blockHelperMissing=this.aliasable("container.hooks.blockHelperMissing"),params=[this.contextName(0)];this.setupHelperArgs(blockName,0,params);blockName=this.popStack();params.splice(1,0,blockName),this.push(this.source.functionCall(blockHelperMissing,"call",params))},ambiguousBlockValue:function(){var blockHelperMissing=this.aliasable("container.hooks.blockHelperMissing"),params=[this.contextName(0)];this.setupHelperArgs("",0,params,!0),this.flushInline();var current=this.topStack();params.splice(1,0,current),this.pushSource(["if (!",this.lastHelper,") { ",current," = ",this.source.functionCall(blockHelperMissing,"call",params),"}"])},appendContent:function(content){this.pendingContent?content=this.pendingContent+content:this.pendingLocation=this.source.currentLocation,this.pendingContent=content},append:function(){var local;this.isInline()?(this.replaceStack(function(current){return[" != null ? ",current,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()))):(local=this.popStack(),this.pushSource(["if (",local," != null) { ",this.appendToBuffer(local,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"]))},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(depth){this.lastContext=depth},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(parts,falsy,strict,scoped){var i=0;scoped||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(parts[i++])),this.resolvePath("context",parts,i,falsy,strict)},lookupBlockParam:function(blockParamId,parts){this.useBlockParams=!0,this.push(["blockParams[",blockParamId[0],"][",blockParamId[1],"]"]),this.resolvePath("context",parts,1)},lookupData:function(depth,parts,strict){depth?this.pushStackLiteral("container.data(data, "+depth+")"):this.pushStackLiteral("data"),this.resolvePath("data",parts,0,!0,strict)},resolvePath:function(type,parts,i,falsy,strict){var _this2=this;if(this.options.strict||this.options.assumeObjects)this.push(function(requireTerminal,compiler,parts,type){var stack=compiler.popStack(),i=0,len=parts.length;requireTerminal&&len--;for(;i<len;i++)stack=compiler.nameLookup(stack,parts[i],type);return requireTerminal?[compiler.aliasable("container.strict"),"(",stack,", ",compiler.quotedString(parts[i]),", ",JSON.stringify(compiler.source.currentLocation)," )"]:stack}(this.options.strict&&strict,this,parts,type));else for(var len=parts.length;i<len;i++)this.replaceStack(function(current){var lookup=_this2.nameLookup(current,parts[i],type);return falsy?[" && ",lookup]:[" != null ? ",lookup," : ",current]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(string,type){this.pushContext(),this.pushString(type),"SubExpression"!==type&&("string"==typeof string?this.pushString(string):this.pushStackLiteral(string))},emptyHash:function(omitEmpty){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(omitEmpty?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var hash=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(hash.ids)),this.stringParams&&(this.push(this.objectLiteral(hash.contexts)),this.push(this.objectLiteral(hash.types))),this.push(this.objectLiteral(hash.values))},pushString:function(string){this.pushStackLiteral(this.quotedString(string))},pushLiteral:function(value){this.pushStackLiteral(value)},pushProgram:function(guid){null!=guid?this.pushStackLiteral(this.programExpression(guid)):this.pushStackLiteral(null)},registerDecorator:function(options,name){var foundDecorator=this.nameLookup("decorators",name,"decorator"),options=this.setupHelperArgs(name,options);this.decorators.push(["fn = ",this.decorators.functionCall(foundDecorator,"",["fn","props","container",options])," || fn;"])},invokeHelper:function(functionCall,functionLookupCode,isSimple){var nonHelper=this.popStack(),functionCall=this.setupHelper(functionCall,functionLookupCode),functionLookupCode=[];isSimple&&functionLookupCode.push(functionCall.name),functionLookupCode.push(nonHelper),this.options.strict||functionLookupCode.push(this.aliasable("container.hooks.helperMissing"));functionLookupCode=["(",this.itemsSeparatedBy(functionLookupCode,"||"),")"],functionCall=this.source.functionCall(functionLookupCode,"call",functionCall.callParams);this.push(functionCall)},itemsSeparatedBy:function(items,separator){var result=[];result.push(items[0]);for(var i=1;i<items.length;i++)result.push(separator,items[i]);return result},invokeKnownHelper:function(paramSize,helper){helper=this.setupHelper(paramSize,helper);this.push(this.source.functionCall(helper.name,"call",helper.callParams))},invokeAmbiguous:function(name,helper){this.useRegister("helper");var lookup=this.popStack();this.emptyHash();helper=this.setupHelper(0,name,helper),lookup=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",name,"helper")," || ",lookup,")"];this.options.strict||(lookup[0]="(helper = ",lookup.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",lookup,helper.paramsInit?["),(",helper.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",helper.callParams)," : helper))"])},invokePartial:function(isDynamic,name,indent){var params=[],options=this.setupParams(name,1,params);isDynamic&&(name=this.popStack(),delete options.name),indent&&(options.indent=JSON.stringify(indent)),options.helpers="helpers",options.partials="partials",options.decorators="container.decorators",isDynamic?params.unshift(name):params.unshift(this.nameLookup("partials",name,"partial")),this.options.compat&&(options.depths="depths"),options=this.objectLiteral(options),params.push(options),this.push(this.source.functionCall("container.invokePartial","",params))},assignToHash:function(key){var value=this.popStack(),context=void 0,type=void 0,id=void 0;this.trackIds&&(id=this.popStack()),this.stringParams&&(type=this.popStack(),context=this.popStack());var hash=this.hash;context&&(hash.contexts[key]=context),type&&(hash.types[key]=type),id&&(hash.ids[key]=id),hash.values[key]=value},pushId:function(type,name,child){"BlockParam"===type?this.pushStackLiteral("blockParams["+name[0]+"].path["+name[1]+"]"+(child?" + "+JSON.stringify("."+child):"")):"PathExpression"===type?this.pushString(name):"SubExpression"===type?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){for(var children=environment.children,child=void 0,compiler=void 0,i=0,l=children.length;i<l;i++){var index,child=children[i],compiler=new this.compiler,existing=this.matchExistingProgram(child);null==existing?(this.context.programs.push(""),index=this.context.programs.length,child.index=index,child.name="program"+index,this.context.programs[index]=compiler.compile(child,options,this.context,!this.precompile),this.context.decorators[index]=compiler.decorators,this.context.environments[index]=child,this.useDepths=this.useDepths||compiler.useDepths,this.useBlockParams=this.useBlockParams||compiler.useBlockParams,child.useDepths=this.useDepths,child.useBlockParams=this.useBlockParams):(child.index=existing.index,child.name="program"+existing.index,this.useDepths=this.useDepths||existing.useDepths,this.useBlockParams=this.useBlockParams||existing.useBlockParams)}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child))return environment}},programExpression:function(programParams){programParams=this.environment.children[programParams],programParams=[programParams.index,"data",programParams.blockParams];return(this.useBlockParams||this.useDepths)&&programParams.push("blockParams"),this.useDepths&&programParams.push("depths"),"container.program("+programParams.join(", ")+")"},useRegister:function(name){this.registers[name]||(this.registers[name]=!0,this.registers.list.push(name))},push:function(expr){return expr instanceof Literal||(expr=this.source.wrap(expr)),this.inlineStack.push(expr),expr},pushStackLiteral:function(item){this.push(new Literal(item))},pushSource:function(source){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),source&&this.source.push(source)},replaceStack:function(callback){var prefix=["("],item=void 0,createdStack=void 0,usedLiteral=void 0;if(!this.isInline())throw new _exception2.default("replaceStack on non-inline");var _name,top=this.popStack(!0);top instanceof Literal?(prefix=["(",item=[top.value]],usedLiteral=!0):(createdStack=!0,_name=this.incrStack(),prefix=["((",this.push(_name)," = ",top,")"],item=this.topStack());item=callback.call(this,item);usedLiteral||this.popStack(),createdStack&&this.stackSlot--,this.push(prefix.concat(item,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var inlineStack=this.inlineStack;this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var stack,entry=inlineStack[i];entry instanceof Literal?this.compileStack.push(entry):(stack=this.incrStack(),this.pushSource([stack," = ",entry,";"]),this.compileStack.push(stack))}},isInline:function(){return this.inlineStack.length},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&item instanceof Literal)return item.value;if(!inline){if(!this.stackSlot)throw new _exception2.default("Invalid stack pop");this.stackSlot--}return item},topStack:function(){var item=this.isInline()?this.inlineStack:this.compileStack,item=item[item.length-1];return item instanceof Literal?item.value:item},contextName:function(context){return this.useDepths&&context?"depths["+context+"]":"depth"+context},quotedString:function(str){return this.source.quotedString(str)},objectLiteral:function(obj){return this.source.objectLiteral(obj)},aliasable:function(name){var ret=this.aliases[name];return ret?ret.referenceCount++:((ret=this.aliases[name]=this.source.wrap(name)).aliasable=!0,ret.referenceCount=1),ret},setupHelper:function(paramSize,name,blockHelper){var params=[];return{params:params,paramsInit:this.setupHelperArgs(name,paramSize,params,blockHelper),name:this.nameLookup("helpers",name,"helper"),callParams:[this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})")].concat(params)}},setupParams:function(program,paramSize,params){var param,options={},contexts=[],types=[],ids=[],objectArgs=!params;objectArgs&&(params=[]),options.name=this.quotedString(program),options.hash=this.popStack(),this.trackIds&&(options.hashIds=this.popStack()),this.stringParams&&(options.hashTypes=this.popStack(),options.hashContexts=this.popStack());var inverse=this.popStack(),program=this.popStack();(program||inverse)&&(options.fn=program||"container.noop",options.inverse=inverse||"container.noop");for(var i=paramSize;i--;)param=this.popStack(),params[i]=param,this.trackIds&&(ids[i]=this.popStack()),this.stringParams&&(types[i]=this.popStack(),contexts[i]=this.popStack());return objectArgs&&(options.args=this.source.generateArray(params)),this.trackIds&&(options.ids=this.source.generateArray(ids)),this.stringParams&&(options.types=this.source.generateArray(types),options.contexts=this.source.generateArray(contexts)),this.options.data&&(options.data="data"),this.useBlockParams&&(options.blockParams="blockParams"),options},setupHelperArgs:function(helper,options,params,useRegister){options=this.setupParams(helper,options,params);return options.loc=JSON.stringify(this.source.currentLocation),options=this.objectLiteral(options),useRegister?(this.useRegister("options"),params.push("options"),["options=",options]):params?(params.push(options),""):options}},function(){for(var reservedWords="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),compilerWords=JavaScriptCompiler.RESERVED_WORDS={},i=0,l=reservedWords.length;i<l;i++)compilerWords[reservedWords[i]]=!0}(),JavaScriptCompiler.isValidJavaScriptVariableName=function(name){return!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name)},exports.default=JavaScriptCompiler,module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";var _Object$keys=__webpack_require__(13).default;exports.__esModule=!0;var _utils=__webpack_require__(5),SourceNode=void 0;function castChunk(chunk,codeGen,loc){if(_utils.isArray(chunk)){for(var ret=[],i=0,len=chunk.length;i<len;i++)ret.push(codeGen.wrap(chunk[i],loc));return ret}return"boolean"==typeof chunk||"number"==typeof chunk?chunk+"":chunk}function CodeGen(srcFile){this.srcFile=srcFile,this.source=[]}SourceNode||((SourceNode=function(line,column,srcFile,chunks){this.src="",chunks&&this.add(chunks)}).prototype={add:function(chunks){_utils.isArray(chunks)&&(chunks=chunks.join("")),this.src+=chunks},prepend:function(chunks){_utils.isArray(chunks)&&(chunks=chunks.join("")),this.src=chunks+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),CodeGen.prototype={isEmpty:function(){return!this.source.length},prepend:function(source,loc){this.source.unshift(this.wrap(source,loc))},push:function(source,loc){this.source.push(this.wrap(source,loc))},merge:function(){var source=this.empty();return this.each(function(line){source.add(["  ",line,"\n"])}),source},each:function(iter){for(var i=0,len=this.source.length;i<len;i++)iter(this.source[i])},empty:function(){var loc=this.currentLocation||{start:{}};return new SourceNode(loc.start.line,loc.start.column,this.srcFile)},wrap:function(chunk){var loc=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return chunk instanceof SourceNode?chunk:(chunk=castChunk(chunk,this,loc),new SourceNode(loc.start.line,loc.start.column,this.srcFile,chunk))},functionCall:function(fn,type,params){return params=this.generateList(params),this.wrap([fn,type?"."+type+"(":"(",params,")"])},quotedString:function(str){return'"'+(str+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(obj){var _this=this,pairs=[];_Object$keys(obj).forEach(function(key){var value=castChunk(obj[key],_this);"undefined"!==value&&pairs.push([_this.quotedString(key),":",value])});var ret=this.generateList(pairs);return ret.prepend("{"),ret.add("}"),ret},generateList:function(entries){for(var ret=this.empty(),i=0,len=entries.length;i<len;i++)i&&ret.add(","),ret.add(castChunk(entries[i],this));return ret},generateArray:function(ret){ret=this.generateList(ret);return ret.prepend("["),ret.add("]"),ret}},exports.default=CodeGen,module.exports=exports.default}],installedModules={},__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0);function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var modules,installedModules}),function($){$.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var canvasElement,class2type={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty;$.isFunction=function(obj){return"function"===$.type(obj)},$.isArray=Array.isArray||function(obj){return"array"===$.type(obj)},$.isWindow=function(obj){return obj&&"object"==typeof obj&&"setInterval"in obj},$.type=function(obj){return null==obj?String(obj):class2type[toString.call(obj)]||"object"},$.isPlainObject=function(obj){if(!obj||"object"!==OpenSeadragon.type(obj)||obj.nodeType||$.isWindow(obj))return!1;if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1;var lastKey,key;for(key in obj)lastKey=key;return void 0===lastKey||hasOwn.call(obj,lastKey)},$.isEmptyObject=function(obj){for(var name in obj)return!1;return!0},$.freezeObject=function(obj){return Object.freeze?$.freezeObject=Object.freeze:$.freezeObject=function(obj){return obj},$.freezeObject(obj)},$.supportsCanvas=(canvasElement=document.createElement("canvas"),!(!$.isFunction(canvasElement.getContext)||!canvasElement.getContext("2d"))),$.isCanvasTainted=function(canvas){var isTainted=!1;try{canvas.getContext("2d").getImageData(0,0,1,1)}catch(e){isTainted=!0}return isTainted},$.pixelDensityRatio=function(){if($.supportsCanvas){var backingStoreRatio=document.createElement("canvas").getContext("2d"),devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=backingStoreRatio.webkitBackingStorePixelRatio||backingStoreRatio.mozBackingStorePixelRatio||backingStoreRatio.msBackingStorePixelRatio||backingStoreRatio.oBackingStorePixelRatio||backingStoreRatio.backingStorePixelRatio||1;return Math.max(devicePixelRatio,1)/backingStoreRatio}return 1}()}(OpenSeadragon),function($){$.extend=function(){var options,name,copy,copyIsArray,clone,target=arguments[0]||{},length=arguments.length,deep=!1,i=1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||OpenSeadragon.isFunction(target)||(target={}),length===i&&(target=this,--i);i<length;i++)if(null!==(options=arguments[i])||void 0!==options)for(name in options)clone=target[name],target!==(copy=options[name])&&(deep&&copy&&(OpenSeadragon.isPlainObject(copy)||(copyIsArray=OpenSeadragon.isArray(copy)))?(clone=copyIsArray?(copyIsArray=!1,clone&&OpenSeadragon.isArray(clone)?clone:[]):clone&&OpenSeadragon.isPlainObject(clone)?clone:{},target[name]=OpenSeadragon.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var userAgent=navigator.userAgent;return"string"==typeof userAgent&&(-1!==userAgent.indexOf("iPhone")||-1!==userAgent.indexOf("iPad")||-1!==userAgent.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(object,method){return function(){var args=arguments;return method.apply(object,args=void 0===args?[]:args)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(element){return element="string"==typeof element?document.getElementById(element):element},getElementPosition:function(element){for(var isFixed,result=new $.Point,offsetParent=getOffsetParent(element=$.getElement(element),isFixed="fixed"==$.getElementStyle(element).position);offsetParent;)result.x+=element.offsetLeft,result.y+=element.offsetTop,isFixed&&(result=result.plus($.getPageScroll())),offsetParent=getOffsetParent(element=offsetParent,isFixed="fixed"==$.getElementStyle(element).position);return result},getElementOffset:function(element){var docElement,win=(element=$.getElement(element))&&element.ownerDocument,boundingRect={top:0,left:0};return win?(docElement=win.documentElement,void 0!==element.getBoundingClientRect&&(boundingRect=element.getBoundingClientRect()),win=win==win.window?win:9===win.nodeType&&(win.defaultView||win.parentWindow),new $.Point(boundingRect.left+(win.pageXOffset||docElement.scrollLeft)-(docElement.clientLeft||0),boundingRect.top+(win.pageYOffset||docElement.scrollTop)-(docElement.clientTop||0))):new $.Point},getElementSize:function(element){return element=$.getElement(element),new $.Point(element.clientWidth,element.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(element){return(element=$.getElement(element)).currentStyle}:function(element){return element=$.getElement(element),window.getComputedStyle(element,"")},getCssPropertyWithVendorPrefix:function(property){var memo={};return $.getCssPropertyWithVendorPrefix=function(property){if(void 0!==memo[property])return memo[property];var style=document.createElement("div").style,result=null;if(void 0!==style[property])result=property;else for(var prefixes=["Webkit","Moz","MS","O","webkit","moz","ms","o"],suffix=$.capitalizeFirstLetter(property),i=0;i<prefixes.length;i++){var prop=prefixes[i]+suffix;if(void 0!==style[prop]){result=prop;break}}return memo[property]=result},$.getCssPropertyWithVendorPrefix(property)},capitalizeFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},positiveModulo:function(result,modulo){result%=modulo;return result<0&&(result+=modulo),result},pointInElement:function(size,point){size=$.getElement(size);var offset=$.getElementOffset(size),size=$.getElementSize(size);return point.x>=offset.x&&point.x<offset.x+size.x&&point.y<offset.y+size.y&&point.y>=offset.y},getEvent:function(event){return $.getEvent=event?function(event){return event}:function(){return window.event},$.getEvent(event)},getMousePosition:function(event){if("number"==typeof event.pageX)$.getMousePosition=function(event){var result=new $.Point;return event=$.getEvent(event),result.x=event.pageX,result.y=event.pageY,result};else{if("number"!=typeof event.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(event){var result=new $.Point;return event=$.getEvent(event),result.x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,result.y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop,result}}return $.getMousePosition(event)},getPageScroll:function(){var docElement=document.documentElement||{},body=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(body.scrollLeft||body.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!docElement.scrollLeft&&!docElement.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(scroll){if(void 0!==window.scrollTo)$.setPageScroll=function(scroll){window.scrollTo(scroll.x,scroll.y)};else{var originalScroll=$.getPageScroll();if(originalScroll.x===scroll.x&&originalScroll.y===scroll.y)return;document.body.scrollLeft=scroll.x,document.body.scrollTop=scroll.y;var currentScroll=$.getPageScroll();if(currentScroll.x!==originalScroll.x&&currentScroll.y!==originalScroll.y)return void($.setPageScroll=function(scroll){document.body.scrollLeft=scroll.x,document.body.scrollTop=scroll.y});if(document.documentElement.scrollLeft=scroll.x,document.documentElement.scrollTop=scroll.y,(currentScroll=$.getPageScroll()).x!==originalScroll.x&&currentScroll.y!==originalScroll.y)return void($.setPageScroll=function(scroll){document.documentElement.scrollLeft=scroll.x,document.documentElement.scrollTop=scroll.y});$.setPageScroll=function(scroll){}}return $.setPageScroll(scroll)},getWindowSize:function(){var docElement=document.documentElement||{},body=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(docElement.clientWidth||docElement.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!body.clientWidth&&!body.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(element){element=$.getElement(element);var wrappers=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(wrappers[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(wrappers[1].style,{display:"table-row"}),$.extend(wrappers[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),wrappers[0].appendChild(wrappers[1]),wrappers[1].appendChild(wrappers[2]),wrappers[2].appendChild(element),wrappers[0]},makeNeutralElement:function(style){var element=document.createElement(style),style=element.style;return style.background="transparent none",style.border="none",style.margin="0px",style.padding="0px",style.position="static",element},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(src){return $.makeTransparentImage=function(src){var img=$.makeNeutralElement("img");return img.src=src,img},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(src){var img=$.makeNeutralElement("img"),element=null;return(element=$.makeNeutralElement("span")).style.display="inline-block",img.onload=function(){element.style.width=element.style.width||img.width+"px",element.style.height=element.style.height||img.height+"px",img.onload=null,img=null},img.src=src,element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')",element}),$.makeTransparentImage(src)},setElementOpacity:function(element,ieOpacity,usesAlpha){element=$.getElement(element),usesAlpha&&!$.Browser.alpha&&(ieOpacity=Math.round(ieOpacity)),$.Browser.opacity?element.style.opacity=ieOpacity<1?ieOpacity:"":ieOpacity<1?(ieOpacity=Math.round(100*ieOpacity),element.style.filter="alpha(opacity="+ieOpacity+")"):element.style.filter=""},setElementTouchActionNone:function(element){void 0!==(element=$.getElement(element)).style.touchAction?element.style.touchAction="none":void 0!==element.style.msTouchAction&&(element.style.msTouchAction="none")},addClass:function(element,className){(element=$.getElement(element)).className?-1===(" "+element.className+" ").indexOf(" "+className+" ")&&(element.className+=" "+className):element.className=className},indexOf:function(array,searchElement,fromIndex){return Array.prototype.indexOf?this.indexOf=function(array,searchElement,fromIndex){return array.indexOf(searchElement,fromIndex)}:this.indexOf=function(array,searchElement,pivot){var i,length,pivot=pivot||0;if(!array)throw new TypeError;if(0===(length=array.length)||length<=pivot)return-1;for(i=pivot=pivot<0?length-Math.abs(pivot):pivot;i<length;i++)if(array[i]===searchElement)return i;return-1},this.indexOf(array,searchElement,fromIndex)},removeClass:function(element,className){for(var newClasses=[],oldClasses=(element=$.getElement(element)).className.split(/\s+/),i=0;i<oldClasses.length;i++)oldClasses[i]&&oldClasses[i]!==className&&newClasses.push(oldClasses[i]);element.className=newClasses.join(" ")},addEvent:function(){if(window.addEventListener)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).addEventListener(eventName,handler,useCapture)};if(window.attachEvent)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).attachEvent("on"+eventName,handler)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).removeEventListener(eventName,handler,useCapture)};if(window.detachEvent)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).detachEvent("on"+eventName,handler)};throw new Error("No known event model.")}(),cancelEvent:function(event){(event=$.getEvent(event)).preventDefault?$.cancelEvent=function(event){event.preventDefault()}:$.cancelEvent=function(event){(event=$.getEvent(event)).cancel=!0,event.returnValue=!1},$.cancelEvent(event)},stopEvent:function(event){(event=$.getEvent(event)).stopPropagation?$.stopEvent=function(event){event.stopPropagation()}:$.stopEvent=function(event){(event=$.getEvent(event)).cancelBubble=!0},$.stopEvent(event)},createCallback:function(object,method){for(var initialArgs=[],i=2;i<arguments.length;i++)initialArgs.push(arguments[i]);return function(){for(var args=initialArgs.concat([]),i=0;i<arguments.length;i++)args.push(arguments[i]);return method.apply(object,args)}},getUrlParameter:function(value){value=URLPARAMS[value];return value||null},getUrlProtocol:function(match){match=match.match(/^([a-z]+:)\/\//i);return null===match?window.location.protocol:match[1].toLowerCase()},createAjaxRequest:function(local){var supportActiveX;try{supportActiveX=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){supportActiveX=!1}if(supportActiveX)window.XMLHttpRequest?$.createAjaxRequest=function(local){return local?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(local)},makeAjaxRequest:function(url,onSuccess,onError){var headers,responseType;$.isPlainObject(url)&&(onSuccess=url.success,onError=url.error,msg=url.withCredentials,headers=url.headers,responseType=url.responseType||null,url=url.url);var protocol=$.getUrlProtocol(url),request=$.createAjaxRequest("file:"===protocol);if(!$.isFunction(onSuccess))throw new Error("makeAjaxRequest requires a success callback");request.onreadystatechange=function(){4==request.readyState&&(request.onreadystatechange=function(){},200<=request.status&&request.status<300||0===request.status&&"http:"!==protocol&&"https:"!==protocol?onSuccess(request):($.console.log("AJAX request returned %d: %s",request.status,url),$.isFunction(onError)&&onError(request)))};try{if(request.open("GET",url,!0),responseType&&(request.responseType=responseType),headers)for(var headerName in headers)Object.prototype.hasOwnProperty.call(headers,headerName)&&headers[headerName]&&request.setRequestHeader(headerName,headers[headerName]);msg&&(request.withCredentials=!0),request.send(null)}catch(e){var msg=e.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==e.number&&-2147024891==e.number&&(msg+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",e.name,msg),request.onreadystatechange=function(){},window.XDomainRequest){var xdr=new window.XDomainRequest;if(xdr){xdr.onload=function(e){$.isFunction(onSuccess)&&onSuccess({responseText:xdr.responseText,status:200,statusText:"OK"})},xdr.onerror=function(e){$.isFunction(onError)&&onError({responseText:xdr.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{xdr.open("GET",url),xdr.send()}catch(e2){$.isFunction(onError)&&onError(request,e)}}}else $.isFunction(onError)&&onError(request,e)}return request},jsonp:function(options){var script,url=options.url,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,jsonpCallback=options.callbackName||"openseadragon"+$.now(),previous=window[jsonpCallback],callbackParam=options.param||"callback",callback=options.callback,url=url.replace(/(\=)\?(&|$)|\?\?/i,"$1"+jsonpCallback+"$2");url+=(/\?/.test(url)?"&":"?")+callbackParam+"="+jsonpCallback,window[jsonpCallback]=function(response){if(previous)window[jsonpCallback]=previous;else try{delete window[jsonpCallback]}catch(e){}callback&&$.isFunction(callback)&&callback(response)},script=document.createElement("script"),void 0===options.async&&!1===options.async||(script.async="async"),options.scriptCharset&&(script.charset=options.scriptCharset),script.src=url,script.onload=script.onreadystatechange=function(_,isAbort){!isAbort&&script.readyState&&!/loaded|complete/.test(script.readyState)||(script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=void 0)},head.insertBefore(script,head.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(string){if(window.DOMParser)$.parseXml=function(string){return(new DOMParser).parseFromString(string,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(string){var xmlDoc=null;return(xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async=!1,xmlDoc.loadXML(string),xmlDoc}}return $.parseXml(string)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(extension){return!!FILEFORMATS[(extension=extension||"").toLowerCase()]}});var nullfunction=function(msg){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={},w,aAnimQueue,processing,iRequestId,iIntervalId,requestAnimationFrame,cancelAnimationFrame;function getOffsetParent(element,isFixed){return isFixed&&element!=document.body?document.body:element.offsetParent}!function(){var ver=navigator.appVersion,ua=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(ua.substring(ua.indexOf("MSIE")+5,ua.indexOf(";",ua.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=ua.indexOf("Firefox")?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(ua.substring(ua.indexOf("Firefox")+8))):0<=ua.indexOf("Safari")?($.Browser.vendor=0<=ua.indexOf("Chrome")?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(ua.substring(ua.substring(0,ua.indexOf("Safari")).lastIndexOf("/")+1,ua.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(ua)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(ver)}for(var part,parts=window.location.search.substring(1).split("&"),i=0;i<parts.length;i++)if(0<(value=(part=parts[i]).indexOf("="))){var key=part.substring(0,value),value=part.substring(value+1);try{URLPARAMS[key]=decodeURIComponent(value)}catch(e){$.console.error("Ignoring malformed URL parameter: %s=%s",key,value)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),w=window,requestAnimationFrame=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame||w.msRequestAnimationFrame,cancelAnimationFrame=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame||w.msCancelAnimationFrame,requestAnimationFrame&&cancelAnimationFrame?($.requestAnimationFrame=function(){return requestAnimationFrame.apply(w,arguments)},$.cancelAnimationFrame=function(){return cancelAnimationFrame.apply(w,arguments)}):(aAnimQueue=[],processing=[],iRequestId=0,$.requestAnimationFrame=function(callback){return aAnimQueue.push([++iRequestId,callback]),iIntervalId=iIntervalId||setInterval(function(){if(aAnimQueue.length){var time=$.now(),temp=processing;for(processing=aAnimQueue,aAnimQueue=temp;processing.length;)processing.shift()[1](time)}else clearInterval(iIntervalId),iIntervalId=void 0},20),iRequestId},$.cancelAnimationFrame=function(requestId){for(var i=0,j=aAnimQueue.length;i<j;i+=1)if(aAnimQueue[i][0]===requestId)return void aAnimQueue.splice(i,1);for(i=0,j=processing.length;i<j;i+=1)if(processing[i][0]===requestId)return void processing.splice(i,1)})}(OpenSeadragon),function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.OpenSeadragon=factory()}(this,function(){return OpenSeadragon}),function($){var fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi)}(OpenSeadragon),function($){$.EventSource=function(){this.events={}},$.EventSource.prototype={addOnceHandler:function(eventName,handler,userData,times){var self=this;times=times||1;function onceHandler(event){++count===times&&self.removeHandler(eventName,onceHandler),handler(event)}var count=0;this.addHandler(eventName,onceHandler,userData)},addHandler:function(eventName,handler,userData){var events=this.events[eventName];events||(this.events[eventName]=events=[]),handler&&$.isFunction(handler)&&(events[events.length]={handler:handler,userData:userData||null})},removeHandler:function(eventName,handler){var i,events=this.events[eventName],handlers=[];if(events&&$.isArray(events)){for(i=0;i<events.length;i++)events[i].handler!==handler&&handlers.push(events[i]);this.events[eventName]=handlers}},removeAllHandlers:function(eventName){if(eventName)this.events[eventName]=[];else for(var eventType in this.events)this.events[eventType]=[]},getHandler:function(eventName){var events=this.events[eventName];return events&&events.length?(events=1===events.length?[events[0]]:Array.apply(null,events),function(source,args){for(var length=events.length,i=0;i<length;i++)events[i]&&(args.eventSource=source,args.userData=events[i].userData,events[i].handler(args))}):null},raiseEvent:function(handler,eventArgs){handler=this.getHandler(handler);handler&&handler(this,eventArgs=eventArgs||{})}}}(OpenSeadragon),function($){var trackerPoints,intervalId,lastTime,divElement,MOUSETRACKERS=[],THIS={};function _generateGuid(tracker,gPoint){return tracker.hash.toString()+gPoint.type+gPoint.id.toString()}function _doTracking(){var i,trackPoint,gPoint,distance,len=trackerPoints.length,now=$.now(),elapsedTime=now-lastTime;for(lastTime=now,i=0;i<len;i++)(gPoint=(trackPoint=trackerPoints[i]).gPoint).direction=Math.atan2(gPoint.currentPos.y-trackPoint.lastPos.y,gPoint.currentPos.x-trackPoint.lastPos.x),distance=trackPoint.lastPos.distanceTo(gPoint.currentPos),trackPoint.lastPos=gPoint.currentPos,gPoint.speed=.75*(1e3*distance/(1+elapsedTime))+.25*gPoint.speed}function clearTrackedPointers(tracker){for(var delegate=THIS[tracker.hash],pointerListCount=delegate.activePointersLists.length,i=0;i<pointerListCount;i++)0<delegate.activePointersLists[i].captureCount&&($.removeEvent($.MouseTracker.captureElement,"mousemove",delegate.mousemovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,"mouseup",delegate.mouseupcaptured,!0),$.removeEvent($.MouseTracker.captureElement,$.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",delegate.pointermovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,$.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",delegate.pointerupcaptured,!0),$.removeEvent($.MouseTracker.captureElement,"touchmove",delegate.touchmovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,"touchend",delegate.touchendcaptured,!0),delegate.activePointersLists[i].captureCount=0);for(i=0;i<pointerListCount;i++)delegate.activePointersLists.pop()}function stopTracking(tracker){var event,i,delegate=THIS[tracker.hash];if(delegate.tracking){for(i=0;i<$.MouseTracker.subscribeEvents.length;i++)event=$.MouseTracker.subscribeEvents[i],$.removeEvent(tracker.element,event,delegate[event],!1);clearTrackedPointers(tracker),delegate.tracking=!1}}function getCaptureEventParams(delegate,pointerType){delegate=THIS[delegate.hash];if("pointerevent"===pointerType)return{upName:$.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:delegate.pointerupcaptured,moveName:$.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:delegate.pointermovecaptured};if("mouse"===pointerType)return{upName:"mouseup",upHandler:delegate.mouseupcaptured,moveName:"mousemove",moveHandler:delegate.mousemovecaptured};if("touch"===pointerType)return{upName:"touchend",upHandler:delegate.touchendcaptured,moveName:"touchmove",moveHandler:delegate.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function capturePointer(tracker,eventParams,pointerCount){var pointsList=tracker.getActivePointersListByType(eventParams);pointsList.captureCount+=pointerCount||1,1===pointsList.captureCount&&($.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?tracker.element.setCapture(!0):(eventParams=getCaptureEventParams(tracker,$.MouseTracker.havePointerEvents?"pointerevent":eventParams),isInIframe&&canAccessEvents(window.top)&&$.addEvent(window.top,eventParams.upName,eventParams.upHandler,!0),$.addEvent($.MouseTracker.captureElement,eventParams.upName,eventParams.upHandler,!0),$.addEvent($.MouseTracker.captureElement,eventParams.moveName,eventParams.moveHandler,!0)))}function releasePointer(tracker,eventParams,pointerCount){var pointsList=tracker.getActivePointersListByType(eventParams);pointsList.captureCount-=pointerCount||1,0===pointsList.captureCount&&($.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?tracker.element.releaseCapture():(eventParams=getCaptureEventParams(tracker,$.MouseTracker.havePointerEvents?"pointerevent":eventParams),isInIframe&&canAccessEvents(window.top)&&$.removeEvent(window.top,eventParams.upName,eventParams.upHandler,!0),$.removeEvent($.MouseTracker.captureElement,eventParams.moveName,eventParams.moveHandler,!0),$.removeEvent($.MouseTracker.captureElement,eventParams.upName,eventParams.upHandler,!0)))}function getPointerType(event){var pointerTypeStr;if($.MouseTracker.unprefixedPointerEvents)pointerTypeStr=event.pointerType;else switch(event.pointerType){case 2:pointerTypeStr="touch";break;case 3:pointerTypeStr="pen";break;case 4:pointerTypeStr="mouse";break;default:pointerTypeStr=""}return pointerTypeStr}function getMouseAbsolute(event){return $.getMousePosition(event)}function getMouseRelative(event,element){return getPointRelativeToAbsolute(getMouseAbsolute(event),element)}function getPointRelativeToAbsolute(point,offset){offset=$.getElementOffset(offset);return point.minus(offset)}function getCenterPoint(point1,point2){return new $.Point((point1.x+point2.x)/2,(point1.y+point2.y)/2)}function onMouseWheel(tracker,event){var simulatedEvent={target:(event=$.getEvent(event)).target||event.srcElement,type:"wheel",shiftKey:event.shiftKey||!1,clientX:event.clientX,clientY:event.clientY,pageX:event.pageX||event.clientX,pageY:event.pageY||event.clientY,deltaMode:"MozMousePixelScroll"==event.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==$.MouseTracker.wheelEventName?simulatedEvent.deltaY=-event.wheelDelta/$.DEFAULT_SETTINGS.pixelsPerWheelLine:simulatedEvent.deltaY=event.detail,handleWheelEvent(tracker,simulatedEvent,event)}function handleWheelEvent(tracker,event,originalEvent){var nDelta=event.deltaY<0?1:-1;tracker.scrollHandler&&!1===tracker.scrollHandler({eventSource:tracker,pointerType:"mouse",position:getMouseRelative(event,tracker.element),scroll:nDelta,shift:event.shiftKey,isTouchEvent:!1,originalEvent:originalEvent,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(originalEvent)}function isParentChild(parent,child){if(parent!==child){for(;child&&child!==parent;)child=child.parentNode;return child===parent}}function handleMouseEnter(tracker,event){updatePointersEnter(tracker,event,[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function handleMouseExit(tracker,event){updatePointersExit(tracker,event,[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function getStandardizedButton(button){return $.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?1===button?0:2===button?2:4===button?1:-1:button}function handleMouseUp(tracker,event){updatePointersUp(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}],getStandardizedButton(event.button))&&releasePointer(tracker,"mouse")}function handleMouseMove(tracker,event){updatePointersMove(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function abortContacts(tracker,event,pointsList){var i,gPointCount=pointsList.getLength(),abortGPoints=[];if("touch"===pointsList.type||0<pointsList.contacts){for(i=0;i<gPointCount;i++)abortGPoints.push(pointsList.getByIndex(i));0<abortGPoints.length&&(updatePointersUp(tracker,event,abortGPoints,0),pointsList.captureCount=1,releasePointer(tracker,pointsList.type),updatePointersExit(tracker,event,abortGPoints))}}function handleTouchEnd(tracker,event){for(var j,parentGPoints,touchCount=event.changedTouches.length,gPoints=[],time=$.now(),i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:time});for(updatePointersUp(tracker,event,gPoints,0)&&releasePointer(tracker,"touch",touchCount),updatePointersExit(tracker,event,gPoints),i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]!==tracker&&MOUSETRACKERS[i].isTracking()&&isParentChild(MOUSETRACKERS[i].element,tracker.element)){for(parentGPoints=[],j=0;j<touchCount;j++)parentGPoints.push({id:event.changedTouches[j].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[j]),currentTime:time});updatePointersExit(MOUSETRACKERS[i],event,parentGPoints)}$.cancelEvent(event)}function handleTouchMove(tracker,event){for(var touchCount=event.changedTouches.length,gPoints=[],i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:$.now()});updatePointersMove(tracker,event,gPoints),$.cancelEvent(event)}function onPointerOver(tracker,event){event.currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||updatePointersEnter(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerOut(tracker,event){event.currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||updatePointersExit(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerDown(tracker,event){var gPoint={id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()};updatePointersDown(tracker,event,[gPoint],event.button)&&($.stopEvent(event),capturePointer(tracker,gPoint.type)),(tracker.clickHandler||tracker.dblClickHandler||tracker.pressHandler||tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.cancelEvent(event)}function onPointerUp(tracker,event){handlePointerUp(tracker,event)}function handlePointerUp(tracker,event){var gPoint={id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()};updatePointersUp(tracker,event,[gPoint],event.button)&&releasePointer(tracker,gPoint.type)}function onPointerMove(tracker,event){handlePointerMove(tracker,event)}function handlePointerMove(tracker,event){updatePointersMove(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerCancel(tracker,event){!function(tracker,event,gPoints){updatePointersUp(tracker,event,gPoints,0),updatePointersExit(tracker,event,gPoints)}(tracker,event,[{id:event.pointerId,type:getPointerType(event)}])}function startTrackingPointer(pointsList,gPoint){return Object.prototype.hasOwnProperty.call(gPoint,"isPrimary")||(0===pointsList.getLength()?gPoint.isPrimary=!0:gPoint.isPrimary=!1),gPoint.speed=0,gPoint.direction=0,gPoint.contactPos=gPoint.currentPos,gPoint.contactTime=gPoint.currentTime,gPoint.lastPos=gPoint.currentPos,gPoint.lastTime=gPoint.currentTime,pointsList.add(gPoint)}function stopTrackingPointer(pointsList,gPoint){var listLength,primaryPoint;return pointsList.getById(gPoint.id)?(listLength=pointsList.removeById(gPoint.id),Object.prototype.hasOwnProperty.call(gPoint,"isPrimary")||(primaryPoint=pointsList.getPrimary())||(primaryPoint=pointsList.getByIndex(0))&&(primaryPoint.isPrimary=!0)):listLength=pointsList.getLength(),listLength}function updatePointersEnter(tracker,event,gPoints){for(var curGPoint,updateGPoint,pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(updateGPoint.insideElement=!0,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,curGPoint=updateGPoint):(curGPoint.captured=!1,curGPoint.insideElementPressed=!1,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint)),tracker.enterHandler&&!1===tracker.enterHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.currentPos,tracker.element),buttons:pointsList.buttons,pointers:tracker.getActivePointerCount(),insideElementPressed:curGPoint.insideElementPressed,buttonDownAny:0!==pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersExit(tracker,event,gPoints){for(var curGPoint,updateGPoint,pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))&&(updateGPoint.captured?(updateGPoint.insideElement=!1,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime):stopTrackingPointer(pointsList,updateGPoint),curGPoint=updateGPoint),tracker.exitHandler&&!1===tracker.exitHandler({eventSource:tracker,pointerType:curGPoint.type,position:curGPoint.currentPos&&getPointRelativeToAbsolute(curGPoint.currentPos,tracker.element),buttons:pointsList.buttons,pointers:tracker.getActivePointerCount(),insideElementPressed:!!updateGPoint&&updateGPoint.insideElementPressed,buttonDownAny:0!==pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersDown(tracker,event,gPoints,buttonChanged){var curGPoint,updateGPoint,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;void 0!==event.buttons?pointsList.buttons=event.buttons:$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?0===buttonChanged?pointsList.buttons+=1:1===buttonChanged?pointsList.buttons+=4:2===buttonChanged?pointsList.buttons+=2:3===buttonChanged?pointsList.buttons+=8:4===buttonChanged?pointsList.buttons+=16:5===buttonChanged&&(pointsList.buttons+=32):0===buttonChanged?pointsList.buttons|=1:1===buttonChanged?pointsList.buttons|=4:2===buttonChanged?pointsList.buttons|=2:3===buttonChanged?pointsList.buttons|=8:4===buttonChanged?pointsList.buttons|=16:5===buttonChanged&&(pointsList.buttons|=32);for(var otherPointsLists=tracker.getActivePointersListsExceptType(gPoints[0].type),i=0;i<otherPointsLists.length;i++)abortContacts(tracker,event,otherPointsLists[i]);if(0===buttonChanged){for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(updateGPoint.captured=!0,updateGPoint.insideElementPressed=!0,updateGPoint.insideElement=!0,updateGPoint.contactPos=curGPoint.currentPos,updateGPoint.contactTime=curGPoint.currentTime,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,curGPoint=updateGPoint):(curGPoint.captured=!0,curGPoint.insideElementPressed=!0,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint)),pointsList.addContact(),(tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.MouseTracker.gesturePointVelocityTracker.addPoint(tracker,curGPoint),1===pointsList.contacts?tracker.pressHandler&&!1===tracker.pressHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.contactPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event):2===pointsList.contacts&&tracker.pinchHandler&&"touch"===curGPoint.type&&(delegate.pinchGPoints=pointsList.asArray(),delegate.lastPinchDist=delegate.currentPinchDist=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos),delegate.lastPinchCenter=delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos));return 1}tracker.nonPrimaryPressHandler&&!1===tracker.nonPrimaryPressHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),button:buttonChanged,buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersUp(tracker,event,gPoints,otherPointsList){var releasePoint,i,updateGPoint,quick,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,releaseCapture=!1,wasCaptured=!1;if(void 0!==event.buttons?pointsList.buttons=event.buttons:$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?0===otherPointsList?--pointsList.buttons:1===otherPointsList?pointsList.buttons-=4:2===otherPointsList?pointsList.buttons-=2:3===otherPointsList?pointsList.buttons-=8:4===otherPointsList?pointsList.buttons-=16:5===otherPointsList&&(pointsList.buttons-=32):0===otherPointsList?pointsList.buttons^=-2:1===otherPointsList?pointsList.buttons^=-5:2===otherPointsList?pointsList.buttons^=-3:3===otherPointsList?pointsList.buttons^=-9:4===otherPointsList?pointsList.buttons^=-17:5===otherPointsList&&(pointsList.buttons^=-33),0===otherPointsList){if(void 0!==gPoints[0].currentPos){for(i=0;i<gPointCount;i++)quick=gPoints[i],(updateGPoint=pointsList.getById(quick.id))&&(updateGPoint.captured&&(wasCaptured=releaseCapture=!(updateGPoint.captured=!1)),updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=quick.currentPos,updateGPoint.currentTime=quick.currentTime,updateGPoint.insideElement||stopTrackingPointer(pointsList,updateGPoint),releasePoint=updateGPoint.currentPos,quick=updateGPoint.currentTime,wasCaptured?(pointsList.removeContact(),(tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.MouseTracker.gesturePointVelocityTracker.removePoint(tracker,updateGPoint),0===pointsList.contacts?(tracker.releaseHandler&&!1===tracker.releaseHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(releasePoint,tracker.element),buttons:pointsList.buttons,insideElementPressed:updateGPoint.insideElementPressed,insideElementReleased:updateGPoint.insideElement,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),tracker.dragEndHandler&&!updateGPoint.currentPos.equals(updateGPoint.contactPos)&&!1===tracker.dragEndHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),speed:updateGPoint.speed,direction:updateGPoint.direction,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),(tracker.clickHandler||tracker.dblClickHandler)&&updateGPoint.insideElement&&(quick=quick-updateGPoint.contactTime<=tracker.clickTimeThreshold&&updateGPoint.contactPos.distanceTo(releasePoint)<=tracker.clickDistThreshold,tracker.clickHandler&&!1===tracker.clickHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),quick:quick,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),tracker.dblClickHandler&&quick&&(pointsList.clicks++,1===pointsList.clicks?(delegate.lastClickPos=releasePoint,delegate.dblClickTimeOut=setTimeout(function(){pointsList.clicks=0},tracker.dblClickTimeThreshold)):2===pointsList.clicks&&(clearTimeout(delegate.dblClickTimeOut),pointsList.clicks=0,delegate.lastClickPos.distanceTo(releasePoint)<=tracker.dblClickDistThreshold&&!1===tracker.dblClickHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),delegate.lastClickPos=null)))):2===pointsList.contacts&&tracker.pinchHandler&&"touch"===updateGPoint.type&&(delegate.pinchGPoints=pointsList.asArray(),delegate.lastPinchDist=delegate.currentPinchDist=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos),delegate.lastPinchCenter=delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos))):tracker.releaseHandler&&!1===tracker.releaseHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(releasePoint,tracker.element),buttons:pointsList.buttons,insideElementPressed:updateGPoint.insideElementPressed,insideElementReleased:updateGPoint.insideElement,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event));return releaseCapture}abortContacts(tracker,event,pointsList)}else{tracker.nonPrimaryReleaseHandler&&!1===tracker.nonPrimaryReleaseHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),button:otherPointsList,buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event);otherPointsList=tracker.getActivePointersListByType("mouse");abortContacts(tracker,event,otherPointsList)}}function updatePointersMove(tracker,event,gPoints){var i,curGPoint,updateGPoint,gPointArray,delta,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;for(void 0!==event.buttons&&(pointsList.buttons=event.buttons),i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(Object.prototype.hasOwnProperty.call(curGPoint,"isPrimary")&&(updateGPoint.isPrimary=curGPoint.isPrimary),updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime):(curGPoint.captured=!1,curGPoint.insideElementPressed=!1,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint));tracker.stopHandler&&"mouse"===gPoints[0].type&&(clearTimeout(tracker.stopTimeOut),tracker.stopTimeOut=setTimeout(function(){!function(tracker,originalMoveEvent,pointerType){tracker.stopHandler&&tracker.stopHandler({eventSource:tracker,pointerType:pointerType,position:getMouseRelative(originalMoveEvent,tracker.element),buttons:tracker.getActivePointersListByType(pointerType).buttons,isTouchEvent:"touch"===pointerType,originalEvent:originalMoveEvent,preventDefaultAction:!1,userData:tracker.userData})}(tracker,event,gPoints[0].type)},tracker.stopDelay)),0===pointsList.contacts?tracker.moveHandler&&!1===tracker.moveHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event):1===pointsList.contacts?(tracker.moveHandler&&(updateGPoint=pointsList.asArray()[0],!1===tracker.moveHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)),tracker.dragHandler&&(delta=(updateGPoint=pointsList.asArray()[0]).currentPos.minus(updateGPoint.lastPos),!1===tracker.dragHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),buttons:pointsList.buttons,delta:delta,speed:updateGPoint.speed,direction:updateGPoint.direction,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event))):2===pointsList.contacts&&(tracker.moveHandler&&(gPointArray=pointsList.asArray(),!1===tracker.moveHandler({eventSource:tracker,pointerType:gPointArray[0].type,position:getPointRelativeToAbsolute(getCenterPoint(gPointArray[0].currentPos,gPointArray[1].currentPos),tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===gPointArray[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)),tracker.pinchHandler&&"touch"===gPoints[0].type&&(delta=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos))!=delegate.currentPinchDist&&(delegate.lastPinchDist=delegate.currentPinchDist,delegate.currentPinchDist=delta,delegate.lastPinchCenter=delegate.currentPinchCenter,delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos),!1===tracker.pinchHandler({eventSource:tracker,pointerType:"touch",gesturePoints:delegate.pinchGPoints,lastCenter:getPointRelativeToAbsolute(delegate.lastPinchCenter,tracker.element),center:getPointRelativeToAbsolute(delegate.currentPinchCenter,tracker.element),lastDistance:delegate.lastPinchDist,distance:delegate.currentPinchDist,shift:event.shiftKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)))}$.MouseTracker=function(options){MOUSETRACKERS.push(this);var args=arguments;$.isPlainObject(options)||(options={element:args[0],clickTimeThreshold:args[1],clickDistThreshold:args[2]}),this.hash=Math.random(),this.element=$.getElement(options.element),this.clickTimeThreshold=options.clickTimeThreshold||$.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=options.clickDistThreshold||$.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=options.dblClickTimeThreshold||$.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=options.dblClickDistThreshold||$.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=options.userData||null,this.stopDelay=options.stopDelay||50,this.enterHandler=options.enterHandler||null,this.exitHandler=options.exitHandler||null,this.pressHandler=options.pressHandler||null,this.nonPrimaryPressHandler=options.nonPrimaryPressHandler||null,this.releaseHandler=options.releaseHandler||null,this.nonPrimaryReleaseHandler=options.nonPrimaryReleaseHandler||null,this.moveHandler=options.moveHandler||null,this.scrollHandler=options.scrollHandler||null,this.clickHandler=options.clickHandler||null,this.dblClickHandler=options.dblClickHandler||null,this.dragHandler=options.dragHandler||null,this.dragEndHandler=options.dragEndHandler||null,this.pinchHandler=options.pinchHandler||null,this.stopHandler=options.stopHandler||null,this.keyDownHandler=options.keyDownHandler||null,this.keyUpHandler=options.keyUpHandler||null,this.keyHandler=options.keyHandler||null,this.focusHandler=options.focusHandler||null,this.blurHandler=options.blurHandler||null;var _this=this;THIS[this.hash]={click:function(event){!function(tracker,event){tracker.clickHandler&&$.cancelEvent(event)}(_this,event)},dblclick:function(event){!function(tracker,event){tracker.dblClickHandler&&$.cancelEvent(event)}(_this,event)},keydown:function(event){!function(tracker,event){tracker.keyDownHandler&&(event=$.getEvent(event),tracker.keyDownHandler({eventSource:tracker,keyCode:event.keyCode||event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})||$.cancelEvent(event))}(_this,event)},keyup:function(event){!function(tracker,event){tracker.keyUpHandler&&(event=$.getEvent(event),tracker.keyUpHandler({eventSource:tracker,keyCode:event.keyCode||event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})||$.cancelEvent(event))}(_this,event)},keypress:function(event){!function(tracker,event){tracker.keyHandler&&(event=$.getEvent(event),tracker.keyHandler({eventSource:tracker,keyCode:event.keyCode||event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})||$.cancelEvent(event))}(_this,event)},focus:function(event){!function(tracker,event){tracker.focusHandler&&(event=$.getEvent(event),!1===tracker.focusHandler({eventSource:tracker,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event))}(_this,event)},blur:function(event){!function(tracker,event){tracker.blurHandler&&(event=$.getEvent(event),!1===tracker.blurHandler({eventSource:tracker,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event))}(_this,event)},wheel:function(event){!function(tracker,event){handleWheelEvent(tracker,event,event)}(_this,event)},mousewheel:function(event){onMouseWheel(_this,event)},DOMMouseScroll:function(event){onMouseWheel(_this,event)},MozMousePixelScroll:function(event){onMouseWheel(_this,event)},mouseenter:function(event){!function(tracker,event){event=$.getEvent(event),handleMouseEnter(tracker,event)}(_this,event)},mouseleave:function(event){!function(tracker,event){event=$.getEvent(event),handleMouseExit(tracker,event)}(_this,event)},mouseover:function(event){!function(tracker,event){(event=$.getEvent(event)).currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||handleMouseEnter(tracker,event)}(_this,event)},mouseout:function(event){!function(tracker,event){(event=$.getEvent(event)).currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||handleMouseExit(tracker,event)}(_this,event)},mousedown:function(event){!function(tracker,event){var gPoint;event=$.getEvent(event),gPoint={id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()},updatePointersDown(tracker,event,[gPoint],getStandardizedButton(event.button))&&($.stopEvent(event),capturePointer(tracker,"mouse"));(tracker.clickHandler||tracker.dblClickHandler||tracker.pressHandler||tracker.dragHandler||tracker.dragEndHandler)&&$.cancelEvent(event)}(_this,event)},mouseup:function(event){!function(tracker,event){handleMouseUp(tracker,event)}(_this,event)},mouseupcaptured:function(event){!function(tracker,event){handleMouseUp(tracker,event),$.stopEvent(event)}(_this,event)},mousemove:function(event){!function(tracker,event){handleMouseMove(tracker,event)}(_this,event)},mousemovecaptured:function(event){!function(tracker,event){handleMouseMove(tracker,event),$.stopEvent(event)}(_this,event)},touchstart:function(event){!function(tracker,event){var time,i,j,parentGPoints,touchCount=event.changedTouches.length,gPoints=[],pointsList=tracker.getActivePointersListByType("touch");time=$.now(),pointsList.getLength()>event.touches.length-touchCount&&($.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),abortContacts(tracker,event,pointsList));for(i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:time});for(updatePointersEnter(tracker,event,gPoints),i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]!==tracker&&MOUSETRACKERS[i].isTracking()&&isParentChild(MOUSETRACKERS[i].element,tracker.element)){for(parentGPoints=[],j=0;j<touchCount;j++)parentGPoints.push({id:event.changedTouches[j].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[j]),currentTime:time});updatePointersEnter(MOUSETRACKERS[i],event,parentGPoints)}updatePointersDown(tracker,event,gPoints,0)&&($.stopEvent(event),capturePointer(tracker,"touch",touchCount));$.cancelEvent(event)}(_this,event)},touchend:function(event){!function(tracker,event){handleTouchEnd(tracker,event)}(_this,event)},touchendcaptured:function(event){!function(tracker,event){handleTouchEnd(tracker,event),$.stopEvent(event)}(_this,event)},touchmove:function(event){!function(tracker,event){handleTouchMove(tracker,event)}(_this,event)},touchmovecaptured:function(event){!function(tracker,event){handleTouchMove(tracker,event),$.stopEvent(event)}(_this,event)},touchcancel:function(event){!function(tracker,event){var pointsList=tracker.getActivePointersListByType("touch");abortContacts(tracker,event,pointsList)}(_this,event)},gesturestart:function(event){!function(event){event.stopPropagation(),event.preventDefault()}(event)},gesturechange:function(event){!function(event){event.stopPropagation(),event.preventDefault()}(event)},pointerover:function(event){onPointerOver(_this,event)},MSPointerOver:function(event){onPointerOver(_this,event)},pointerout:function(event){onPointerOut(_this,event)},MSPointerOut:function(event){onPointerOut(_this,event)},pointerdown:function(event){onPointerDown(_this,event)},MSPointerDown:function(event){onPointerDown(_this,event)},pointerup:function(event){onPointerUp(_this,event)},MSPointerUp:function(event){onPointerUp(_this,event)},pointermove:function(event){onPointerMove(_this,event)},MSPointerMove:function(event){onPointerMove(_this,event)},pointercancel:function(event){onPointerCancel(_this,event)},MSPointerCancel:function(event){onPointerCancel(_this,event)},pointerupcaptured:function(event){!function(tracker,event){tracker.getActivePointersListByType(getPointerType(event)).getById(event.pointerId)&&handlePointerUp(tracker,event);$.stopEvent(event)}(_this,event)},pointermovecaptured:function(event){!function(tracker,event){tracker.getActivePointersListByType(getPointerType(event)).getById(event.pointerId)&&handlePointerMove(tracker,event);$.stopEvent(event)}(_this,event)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},options.startDisabled||this.setTracking(!0)},$.MouseTracker.prototype={destroy:function(){var i;for(stopTracking(this),this.element=null,i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]===this){MOUSETRACKERS.splice(i,1);break}THIS[this.hash]=null,delete THIS[this.hash]},isTracking:function(){return THIS[this.hash].tracking},setTracking:function(track){return(track?function(tracker){var event,i,delegate=THIS[tracker.hash];if(!delegate.tracking){for(i=0;i<$.MouseTracker.subscribeEvents.length;i++)event=$.MouseTracker.subscribeEvents[i],$.addEvent(tracker.element,event,delegate[event],!1);clearTrackedPointers(tracker),delegate.tracking=!0}}:stopTracking)(this),this},getActivePointersListsExceptType:function(type){for(var delegate=THIS[this.hash],listArray=[],i=0;i<delegate.activePointersLists.length;++i)delegate.activePointersLists[i].type!==type&&listArray.push(delegate.activePointersLists[i]);return listArray},getActivePointersListByType:function(type){for(var list,delegate=THIS[this.hash],len=delegate.activePointersLists.length,i=0;i<len;i++)if(delegate.activePointersLists[i].type===type)return delegate.activePointersLists[i];return list=new $.MouseTracker.GesturePointList(type),delegate.activePointersLists.push(list),list},getActivePointerCount:function(){for(var delegate=THIS[this.hash],len=delegate.activePointersLists.length,count=0,i=0;i<len;i++)count+=delegate.activePointersLists[i].getLength();return count},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},$.MouseTracker.resetAllMouseTrackers=function(){for(var i=0;i<MOUSETRACKERS.length;i++)MOUSETRACKERS[i].isTracking()&&(MOUSETRACKERS[i].setTracking(!1),MOUSETRACKERS[i].setTracking(!0))},$.MouseTracker.gesturePointVelocityTracker=(trackerPoints=[],lastTime=intervalId=0,{addPoint:function(guid,gPoint){guid=_generateGuid(guid,gPoint);trackerPoints.push({guid:guid,gPoint:gPoint,lastPos:gPoint.currentPos}),1===trackerPoints.length&&(lastTime=$.now(),intervalId=window.setInterval(_doTracking,50))},removePoint:function(tracker,gPoint){for(var guid=_generateGuid(tracker,gPoint),len=trackerPoints.length,i=0;i<len;i++)if(trackerPoints[i].guid===guid){trackerPoints.splice(i,1),0===--len&&window.clearInterval(intervalId);break}}}),$.MouseTracker.captureElement=document,$.MouseTracker.wheelEventName=$.Browser.vendor==$.BROWSERS.IE&&8<$.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",$.MouseTracker.supportsMouseCapture=(divElement=document.createElement("div"),$.isFunction(divElement.setCapture)&&$.isFunction(divElement.releaseCapture)),$.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",$.MouseTracker.wheelEventName],"DOMMouseScroll"==$.MouseTracker.wheelEventName&&$.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||$.Browser.vendor!==$.BROWSERS.IE)?($.MouseTracker.havePointerEvents=!0,$.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),$.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?$.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:$.MouseTracker.maxTouchPoints=0,$.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?($.MouseTracker.havePointerEvents=!0,$.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),$.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?$.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:$.MouseTracker.maxTouchPoints=0,$.MouseTracker.haveMouseEnter=!1):($.MouseTracker.havePointerEvents=!1,$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?($.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),$.MouseTracker.haveMouseEnter=!0):($.MouseTracker.subscribeEvents.push("mouseover","mouseout"),$.MouseTracker.haveMouseEnter=!1),$.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&$.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&$.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),$.MouseTracker.mousePointerId="legacy-mouse",$.MouseTracker.maxTouchPoints=10),$.MouseTracker.GesturePointList=function(type){this._gPoints=[],this.type=type,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},$.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(gp){return this._gPoints.push(gp)},removeById:function(id){for(var len=this._gPoints.length,i=0;i<len;i++)if(this._gPoints[i].id===id){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(index){return index<this._gPoints.length?this._gPoints[index]:null},getById:function(id){for(var len=this._gPoints.length,i=0;i<len;i++)if(this._gPoints[i].id===id)return this._gPoints[i];return null},getPrimary:function(id){for(var len=this._gPoints.length,i=0;i<len;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}();function canAccessEvents(target){try{return target.addEventListener&&target.removeEventListener}catch(e){return}}}(OpenSeadragon),function($){$.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},$.Control=function(element,options,container){var parent=element.parentNode;"number"==typeof options&&($.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),options={anchor:options}),options.attachToViewer=void 0===options.attachToViewer||options.attachToViewer,this.autoFade=void 0===options.autoFade||options.autoFade,this.element=element,this.anchor=options.anchor,this.container=container,this.anchor==$.ControlAnchor.ABSOLUTE?(this.wrapper=$.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof options.top?options.top+"px":options.top,this.wrapper.style.left="number"==typeof options.left?options.left+"px":options.left,this.wrapper.style.height="number"==typeof options.height?options.height+"px":options.height,this.wrapper.style.width="number"==typeof options.width?options.width+"px":options.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=$.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==$.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),options.attachToViewer?this.anchor==$.ControlAnchor.TOP_RIGHT||this.anchor==$.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):parent.appendChild(this.wrapper)},$.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(visible){this.wrapper.style.display=visible?this.anchor==$.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(opacity){this.element[$.SIGNAL]&&$.Browser.vendor==$.BROWSERS.IE?$.setElementOpacity(this.element,opacity,!0):$.setElementOpacity(this.wrapper,opacity,!0)}}}(OpenSeadragon),function($){function getControlIndex(dock,element){for(var controls=dock.controls,i=controls.length-1;0<=i;i--)if(controls[i].element==element)return i;return-1}$.ControlDock=function(options){var layout,i,layouts=["topleft","topright","bottomright","bottomleft"];for($.extend(!0,this,{id:"controldock-"+$.now()+"-"+Math.floor(1e6*Math.random()),container:$.makeNeutralElement("div"),controls:[]},options),this.container.onsubmit=function(){return!1},this.element&&(this.element=$.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<layouts.length;i++)this.controls[layout=layouts[i]]=$.makeNeutralElement("div"),this.controls[layout].style.position="absolute",layout.match("left")&&(this.controls[layout].style.left="0px"),layout.match("right")&&(this.controls[layout].style.right="0px"),layout.match("top")&&(this.controls[layout].style.top="0px"),layout.match("bottom")&&(this.controls[layout].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},$.ControlDock.prototype={addControl:function(element,controlOptions){var div=null;if(!(0<=getControlIndex(this,element=$.getElement(element)))){switch(controlOptions.anchor){case $.ControlAnchor.TOP_RIGHT:div=this.controls.topright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingTop="0px";break;case $.ControlAnchor.BOTTOM_RIGHT:div=this.controls.bottomright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingBottom="0px";break;case $.ControlAnchor.BOTTOM_LEFT:div=this.controls.bottomleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingBottom="0px";break;case $.ControlAnchor.TOP_LEFT:div=this.controls.topleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingTop="0px";break;case $.ControlAnchor.ABSOLUTE:div=this.container,element.style.margin="0px",element.style.padding="0px";break;default:case $.ControlAnchor.NONE:div=this.container,element.style.margin="0px",element.style.padding="0px"}this.controls.push(new $.Control(element,controlOptions,div)),element.style.display="inline-block"}},removeControl:function(i){i=getControlIndex(this,i=$.getElement(i));return 0<=i&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){for(var i=this.controls.length-1;0<=i;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(enabled){for(var i=this.controls.length-1;0<=i;i--)this.controls[i].setVisible(enabled);return this}}}(OpenSeadragon),function($){$.Placement=$.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function($){var THIS={},nextHash=1;function _getSafeElemSize(oElement){return oElement=$.getElement(oElement),new $.Point(0===oElement.clientWidth?1:oElement.clientWidth,0===oElement.clientHeight?1:oElement.clientHeight)}function getOverlayObject(rect,overlay){if(overlay instanceof $.Overlay)return overlay;var element=null;overlay.element?element=$.getElement(overlay.element):(x=overlay.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random()),(element=$.getElement(overlay.id))||((element=document.createElement("a")).href="#/overlay/"+x),element.id=x,$.addClass(element,overlay.className||"openseadragon-overlay"));var x,location=overlay.location,width=overlay.width,height=overlay.height;location||(x=overlay.x,placement=overlay.y,void 0!==overlay.px&&(x=(rect=rect.viewport.imageToViewportRectangle(new $.Rect(overlay.px,overlay.py,width||0,height||0))).x,placement=rect.y,width=void 0!==width?rect.width:void 0,height=void 0!==height?rect.height:void 0),location=new $.Point(x,placement));var placement=overlay.placement;return placement&&"string"===$.type(placement)&&(placement=$.Placement[overlay.placement.toUpperCase()]),new $.Overlay({element:element,location:location,placement:placement,onDraw:overlay.onDraw,checkResize:overlay.checkResize,width:width,height:height,rotationMode:overlay.rotationMode})}function getOverlayIndex(overlays,element){for(var i=overlays.length-1;0<=i;i--)if(overlays[i].element===element)return i;return-1}function scheduleUpdate(viewer,updateFunc){return $.requestAnimationFrame(function(){updateFunc(viewer)})}function scheduleControlsFade(viewer){$.requestAnimationFrame(function(){!function(viewer){var deltaTime,opacity,i;if(viewer.controlsShouldFade){for(deltaTime=$.now(),deltaTime=deltaTime-viewer.controlsFadeBeginTime,opacity=1-deltaTime/viewer.controlsFadeLength,opacity=Math.min(1,opacity),opacity=Math.max(0,opacity),i=viewer.controls.length-1;0<=i;i--)viewer.controls[i].autoFade&&viewer.controls[i].setOpacity(opacity);0<opacity&&scheduleControlsFade(viewer)}}(viewer)})}function beginControlsAutoHide(viewer){viewer.autoHideControls&&(viewer.controlsShouldFade=!0,viewer.controlsFadeBeginTime=$.now()+viewer.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(viewer)},viewer.controlsFadeDelay))}function abortControlsAutoHide(viewer){var i;for(viewer.controlsShouldFade=!1,i=viewer.controls.length-1;0<=i;i--)viewer.controls[i].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasKeyDown(event){var canvasKeyDownEventArgs={originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction,preventVerticalPan:event.preventVerticalPan,preventHorizontalPan:event.preventHorizontalPan};if(this.raiseEvent("canvas-key",canvasKeyDownEventArgs),canvasKeyDownEventArgs.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 38:return canvasKeyDownEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return canvasKeyDownEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return canvasKeyDownEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return canvasKeyDownEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function onCanvasKeyPress(event){var canvasKeyPressEventArgs={originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction,preventVerticalPan:event.preventVerticalPan,preventHorizontalPan:event.preventHorizontalPan};if(this.raiseEvent("canvas-key",canvasKeyPressEventArgs),canvasKeyPressEventArgs.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return canvasKeyPressEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return canvasKeyPressEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return canvasKeyPressEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return canvasKeyPressEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation($.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation($.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation($.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation($.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function onCanvasClick(event){var gestureSettings;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(event.position.x=this.viewport.getContainerSize().x-event.position.x);var canvasClickEventArgs={tracker:event.eventSource,position:event.position,quick:event.quick,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-click",canvasClickEventArgs),!canvasClickEventArgs.preventDefaultAction&&this.viewport&&event.quick&&(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).clickToZoom&&(this.viewport.zoomBy(event.shift?1/this.zoomPerClick:this.zoomPerClick,gestureSettings.zoomToRefPoint?this.viewport.pointFromPixel(event.position,!0):null),this.viewport.applyConstraints())}function onCanvasDblClick(event){var gestureSettings,canvasDblClickEventArgs={tracker:event.eventSource,position:event.position,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-double-click",canvasDblClickEventArgs),!canvasDblClickEventArgs.preventDefaultAction&&this.viewport&&(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(event.shift?1/this.zoomPerClick:this.zoomPerClick,gestureSettings.zoomToRefPoint?this.viewport.pointFromPixel(event.position,!0):null),this.viewport.applyConstraints())}function onCanvasDrag(event){var delta,bounds,gestureSettings,constrainedBounds={tracker:event.eventSource,position:event.position,delta:event.delta,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-drag",constrainedBounds),!constrainedBounds.preventDefaultAction&&this.viewport&&(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType),this.panHorizontal||(event.delta.x=0),this.panVertical||(event.delta.y=0),this.viewport.flipped&&(event.delta.x=-event.delta.x),this.constrainDuringPan&&(delta=this.viewport.deltaPointsFromPixels(event.delta.negate()),this.viewport.centerSpringX.target.value+=delta.x,this.viewport.centerSpringY.target.value+=delta.y,bounds=this.viewport.getBounds(),constrainedBounds=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=delta.x,this.viewport.centerSpringY.target.value-=delta.y,bounds.x!=constrainedBounds.x&&(event.delta.x=0),bounds.y!=constrainedBounds.y&&(event.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(event.delta.negate()),gestureSettings.flickEnabled&&!this.constrainDuringPan))}function onCanvasDragEnd(event){var amplitudeX,center,target;!event.preventDefaultAction&&this.viewport&&((center=this.gestureSettingsByDeviceType(event.pointerType)).flickEnabled&&event.speed>=center.flickMinSpeed&&(amplitudeX=0,this.panHorizontal&&(amplitudeX=center.flickMomentum*event.speed*Math.cos(event.direction)),target=0,this.panVertical&&(target=center.flickMomentum*event.speed*Math.sin(event.direction)),center=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),target=this.viewport.pointFromPixel(new $.Point(center.x-amplitudeX,center.y-target)),this.viewport.panTo(target,!1)),this.viewport.applyConstraints()),this.raiseEvent("canvas-drag-end",{tracker:event.eventSource,position:event.position,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent})}function onCanvasEnter(event){this.raiseEvent("canvas-enter",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onCanvasExit(event){window.location!=window.parent.location&&$.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onCanvasPress(event){this.raiseEvent("canvas-press",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,insideElementPressed:event.insideElementPressed,insideElementReleased:event.insideElementReleased,originalEvent:event.originalEvent})}function onCanvasRelease(event){this.raiseEvent("canvas-release",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,insideElementPressed:event.insideElementPressed,insideElementReleased:event.insideElementReleased,originalEvent:event.originalEvent})}function onCanvasNonPrimaryPress(event){this.raiseEvent("canvas-nonprimary-press",{tracker:event.eventSource,position:event.position,pointerType:event.pointerType,button:event.button,buttons:event.buttons,originalEvent:event.originalEvent})}function onCanvasNonPrimaryRelease(event){this.raiseEvent("canvas-nonprimary-release",{tracker:event.eventSource,position:event.position,pointerType:event.pointerType,button:event.button,buttons:event.buttons,originalEvent:event.originalEvent})}function onCanvasPinch(event){var centerPt,angle1,angle2;return!event.preventDefaultAction&&this.viewport&&((angle2=this.gestureSettingsByDeviceType(event.pointerType)).pinchToZoom&&(centerPt=this.viewport.pointFromPixel(event.center,!0),angle1=this.viewport.pointFromPixel(event.lastCenter,!0).minus(centerPt),this.panHorizontal||(angle1.x=0),this.panVertical||(angle1.y=0),this.viewport.zoomBy(event.distance/event.lastDistance,centerPt,!0),angle2.zoomToRefPoint&&this.viewport.panBy(angle1,!0),this.viewport.applyConstraints()),angle2.pinchRotate&&(angle1=Math.atan2(event.gesturePoints[0].currentPos.y-event.gesturePoints[1].currentPos.y,event.gesturePoints[0].currentPos.x-event.gesturePoints[1].currentPos.x),angle2=Math.atan2(event.gesturePoints[0].lastPos.y-event.gesturePoints[1].lastPos.y,event.gesturePoints[0].lastPos.x-event.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(angle1-angle2)*(180/Math.PI)))),this.raiseEvent("canvas-pinch",{tracker:event.eventSource,gesturePoints:event.gesturePoints,lastCenter:event.lastCenter,center:event.center,lastDistance:event.lastDistance,distance:event.distance,shift:event.shift,originalEvent:event.originalEvent}),!1}function onCanvasScroll(event){var gestureSettings,factor=$.now();if(factor-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=factor,this.viewport.flipped&&(event.position.x=this.viewport.getContainerSize().x-event.position.x),!event.preventDefaultAction&&this.viewport&&(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).scrollToZoom&&(factor=Math.pow(this.zoomPerScroll,event.scroll),this.viewport.zoomBy(factor,gestureSettings.zoomToRefPoint?this.viewport.pointFromPixel(event.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:event.eventSource,position:event.position,scroll:event.scroll,shift:event.shift,originalEvent:event.originalEvent}),gestureSettings&&gestureSettings.scrollToZoom)return!1}else if((gestureSettings=this.gestureSettingsByDeviceType(event.pointerType))&&gestureSettings.scrollToZoom)return!1}function onContainerEnter(event){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:event.eventSource,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onContainerExit(event){event.pointers<1&&(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:event.eventSource,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function updateMulti(viewer){!function(viewer){var viewport,zoom,center,viewportChange,animated;viewer._opening||(viewer.autoResize&&(animated=_getSafeElemSize(viewer.container),zoom=THIS[viewer.hash].prevContainerSize,animated.equals(zoom)||(viewport=viewer.viewport,viewer.preserveImageSizeOnResize?(center=zoom.x/animated.x,zoom=viewport.getZoom()*center,center=viewport.getCenter(),viewport.resize(animated,!1),viewport.zoomTo(zoom,null,!0),viewport.panTo(center,!0)):(viewportChange=viewport.getBounds(),viewport.resize(animated,!0),viewport.fitBoundsWithConstraints(viewportChange,!0)),THIS[viewer.hash].prevContainerSize=animated,THIS[viewer.hash].forceRedraw=!0)),viewportChange=viewer.viewport.update(),animated=viewer.world.update()||viewportChange,viewportChange&&viewer.raiseEvent("viewport-change"),viewer.referenceStrip&&(animated=viewer.referenceStrip.update(viewer.viewport)||animated),!THIS[viewer.hash].animating&&animated&&(viewer.raiseEvent("animation-start"),abortControlsAutoHide(viewer)),(animated||THIS[viewer.hash].forceRedraw||viewer.world.needsDraw())&&(function(viewer){viewer.imageLoader.clear(),viewer.drawer.clear(),viewer.world.draw(),viewer.raiseEvent("update-viewport",{})}(viewer),viewer._drawOverlays(),viewer.navigator&&viewer.navigator.update(viewer.viewport),THIS[viewer.hash].forceRedraw=!1,animated&&viewer.raiseEvent("animation")),THIS[viewer.hash].animating&&!animated&&(viewer.raiseEvent("animation-finish"),THIS[viewer.hash].mouseInside||beginControlsAutoHide(viewer)),THIS[viewer.hash].animating=animated)}(viewer),viewer.isOpen()?viewer._updateRequestId=scheduleUpdate(viewer,updateMulti):viewer._updateRequestId=!1}function resolveUrl(prefix,url){return prefix?prefix+url:url}function beginZoomingIn(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(viewer){$.requestAnimationFrame($.delegate(viewer,doZoom))}function doZoom(){var currentTime,adjustedFactor;THIS[this.hash].zooming&&this.viewport&&(adjustedFactor=(currentTime=$.now())-THIS[this.hash].lastZoomTime,adjustedFactor=Math.pow(THIS[this.hash].zoomFactor,adjustedFactor/1e3),this.viewport.zoomBy(adjustedFactor),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=currentTime,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullScreen(){this.isFullPage()&&!$.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onRotateLeft(){var currRotation;this.viewport&&(currRotation=this.viewport.getRotation(),currRotation=this.viewport.flipped?$.positiveModulo(currRotation+this.rotationIncrement,360):$.positiveModulo(currRotation-this.rotationIncrement,360),this.viewport.setRotation(currRotation))}function onRotateRight(){var currRotation;this.viewport&&(currRotation=this.viewport.getRotation(),currRotation=this.viewport.flipped?$.positiveModulo(currRotation-this.rotationIncrement,360):$.positiveModulo(currRotation+this.rotationIncrement,360),this.viewport.setRotation(currRotation))}function onFlip(){this.viewport.toggleFlip()}function onPrevious(){var previous=this._sequenceIndex-1;this.navPrevNextWrap&&previous<0&&(previous+=this.tileSources.length),this.goToPage(previous)}function onNext(){var next=this._sequenceIndex+1;this.navPrevNextWrap&&next>=this.tileSources.length&&(next=0),this.goToPage(next)}$.Viewer=function(options){var i,style=arguments,_this=this;if((options=!$.isPlainObject(options)?{id:style[0],xmlPath:1<style.length?style[1]:void 0,prefixUrl:2<style.length?style[2]:void 0,controls:3<style.length?style[3]:void 0,overlays:4<style.length?style[4]:void 0}:options).config&&($.extend(!0,options,options.config),delete options.config),$.extend(!0,this,{id:options.id,hash:options.hash||nextHash++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,options),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==THIS[this.hash]&&$.console.warn("Hash "+this.hash+" has already been used."),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=$.now(),$.EventSource.call(this),this.addHandler("open-failed",function(msg){msg=$.getString("Errors.OpenFailed",msg.eventSource,msg.message);_this._showMessage(msg)}),$.ControlDock.call(this,options),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(style=this.canvas.style).width="100%",style.height="100%",style.overflow="hidden",style.position="absolute",style.top="0px",style.left="0px",$.setElementTouchActionNone(this.canvas),""!==options.tabIndex&&(this.canvas.tabIndex=void 0===options.tabIndex?0:options.tabIndex),this.container.className="openseadragon-container",function(style){style.width="100%",style.height="100%",style.position="relative",style.overflow="hidden",style.left="0px",style.top="0px",style.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new $.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:$.delegate(this,onCanvasKeyDown),keyHandler:$.delegate(this,onCanvasKeyPress),clickHandler:$.delegate(this,onCanvasClick),dblClickHandler:$.delegate(this,onCanvasDblClick),dragHandler:$.delegate(this,onCanvasDrag),dragEndHandler:$.delegate(this,onCanvasDragEnd),enterHandler:$.delegate(this,onCanvasEnter),exitHandler:$.delegate(this,onCanvasExit),pressHandler:$.delegate(this,onCanvasPress),releaseHandler:$.delegate(this,onCanvasRelease),nonPrimaryPressHandler:$.delegate(this,onCanvasNonPrimaryPress),nonPrimaryReleaseHandler:$.delegate(this,onCanvasNonPrimaryRelease),scrollHandler:$.delegate(this,onCanvasScroll),pinchHandler:$.delegate(this,onCanvasPinch)}),this.outerTracker=new $.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit)}),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),THIS[this.hash].prevContainerSize=_getSafeElemSize(this.container),this.world=new $.World({viewer:this}),this.world.addHandler("add-item",function(event){_this.source=_this.world.getItemAt(0).source,THIS[_this.hash].forceRedraw=!0,_this._updateRequestId||(_this._updateRequestId=scheduleUpdate(_this,updateMulti))}),this.world.addHandler("remove-item",function(event){_this.world.getItemCount()?_this.source=_this.world.getItemAt(0).source:_this.source=null,THIS[_this.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(event){_this.viewport&&_this.viewport._setContentBounds(_this.world.getHomeBounds(),_this.world.getContentFactor())}),this.world.addHandler("item-index-change",function(event){_this.source=_this.world.getItemAt(0).source}),this.viewport=new $.Viewport({containerSize:THIS[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new $.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:options.timeout}),this.tileCache=new $.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new $.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=$.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(i=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(i=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new $.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),i=0;i<this.customControls.length;i++)this.addControl(this.customControls[i].id,{anchor:this.customControls[i].anchor});$.requestAnimationFrame(function(){beginControlsAutoHide(_this)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},$.extend($.Viewer.prototype,$.EventSource.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(dzi){return $.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(dzi)},openTileSource:function(tileSource){return $.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(tileSource)},open:function(tileSources,initialPage){var _this=this;if(this.close(),tileSources){if(this.sequenceMode&&$.isArray(tileSources))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===initialPage||isNaN(initialPage)||(this.initialPage=initialPage),this.tileSources=tileSources,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if((tileSources=!$.isArray(tileSources)?[tileSources]:tileSources).length){this._opening=!0;for(var failEvent,expected=tileSources.length,successes=0,failures=0,checkCompletion=function(){if(successes+failures===expected)if(successes){!_this._firstOpen&&_this.preserveViewport||(_this.viewport.goHome(!0),_this.viewport.update()),_this._firstOpen=!1;var source=tileSources[0];if(source.tileSource&&(source=source.tileSource),_this.overlays&&!_this.preserveOverlays)for(var i=0;i<_this.overlays.length;i++)_this.currentOverlays[i]=getOverlayObject(_this,_this.overlays[i]);_this._drawOverlays(),_this._opening=!1,_this.raiseEvent("open",{source:source})}else _this._opening=!1,_this.raiseEvent("open-failed",failEvent)},i=0;i<tileSources.length;i++)!function(options){void 0!==(options=!$.isPlainObject(options)||!options.tileSource?{tileSource:options}:options).index&&($.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete options.index),void 0===options.collectionImmediately&&(options.collectionImmediately=!0);var originalSuccess=options.success;options.success=function(event){if(successes++,options.tileSource.overlays)for(var i=0;i<options.tileSource.overlays.length;i++)_this.addOverlay(options.tileSource.overlays[i]);originalSuccess&&originalSuccess(event),checkCompletion()};var originalError=options.error;options.error=function(event){failures++,failEvent=failEvent||event,originalError&&originalError(event),checkCompletion()},_this.addTiledImage(options)}(tileSources[i]);return this}}},close:function(){return THIS[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),THIS[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(THIS[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&($.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),THIS[this.hash]=null,delete THIS[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(enabled){return this.innerTracker.setTracking(enabled),this.outerTracker.setTracking(enabled),this.raiseEvent("mouse-enabled",{enabled:enabled}),this},areControlsEnabled:function(){for(var enabled=this.controls.length,i=0;i<this.controls.length;i++)enabled=enabled&&this.controls[i].isVisible();return enabled},setControlsEnabled:function(enabled){return(enabled?abortControlsAutoHide:beginControlsAutoHide)(this),this.raiseEvent("controls-enabled",{enabled:enabled}),this},setDebugMode:function(debugMode){for(var i=0;i<this.world.getItemCount();i++)this.world.getItemAt(i).debugMode=debugMode;this.debugMode=debugMode,this.forceRedraw()},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(fullPage){var nodes,i,body=document.body,bodyStyle=body.style,docStyle=document.documentElement.style,_this=this;if(fullPage==this.isFullPage())return this;var fullPageEventArgs={fullPage:fullPage,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",fullPageEventArgs),fullPageEventArgs.preventDefaultAction)return this;if(fullPage){for(this.elementSize=$.getElementSize(this.element),this.pageScroll=$.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=bodyStyle.margin,this.docMargin=docStyle.margin,bodyStyle.margin="0",docStyle.margin="0",this.bodyPadding=bodyStyle.padding,this.docPadding=docStyle.padding,bodyStyle.padding="0",docStyle.padding="0",this.bodyWidth=bodyStyle.width,this.docWidth=docStyle.width,bodyStyle.width="100%",docStyle.width="100%",this.bodyHeight=bodyStyle.height,this.docHeight=docStyle.height,bodyStyle.height="100%",docStyle.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementWidth=this.element.style.width,THIS[this.hash].prevElementHeight=this.element.style.height,nodes=body.childNodes.length,i=0;i<nodes;i++)this.previousBody.push(body.childNodes[0]),body.removeChild(body.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,body.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),body.appendChild(this.element),this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,bodyStyle.margin=this.bodyMargin,docStyle.margin=this.docMargin,bodyStyle.padding=this.bodyPadding,docStyle.padding=this.docPadding,bodyStyle.width=this.bodyWidth,docStyle.width=this.docWidth,bodyStyle.height=this.bodyHeight,docStyle.height=this.docHeight,body.removeChild(this.element),nodes=this.previousBody.length,i=0;i<nodes;i++)body.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(body.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=THIS[this.hash].prevElementWidth,this.element.style.height=THIS[this.hash].prevElementHeight;var restoreScrollCounter=0,restoreScroll=function(){$.setPageScroll(_this.pageScroll);var pageScroll=$.getPageScroll();++restoreScrollCounter<10&&(pageScroll.x!==_this.pageScroll.x||pageScroll.y!==_this.pageScroll.y)&&$.requestAnimationFrame(restoreScroll)};$.requestAnimationFrame(restoreScroll),THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:fullPage}),this},setFullScreen:function(fullScreen){var _this=this;if(!$.supportsFullScreen)return this.setFullPage(fullScreen);if($.isFullScreen()===fullScreen)return this;var fullScreeEventArgs={fullScreen:fullScreen,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",fullScreeEventArgs),fullScreeEventArgs.preventDefaultAction)return this;if(fullScreen){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var onFullScreenChange=function(){var isFullScreen=$.isFullScreen();isFullScreen||($.removeEvent(document,$.fullScreenEventName,onFullScreenChange),$.removeEvent(document,$.fullScreenErrorEventName,onFullScreenChange),_this.setFullPage(!1),_this.isFullPage()&&(_this.element.style.width=_this.fullPageStyleWidth,_this.element.style.height=_this.fullPageStyleHeight)),_this.navigator&&_this.viewport&&setTimeout(function(){_this.navigator.update(_this.viewport)}),_this.raiseEvent("full-screen",{fullScreen:isFullScreen})};$.addEvent(document,$.fullScreenEventName,onFullScreenChange),$.addEvent(document,$.fullScreenErrorEventName,onFullScreenChange),$.requestFullScreen(document.body)}else $.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(visible){return this.container.style.visibility=visible?"":"hidden",this.raiseEvent("visible",{visible:visible}),this},addTiledImage:function(options){$.console.assert(options,"[Viewer.addTiledImage] options is required"),$.console.assert(options.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),$.console.assert(!options.replace||-1<options.index&&options.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var _this=this;options.replace&&(options.replaceItem=_this.world.getItemAt(options.index)),this._hideMessage(),void 0===options.placeholderFillStyle&&(options.placeholderFillStyle=this.placeholderFillStyle),void 0===options.opacity&&(options.opacity=this.opacity),void 0===options.preload&&(options.preload=this.preload),void 0===options.compositeOperation&&(options.compositeOperation=this.compositeOperation),void 0===options.crossOriginPolicy&&(options.crossOriginPolicy=(void 0!==options.tileSource.crossOriginPolicy?options.tileSource:this).crossOriginPolicy),void 0===options.ajaxWithCredentials&&(options.ajaxWithCredentials=this.ajaxWithCredentials),void 0===options.loadTilesWithAjax&&(options.loadTilesWithAjax=this.loadTilesWithAjax),void 0===options.ajaxHeaders||null===options.ajaxHeaders?options.ajaxHeaders=this.ajaxHeaders:$.isPlainObject(options.ajaxHeaders)&&$.isPlainObject(this.ajaxHeaders)&&(options.ajaxHeaders=$.extend({},this.ajaxHeaders,options.ajaxHeaders));var myQueueItem={options:options};function raiseAddItemFailed(event){for(var i=0;i<_this._loadQueue.length;i++)if(_this._loadQueue[i]===myQueueItem){_this._loadQueue.splice(i,1);break}0===_this._loadQueue.length&&refreshWorld(myQueueItem),_this.raiseEvent("add-item-failed",event),options.error&&options.error(event)}function refreshWorld(theItem){_this.collectionMode&&(_this.world.arrange({immediately:theItem.options.collectionImmediately,rows:_this.collectionRows,columns:_this.collectionColumns,layout:_this.collectionLayout,tileSize:_this.collectionTileSize,tileMargin:_this.collectionTileMargin}),_this.world.setAutoRefigureSizes(!0))}function processReadyItems(){for(var queueItem,tiledImage,optionsClone;_this._loadQueue.length&&(queueItem=_this._loadQueue[0]).tileSource;)_this._loadQueue.splice(0,1),queueItem.options.replace&&(-1!=(optionsClone=_this.world.getIndexOfItem(queueItem.options.replaceItem))&&(queueItem.options.index=optionsClone),_this.world.removeItem(queueItem.options.replaceItem)),tiledImage=new $.TiledImage({viewer:_this,source:queueItem.tileSource,viewport:_this.viewport,drawer:_this.drawer,tileCache:_this.tileCache,imageLoader:_this.imageLoader,x:queueItem.options.x,y:queueItem.options.y,width:queueItem.options.width,height:queueItem.options.height,fitBounds:queueItem.options.fitBounds,fitBoundsPlacement:queueItem.options.fitBoundsPlacement,clip:queueItem.options.clip,placeholderFillStyle:queueItem.options.placeholderFillStyle,opacity:queueItem.options.opacity,preload:queueItem.options.preload,degrees:queueItem.options.degrees,compositeOperation:queueItem.options.compositeOperation,springStiffness:_this.springStiffness,animationTime:_this.animationTime,minZoomImageRatio:_this.minZoomImageRatio,wrapHorizontal:_this.wrapHorizontal,wrapVertical:_this.wrapVertical,immediateRender:_this.immediateRender,blendTime:_this.blendTime,alwaysBlend:_this.alwaysBlend,minPixelRatio:_this.minPixelRatio,smoothTileEdgesMinZoom:_this.smoothTileEdgesMinZoom,iOSDevice:_this.iOSDevice,crossOriginPolicy:queueItem.options.crossOriginPolicy,ajaxWithCredentials:queueItem.options.ajaxWithCredentials,loadTilesWithAjax:queueItem.options.loadTilesWithAjax,ajaxHeaders:queueItem.options.ajaxHeaders,debugMode:_this.debugMode}),_this.collectionMode&&_this.world.setAutoRefigureSizes(!1),_this.world.addItem(tiledImage,{index:queueItem.options.index}),0===_this._loadQueue.length&&refreshWorld(queueItem),1!==_this.world.getItemCount()||_this.preserveViewport||_this.viewport.goHome(!0),_this.navigator&&(optionsClone=$.extend({},queueItem.options,{replace:!1,originalTiledImage:tiledImage,tileSource:queueItem.tileSource}),_this.navigator.addTiledImage(optionsClone)),queueItem.options.success&&queueItem.options.success({item:tiledImage})}$.isArray(options.tileSource)?setTimeout(function(){raiseAddItemFailed({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:options.tileSource,options:options})}):(this._loadQueue.push(myQueueItem),function(viewer,tileSource,imgOptions,successCallback,failCallback){var _this=viewer;if("string"==$.type(tileSource))if(tileSource.match(/^\s*<.*>\s*$/))tileSource=$.parseXml(tileSource);else if(tileSource.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var tileSourceJ=$.parseJSON(tileSource);tileSource=tileSourceJ}catch(e){}function waitUntilReady(tileSource,originalTileSource){tileSource.ready?successCallback(tileSource):(tileSource.addHandler("ready",function(){successCallback(tileSource)}),tileSource.addHandler("open-failed",function(event){failCallback({message:event.message,source:originalTileSource})}))}setTimeout(function(){var $TileSource,options;"string"==$.type(tileSource)?(tileSource=new $.TileSource({url:tileSource,crossOriginPolicy:(void 0!==imgOptions.crossOriginPolicy?imgOptions:viewer).crossOriginPolicy,ajaxWithCredentials:viewer.ajaxWithCredentials,ajaxHeaders:viewer.ajaxHeaders,useCanvas:viewer.useCanvas,success:function(event){successCallback(event.tileSource)}})).addHandler("open-failed",function(event){failCallback(event)}):$.isPlainObject(tileSource)||tileSource.nodeType?(void 0!==tileSource.crossOriginPolicy||void 0===imgOptions.crossOriginPolicy&&void 0===viewer.crossOriginPolicy||(tileSource.crossOriginPolicy=(void 0!==imgOptions.crossOriginPolicy?imgOptions:viewer).crossOriginPolicy),void 0===tileSource.ajaxWithCredentials&&(tileSource.ajaxWithCredentials=viewer.ajaxWithCredentials),void 0===tileSource.useCanvas&&(tileSource.useCanvas=viewer.useCanvas),$.isFunction(tileSource.getTileUrl)?((options=new $.TileSource(tileSource)).getTileUrl=tileSource.getTileUrl,successCallback(options)):($TileSource=$.TileSource.determineType(_this,tileSource))?(options=$TileSource.prototype.configure.apply(_this,[tileSource]),waitUntilReady(new $TileSource(options),tileSource)):failCallback({message:"Unable to load TileSource",source:tileSource})):waitUntilReady(tileSource,tileSource)})}(this,options.tileSource,options,function(tileSource){myQueueItem.tileSource=tileSource,processReadyItems()},function(event){event.options=options,raiseAddItemFailed(event),processReadyItems()}))},addSimpleImage:function(opts){$.console.assert(opts,"[Viewer.addSimpleImage] options is required"),$.console.assert(opts.url,"[Viewer.addSimpleImage] options.url is required");opts=$.extend({},opts,{tileSource:{type:"image",url:opts.url}});delete opts.url,this.addTiledImage(opts)},addLayer:function(options){var _this=this;$.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var optionsClone=$.extend({},options,{success:function(event){_this.raiseEvent("add-layer",{options:options,drawer:event.item})},error:function(event){_this.raiseEvent("add-layer-failed",event)}});return this.addTiledImage(optionsClone),this},getLayerAtLevel:function(level){return $.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(level)},getLevelOfLayer:function(drawer){return $.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(drawer)},getLayersCount:function(){return $.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(drawer,level){return $.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(drawer,level)},removeLayer:function(drawer){return $.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(drawer)},forceRedraw:function(){return THIS[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var onFocusHandler=$.delegate(this,onFocus),onBlurHandler=$.delegate(this,onBlur),onNextHandler=$.delegate(this,onNext),onPreviousHandler=$.delegate(this,onPrevious),navImages=this.navImages,useGroup=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(useGroup=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,navImages.previous.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.previous.DOWN),onRelease:onPreviousHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,navImages.next.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.next.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.next.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.next.DOWN),onRelease:onNextHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),useGroup&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:$.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||$.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var beginZoomingInHandler=$.delegate(this,beginZoomingIn),endZoomingHandler=$.delegate(this,endZooming),doSingleZoomInHandler=$.delegate(this,doSingleZoomIn),beginZoomingOutHandler=$.delegate(this,beginZoomingOut),doSingleZoomOutHandler=$.delegate(this,doSingleZoomOut),onHomeHandler=$.delegate(this,onHome),onFullScreenHandler=$.delegate(this,onFullScreen),onRotateLeftHandler=$.delegate(this,onRotateLeft),onRotateRightHandler=$.delegate(this,onRotateRight),onFlipHandler=$.delegate(this,onFlip),onFocusHandler=$.delegate(this,onFocus),onBlurHandler=$.delegate(this,onBlur),navImages=this.navImages,buttons=[],useGroup=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(useGroup=!1),this.showZoomControl&&(buttons.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,navImages.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.zoomIn.DOWN),onPress:beginZoomingInHandler,onRelease:endZoomingHandler,onClick:doSingleZoomInHandler,onEnter:beginZoomingInHandler,onExit:endZoomingHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),buttons.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,navImages.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.zoomOut.DOWN),onPress:beginZoomingOutHandler,onRelease:endZoomingHandler,onClick:doSingleZoomOutHandler,onEnter:beginZoomingOutHandler,onExit:endZoomingHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}))),this.showHomeControl&&buttons.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,navImages.home.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.home.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.home.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.home.DOWN),onRelease:onHomeHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),this.showFullPageControl&&buttons.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,navImages.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.fullpage.DOWN),onRelease:onFullScreenHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),this.showRotationControl&&(buttons.push(this.rotateLeftButton=new $.Button({element:this.rotateLeftButton?$.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateLeft"),srcRest:resolveUrl(this.prefixUrl,navImages.rotateleft.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.rotateleft.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.rotateleft.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.rotateleft.DOWN),onRelease:onRotateLeftHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),buttons.push(this.rotateRightButton=new $.Button({element:this.rotateRightButton?$.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateRight"),srcRest:resolveUrl(this.prefixUrl,navImages.rotateright.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.rotateright.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.rotateright.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.rotateright.DOWN),onRelease:onRotateRightHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}))),this.showFlipControl&&buttons.push(this.flipButton=new $.Button({element:this.flipButton?$.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Flip"),srcRest:resolveUrl(this.prefixUrl,navImages.flip.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.flip.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.flip.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.flip.DOWN),onRelease:onFlipHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),useGroup&&(this.buttons=new $.ButtonGroup({buttons:buttons,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||$.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(page){return this.tileSources&&0<=page&&page<this.tileSources.length&&(this._sequenceIndex=page,this._updateSequenceButtons(page),this.open(this.tileSources[page]),this.referenceStrip&&this.referenceStrip.setFocus(page),this.raiseEvent("page",{page:page})),this},addOverlay:function(element,location,options,overlay){options=$.isPlainObject(element)?element:{element:element,location:location,placement:options,onDraw:overlay};if(element=$.getElement(options.element),0<=getOverlayIndex(this.currentOverlays,element))return this;overlay=getOverlayObject(this,options);return this.currentOverlays.push(overlay),overlay.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:element,location:options.location,placement:options.placement}),this},updateOverlay:function(element,location,placement){var i;return element=$.getElement(element),0<=(i=getOverlayIndex(this.currentOverlays,element))&&(this.currentOverlays[i].update(location,placement),THIS[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:element,location:location,placement:placement})),this},removeOverlay:function(element){var i;return element=$.getElement(element),0<=(i=getOverlayIndex(this.currentOverlays,element))&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),THIS[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:element})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return THIS[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(i){return i=$.getElement(i),0<=(i=getOverlayIndex(this.currentOverlays,i))?this.currentOverlays[i]:null},_updateSequenceButtons:function(page){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==page?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<page?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(message){this._hideMessage();var div=$.makeNeutralElement("div");div.appendChild(document.createTextNode(message)),this.messageDiv=$.makeCenteredNode(div),$.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var div=this.messageDiv;div&&(div.parentNode.removeChild(div),delete this.messageDiv)},gestureSettingsByDeviceType:function(type){switch(type){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){for(var length=this.currentOverlays.length,i=0;i<length;i++)this.currentOverlays[i].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?this.referenceStrip||this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new $.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):$.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function($){function onCanvasClick(target){var canvasClickEventArgs={tracker:target.eventSource,position:target.position,quick:target.quick,shift:target.shift,originalEvent:target.originalEvent,preventDefaultAction:target.preventDefaultAction};this.viewer.raiseEvent("navigator-click",canvasClickEventArgs),!canvasClickEventArgs.preventDefaultAction&&target.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(target.position.x=this.viewport.getContainerSize().x-target.position.x),target=this.viewport.pointFromPixel(target.position),this.panVertical?this.panHorizontal||(target.x=this.viewer.viewport.getCenter(!0).x):target.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(target),this.viewer.viewport.applyConstraints())}function onCanvasDrag(event){var canvasDragEventArgs={tracker:event.eventSource,position:event.position,delta:event.delta,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",canvasDragEventArgs),!canvasDragEventArgs.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(event.delta.x=0),this.panVertical||(event.delta.y=0),this.viewer.viewport.flipped&&(event.delta.x=-event.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(event.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function onCanvasRelease(event){event.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function onCanvasScroll(event){return this.viewer.raiseEvent("navigator-scroll",{tracker:event.eventSource,position:event.position,scroll:event.scroll,shift:event.shift,originalEvent:event.originalEvent}),!1}function _setTransformRotate(element,degrees){setElementTransform(element,"rotate("+degrees+"deg)")}function setElementTransform(element,rule){element.style.webkitTransform=rule,element.style.mozTransform=rule,element.style.msTransform=rule,element.style.oTransform=rule,element.style.transform=rule}$.Navigator=function(options){var navigatorSize,borderWidth,viewer=options.viewer,_this=this;function rotate(degrees){_setTransformRotate(_this.displayRegionContainer,degrees),_setTransformRotate(_this.displayRegion,-degrees),_this.viewport.setRotation(degrees)}options.id?(this.element=document.getElementById(options.id),options.controlOptions={anchor:$.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(options.id="navigator-"+$.now(),this.element=$.makeNeutralElement("div"),options.controlOptions={anchor:$.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:options.autoFade},options.position&&("BOTTOM_RIGHT"==options.position?options.controlOptions.anchor=$.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==options.position?options.controlOptions.anchor=$.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==options.position?options.controlOptions.anchor=$.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==options.position?options.controlOptions.anchor=$.ControlAnchor.TOP_LEFT:"ABSOLUTE"==options.position&&(options.controlOptions.anchor=$.ControlAnchor.ABSOLUTE,options.controlOptions.top=options.top,options.controlOptions.left=options.left,options.controlOptions.height=options.height,options.controlOptions.width=options.width))),this.element.id=options.id,this.element.className+=" navigator",(options=$.extend(!0,{sizeRatio:$.DEFAULT_SETTINGS.navigatorSizeRatio},options,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:options.autoResize,minZoomImageRatio:1,background:options.background,opacity:options.opacity,borderColor:options.borderColor,displayRegionColor:options.displayRegionColor})).minPixelRatio=this.minPixelRatio=viewer.minPixelRatio,$.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new $.Point(1,1),this.totalBorderWidths=new $.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),options.controlOptions.anchor!=$.ControlAnchor.NONE&&(navigatorSize=this.element.style,borderWidth=this.borderWidth,navigatorSize.margin="0px",navigatorSize.border=borderWidth+"px solid "+options.borderColor,navigatorSize.padding="0px",navigatorSize.background=options.background,navigatorSize.opacity=options.opacity,navigatorSize.overflow="hidden"),this.displayRegion=$.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(style,borderWidth){style.position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.border=borderWidth+"px solid "+options.displayRegionColor,style.margin="0px",style.padding="0px",style.background="transparent",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=$.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",viewer.addControl(this.element,options.controlOptions),this._resizeWithViewer=options.controlOptions.anchor!=$.ControlAnchor.ABSOLUTE&&options.controlOptions.anchor!=$.ControlAnchor.NONE,options.width&&options.height?(this.setWidth(options.width),this.setHeight(options.height)):this._resizeWithViewer&&(navigatorSize=$.getElementSize(viewer.element),this.element.style.height=Math.round(navigatorSize.y*options.sizeRatio)+"px",this.element.style.width=Math.round(navigatorSize.x*options.sizeRatio)+"px",this.oldViewerSize=navigatorSize,navigatorSize=$.getElementSize(this.element),this.elementArea=navigatorSize.x*navigatorSize.y),this.oldContainerSize=new $.Point(0,0),$.Viewer.apply(this,[options]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),options.navigatorRotate&&(rotate(options.viewer.viewport?options.viewer.viewport.getRotation():options.viewer.degrees||0),options.viewer.addHandler("rotate",function(args){rotate(args.degrees)})),this.innerTracker.destroy(),this.innerTracker=new $.MouseTracker({element:this.element,dragHandler:$.delegate(this,onCanvasDrag),clickHandler:$.delegate(this,onCanvasClick),releaseHandler:$.delegate(this,onCanvasRelease),scrollHandler:$.delegate(this,onCanvasScroll)}),this.addHandler("reset-size",function(){_this.viewport&&_this.viewport.goHome(!0)}),viewer.world.addHandler("item-index-change",function(event){window.setTimeout(function(){var item=_this.world.getItemAt(event.previousIndex);_this.world.setItemIndex(item,event.newIndex)},1)}),viewer.world.addHandler("remove-item",function(myItem){myItem=myItem.item,myItem=_this._getMatchingItem(myItem);myItem&&_this.world.removeItem(myItem)}),this.update(viewer.viewport)},$.extend($.Navigator.prototype,$.EventSource.prototype,$.Viewer.prototype,{updateSize:function(){var containerSize;this.viewport&&((containerSize=new $.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight)).equals(this.oldContainerSize)||(this.viewport.resize(containerSize,!0),this.viewport.goHome(!0),this.oldContainerSize=containerSize,this.drawer.clear(),this.world.draw()))},setWidth:function(width){this.width=width,this.element.style.width="number"==typeof width?width+"px":width,this._resizeWithViewer=!1},setHeight:function(height){this.height=height,this.element.style.height="number"==typeof height?height+"px":height,this._resizeWithViewer=!1},setFlip:function(state){return this.viewport.setFlip(state),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(rule){setElementTransform(this.displayRegion,rule),setElementTransform(this.canvas,rule),setElementTransform(this.element,rule)},update:function(style){var topleft,height,width=$.getElementSize(this.viewer.element);this._resizeWithViewer&&width.x&&width.y&&!width.equals(this.oldViewerSize)&&(this.oldViewerSize=width,height=this.maintainSizeRatio||!this.elementArea?(topleft=width.x*this.sizeRatio,width.y*this.sizeRatio):(topleft=Math.sqrt(this.elementArea*(width.x/width.y)),this.elementArea/topleft),this.element.style.width=Math.round(topleft)+"px",this.element.style.height=Math.round(height)+"px",this.elementArea||(this.elementArea=topleft*height),this.updateSize()),style&&this.viewport&&(width=style.getBoundsNoRotate(!0),topleft=this.viewport.pixelFromPointNoRotate(width.getTopLeft(),!1),height=this.viewport.pixelFromPointNoRotate(width.getBottomRight(),!1).minus(this.totalBorderWidths),(style=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",style.top=Math.round(topleft.y)+"px",style.left=Math.round(topleft.x)+"px",width=Math.abs(topleft.x-height.x),height=Math.abs(topleft.y-height.y),style.width=Math.round(Math.max(width,0))+"px",style.height=Math.round(Math.max(height,0))+"px")},addTiledImage:function(optionsClone){var _this=this,original=optionsClone.originalTiledImage;delete optionsClone.original;optionsClone=$.extend({},optionsClone,{success:function(event){var myItem=event.item;function matchBounds(){_this._matchBounds(myItem,original)}myItem._originalForNavigator=original,_this._matchBounds(myItem,original,!0),original.addHandler("bounds-change",matchBounds),original.addHandler("clip-change",matchBounds),original.addHandler("opacity-change",function(){_this._matchOpacity(myItem,original)}),original.addHandler("composite-operation-change",function(){_this._matchCompositeOperation(myItem,original)})}});return $.Viewer.prototype.addTiledImage.apply(this,[optionsClone])},_getMatchingItem:function(theirItem){for(var item,count=this.world.getItemCount(),i=0;i<count;i++)if((item=this.world.getItemAt(i))._originalForNavigator===theirItem)return item;return null},_matchBounds:function(myItem,theirItem,immediately){var bounds=theirItem.getBoundsNoRotate();myItem.setPosition(bounds.getTopLeft(),immediately),myItem.setWidth(bounds.width,immediately),myItem.setRotation(theirItem.getRotation(),immediately),myItem.setClip(theirItem.getClip())},_matchOpacity:function(myItem,theirItem){myItem.setOpacity(theirItem.opacity)},_matchCompositeOperation:function(myItem,theirItem){myItem.setCompositeOperation(theirItem.compositeOperation)}})}(OpenSeadragon),function($){var I18N={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};$.extend($,{getString:function(prop){for(var props=prop.split("."),string=null,args=arguments,container=I18N,i=0;i<props.length-1;i++)container=container[props[i]]||{};return"string"!=typeof(string=container[props[i]])&&($.console.log("Untranslated source string:",prop),string=""),string.replace(/\{\d+\}/g,function(i){i=parseInt(i.match(/\d+/),10)+1;return i<args.length?args[i]:""})},setString:function(prop,value){for(var props=prop.split("."),container=I18N,i=0;i<props.length-1;i++)container[props[i]]||(container[props[i]]={}),container=container[props[i]];container[props[i]]=value}})}(OpenSeadragon),function($){$.Point=function(x,y){this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0},$.Point.prototype={clone:function(){return new $.Point(this.x,this.y)},plus:function(point){return new $.Point(this.x+point.x,this.y+point.y)},minus:function(point){return new $.Point(this.x-point.x,this.y-point.y)},times:function(factor){return new $.Point(this.x*factor,this.y*factor)},divide:function(factor){return new $.Point(this.x/factor,this.y/factor)},negate:function(){return new $.Point(-this.x,-this.y)},distanceTo:function(point){return Math.sqrt(Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2))},squaredDistanceTo:function(point){return Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2)},apply:function(func){return new $.Point(func(this.x),func(this.y))},equals:function(point){return point instanceof $.Point&&this.x===point.x&&this.y===point.y},rotate:function(degrees,y){if(y=y||new $.Point(0,0),degrees%90==0)switch($.positiveModulo(degrees,360)){case 0:cos=1,sin=0;break;case 90:cos=0,sin=1;break;case 180:cos=-1,sin=0;break;case 270:cos=0,sin=-1}else var x=degrees*Math.PI/180,cos=Math.cos(x),sin=Math.sin(x);x=cos*(this.x-y.x)-sin*(this.y-y.y)+y.x,y=sin*(this.x-y.x)+cos*(this.y-y.y)+y.y;return new $.Point(x,y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function($){$.TileSource=function(width,height,tileSize,tileOverlap,minLevel,maxLevel){var i,_this=this,options=arguments,options=$.isPlainObject(width)?width:{width:options[0],height:options[1],tileSize:options[2],tileOverlap:options[3],minLevel:options[4],maxLevel:options[5]};if($.EventSource.call(this),$.extend(!0,this,options),!this.success)for(i=0;i<arguments.length;i++)if($.isFunction(arguments[i])){this.success=arguments[i];break}this.success&&this.addHandler("ready",function(event){_this.success(event)}),"string"==$.type(width)&&(this.url=width),this.url?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=options.width&&options.height?options.width/options.height:1,this.dimensions=new $.Point(options.width,options.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=options.tileOverlap||0,this.minLevel=options.minLevel||0,this.maxLevel=void 0!==options.maxLevel&&null!==options.maxLevel?options.maxLevel:options.width&&options.height?Math.ceil(Math.log(Math.max(options.width,options.height))/Math.log(2)):0,this.success&&$.isFunction(this.success)&&this.success(this))},$.TileSource.prototype={getTileSize:function(level){return $.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(level){return this._tileWidth||this.getTileSize(level)},getTileHeight:function(level){return this._tileHeight||this.getTileSize(level)},getLevelScale:function(level){for(var levelScaleCache={},i=0;i<=this.maxLevel;i++)levelScaleCache[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(_level){return levelScaleCache[_level]},this.getLevelScale(level)},getNumTiles:function(y){var scale=this.getLevelScale(y),x=Math.ceil(scale*this.dimensions.x/this.getTileWidth(y)),y=Math.ceil(scale*this.dimensions.y/this.getTileHeight(y));return new $.Point(x,y)},getPixelRatio:function(rx){var ry=this.dimensions.times(this.getLevelScale(rx)),rx=1/ry.x,ry=1/ry.y;return new $.Point(rx,ry)},getClosestLevel:function(){for(var tiles,i=this.minLevel+1;i<=this.maxLevel&&!(1<(tiles=this.getNumTiles(i)).x||1<tiles.y);i++);return i-1},getTileAtPoint:function(level,point){var x=0<=point.x&&point.x<=1&&0<=point.y&&point.y<=1/this.aspectRatio;$.console.assert(x,"[TileSource.getTileAtPoint] must be called with a valid point.");var y=this.dimensions.x*this.getLevelScale(level),x=point.x*y,y=point.y*y,x=Math.floor(x/this.getTileWidth(level)),y=Math.floor(y/this.getTileHeight(level));1<=point.x&&(x=this.getNumTiles(level).x-1);return point.y>=1/this.aspectRatio-1e-15&&(y=this.getNumTiles(level).y-1),new $.Point(x,y)},getTileBounds:function(py,sx,scale,isSource){var dimensionsScaled=this.dimensions.times(this.getLevelScale(py)),tileWidth=this.getTileWidth(py),sy=this.getTileHeight(py),px=0===sx?0:tileWidth*sx-this.tileOverlap,py=0===scale?0:sy*scale-this.tileOverlap,sx=tileWidth+(0===sx?1:2)*this.tileOverlap,sy=sy+(0===scale?1:2)*this.tileOverlap,scale=1/dimensionsScaled.x,sx=Math.min(sx,dimensionsScaled.x-px),sy=Math.min(sy,dimensionsScaled.y-py);return isSource?new $.Rect(0,0,sx,sy):new $.Rect(px*scale,py*scale,sx*scale,sy*scale)},getImageInfo:function(url){var callback,readySource,urlParts,filename,callbackName,_this=this;url&&-1<(callbackName=(filename=(urlParts=url.split("/"))[urlParts.length-1]).lastIndexOf("."))&&(urlParts[urlParts.length-1]=filename.slice(0,callbackName)),callback=function(data){"string"==typeof data&&(data=$.parseXml(data));var $TileSource=$.TileSource.determineType(_this,data,url);$TileSource?(void 0===(readySource=$TileSource.prototype.configure.apply(_this,[data,url])).ajaxWithCredentials&&(readySource.ajaxWithCredentials=_this.ajaxWithCredentials),readySource=new $TileSource(readySource),_this.ready=!0,_this.raiseEvent("ready",{tileSource:readySource})):_this.raiseEvent("open-failed",{message:"Unable to load TileSource",source:url})},url.match(/\.js$/)?(callbackName=url.split("/").pop().replace(".js",""),$.jsonp({url:url,async:!1,callbackName:callbackName,callback:callback})):$.makeAjaxRequest({url:url,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(data){data=function(xhr){var statusText,data,responseText=xhr.responseText,status=xhr.status;{if(!xhr)throw new Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,new Error($.getString("Errors.Status",status,statusText))}if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else if(responseText.match(/\s*[\{\[].*/))try{data=$.parseJSON(responseText)}catch(e){data=responseText}else data=responseText;return data}(data);callback(data)},error:function(xhr,formattedExc){try{msg="HTTP "+xhr.status+" attempting to load TileSource"}catch(e){var formattedExc=void 0!==formattedExc&&formattedExc.toString?formattedExc.toString():"Unknown error",msg=formattedExc+" attempting to load TileSource"}_this.raiseEvent("open-failed",{message:msg,source:url})}})},supports:function(data,url){return!1},configure:function(data,url){throw new Error("Method not implemented.")},getTileUrl:function(level,x,y){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(level,x,y){return{}},tileExists:function(level,x,y){var numTiles=this.getNumTiles(level);return level>=this.minLevel&&level<=this.maxLevel&&0<=x&&0<=y&&x<numTiles.x&&y<numTiles.y}},$.extend(!0,$.TileSource.prototype,$.EventSource.prototype),$.TileSource.determineType=function(tileSource,data,url){for(var property in OpenSeadragon)if(property.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[property])&&$.isFunction(OpenSeadragon[property].prototype.supports)&&OpenSeadragon[property].prototype.supports.call(tileSource,data,url))return OpenSeadragon[property];$.console.error("No TileSource was able to open %s %s",url,data)}}(OpenSeadragon),function($){function configureFromObject(tileSource,configuration){for(var rectData,tileOverlap=configuration.Image,tilesUrl=tileOverlap.Url,fileFormat=tileOverlap.Format,tileSize=tileOverlap.Size,dispRectData=tileOverlap.DisplayRect||[],width=parseInt(tileSize.Width,10),height=parseInt(tileSize.Height,10),tileSize=parseInt(tileOverlap.TileSize,10),tileOverlap=parseInt(tileOverlap.Overlap,10),displayRects=[],i=0;i<dispRectData.length;i++)rectData=dispRectData[i].Rect,displayRects.push(new $.DisplayRect(parseInt(rectData.X,10),parseInt(rectData.Y,10),parseInt(rectData.Width,10),parseInt(rectData.Height,10),parseInt(rectData.MinLevel,10),parseInt(rectData.MaxLevel,10)));return $.extend(!0,{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,minLevel:null,maxLevel:null,tilesUrl:tilesUrl,fileFormat:fileFormat,displayRects:displayRects},configuration)}$.DziTileSource=function(width,height,tileSize,tileOverlap,tilesUrl,fileFormat,displayRects,minLevel,maxLevel){var i,rect,level,options=$.isPlainObject(width)?width:{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,tilesUrl:tilesUrl,fileFormat:fileFormat,displayRects:displayRects,minLevel:minLevel,maxLevel:maxLevel};if(this._levelRects={},this.tilesUrl=options.tilesUrl,this.fileFormat=options.fileFormat,this.displayRects=options.displayRects,this.displayRects)for(i=this.displayRects.length-1;0<=i;i--)for(level=(rect=this.displayRects[i]).minLevel;level<=rect.maxLevel;level++)this._levelRects[level]||(this._levelRects[level]=[]),this._levelRects[level].push(rect);$.TileSource.apply(this,[options])},$.extend($.DziTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){var ns;return data.Image?ns=data.Image.xmlns:data.documentElement&&("Image"!=data.documentElement.localName&&"Image"!=data.documentElement.tagName||(ns=data.documentElement.namespaceURI)),-1!==(ns=(ns||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==ns.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(options,url){options=($.isPlainObject(options)?configureFromObject:function(tileSource,configuration){if(!configuration||!configuration.documentElement)throw new Error($.getString("Errors.Xml"));var dispRectNodes,dispRectNode,rectNode,sizeNode,i,message=configuration.documentElement,rootName=message.localName||message.tagName,ns=configuration.documentElement.namespaceURI,configuration=null,displayRects=[];if("Image"==rootName)try{if(void 0===(sizeNode=message.getElementsByTagName("Size")[0])&&(sizeNode=message.getElementsByTagNameNS(ns,"Size")[0]),configuration={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:message.getAttribute("Url"),Format:message.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(message.getAttribute("Overlap"),10),TileSize:parseInt(message.getAttribute("TileSize"),10),Size:{Height:parseInt(sizeNode.getAttribute("Height"),10),Width:parseInt(sizeNode.getAttribute("Width"),10)}}},!$.imageFormatSupported(configuration.Image.Format))throw new Error($.getString("Errors.ImageFormat",configuration.Image.Format.toUpperCase()));for(void 0===(dispRectNodes=message.getElementsByTagName("DisplayRect"))&&(dispRectNodes=message.getElementsByTagNameNS(ns,"DisplayRect")[0]),i=0;i<dispRectNodes.length;i++)dispRectNode=dispRectNodes[i],void 0===(rectNode=dispRectNode.getElementsByTagName("Rect")[0])&&(rectNode=dispRectNode.getElementsByTagNameNS(ns,"Rect")[0]),displayRects.push({Rect:{X:parseInt(rectNode.getAttribute("X"),10),Y:parseInt(rectNode.getAttribute("Y"),10),Width:parseInt(rectNode.getAttribute("Width"),10),Height:parseInt(rectNode.getAttribute("Height"),10),MinLevel:parseInt(dispRectNode.getAttribute("MinLevel"),10),MaxLevel:parseInt(dispRectNode.getAttribute("MaxLevel"),10)}});return displayRects.length&&(configuration.Image.DisplayRect=displayRects),configureFromObject(0,configuration)}catch(e){throw e instanceof Error?e:new Error($.getString("Errors.Dzi"))}else{if("Collection"==rootName)throw new Error($.getString("Errors.Dzc"));if("Error"==rootName){message=message.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(message)}}throw new Error($.getString("Errors.Dzi"))})(this,options);return url&&!options.tilesUrl&&(options.tilesUrl=url.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=url.search(/\.(dzi|xml|js)\?/)?options.queryParams=url.match(/\?.*/):options.queryParams=""),options},getTileUrl:function(level,x,y){return[this.tilesUrl,level,"/",x,"_",y,".",this.fileFormat,this.queryParams].join("")},tileExists:function(level,x,y){var rect,xMin,yMin,xMax,yMax,i,rects=this._levelRects[level];if(this.minLevel&&level<this.minLevel||this.maxLevel&&level>this.maxLevel)return!1;if(!rects||!rects.length)return!0;for(i=rects.length-1;0<=i;i--)if(!(level<(rect=rects[i]).minLevel||level>rect.maxLevel)&&(yMax=this.getLevelScale(level),xMin=rect.x*yMax,yMin=rect.y*yMax,xMax=xMin+rect.width*yMax,yMax=yMin+rect.height*yMax,xMin=Math.floor(xMin/this._tileWidth),yMin=Math.floor(yMin/this._tileWidth),xMax=Math.ceil(xMax/this._tileWidth),yMax=Math.ceil(yMax/this._tileWidth),xMin<=x&&x<xMax&&yMin<=y&&y<yMax))return!0;return!1}})}(OpenSeadragon),function($){function canBeTiled(options){var hasCanoncicalSizeFeature=Array.isArray(options.profile)?options.profile[0]:options.profile,isLevel0=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(hasCanoncicalSizeFeature),hasCanoncicalSizeFeature=!1;return 2===options.version&&1<options.profile.length&&options.profile[1].supports&&(hasCanoncicalSizeFeature=-1!==options.profile[1].supports.indexOf("sizeByW")),3===options.version&&options.extraFeatures&&(hasCanoncicalSizeFeature=-1!==options.extraFeatures.indexOf("sizeByWh")),!isLevel0||hasCanoncicalSizeFeature}function constructLevels(options){for(var levels=[],i=0;i<options.sizes.length;i++)levels.push({url:options["@id"]+"/full/"+options.sizes[i].width+","+(3===options.version?options.sizes[i].height:"")+"/0/default."+options.tileFormat,width:options.sizes[i].width,height:options.sizes[i].height});return levels.sort(function(a,b){return a.width-b.width})}$.IIIFTileSource=function(options){if($.extend(!0,this,options),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(options.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=options.version,this.tile_width&&this.tile_height)options.tileWidth=this.tile_width,options.tileHeight=this.tile_height;else if(this.tile_width)options.tileSize=this.tile_width;else if(this.tile_height)options.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)options.tileWidth=this.tiles[0].width,options.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var sf=0;sf<this.tiles[t].scaleFactors.length;sf++){var scaleFactor=this.tiles[t].scaleFactors[sf];this.scale_factors.push(scaleFactor),options.tileSizePerScaleFactor[scaleFactor]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(canBeTiled(options)){for(var shortDim=Math.min(this.height,this.width),tileOptions=[256,512,1024],smallerTiles=[],c=0;c<tileOptions.length;c++)tileOptions[c]<=shortDim&&smallerTiles.push(tileOptions[c]);0<smallerTiles.length?options.tileSize=Math.max.apply(null,smallerTiles):options.tileSize=shortDim}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,options.levels=constructLevels(this),$.extend(!0,options,{width:options.levels[options.levels.length-1].width,height:options.levels[options.levels.length-1].height,tileSize:Math.max(options.height,options.width),tileOverlap:0,minLevel:0,maxLevel:options.levels.length-1}),this.levels=options.levels):$.console.error("Nothing in the info.json to construct image pyramids from");var maxScaleFactor;options.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?(maxScaleFactor=Math.max.apply(null,this.scale_factors),options.maxLevel=Math.round(Math.log(maxScaleFactor)*Math.LOG2E)):options.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),$.TileSource.apply(this,[options])},$.extend($.IIIFTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return!(!data.protocol||"http://iiif.io/api/image"!=data.protocol)||(!(!data["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=data["@context"]&&"http://iiif.io/api/image/1/context.json"!=data["@context"])||(!(!data.profile||0!==data.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(data.identifier&&data.width&&data.height)||!(!data.documentElement||"info"!=data.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=data.documentElement.namespaceURI))))},configure:function(data,url){if($.isPlainObject(data)){if(data["@context"]){var context=data["@context"];if(Array.isArray(context))for(var i=0;i<context.length;i++)if("string"==typeof context[i]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(context[i])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===context[i])){context=context[i];break}switch(context){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":data.version=1;break;case"http://iiif.io/api/image/2/context.json":data.version=2;break;case"http://iiif.io/api/image/3/context.json":data.version=3;break;default:$.console.error("Data has a @context property which contains no known IIIF context URI.")}}else data["@context"]="http://iiif.io/api/image/1.0/context.json",data["@id"]=url.replace("/info.json",""),data.version=1;if(!data["@id"]&&data.id&&(data["@id"]=data.id),data.preferredFormats)for(var f=0;f<data.preferredFormats.length;f++)if(OpenSeadragon.imageFormatSupported(data.preferredFormats[f])){data.tileFormat=data.preferredFormats[f];break}return data}var options=function(configuration){if(!configuration||!configuration.documentElement)throw new Error($.getString("Errors.Xml"));var root=configuration.documentElement,rootName=root.tagName,configuration=null;if("info"==rootName)try{return function parseXML10(node,configuration,property){var i,value;if(3==node.nodeType&&property)(value=node.nodeValue.trim()).match(/^\d*$/)&&(value=Number(value)),configuration[property]?($.isArray(configuration[property])||(configuration[property]=[configuration[property]]),configuration[property].push(value)):configuration[property]=value;else if(1==node.nodeType)for(i=0;i<node.childNodes.length;i++)parseXML10(node.childNodes[i],configuration,node.nodeName)}(root,configuration={}),configuration}catch(e){throw e instanceof Error?e:new Error($.getString("Errors.IIIF"))}throw new Error($.getString("Errors.IIIF"))}(data);return options["@context"]="http://iiif.io/api/image/1.0/context.json",options["@id"]=url.replace("/info.xml",""),options.version=1,options},getTileWidth:function(scaleFactor){if(this.emulateLegacyImagePyramid)return $.TileSource.prototype.getTileWidth.call(this,scaleFactor);scaleFactor=Math.pow(2,this.maxLevel-scaleFactor);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[scaleFactor]?this.tileSizePerScaleFactor[scaleFactor].width:this._tileWidth},getTileHeight:function(scaleFactor){if(this.emulateLegacyImagePyramid)return $.TileSource.prototype.getTileHeight.call(this,scaleFactor);scaleFactor=Math.pow(2,this.maxLevel-scaleFactor);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[scaleFactor]?this.tileSizePerScaleFactor[scaleFactor].height:this._tileHeight},getLevelScale:function(level){if(this.emulateLegacyImagePyramid){var levelScale=NaN;return levelScale=0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].width/this.levels[this.maxLevel].width:levelScale}return $.TileSource.prototype.getLevelScale.call(this,level)},getNumTiles:function(level){return this.emulateLegacyImagePyramid?this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0):$.TileSource.prototype.getNumTiles.call(this,level)},getTileAtPoint:function(level,point){return this.emulateLegacyImagePyramid?new $.Point(0,0):$.TileSource.prototype.getTileAtPoint.call(this,level,point)},getTileUrl:function(iiifQuality,x,y){if(this.emulateLegacyImagePyramid){var iiifTileH=null;return iiifTileH=0<this.levels.length&&iiifQuality>=this.minLevel&&iiifQuality<=this.maxLevel?this.levels[iiifQuality].url:iiifTileH}var iiifRegion,iiifSize,iiifSizeH=Math.pow(.5,this.maxLevel-iiifQuality),iiifTileY=Math.ceil(this.width*iiifSizeH),iiifTileX=Math.ceil(this.height*iiifSizeH),tileWidth=this.getTileWidth(iiifQuality),tileHeight=this.getTileHeight(iiifQuality),iiifSizeW=Math.ceil(tileWidth/iiifSizeH),iiifTileH=Math.ceil(tileHeight/iiifSizeH),iiifQuality=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat;return iiifTileY<tileWidth&&iiifTileX<tileHeight?(iiifSize=2===this.version&&iiifTileY===this.width||3===this.version&&iiifTileY===this.width&&iiifTileX===this.height?"max":3===this.version?iiifTileY+","+iiifTileX:iiifTileY+",",iiifRegion="full"):(iiifTileX=x*iiifSizeW,iiifTileY=y*iiifTileH,iiifSizeW=Math.min(iiifSizeW,this.width-iiifTileX),iiifTileH=Math.min(iiifTileH,this.height-iiifTileY),iiifRegion=0===x&&0===y&&iiifSizeW===this.width&&iiifTileH===this.height?"full":[iiifTileX,iiifTileY,iiifSizeW,iiifTileH].join(","),iiifSizeW=Math.ceil(iiifSizeW*iiifSizeH),iiifSizeH=Math.ceil(iiifTileH*iiifSizeH),iiifSize=2===this.version&&iiifSizeW===this.width||3===this.version&&iiifSizeW===this.width&&iiifSizeH===this.height?"max":3===this.version?iiifSizeW+","+iiifSizeH:iiifSizeW+","),[this["@id"],iiifRegion,iiifSize,"0",iiifQuality].join("/")},__testonly__:{canBeTiled:canBeTiled,constructLevels:constructLevels}})}(OpenSeadragon),function($){$.OsmTileSource=function(width,height,tileSize,tileOverlap,tilesUrl){var options=$.isPlainObject(width)?width:{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,tilesUrl:tilesUrl};options.width&&options.height||(options.width=65572864,options.height=65572864),options.tileSize||(options.tileSize=256,options.tileOverlap=0),options.tilesUrl||(options.tilesUrl="http://tile.openstreetmap.org/"),options.minLevel=8,$.TileSource.apply(this,[options])},$.extend($.OsmTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"openstreetmaps"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){return this.tilesUrl+(level-8)+"/"+x+"/"+y+".png"}})}(OpenSeadragon),function($){$.TmsTileSource=function(width,height,tileSize,tileOverlap,tilesUrl){var options=$.isPlainObject(width)?width:{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,tilesUrl:tilesUrl},bufferedWidth=256*Math.ceil(options.width/256),bufferedHeight=256*Math.ceil(options.height/256),max=bufferedHeight<bufferedWidth?bufferedWidth/256:bufferedHeight/256;options.maxLevel=Math.ceil(Math.log(max)/Math.log(2))-1,options.tileSize=256,options.width=bufferedWidth,options.height=bufferedHeight,$.TileSource.apply(this,[options])},$.extend($.TmsTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"tiledmapservice"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){var yTiles=this.getNumTiles(level).y-1;return this.tilesUrl+level+"/"+x+"/"+(yTiles-y)+".png"}})}(OpenSeadragon),function($){$.ZoomifyTileSource=function(options){options.tileSize=256;var currentImageSize={x:options.width,y:options.height};for(options.imageSizes=[{x:options.width,y:options.height}],options.gridSize=[this._getGridSize(options.width,options.height,options.tileSize)];parseInt(currentImageSize.x,10)>options.tileSize||parseInt(currentImageSize.y,10)>options.tileSize;)currentImageSize.x=Math.floor(currentImageSize.x/2),currentImageSize.y=Math.floor(currentImageSize.y/2),options.imageSizes.push({x:currentImageSize.x,y:currentImageSize.y}),options.gridSize.push(this._getGridSize(currentImageSize.x,currentImageSize.y,options.tileSize));options.imageSizes.reverse(),options.gridSize.reverse(),options.minLevel=0,options.maxLevel=options.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[options])},$.extend($.ZoomifyTileSource.prototype,$.TileSource.prototype,{_getGridSize:function(width,height,tileSize){return{x:Math.ceil(width/tileSize),y:Math.ceil(height/tileSize)}},_calculateAbsoluteTileNumber:function(level,x,y){for(var num=0,size={},z=0;z<level;z++)num+=(size=this.gridSize[z]).x*size.y;return num+=(size=this.gridSize[level]).x*y+x},supports:function(data,url){return data.type&&"zoomifytileservice"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){var num=this._calculateAbsoluteTileNumber(level,x,y),result=Math.floor(num/256);return this.tilesUrl+"TileGroup"+result+"/"+level+"-"+x+"-"+y+".jpg"}})}(OpenSeadragon),function($){$.LegacyTileSource=function(levels){var options,width,height;(options=$.isArray(levels)?{type:"legacy-image-pyramid",levels:levels}:options).levels=function(files){var file,i,filtered=[];for(i=0;i<files.length;i++)(file=files[i]).height&&file.width&&file.url?filtered.push({url:file.url,width:Number(file.width),height:Number(file.height)}):$.console.error("Unsupported image format: %s",file.url||"<no URL>");return filtered.sort(function(a,b){return a.height-b.height})}(options.levels),0<options.levels.length?(width=options.levels[options.levels.length-1].width,height=options.levels[options.levels.length-1].height):(height=width=0,$.console.error("No supported image formats found")),$.extend(!0,options,{width:width,height:height,tileSize:Math.max(height,width),tileOverlap:0,minLevel:0,maxLevel:0<options.levels.length?options.levels.length-1:0}),$.TileSource.apply(this,[options]),this.levels=options.levels},$.extend($.LegacyTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"legacy-image-pyramid"==data.type||data.documentElement&&"legacy-image-pyramid"==data.documentElement.getAttribute("type")},configure:function(options,dataUrl){options=$.isPlainObject(options)?options.levels:function(xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var level,i,root=xmlDoc.documentElement,rootName=root.tagName,conf=null,levels=[];if("image"==rootName)try{for(conf={type:root.getAttribute("type"),levels:[]},levels=root.getElementsByTagName("level"),i=0;i<levels.length;i++)level=levels[i],conf.levels.push({url:level.getAttribute("url"),width:parseInt(level.getAttribute("width"),10),height:parseInt(level.getAttribute("height"),10)});return conf.levels}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==rootName)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==rootName)throw new Error("Error: "+xmlDoc)}throw new Error("Unknown element "+rootName)}(options);return options},getLevelScale:function(level){var levelScale=NaN;return levelScale=0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].width/this.levels[this.maxLevel].width:levelScale},getNumTiles:function(level){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)},getTileUrl:function(level,x,y){var url=null;return url=0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].url:url}})}(OpenSeadragon),function($){$.ImageTileSource=function(options){options=$.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},options),$.TileSource.apply(this,[options])},$.extend($.ImageTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"image"===data.type},configure:function(options,dataUrl){return options},getImageInfo:function(url){var image=this._image=new Image,_this=this;this.crossOriginPolicy&&(image.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(image.useCredentials=this.ajaxWithCredentials),$.addEvent(image,"load",function(){_this.width=Object.prototype.hasOwnProperty.call(image,"naturalWidth")?image.naturalWidth:image.width,_this.height=Object.prototype.hasOwnProperty.call(image,"naturalHeight")?image.naturalHeight:image.height,_this.aspectRatio=_this.width/_this.height,_this.dimensions=new $.Point(_this.width,_this.height),_this._tileWidth=_this.width,_this._tileHeight=_this.height,_this.tileOverlap=0,_this.minLevel=0,_this.levels=_this._buildLevels(),_this.maxLevel=_this.levels.length-1,_this.ready=!0,_this.raiseEvent("ready",{tileSource:_this})}),$.addEvent(image,"error",function(){_this.raiseEvent("open-failed",{message:"Error loading image at "+url,source:url})}),image.src=url},getLevelScale:function(level){var levelScale=NaN;return levelScale=level>=this.minLevel&&level<=this.maxLevel?this.levels[level].width/this.levels[this.maxLevel].width:levelScale},getNumTiles:function(level){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)},getTileUrl:function(level,x,y){var url=null;return url=level>=this.minLevel&&level<=this.maxLevel?this.levels[level].url:url},getContext2D:function(level,x,y){var context=null;return context=level>=this.minLevel&&level<=this.maxLevel?this.levels[level].context2D:context},_buildLevels:function(){var levels=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!$.supportsCanvas||!this.useCanvas)return delete this._image,levels;var currentWidth=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,currentHeight=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,bigCanvas=document.createElement("canvas"),bigContext=bigCanvas.getContext("2d");if(bigCanvas.width=currentWidth,bigCanvas.height=currentHeight,bigContext.drawImage(this._image,0,0,currentWidth,currentHeight),levels[0].context2D=bigContext,delete this._image,$.isCanvasTainted(bigCanvas))return levels;for(;2<=currentWidth&&2<=currentHeight;){var currentWidth=Math.floor(currentWidth/2),currentHeight=Math.floor(currentHeight/2),smallCanvas=document.createElement("canvas"),smallContext=smallCanvas.getContext("2d");smallCanvas.width=currentWidth,smallCanvas.height=currentHeight,smallContext.drawImage(bigCanvas,0,0,currentWidth,currentHeight),levels.splice(0,0,{context2D:smallContext,width:currentWidth,height:currentHeight}),bigCanvas=smallCanvas,bigContext=smallContext}return levels}})}(OpenSeadragon),function($){$.TileSourceCollection=function(tileSize,tileSources,rows,layout){$.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function($){function scheduleFade(button){$.requestAnimationFrame(function(){!function(button){var opacity;button.shouldFade&&(opacity=$.now(),opacity=opacity-button.fadeBeginTime,opacity=1-opacity/button.fadeLength,opacity=Math.min(1,opacity),opacity=Math.max(0,opacity),button.imgGroup&&$.setElementOpacity(button.imgGroup,opacity,!0),0<opacity&&scheduleFade(button))}(button)})}function inTo(button,newState){button.element.disabled||(newState>=$.ButtonState.GROUP&&button.currentState==$.ButtonState.REST&&(function(button){button.shouldFade=!1,button.imgGroup&&$.setElementOpacity(button.imgGroup,1,!0)}(button),button.currentState=$.ButtonState.GROUP),newState>=$.ButtonState.HOVER&&button.currentState==$.ButtonState.GROUP&&(button.imgHover&&(button.imgHover.style.visibility=""),button.currentState=$.ButtonState.HOVER),newState>=$.ButtonState.DOWN&&button.currentState==$.ButtonState.HOVER&&(button.imgDown&&(button.imgDown.style.visibility=""),button.currentState=$.ButtonState.DOWN))}function outTo(button,newState){button.element.disabled||(newState<=$.ButtonState.HOVER&&button.currentState==$.ButtonState.DOWN&&(button.imgDown&&(button.imgDown.style.visibility="hidden"),button.currentState=$.ButtonState.HOVER),newState<=$.ButtonState.GROUP&&button.currentState==$.ButtonState.HOVER&&(button.imgHover&&(button.imgHover.style.visibility="hidden"),button.currentState=$.ButtonState.GROUP),newState<=$.ButtonState.REST&&button.currentState==$.ButtonState.GROUP&&(function(button){button.shouldFade=!0,button.fadeBeginTime=$.now()+button.fadeDelay,window.setTimeout(function(){scheduleFade(button)},button.fadeDelay)}(button),button.currentState=$.ButtonState.REST))}$.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},$.Button=function(options){var _this=this;$.EventSource.call(this),$.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:$.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},options),this.element=options.element||$.makeNeutralElement("div"),options.element||(this.imgRest=$.makeTransparentImage(this.srcRest),this.imgGroup=$.makeTransparentImage(this.srcGroup),this.imgHover=$.makeTransparentImage(this.srcHover),this.imgDown=$.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",$.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",$.Browser.vendor==$.BROWSERS.FIREFOX&&$.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=$.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new $.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(event){event.insideElementPressed?(inTo(_this,$.ButtonState.DOWN),_this.raiseEvent("enter",{originalEvent:event.originalEvent})):event.buttonDownAny||inTo(_this,$.ButtonState.HOVER)},focusHandler:function(event){this.enterHandler(event),_this.raiseEvent("focus",{originalEvent:event.originalEvent})},exitHandler:function(event){outTo(_this,$.ButtonState.GROUP),event.insideElementPressed&&_this.raiseEvent("exit",{originalEvent:event.originalEvent})},blurHandler:function(event){this.exitHandler(event),_this.raiseEvent("blur",{originalEvent:event.originalEvent})},pressHandler:function(event){inTo(_this,$.ButtonState.DOWN),_this.raiseEvent("press",{originalEvent:event.originalEvent})},releaseHandler:function(event){event.insideElementPressed&&event.insideElementReleased?(outTo(_this,$.ButtonState.HOVER),_this.raiseEvent("release",{originalEvent:event.originalEvent})):event.insideElementPressed?outTo(_this,$.ButtonState.GROUP):inTo(_this,$.ButtonState.HOVER)},clickHandler:function(event){event.quick&&_this.raiseEvent("click",{originalEvent:event.originalEvent})},keyHandler:function(event){return 13!==event.keyCode||(_this.raiseEvent("click",{originalEvent:event.originalEvent}),_this.raiseEvent("release",{originalEvent:event.originalEvent}),!1)}}),outTo(this,$.ButtonState.REST)},$.extend($.Button.prototype,$.EventSource.prototype,{notifyGroupEnter:function(){inTo(this,$.ButtonState.GROUP)},notifyGroupExit:function(){outTo(this,$.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,$.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,$.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function($){$.ButtonGroup=function(options){$.extend(!0,this,{buttons:[],clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:$.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},options);var i,buttons=this.buttons.concat([]),_this=this;if(this.element=options.element||$.makeNeutralElement("div"),!options.group)for(this.element.style.display="inline-block",i=0;i<buttons.length;i++)this.element.appendChild(buttons[i].element);$.setElementTouchActionNone(this.element),this.tracker=new $.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(event){for(var i=0;i<_this.buttons.length;i++)_this.buttons[i].notifyGroupEnter()},exitHandler:function(event){var i;if(!event.insideElementPressed)for(i=0;i<_this.buttons.length;i++)_this.buttons[i].notifyGroupExit()}})},$.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function($){$.Rect=function(x,y,width,height,degrees){var newTopLeft,newWidth;this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0,this.width="number"==typeof width?width:0,this.height="number"==typeof height?height:0,this.degrees="number"==typeof degrees?degrees:0,this.degrees=$.positiveModulo(this.degrees,360),270<=this.degrees?(newTopLeft=this.getTopRight(),this.x=newTopLeft.x,this.y=newTopLeft.y,newWidth=this.height,this.height=this.width,this.width=newWidth,this.degrees-=270):180<=this.degrees?(newTopLeft=this.getBottomRight(),this.x=newTopLeft.x,this.y=newTopLeft.y,this.degrees-=180):90<=this.degrees&&(newTopLeft=this.getBottomLeft(),this.x=newTopLeft.x,this.y=newTopLeft.y,newWidth=this.height,this.height=this.width,this.width=newWidth,this.degrees-=90)},$.Rect.fromSummits=function(topLeft,radians,diff){var width=topLeft.distanceTo(radians),height=topLeft.distanceTo(diff),diff=radians.minus(topLeft),radians=Math.atan(diff.y/diff.x);return diff.x<0?radians+=Math.PI:diff.y<0&&(radians+=2*Math.PI),new $.Rect(topLeft.x,topLeft.y,width,height,radians/Math.PI*180)},$.Rect.prototype={clone:function(){return new $.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new $.Point(this.x,this.y)},getBottomRight:function(){return new $.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new $.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new $.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new $.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new $.Point(this.width,this.height)},equals:function(other){return other instanceof $.Rect&&this.x===other.x&&this.y===other.y&&this.width===other.width&&this.height===other.height&&this.degrees===other.degrees},times:function(factor){return new $.Rect(this.x*factor,this.y*factor,this.width*factor,this.height*factor,this.degrees)},translate:function(delta){return new $.Rect(this.x+delta.x,this.y+delta.y,this.width,this.height,this.degrees)},union:function(right){var thisBoundingBox=this.getBoundingBox(),bottom=right.getBoundingBox(),left=Math.min(thisBoundingBox.x,bottom.x),top=Math.min(thisBoundingBox.y,bottom.y),right=Math.max(thisBoundingBox.x+thisBoundingBox.width,bottom.x+bottom.width),bottom=Math.max(thisBoundingBox.y+thisBoundingBox.height,bottom.y+bottom.height);return new $.Rect(left,top,right-left,bottom-top)},intersection:function(rect){var EPSILON=1e-10,intersectionPoints=[],rectBottomRight=this.getTopLeft();rect.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=this.getTopRight();rect.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=this.getBottomLeft();rect.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=this.getBottomRight();rect.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=rect.getTopLeft();this.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=rect.getTopRight();this.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=rect.getBottomLeft();this.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);rectBottomRight=rect.getBottomRight();this.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);for(var thisSegments=this._getSegments(),rectSegments=rect._getSegments(),i=0;i<thisSegments.length;i++)for(var thisSegment=thisSegments[i],j=0;j<rectSegments.length;j++){var intersect=rectSegments[j],intersect=function(a,t,c,s){var abVector=t.minus(a),cdVector=s.minus(c),t=-cdVector.x*abVector.y+abVector.x*cdVector.y;if(0==t)return null;s=(abVector.x*(a.y-c.y)-abVector.y*(a.x-c.x))/t,t=(cdVector.x*(a.y-c.y)-cdVector.y*(a.x-c.x))/t;if(-EPSILON<=s&&s<=1-EPSILON&&-EPSILON<=t&&t<=1-EPSILON)return new $.Point(a.x+t*abVector.x,a.y+t*abVector.y);return null}(thisSegment[0],thisSegment[1],intersect[0],intersect[1]);intersect&&intersectionPoints.push(intersect)}if(0===intersectionPoints.length)return null;for(var minX=intersectionPoints[0].x,maxX=intersectionPoints[0].x,minY=intersectionPoints[0].y,maxY=intersectionPoints[0].y,k=1;k<intersectionPoints.length;k++){var point=intersectionPoints[k];point.x<minX&&(minX=point.x),point.x>maxX&&(maxX=point.x),point.y<minY&&(minY=point.y),point.y>maxY&&(maxY=point.y)}return new $.Rect(minX,minY,maxX-minX,maxY-minY)},_getSegments:function(){var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),bottomRight=this.getBottomRight();return[[topLeft,topRight],[topRight,bottomRight],[bottomRight,bottomLeft],[bottomLeft,topLeft]]},rotate:function(diff,radians){if(0===(diff=$.positiveModulo(diff,360)))return this.clone();radians=radians||this.getCenter();var newTopLeft=this.getTopLeft().rotate(diff,radians),diff=(diff=this.getTopRight().rotate(diff,radians).minus(newTopLeft)).apply(function(x){return Math.abs(x)<1e-15?0:x}),radians=Math.atan(diff.y/diff.x);return diff.x<0?radians+=Math.PI:diff.y<0&&(radians+=2*Math.PI),new $.Rect(newTopLeft.x,newTopLeft.y,this.width,this.height,radians/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),maxY=this.getBottomRight(),minX=Math.min(topLeft.x,topRight.x,bottomLeft.x,maxY.x),maxX=Math.max(topLeft.x,topRight.x,bottomLeft.x,maxY.x),minY=Math.min(topLeft.y,topRight.y,bottomLeft.y,maxY.y),maxY=Math.max(topLeft.y,topRight.y,bottomLeft.y,maxY.y);return new $.Rect(minX,minY,maxX-minX,maxY-minY)},getIntegerBoundingBox:function(){var height=this.getBoundingBox(),x=Math.floor(height.x),y=Math.floor(height.y),width=Math.ceil(height.width+height.x-x),height=Math.ceil(height.height+height.y-y);return new $.Rect(x,y,width,height)},containsPoint:function(point,epsilon){epsilon=epsilon||0;var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),topDiff=topRight.minus(topLeft),leftDiff=bottomLeft.minus(topLeft);return(point.x-topLeft.x)*topDiff.x+(point.y-topLeft.y)*topDiff.y>=-epsilon&&(point.x-topRight.x)*topDiff.x+(point.y-topRight.y)*topDiff.y<=epsilon&&(point.x-topLeft.x)*leftDiff.x+(point.y-topLeft.y)*leftDiff.y>=-epsilon&&(point.x-bottomLeft.x)*leftDiff.x+(point.y-bottomLeft.y)*leftDiff.y<=epsilon},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function($){var THIS={};function onStripDrag(event){var offsetLeft=Number(this.element.style.marginLeft.replace("px","")),offsetTop=Number(this.element.style.marginTop.replace("px","")),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),viewerSize=$.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-event.delta.x?offsetLeft>-(scrollWidth-viewerSize.x)&&(this.element.style.marginLeft=offsetLeft+2*event.delta.x+"px",loadPanels(this,viewerSize.x,offsetLeft+2*event.delta.x)):-event.delta.x<0&&offsetLeft<0&&(this.element.style.marginLeft=offsetLeft+2*event.delta.x+"px",loadPanels(this,viewerSize.x,offsetLeft+2*event.delta.x)):0<-event.delta.y?offsetTop>-(scrollHeight-viewerSize.y)&&(this.element.style.marginTop=offsetTop+2*event.delta.y+"px",loadPanels(this,viewerSize.y,offsetTop+2*event.delta.y)):-event.delta.y<0&&offsetTop<0&&(this.element.style.marginTop=offsetTop+2*event.delta.y+"px",loadPanels(this,viewerSize.y,offsetTop+2*event.delta.y))),!1}function onStripScroll(event){var offsetLeft=Number(this.element.style.marginLeft.replace("px","")),offsetTop=Number(this.element.style.marginTop.replace("px","")),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),viewerSize=$.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<event.scroll?offsetLeft>-(scrollWidth-viewerSize.x)&&(this.element.style.marginLeft=offsetLeft-60*event.scroll+"px",loadPanels(this,viewerSize.x,offsetLeft-60*event.scroll)):event.scroll<0&&offsetLeft<0&&(this.element.style.marginLeft=offsetLeft-60*event.scroll+"px",loadPanels(this,viewerSize.x,offsetLeft-60*event.scroll)):event.scroll<0?offsetTop>viewerSize.y-scrollHeight&&(this.element.style.marginTop=offsetTop+60*event.scroll+"px",loadPanels(this,viewerSize.y,offsetTop+60*event.scroll)):0<event.scroll&&offsetTop<0&&(this.element.style.marginTop=offsetTop+60*event.scroll+"px",loadPanels(this,viewerSize.y,offsetTop+60*event.scroll))),!1}function loadPanels(strip,viewerSize,scroll){for(var style,miniViewer,element,panelSize="horizontal"==strip.scroll?strip.panelWidth:strip.panelHeight,activePanelsStart=Math.ceil(viewerSize/panelSize)+5,activePanelsEnd=Math.ceil((Math.abs(scroll)+viewerSize)/panelSize)+1,i=activePanelsStart=(activePanelsStart=activePanelsEnd-activePanelsStart)<0?0:activePanelsStart;i<activePanelsEnd&&i<strip.panels.length;i++)(element=strip.panels[i]).activePanel||(style=(miniViewer=strip.viewer.tileSources[i]).referenceStripThumbnailUrl?{type:"image",url:miniViewer.referenceStripThumbnailUrl}:miniViewer,(miniViewer=new $.Viewer({id:element.id,tileSources:[style],element:element,navigatorSizeRatio:strip.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:strip.viewer.loadTilesWithAjax,ajaxHeaders:strip.viewer.ajaxHeaders,useCanvas:strip.useCanvas})).displayRegion=$.makeNeutralElement("div"),miniViewer.displayRegion.id=element.id+"-displayregion",miniViewer.displayRegion.className="displayregion",(style=miniViewer.displayRegion.style).position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default",style.width=strip.panelWidth-4+"px",style.height=strip.panelHeight-4+"px",miniViewer.displayRegion.innerTracker=new $.MouseTracker({element:miniViewer.displayRegion,startDisabled:!0}),element.getElementsByTagName("div")[0].appendChild(miniViewer.displayRegion),strip.miniViewers[element.id]=miniViewer,element.activePanel=!0)}function onStripEnter(element){element=element.eventSource.element;return"horizontal"==this.scroll?element.style.marginBottom="0px":element.style.marginLeft="0px",!1}function onStripExit(element){element=element.eventSource.element;return"horizontal"==this.scroll?element.style.marginBottom="-"+$.getElementSize(element).y/2+"px":element.style.marginLeft="-"+$.getElementSize(element).x/2+"px",!1}function onKeyDown(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 38:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function onKeyPress(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 61:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}$.ReferenceStrip=function(options){var element,style,i,viewer=options.viewer,viewerSize=$.getElementSize(viewer.element);for(options.id||(options.id="referencestrip-"+$.now(),this.element=$.makeNeutralElement("div"),this.element.id=options.id,this.element.className="referencestrip"),options=$.extend(!0,{sizeRatio:$.DEFAULT_SETTINGS.referenceStripSizeRatio,position:$.DEFAULT_SETTINGS.referenceStripPosition,scroll:$.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold},options,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),$.extend(this,options),THIS[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(style=this.element.style).marginTop="0px",style.marginRight="0px",style.marginBottom="0px",style.marginLeft="0px",style.left="0px",style.bottom="0px",style.border="0px",style.background="#000",style.position="relative",$.setElementTouchActionNone(this.element),$.setElementOpacity(this.element,.8),this.viewer=viewer,this.innerTracker=new $.MouseTracker({element:this.element,dragHandler:$.delegate(this,onStripDrag),scrollHandler:$.delegate(this,onStripScroll),enterHandler:$.delegate(this,onStripEnter),exitHandler:$.delegate(this,onStripExit),keyDownHandler:$.delegate(this,onKeyDown),keyHandler:$.delegate(this,onKeyPress)}),options.width&&options.height?(this.element.style.width=options.width+"px",this.element.style.height=options.height+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.BOTTOM_LEFT})):"horizontal"==options.scroll?(this.element.style.width=viewerSize.x*options.sizeRatio*viewer.tileSources.length+12*viewer.tileSources.length+"px",this.element.style.height=viewerSize.y*options.sizeRatio+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=viewerSize.y*options.sizeRatio*viewer.tileSources.length+12*viewer.tileSources.length+"px",this.element.style.width=viewerSize.x*options.sizeRatio+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.TOP_LEFT})),this.panelWidth=viewerSize.x*this.sizeRatio+8,this.panelHeight=viewerSize.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},i=0;i<viewer.tileSources.length;i++)(element=$.makeNeutralElement("div")).id=this.element.id+"-"+i,element.style.width=this.panelWidth+"px",element.style.height=this.panelHeight+"px",element.style.display="inline",element.style.float="left",element.style.cssFloat="left",element.style.styleFloat="left",element.style.padding="2px",$.setElementTouchActionNone(element),element.innerTracker=new $.MouseTracker({element:element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(event){event.eventSource.dragging=$.now()},releaseHandler:function(event){var tracker=event.eventSource,now=tracker.element.id,page=Number(now.split("-")[2]),now=$.now();event.insideElementPressed&&event.insideElementReleased&&tracker.dragging&&now-tracker.dragging<tracker.clickTimeThreshold&&(tracker.dragging=null,viewer.goToPage(page))}}),this.element.appendChild(element),element.activePanel=!1,this.panels.push(element);loadPanels(this,"vertical"==this.scroll?viewerSize.y:viewerSize.x,0),this.setFocus(0)},$.extend($.ReferenceStrip.prototype,$.EventSource.prototype,$.Viewer.prototype,{setFocus:function(page){var offset,element=this.element.querySelector("#"+this.element.id+"-"+page),viewerSize=$.getElementSize(this.viewer.canvas),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),offsetLeft=-Number(this.element.style.marginLeft.replace("px","")),offsetTop=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==element&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=element,this.currentSelected.style.background="#999","horizontal"==this.scroll?(offset=Number(page)*(this.panelWidth+3))>offsetLeft+viewerSize.x-this.panelWidth?(offset=Math.min(offset,scrollWidth-viewerSize.x),this.element.style.marginLeft=-offset+"px",loadPanels(this,viewerSize.x,-offset)):offset<offsetLeft&&(offset=Math.max(0,offset-viewerSize.x/2),this.element.style.marginLeft=-offset+"px",loadPanels(this,viewerSize.x,-offset)):(offset=Number(page)*(this.panelHeight+3))>offsetTop+viewerSize.y-this.panelHeight?(offset=Math.min(offset,scrollHeight-viewerSize.y),this.element.style.marginTop=-offset+"px",loadPanels(this,viewerSize.y,-offset)):offset<offsetTop&&(offset=Math.max(0,offset-viewerSize.y/2),this.element.style.marginTop=-offset+"px",loadPanels(this,viewerSize.y,-offset)),this.currentPage=page,onStripEnter.call(this,{eventSource:this.innerTracker}))},update:function(){return!!THIS[this.id].animating&&($.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var key in this.miniViewers)this.miniViewers[key].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function($){$.DisplayRect=function(x,y,width,height,minLevel,maxLevel){$.Rect.apply(this,[x,y,width,height]),this.minLevel=minLevel,this.maxLevel=maxLevel},$.extend($.DisplayRect.prototype,$.Rect.prototype)}(OpenSeadragon),function($){$.Spring=function(options){var args=arguments;"object"!=typeof options&&(options={initial:args.length&&"number"==typeof args[0]?args[0]:void 0,springStiffness:1<args.length?args[1].springStiffness:5,animationTime:1<args.length?args[1].animationTime:1.5}),$.console.assert("number"==typeof options.springStiffness&&0!==options.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),$.console.assert("number"==typeof options.animationTime&&0<=options.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),options.exponential&&(this._exponential=!0,delete options.exponential),$.extend(!0,this,options),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:$.now()},$.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},$.Spring.prototype={resetTo:function(target){$.console.assert(!this._exponential||0!==target,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=target,this.start.time=this.target.time=this.current.time=$.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(target){$.console.assert(!this._exponential||0!==target,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=target,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(delta){this.start.value+=delta,this.target.value+=delta,this._exponential&&($.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(value){this._exponential=value,this._exponential&&($.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var startValue;this.current.time=$.now();var currentValue,targetValue=this._exponential?(startValue=this.start._logValue,this.target._logValue):(startValue=this.start.value,this.target.value),currentValue=this.current.time>=this.target.time?targetValue:startValue+(targetValue-startValue)*(oldValue=this.springStiffness,currentValue=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(oldValue*-currentValue))/(1-Math.exp(-oldValue))),oldValue=this.current.value;return this._exponential?this.current.value=Math.exp(currentValue):this.current.value=currentValue,oldValue!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function($){function ImageJob(options){$.extend(!0,this,{timeout:$.DEFAULT_SETTINGS.timeout,jobId:null},options),this.image=null}ImageJob.prototype={errorMsg:null,start:function(){var self=this,selfAbort=this.abort;this.image=new Image,this.image.onload=function(){self.finish(!0)},this.image.onabort=this.image.onerror=function(){self.errorMsg="Image load aborted",self.finish(!1)},this.jobId=window.setTimeout(function(){self.errorMsg="Image load exceeded timeout ("+self.timeout+" ms)",self.finish(!1)},this.timeout),this.loadWithAjax?(this.request=$.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(request){try{url=new window.Blob([request.response])}catch(e){var bb=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===e.name&&bb&&((bb=new bb).append(request.response),url=bb.getBlob())}0===url.size&&(self.errorMsg="Empty image response.",self.finish(!1));var url=(window.URL||window.webkitURL).createObjectURL(url);self.image.src=url},error:function(request){self.errorMsg="Image load aborted - XHR error",self.finish(!1)}}),this.abort=function(){self.request.abort(),"function"==typeof selfAbort&&selfAbort()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(successful){this.image.onload=this.image.onerror=this.image.onabort=null,successful||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},$.ImageLoader=function(options){$.extend(!0,this,{jobLimit:$.DEFAULT_SETTINGS.imageLoaderLimit,timeout:$.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},options)},$.ImageLoader.prototype={addJob:function(options){var _this=this,newJob=new ImageJob({src:options.src,loadWithAjax:options.loadWithAjax,ajaxHeaders:options.loadWithAjax?options.ajaxHeaders:null,crossOriginPolicy:options.crossOriginPolicy,ajaxWithCredentials:options.ajaxWithCredentials,callback:function(job){!function(loader,job,callback){loader.jobsInProgress--,(!loader.jobLimit||loader.jobsInProgress<loader.jobLimit)&&0<loader.jobQueue.length&&(loader.jobQueue.shift().start(),loader.jobsInProgress++);callback(job.image,job.errorMsg,job.request)}(_this,job,options.callback)},abort:options.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(newJob.start(),this.jobsInProgress++):this.jobQueue.push(newJob)},clear:function(){for(var i=0;i<this.jobQueue.length;i++){var job=this.jobQueue[i];"function"==typeof job.abort&&job.abort()}this.jobQueue=[]}}}(OpenSeadragon),function($){$.Tile=function(level,x,y,bounds,exists,url,context2D,loadWithAjax,ajaxHeaders,sourceBounds){this.level=level,this.x=x,this.y=y,this.bounds=bounds,this.sourceBounds=sourceBounds,this.exists=exists,this.url=url,this.context2D=context2D,this.loadWithAjax=loadWithAjax,this.ajaxHeaders=ajaxHeaders,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},$.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(container){this.cacheImageRecord?this.loaded?(this.element||(this.element=$.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=container&&container.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",$.setElementOpacity(this.element,this.opacity)):$.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):$.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(context,sourceHeight,scale,translate){var sourceWidth,rendered,position=this.position.times($.pixelDensityRatio),size=this.size.times($.pixelDensityRatio);this.context2D||this.cacheImageRecord?(rendered=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&rendered?(context.save(),context.globalAlpha=this.opacity,"number"==typeof scale&&1!==scale&&(position=position.times(scale),size=size.times(scale)),translate instanceof $.Point&&(position=position.plus(translate)),1===context.globalAlpha&&this._hasTransparencyChannel()&&context.clearRect(position.x,position.y,size.x,size.y),sourceHeight({context:context,tile:this,rendered:rendered}),sourceHeight=this.sourceBounds?(sourceWidth=Math.min(this.sourceBounds.width,rendered.canvas.width),Math.min(this.sourceBounds.height,rendered.canvas.height)):(sourceWidth=rendered.canvas.width,rendered.canvas.height),context.drawImage(rendered.canvas,0,0,sourceWidth,sourceHeight,position.x,position.y,size.x,size.y),context.restore()):$.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):$.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var context;if(this.cacheImageRecord)context=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return $.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;context=this.context2D}return context.canvas.width/(this.size.x*$.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(scale,y,sketchCanvasSize){var x=Math.max(1,Math.ceil((sketchCanvasSize.x-y.x)/2)),y=Math.max(1,Math.ceil((sketchCanvasSize.y-y.y)/2));return new $.Point(x,y).minus(this.position.times($.pixelDensityRatio).times(scale||1).apply(function(x){return x%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function($){$.OverlayPlacement=$.Placement,$.OverlayRotationMode=$.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),$.Overlay=function(element,location,options){options=$.isPlainObject(element)?element:{element:element,location:location,placement:options};this.element=options.element,this.style=options.element.style,this._init(options)},$.Overlay.prototype={_init:function(options){this.location=options.location,this.placement=void 0===options.placement?$.Placement.TOP_LEFT:options.placement,this.onDraw=options.onDraw,this.checkResize=void 0===options.checkResize||options.checkResize,this.width=void 0===options.width?null:options.width,this.height=void 0===options.height?null:options.height,this.rotationMode=options.rotationMode||$.OverlayRotationMode.EXACT,this.location instanceof $.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=$.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new $.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(position,size){var properties=$.Placement.properties[this.placement];properties&&(properties.isHorizontallyCentered?position.x-=size.x/2:properties.isRight&&(position.x-=size.x),properties.isVerticallyCentered?position.y-=size.y/2:properties.isBottom&&(position.y-=size.y))},destroy:function(){var transformProp=this.element,style=this.style;transformProp.parentNode&&(transformProp.parentNode.removeChild(transformProp),transformProp.prevElementParent&&(style.display="none",document.body.appendChild(transformProp))),this.onDraw=null,style.top="",style.left="",style.position="",null!==this.width&&(style.width=""),null!==this.height&&(style.height="");var transformOriginProp=$.getCssPropertyWithVendorPrefix("transformOrigin"),transformProp=$.getCssPropertyWithVendorPrefix("transform");transformOriginProp&&transformProp&&(style[transformOriginProp]="",style[transformProp]="")},drawHTML:function(transformOriginProp,rotate){var transformProp=this.element;transformProp.parentNode!==transformOriginProp&&(transformProp.prevElementParent=transformProp.parentNode,transformProp.prevNextSibling=transformProp.nextSibling,transformOriginProp.appendChild(transformProp),this.style.position="absolute",this.size=$.getElementSize(transformProp));var style=this._getOverlayPositionAndSize(rotate),transformOriginProp=style.position,transformProp=this.size=style.size,rotate=style.rotate;this.onDraw?this.onDraw(transformOriginProp,transformProp,this.element):((style=this.style).left=transformOriginProp.x+"px",style.top=transformOriginProp.y+"px",null!==this.width&&(style.width=transformProp.x+"px"),null!==this.height&&(style.height=transformProp.y+"px"),transformOriginProp=$.getCssPropertyWithVendorPrefix("transformOrigin"),transformProp=$.getCssPropertyWithVendorPrefix("transform"),transformOriginProp&&transformProp&&(rotate?(style[transformOriginProp]=this._getTransformOrigin(),style[transformProp]="rotate("+rotate+"deg)"):(style[transformOriginProp]="",style[transformProp]="")),"none"!==style.display&&(style.display="block"))},_getOverlayPositionAndSize:function(viewport){var position=viewport.pixelFromPoint(this.location,!0),size=this._getSizeInPixels(viewport);this.adjust(position,size);var boundingBox,rotate=0;return viewport.degrees&&this.rotationMode!==$.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===$.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height?(boundingBox=new $.Rect(position.x,position.y,size.x,size.y),position=(boundingBox=this._getBoundingBox(boundingBox,viewport.degrees)).getTopLeft(),size=boundingBox.getSize()):rotate=viewport.degrees),{position:position,size:size,rotate:rotate}},_getSizeInPixels:function(viewport){var eltSize,width=this.size.x,height=this.size.y;return null===this.width&&null===this.height||(eltSize=viewport.deltaPixelsFromPointsNoRotate(new $.Point(this.width||0,this.height||0),!0),null!==this.width&&(width=eltSize.x),null!==this.height&&(height=eltSize.y)),!this.checkResize||null!==this.width&&null!==this.height||(eltSize=this.size=$.getElementSize(this.element),null===this.width&&(width=eltSize.x),null===this.height&&(height=eltSize.y)),new $.Point(width,height)},_getBoundingBox:function(rect,degrees){var refPoint=this._getPlacementPoint(rect);return rect.rotate(degrees,refPoint).getBoundingBox()},_getPlacementPoint:function(rect){var result=new $.Point(rect.x,rect.y),properties=$.Placement.properties[this.placement];return properties&&(properties.isHorizontallyCentered?result.x+=rect.width/2:properties.isRight&&(result.x+=rect.width),properties.isVerticallyCentered?result.y+=rect.height/2:properties.isBottom&&(result.y+=rect.height)),result},_getTransformOrigin:function(){var result="",properties=$.Placement.properties[this.placement];return properties&&(properties.isLeft?result="left":properties.isRight&&(result="right"),properties.isTop?result+=" top":properties.isBottom&&(result+=" bottom")),result},update:function(location,options){options=$.isPlainObject(location)?location:{location:location,placement:options};this._init({location:options.location||this.location,placement:(void 0!==options.placement?options:this).placement,onDraw:options.onDraw||this.onDraw,checkResize:options.checkResize||this.checkResize,width:(void 0!==options.width?options:this).width,height:(void 0!==options.height?options:this).height,rotationMode:options.rotationMode||this.rotationMode})},getBounds:function(viewport){$.console.assert(viewport,"A viewport must now be passed to Overlay.getBounds.");var width=this.width,height=this.height;null!==width&&null!==height||(location=viewport.deltaPointsFromPixelsNoRotate(this.size,!0),null===width&&(width=location.x),null===height&&(height=location.y));var location=this.location.clone();return this.adjust(location,new $.Point(width,height)),this._adjustBoundsForRotation(viewport,new $.Rect(location.x,location.y,width,height))},_adjustBoundsForRotation:function(viewport,positionAndSize){if(!viewport||0===viewport.degrees||this.rotationMode===$.OverlayRotationMode.EXACT)return positionAndSize;if(this.rotationMode!==$.OverlayRotationMode.BOUNDING_BOX)return positionAndSize.rotate(-viewport.degrees,this._getPlacementPoint(positionAndSize));if(null===this.width||null===this.height)return positionAndSize;positionAndSize=this._getOverlayPositionAndSize(viewport);return viewport.viewerElementToViewportRectangle(new $.Rect(positionAndSize.position.x,positionAndSize.position.y,positionAndSize.size.x,positionAndSize.size.y))}}}(OpenSeadragon),function($){$.Drawer=function(options){$.console.assert(options.viewer,"[Drawer] options.viewer is required");var viewportSize=arguments;$.isPlainObject(options)||(options={source:viewportSize[0],viewport:viewportSize[1],element:viewportSize[2]}),$.console.assert(options.viewport,"[Drawer] options.viewport is required"),$.console.assert(options.element,"[Drawer] options.element is required"),options.source&&$.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=options.viewer,this.viewport=options.viewport,this.debugGridColor="string"==typeof options.debugGridColor?[options.debugGridColor]:options.debugGridColor||$.DEFAULT_SETTINGS.debugGridColor,options.opacity&&$.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=$.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=$.getElement(options.element),this.canvas=$.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(viewportSize=this._calculateCanvasSize(),this.canvas.width=viewportSize.x,this.canvas.height=viewportSize.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",$.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},$.Drawer.prototype={addOverlay:function(element,location,placement,onDraw){return $.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(element,location,placement,onDraw),this},updateOverlay:function(element,location,placement){return $.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(element,location,placement),this},removeOverlay:function(element){return $.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(element),this},clearOverlays:function(){return $.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(vpPoint){vpPoint=this.viewport.pixelFromPointNoRotate(vpPoint,!0);return new $.Point(vpPoint.x*$.pixelDensityRatio,vpPoint.y*$.pixelDensityRatio)},clipWithPolygons:function(polygons,useSketch){var context;this.useCanvas&&((context=this._getContext(useSketch)).beginPath(),polygons.forEach(function(polygon){polygon.forEach(function(coord,i){context[0===i?"moveTo":"lineTo"](coord.x,coord.y)})}),context.clip())},setOpacity:function(opacity){$.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var world=this.viewer.world,i=0;i<world.getItemCount();i++)world.getItemAt(i).setOpacity(opacity);return this},getOpacity:function(){$.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var world=this.viewer.world,maxOpacity=0,i=0;i<world.getItemCount();i++){var opacity=world.getItemAt(i).getOpacity();maxOpacity<opacity&&(maxOpacity=opacity)}return maxOpacity},needsUpdate:function(){return $.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return $.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return $.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return $.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){var sketchCanvasSize;this.canvas.innerHTML="",this.useCanvas&&(sketchCanvasSize=this._calculateCanvasSize(),this.canvas.width==sketchCanvasSize.x&&this.canvas.height==sketchCanvasSize.y||(this.canvas.width=sketchCanvasSize.x,this.canvas.height=sketchCanvasSize.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(sketchCanvasSize=this._calculateSketchCanvasSize(),this.sketchCanvas.width=sketchCanvasSize.x,this.sketchCanvas.height=sketchCanvasSize.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear())},_clear:function(context,canvas){this.useCanvas&&(context=this._getContext(context),canvas?context.clearRect(canvas.x,canvas.y,canvas.width,canvas.height):(canvas=context.canvas,context.clearRect(0,0,canvas.width,canvas.height)))},viewportToDrawerRectangle:function(size){var topLeft=this.viewport.pixelFromPointNoRotate(size.getTopLeft(),!0),size=this.viewport.deltaPixelsFromPointsNoRotate(size.getSize(),!0);return new $.Rect(topLeft.x*$.pixelDensityRatio,topLeft.y*$.pixelDensityRatio,size.x*$.pixelDensityRatio,size.y*$.pixelDensityRatio)},drawTile:function(tile,drawingHandler,context,scale,translate){$.console.assert(tile,"[Drawer.drawTile] tile is required"),$.console.assert(drawingHandler,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(context=this._getContext(context),tile.drawCanvas(context,drawingHandler,scale=scale||1,translate)):tile.drawHTML(this.canvas)},_getContext:function(sketchCanvasSize){var self,context=this.context;return sketchCanvasSize&&(null===this.sketchCanvas&&(this.sketchCanvas=document.createElement("canvas"),sketchCanvasSize=this._calculateSketchCanvasSize(),this.sketchCanvas.width=sketchCanvasSize.x,this.sketchCanvas.height=sketchCanvasSize.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()&&(self=this).viewer.addHandler("rotate",function resizeSketchCanvas(){var sketchCanvasSize;0!==self.viewport.getRotation()&&(self.viewer.removeHandler("rotate",resizeSketchCanvas),sketchCanvasSize=self._calculateSketchCanvasSize(),self.sketchCanvas.width=sketchCanvasSize.x,self.sketchCanvas.height=sketchCanvasSize.y)}),this._updateImageSmoothingEnabled(this.sketchContext)),context=this.sketchContext),context},saveContext:function(useSketch){this.useCanvas&&this._getContext(useSketch).save()},restoreContext:function(useSketch){this.useCanvas&&this._getContext(useSketch).restore()},setClip:function(rect,context){this.useCanvas&&((context=this._getContext(context)).beginPath(),context.rect(rect.x,rect.y,rect.width,rect.height),context.clip())},drawRectangle:function(rect,fillStyle,context){this.useCanvas&&((context=this._getContext(context)).save(),context.fillStyle=fillStyle,context.fillRect(rect.x,rect.y,rect.width,rect.height),context.restore())},blendSketch:function(position,scale,heightDiff,widthExt){var heightExt,widthDiff=position;$.isPlainObject(widthDiff)||(widthDiff={opacity:position,scale:scale,translate:heightDiff,compositeOperation:widthExt}),this.useCanvas&&this.sketchCanvas&&(position=widthDiff.opacity,widthExt=widthDiff.compositeOperation,heightExt=widthDiff.bounds,this.context.save(),this.context.globalAlpha=position,widthExt&&(this.context.globalCompositeOperation=widthExt),heightExt?(heightExt.x<0&&(heightExt.width+=heightExt.x,heightExt.x=0),heightExt.x+heightExt.width>this.canvas.width&&(heightExt.width=this.canvas.width-heightExt.x),heightExt.y<0&&(heightExt.height+=heightExt.y,heightExt.y=0),heightExt.y+heightExt.height>this.canvas.height&&(heightExt.height=this.canvas.height-heightExt.y),this.context.drawImage(this.sketchCanvas,heightExt.x,heightExt.y,heightExt.width,heightExt.height,heightExt.x,heightExt.y,heightExt.width,heightExt.height)):(scale=widthDiff.scale||1,position=(heightDiff=widthDiff.translate)instanceof $.Point?heightDiff:new $.Point(0,0),heightExt=widthExt=0,heightDiff&&(widthDiff=this.sketchCanvas.width-this.canvas.width,heightDiff=this.sketchCanvas.height-this.canvas.height,widthExt=Math.round(widthDiff/2),heightExt=Math.round(heightDiff/2)),this.context.drawImage(this.sketchCanvas,position.x-widthExt*scale,position.y-heightExt*scale,(this.canvas.width+2*widthExt)*scale,(this.canvas.height+2*heightExt)*scale,-widthExt,-heightExt,this.canvas.width+2*widthExt,this.canvas.height+2*heightExt)),this.context.restore())},drawDebugInfo:function(tile,count,i,tiledImage){var context,tileCenterX,tileCenterY;this.useCanvas&&(tileCenterY=this.viewer.world.getIndexOfItem(tiledImage)%this.debugGridColor.length,(context=this.context).save(),context.lineWidth=2*$.pixelDensityRatio,context.font="small-caps bold "+13*$.pixelDensityRatio+"px arial",context.strokeStyle=this.debugGridColor[tileCenterY],context.fillStyle=this.debugGridColor[tileCenterY],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),tiledImage.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0)}),0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip(),context.strokeRect(tile.position.x*$.pixelDensityRatio,tile.position.y*$.pixelDensityRatio,tile.size.x*$.pixelDensityRatio,tile.size.y*$.pixelDensityRatio),tileCenterX=(tile.position.x+tile.size.x/2)*$.pixelDensityRatio,tileCenterY=(tile.position.y+tile.size.y/2)*$.pixelDensityRatio,context.translate(tileCenterX,tileCenterY),context.rotate(Math.PI/180*-this.viewport.degrees),context.translate(-tileCenterX,-tileCenterY),0===tile.x&&0===tile.y&&(context.fillText("Zoom: "+this.viewport.getZoom(),tile.position.x*$.pixelDensityRatio,(tile.position.y-30)*$.pixelDensityRatio),context.fillText("Pan: "+this.viewport.getBounds().toString(),tile.position.x*$.pixelDensityRatio,(tile.position.y-20)*$.pixelDensityRatio)),context.fillText("Level: "+tile.level,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+20)*$.pixelDensityRatio),context.fillText("Column: "+tile.x,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+30)*$.pixelDensityRatio),context.fillText("Row: "+tile.y,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+40)*$.pixelDensityRatio),context.fillText("Order: "+i+" of "+count,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+50)*$.pixelDensityRatio),context.fillText("Size: "+tile.size.toString(),(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+60)*$.pixelDensityRatio),context.fillText("Position: "+tile.position.toString(),(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+70)*$.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),tiledImage.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip(),context.restore())},debugRect:function(rect){var context;this.useCanvas&&((context=this.context).save(),context.lineWidth=2*$.pixelDensityRatio,context.strokeStyle=this.debugGridColor[0],context.fillStyle=this.debugGridColor[0],context.strokeRect(rect.x*$.pixelDensityRatio,rect.y*$.pixelDensityRatio,rect.width*$.pixelDensityRatio,rect.height*$.pixelDensityRatio),context.restore())},setImageSmoothingEnabled:function(imageSmoothingEnabled){this.useCanvas&&(this._imageSmoothingEnabled=imageSmoothingEnabled,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(context){context.msImageSmoothingEnabled=this._imageSmoothingEnabled,context.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(canvas){canvas=this._getContext(canvas).canvas;return new $.Point(canvas.width,canvas.height)},getCanvasCenter:function(){return new $.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(options){var point=options.point?options.point.times($.pixelDensityRatio):this.getCanvasCenter(),context=this._getContext(options.useSketch);context.save(),context.translate(point.x,point.y),this.viewer.viewport.flipped?(context.rotate(Math.PI/180*-options.degrees),context.scale(-1,1)):context.rotate(Math.PI/180*options.degrees),context.translate(-point.x,-point.y)},_flip:function(context){var point=(context=context||{}).point?context.point.times($.pixelDensityRatio):this.getCanvasCenter(),context=this._getContext(context.useSketch);context.translate(point.x,0),context.scale(-1,1),context.translate(-point.x,0)},_restoreRotationChanges:function(useSketch){this._getContext(useSketch).restore()},_calculateCanvasSize:function(){var pixelDensityRatio=$.pixelDensityRatio,viewportSize=this.viewport.getContainerSize();return{x:Math.round(viewportSize.x*pixelDensityRatio),y:Math.round(viewportSize.y*pixelDensityRatio)}},_calculateSketchCanvasSize:function(){var sketchCanvasSize=this._calculateCanvasSize();if(0===this.viewport.getRotation())return sketchCanvasSize;sketchCanvasSize=Math.ceil(Math.sqrt(sketchCanvasSize.x*sketchCanvasSize.x+sketchCanvasSize.y*sketchCanvasSize.y));return{x:sketchCanvasSize,y:sketchCanvasSize}}}}(OpenSeadragon),function($){$.Viewport=function(options){var args=arguments;(options=args.length&&args[0]instanceof $.Point?{containerSize:args[0],contentSize:args[1],config:args[2]}:options).config&&($.extend(!0,options,options.config),delete options.config),this._margins=$.extend({left:0,top:0,right:0,bottom:0},options.margins||{}),delete options.margins,$.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:$.DEFAULT_SETTINGS.springStiffness,animationTime:$.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:$.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:$.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:$.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:$.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:$.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:$.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:$.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:$.DEFAULT_SETTINGS.maxZoomLevel,degrees:$.DEFAULT_SETTINGS.degrees,flipped:$.DEFAULT_SETTINGS.flipped,homeFillsViewer:$.DEFAULT_SETTINGS.homeFillsViewer},options),this._updateContainerInnerSize(),this.centerSpringX=new $.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new $.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new $.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new $.Rect(0,0,1,1),1),this.goHome(!0),this.update()},$.Viewport.prototype={resetContentSize:function(contentSize){return $.console.assert(contentSize,"[Viewport.resetContentSize] contentSize is required"),$.console.assert(contentSize instanceof $.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),$.console.assert(0<contentSize.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),$.console.assert(0<contentSize.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new $.Rect(0,0,1,contentSize.y/contentSize.x),contentSize.x),this},setHomeBounds:function(bounds,contentFactor){$.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(bounds,contentFactor)},_setContentBounds:function(bounds,contentFactor){$.console.assert(bounds,"[Viewport._setContentBounds] bounds is required"),$.console.assert(bounds instanceof $.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),$.console.assert(0<bounds.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),$.console.assert(0<bounds.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=bounds.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(contentFactor),this._contentBounds=bounds.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(contentFactor),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:contentFactor,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var output=this._contentAspectRatio/this.getAspectRatio(),output=this.homeFillsViewer?1<=output?output:1:1<=output?1:output;return output/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var center=this._contentBounds.getCenter(),width=1/this.getHomeZoom(),height=width/this.getAspectRatio();return new $.Rect(center.x-width/2,center.y-height/2,width,height)},goHome:function(immediately){return this.viewer&&this.viewer.raiseEvent("home",{immediately:immediately}),this.fitBounds(this.getHomeBounds(),immediately)},getMinZoom:function(){var homeZoom=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*homeZoom},getMaxZoom:function(){var zoom=this.maxZoomLevel;return zoom||(zoom=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,zoom/=this._contentBounds.width),Math.max(zoom,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new $.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return $.extend({},this._margins)},setMargins:function(margins){$.console.assert("object"===$.type(margins),"[Viewport.setMargins] margins must be an object"),this._margins=$.extend({left:0,top:0,right:0,bottom:0},margins),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(current){return this.getBoundsNoRotate(current).rotate(-this.getRotation())},getBoundsNoRotate:function(height){var center=this.getCenter(height),width=1/this.getZoom(height),height=width/this.getAspectRatio();return new $.Rect(center.x-width/2,center.y-height/2,width,height)},getBoundsWithMargins:function(current){return this.getBoundsNoRotateWithMargins(current).rotate(-this.getRotation(),this.getCenter(current))},getBoundsNoRotateWithMargins:function(factor){var bounds=this.getBoundsNoRotate(factor),factor=this._containerInnerSize.x*this.getZoom(factor);return bounds.x-=this._margins.left/factor,bounds.y-=this._margins.top/factor,bounds.width+=(this._margins.left+this._margins.right)/factor,bounds.height+=(this._margins.top+this._margins.bottom)/factor,bounds},getCenter:function(bounds){var oldZoomPixel,width,deltaZoomPoints,centerCurrent=new $.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),centerTarget=new $.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return bounds?centerCurrent:this.zoomPoint?(oldZoomPixel=this.pixelFromPoint(this.zoomPoint,!0),bounds=(width=1/(deltaZoomPoints=this.getZoom()))/this.getAspectRatio(),bounds=new $.Rect(centerCurrent.x-width/2,centerCurrent.y-bounds/2,width,bounds),deltaZoomPoints=this._pixelFromPoint(this.zoomPoint,bounds).minus(oldZoomPixel).divide(this._containerInnerSize.x*deltaZoomPoints),centerTarget.plus(deltaZoomPoints)):centerTarget},getZoom:function(current){return(current?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(zoom){return Math.max(Math.min(zoom,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(newBounds){var verticalThreshold,topDy,bottomDy,newBounds=new $.Rect(newBounds.x,newBounds.y,newBounds.width,newBounds.height);return this.wrapHorizontal||(verticalThreshold=this.visibilityRatio*newBounds.width,bottomDy=newBounds.x+newBounds.width,topDy=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,bottomDy=this._contentBoundsNoRotate.x-bottomDy+verticalThreshold,topDy=topDy-newBounds.x-verticalThreshold,verticalThreshold>this._contentBoundsNoRotate.width?newBounds.x+=(bottomDy+topDy)/2:topDy<0?newBounds.x+=topDy:0<bottomDy&&(newBounds.x+=bottomDy)),this.wrapVertical||(verticalThreshold=this.visibilityRatio*newBounds.height,topDy=newBounds.y+newBounds.height,bottomDy=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,topDy=this._contentBoundsNoRotate.y-topDy+verticalThreshold,bottomDy=bottomDy-newBounds.y-verticalThreshold,verticalThreshold>this._contentBoundsNoRotate.height?newBounds.y+=(topDy+bottomDy)/2:bottomDy<0?newBounds.y+=bottomDy:0<topDy&&(newBounds.y+=topDy)),newBounds},_raiseConstraintsEvent:function(immediately){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:immediately})},applyConstraints:function(immediately){var bounds=this.getZoom(),constrainedBounds=this._applyZoomConstraints(bounds);bounds!==constrainedBounds&&this.zoomTo(constrainedBounds,this.zoomPoint,immediately);bounds=this.getBoundsNoRotate(),constrainedBounds=this._applyBoundaryConstraints(bounds);return this._raiseConstraintsEvent(immediately),bounds.x===constrainedBounds.x&&bounds.y===constrainedBounds.y&&!immediately||this.fitBounds(constrainedBounds.rotate(-this.getRotation()),immediately),this},ensureVisible:function(immediately){return this.applyConstraints(immediately)},_fitBounds:function(newBounds,center){var immediately=(center=center||{}).immediately||!1,constraints=center.constraints||!1,newZoom=this.getAspectRatio(),center=newBounds.getCenter(),newBounds=new $.Rect(newBounds.x,newBounds.y,newBounds.width,newBounds.height,newBounds.degrees+this.getRotation()).getBoundingBox();newBounds.getAspectRatio()>=newZoom?newBounds.height=newBounds.width/newZoom:newBounds.width=newBounds.height*newZoom,newBounds.x=center.x-newBounds.width/2,newBounds.y=center.y-newBounds.height/2;newZoom=1/newBounds.width;if(constraints&&(referencePoint=newBounds.getAspectRatio(),newZoom!==(oldBounds=this._applyZoomConstraints(newZoom))&&(newBounds.width=1/(newZoom=oldBounds),newBounds.x=center.x-newBounds.width/2,newBounds.height=newBounds.width/referencePoint,newBounds.y=center.y-newBounds.height/2),center=(newBounds=this._applyBoundaryConstraints(newBounds)).getCenter(),this._raiseConstraintsEvent(immediately)),immediately)return this.panTo(center,!0),this.zoomTo(newZoom,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var oldBounds=this.getBounds(),referencePoint=this.getZoom();if(0===referencePoint||Math.abs(newZoom/referencePoint-1)<1e-8)return this.zoomTo(newZoom,!0),this.panTo(center,immediately);referencePoint=(newBounds=newBounds.rotate(-this.getRotation())).getTopLeft().times(newZoom).minus(oldBounds.getTopLeft().times(referencePoint)).divide(newZoom-referencePoint);return this.zoomTo(newZoom,referencePoint,immediately)},fitBounds:function(bounds,immediately){return this._fitBounds(bounds,{immediately:immediately,constraints:!1})},fitBoundsWithConstraints:function(bounds,immediately){return this._fitBounds(bounds,{immediately:immediately,constraints:!0})},fitVertically:function(immediately){var box=new $.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(box,immediately)},fitHorizontally:function(immediately){var box=new $.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(box,immediately)},getConstrainedBounds:function(bounds){bounds=this.getBounds(bounds);return this._applyBoundaryConstraints(bounds)},panBy:function(delta,immediately){var center=new $.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(center.plus(delta),immediately)},panTo:function(center,immediately){return immediately?(this.centerSpringX.resetTo(center.x),this.centerSpringY.resetTo(center.y)):(this.centerSpringX.springTo(center.x),this.centerSpringY.springTo(center.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:center,immediately:immediately}),this},zoomBy:function(factor,refPoint,immediately){return this.zoomTo(this.zoomSpring.target.value*factor,refPoint,immediately)},zoomTo:function(zoom,refPoint,immediately){var _this=this;return this.zoomPoint=refPoint instanceof $.Point&&!isNaN(refPoint.x)&&!isNaN(refPoint.y)?refPoint:null,immediately?this._adjustCenterSpringsForZoomPoint(function(){_this.zoomSpring.resetTo(zoom)}):this.zoomSpring.springTo(zoom),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:zoom,refPoint:refPoint,immediately:immediately}),this},setRotation:function(degrees){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=$.positiveModulo(degrees,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:degrees})),this},getRotation:function(){return this.degrees},resize:function(newContainerSize,maintain){var widthDeltaFactor,oldBounds=this.getBoundsNoRotate(),newBounds=oldBounds;return this.containerSize.x=newContainerSize.x,this.containerSize.y=newContainerSize.y,this._updateContainerInnerSize(),maintain&&(widthDeltaFactor=newContainerSize.x/this.containerSize.x,newBounds.width=oldBounds.width*widthDeltaFactor,newBounds.height=newBounds.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:newContainerSize,maintain:maintain}),this.fitBounds(newBounds,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new $.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var _this=this;this._adjustCenterSpringsForZoomPoint(function(){_this.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var changed=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,changed},_adjustCenterSpringsForZoomPoint:function(zoomSpringHandler){var deltaZoomPoints;this.zoomPoint?(deltaZoomPoints=this.pixelFromPoint(this.zoomPoint,!0),zoomSpringHandler(),deltaZoomPoints=this.pixelFromPoint(this.zoomPoint,!0).minus(deltaZoomPoints),deltaZoomPoints=this.deltaPointsFromPixels(deltaZoomPoints,!0),this.centerSpringX.shiftBy(deltaZoomPoints.x),this.centerSpringY.shiftBy(deltaZoomPoints.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)):zoomSpringHandler()},deltaPixelsFromPointsNoRotate:function(deltaPoints,current){return deltaPoints.times(this._containerInnerSize.x*this.getZoom(current))},deltaPixelsFromPoints:function(deltaPoints,current){return this.deltaPixelsFromPointsNoRotate(deltaPoints.rotate(this.getRotation()),current)},deltaPointsFromPixelsNoRotate:function(deltaPixels,current){return deltaPixels.divide(this._containerInnerSize.x*this.getZoom(current))},deltaPointsFromPixels:function(deltaPixels,current){return this.deltaPointsFromPixelsNoRotate(deltaPixels,current).rotate(-this.getRotation())},pixelFromPointNoRotate:function(point,current){return this._pixelFromPointNoRotate(point,this.getBoundsNoRotate(current))},pixelFromPoint:function(point,current){return this._pixelFromPoint(point,this.getBoundsNoRotate(current))},_pixelFromPointNoRotate:function(point,bounds){return point.minus(bounds.getTopLeft()).times(this._containerInnerSize.x/bounds.width).plus(new $.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(point,bounds){return this._pixelFromPointNoRotate(point.rotate(this.getRotation(),this.getCenter(!0)),bounds)},pointFromPixelNoRotate:function(pixel,bounds){bounds=this.getBoundsNoRotate(bounds);return pixel.minus(new $.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/bounds.width).plus(bounds.getTopLeft())},pointFromPixel:function(pixel,current){return this.pointFromPixelNoRotate(pixel,current).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(viewerX,viewerY){var scale=this._contentBoundsNoRotate.width;return new $.Point(viewerX*this._contentSizeNoRotate.x/scale,viewerY*this._contentSizeNoRotate.x/scale)},viewportToImageCoordinates:function(viewerX,viewerY){if(viewerX instanceof $.Point)return this.viewportToImageCoordinates(viewerX.x,viewerX.y);if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===count)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(viewerX,viewerY,!0)}return this._viewportToImageDelta(viewerX-this._contentBoundsNoRotate.x,viewerY-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(imageX,imageY){var scale=this._contentBoundsNoRotate.width;return new $.Point(imageX/this._contentSizeNoRotate.x*scale,imageY/this._contentSizeNoRotate.x*scale)},imageToViewportCoordinates:function(imageX,point){if(imageX instanceof $.Point)return this.imageToViewportCoordinates(imageX.x,imageX.y);if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===count)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(imageX,point,!0)}point=this._imageToViewportDelta(imageX,point);return point.x+=this._contentBoundsNoRotate.x,point.y+=this._contentBoundsNoRotate.y,point},imageToViewportRectangle:function(imageX,imageY,coordA,coordB){var rect=imageX;if(rect instanceof $.Rect||(rect=new $.Rect(imageX,imageY,coordA,coordB)),this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===count)return this.viewer.world.getItemAt(0).imageToViewportRectangle(imageX,imageY,coordA,coordB,!0)}coordA=this.imageToViewportCoordinates(rect.x,rect.y),coordB=this._imageToViewportDelta(rect.width,rect.height);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees)},viewportToImageRectangle:function(viewerX,viewerY,coordA,coordB){var rect=viewerX;if(rect instanceof $.Rect||(rect=new $.Rect(viewerX,viewerY,coordA,coordB)),this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===count)return this.viewer.world.getItemAt(0).viewportToImageRectangle(viewerX,viewerY,coordA,coordB,!0)}coordA=this.viewportToImageCoordinates(rect.x,rect.y),coordB=this._viewportToImageDelta(rect.width,rect.height);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees)},viewerElementToImageCoordinates:function(point){point=this.pointFromPixel(point,!0);return this.viewportToImageCoordinates(point)},imageToViewerElementCoordinates:function(point){point=this.imageToViewportCoordinates(point);return this.pixelFromPoint(point,!0)},windowToImageCoordinates:function(viewerCoordinates){$.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");viewerCoordinates=viewerCoordinates.minus($.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(viewerCoordinates)},imageToWindowCoordinates:function(pixel){return $.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(pixel).plus($.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(pixel){return this.pointFromPixel(pixel,!0)},viewportToViewerElementCoordinates:function(point){return this.pixelFromPoint(point,!0)},viewerElementToViewportRectangle:function(rectangle){return $.Rect.fromSummits(this.pointFromPixel(rectangle.getTopLeft(),!0),this.pointFromPixel(rectangle.getTopRight(),!0),this.pointFromPixel(rectangle.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(rectangle){return $.Rect.fromSummits(this.pixelFromPoint(rectangle.getTopLeft(),!0),this.pixelFromPoint(rectangle.getTopRight(),!0),this.pixelFromPoint(rectangle.getBottomLeft(),!0))},windowToViewportCoordinates:function(viewerCoordinates){$.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");viewerCoordinates=viewerCoordinates.minus($.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(viewerCoordinates)},viewportToWindowCoordinates:function(point){return $.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(point).plus($.getElementPosition(this.viewer.element))},viewportToImageZoom:function(viewportZoom){if(this.viewer){var imageWidth=this.viewer.world.getItemCount();if(1<imageWidth)$.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===imageWidth)return this.viewer.world.getItemAt(0).viewportToImageZoom(viewportZoom)}imageWidth=this._contentSizeNoRotate.x;return viewportZoom*(this._containerInnerSize.x/imageWidth*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(imageZoom){if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===count)return this.viewer.world.getItemAt(0).imageToViewportZoom(imageZoom)}return imageZoom*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(state){return this.flipped===state||(this.flipped=state,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:state})),this}}}(OpenSeadragon),function($){function setTileLoaded(tiledImage,tile,image,cutoff,tileRequest){var increment=0;function getCompletionCallback(){return increment++,completionCallback}function completionCallback(){0===--increment&&(tile.loading=!1,tile.loaded=!0,tile.context2D||tiledImage._tileCache.cacheTile({image:image,tile:tile,cutoff:cutoff,tiledImage:tiledImage}),tiledImage._needsDraw=!0)}tiledImage.viewer.raiseEvent("tile-loaded",{tile:tile,tiledImage:tiledImage,tileRequest:tileRequest,image:image,getCompletionCallback:getCompletionCallback}),getCompletionCallback()()}function providesCoverage(coverage,level,x,y){var rows,cols,i,j;if(!coverage[level])return!1;if(void 0!==x&&void 0!==y)return void 0===coverage[level][x]||void 0===coverage[level][x][y]||!0===coverage[level][x][y];for(i in rows=coverage[level])if(Object.prototype.hasOwnProperty.call(rows,i))for(j in cols=rows[i])if(Object.prototype.hasOwnProperty.call(cols,j)&&!cols[j])return!1;return!0}function isCovered(coverage,level,x,y){return void 0===x||void 0===y?providesCoverage(coverage,level+1):providesCoverage(coverage,level+1,2*x,2*y)&&providesCoverage(coverage,level+1,2*x,2*y+1)&&providesCoverage(coverage,level+1,2*x+1,2*y)&&providesCoverage(coverage,level+1,2*x+1,2*y+1)}function setCoverage(coverage,level,x,y,covers){coverage[level]?(coverage[level][x]||(coverage[level][x]={}),coverage[level][x][y]=covers):$.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",level)}$.TiledImage=function(options){var _this=this;$.console.assert(options.tileCache,"[TiledImage] options.tileCache is required"),$.console.assert(options.drawer,"[TiledImage] options.drawer is required"),$.console.assert(options.viewer,"[TiledImage] options.viewer is required"),$.console.assert(options.imageLoader,"[TiledImage] options.imageLoader is required"),$.console.assert(options.source,"[TiledImage] options.source is required"),$.console.assert(!options.clip||options.clip instanceof $.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),$.EventSource.call(this),this._tileCache=options.tileCache,delete options.tileCache,this._drawer=options.drawer,delete options.drawer,this._imageLoader=options.imageLoader,delete options.imageLoader,options.clip instanceof $.Rect&&(this._clip=options.clip.clone()),delete options.clip;var x=options.x||0;delete options.x;var y=options.y||0;delete options.y,this.normHeight=options.source.dimensions.y/options.source.dimensions.x,this.contentAspectX=options.source.dimensions.x/options.source.dimensions.y;var scale=1;options.width?(scale=options.width,delete options.width,options.height&&($.console.error("specifying both width and height to a tiledImage is not supported"),delete options.height)):options.height&&(scale=options.height/this.normHeight,delete options.height);var fitBounds=options.fitBounds;delete options.fitBounds;var fitBoundsPlacement=options.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete options.fitBoundsPlacement;var degrees=options.degrees||0;delete options.degrees,$.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:$.DEFAULT_SETTINGS.springStiffness,animationTime:$.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:$.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:$.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:$.DEFAULT_SETTINGS.wrapVertical,immediateRender:$.DEFAULT_SETTINGS.immediateRender,blendTime:$.DEFAULT_SETTINGS.blendTime,alwaysBlend:$.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:$.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:$.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:$.DEFAULT_SETTINGS.iOSDevice,debugMode:$.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:$.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:$.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:$.DEFAULT_SETTINGS.placeholderFillStyle,opacity:$.DEFAULT_SETTINGS.opacity,preload:$.DEFAULT_SETTINGS.preload,compositeOperation:$.DEFAULT_SETTINGS.compositeOperation},options),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new $.Spring({initial:x,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new $.Spring({initial:y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new $.Spring({initial:scale,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new $.Spring({initial:degrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),fitBounds&&this.fitBounds(fitBounds,fitBoundsPlacement,!0),this._drawingHandler=function(args){_this.viewer.raiseEvent("tile-drawing",$.extend({tiledImage:_this},args))}},$.extend($.TiledImage.prototype,$.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(flag){flag!==this._fullyLoaded&&(this._fullyLoaded=flag,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=$.now(),this._needsDraw=!0},update:function(){var xUpdated=this._xSpring.update(),yUpdated=this._ySpring.update(),scaleUpdated=this._scaleSpring.update(),degreesUpdated=this._degreesSpring.update();return!!(xUpdated||yUpdated||scaleUpdated||degreesUpdated)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(current){return this.getBoundsNoRotate(current).rotate(this.getRotation(current),this._getRotationPoint(current))},getBoundsNoRotate:function(current){return current?new $.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new $.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return $.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(current){var clip,bounds=this.getBoundsNoRotate(current);return this._clip&&(clip=(current?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,clip=this._clip.times(clip),bounds=new $.Rect(bounds.x+clip.x,bounds.y+clip.y,clip.width,clip.height)),bounds.rotate(this.getRotation(current),this._getRotationPoint(current))},getContentSize:function(){return new $.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(viewerX,viewerY,scale){scale=(scale?this._scaleSpring.current:this._scaleSpring.target).value;return new $.Point(viewerX*(this.source.dimensions.x/scale),viewerY*(this.source.dimensions.y*this.contentAspectX/scale))},viewportToImageCoordinates:function(viewerX,point,current){point=viewerX instanceof $.Point?(current=point,viewerX):new $.Point(viewerX,point);return point=point.rotate(-this.getRotation(current),this._getRotationPoint(current)),current?this._viewportToImageDelta(point.x-this._xSpring.current.value,point.y-this._ySpring.current.value):this._viewportToImageDelta(point.x-this._xSpring.target.value,point.y-this._ySpring.target.value)},_imageToViewportDelta:function(imageX,imageY,scale){scale=(scale?this._scaleSpring.current:this._scaleSpring.target).value;return new $.Point(imageX/this.source.dimensions.x*scale,imageY/this.source.dimensions.y/this.contentAspectX*scale)},imageToViewportCoordinates:function(imageX,point,current){imageX instanceof $.Point&&(current=point,point=imageX.y,imageX=imageX.x);point=this._imageToViewportDelta(imageX,point);return current?(point.x+=this._xSpring.current.value,point.y+=this._ySpring.current.value):(point.x+=this._xSpring.target.value,point.y+=this._ySpring.target.value),point.rotate(this.getRotation(current),this._getRotationPoint(current))},imageToViewportRectangle:function(imageX,imageY,coordA,coordB,current){var rect=imageX;rect instanceof $.Rect?current=imageY:rect=new $.Rect(imageX,imageY,coordA,coordB);coordA=this.imageToViewportCoordinates(rect.getTopLeft(),current),coordB=this._imageToViewportDelta(rect.width,rect.height,current);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees+this.getRotation(current))},viewportToImageRectangle:function(viewerX,viewerY,coordA,coordB,current){var rect=viewerX;viewerX instanceof $.Rect?current=viewerY:rect=new $.Rect(viewerX,viewerY,coordA,coordB);coordA=this.viewportToImageCoordinates(rect.getTopLeft(),current),coordB=this._viewportToImageDelta(rect.width,rect.height,current);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees-this.getRotation(current))},viewerElementToImageCoordinates:function(point){point=this.viewport.pointFromPixel(point,!0);return this.viewportToImageCoordinates(point)},imageToViewerElementCoordinates:function(point){point=this.imageToViewportCoordinates(point);return this.viewport.pixelFromPoint(point,!0)},windowToImageCoordinates:function(viewerCoordinates){viewerCoordinates=viewerCoordinates.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(viewerCoordinates)},imageToWindowCoordinates:function(pixel){return this.imageToViewerElementCoordinates(pixel).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(rect){var scale=this._scaleSpring.current.value;return rect=rect.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new $.Rect((rect.x-this._xSpring.current.value)/scale,(rect.y-this._ySpring.current.value)/scale,rect.width/scale,rect.height/scale,rect.degrees)},viewportToImageZoom:function(viewportZoom){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*viewportZoom},imageToViewportZoom:function(imageZoom){return imageZoom/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(position,immediately){var sameTarget=this._xSpring.target.value===position.x&&this._ySpring.target.value===position.y;if(immediately){if(sameTarget&&this._xSpring.current.value===position.x&&this._ySpring.current.value===position.y)return;this._xSpring.resetTo(position.x),this._ySpring.resetTo(position.y),this._needsDraw=!0}else{if(sameTarget)return;this._xSpring.springTo(position.x),this._ySpring.springTo(position.y),this._needsDraw=!0}sameTarget||this._raiseBoundsChange()},setWidth:function(width,immediately){this._setScale(width,immediately)},setHeight:function(height,immediately){this._setScale(height/this.normHeight,immediately)},setCroppingPolygons:function(polygons){var isXYObject=function(obj){return obj instanceof $.Point||"number"==typeof obj.x&&"number"==typeof obj.y};try{if(!$.isArray(polygons))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=polygons.map(function(polygon){return polygon.map(function(obj){try{if(isXYObject(obj))return{x:obj.x,y:obj.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}})})}catch(e){$.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),$.console.error(e),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(bounds,marginLeft,immediately){marginLeft=marginLeft||$.Placement.CENTER;var width,anchorProperties=$.Placement.properties[marginLeft],aspectRatio=this.contentAspectX,xOffset=0,yOffset=0,marginTop=1,marginLeft=1;this._clip&&(aspectRatio=this._clip.getAspectRatio(),marginTop=this._clip.width/this.source.dimensions.x,marginLeft=this._clip.height/this.source.dimensions.y,yOffset=bounds.getAspectRatio()>aspectRatio?(xOffset=this._clip.x/this._clip.height*bounds.height,this._clip.y/this._clip.height*bounds.height):(xOffset=this._clip.x/this._clip.width*bounds.width,this._clip.y/this._clip.width*bounds.width)),bounds.getAspectRatio()>aspectRatio?(width=bounds.height/marginLeft,marginLeft=0,anchorProperties.isHorizontallyCentered?marginLeft=(bounds.width-bounds.height*aspectRatio)/2:anchorProperties.isRight&&(marginLeft=bounds.width-bounds.height*aspectRatio),this.setPosition(new $.Point(bounds.x-xOffset+marginLeft,bounds.y-yOffset),immediately),this.setHeight(width,immediately)):(width=bounds.width/marginTop,marginTop=0,anchorProperties.isVerticallyCentered?marginTop=(bounds.height-bounds.width/aspectRatio)/2:anchorProperties.isBottom&&(marginTop=bounds.height-bounds.width/aspectRatio),this.setPosition(new $.Point(bounds.x-xOffset,bounds.y-yOffset+marginTop),immediately),this.setWidth(width,immediately))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(newClip){$.console.assert(!newClip||newClip instanceof $.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),newClip instanceof $.Rect?this._clip=newClip.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(opacity){opacity!==this.opacity&&(this.opacity=opacity,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(preload){this._preload=!!preload,this._needsDraw=!0},getRotation:function(current){return(current?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(degrees,immediately){this._degreesSpring.target.value===degrees&&this._degreesSpring.isAtTargetValue()||(immediately?this._degreesSpring.resetTo(degrees):this._degreesSpring.springTo(degrees),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(current){return this.getBoundsNoRotate(current).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(compositeOperation){compositeOperation!==this.compositeOperation&&(this.compositeOperation=compositeOperation,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(scale,immediately){var sameTarget=this._scaleSpring.target.value===scale;if(immediately){if(sameTarget&&this._scaleSpring.current.value===scale)return;this._scaleSpring.resetTo(scale),this._updateForScale(),this._needsDraw=!0}else{if(sameTarget)return;this._scaleSpring.springTo(scale),this._updateForScale(),this._needsDraw=!0}sameTarget||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var lowestLevel=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),highestLevel=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,highestLevel=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(highestLevel/this.minPixelRatio)/Math.log(2)))),highestLevel=Math.max(highestLevel,this.source.minLevel||0);return{lowestLevel:lowestLevel=Math.min(lowestLevel,highestLevel),highestLevel:highestLevel}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var viewport=this.viewport,drawArea=this._viewportToTiledImageRectangle(viewport.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var highestLevel=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(drawArea=drawArea.intersection(highestLevel)))return}for(var highestLevel=this._getLevelsInterval(),lowestLevel=highestLevel.lowestLevel,highestLevel=highestLevel.highestLevel,bestTile=null,haveDrawn=!1,currentTime=$.now(),level=highestLevel;lowestLevel<=level;level--){var drawLevel=!1,currentRenderPixelRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(level),!0).x*this._scaleSpring.current.value;if(level===lowestLevel||!haveDrawn&&currentRenderPixelRatio>=this.minPixelRatio)haveDrawn=drawLevel=!0;else if(!haveDrawn)continue;var targetRenderPixelRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(level),!1).x*this._scaleSpring.current.value,optimalRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,optimalRatio=this.immediateRender?1:optimalRatio,bestTile=function(tiledImage,haveDrawn,drawLevel,level,levelOpacity,levelVisibility,drawArea,currentTime,best){var topLeftBound=drawArea.getBoundingBox().getTopLeft(),cornerTiles=drawArea.getBoundingBox().getBottomRight();tiledImage.viewer&&tiledImage.viewer.raiseEvent("update-level",{tiledImage:tiledImage,havedrawn:haveDrawn,level:level,opacity:levelOpacity,visibility:levelVisibility,drawArea:drawArea,topleft:topLeftBound,bottomright:cornerTiles,currenttime:currentTime,best:best});tiledImage.coverage[level]={},tiledImage.loadingCoverage[level]={};for(var cornerTiles=tiledImage._getCornerTiles(level,topLeftBound,cornerTiles),topLeftTile=cornerTiles.topLeft,bottomRightTile=cornerTiles.bottomRight,numberOfTiles=tiledImage.source.getNumTiles(level),viewportCenter=tiledImage.viewport.pixelFromPoint(tiledImage.viewport.getCenter()),x=topLeftTile.x;x<=bottomRightTile.x;x++)for(var y=topLeftTile.y;y<=bottomRightTile.y;y++){if(!tiledImage.wrapHorizontal&&!tiledImage.wrapVertical){var tileBounds=tiledImage.source.getTileBounds(level,x,y);if(null===drawArea.intersection(tileBounds))continue}best=function(tiledImage,haveDrawn,loadingCoverage,x,y,level,levelOpacity,image,viewportCenter,drawTile,currentTime,best){var tile=function(x,y,level,tiledImage,context2D,tilesMatrix,time,numTiles,worldWidth,worldHeight){var xMod,yMod,bounds,exists,url,ajaxHeaders,tile;tilesMatrix[level]||(tilesMatrix[level]={});tilesMatrix[level][x]||(tilesMatrix[level][x]={});tilesMatrix[level][x][y]||(xMod=(numTiles.x+x%numTiles.x)%numTiles.x,yMod=(numTiles.y+y%numTiles.y)%numTiles.y,bounds=context2D.getTileBounds(level,xMod,yMod),tile=context2D.getTileBounds(level,xMod,yMod,!0),exists=context2D.tileExists(level,xMod,yMod),url=context2D.getTileUrl(level,xMod,yMod),tiledImage.loadTilesWithAjax?(ajaxHeaders=context2D.getTileAjaxHeaders(level,xMod,yMod),$.isPlainObject(tiledImage.ajaxHeaders)&&(ajaxHeaders=$.extend({},tiledImage.ajaxHeaders,ajaxHeaders))):ajaxHeaders=null,context2D=context2D.getContext2D?context2D.getContext2D(level,xMod,yMod):void 0,bounds.x+=(x-xMod)/numTiles.x,bounds.y+=worldHeight/worldWidth*((y-yMod)/numTiles.y),tile=new $.Tile(level,x,y,bounds,exists,url,context2D,tiledImage.loadTilesWithAjax,ajaxHeaders,tile),xMod==numTiles.x-1&&(tile.isRightMost=!0),yMod==numTiles.y-1&&(tile.isBottomMost=!0),tilesMatrix[level][x][y]=tile);return(tile=tilesMatrix[level][x][y]).lastTouchTime=time,tile}(x,y,level,tiledImage,tiledImage.source,tiledImage.tilesMatrix,currentTime,drawTile,tiledImage._worldWidthCurrent,tiledImage._worldHeightCurrent),drawTile=loadingCoverage;tiledImage.viewer&&tiledImage.viewer.raiseEvent("update-tile",{tiledImage:tiledImage,tile:tile});setCoverage(tiledImage.coverage,level,x,y,!1);loadingCoverage=tile.loaded||tile.loading||isCovered(tiledImage.loadingCoverage,level,x,y);if(setCoverage(tiledImage.loadingCoverage,level,x,y,loadingCoverage),!tile.exists)return best;haveDrawn&&!drawTile&&(isCovered(tiledImage.coverage,level,x,y)?setCoverage(tiledImage.coverage,level,x,y,!0):drawTile=!0);if(!drawTile)return best;(function(tile,overlap,viewport,viewportCenter,levelVisibility,tiledImage){var sizeC=tile.bounds.getTopLeft();sizeC.x*=tiledImage._scaleSpring.current.value,sizeC.y*=tiledImage._scaleSpring.current.value,sizeC.x+=tiledImage._xSpring.current.value,sizeC.y+=tiledImage._ySpring.current.value;var tileSquaredDistance=tile.bounds.getSize();tileSquaredDistance.x*=tiledImage._scaleSpring.current.value,tileSquaredDistance.y*=tiledImage._scaleSpring.current.value;var positionC=viewport.pixelFromPointNoRotate(sizeC,!0),positionT=viewport.pixelFromPointNoRotate(sizeC,!1),sizeC=viewport.deltaPixelsFromPointsNoRotate(tileSquaredDistance,!0),tileSquaredDistance=viewport.deltaPixelsFromPointsNoRotate(tileSquaredDistance,!1),tileSquaredDistance=positionT.plus(tileSquaredDistance.divide(2)),tileSquaredDistance=viewportCenter.squaredDistanceTo(tileSquaredDistance);overlap||(sizeC=sizeC.plus(new $.Point(1,1)));tile.isRightMost&&tiledImage.wrapHorizontal&&(sizeC.x+=.75);tile.isBottomMost&&tiledImage.wrapVertical&&(sizeC.y+=.75);tile.position=positionC,tile.size=sizeC,tile.squaredDistance=tileSquaredDistance,tile.visibility=levelVisibility})(tile,tiledImage.source.tileOverlap,tiledImage.viewport,viewportCenter,image,tiledImage),tile.loaded||(tile.context2D?setTileLoaded(tiledImage,tile):(image=tiledImage._tileCache.getImageRecord(tile.cacheKey))&&(image=image.getImage(),setTileLoaded(tiledImage,tile,image)));tile.loaded?function(tiledImage,tile,x,y,level,levelOpacity,opacity){var deltaTime,blendTimeMillis=1e3*tiledImage.blendTime;tile.blendStart||(tile.blendStart=opacity);deltaTime=opacity-tile.blendStart,opacity=blendTimeMillis?Math.min(1,deltaTime/blendTimeMillis):1,tiledImage.alwaysBlend&&(opacity*=levelOpacity);if(tile.opacity=opacity,tiledImage.lastDrawn.push(tile),1===opacity)setCoverage(tiledImage.coverage,level,x,y,!0),tiledImage._hasOpaqueTile=!0;else if(deltaTime<blendTimeMillis)return!0;return!1}(tiledImage,tile,x,y,level,levelOpacity,currentTime)&&(tiledImage._needsDraw=!0):tile.loading?tiledImage._tilesLoading++:loadingCoverage||(best=function(previousBest,tile){if(!previousBest)return tile;{if(tile.visibility>previousBest.visibility)return tile;if(tile.visibility==previousBest.visibility&&tile.squaredDistance<previousBest.squaredDistance)return tile}return previousBest}(best,tile));return best}(tiledImage,drawLevel,haveDrawn,x,y,level,levelOpacity,levelVisibility,viewportCenter,numberOfTiles,currentTime,best)}return best}(this,haveDrawn,drawLevel,level,Math.min(1,(currentRenderPixelRatio-.5)/.5),optimalRatio/Math.abs(optimalRatio-targetRenderPixelRatio),drawArea,currentTime,bestTile);if(providesCoverage(this.coverage,level))break}!function(tiledImage,lastDrawn){if(0!==tiledImage.opacity&&(0!==lastDrawn.length||tiledImage.placeholderFillStyle)){var useSketch,sketchScale,sketchTranslate,tile=lastDrawn[0];tile&&(useSketch=tiledImage.opacity<1||tiledImage.compositeOperation&&"source-over"!==tiledImage.compositeOperation||!tiledImage._isBottomItem()&&tile._hasTransparencyChannel());var bounds,usedClip=tiledImage.viewport.getZoom(!0),usedClip=tiledImage.viewportToImageZoom(usedClip);1<lastDrawn.length&&usedClip>tiledImage.smoothTileEdgesMinZoom&&!tiledImage.iOSDevice&&tiledImage.getRotation(!0)%360==0&&$.supportsCanvas&&(useSketch=!0,sketchScale=tile.getScaleForEdgeSmoothing(),sketchTranslate=tile.getTranslationForEdgeSmoothing(sketchScale,tiledImage._drawer.getCanvasSize(!1),tiledImage._drawer.getCanvasSize(!0))),useSketch&&(sketchScale||(bounds=tiledImage.viewport.viewportToViewerElementRectangle(tiledImage.getClippedBounds(!0)).getIntegerBoundingBox(),tiledImage._drawer.viewer.viewport.getFlip()&&(0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0||(bounds.x=tiledImage._drawer.viewer.container.clientWidth-(bounds.x+bounds.width))),bounds=bounds.times($.pixelDensityRatio)),tiledImage._drawer._clear(!0,bounds)),sketchScale||(0!==tiledImage.viewport.degrees&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.viewport.degrees,useSketch:useSketch}),tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0),useSketch:useSketch}),0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip());var placeholderRect,usedClip=!1;if(tiledImage._clip&&(tiledImage._drawer.saveContext(useSketch),placeholderRect=(placeholderRect=tiledImage.imageToViewportRectangle(tiledImage._clip,!0)).rotate(-tiledImage.getRotation(!0),tiledImage._getRotationPoint(!0)),placeholderRect=tiledImage._drawer.viewportToDrawerRectangle(placeholderRect),sketchScale&&(placeholderRect=placeholderRect.times(sketchScale)),sketchTranslate&&(placeholderRect=placeholderRect.translate(sketchTranslate)),tiledImage._drawer.setClip(placeholderRect,useSketch),usedClip=!0),tiledImage._croppingPolygons){tiledImage._drawer.saveContext(useSketch);try{var fillStyle=tiledImage._croppingPolygons.map(function(polygon){return polygon.map(function(clipPoint){clipPoint=tiledImage.imageToViewportCoordinates(clipPoint.x,clipPoint.y,!0).rotate(-tiledImage.getRotation(!0),tiledImage._getRotationPoint(!0)),clipPoint=tiledImage._drawer.viewportCoordToDrawerCoord(clipPoint);return clipPoint=sketchScale?clipPoint.times(sketchScale):clipPoint})});tiledImage._drawer.clipWithPolygons(fillStyle,useSketch)}catch(e){$.console.error(e)}usedClip=!0}tiledImage.placeholderFillStyle&&!1===tiledImage._hasOpaqueTile&&(placeholderRect=tiledImage._drawer.viewportToDrawerRectangle(tiledImage.getBounds(!0)),sketchScale&&(placeholderRect=placeholderRect.times(sketchScale)),sketchTranslate&&(placeholderRect=placeholderRect.translate(sketchTranslate)),fillStyle=null,fillStyle="function"==typeof tiledImage.placeholderFillStyle?tiledImage.placeholderFillStyle(tiledImage,tiledImage._drawer.context):tiledImage.placeholderFillStyle,tiledImage._drawer.drawRectangle(placeholderRect,fillStyle,useSketch));for(var i=lastDrawn.length-1;0<=i;i--)tile=lastDrawn[i],tiledImage._drawer.drawTile(tile,tiledImage._drawingHandler,useSketch,sketchScale,sketchTranslate),tile.beingDrawn=!0,tiledImage.viewer&&tiledImage.viewer.raiseEvent("tile-drawn",{tiledImage:tiledImage,tile:tile});usedClip&&tiledImage._drawer.restoreContext(useSketch),sketchScale||(tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._restoreRotationChanges(useSketch),0!==tiledImage.viewport.degrees&&tiledImage._drawer._restoreRotationChanges(useSketch)),useSketch&&(sketchScale&&(0!==tiledImage.viewport.degrees&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.viewport.degrees,useSketch:!1}),tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0),useSketch:!1})),tiledImage._drawer.blendSketch({opacity:tiledImage.opacity,scale:sketchScale,translate:sketchTranslate,compositeOperation:tiledImage.compositeOperation,bounds:bounds}),sketchScale&&(tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._restoreRotationChanges(!1),0!==tiledImage.viewport.degrees&&tiledImage._drawer._restoreRotationChanges(!1))),sketchScale||0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip(),function(tiledImage,lastDrawn){if(tiledImage.debugMode)for(var i=lastDrawn.length-1;0<=i;i--){var tile=lastDrawn[i];try{tiledImage._drawer.drawDebugInfo(tile,lastDrawn.length,i,tiledImage)}catch(e){$.console.error(e)}}}(tiledImage,lastDrawn)}}(this,this.lastDrawn),bestTile&&!bestTile.context2D?(function(tiledImage,tile,time){tile.loading=!0,tiledImage._imageLoader.addJob({src:tile.url,loadWithAjax:tile.loadWithAjax,ajaxHeaders:tile.ajaxHeaders,crossOriginPolicy:tiledImage.crossOriginPolicy,ajaxWithCredentials:tiledImage.ajaxWithCredentials,callback:function(image,errorMsg,tileRequest){!function(tiledImage,tile,time,image,errorMsg,tileRequest){var finish;image?time<tiledImage.lastResetTime?($.console.log("Ignoring tile %s loaded before reset: %s",tile,tile.url),tile.loading=!1):(finish=function(){var cutoff=tiledImage.source.getClosestLevel();setTileLoaded(tiledImage,tile,image,cutoff,tileRequest)},tiledImage._midDraw?window.setTimeout(finish,1):finish()):($.console.log("Tile %s failed to load: %s - error: %s",tile,tile.url,errorMsg),tiledImage.viewer.raiseEvent("tile-load-failed",{tile:tile,tiledImage:tiledImage,time:time,message:errorMsg,tileRequest:tileRequest}),tile.loading=!1,tile.exists=!1)}(tiledImage,tile,time,image,errorMsg,tileRequest)},abort:function(){tile.loading=!1}})}(this,bestTile,currentTime),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(numTiles,topLeftBound,bottomRightBound){var leftX,rightX=this.wrapHorizontal?(leftX=$.positiveModulo(topLeftBound.x,1),$.positiveModulo(bottomRightBound.x,1)):(leftX=Math.max(0,topLeftBound.x),Math.min(1,bottomRightBound.x)),aspectRatio=1/this.source.aspectRatio,bottomRightTile=this.wrapVertical?(topLeftTile=$.positiveModulo(topLeftBound.y,aspectRatio),$.positiveModulo(bottomRightBound.y,aspectRatio)):(topLeftTile=Math.max(0,topLeftBound.y),Math.min(aspectRatio,bottomRightBound.y)),topLeftTile=this.source.getTileAtPoint(numTiles,new $.Point(leftX,topLeftTile)),bottomRightTile=this.source.getTileAtPoint(numTiles,new $.Point(rightX,bottomRightTile)),numTiles=this.source.getNumTiles(numTiles);return this.wrapHorizontal&&(topLeftTile.x+=numTiles.x*Math.floor(topLeftBound.x),bottomRightTile.x+=numTiles.x*Math.floor(bottomRightBound.x)),this.wrapVertical&&(topLeftTile.y+=numTiles.y*Math.floor(topLeftBound.y/aspectRatio),bottomRightTile.y+=numTiles.y*Math.floor(bottomRightBound.y/aspectRatio)),{topLeft:topLeftTile,bottomRight:bottomRightTile}}})}(OpenSeadragon),function($){function TileRecord(options){$.console.assert(options,"[TileCache.cacheTile] options is required"),$.console.assert(options.tile,"[TileCache.cacheTile] options.tile is required"),$.console.assert(options.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=options.tile,this.tiledImage=options.tiledImage}function ImageRecord(options){$.console.assert(options,"[ImageRecord] options is required"),$.console.assert(options.image,"[ImageRecord] options.image is required"),this._image=options.image,this._tiles=[]}ImageRecord.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){var canvas;return this._renderedContext||((canvas=document.createElement("canvas")).width=this._image.width,canvas.height=this._image.height,this._renderedContext=canvas.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null),this._renderedContext},setRenderedContext:function(renderedContext){$.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=renderedContext},addTile:function(tile){$.console.assert(tile,"[ImageRecord.addTile] tile is required"),this._tiles.push(tile)},removeTile:function(tile){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===tile)return void this._tiles.splice(i,1);$.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",tile)},getTileCount:function(){return this._tiles.length}},$.TileCache=function(options){this._maxImageCacheCount=(options=options||{}).maxImageCacheCount||$.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},$.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(options){$.console.assert(options,"[TileCache.cacheTile] options is required"),$.console.assert(options.tile,"[TileCache.cacheTile] options.tile is required"),$.console.assert(options.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),$.console.assert(options.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var cutoff=options.cutoff||0,insertionIndex=this._tilesLoaded.length,imageRecord=this._imagesLoaded[options.tile.cacheKey];if(imageRecord||($.console.assert(options.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),imageRecord=this._imagesLoaded[options.tile.cacheKey]=new ImageRecord({image:options.image}),this._imagesLoadedCount++),imageRecord.addTile(options.tile),options.tile.cacheImageRecord=imageRecord,this._imagesLoadedCount>this._maxImageCacheCount){for(var prevTile,worstTime,worstLevel,prevTime,prevLevel,prevTileRecord,worstTile=null,worstTileIndex=-1,worstTileRecord=null,i=this._tilesLoaded.length-1;0<=i;i--)(prevTile=(prevTileRecord=this._tilesLoaded[i]).tile).level<=cutoff||prevTile.beingDrawn||(worstTile?(prevTime=prevTile.lastTouchTime,worstTime=worstTile.lastTouchTime,prevLevel=prevTile.level,worstLevel=worstTile.level,(prevTime<worstTime||prevTime==worstTime&&worstLevel<prevLevel)&&(worstTile=prevTile,worstTileIndex=i,worstTileRecord=prevTileRecord)):(worstTile=prevTile,worstTileIndex=i,worstTileRecord=prevTileRecord));worstTile&&0<=worstTileIndex&&(this._unloadTile(worstTileRecord),insertionIndex=worstTileIndex)}this._tilesLoaded[insertionIndex]=new TileRecord({tile:options.tile,tiledImage:options.tiledImage})},clearTilesFor:function(tiledImage){var tileRecord;$.console.assert(tiledImage,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(tileRecord=this._tilesLoaded[i]).tiledImage===tiledImage&&(this._unloadTile(tileRecord),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(cacheKey){return $.console.assert(cacheKey,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[cacheKey]},_unloadTile:function(imageRecord){$.console.assert(imageRecord,"[TileCache._unloadTile] tileRecord is required");var tile=imageRecord.tile,tiledImage=imageRecord.tiledImage;tile.unload(),tile.cacheImageRecord=null;imageRecord=this._imagesLoaded[tile.cacheKey];imageRecord.removeTile(tile),imageRecord.getTileCount()||(imageRecord.destroy(),delete this._imagesLoaded[tile.cacheKey],this._imagesLoadedCount--),tiledImage.viewer.raiseEvent("tile-unloaded",{tile:tile,tiledImage:tiledImage})}}}(OpenSeadragon),function($){$.World=function(options){var _this=this;$.console.assert(options.viewer,"[World] options.viewer is required"),$.EventSource.call(this),this.viewer=options.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(event){_this._autoRefigureSizes?_this._figureSizes():_this._needsSizesFigured=!0},this._figureSizes()},$.extend($.World.prototype,$.EventSource.prototype,{addItem:function(item,index){$.console.assert(item,"[World.addItem] item is required"),$.console.assert(item instanceof $.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(index=index||{}).index?(index=Math.max(0,Math.min(this._items.length,index.index)),this._items.splice(index,0,item)):this._items.push(item),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,item.addHandler("bounds-change",this._delegatedFigureSizes),item.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:item})},getItemAt:function(index){return $.console.assert(void 0!==index,"[World.getItemAt] index is required"),this._items[index]},getIndexOfItem:function(item){return $.console.assert(item,"[World.getIndexOfItem] item is required"),$.indexOf(this._items,item)},getItemCount:function(){return this._items.length},setItemIndex:function(item,index){$.console.assert(item,"[World.setItemIndex] item is required"),$.console.assert(void 0!==index,"[World.setItemIndex] index is required");var oldIndex=this.getIndexOfItem(item);if(index>=this._items.length)throw new Error("Index bigger than number of layers.");index!==oldIndex&&-1!==oldIndex&&(this._items.splice(oldIndex,1),this._items.splice(index,0,item),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:item,previousIndex:oldIndex,newIndex:index}))},removeItem:function(item){$.console.assert(item,"[World.removeItem] item is required");var index=$.indexOf(this._items,item);-1!==index&&(item.removeHandler("bounds-change",this._delegatedFigureSizes),item.removeHandler("clip-change",this._delegatedFigureSizes),item.destroy(),this._items.splice(index,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(item))},removeAll:function(){var item,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(item=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),item.removeHandler("clip-change",this._delegatedFigureSizes),item.destroy();var removedItems=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<removedItems.length;i++)item=removedItems[i],this._raiseRemoveItem(item)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var animated=!1,i=0;i<this._items.length;i++)animated=this._items[i].update()||animated;return animated},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(value){(this._autoRefigureSizes=value)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(options){var item,width,position,immediately=(options=options||{}).immediately||!1,layout=options.layout||$.DEFAULT_SETTINGS.collectionLayout,rows=options.rows||$.DEFAULT_SETTINGS.collectionRows,columns=options.columns||$.DEFAULT_SETTINGS.collectionColumns,tileSize=options.tileSize||$.DEFAULT_SETTINGS.collectionTileSize,increment=tileSize+(options.tileMargin||$.DEFAULT_SETTINGS.collectionTileMargin),wrap=!options.rows&&columns?columns:Math.ceil(this._items.length/rows),x=0,y=0;this.setAutoRefigureSizes(!1);for(var i=0;i<this._items.length;i++)i&&i%wrap==0&&("horizontal"===layout?(y+=increment,x=0):(x+=increment,y=0)),position=(width=(position=(item=this._items[i]).getBounds()).width>position.height?tileSize:tileSize*(position.width/position.height))*(position.height/position.width),position=new $.Point(x+(tileSize-width)/2,y+(tileSize-position)/2),item.setPosition(position,immediately),item.setWidth(width,immediately),"horizontal"===layout?x+=increment:y+=increment;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var oldHomeBounds=this._homeBounds?this._homeBounds.clone():null,oldContentSize=this._contentSize?this._contentSize.clone():null,oldContentFactor=this._contentFactor||0;if(this._items.length){var item=this._items[0],bounds=item.getBounds();this._contentFactor=item.getContentSize().x/bounds.width;for(var clippedBounds=item.getClippedBounds().getBoundingBox(),left=clippedBounds.x,top=clippedBounds.y,right=clippedBounds.x+clippedBounds.width,bottom=clippedBounds.y+clippedBounds.height,i=1;i<this._items.length;i++)bounds=(item=this._items[i]).getBounds(),this._contentFactor=Math.max(this._contentFactor,item.getContentSize().x/bounds.width),clippedBounds=item.getClippedBounds().getBoundingBox(),left=Math.min(left,clippedBounds.x),top=Math.min(top,clippedBounds.y),right=Math.max(right,clippedBounds.x+clippedBounds.width),bottom=Math.max(bottom,clippedBounds.y+clippedBounds.height);this._homeBounds=new $.Rect(left,top,right-left,bottom-top),this._contentSize=new $.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new $.Rect(0,0,1,1),this._contentSize=new $.Point(1,1),this._contentFactor=1;this._contentFactor===oldContentFactor&&this._homeBounds.equals(oldHomeBounds)&&this._contentSize.equals(oldContentSize)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(item){this.raiseEvent("remove-item",{item:item})}})}(OpenSeadragon),function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView)}function e(n,t){return n<t?-1:t<n?1:t<=n?0:NaN}function r(n){return null===n?NaN:+n}function i(n){return!isNaN(n)}function u(n){return{left:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var u=r+i>>>1;n(t[u],e)<0?r=1+u:i=u}return r},right:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var u=r+i>>>1;0<n(t[u],e)?i=u:r=1+u}return r}}}function o(n){return n.length}function l(n,t){for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}function c(){this._=Object.create(null)}function f(n){return(n+="")===bo||n[0]===_o?_o+n:n}function s(n){return(n+="")[0]===_o?n.slice(1):n}function h(n){return f(n)in this._}function p(n){return(n=f(n))in this._&&delete this._[n]}function g(){var t,n=[];for(t in this._)n.push(s(t));return n}function v(){var t,n=0;for(t in this._)++n;return n}function d(){for(var n in this._)return!1;return!0}function y(){this._=Object.create(null)}function m(n){return n}function x(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=wo.length;e<r;++e){var i=wo[e]+t;if(i in n)return i}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,i=-1,u=r.length;++i<u;)(t=r[i].on)&&t.apply(this,arguments);return n}var e=[],r=new c;return t.on=function(t,i){var u=r.get(t);return arguments.length<2?u&&u.on:(u&&(u.on=null,e=e.slice(0,u=e.indexOf(u)).concat(e.slice(u+1)),r.remove(t)),i&&e.push(r.set(t,{on:i})),n)},t}function S(){ao.event.preventDefault()}function k(){for(var n,t=ao.event;n=t.sourceEvent;)t=n;return t}function N(n){for(var t=new _,e=0,r=arguments.length;++e<r;)t[arguments[e]]=w(t);return t.of=function(e,r){return function(i){try{var u=i.sourceEvent=ao.event;i.target=n,ao.event=i,t[i.type].apply(e,r)}finally{ao.event=u}}},t}function E(n){return ko(n,Co),n}function A(n){return"function"==typeof n?n:function(){return No(n,this)}}function C(n){return"function"==typeof n?n:function(){return Eo(n,this)}}function z(n,t){return n=ao.ns.qualify(n),null==t?n.local?function(){this.removeAttributeNS(n.space,n.local)}:function(){this.removeAttribute(n)}:"function"==typeof t?n.local?function(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}:function(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}:n.local?function(){this.setAttributeNS(n.space,n.local,t)}:function(){this.setAttribute(n,t)}}function L(n){return n.trim().replace(/\s+/g," ")}function q(n){return new RegExp("(?:^|\\s+)"+ao.requote(n)+"(?:\\s+|$)","g")}function T(n){return(n+"").trim().split(/^|\s+/)}function R(n,t){var i=(n=T(n).map(D)).length;return"function"==typeof t?function(){for(var e=-1,r=t.apply(this,arguments);++e<i;)n[e](this,r)}:function(){for(var e=-1;++e<i;)n[e](this,t)}}function D(n){var t=q(n);return function(e,r){if(i=e.classList)return r?i.add(n):i.remove(n);var i=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||e.setAttribute("class",L(i+" "+n))):e.setAttribute("class",L(i.replace(t," ")))}}function P(n,t,e){return null==t?function(){this.style.removeProperty(n)}:"function"==typeof t?function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}:function(){this.style.setProperty(n,t,e)}}function U(n,t){return null==t?function(){delete this[n]}:"function"==typeof t?function(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}:function(){this[n]=t}}function j(n){return"function"==typeof n?n:(n=ao.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){var t=this.ownerDocument,e=this.namespaceURI;return e===zo&&t.documentElement.namespaceURI===zo?t.createElement(n):t.createElementNS(e,n)}}function F(){var n=this.parentNode;n&&n.removeChild(this)}function H(n){return{__data__:n}}function O(n){return function(){return Ao(this,n)}}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function Y(n,t){for(var e=0,r=n.length;e<r;e++)for(var i,u=n[e],o=0,a=u.length;o<a;o++)(i=u[o])&&t(i,o,e);return n}function Z(n){return ko(n,qo),n}function X(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}var o="__on"+n,a=n.indexOf("."),l=$;0<a&&(n=n.slice(0,a));var c=To.get(n);return c&&(n=c,l=B),a?t?function(){var i=l(t,co(arguments));r.call(this),this.addEventListener(n,this[o]=i,i.$=e),i._=t}:r:t?b:function(){var t,r,i,e=new RegExp("^__on([^.]+)"+ao.requote(n)+"$");for(r in this)(t=r.match(e))&&(i=this[r],this.removeEventListener(t[1],i,i.$),delete this[r])}}function $(n,t){return function(e){var r=ao.event;ao.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ao.event=r}}}function B(n,t){var e=$(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function W(e){var o,a,r=".dragsuppress-"+ ++Do,i="click"+r,u=ao.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);return(Ro=null==Ro?!("onselectstart"in e)&&x(e.style,"userSelect"):Ro)&&(o=n(e).style,a=o[Ro],o[Ro]="none"),function(n){var t;u.on(r,null),Ro&&(o[Ro]=a),n&&(t=function(){u.on(i,null)},u.on(i,function(){S(),t()},!0),setTimeout(t,0))}}function J(n,e){if(e.changedTouches&&(e=e.changedTouches[0]),(r=n.ownerSVGElement||n).createSVGPoint){var r,o,a=r.createSVGPoint();return Po<0&&(((o=t(n)).scrollX||o.scrollY)&&(o=(r=ao.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM(),Po=!(o.f||o.e),r.remove())),Po?(a.x=e.pageX,a.y=e.pageY):(a.x=e.clientX,a.y=e.clientY),[(a=a.matrixTransform(n.getScreenCTM().inverse())).x,a.y]}a=n.getBoundingClientRect();return[e.clientX-a.left-n.clientLeft,e.clientY-a.top-n.clientTop]}function G(){return ao.event.changedTouches[0].identifier}function K(n){return 0<n?1:n<0?-1:0}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function nn(n){return 1<n?0:n<-1?Fo:Math.acos(n)}function tn(n){return 1<n?Io:n<-1?-Io:Math.asin(n)}function rn(n){return((n=Math.exp(n))+1/n)/2}function on(n){return(n=Math.sin(n/2))*n}function an(){}function ln(n,t,e){return this instanceof ln?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof ln?new ln(n.h,n.s,n.l):_n(""+n,wn,ln):new ln(n,t,e)}function cn(n,t,e){function i(n){return Math.round(255*function(n){return 360<n?n-=360:n<0&&(n+=360),n<60?u+(o-u)*n/60:n<180?o:n<240?u+(o-u)*(240-n)/60:u}(n))}var u,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)||t<0?0:1<t?1:t,u=2*(e=e<0?0:1<e?1:e)-(o=e<=.5?e*(1+t):e+t-e*t),new mn(i(n+120),i(n),i(n-120))}function fn(n,t,e){return this instanceof fn?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof fn?new fn(n.h,n.c,n.l):gn((n instanceof hn?n:n=Sn((n=ao.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new fn(n,t,e)}function sn(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new hn(e,Math.cos(n*=Yo)*t,Math.sin(n)*t)}function hn(n,t,e){return this instanceof hn?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof hn?new hn(n.l,n.a,n.b):n instanceof fn?sn(n.h,n.c,n.l):Sn((n=mn(n)).r,n.g,n.b):new hn(n,t,e)}function pn(r,i,u){r=(r+16)/116,u=r-u/200;return new mn(yn(3.2404542*(i=vn(i=r+i/500)*na)-1.5371385*(r=vn(r)*ta)-.4985314*(u=vn(u)*ea)),yn(-.969266*i+1.8760108*r+.041556*u),yn(.0556434*i-.2040259*r+1.0572252*u))}function gn(n,t,e){return 0<n?new fn(Math.atan2(e,t)*Zo,Math.sqrt(t*t+e*e),n):new fn(NaN,NaN,n)}function vn(n){return.206893034<n?n*n*n:(n-4/29)/7.787037}function dn(n){return.008856<n?Math.pow(n,1/3):7.787037*n+4/29}function yn(n){return Math.round(255*(n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function mn(n,t,e){return this instanceof mn?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof mn?new mn(n.r,n.g,n.b):_n(""+n,mn,cn):new mn(n,t,e)}function Mn(n){return new mn(n>>16,n>>8&255,255&n)}function xn(n){return Mn(n)+""}function bn(n){return n<16?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function _n(n,t,e){var i,u,o=0,a=0,l=0;if(u=/([a-z]+)\((.*)\)/.exec(n=n.toLowerCase()))switch(i=u[2].split(","),u[1]){case"hsl":return e(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Nn(i[0]),Nn(i[1]),Nn(i[2]))}return(u=ua.get(n))?t(u.r,u.g,u.b):(null==n||"#"!==n.charAt(0)||isNaN(u=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&u)>>4,o|=o>>4,a=240&u,a|=a>>4,l=15&u,l|=l<<4):7===n.length&&(o=(16711680&u)>>16,a=(65280&u)>>8,l=255&u)),t(o,a,l))}function wn(n,t,e){var r,i,u=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-u,l=(o+u)/2;return a?(i=l<.5?a/(o+u):a/(2-o-u),r=n==o?(t-e)/a+(t<e?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=NaN,i=0<l&&l<1?0:r),new ln(r,i,l)}function Sn(n,t,e){var r=dn((.4124564*(n=kn(n))+.3575761*(t=kn(t))+.1804375*(e=kn(e)))/na),i=dn((.2126729*n+.7151522*t+.072175*e)/ta);return hn(116*i-16,500*(r-i),200*(i-dn((.0193339*n+.119192*t+.9503041*e)/ea)))}function kn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Nn(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function En(n){return"function"==typeof n?n:function(){return n}}function An(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Cn(t,e,n,r)}}function Cn(n,t,e,r){function i(){var n,t=l.status;if(!t&&function(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}(l)||200<=t&&t<300||304===t){try{n=e.call(u,l)}catch(r){return void o.error.call(u,r)}o.load.call(u,n)}else o.error.call(u,l)}var u={},o=ao.dispatch("beforesend","progress","load","error"),a={},l=new XMLHttpRequest,c=null;return"onload"in(l=this.XDomainRequest&&!("withCredentials"in l)&&/^(http(s)?:)?\/\//.test(n)?new XDomainRequest:l)?l.onload=l.onerror=i:l.onreadystatechange=function(){3<l.readyState&&i()},l.onprogress=function(n){var t=ao.event;ao.event=n;try{o.progress.call(u,l)}finally{ao.event=t}},u.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",u)},u.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",u):t},u.responseType=function(n){return arguments.length?(c=n,u):c},u.response=function(n){return e=n,u},["get","post"].forEach(function(n){u[n]=function(){return u.send.apply(u,[n].concat(co(arguments)))}}),u.send=function(e,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),l.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),l.setRequestHeader)for(var f in a)l.setRequestHeader(f,a[f]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=i&&u.on("error",i).on("load",function(n){i(null,n)}),o.beforesend.call(u,l),l.send(null==r?null:r),u},u.abort=function(){return l.abort(),u},ao.rebind(u,o,"on"),null==r?u:u.get(function(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}(r))}function qn(n,t,e){var u=arguments.length;u<2&&(t=0);u={c:n,t:(e=u<3?Date.now():e)+t,n:null};return aa?aa.n=u:oa=u,aa=u,la||(ca=clearTimeout(ca),la=1,fa(Tn)),u}function Tn(){var t=Rn(),t=Dn()-t;24<t?(isFinite(t)&&(clearTimeout(ca),ca=setTimeout(Tn,t)),la=0):(la=1,fa(Tn))}function Rn(){for(var n=Date.now(),t=oa;t;)n>=t.t&&t.c(n-t.t)&&(t.c=null),t=t.n;return n}function Dn(){for(var n,t=oa,e=1/0;t;)t=t.c?(t.t<e&&(e=t.t),(n=t).n):n?n.n=t.n:oa=t.n;return aa=n,e}function Pn(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Fn(n){return n+""}function Hn(){this._=new Date(1<arguments.length?Date.UTC.apply(this,arguments):arguments[0])}function On(n,t,e){function r(t){var e=n(t),r=u(e,1);return t-e<r-t?e:r}function i(e){return t(e=n(new va(e-1)),1),e}function u(n,e){return t(n=new va(+n),e),n}function o(n,r,u){var o=i(n),a=[];if(1<u)for(;o<r;)e(o)%u||a.push(new Date(+o)),t(o,1);else for(;o<r;)a.push(new Date(+o)),t(o,1);return a}(n.floor=n).round=r,n.ceil=i,n.offset=u,n.range=o;var l=n.utc=In(n);return(l.floor=l).round=In(r),l.ceil=In(i),l.offset=In(u),l.range=function(n,t,e){try{var r=new(va=Hn);return r._=n,o(r,t,e)}finally{va=Date}},n}function In(n){return function(t,e){try{var r=new(va=Hn);return r._=t,n(r,e)._}finally{va=Date}}}function Zn(u,t,e){var r=u<0?"-":"",i=(r?-u:u)+"",u=i.length;return r+(u<e?new Array(e-u+1).join(t)+i:i)}function Vn(n){return new RegExp("^(?:"+n.map(ao.requote).join("|")+")","i")}function Xn(n){for(var t=new c,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function $n(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Bn(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function Wn(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Jn(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Gn(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+2));return r?(n.y=function(n){return n+(68<n?1900:2e3)}(+r[0]),e+r[0].length):-1}function Kn(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function nt(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function tt(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function et(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function rt(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function it(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function ut(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ot(n,r,e){ma.lastIndex=0;r=ma.exec(r.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function at(r){var i=r.getTimezoneOffset(),e=0<i?"-":"+",r=xo(i)/60|0,i=xo(i)%60;return e+Zn(r,"0",2)+Zn(i,"0",2)}function lt(n,r,e){Ma.lastIndex=0;r=Ma.exec(r.slice(e,e+1));return r?e+r[0].length:-1}function ct(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ft(){}function st(n,t,e){var r=e.s=n+t,i=r-n;e.t=n-(r-i)+(t-i)}function ht(n,t){n&&wa.hasOwnProperty(n.type)&&wa[n.type](n,t)}function pt(n,t,e){var r,i=-1,u=n.length-e;for(t.lineStart();++i<u;)r=n[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function gt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)pt(n[e],t,1);t.polygonEnd()}function vt(){function n(n,s){s=s*Yo/2+Fo/4;var f=(n*=Yo)-r,o=0<=f?1:-1,h=o*f,l=Math.cos(s),c=Math.sin(s),f=u*c,s=i*l+f*Math.cos(h),h=f*o*Math.sin(h);ka.add(Math.atan2(h,s)),r=n,i=l,u=c}var t,e,r,i,u;Na.point=function(o,a){Na.point=n,r=(t=o)*Yo,i=Math.cos(a=(e=a)*Yo/2+Fo/4),u=Math.sin(a)},Na.lineEnd=function(){n(t,e)}}function dt(r){var t=r[0],e=r[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function yt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function mt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Mt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function xt(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function bt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function _t(n){return[Math.atan2(n[1],n[0]),tn(n[2])]}function wt(n,t){return xo(n[0]-t[0])<Uo&&xo(n[1]-t[1])<Uo}function St(n,t){n*=Yo;var e=Math.cos(t*=Yo);kt(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function kt(n,t,e){Ca+=(n-Ca)/++Ea,za+=(t-za)/Ea,La+=(e-La)/Ea}function Nt(){function n(l,c){l*=Yo;var a=Math.cos(c*=Yo),o=a*Math.cos(l),a=a*Math.sin(l),l=Math.sin(c),c=Math.atan2(Math.sqrt((c=e*l-r*a)*c+(c=r*o-t*l)*c+(c=t*a-e*o)*c),t*o+e*a+r*l);Aa+=c,qa+=c*(t+(t=o)),Ta+=c*(e+(e=a)),Ra+=c*(r+(r=l)),kt(t,e,r)}var t,e,r;ja.point=function(i,u){i*=Yo;var o=Math.cos(u*=Yo);t=o*Math.cos(i),e=o*Math.sin(i),r=Math.sin(u),ja.point=n,kt(t,e,r)}}function Et(){ja.point=St}function At(){function n(v,g){v*=Yo;var h=Math.cos(g*=Yo),o=h*Math.cos(v),a=h*Math.sin(v),l=Math.sin(g),c=i*l-u*a,f=u*o-r*l,s=r*a-i*o,h=Math.sqrt(c*c+f*f+s*s),v=r*o+i*a+u*l,g=h&&-nn(v)/h,v=Math.atan2(h,v);Da+=g*c,Pa+=g*f,Ua+=g*s,Aa+=v,qa+=v*(r+(r=o)),Ta+=v*(i+(i=a)),Ra+=v*(u+(u=l)),kt(r,i,u)}var t,e,r,i,u;ja.point=function(o,a){t=o,e=a,ja.point=n,o*=Yo;var l=Math.cos(a*=Yo);r=l*Math.cos(o),i=l*Math.sin(o),u=Math.sin(a),kt(r,i,u)},ja.lineEnd=function(){n(t,e),ja.lineEnd=Et,ja.point=St}}function Ct(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return(e=t.invert(e,r))&&n.invert(e[0],e[1])}),e}function zt(){return!0}function Lt(n,t,e,r,i){var u=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(wt(e,r)){i.lineStart();for(var a=0;a<t;++a)i.point((e=n[a])[0],e[1]);i.lineEnd()}else{var l=new Tt(e,n,null,!0),c=new Tt(e,null,l,!1);l.o=c,u.push(l),o.push(c),l=new Tt(r,n,null,!1),c=new Tt(r,null,l,!0),l.o=c,u.push(l),o.push(c)}}}),o.sort(t),qt(u),qt(o),u.length){for(var a=0,l=e,c=o.length;a<c;++a)o[a].e=l=!l;for(var s,h=u[0];;){for(var p=h,g=!0;p.v;)if((p=p.n)===h)return;f=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(g)for(a=0,c=f.length;a<c;++a)i.point((s=f[a])[0],s[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(g)for(var f,a=(f=p.p.z).length-1;0<=a;--a)i.point((s=f[a])[0],s[1]);else r(p.x,p.p.x,-1,i);p=p.p}}while(f=(p=p.o).z,g=!g,!p.v);i.lineEnd()}}}function qt(n){if(t=n.length){for(var t,e,r=0,i=n[0];++r<t;)i.n=e=n[r],e.p=i,i=e;i.n=e=n[0],e.p=i}}function Tt(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Rt(n,t,e,r){return function(i,u){function o(t,e){var r=i(t,e);n(t=r[0],e=r[1])&&u.point(t,e)}function a(n,e){e=i(n,e);d.point(e[0],e[1])}function l(){m.point=a,d.lineStart()}function c(){m.point=o,d.lineEnd()}function f(n,e){v.push([n,e]);e=i(n,e);x.point(e[0],e[1])}function s(){x.lineStart(),v=[]}function h(){f(v[0][0],v[0][1]),x.lineEnd();var t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),g.push(v),v=null,r)if(1&t){var n,i,o=-1;if(0<(r=(n=e[0]).length-1)){for(b||(u.polygonStart(),b=!0),u.lineStart();++o<r;)u.point((i=n[o])[0],i[1]);u.lineEnd()}}else 1<r&&2&t&&e.push(e.pop().concat(e.shift())),p.push(e.filter(Dt))}var p,g,v,d=t(u),y=i.invert(r[0],r[1]),m={point:o,lineStart:l,lineEnd:c,polygonStart:function(){m.point=f,m.lineStart=s,m.lineEnd=h,p=[],g=[]},polygonEnd:function(){m.point=o,m.lineStart=l,m.lineEnd=c,p=ao.merge(p);var n=function(n,t){var e=n[0],r=n[1],i=[Math.sin(e),-Math.cos(e),0],u=0,o=0;ka.reset();for(var a=0,l=t.length;a<l;++a){var c=t[a],f=c.length;if(f)for(var s=c[0],h=s[0],p=s[1]/2+Fo/4,g=Math.sin(p),v=Math.cos(p),d=1;;){var y=(n=c[d=d===f?0:d])[0],k=n[1]/2+Fo/4,M=Math.sin(k),x=Math.cos(k),b=y-h,A=0<=b?1:-1,N=A*b,S=Fo<N,k=g*M;if(ka.add(Math.atan2(k*A*Math.sin(N),v*x+k*Math.cos(N))),u+=S?b+A*Ho:b,S^e<=h^e<=y&&(bt(N=mt(dt(s),dt(n))),bt(A=mt(i,N)),((A=(S^0<=b?-1:1)*tn(A[2]))<r||r===A&&(N[0]||N[1]))&&(o+=S^0<=b?1:-1)),!d++)break;h=y,g=M,v=x,s=n}}return(u<-Uo||u<Uo&&ka<-Uo)^1&o}(y,g);p.length?(b||(u.polygonStart(),b=!0),Lt(p,Ut,n,e,u)):n&&(b||(u.polygonStart(),b=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),b&&(u.polygonEnd(),b=!1),p=g=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}},M=Pt(),x=t(M),b=!1;return m}}function Dt(n){return 1<n.length}function Pt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){1<t.length&&t.push(t.pop().concat(t.shift()))}}}function Ut(n,t){return((n=n.x)[0]<0?n[1]-Io-Uo:Io-n[1])-((t=t.x)[0]<0?t[1]-Io-Uo:Io-t[1])}function It(n){function t(n,t){return Math.cos(n)*Math.cos(t)>u}function r(E,A,N){var z=[1,0,0],x=mt(dt(E),dt(A)),k=yt(x,x),b=x[0],w=k-b*b;if(!w)return!N&&E;var S=mt(z,x),g=xt(z,u*k/w);Mt(g,xt(x,-u*b/w));var d=S,y=yt(g,d),z=yt(d,d),k=y*y-z*(yt(g,g)-1);if(!(k<0)){x=Math.sqrt(k),b=xt(d,(-y-x)/z);if(Mt(b,g),b=_t(b),!N)return b;var _,w=E[0],S=A[0],k=E[1],N=A[1];S<w&&(_=w,w=S,S=_);E=S-w,A=xo(E-Fo)<Uo;if(!A&&N<k&&(_=k,k=N,N=_),A||E<Uo?A?0<k+N^b[1]<(xo(b[0]-w)<Uo?k:N):k<=b[1]&&b[1]<=N:Fo<E^(w<=b[0]&&b[0]<=S)){z=xt(d,(-y+x)/z);return Mt(z,g),[b,_t(z)]}}}function i(t,e){var r=o?n:Fo-n,i=0;return t<-r?i|=1:r<t&&(i|=2),e<-r?i|=4:r<e&&(i|=8),i}var u=Math.cos(n),o=0<u,a=xo(u)>Uo;return Rt(t,function(n){var e,u,l,c,f;return{lineStart:function(){c=l=!1,f=1},point:function(s,d){var p,y,g=[s,d],v=t(s,d),d=o?v?0:i(s,d):v?i(s+(s<0?Fo:-Fo),d):0;!e&&(c=l=v)&&n.lineStart(),v!==l&&(p=r(e,g),(wt(e,p)||wt(g,p))&&(g[0]+=Uo,g[1]+=Uo,v=t(g[0],g[1]))),v!==l?(f=0,v?(n.lineStart(),p=r(g,e),n.point(p[0],p[1])):(p=r(e,g),n.point(p[0],p[1]),n.lineEnd()),e=p):a&&e&&o^v&&(d&u||!(y=r(g,e,!0))||(f=0,o?(n.lineStart(),n.point(y[0][0],y[0][1]),n.point(y[1][0],y[1][1]),n.lineEnd()):(n.point(y[1][0],y[1][1]),n.lineEnd(),n.lineStart(),n.point(y[0][0],y[0][1])))),!v||e&&wt(e,g)||n.point(g[0],g[1]),e=g,l=v,u=d},lineEnd:function(){l&&n.lineEnd(),e=null},clean:function(){return f|(c&&l)<<1}}},ve(n,6*Yo),o?[0,-n]:[-Fo,n-Fo])}function Yt(n,t,e,r){return function(i){var v=i.a,u=i.b,l=v.x,c=v.y,h=0,p=1,g=u.x-l,v=u.y-c,u=n-l;if(g||!(0<u)){if(u/=g,g<0){if(u<h)return;u<p&&(p=u)}else if(0<g){if(p<u)return;h<u&&(h=u)}if(u=e-l,g||!(u<0)){if(u/=g,g<0){if(p<u)return;h<u&&(h=u)}else if(0<g){if(u<h)return;u<p&&(p=u)}if(u=t-c,v||!(0<u)){if(u/=v,v<0){if(u<h)return;u<p&&(p=u)}else if(0<v){if(p<u)return;h<u&&(h=u)}if(u=r-c,v||!(u<0)){if(u/=v,v<0){if(p<u)return;h<u&&(h=u)}else if(0<v){if(u<h)return;u<p&&(p=u)}return 0<h&&(i.a={x:l+h*g,y:c+h*v}),p<1&&(i.b={x:l+p*g,y:c+p*v}),i}}}}}}function Zt(n,t,e,r){function i(r,i){return xo(r[0]-n)<Uo?0<i?0:3:xo(r[0]-e)<Uo?0<i?2:1:xo(r[1]-t)<Uo?0<i?1:0:0<i?3:2}function u(n,t){return o(n.x,t.x)}function o(n,t){var e=i(n,1),r=i(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(u,a,l,c){var f=0,s=0;if(null==u||(f=i(u,l))!==(s=i(a,l))||o(u,a)<0^0<l)for(;c.point(0===f||3===f?n:e,1<f?r:t),(f=(f+l+4)%4)!==s;);else c.point(a[0],a[1])}function f(i,u){return n<=i&&i<=e&&t<=u&&u<=r}function s(n,t){f(n,t)&&a.point(n,t)}function g(n,t){var r,e=f(n=Math.max(-Ha,Math.min(Ha,n)),t=Math.max(-Ha,Math.min(Ha,t)));d&&y.push([n,t]),S?(m=n,M=t,S=!1,(x=e)&&(a.lineStart(),a.point(n,t))):e&&w?a.point(n,t):A(r={a:{x:b,y:_},b:{x:n,y:t}})?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1),b=n,_=t,w=e}var v,d,y,m,M,x,b,_,w,S,k,N=a,E=Pt(),A=Yt(n,t,e,r),C={point:s,lineStart:function(){C.point=g,d&&d.push(y=[]),w=!(S=!0),b=_=NaN},lineEnd:function(){v&&(g(m,M),x&&w&&E.rejoin(),v.push(E.buffer())),C.point=s,w&&a.lineEnd()},polygonStart:function(){a=E,v=[],d=[],k=!0},polygonEnd:function(){a=N,v=ao.merge(v);var t=function(n){for(var t=0,e=d.length,r=n[1],i=0;i<e;++i)for(var u,o=1,a=d[i],l=a.length,c=a[0];o<l;++o)u=a[o],c[1]<=r?u[1]>r&&0<Q(c,u,n)&&++t:u[1]<=r&&Q(c,u,n)<0&&--t,c=u;return 0!==t}([n,r]),e=k&&t,i=v.length;(e||i)&&(a.polygonStart(),e&&(a.lineStart(),c(null,null,1,a),a.lineEnd()),i&&Lt(v,u,t,c,a),a.polygonEnd()),v=d=y=null}};return C}}function Vt(i){var t=0,e=Fo/3,r=ae(i),i=r(t,e);return i.parallels=function(n){return arguments.length?r(t=n[0]*Fo/180,e=n[1]*Fo/180):[t/Fo*180,e/Fo*180]},i}function Xt(r,t){function e(n,e){e=Math.sqrt(u-2*i*Math.sin(e))/i;return[e*Math.sin(n*=i),o-e*Math.cos(n)]}var r=Math.sin(r),i=(r+Math.sin(t))/2,u=1+r*(2*i-r),o=Math.sqrt(u)/i;return e.invert=function(n,e){e=o-e;return[Math.atan2(n,e)/i,tn((u-(n*n+e*e)*i*i)/(2*i))]},e}function $t(){function n(n,t){Ia+=i*n-r*t,r=n,i=t}var t,e,r,i;$a.point=function(u,o){$a.point=n,t=r=u,e=i=o},$a.lineEnd=function(){n(t,e)}}function Wt(){function n(n,t){o.push("M",n,",",t,u)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function i(){o.push("Z")}var u=Jt(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return u=Jt(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Jt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Gt(n,t){Ca+=n,za+=t,++La}function Kt(){function n(n,r){var i=n-t,o=r-e,o=Math.sqrt(i*i+o*o);qa+=o*(t+n)/2,Ta+=o*(e+r)/2,Ra+=o,Gt(t=n,e=r)}var t,e;Wa.point=function(r,i){Wa.point=n,Gt(t=r,e=i)}}function Qt(){Wa.point=Gt}function ne(){function n(n,t){var e=n-r,o=t-i,o=Math.sqrt(e*e+o*o);qa+=o*(r+n)/2,Ta+=o*(i+t)/2,Ra+=o,Da+=(o=i*n-r*t)*(r+n),Pa+=o*(i+t),Ua+=3*o,Gt(r=n,i=t)}var t,e,r,i;Wa.point=function(u,o){Wa.point=n,Gt(t=r=u,e=i=o)},Wa.lineEnd=function(){n(t,e)}}function te(n){function t(t,e){n.moveTo(t+o,e),n.arc(t,e,o,0,Ho)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function i(){a.point=t}function u(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:i,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=i,a.point=t},pointRadius:function(n){return o=n,a},result:b};return a}function ee(n){function t(n){return(a?r:e)(n)}function e(t){return ue(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){M=NaN,S.point=u,t.lineStart()}function u(e,o){var u=dt([e,o]),o=n(e,o);i(M,x,m,b,_,w,M=o[0],x=o[1],m=e,b=u[0],_=u[1],w=u[2],a,t),t.point(M,x)}function o(){S.point=e,t.lineEnd()}function l(){r(),S.point=c,S.lineEnd=f}function c(n,t){u(s=n,t),p=M,g=x,v=b,d=_,y=w,S.point=u}function f(){i(M,x,m,b,_,w,p,g,s,v,d,y,a,t),S.lineEnd=o,o()}var s,p,g,v,d,y,m,M,x,b,_,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=l},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function i(t,e,r,a,l,c,f,s,h,p,g,v,d,y){var b,_,w,S,N,A,C,z,L,q,m=f-t,M=s-e,x=m*m+M*M;4*u<x&&d--&&(b=a+p,_=l+g,w=c+v,S=Math.sqrt(b*b+_*_+w*w),L=Math.asin(w/=S),N=xo(xo(w)-1)<Uo||xo(r-h)<Uo?(r+h)/2:Math.atan2(_,b),A=(q=n(N,L))[0],C=q[1],(u<(q=M*(z=A-t)-m*(L=C-e))*q/x||.3<xo((m*z+M*L)/x-.5)||a*p+l*g+c*v<o)&&(i(t,e,r,a,l,c,A,C,N,b/=S,_/=S,w,d,y),y.point(A,C),i(A,C,N,b,_,w,f,s,h,p,g,v,d,y)))}var u=.5,o=Math.cos(30*Yo),a=16;return t.precision=function(n){return arguments.length?(a=0<(u=n*n)&&16,t):Math.sqrt(u)},t}function ie(n){this.stream=n}function ue(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function oe(n){return ae(function(){return n})()}function ae(n){function t(n){return[(n=a(n[0]*Yo,n[1]*Yo))[0]*h+l,c-n[1]*h]}function e(n){return(n=a.invert((n[0]-l)/h,(c-n[1])/h))&&[n[0]*Zo,n[1]*Zo]}function r(){a=Ct(o=se(y,M,x),u);var n=u(v,d);return l=p-n[0]*h,c=g+n[1]*h,i()}function i(){return f&&(f.valid=!1,f=null),t}var u,o,a,l,c,f,s=ee(function(n,t){return[(n=u(n,t))[0]*h+l,c-n[1]*h]}),h=150,p=480,g=250,v=0,d=0,y=0,M=0,x=0,b=Fa,_=m,w=null,S=null;return t.stream=function(n){return f&&(f.valid=!1),(f=le(b(o,s(_(n))))).valid=!0,f},t.clipAngle=function(n){return arguments.length?(b=null==n?(w=n,Fa):It((w=+n)*Yo),i()):w},t.clipExtent=function(n){return arguments.length?(_=(S=n)?Zt(n[0][0],n[0][1],n[1][0],n[1][1]):m,i()):S},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(p=+n[0],g=+n[1],r()):[p,g]},t.center=function(n){return arguments.length?(v=n[0]%360*Yo,d=n[1]%360*Yo,r()):[v*Zo,d*Zo]},t.rotate=function(n){return arguments.length?(y=n[0]%360*Yo,M=n[1]%360*Yo,x=2<n.length?n[2]%360*Yo:0,r()):[y*Zo,M*Zo,x*Zo]},ao.rebind(t,s,"precision"),function(){return u=n.apply(this,arguments),t.invert=u.invert&&e,r()}}function le(n){return ue(n,function(t,e){n.point(t*Yo,e*Yo)})}function ce(n,t){return[n,t]}function fe(n,t){return[Fo<n?n-Ho:n<-Fo?n+Ho:n,t]}function se(n,t,e){return n?t||e?Ct(pe(n),ge(t,e)):pe(n):t||e?ge(t,e):fe}function he(n){return function(t,e){return[Fo<(t+=n)?t-Ho:t<-Fo?t+Ho:t,e]}}function pe(n){var t=he(n);return t.invert=he(-n),t}function ge(n,t){function e(l,f){var c=Math.cos(f),a=Math.cos(l)*c,l=Math.sin(l)*c,c=Math.sin(f),f=c*r+a*i;return[Math.atan2(l*u-f*o,a*r-c*i),tn(f*u+l*o)]}var r=Math.cos(n),i=Math.sin(n),u=Math.cos(t),o=Math.sin(t);return e.invert=function(l,f){var c=Math.cos(f),a=Math.cos(l)*c,l=Math.sin(l)*c,c=Math.sin(f),f=c*u-l*o;return[Math.atan2(l*u+c*o,a*r+f*i),tn(f*r-a*i)]},e}function ve(n,t){var e=Math.cos(n),r=Math.sin(n);return function(i,u,o,a){var l=o*t;null!=i?(i=de(e,i),u=de(e,u),(0<o?i<u:u<i)&&(i+=o*Ho)):(i=n+o*Ho,u=n-.5*l);for(var c,f=i;0<o?u<f:f<u;f-=l)a.point((c=_t([e,-r*Math.cos(f),-r*Math.sin(f)]))[0],c[1])}}function de(r,e){e=dt(e);e[0]-=r,bt(e);r=nn(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Uo)%(2*Math.PI)}function ye(n,t,e){var r=ao.range(n,t-Uo,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function me(n,t,e){var r=ao.range(n,t-Uo,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function Me(n){return n.source}function xe(n){return n.target}function we(n,t){function e(t,e){var u=Math.cos(t),i=Math.cos(e),u=n(u*i);return[u*i*Math.sin(t),u*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),o=t(r),u=Math.sin(o),o=Math.cos(o);return[Math.atan2(n*u,r*o),Math.asin(r&&e*u/r)]},e}function Se(n,t){function e(n,e){0<o?e<-Io+Uo&&(e=-Io+Uo):Io-Uo<e&&(e=Io-Uo);e=o/Math.pow(i(e),u);return[e*Math.sin(u*n),o-e*Math.cos(u*n)]}function i(n){return Math.tan(Fo/4+n/2)}var r=Math.cos(n),u=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(i(t)/i(n)),o=r*Math.pow(i(n),u)/u;return u?(e.invert=function(n,r){var e=o-r,r=K(u)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/u,2*Math.atan(Math.pow(o/r,1/u))-Io]},e):Ne}function ke(n,t){function e(n,e){e=u-e;return[e*Math.sin(i*n),u-e*Math.cos(i*n)]}var r=Math.cos(n),i=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),u=r/i+n;return xo(i)<Uo?ce:(e.invert=function(n,e){e=u-e;return[Math.atan2(n,e)/i,u-K(i)*Math.sqrt(n*n+e*e)]},e)}function Ne(n,t){return[n,Math.log(Math.tan(Fo/4+t/2))]}function Ee(n){var t,e=oe(n),r=e.scale,i=e.translate,u=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=i.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var a,l,o=u.apply(e,arguments);return o===e?(t=null==n)&&(a=Fo*r(),l=i(),u([[l[0]-a,l[1]-a],[l[0]+a,l[1]+a]])):t&&(o=null),o},e.clipExtent(null)}function Ae(n,t){return[Math.log(Math.tan(Fo/4+t/2)),-n]}function Ce(n){return n[0]}function ze(n){return n[1]}function Le(n){for(var t=n.length,e=[0,1],r=2,i=2;i<t;i++){for(;1<r&&Q(n[e[r-2]],n[e[r-1]],n[i])<=0;)--r;e[r++]=i}return e.slice(0,r)}function qe(n,t){return n[0]-t[0]||n[1]-t[1]}function Te(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Re(l,f,c,s){var i=l[0],u=c[0],o=f[0]-i,h=s[0]-u,l=l[1],c=c[1],f=f[1]-l,s=s[1]-c,h=(h*(l-c)-s*(i-u))/(s*o-h*f);return[i+h*o,l+h*f]}function De(e){var t=e[0],e=e[e.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Pe(){rr(this),this.edge=this.site=this.circle=null}function Ue(n){var t=cl.pop()||new Pe;return t.site=n,t}function je(n){Be(n),ol.remove(n),cl.push(n),rr(n)}function He(n){for(var t,e,r,i,u=n.x,o=n.y,a=ol._;a;)if(r=Oe(a,o)-u,Uo<r)a=a.L;else{if(i=u-function(r,t){var e=r.N;if(e)return Oe(e,t);r=r.site;return r.y===t?r.x:1/0}(a,o),!(Uo<i)){-Uo<r?(t=a.P,e=a):-Uo<i?e=(t=a).N:t=e=a;break}if(!a.R){t=a;break}a=a.R}var l=Ue(n);if(ol.insert(t,l),t||e){if(t===e)return Be(t),e=Ue(t.site),ol.insert(l,e),l.edge=e.edge=Ke(t.site,l.site),$e(t),$e(e),0;if(!e)return l.edge=Ke(t.site,l.site),0;Be(t),Be(e);var c=t.site,f=c.x,x=c.y,h=n.x-f,p=n.y-x,g=e.site,v=g.x-f,d=g.y-x,y=2*(h*d-p*v),m=h*h+p*p,M=v*v+d*d,x={x:(d*m-p*M)/y+f,y:(h*M-v*m)/y+x};nr(e.edge,c,g,x),l.edge=Ke(c,n,null,x),e.edge=Ke(n,g,null,x),$e(t),$e(e)}}function Oe(c,h){var s=c.site,r=s.x,i=s.y,u=i-h;if(!u)return r;var f=c.P;if(!f)return-1/0;var a=(s=f.site).x,l=s.y,c=l-h;if(!c)return a;f=a-r,s=1/u-1/c,h=f/c;return s?(-h+Math.sqrt(h*h-2*s*(f*f/(-2*c)-l+c/2+i-u/2)))/s+r:(r+a)/2}function Ye(n){this.site=n,this.edges=[]}function Ze(n){for(var t,r,i,u,o,a,l,e,f,s=n[0][0],h=n[1][0],p=n[0][1],g=n[1][1],v=ul,d=v.length;d--;)if((u=v[d])&&u.prepare())for(l=(a=u.edges).length,o=0;o<l;)r=(f=a[o].end()).x,i=f.y,t=(e=a[++o%l].start()).x,e=e.y,(xo(r-t)>Uo||xo(i-e)>Uo)&&(a.splice(o,0,new tr(function(r,t,e){r=new Ge(r,null);return r.a=t,r.b=e,il.push(r),r}(u.site,f,xo(r-s)<Uo&&Uo<g-i?{x:s,y:xo(t-s)<Uo?e:g}:xo(i-g)<Uo&&Uo<h-r?{x:xo(e-g)<Uo?t:h,y:g}:xo(r-h)<Uo&&Uo<i-p?{x:h,y:xo(t-h)<Uo?e:p}:xo(i-p)<Uo&&Uo<r-s?{x:xo(e-p)<Uo?t:s,y:p}:null),u.site,null)),++l)}function Ve(n,t){return t.angle-n.angle}function Xe(){rr(this),this.x=this.y=this.arc=this.site=this.cy=null}function $e(n){var s=n.P,d=n.N;if(s&&d){var p=s.site,i=n.site,g=d.site;if(p!==g){var o=i.x,a=i.y,l=p.x-o,v=p.y-a,f=g.x-o,d=2*(l*(s=g.y-a)-v*f);if(!(-jo<=d)){var p=l*l+v*v,g=f*f+s*s,v=(s*p-v*g)/d,d=(l*g-f*p)/d,s=d+a,y=fl.pop()||new Xe;y.arc=n,y.site=i,y.x=v+o,y.y=s+Math.sqrt(v*v+d*d),y.cy=s,n.circle=y;for(var m=null,M=ll._;M;)if(y.y<M.y||y.y===M.y&&y.x<=M.x){if(!M.L){m=M.P;break}M=M.L}else{if(!M.R){m=M;break}M=M.R}ll.insert(m,y),m||(al=y)}}}}function Be(n){var t=n.circle;t&&(t.P||(al=t.N),ll.remove(t),fl.push(t),rr(t),n.circle=null)}function We(n){for(var t,e=il,r=Yt(n[0][0],n[0][1],n[1][0],n[1][1]),i=e.length;i--;)(function(n,v){var e=n.b;if(e)return!0;var u=n.a,o=v[0][0],a=v[1][0],l=v[0][1],c=v[1][1],i=n.l,r=n.r,h=i.x,p=i.y,g=r.x,v=r.y,i=(h+g)/2,r=(p+v)/2;if(v===p){if(i<o||a<=i)return;if(g<h){if(u){if(u.y>=c)return}else u={x:i,y:l};e={x:i,y:c}}else{if(u){if(u.y<l)return}else u={x:i,y:c};e={x:i,y:l}}}else if(i=r-(r=(h-g)/(v-p))*i,r<-1||1<r)if(g<h){if(u){if(u.y>=c)return}else u={x:(l-i)/r,y:l};e={x:(c-i)/r,y:c}}else{if(u){if(u.y<l)return}else u={x:(c-i)/r,y:c};e={x:(l-i)/r,y:l}}else if(p<v){if(u){if(u.x>=a)return}else u={x:o,y:r*o+i};e={x:a,y:r*a+i}}else{if(u){if(u.x<o)return}else u={x:a,y:r*a+i};e={x:o,y:r*o+i}}return n.a=u,n.b=e,!0})(t=e[i],n)&&r(t)&&!(xo(t.a.x-t.b.x)<Uo&&xo(t.a.y-t.b.y)<Uo)||(t.a=t.b=null,e.splice(i,1))}function Ge(n,t){this.l=n,this.r=t,this.a=this.b=null}function Ke(n,t,e,r){var i=new Ge(n,t);return il.push(i),e&&nr(i,n,t,e),r&&nr(i,t,n,r),ul[n.i].edges.push(new tr(i,n,t)),ul[t.i].edges.push(new tr(i,t,n)),i}function nr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function tr(n,t,e){var r=n.a,i=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function er(){this._=null}function rr(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function ir(n,i){var e=i,r=i.R,i=e.U;i?i.L===e?i.L=r:i.R=r:n._=r,r.U=i,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function ur(n,i){var e=i,r=i.L,i=e.U;i?i.L===e?i.L=r:i.R=r:n._=r,r.U=i,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function or(n){for(;n.L;)n=n.L;return n}function ar(n,o){var e,r,i,u=n.sort(lr).pop();for(il=[],ul=new Array(n.length),ol=new er,ll=new er;;)if(i=al,u&&(!i||u.y<i.y||u.y===i.y&&u.x<i.x))u.x===e&&u.y===r||(ul[u.i]=new Ye(u),He(u),e=u.x,r=u.y),u=n.pop();else{if(!i)break;!function(n){var t=n.circle,e=t.x,r=t.cy,i={x:e,y:r},u=n.P,o=n.N,a=[n];je(n);for(var l=u;l.circle&&xo(e-l.circle.x)<Uo&&xo(r-l.circle.cy)<Uo;)u=l.P,a.unshift(l),je(l),l=u;a.unshift(l),Be(l);for(var c=o;c.circle&&xo(e-c.circle.x)<Uo&&xo(r-c.circle.cy)<Uo;)o=c.N,a.push(c),je(c),c=o;a.push(c),Be(c);for(var s=a.length,f=1;f<s;++f)c=a[f],l=a[f-1],nr(c.edge,l.site,c.site,i);l=a[0],(c=a[s-1]).edge=Ke(l.site,c.site,null,i),$e(l),$e(c)}(i.arc)}o&&(We(o),Ze(o));o={cells:ul,edges:il};return ol=ll=il=ul=null,o}function lr(n,t){return t.y-n.y||t.x-n.x}function fr(n){return n.x}function sr(n){return n.y}function hr(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vr(n,t){n=ao.rgb(n),t=ao.rgb(t);var e=n.r,r=n.g,i=n.b,u=t.r-e,o=t.g-r,a=t.b-i;return function(n){return"#"+bn(Math.round(e+u*n))+bn(Math.round(r+o*n))+bn(Math.round(i+a*n))}}function dr(n,t){var e,r={},i={};for(e in n)e in t?r[e]=Mr(n[e],t[e]):i[e]=n[e];for(e in t)e in n||(i[e]=t[e]);return function(n){for(e in r)i[e]=r[e](n);return i}}function yr(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function mr(n,t){var e,r,i,u=hl.lastIndex=pl.lastIndex=0,o=-1,a=[],l=[];for(n+="",t+="";(e=hl.exec(n))&&(r=pl.exec(t));)(i=r.index)>u&&(i=t.slice(u,i),a[o]?a[o]+=i:a[++o]=i),(e=e[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:yr(e,r)})),u=pl.lastIndex;return u<t.length&&(i=t.slice(u),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?(t=l[0].x,function(n){return t(n)+""}):function(){return t}:(t=l.length,function(n){for(var e,r=0;r<t;++r)a[(e=l[r]).i]=e.x(n);return a.join("")})}function Mr(n,t){for(var e,r=ao.interpolators.length;0<=--r&&!(e=ao.interpolators[r](n,t)););return e}function xr(n,t){for(var r=[],i=[],u=n.length,o=t.length,a=Math.min(n.length,t.length),e=0;e<a;++e)r.push(Mr(n[e],t[e]));for(;e<u;++e)i[e]=n[e];for(;e<o;++e)i[e]=t[e];return function(n){for(e=0;e<a;++e)i[e]=r[e](n);return i}}function _r(n){return function(t){return 1-n(1-t)}}function wr(n){return function(t){return.5*(t<.5?n(2*t):2-n(2-2*t))}}function Sr(n){return n*n}function kr(n){return n*n*n}function Nr(n){if(n<=0)return 0;if(1<=n)return 1;var t=n*n,e=t*n;return 4*(n<.5?e:3*(n-t)+e-.75)}function Ar(n){return 1-Math.cos(n*Io)}function Cr(n){return Math.pow(2,10*(n-1))}function zr(n){return 1-Math.sqrt(1-n*n)}function Tr(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Ur(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function jr(n){var t=[n.a,n.b],e=[n.c,n.d],r=Hr(t),i=Fr(t,e),u=Hr(function(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}(e,t,-i))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Zo,this.translate=[n.e,n.f],this.scale=[r,u],this.skew=u?Math.atan2(i,u)*Zo:0}function Fr(n,t){return n[0]*t[0]+n[1]*t[1]}function Hr(n){var t=Math.sqrt(Fr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Ir(n){return n.length?n.pop()+",":""}function $r(n,t){var e=[],r=[];return n=ao.transform(n),t=ao.transform(t),function(n,t,e,r){var i;n[0]!==t[0]||n[1]!==t[1]?(i=e.push("translate(",null,",",null,")"),r.push({i:i-4,x:yr(n[0],t[0])},{i:i-2,x:yr(n[1],t[1])})):(t[0]||t[1])&&e.push("translate("+t+")")}(n.translate,t.translate,e,r),function(n,t,e,r){n!==t?(180<n-t?t+=360:180<t-n&&(n+=360),r.push({i:e.push(Ir(e)+"rotate(",null,")")-2,x:yr(n,t)})):t&&e.push(Ir(e)+"rotate("+t+")")}(n.rotate,t.rotate,e,r),function(n,t,e,r){n!==t?r.push({i:e.push(Ir(e)+"skewX(",null,")")-2,x:yr(n,t)}):t&&e.push(Ir(e)+"skewX("+t+")")}(n.skew,t.skew,e,r),function(n,t,e,r){var i;n[0]!==t[0]||n[1]!==t[1]?(i=e.push(Ir(e)+"scale(",null,",",null,")"),r.push({i:i-4,x:yr(n[0],t[0])},{i:i-2,x:yr(n[1],t[1])})):1===t[0]&&1===t[1]||e.push(Ir(e)+"scale("+t+")")}(n.scale,t.scale,e,r),function(n){for(var t,i=-1,u=r.length;++i<u;)e[(t=r[i]).i]=t.x(n);return e.join("")}}function Br(n,t){return t=(t-=n=+n)||1/t,function(e){return(e-n)/t}}function Wr(n,t){return t=(t-=n=+n)||1/t,function(e){return Math.max(0,Math.min(1,(e-n)/t))}}function Jr(n){for(var t=n.source,e=n.target,r=function(n,t){if(n===t)return n;for(var e=Gr(n),r=Gr(t),i=e.pop(),u=r.pop(),o=null;i===u;)o=i,i=e.pop(),u=r.pop();return o}(t,e),i=[t];t!==r;)t=t.parent,i.push(t);for(var u=i.length;e!==r;)i.splice(u,0,e),e=e.parent;return i}function Gr(n){for(var t=[],e=n.parent;null!=e;)t.push(n),e=(n=e).parent;return t.push(n),t}function Qr(n){n.fixed|=2}function ni(n){n.fixed&=-7}function ti(n){n.fixed|=4,n.px=n.x,n.py=n.y}function ei(n){n.fixed&=-5}function ii(n,t){return ao.rebind(n,t,"sort","children","value"),(n.nodes=n).links=fi,n}function ui(n,t){for(var r,i,e=[n];null!=(n=e.pop());)if(t(n),(i=n.children)&&(r=i.length))for(;0<=--r;)e.push(i[r])}function oi(n,t){for(var e=[n],r=[];null!=(n=e.pop());)if(r.push(n),(u=n.children)&&(i=u.length))for(var i,u,o=-1;++o<i;)e.push(u[o]);for(;null!=(n=r.pop());)t(n)}function ai(n){return n.children}function li(n){return n.value}function ci(n,t){return t.value-n.value}function fi(n){return ao.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function si(n){return n.x}function hi(n){return n.y}function pi(n,t,e){n.y0=t,n.y=e}function gi(n){return ao.range(n.length)}function vi(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function di(n){for(var t,e=1,r=0,i=n[0][1],u=n.length;e<u;++e)(t=n[e][1])>i&&(r=e,i=t);return r}function yi(n){return n.reduce(mi,0)}function mi(n,t){return n+t[1]}function Mi(n,t){return xi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function xi(n,t){for(var e=-1,r=+n[0],i=(n[1]-r)/t,u=[];++e<=t;)u[e]=i*e+r;return u}function bi(n){return[ao.min(n),ao.max(n)]}function _i(n,t){return n.value-t.value}function wi(n,t){var e=n._pack_next;(n._pack_next=t)._pack_prev=n,(t._pack_next=e)._pack_prev=t}function Si(n,t){(n._pack_next=t)._pack_prev=n}function ki(n,i){var e=i.x-n.x,r=i.y-n.y,i=n.r+i.r;return e*e+r*r<.999*i*i}function Ni(n){function t(n){f=Math.min(n.x-n.r,f),s=Math.max(n.x+n.r,s),h=Math.min(n.y-n.r,h),p=Math.max(n.y+n.r,p)}if((e=n.children)&&(c=e.length)){var e,r,i,u,l,c,f=1/0,s=-1/0,h=1/0,p=-1/0;if(e.forEach(Ei),(r=e[0]).x=-r.r,r.y=0,t(r),1<c&&((i=e[1]).x=i.r,i.y=0,t(i),2<c))for(zi(r,i,u=e[2]),t(u),wi(r,u),wi(r._pack_prev=u,i),i=r._pack_next,o=3;o<c;o++){zi(r,i,u=e[o]);for(var g=0,v=1,d=1,a=i._pack_next;a!==i;a=a._pack_next,v++)if(ki(a,u)){g=1;break}if(1==g)for(l=r._pack_prev;l!==a._pack_prev&&!ki(l,u);l=l._pack_prev,d++);g?(v<d||v==d&&i.r<r.r?Si(r,i=a):Si(r=l,i),o--):(wi(r,u),t(i=u))}for(var y=(f+s)/2,m=(h+p)/2,M=0,o=0;o<c;o++)(u=e[o]).x-=y,u.y-=m,M=Math.max(M,u.r+Math.sqrt(u.x*u.x+u.y*u.y));n.r=M,e.forEach(Ai)}}function Ei(n){n._pack_next=n._pack_prev=n}function Ai(n){delete n._pack_next,delete n._pack_prev}function zi(n,l,e){var o,c,r=n.r+e.r,i=l.x-n.x,u=l.y-n.y;r&&(i||u)?(o=l.r+e.r,l=.5+((r*=r)-(o*=o))/(2*(c=i*i+u*u)),c=Math.sqrt(Math.max(0,2*o*(r+c)-(r-=c)*r-o*o))/(2*c),e.x=n.x+l*i+c*u,e.y=n.y+l*u-c*i):(e.x=n.x+r,e.y=n.y)}function Li(n,t){return n.parent==t.parent?1:2}function qi(n){var t=n.children;return t.length?t[0]:n.t}function Ti(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t}function Oi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Ii(n,u){var e=n.x+u[3],r=n.y+u[0],i=n.dx-u[1]-u[3],u=n.dy-u[0]-u[2];return i<0&&(e+=i/2,i=0),u<0&&(r+=u/2,u=0),{x:e,y:r,dx:i,dy:u}}function Yi(e){var t=e[0],e=e[e.length-1];return t<e?[t,e]:[e,t]}function Zi(n){return n.rangeExtent?n.rangeExtent():Yi(n.range())}function Vi(n,t,e,r){var i=e(n[0],n[1]),u=r(t[0],t[1]);return function(n){return u(i(n))}}function Xi(n,t){var e,r=0,i=n.length-1,u=n[r],o=n[i];return o<u&&(e=r,r=i,i=e,e=u,u=o,o=e),n[r]=t.floor(u),n[i]=t.ceil(o),n}function $i(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:Sl}function Bi(n,t,e,r){var i=[],u=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)i.push(e(n[o-1],n[o])),u.push(r(t[o-1],t[o]));return function(t){var e=ao.bisect(n,t,1,a)-1;return u[e](i[e](t))}}function Ji(n,t){return ao.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Gi(n,t){return Xi(n,$i(Ki(n,t)[2])),Xi(n,$i(Ki(n,t)[2])),n}function Ki(i,t){null==t&&(t=10);var e=Yi(i),u=e[1]-e[0],i=Math.pow(10,Math.floor(Math.log(u/t)/Math.LN10)),u=t/u*i;return u<=.15?i*=10:u<=.35?i*=5:u<=.75&&(i*=2),e[0]=Math.ceil(e[0]/i)*i,e[1]=Math.floor(e[1]/i)*i+.5*i,e[2]=i,e}function Qi(n,t){return ao.range.apply(ao,Ki(n,t))}function nu(r,i,e){r=Ki(r,i);if(e){i=ha.exec(e);if(i.shift(),"s"===i[8]){var u=ao.formatPrefix(Math.max(xo(r[0]),xo(r[1])));return i[7]||(i[7]="."+tu(u.scale(r[2]))),i[8]="f",e=ao.format(i.join("")),function(n){return e(u.scale(n))+u.symbol}}i[7]||(i[7]="."+function(n,t){var e=tu(t[2]);return n in kl?Math.abs(e-tu(Math.max(xo(t[0]),xo(t[1]))))+ +("e"!==n):e-2*("%"===n)}(i[8],r)),e=i.join("")}else e=",."+tu(r[2])+"f";return ao.format(e)}function tu(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function uu(n){return function(t){return t<0?-Math.pow(-t,n):Math.pow(t,n)}}function su(){return 0}function hu(n){return n.innerRadius}function pu(n){return n.outerRadius}function gu(n){return n.startAngle}function vu(n){return n.endAngle}function du(n){return n&&n.padAngle}function yu(n,t,e,r){return 0<(n-e)*t-(t-r)*n?0:1}function mu(E,M,e,x,A){var k=E[0]-M[0],C=E[1]-M[1],d=(A?x:-x)/Math.sqrt(k*k+C*C),l=d*C,c=-d*k,N=E[0]+l,S=E[1]+c,w=M[0]+l,_=M[1]+c,A=(N+w)/2,C=(S+_)/2,d=w-N,k=_-S,E=d*d+k*k,M=e-x,x=N*_-w*S,N=(k<0?-1:1)*Math.sqrt(Math.max(0,M*M*E-x*x)),_=(x*k-d*N)/E,w=(-x*d-k*N)/E,S=(x*k+d*N)/E,k=(-x*d+k*N)/E,N=_-A,E=w-C,A=S-A,C=k-C;return A*A+C*C<N*N+E*E&&(_=S,w=k),[[_-l,w-c],[_*e/M,w*e/M]]}function Mu(n){function t(t){function o(){c.push("M",u(n(f),a))}for(var l,c=[],f=[],s=-1,h=t.length,p=En(e),g=En(r);++s<h;)i.call(this,l=t[s],s)?f.push([+p.call(this,l,s),+g.call(this,l,s)]):f.length&&(o(),f=[]);return f.length&&o(),c.length?c.join(""):null}var e=Ce,r=ze,i=zt,u=xu,o=u.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(i=n,t):i},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?u=n:(u=Tl.get(n)||xu).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function xu(n){return 1<n.length?n.join("L"):n+"Z"}function bu(n){return n.join("L")+"Z"}function wu(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("V",(r=n[t])[1],"H",r[0]);return i.join("")}function Su(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r=n[t])[0],"V",r[1]);return i.join("")}function Au(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return xu(n);var f=n.length!=t.length,r="",i=n[0],u=n[1],o=t[0],a=o,l=1;if(f&&(r+="Q"+(u[0]-2*o[0]/3)+","+(u[1]-2*o[1]/3)+","+u[0]+","+u[1],i=n[1],l=2),1<t.length){a=t[1],u=n[l],l++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(u[0]-a[0])+","+(u[1]-a[1])+","+u[0]+","+u[1];for(var c=2;c<t.length;c++,l++)u=n[l],a=t[c],r+="S"+(u[0]-a[0])+","+(u[1]-a[1])+","+u[0]+","+u[1]}return f&&(f=n[l],r+="Q"+(u[0]+2*a[0]/3)+","+(u[1]+2*a[1]/3)+","+f[0]+","+f[1]),r}function Cu(n,t){for(var e,r=[],i=(1-t)/2,u=n[0],o=n[1],a=1,l=n.length;++a<l;)e=u,u=o,o=n[a],r.push([i*(o[0]-e[0]),i*(o[1]-e[1])]);return r}function zu(n){if(n.length<3)return xu(n);var t=1,e=n.length,r=n[0],i=r[0],u=r[1],o=[i,i,i,(r=n[1])[0]],a=[u,u,u,r[1]],l=[i,",",u,"L",Ru(Pl,o),",",Ru(Pl,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),Du(l,o,a);return n.pop(),l.push("L",r),l.join("")}function Ru(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Du(n,t,e){n.push("C",Ru(Rl,t),",",Ru(Rl,e),",",Ru(Dl,t),",",Ru(Dl,e),",",Ru(Pl,t),",",Ru(Pl,e))}function Pu(n,t){return(t[1]-n[1])/(t[0]-n[0])}function ju(n){for(var t,e,r,i,u=[],o=function(n){for(var t=0,e=n.length-1,r=[],i=n[0],u=n[1],o=r[0]=Pu(i,u);++t<e;)r[t]=(o+(o=Pu(u,u=n[t+1])))/2;return r[t]=o,r}(n),a=-1,l=n.length-1;++a<l;)t=Pu(n[a],n[a+1]),xo(t)<Uo?o[a]=o[a+1]=0:9<(i=(e=o[a]/t)*e+(r=o[a+1]/t)*r)&&(i=3*t/Math.sqrt(i),o[a]=i*e,o[a+1]=i*r);for(a=-1;++a<=l;)i=(n[Math.min(l,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),u.push([i||0,o[a]*i||0]);return u}function Hu(n){for(var t,e,r,i=-1,u=n.length;++i<u;)e=(t=n[i])[0],r=t[1]-Io,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Ou(n){function t(t){function l(){v.push("M",a(n(y),s),f,c(n(d.reverse()),s),"Z")}for(var h,p,g,v=[],d=[],y=[],m=-1,M=t.length,x=En(e),b=En(i),_=e===r?function(){return p}:En(r),w=i===u?function(){return g}:En(u);++m<M;)o.call(this,h=t[m],m)?(d.push([p=+x.call(this,h,m),g=+b.call(this,h,m)]),y.push([+_.call(this,h,m),+w.call(this,h,m)])):d.length&&(l(),d=[],y=[]);return d.length&&l(),v.length?v.join(""):null}var e=Ce,r=Ce,i=0,u=ze,o=zt,a=xu,l=a.key,c=a,f="L",s=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(i=u=n,t):u},t.y0=function(n){return arguments.length?(i=n,t):i},t.y1=function(n){return arguments.length?(u=n,t):u},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(l="function"==typeof n?a=n:(a=Tl.get(n)||xu).key,c=a.reverse||a,f=a.closed?"M":"L",t):l},t.tension=function(n){return arguments.length?(s=n,t):s},t}function Iu(n){return n.radius}function Yu(n){return[n.x,n.y]}function Vu(){return 64}function Xu(){return"circle"}function $u(t){t=Math.sqrt(t/Fo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Bu(n){return function(){var t,e,r;(t=this[n])&&(r=t[e=t.active])&&(r.timer.c=null,r.timer.t=NaN,--t.count?delete t[e]:delete this[n],t.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function Wu(n,t,e){return ko(n,Yl),n.namespace=t,n.id=e,n}function Ju(n,t,e,r){var i=n.id,u=n.namespace;return Y(n,"function"==typeof e?function(n,o,a){n[u][i].tween.set(t,r(e.call(n,n.__data__,o,a)))}:(e=r(e),function(n){n[u][i].tween.set(t,e)}))}function Gu(n){return null==n&&(n=""),function(){this.textContent=n}}function Ku(n){return null==n?"__transition__":"__transition_"+n+"__"}function Qu(n,t,e,r,i){function o(e){var o,c,i=g.active,u=g[i];for(o in u&&(u.timer.c=null,u.timer.t=NaN,--g.count,delete g[i],u.event&&u.event.interrupt.call(n,n.__data__,u.index)),g)+o<r&&((c=g[o]).timer.c=null,c.timer.t=NaN,--g.count,delete g[o]);f.c=a,qn(function(){return f.c&&a(e||1)&&(f.c=null,f.t=NaN),1},0,l),g.active=r,v.event&&v.event.start.call(n,n.__data__,t),p=[],v.tween.forEach(function(e,r){(r=r.call(n,n.__data__,t))&&p.push(r)}),h=v.ease,s=v.duration}function a(u){for(var u=u/s,o=h(u),a=p.length;0<a;)p[--a].call(n,o);return 1<=u?(v.event&&v.event.end.call(n,n.__data__,t),--g.count?delete g[r]:delete n[e],1):void 0}var l,f,s,h,p,g=n[e]||(n[e]={active:0,count:0}),v=g[r];v||(l=i.time,f=qn(function(n){var t=v.delay;return f.t=t+l,t<=n?o(n-t):void(f.c=o)},0,l),v=g[r]={tween:new c,time:l,timer:f,delay:i.delay,duration:i.duration,ease:i.ease,index:t},i=null,++g.count)}function no(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"})}function to(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"})}function eo(n){return n.toISOString()}function ro(n,t,e){function r(t){return n(t)}function i(n,e){var i=(n[1]-n[0])/e,u=ao.bisect(Kl,i);return u==Kl.length?[t.year,Ki(n.map(function(n){return n/31536e6}),e)[2]]:u?t[i/Kl[u-1]<Kl[u]/i?u-1:u]:[tc,Ki(n,e)[2]]}return r.invert=function(t){return io(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(io)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,io(+e+1),t).length}var u=r.domain(),a=Yi(u),a=null==n?i(a,10):"number"==typeof n&&i(a,n);return a&&(n=a[0],t=a[1]),r.domain(Xi(u,1<t?{floor:function(t){for(;e(t=n.floor(t));)t=io(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=io(+t+1);return t}}:n))},r.ticks=function(n,t){var e=Yi(r.domain()),u=null==n?i(e,10):"number"==typeof n?i(e,n):!n.range&&[{range:n},t];return u&&(n=u[0],t=u[1]),n.range(e[0],io(+e[1]+1),t<1?1:t)},r.tickFormat=function(){return e},r.copy=function(){return ro(n.copy(),t,e)},Ji(r,n)}function io(n){return new Date(n)}function uo(n){return JSON.parse(n.responseText)}function oo(n){var t=fo.createRange();return t.selectNode(fo.body),t.createContextualFragment(n.responseText)}var ao={version:"3.5.17"},lo=[].slice,co=function(n){return lo.call(n)},fo=this.document;if(fo)try{co(fo.documentElement.childNodes)[0].nodeType}catch(so){co=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}if(Date.now||(Date.now=function(){return+new Date}),fo)try{fo.createElement("DIV").style.setProperty("opacity",0,"")}catch(ho){var Jl=this.Element.prototype,go=Jl.setAttribute,vo=Jl.setAttributeNS,Gl=this.CSSStyleDeclaration.prototype,mo=Gl.setProperty;Jl.setAttribute=function(n,t){go.call(this,n,t+"")},Jl.setAttributeNS=function(n,t,e){vo.call(this,n,t,e+"")},Gl.setProperty=function(n,t,e){mo.call(this,n,t+"",e)}}ao.ascending=e,ao.descending=function(n,t){return t<n?-1:n<t?1:n<=t?0:NaN},ao.min=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u;)if(null!=(r=n[i])&&r<=r){e=r;break}for(;++i<u;)null!=(r=n[i])&&r<e&&(e=r)}else{for(;++i<u;)if(null!=(r=t.call(n,n[i],i))&&r<=r){e=r;break}for(;++i<u;)null!=(r=t.call(n,n[i],i))&&r<e&&(e=r)}return e},ao.max=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u;)if(null!=(r=n[i])&&r<=r){e=r;break}for(;++i<u;)null!=(r=n[i])&&e<r&&(e=r)}else{for(;++i<u;)if(null!=(r=t.call(n,n[i],i))&&r<=r){e=r;break}for(;++i<u;)null!=(r=t.call(n,n[i],i))&&e<r&&(e=r)}return e},ao.extent=function(n,t){var e,r,i,u=-1,o=n.length;if(1===arguments.length){for(;++u<o;)if(null!=(r=n[u])&&r<=r){e=i=r;break}for(;++u<o;)null!=(r=n[u])&&(r<e&&(e=r),i<r&&(i=r))}else{for(;++u<o;)if(null!=(r=t.call(n,n[u],u))&&r<=r){e=i=r;break}for(;++u<o;)null!=(r=t.call(n,n[u],u))&&(r<e&&(e=r),i<r&&(i=r))}return[e,i]},ao.sum=function(n,t){var e,r=0,u=n.length,o=-1;if(1===arguments.length)for(;++o<u;)i(e=+n[o])&&(r+=e);else for(;++o<u;)i(e=+t.call(n,n[o],o))&&(r+=e);return r},ao.mean=function(n,t){var e,u=0,o=n.length,a=-1,l=o;if(1===arguments.length)for(;++a<o;)i(e=r(n[a]))?u+=e:--l;else for(;++a<o;)i(e=r(t.call(n,n[a],a)))?u+=e:--l;return l?u/l:void 0},ao.quantile=function(n,i){var u=(n.length-1)*i+1,r=Math.floor(u),i=+n[r-1],u=u-r;return u?i+u*(n[r]-i):i},ao.median=function(n,t){var u,o=[],a=n.length,l=-1;if(1===arguments.length)for(;++l<a;)i(u=r(n[l]))&&o.push(u);else for(;++l<a;)i(u=r(t.call(n,n[l],l)))&&o.push(u);return o.length?ao.quantile(o.sort(e),.5):void 0},ao.variance=function(n,t){var e,u,o=n.length,a=0,l=0,c=-1,f=0;if(1===arguments.length)for(;++c<o;)i(e=r(n[c]))&&(l+=(u=e-a)*(e-(a+=u/++f)));else for(;++c<o;)i(e=r(t.call(n,n[c],c)))&&(l+=(u=e-a)*(e-(a+=u/++f)));return 1<f?l/(f-1):void 0},ao.deviation=function(){var n=ao.variance.apply(this,arguments);return n&&Math.sqrt(n)};var Wl=u(e);ao.bisectLeft=Wl.left,ao.bisect=ao.bisectRight=Wl.right,ao.bisector=function(n){return u(1===n.length?function(t,r){return e(n(t),r)}:n)},ao.shuffle=function(n,t,e){(u=arguments.length)<3&&(e=n.length,u<2&&(t=0));for(var r,i,u=e-t;u;)i=Math.random()*u--|0,r=n[u+t],n[u+t]=n[i+t],n[i+t]=r;return n},ao.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},ao.pairs=function(n){for(var e=0,r=n.length-1,i=n[0],u=new Array(r<0?0:r);e<r;)u[e]=[i,i=n[++e]];return u},ao.transpose=function(n){if(!(i=n.length))return[];for(var t=-1,e=ao.min(n,o),r=new Array(e);++t<e;)for(var i,u=-1,a=r[t]=new Array(i);++u<i;)a[u]=n[u][t];return r},ao.zip=function(){return ao.transpose(arguments)},ao.keys=function(n){var e,t=[];for(e in n)t.push(e);return t},ao.values=function(n){var e,t=[];for(e in n)t.push(n[e]);return t},ao.entries=function(n){var e,t=[];for(e in n)t.push({key:e,value:n[e]});return t},ao.merge=function(n){for(var t,e,r,i=n.length,u=-1,o=0;++u<i;)o+=n[u].length;for(e=new Array(o);0<=--i;)for(t=(r=n[i]).length;0<=--t;)e[--o]=r[t];return e};var xo=Math.abs;ao.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),(t-n)/e==1/0)throw new Error("infinite range");var r,i=[],u=function(n){for(var t=1;n*t%1;)t*=10;return t}(xo(e)),o=-1;if(n*=u,t*=u,(e*=u)<0)for(;(r=n+e*++o)>t;)i.push(r/u);else for(;(r=n+e*++o)<t;)i.push(r/u);return i},ao.map=function(n,t){var e=new c;if(n instanceof c)n.forEach(function(n,t){e.set(n,t)});else if(Array.isArray(n)){var r,i=-1,u=n.length;if(1===arguments.length)for(;++i<u;)e.set(i,n[i]);else for(;++i<u;)e.set(t.call(n,r=n[i],i),r)}else for(var o in n)e.set(o,n[o]);return e};var bo="__proto__",_o="\0";l(c,{has:h,get:function(n){return this._[f(n)]},set:function(n,t){return this._[f(n)]=t},remove:p,keys:g,values:function(){var t,n=[];for(t in this._)n.push(this._[t]);return n},entries:function(){var t,n=[];for(t in this._)n.push({key:s(t),value:this._[t]});return n},size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,s(t),this._[t])}}),ao.nest=function(){function n(t,o,a){if(a>=u.length)return r?r.call(i,o):e?o.sort(e):o;for(var l,f,s,h,p=-1,g=o.length,v=u[a++],d=new c;++p<g;)(h=d.get(l=v(f=o[p])))?h.push(f):d.set(l,[f]);return s=t?(f=t(),function(e,r){f.set(e,n(t,r,a))}):(f={},function(e,r){f[e]=n(t,r,a)}),d.forEach(s),f}var e,r,i={},u=[],o=[];return i.map=function(t,e){return n(e,t,0)},i.entries=function(e){return function t(n,e){if(e>=u.length)return n;var r=[],i=o[e++];return n.forEach(function(n,i){r.push({key:n,values:t(i,e)})}),i?r.sort(function(n,t){return i(n.key,t.key)}):r}(n(ao.map,e,0),0)},i.key=function(n){return u.push(n),i},i.sortKeys=function(n){return o[u.length-1]=n,i},i.sortValues=function(n){return e=n,i},i.rollup=function(n){return r=n,i},i},ao.set=function(n){var t=new y;if(n)for(var e=0,r=n.length;e<r;++e)t.add(n[e]);return t},l(y,{has:h,add:function(n){return this._[f(n+="")]=!0,n},remove:p,values:g,size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,s(t))}}),ao.behavior={},ao.rebind=function(n,t){for(var e,r=1,i=arguments.length;++r<i;)n[e=arguments[r]]=function(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}(n,t,t[e]);return n};var wo=["webkit","ms","moz","Moz","o","O"];ao.dispatch=function(){for(var n=new _,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=w(n);return n},_.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(0<=e&&(r=n.slice(e+1),n=n.slice(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},ao.event=null,ao.requote=function(n){return n.replace(So,"\\$&")};var So=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ko={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},No=function(n,t){return t.querySelector(n)},Eo=function(n,t){return t.querySelectorAll(n)},Ao=function(n,t){var e=n.matches||n[x(n,"matchesSelector")];return(Ao=function(n,t){return e.call(n,t)})(n,t)};"function"==typeof Sizzle&&(No=function(n,t){return Sizzle(n,t)[0]||null},Ao=(Eo=Sizzle).matchesSelector),ao.selection=function(){return ao.select(fo.documentElement)};var Co=ao.selection.prototype=[];Co.select=function(n){var t,e,r,i,u=[];n=A(n);for(var o=-1,a=this.length;++o<a;){u.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var l=-1,c=r.length;++l<c;)(i=r[l])?(t.push(e=n.call(i,i.__data__,l,o)),e&&"__data__"in i&&(e.__data__=i.__data__)):t.push(null)}return E(u)},Co.selectAll=function(n){var t,e,r=[];n=C(n);for(var i=-1,u=this.length;++i<u;)for(var o=this[i],a=-1,l=o.length;++a<l;)(e=o[a])&&(r.push(t=co(n.call(e,e.__data__,a,i))),t.parentNode=e);return E(r)};var zo="http://www.w3.org/1999/xhtml",Lo={svg:"http://www.w3.org/2000/svg",xhtml:zo,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ao.ns={prefix:Lo,qualify:function(n){var t=n.indexOf(":"),e=n;return 0<=t&&"xmlns"!==(e=n.slice(0,t))&&(n=n.slice(t+1)),Lo.hasOwnProperty(e)?{space:Lo[e],local:n}:n}},Co.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return(n=ao.ns.qualify(n)).local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(z(t,n[t]));return this}return this.each(z(n,t))},Co.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=T(n)).length,i=-1;if(t=e.classList){for(;++i<r;)if(!t.contains(n[i]))return!1}else for(t=e.getAttribute("class");++i<r;)if(!q(n[i]).test(t))return!1;return!0}for(t in n)this.each(R(t,n[t]));return this}return this.each(R(n,t))},Co.style=function(n,e,r){var u=arguments.length;if(u<3){if("string"!=typeof n){for(r in u<2&&(e=""),n)this.each(P(r,n[r],e));return this}if(u<2){u=this.node();return t(u).getComputedStyle(u,null).getPropertyValue(n)}r=""}return this.each(P(n,e,r))},Co.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(U(t,n[t]));return this}return this.each(U(n,t))},Co.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},Co.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},Co.append=function(n){return n=j(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},Co.insert=function(n,t){return n=j(n),t=A(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},Co.remove=function(){return this.each(F)},Co.data=function(n,t){function e(n,e){var i,u,o=n.length,s=e.length,h=Math.min(o,s),p=new Array(s),g=new Array(s),v=new Array(o);if(t){for(var d,y=new c,m=new Array(o),r=-1;++r<o;)(i=n[r])&&(y.has(d=t.call(i,i.__data__,r))?v[r]=i:y.set(d,i),m[r]=d);for(r=-1;++r<s;)(i=y.get(d=t.call(e,u=e[r],r)))?!0!==i&&((p[r]=i).__data__=u):g[r]=H(u),y.set(d,!0);for(r=-1;++r<o;)r in m&&!0!==y.get(m[r])&&(v[r]=n[r])}else{for(r=-1;++r<h;)i=n[r],u=e[r],i?(i.__data__=u,p[r]=i):g[r]=H(u);for(;r<s;++r)g[r]=H(e[r]);for(;r<o;++r)v[r]=n[r]}g.update=p,g.parentNode=p.parentNode=v.parentNode=n.parentNode,a.push(g),l.push(p),f.push(v)}var r,i,u=-1,o=this.length;if(!arguments.length){for(n=new Array(o=(r=this[0]).length);++u<o;)(i=r[u])&&(n[u]=i.__data__);return n}var a=Z([]),l=E([]),f=E([]);if("function"==typeof n)for(;++u<o;)e(r=this[u],n.call(r,r.parentNode.__data__,u));else for(;++u<o;)e(r=this[u],n);return l.enter=function(){return a},l.exit=function(){return f},l},Co.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},Co.filter=function(n){var t,e,r,i=[];"function"!=typeof n&&(n=O(n));for(var u=0,o=this.length;u<o;u++){i.push(t=[]),t.parentNode=(e=this[u]).parentNode;for(var a=0,l=e.length;a<l;a++)(r=e[a])&&n.call(r,r.__data__,a,u)&&t.push(r)}return E(i)},Co.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],i=r.length-1,u=r[i];0<=--i;)(e=r[i])&&(u&&u!==e.nextSibling&&u.parentNode.insertBefore(e,u),u=e);return this},Co.sort=function(n){n=I.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},Co.each=function(n){return Y(this,function(t,e,r){n.call(t,t.__data__,e,r)})},Co.call=function(n){var t=co(arguments);return n.apply(t[0]=this,t),this},Co.empty=function(){return!this.node()},Co.node=function(){for(var n=0,t=this.length;n<t;n++)for(var e=this[n],r=0,i=e.length;r<i;r++){var u=e[r];if(u)return u}return null},Co.size=function(){var n=0;return Y(this,function(){++n}),n};var qo=[];ao.selection.enter=Z,(ao.selection.enter.prototype=qo).append=Co.append,qo.empty=Co.empty,qo.node=Co.node,qo.call=Co.call,qo.size=Co.size,qo.select=function(n){for(var t,e,r,i,u,o=[],a=-1,l=this.length;++a<l;){r=(i=this[a]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var c=-1,f=i.length;++c<f;)(u=i[c])?(t.push(r[c]=e=n.call(i.parentNode,u.__data__,c,a)),e.__data__=u.__data__):t.push(null)}return E(o)},qo.insert=function(n,t){return arguments.length<2&&(t=function(n){var t,e;return function(r,i,u){var o,a=n[u].update,l=a.length;for(u!=e&&(e=u,t=0),t<=i&&(t=i+1);!(o=a[t])&&++t<l;);return o}}(this)),Co.insert.call(this,n,t)},ao.select=function(t){var e;return"string"==typeof t?(e=[No(t,fo)]).parentNode=fo.documentElement:(e=[t]).parentNode=n(t),E([e])},ao.selectAll=function(n){var t;return"string"==typeof n?(t=co(Eo(n,fo))).parentNode=fo.documentElement:(t=co(n)).parentNode=null,E([t])},Co.on=function(n,t,e){var r=arguments.length;if(r<3){if("string"!=typeof n){for(e in r<2&&(t=!1),n)this.each(X(e,n[e],t));return this}if(r<2)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(X(n,t,e))};var To=ao.map({mouseenter:"mouseover",mouseleave:"mouseout"});fo&&To.forEach(function(n){"on"+n in fo&&To.remove(n)});var Ro,Do=0;ao.mouse=function(n){return J(n,k())};var Po=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ao.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=k().changedTouches),t)for(var r,i=0,u=t.length;i<u;++i)if((r=t[i]).identifier===e)return J(n,r)},ao.behavior.drag=function(){function n(){this.on("mousedown.drag",u).on("touchstart.drag",o)}function e(n,t,e,u,o){return function(){var f=this,s=ao.event.target.correspondingElement||ao.event.target,h=f.parentNode,p=r.of(f,arguments),g=0,v=n(),d=".drag"+(null==v?"":"-"+v),y=ao.select(e(s)).on(u+d,function(){var n,e,r=t(h,v);r&&(n=r[0]-M[0],e=r[1]-M[1],g|=n|e,p({type:"drag",x:(M=r)[0]+c[0],y:r[1]+c[1],dx:n,dy:e}))}).on(o+d,function(){t(h,v)&&(y.on(u+d,null).on(o+d,null),m(g),p({type:"dragend"}))}),m=W(s),M=t(h,v),c=i?[(c=i.apply(f,arguments)).x-M[0],c.y-M[1]]:[0,0];p({type:"dragstart"})}}var r=N(n,"drag","dragstart","dragend"),i=null,u=e(b,ao.mouse,t,"mousemove","mouseup"),o=e(G,ao.touch,m,"touchmove","touchend");return n.origin=function(t){return arguments.length?(i=t,n):i},ao.rebind(n,r,"on")},ao.touches=function(n,t){return(t=arguments.length<2?k().touches:t)?co(t).map(function(t){var e=J(n,t);return e.identifier=t.identifier,e}):[]};var Uo=1e-6,jo=Uo*Uo,Fo=Math.PI,Ho=2*Fo,Oo=Ho-Uo,Io=Fo/2,Yo=Fo/180,Zo=180/Fo,Vo=Math.SQRT2;ao.interpolateZoom=function(g,c){var p,d,r,e,i=g[0],u=g[1],o=g[2],h=c[0],g=c[1],c=c[2],f=h-i,s=g-u,h=f*f+s*s;return(e=h<jo?(r=Math.log(c/o)/Vo,function(n){return[i+n*f,u+n*s,o*Math.exp(Vo*n*r)]}):(p=Math.sqrt(h),g=(c*c-o*o+4*h)/(2*o*2*p),e=(c*c-o*o-4*h)/(2*c*2*p),d=Math.log(Math.sqrt(g*g+1)-g),r=(Math.log(Math.sqrt(e*e+1)-e)-d)/Vo,function(a){var t=a*r,e=rn(d),a=o/(2*p)*(e*function(n){return((n=Math.exp(2*n))-1)/(n+1)}(Vo*t+d)-function(n){return((n=Math.exp(n))-1/n)/2}(d));return[i+a*f,u+a*s,o*e/rn(Vo*t+d)]})).duration=1e3*r,e},ao.behavior.zoom=function(){function n(n){n.on(L,s).on(Wo+".zoom",p).on("dblclick.zoom",g).on(R,h)}function e(n){return[(n[0]-k.x)/k.k,(n[1]-k.y)/k.k]}function i(n){k.k=Math.max(A[0],Math.min(A[1],n))}function u(n,t){t=function(n){return[n[0]*k.k+k.x,n[1]*k.k+k.y]}(t),k.x+=n[0]-t[0],k.y+=n[1]-t[1]}function o(t,e,r,o){t.__chart__={x:k.x,y:k.y,k:k.k},i(Math.pow(2,o)),u(d=e,r),t=ao.select(t),(t=0<C?t.transition().duration(C):t).call(n.event)}function a(){b&&b.domain(x.range().map(function(n){return(n-k.x)/k.k}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-k.y)/k.k}).map(_.invert))}function l(n){z++||n({type:"zoomstart"})}function c(n){a(),n({type:"zoom",scale:k.k,translate:[k.x,k.y]})}function f(n){--z||(n({type:"zoomend"}),d=null)}function s(){var i=this,o=D.of(i,arguments),a=0,s=ao.select(t(i)).on(q,function(){a=1,u(ao.mouse(i),h),c(o)}).on(T,function(){s.on(q,null).on(T,null),p(a),f(o)}),h=e(ao.mouse(i)),p=W(i);Il.call(i),l(o)}function h(){function n(){var n=ao.touches(g);return p=k.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=e(n))}),n}function t(){var p=ao.event.target;ao.select(p).on(x,r).on(b,a),_.push(p);for(var e=ao.event.changedTouches,i=0,u=e.length;i<u;++i)d[e[i].identifier]=null;var f,h=n(),p=Date.now();1===h.length?(p-M<500&&(f=h[0],o(g,f,d[f.identifier],Math.floor(Math.log(k.k)/Math.LN2)+1),S()),M=p):1<h.length&&(f=h[0],p=h[1],h=f[0]-p[0],p=f[1]-p[1],y=h*h+p*p)}function r(){var e,r,o=ao.touches(g);Il.call(g);for(var s,n,t,a=0,l=o.length;a<l;++a,r=null)if(e=o[a],r=d[e.identifier]){if(t)break;n=e,t=r}r&&(s=(s=e[0]-n[0])*s+(s=e[1]-n[1])*s,s=y&&Math.sqrt(s/y),n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+r[0])/2,(t[1]+r[1])/2],i(s*p)),M=null,u(n,t),c(v)}function a(){if(ao.event.touches.length){for(var i,t=ao.event.changedTouches,e=0,r=t.length;e<r;++e)delete d[t[e].identifier];for(i in d)return void n()}ao.selectAll(_).on(m,null),w.on(L,s).on(R,h),N(),f(v)}var p,g=this,v=D.of(g,arguments),d={},y=0,m=".zoom-"+ao.event.changedTouches[0].identifier,x="touchmove"+m,b="touchend"+m,_=[],w=ao.select(g),N=W(g);t(),l(v),w.on(L,null).on(R,t)}function p(){var n=D.of(this,arguments);m?clearTimeout(m):(Il.call(this),v=e(d=y||ao.mouse(this)),l(n)),m=setTimeout(function(){m=null,f(n)},50),S(),i(Math.pow(2,.002*Bo())*k.k),u(d,v),c(n)}function g(){var n=ao.mouse(this),t=Math.log(k.k)/Math.LN2;o(this,n,e(n),ao.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}var v,d,y,m,M,x,b,_,w,k={x:0,y:0,k:1},E=[960,500],A=Jo,C=250,z=0,L="mousedown.zoom",q="mousemove.zoom",T="mouseup.zoom",R="touchstart.zoom",D=N(n,"zoomstart","zoom","zoomend");return Wo=Wo||("onwheel"in fo?(Bo=function(){return-ao.event.deltaY*(ao.event.deltaMode?120:1)},"wheel"):"onmousewheel"in fo?(Bo=function(){return ao.event.wheelDelta},"mousewheel"):(Bo=function(){return-ao.event.detail},"MozMousePixelScroll")),n.event=function(n){n.each(function(){var n=D.of(this,arguments),t=k;Hl?ao.select(this).transition().each("start.zoom",function(){k=this.__chart__||{x:0,y:0,k:1},l(n)}).tween("zoom:zoom",function(){var e=E[0],r=E[1],i=d?d[0]:e/2,u=d?d[1]:r/2,o=ao.interpolateZoom([(i-k.x)/k.k,(u-k.y)/k.k,e/k.k],[(i-t.x)/t.k,(u-t.y)/t.k,e/t.k]);return function(a){var r=o(a),a=e/r[2];this.__chart__=k={x:i-r[0]*a,y:u-r[1]*a,k:a},c(n)}}).each("interrupt.zoom",function(){f(n)}).each("end.zoom",function(){f(n)}):(this.__chart__=k,l(n),c(n),f(n))})},n.translate=function(t){return arguments.length?(k={x:+t[0],y:+t[1],k:k.k},a(),n):[k.x,k.y]},n.scale=function(t){return arguments.length?(k={x:k.x,y:k.y,k:null},i(+t),a(),n):k.k},n.scaleExtent=function(t){return arguments.length?(A=null==t?Jo:[+t[0],+t[1]],n):A},n.center=function(t){return arguments.length?(y=t&&[+t[0],+t[1]],n):y},n.size=function(t){return arguments.length?(E=t&&[+t[0],+t[1]],n):E},n.duration=function(t){return arguments.length?(C=+t,n):C},n.x=function(t){return arguments.length?(x=(b=t).copy(),k={x:0,y:0,k:1},n):b},n.y=function(t){return arguments.length?(_=(w=t).copy(),k={x:0,y:0,k:1},n):w},ao.rebind(n,D,"on")};var Bo,Wo,Jo=[0,1/0];(ao.color=an).prototype.toString=function(){return this.rgb()+""};Jl=(ao.hsl=ln).prototype=new an;Jl.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new ln(this.h,this.s,this.l/n)},Jl.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new ln(this.h,this.s,n*this.l)},Jl.rgb=function(){return cn(this.h,this.s,this.l)};Gl=(ao.hcl=fn).prototype=new an;Gl.brighter=function(n){return new fn(this.h,this.c,Math.min(100,this.l+Qo*(arguments.length?n:1)))},Gl.darker=function(n){return new fn(this.h,this.c,Math.max(0,this.l-Qo*(arguments.length?n:1)))},Gl.rgb=function(){return sn(this.h,this.c,this.l).rgb()},ao.lab=hn;var Qo=18,na=.95047,ta=1,ea=1.08883,Wl=hn.prototype=new an;Wl.brighter=function(n){return new hn(Math.min(100,this.l+Qo*(arguments.length?n:1)),this.a,this.b)},Wl.darker=function(n){return new hn(Math.max(0,this.l-Qo*(arguments.length?n:1)),this.a,this.b)},Wl.rgb=function(){return pn(this.l,this.a,this.b)};Jl=(ao.rgb=mn).prototype=new an;Jl.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,i=30;return t||e||r?(t&&t<i&&(t=i),e&&e<i&&(e=i),r&&r<i&&(r=i),new mn(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new mn(i,i,i)},Jl.darker=function(n){return new mn((n=Math.pow(.7,arguments.length?n:1))*this.r,n*this.g,n*this.b)},Jl.hsl=function(){return wn(this.r,this.g,this.b)},Jl.toString=function(){return"#"+bn(this.r)+bn(this.g)+bn(this.b)};var ua=ao.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});ua.forEach(function(n,t){ua.set(n,Mn(t))}),ao.functor=En,ao.xhr=An(m),ao.dsv=function(n,t){function e(n,e,u){arguments.length<3&&(u=e,e=null);var o=Cn(n,t,null==e?r:i(e),u);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:i(n)):e},o}function r(n){return e.parse(n.responseText)}function i(n){return function(t){return e.parse(t.responseText,n)}}function u(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var i=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(i(n),e)}:i})},e.parseRows=function(n,t){function e(){if(c<=f)return o;if(i)return i=!1,u;var t=f;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}return f=e+2,13===(r=n.charCodeAt(e+1))?(i=!0,10===n.charCodeAt(e+2)&&++f):10===r&&(i=!0),n.slice(t+1,e).replace(/""/g,'"')}for(;f<c;){var r,a=1;if(10===(r=n.charCodeAt(f++)))i=!0;else if(13===r)i=!0,10===n.charCodeAt(f)&&(++f,++a);else if(r!==l)continue;return n.slice(t,f-a)}return n.slice(t)}for(var r,i,u={},o={},a=[],c=n.length,f=0,s=0;(r=e())!==o;){for(var h=[];r!==u&&r!==o;)h.push(r),r=e();t&&null==(h=t(h,s++))||a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new y,i=[];return t.forEach(function(n){for(var t in n)r.has(t)||i.push(r.add(t))}),[i.map(o).join(n)].concat(t.map(function(t){return i.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(u).join("\n")},e},ao.csv=ao.dsv(",","text/csv"),ao.tsv=ao.dsv("\t","text/tab-separated-values");var oa,aa,la,ca,fa=this[x(this,"requestAnimationFrame")]||function(n){setTimeout(n,17)};ao.timer=function(){qn.apply(this,arguments)},ao.timer.flush=function(){Rn(),Dn()},ao.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var sa=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"].map(function(n,t){var e=Math.pow(10,3*xo(8-t));return{scale:8<t?function(n){return n/e}:function(n){return n*e},symbol:n}});ao.formatPrefix=function(n,t){var e=0;return(n=+n)&&(n<0&&(n*=-1),t&&(n=ao.round(n,Pn(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),sa[8+e/3]};var ha=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,pa=ao.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=ao.round(n,Pn(n,t))).toFixed(Math.max(0,Math.min(20,Pn(n*(1+1e-15),t))))}}),ga=ao.time={},va=Date;Hn.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){da.setUTCDate.apply(this._,arguments)},setDay:function(){da.setUTCDay.apply(this._,arguments)},setFullYear:function(){da.setUTCFullYear.apply(this._,arguments)},setHours:function(){da.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){da.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){da.setUTCMinutes.apply(this._,arguments)},setMonth:function(){da.setUTCMonth.apply(this._,arguments)},setSeconds:function(){da.setUTCSeconds.apply(this._,arguments)},setTime:function(){da.setTime.apply(this._,arguments)}};var da=Date.prototype;ga.year=On(function(n){return(n=ga.day(n)).setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ga.years=ga.year.range,ga.years.utc=ga.year.utc.range,ga.day=On(function(n){var t=new va(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ga.days=ga.day.range,ga.days.utc=ga.day.utc.range,ga.dayOfYear=function(n){var t=ga.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=ga[n]=On(function(n){return(n=ga.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ga.year(n).getDay();return Math.floor((ga.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ga[n+"s"]=e.range,ga[n+"s"].utc=e.utc.range,ga[n+"OfYear"]=function(n){var e=ga.year(n).getDay();return Math.floor((ga.dayOfYear(n)+(e+t)%7)/7)}}),ga.week=ga.sunday,ga.weeks=ga.sunday.range,ga.weeks.utc=ga.sunday.utc.range,ga.weekOfYear=ga.sundayOfYear;var ya={"-":"",_:" ",0:"0"},ma=/^\s*\d+/,Ma=/^%/;ao.locale=function(n){return{numberFormat:function(n){var t=n.decimal,e=n.thousands,r=n.grouping,i=n.currency,u=r&&e?function(n,t){for(var i=n.length,u=[],o=0,a=r[0],l=0;0<i&&0<a&&(t<l+a+1&&(a=Math.max(1,t-l)),u.push(n.substring(i-=a,i+a)),!((l+=a+1)>t));)a=r[o=(o+1)%r.length];return u.reverse().join(e)}:m;return function(e){var e=ha.exec(e),r=e[1]||" ",o=e[2]||">",a=e[3]||"-",l=e[4]||"",c=e[5],f=+e[6],s=e[7],h=e[8],p=e[9],g=1,v="",d="",y=!1,m=!0,h=h&&+h.substring(1);switch((c||"0"===r&&"="===o)&&(c=r="0",o="="),p){case"n":s=!0,p="g";break;case"%":g=100,d="%",p="f";break;case"p":g=100,d="%",p="r";break;case"b":case"o":case"x":case"X":"#"===l&&(v="0"+p.toLowerCase());case"c":m=!1;case"d":y=!0,h=0;break;case"s":g=-1,p="r"}"$"===l&&(v=i[0],d=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):"e"!=p&&"f"!=p||(h=Math.max(0,Math.min(20,h))));var p=pa.get(p)||Fn,M=c&&s;return function(n){var e=d;if(y&&n%1)return"";var i=n<0||0===n&&1/n<0?(n=-n,"-"):"-"===a?"":a;g<0?(n=(b=ao.formatPrefix(n,h)).scale(n),e=b.symbol+d):n*=g;var x,b,k=(n=p(n,h)).lastIndexOf(".");b=k<0?(S=m?n.lastIndexOf("e"):-1)<0?(x=n,""):(x=n.substring(0,S),n.substring(S)):(x=n.substring(0,k),t+n.substring(k+1)),!c&&s&&(x=u(x,1/0));var S=v.length+x.length+b.length+(M?0:i.length),k=S<f?new Array(S=f-S+1).join(r):"";return M&&(x=u(k+x,k.length?f-b.length:1/0)),i+=v,n=x+b,("<"===o?i+n+k:">"===o?k+i+n:"^"===o?k.substring(0,S>>=1)+i+n+k.substring(S):i+(M?n:k+n))+e}}}(n),timeFormat:function(n){function t(n){function t(t){for(var e,i,u,o=[],a=-1,l=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(l,a)),null!=(i=ya[e=n.charAt(++a)])&&(e=n.charAt(++a)),(u=A[e])&&(e=u(t,null==i?"e"===e?" ":"0":i)),o.push(e),l=a+1);return o.push(n.slice(l,a)),o.join("")}var r=n.length;return t.parse=function(o){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(e(r,n,o,0)!=o.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var u=null!=r.Z&&va!==Hn,o=new(u?Hn:va);return"j"in r?o.setFullYear(r.y,0,r.j):"W"in r||"U"in r?("w"in r||(r.w="W"in r?1:0),o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),u?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var i,u,a=0,l=t.length,c=e.length;a<l;){if(c<=r)return-1;if(37===(i=t.charCodeAt(a++))){if(u=t.charAt(a++),!(u=C[u in ya?t.charAt(a++):u])||(r=u(n,e,r))<0)return-1}else if(i!=e.charCodeAt(r++))return-1}return r}var s=n.dateTime,h=n.date,p=n.time,g=n.periods,v=n.days,d=n.shortDays,y=n.months,m=n.shortMonths;t.utc=function(n){function e(n){try{var t=new(va=Hn);return t._=n,r(t)}finally{va=Date}}var r=t(n);return e.parse=function(n){try{va=Hn;var t=r.parse(n);return t&&t._}finally{va=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ct;var M=ao.map(),x=Vn(v),b=Xn(v),_=Vn(d),w=Xn(d),S=Vn(y),k=Xn(y),N=Vn(m),E=Xn(m);g.forEach(function(n,t){M.set(n.toLowerCase(),t)});var A={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return m[n.getMonth()]},B:function(n){return y[n.getMonth()]},c:t(s),d:function(n,t){return Zn(n.getDate(),t,2)},e:function(n,t){return Zn(n.getDate(),t,2)},H:function(n,t){return Zn(n.getHours(),t,2)},I:function(n,t){return Zn(n.getHours()%12||12,t,2)},j:function(n,t){return Zn(1+ga.dayOfYear(n),t,3)},L:function(n,t){return Zn(n.getMilliseconds(),t,3)},m:function(n,t){return Zn(n.getMonth()+1,t,2)},M:function(n,t){return Zn(n.getMinutes(),t,2)},p:function(n){return g[+(12<=n.getHours())]},S:function(n,t){return Zn(n.getSeconds(),t,2)},U:function(n,t){return Zn(ga.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Zn(ga.mondayOfYear(n),t,2)},x:t(h),X:t(p),y:function(n,t){return Zn(n.getFullYear()%100,t,2)},Y:function(n,t){return Zn(n.getFullYear()%1e4,t,4)},Z:at,"%":function(){return"%"}},C={a:function(n,r,e){return _.lastIndex=0,(r=_.exec(r.slice(e)))?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1},A:function(n,r,e){return x.lastIndex=0,(r=x.exec(r.slice(e)))?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1},b:function(n,r,e){return N.lastIndex=0,(r=N.exec(r.slice(e)))?(n.m=E.get(r[0].toLowerCase()),e+r[0].length):-1},B:function(n,r,e){return S.lastIndex=0,(r=S.exec(r.slice(e)))?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1},c:function(n,t,r){return e(n,A.c.toString(),t,r)},d:tt,e:tt,H:rt,I:rt,j:et,L:ot,m:nt,M:it,p:function(n,r,e){return null==(r=M.get(r.slice(e,e+=2).toLowerCase()))?-1:(n.p=r,e)},S:ut,U:Bn,w:$n,W:Wn,x:function(n,t,r){return e(n,A.x.toString(),t,r)},X:function(n,t,r){return e(n,A.X.toString(),t,r)},y:Gn,Y:Jn,Z:Kn,"%":lt};return t}(n)}};Gl=ao.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ao.format=Gl.numberFormat,ao.geo={},ft.prototype={s:0,t:0,add:function(n){st(n,this.t,ba),st(ba.s,this.s,this),this.s?this.t+=ba.t:this.s=ba.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var ba=new ft;ao.geo.stream=function(n,t){n&&_a.hasOwnProperty(n.type)?_a[n.type](n,t):ht(n,t)};var _a={Feature:function(n,t){ht(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,i=e.length;++r<i;)ht(e[r].geometry,t)}},wa={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){pt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)pt(e[r],t,0)},Polygon:function(n,t){gt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)gt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,i=e.length;++r<i;)ht(e[r],t)}};ao.geo.area=function(n){return Sa=0,ao.geo.stream(n,Na),Sa};var Sa,ka=new ft,Na={sphere:function(){Sa+=4*Fo},point:b,lineStart:b,lineEnd:b,polygonStart:function(){ka.reset(),Na.lineStart=vt},polygonEnd:function(){var n=2*ka;Sa+=n<0?4*Fo+n:n,Na.lineStart=Na.lineEnd=Na.point=b}};ao.geo.bounds=function(){function n(n,t){M.push(x=[f=n,h=n]),t<s&&(s=t),p<t&&(p=t)}function t(t,e){var o,c,v,d,m,r=dt([t*Yo,e*Yo]);y?(v=mt(y,r),bt(o=mt([v[1],-v[0],0],v)),o=_t(o),d=t-g,v=o[0]*Zo*(c=0<d?1:-1),(d=180<xo(d))^(c*g<v&&v<c*t)?(m=o[1]*Zo,p<m&&(p=m)):d^(c*g<(v=(v+360)%360-180)&&v<c*t)?(m=-o[1]*Zo)<s&&(s=m):(e<s&&(s=e),p<e&&(p=e)),d?t<g?a(f,t)>a(f,h)&&(h=t):a(t,h)>a(f,h)&&(f=t):f<=h?(t<f&&(f=t),h<t&&(h=t)):g<t?a(f,t)>a(f,h)&&(h=t):a(t,h)>a(f,h)&&(f=t)):n(t,e),y=r,g=t}function e(){b.point=t}function r(){x[0]=f,x[1]=h,b.point=n,y=null}function i(n,e){var r;y?m+=180<xo(r=n-g)?r+(0<r?360:-360):r:(v=n,d=e),Na.point(n,e),t(n,e)}function u(){Na.lineStart()}function o(){i(v,d),Na.lineEnd(),xo(m)>Uo&&(f=-(h=180)),x[0]=f,x[1]=h,y=null}function a(n,t){return(t-=n)<0?t+360:t}function l(n,t){return n[0]-t[0]}function c(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var f,s,h,p,g,v,d,y,m,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=i,b.lineStart=u,b.lineEnd=o,m=0,Na.polygonStart()},polygonEnd:function(){Na.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,ka<0?(f=-(h=180),s=-(p=90)):Uo<m?p=90:m<-Uo&&(s=-90),x[0]=f,x[1]=h}};return function(n){if(p=h=-(f=s=1/0),M=[],ao.geo.stream(n,b),t=M.length){M.sort(l);for(var r=1,u=[i=M[0]];r<t;++r)c((e=M[r])[0],i)||c(e[1],i)?(a(i[0],e[1])>a(i[0],i[1])&&(i[1]=e[1]),a(e[0],i[1])>a(i[0],i[1])&&(i[0]=e[0])):u.push(i=e);for(var o,e,t,g=-1/0,r=0,i=u[t=u.length-1];r<=t;i=e,++r)e=u[r],(o=a(i[1],e[0]))>g&&(g=o,f=e[0],h=i[1])}return M=x=null,f===1/0||s===1/0?[[NaN,NaN],[NaN,NaN]]:[[f,s],[h,p]]}}(),ao.geo.centroid=function(i){Ea=Aa=Ca=za=La=qa=Ta=Ra=Da=Pa=Ua=0,ao.geo.stream(i,ja);var t=Da,e=Pa,r=Ua,i=t*t+e*e+r*r;return i<jo&&(t=qa,e=Ta,r=Ra,Aa<Uo&&(t=Ca,e=za,r=La),(i=t*t+e*e+r*r)<jo)?[NaN,NaN]:[Math.atan2(e,t)*Zo,tn(r/Math.sqrt(i))*Zo]};var Ea,Aa,Ca,za,La,qa,Ta,Ra,Da,Pa,Ua,ja={sphere:b,point:St,lineStart:Nt,lineEnd:Et,polygonStart:function(){ja.lineStart=At},polygonEnd:function(){ja.lineStart=Nt}},Fa=Rt(zt,function(n){var t,e=NaN,r=NaN,i=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(u,o){var a=0<u?Fo:-Fo,l=xo(u-e);xo(l-Fo)<Uo?(n.point(e,r=0<(r+o)/2?Io:-Io),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(u,r),t=0):i!==a&&Fo<=l&&(xo(e-i)<Uo&&(e-=i*Uo),xo(u-a)<Uo&&(u-=a*Uo),r=function(n,t,i,r){var u,o=Math.sin(n-i);return xo(o)>Uo?Math.atan((Math.sin(t)*(u=Math.cos(r))*Math.sin(i)-Math.sin(r)*(i=Math.cos(t))*Math.sin(n))/(i*u*o)):(t+r)/2}(e,r,u,o),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=u,r=o),i=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}},function(u,t,e,r){var i;null==u?(r.point(-Fo,i=e*Io),r.point(0,i),r.point(Fo,i),r.point(Fo,0),r.point(Fo,-i),r.point(0,-i),r.point(-Fo,-i),r.point(-Fo,0),r.point(-Fo,i)):xo(u[0]-t[0])>Uo?(u=u[0]<t[0]?Fo:-Fo,r.point(-u,i=e*u/2),r.point(0,i),r.point(u,i)):r.point(t[0],t[1])},[-Fo,-Fo/2]),Ha=1e9;ao.geo.clipExtent=function(){var n,t,e,r,i,u,o={stream:function(n){return i&&(i.valid=!1),(i=u(n)).valid=!0,i},extent:function(a){return arguments.length?(u=Zt(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),i&&(i.valid=!1,i=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(ao.geo.conicEqualArea=function(){return Vt(Xt)}).raw=Xt,ao.geo.albers=function(){return ao.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ao.geo.albersUsa=function(){function n(o){var u=o[0],o=o[1];return t=null,e(u,o),t||(r(u,o),t)||i(u,o),t}var t,e,r,i,u=ao.geo.albers(),o=ao.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=ao.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(n,e){t=[n,e]}};return n.invert=function(n){var i=u.scale(),e=u.translate(),r=(n[0]-e[0])/i,i=(n[1]-e[1])/i;return(.12<=i&&i<.234&&-.425<=r&&r<-.214?o:.166<=i&&i<.234&&-.214<=r&&r<-.115?a:u).invert(n)},n.stream=function(n){var t=u.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,i){t.point(n,i),e.point(n,i),r.point(n,i)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(u.precision(t),o.precision(t),a.precision(t),n):u.precision()},n.scale=function(t){return arguments.length?(u.scale(t),o.scale(.35*t),a.scale(t),n.translate(u.translate())):u.scale()},n.translate=function(t){if(!arguments.length)return u.translate();var c=u.scale(),f=+t[0],s=+t[1];return e=u.translate(t).clipExtent([[f-.455*c,s-.238*c],[f+.455*c,s+.238*c]]).stream(l).point,r=o.translate([f-.307*c,s+.201*c]).clipExtent([[f-.425*c+Uo,s+.12*c+Uo],[f-.214*c-Uo,s+.234*c-Uo]]).stream(l).point,i=a.translate([f-.205*c,s+.212*c]).clipExtent([[f-.214*c+Uo,s+.166*c+Uo],[f-.115*c-Uo,s+.234*c-Uo]]).stream(l).point,n},n.scale(1070)};var Oa,Ia,Ya,Za,Va,Xa,$a={point:b,lineStart:b,lineEnd:b,polygonStart:function(){Ia=0,$a.lineStart=$t},polygonEnd:function(){$a.lineStart=$a.lineEnd=$a.point=b,Oa+=xo(Ia/2)}},Ba={point:function(n,t){n<Ya&&(Ya=n),Va<n&&(Va=n),t<Za&&(Za=t),Xa<t&&(Xa=t)},lineStart:b,lineEnd:b,polygonStart:b,polygonEnd:b},Wa={point:Gt,lineStart:Kt,lineEnd:Qt,polygonStart:function(){Wa.lineStart=ne},polygonEnd:function(){Wa.point=Gt,Wa.lineStart=Kt,Wa.lineEnd=Qt}};ao.geo.path=function(){function n(n){return n&&("function"==typeof a&&u.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=i(u)),ao.geo.stream(n,o)),u.result()}function t(){return o=null,n}var e,r,i,u,o,a=4.5;return n.area=function(n){return Oa=0,ao.geo.stream(n,i($a)),Oa},n.centroid=function(n){return Ca=za=La=qa=Ta=Ra=Da=Pa=Ua=0,ao.geo.stream(n,i(Wa)),Ua?[Da/Ua,Pa/Ua]:Ra?[qa/Ra,Ta/Ra]:La?[Ca/La,za/La]:[NaN,NaN]},n.bounds=function(n){return Va=Xa=-(Ya=Za=1/0),ao.geo.stream(n,i(Ba)),[[Ya,Za],[Va,Xa]]},n.projection=function(n){return arguments.length?(i=(e=n)?n.stream||function(n){var t=ee(function(t,e){return n([t*Zo,e*Zo])});return function(n){return le(t(n))}}(n):m,t()):e},n.context=function(n){return arguments.length?(u=null==(r=n)?new Wt:new te(n),"function"!=typeof a&&u.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(u.pointRadius(+t),+t),n):a},n.projection(ao.geo.albersUsa()).context(null)},ao.geo.transform=function(n){return{stream:function(t){var r,e=new ie(t);for(r in n)e[r]=n[r];return e}}},ie.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ao.geo.projection=oe,ao.geo.projectionMutator=ae,(ao.geo.equirectangular=function(){return oe(ce)}).raw=ce.invert=ce,ao.geo.rotation=function(n){function t(t){return(t=n(t[0]*Yo,t[1]*Yo))[0]*=Zo,t[1]*=Zo,t}return n=se(n[0]%360*Yo,n[1]*Yo,2<n.length?n[2]*Yo:0),t.invert=function(t){return(t=n.invert(t[0]*Yo,t[1]*Yo))[0]*=Zo,t[1]*=Zo,t},t},fe.invert=ce,ao.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=se(-n[0]*Yo,-n[1]*Yo,0).invert,i=[];return e(null,null,1,{point:function(n,e){i.push(n=t(n,e)),n[0]*=Zo,n[1]*=Zo}}),{type:"Polygon",coordinates:[i]}}var t,e,r=[0,0],i=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=ve((t=+r)*Yo,i*Yo),n):t},n.precision=function(r){return arguments.length?(e=ve(t*Yo,(i=+r)*Yo),n):i},n.angle(90)},ao.geo.distance=function(a,l){var c=(l[0]-a[0])*Yo,f=a[1]*Yo,s=l[1]*Yo,e=Math.sin(c),a=Math.cos(c),l=Math.sin(f),c=Math.cos(f),f=Math.sin(s),s=Math.cos(s);return Math.atan2(Math.sqrt((e=s*e)*e+(e=c*f-l*s*a)*e),l*f+c*s*a)},ao.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return ao.range(Math.ceil(u/d)*d,i,d).map(h).concat(ao.range(Math.ceil(c/y)*y,l,y).map(p)).concat(ao.range(Math.ceil(r/g)*g,e,g).filter(function(n){return xo(n%d)>Uo}).map(f)).concat(ao.range(Math.ceil(a/v)*v,o,v).filter(function(n){return xo(n%y)>Uo}).map(s))}var e,r,i,u,o,a,l,c,f,s,h,p,g=10,v=g,d=90,y=360,m=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(u).concat(p(l).slice(1),h(i).reverse().slice(1),p(c).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(u=+t[0][0],i=+t[1][0],c=+t[0][1],l=+t[1][1],i<u&&(t=u,u=i,i=t),l<c&&(t=c,c=l,l=t),n.precision(m)):[[u,c],[i,l]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],e<r&&(t=r,r=e,e=t),o<a&&(t=a,a=o,o=t),n.precision(m)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],y=+t[1],n):[d,y]},n.minorStep=function(t){return arguments.length?(g=+t[0],v=+t[1],n):[g,v]},n.precision=function(t){return arguments.length?(m=+t,f=ye(a,o,90),s=me(r,e,m),h=ye(c,l,90),p=me(u,i,m),n):m},n.majorExtent([[-180,-90+Uo],[180,90-Uo]]).minorExtent([[-180,-80-Uo],[180,80+Uo]])},ao.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||i.apply(this,arguments)]}}var t,e,r=Me,i=xe;return n.distance=function(){return ao.geo.distance(t||r.apply(this,arguments),e||i.apply(this,arguments))},n.source=function(e){return arguments.length?(t="function"==typeof(r=e)?null:e,n):r},n.target=function(t){return arguments.length?(e="function"==typeof(i=t)?null:t,n):i},n.precision=function(){return arguments.length?n:0},n},ao.geo.interpolate=function(n,t){return function(n,t,g,r){var i=Math.cos(t),u=Math.sin(t),o=Math.cos(r),a=Math.sin(r),l=i*Math.cos(n),c=i*Math.sin(n),f=o*Math.cos(g),s=o*Math.sin(g),h=2*Math.asin(Math.sqrt(on(r-t)+i*o*on(g-n))),p=1/Math.sin(h);return(g=h?function(i){var o=Math.sin(i*=h)*p,e=Math.sin(h-i)*p,r=e*l+o*f,i=e*c+o*s,o=e*u+o*a;return[Math.atan2(i,r)*Zo,Math.atan2(o,Math.sqrt(r*r+i*i))*Zo]}:function(){return[n*Zo,t*Zo]}).distance=h,g}(n[0]*Yo,n[1]*Yo,t[0]*Yo,t[1]*Yo)},ao.geo.length=function(n){return Ja=0,ao.geo.stream(n,Ga),Ja};var Ja,Ga={sphere:b,point:b,lineStart:function(){function n(n,l){var u=Math.sin(l*=Yo),o=Math.cos(l),a=xo((n*=Yo)-t),l=Math.cos(a);Ja+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*u-e*o*l)*a),e*u+r*o*l),t=n,e=u,r=o}var t,e,r;Ga.point=function(i,u){t=i*Yo,e=Math.sin(u*=Yo),r=Math.cos(u),Ga.point=n},Ga.lineEnd=function(){Ga.point=Ga.lineEnd=b}},lineEnd:b,polygonStart:b,polygonEnd:b},Ka=we(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(ao.geo.azimuthalEqualArea=function(){return oe(Ka)}).raw=Ka;var Qa=we(function(t){t=Math.acos(t);return t&&t/Math.sin(t)},m);(ao.geo.azimuthalEquidistant=function(){return oe(Qa)}).raw=Qa,(ao.geo.conicConformal=function(){return Vt(Se)}).raw=Se,(ao.geo.conicEquidistant=function(){return Vt(ke)}).raw=ke;var nl=we(function(n){return 1/n},Math.atan);(ao.geo.gnomonic=function(){return oe(nl)}).raw=nl,Ne.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Io]},(ao.geo.mercator=function(){return Ee(Ne)}).raw=Ne;var tl=we(function(){return 1},Math.asin);(ao.geo.orthographic=function(){return oe(tl)}).raw=tl;var el=we(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(ao.geo.stereographic=function(){return oe(el)}).raw=el,Ae.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Io]},(ao.geo.transverseMercator=function(){var n=Ee(Ae),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):[(n=t())[1],-n[0]]},n.rotate=function(n){return n?e([n[0],n[1],2<n.length?n[2]+90:90]):[(n=e())[0],n[1],n[2]-90]},e([0,0,90])}).raw=Ae,ao.geom={},ao.geom.hull=function(n){function t(n){if(n.length<3)return[];for(var i=En(e),u=En(r),o=n.length,a=[],l=[],t=0;t<o;t++)a.push([+i.call(this,n[t],t),+u.call(this,n[t],t),t]);for(a.sort(qe),t=0;t<o;t++)l.push([a[t][0],-a[t][1]]);var c=Le(a),f=Le(l),s=f[0]===c[0],h=f[f.length-1]===c[c.length-1],p=[];for(t=c.length-1;0<=t;--t)p.push(n[a[c[t]][2]]);for(t=+s;t<f.length-h;++t)p.push(n[a[f[t]][2]]);return p}var e=Ce,r=ze;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},ao.geom.polygon=function(n){return ko(n,rl),n};var rl=ao.geom.polygon.prototype=[];rl.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],i=0;++t<e;)n=r,r=this[t],i+=n[1]*r[0]-n[0]*r[1];return.5*i},rl.centroid=function(n){var t,e,r=-1,i=this.length,u=0,o=0,a=this[i-1];for(arguments.length||(n=-1/(6*this.area()));++r<i;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],u+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[u*n,o*n]},rl.clip=function(n){for(var t,e,r,i,u,o,a=De(n),l=-1,c=this.length-De(this),f=this[c-1];++l<c;){for(t=n.slice(),n.length=0,i=this[l],u=t[(r=t.length-a)-1],e=-1;++e<r;)Te(o=t[e],f,i)?(Te(u,f,i)||n.push(Re(u,o,f,i)),n.push(o)):Te(u,f,i)&&n.push(Re(u,o,f,i)),u=o;a&&n.push(n[0]),f=i}return n};var il,ul,ol,al,ll,cl=[],fl=[];Ye.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)(n=t[e].edge).b&&n.a||t.splice(e,1);return t.sort(Ve),t.length},tr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},er.prototype={insert:function(n,t){var e,r,i;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else e=this._?(n=or(this._),t.P=null,(t.N=n).P=n.L=t,n):(t.P=t.N=null,this._=t,null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)e===(r=e.U).L?(i=r.R)&&i.C?(e.C=i.C=!1,r.C=!0,n=r):(n===e.R&&(ir(this,e),e=(n=e).U),e.C=!1,r.C=!0,ur(this,r)):(i=r.L)&&i.C?(e.C=i.C=!1,r.C=!0,n=r):(n===e.L&&(ur(this,e),e=(n=e).U),e.C=!1,r.C=!0,ir(this,r)),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,r,i=n.U,u=n.L,o=n.R,e=u?o?or(o):u:o;if(i?i.L===n?i.L=e:i.R=e:this._=e,u&&o?(r=e.C,e.C=n.C,((e.L=u).U=e)!==o?(i=e.U,e.U=n.U,n=e.R,i.L=n,(e.R=o).U=e):(e.U=i,n=(i=e).R)):(r=n.C,n=e),n&&(n.U=i),!r)if(n&&n.C)n.C=!1;else{do{if(n===this._)break;if(n===i.L){if((t=i.R).C&&(t.C=!1,i.C=!0,ir(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ur(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,ir(this,i),n=this._;break}}else if((t=i.L).C&&(t.C=!1,i.C=!0,ur(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ir(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,ur(this,i),n=this._;break}}while(t.C=!0,i=(n=i).U,!n.C);n&&(n.C=!1)}}},ao.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],i=a[0][1],u=a[1][0],o=a[1][1];return ar(e(n),a).cells.forEach(function(c,a){var l=c.edges,c=c.site;(t[a]=l.length?l.map(function(t){t=t.start();return[t.x,t.y]}):c.x>=r&&c.x<=u&&c.y>=i&&c.y<=o?[[r,o],[u,o],[u,i],[r,i]]:[]).point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(u(n,t)/Uo)*Uo,y:Math.round(o(n,t)/Uo)*Uo,i:t}})}var r=Ce,i=ze,u=r,o=i,a=sl;return n?t(n):(t.links=function(n){return ar(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return ar(e(n)).cells.forEach(function(e,r){for(var u,o=e.site,a=e.edges.sort(Ve),l=-1,c=a.length,f=a[c-1].edge,s=f.l===o?f.r:f.l;++l<c;)u=s,s=(f=a[l].edge).l===o?f.r:f.l,r<u.i&&r<s.i&&function(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}(o,u,s)<0&&t.push([n[r],n[u.i],n[s.i]])}),t},t.x=function(n){return arguments.length?(u=En(r=n),t):r},t.y=function(n){return arguments.length?(o=En(i=n),t):i},t.clipExtent=function(n){return arguments.length?(a=null==n?sl:n,t):a===sl?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===sl?null:a&&a[1]},t)};var sl=[[-1e6,-1e6],[1e6,1e6]];ao.geom.delaunay=function(n){return ao.geom.voronoi().triangles(n)},ao.geom.quadtree=function(n,t,e,r,i){function u(n){function u(n,t,e,r,i,u,o,a){var l,f,s;isNaN(e)||isNaN(r)||(n.leaf?(l=n.x,f=n.y,null!=l?(xo(l-e)+xo(f-r)<.01||(s=n.point,n.x=n.y=n.point=null,c(n,s,l,f,i,u,o,a)),c(n,t,e,r,i,u,o,a)):(n.x=e,n.y=r,n.point=t)):c(n,t,e,r,i,u,o,a))}function c(n,t,e,r,i,o,a,l){var c=.5*(i+a),f=.5*(o+l),s=c<=e,h=f<=r,p=h<<1|s;n.leaf=!1,s?i=c:a=c,h?o=f:l=f,u(n=n.nodes[p]||(n.nodes[p]=hr()),t,e,r,i,o,a,l)}var f,s,h,p,g,v,d,y,m,M=En(a),x=En(l);if(null!=t)v=t,d=e,y=r,m=i;else if(y=m=-(v=d=1/0),s=[],h=[],g=n.length,o)for(p=0;p<g;++p)(f=n[p]).x<v&&(v=f.x),f.y<d&&(d=f.y),f.x>y&&(y=f.x),f.y>m&&(m=f.y),s.push(f.x),h.push(f.y);else for(p=0;p<g;++p){var b=+M(f=n[p],p),_=+x(f,p);b<v&&(v=b),_<d&&(d=_),y<b&&(y=b),m<_&&(m=_),s.push(b),h.push(_)}var w=y-v,S=m-d;S<w?m=d+w:y=v+S;var k=hr();if(k.add=function(n){u(k,n,+M(n,++p),+x(n,p),v,d,y,m)},k.visit=function(n){!function pr(n,l,e,r,i,u){var o,a;n(l,e,r,i,u)||(o=.5*(e+i),a=.5*(r+u),(l=l.nodes)[0]&&pr(n,l[0],e,r,o,a),l[1]&&pr(n,l[1],o,r,i,a),l[2]&&pr(n,l[2],e,a,o,u),l[3]&&pr(n,l[3],o,a,i,u))}(n,k,v,d,y,m)},k.find=function(n){return function(n,t,e,r,i,u,o){var a,l=1/0;return function c(n,f,s,h,p){if(!(u<f||o<s||h<r||p<i)){var g,m;!(g=n.point)||(m=(m=t-n.x)*m+(m=e-n.y)*m)<l&&(m=Math.sqrt(l=m),r=t-m,i=e-m,u=t+m,o=e+m,a=g);for(var M=n.nodes,x=.5*(f+h),b=.5*(s+p),S=(b<=e)<<1|x<=t,k=S+4;S<k;++S)if(n=M[3&S])switch(3&S){case 0:c(n,f,s,x,b);break;case 1:c(n,x,s,h,b);break;case 2:c(n,f,b,x,p);break;case 3:c(n,x,b,h,p)}}}(n,r,i,u,o),a}(k,n[0],n[1],v,d,y,m)},p=-1,null==t){for(;++p<g;)u(k,n[p],s[p],h[p],v,d,y,m);--p}else n.forEach(k.add);return s=h=n=f=null,k}var o,a=Ce,l=ze;return(o=arguments.length)?(a=fr,l=sr,3===o&&(i=e,r=t,e=t=0),u(n)):(u.x=function(n){return arguments.length?(a=n,u):a},u.y=function(n){return arguments.length?(l=n,u):l},u.extent=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],i=+n[1][1]),u):null==t?null:[[t,e],[r,i]]},u.size=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=e=0,r=+n[0],i=+n[1]),u):null==t?null:[r-t,i-e]},u)},ao.interpolateRgb=vr,ao.interpolateObject=dr,ao.interpolateNumber=yr,ao.interpolateString=mr;var hl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(hl.source,"g");ao.interpolate=Mr,ao.interpolators=[function(n,t){var e=typeof t;return("string"==e?ua.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?vr:mr:t instanceof an?vr:Array.isArray(t)?xr:"object"==e&&isNaN(t)?dr:yr)(n,t)}],ao.interpolateArray=xr;function gl(){return m}var vl=ao.map({linear:gl,poly:function(n){return function(t){return Math.pow(t,n)}},quad:function(){return Sr},cubic:function(){return kr},sin:function(){return Ar},exp:function(){return Cr},circle:function(){return zr},elastic:function(n,t){var e;return arguments.length<2&&(t=.45),e=arguments.length?t/Ho*Math.asin(1/n):(n=1,t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Ho/t)}},back:function(n){return n=n||1.70158,function(t){return t*t*((n+1)*t-n)}},bounce:function(){return Tr}}),dl=ao.map({in:m,out:_r,"in-out":wr,"out-in":function(n){return wr(_r(n))}});ao.ease=function(n){var r=n.indexOf("-"),e=0<=r?n.slice(0,r):n,r=0<=r?n.slice(r+1):"in",e=vl.get(e)||gl;return function(n){return function(t){return t<=0?0:1<=t?1:n(t)}}((r=dl.get(r)||m)(e.apply(null,lo.call(arguments,1))))},ao.interpolateHcl=function(n,t){n=ao.hcl(n),t=ao.hcl(t);var e=n.h,r=n.c,i=n.l,u=t.h-e,o=t.c-r,a=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):180<u?u-=360:u<-180&&(u+=360),function(n){return sn(e+u*n,r+o*n,i+a*n)+""}},ao.interpolateHsl=function(n,t){n=ao.hsl(n),t=ao.hsl(t);var e=n.h,r=n.s,i=n.l,u=t.h-e,o=t.s-r,a=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):180<u?u-=360:u<-180&&(u+=360),function(n){return cn(e+u*n,r+o*n,i+a*n)+""}},ao.interpolateLab=function(n,t){n=ao.lab(n),t=ao.lab(t);var e=n.l,r=n.a,i=n.b,u=t.l-e,o=t.a-r,a=t.b-i;return function(n){return pn(e+u*n,r+o*n,i+a*n)+""}},ao.interpolateRound=Ur,ao.transform=function(n){var t=fo.createElementNS(ao.ns.prefix.svg,"g");return(ao.transform=function(n){var e;return null!=n&&(t.setAttribute("transform",n),e=t.transform.baseVal.consolidate()),new jr(e?e.matrix:yl)})(n)},jr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var yl={a:1,b:0,c:0,d:1,e:0,f:0};ao.interpolateTransform=$r,ao.layout={},ao.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Jr(n[e]));return t}},ao.layout.chord=function(){function n(){var n,c,s,h,p,g={},v=[],d=ao.range(u),y=[];for(e=[],r=[],n=0,h=-1;++h<u;){for(c=0,p=-1;++p<u;)c+=i[h][p];v.push(c),y.push(ao.range(u)),n+=c}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&y.forEach(function(n,t){n.sort(function(n,e){return a(i[t][n],i[t][e])})}),n=(Ho-f*u)/n,c=0,h=-1;++h<u;){for(s=c,p=-1;++p<u;){var m=d[h],M=y[m][p],x=i[m][M],b=c,_=c+=x*n;g[m+"-"+M]={index:m,subindex:M,startAngle:b,endAngle:_,value:x}}r[m]={index:m,startAngle:s,endAngle:c,value:v[m]},c+=f}for(h=-1;++h<u;)for(p=h-1;++p<u;){var w=g[h+"-"+p],S=g[p+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}l&&t()}function t(){e.sort(function(n,t){return l((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,i,u,o,a,l,c={},f=0;return c.matrix=function(n){return arguments.length?(u=(i=n)&&i.length,e=r=null,c):i},c.padding=function(n){return arguments.length?(f=n,e=r=null,c):f},c.sortGroups=function(n){return arguments.length?(o=n,e=r=null,c):o},c.sortSubgroups=function(n){return arguments.length?(a=n,e=null,c):a},c.sortChords=function(n){return arguments.length?(l=n,e&&t(),c):l},c.chords=function(){return e||n(),e},c.groups=function(){return r||n(),r},c},ao.layout.force=function(){function n(n){return function(t,l,r,a){if(t.point!==n){var c,u=t.cx-n.x,o=t.cy-n.y,a=a-l,l=u*u+o*o;if(a*a/y<l)return l<v&&(c=t.charge/l,n.px-=u*c,n.py-=o*c),!0;t.point&&l&&l<v&&(c=t.pointCharge/l,n.px-=u*c,n.py-=o*c)}return!t.charge}}function t(n){n.px=ao.event.x,n.py=ao.event.y,l.resume()}var e,r,i,u,o,a,l={},c=ao.dispatch("start","tick","end"),f=[1,1],s=.9,h=ml,p=Ml,g=-30,v=xl,d=.1,y=.64,M=[],x=[];return l.tick=function(){if((i*=.99)<.005)return e=null,c.end({type:"end",alpha:i=0}),!0;for(var t,l,h,p,v,y,m,b,_=M.length,w=x.length,r=0;r<w;++r)h=(l=x[r]).source,(v=(m=(p=l.target).x-h.x)*m+(b=p.y-h.y)*b)&&(b*=v=i*o[r]*((v=Math.sqrt(v))-u[r])/v,p.x-=(m*=v)*(y=h.weight+p.weight?h.weight/(h.weight+p.weight):.5),p.y-=b*y,h.x+=m*(y=1-y),h.y+=b*y);if((y=i*d)&&(m=f[0]/2,b=f[1]/2,r=-1,y))for(;++r<_;)(l=M[r]).x+=(m-l.x)*y,l.y+=(b-l.y)*y;if(g)for(function ri(n,t,e){var c,r=0,i=0;if(n.charge=0,!n.leaf)for(var u,o=n.nodes,a=o.length,l=-1;++l<a;)null!=(u=o[l])&&(ri(u,t,e),n.charge+=u.charge,r+=u.charge*u.cx,i+=u.charge*u.cy);n.point&&(n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5),c=t*e[n.point.index],n.charge+=n.pointCharge=c,r+=c*n.point.x,i+=c*n.point.y),n.cx=r/n.charge,n.cy=i/n.charge}(t=ao.geom.quadtree(M),i,a),r=-1;++r<_;)(l=M[r]).fixed||t.visit(n(l));for(r=-1;++r<_;)(l=M[r]).fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*s,l.y-=(l.py-(l.py=l.y))*s);c.tick({type:"tick",alpha:i})},l.nodes=function(n){return arguments.length?(M=n,l):M},l.links=function(n){return arguments.length?(x=n,l):x},l.size=function(n){return arguments.length?(f=n,l):f},l.linkDistance=function(n){return arguments.length?(h="function"==typeof n?n:+n,l):h},l.distance=l.linkDistance,l.linkStrength=function(n){return arguments.length?(p="function"==typeof n?n:+n,l):p},l.friction=function(n){return arguments.length?(s=+n,l):s},l.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,l):g},l.chargeDistance=function(n){return arguments.length?(v=n*n,l):Math.sqrt(v)},l.gravity=function(n){return arguments.length?(d=+n,l):d},l.theta=function(n){return arguments.length?(y=n*n,l):Math.sqrt(y)},l.alpha=function(n){return arguments.length?(n=+n,i?0<n?i=n:(e.c=null,e.t=NaN,e=null,c.end({type:"end",alpha:i=0})):0<n&&(c.start({type:"start",alpha:i=n}),e=qn(l.tick)),l):i},l.start=function(){function n(n,r){if(!e){for(e=new Array(i),l=0;l<i;++l)e[l]=[];for(l=0;l<c;++l){var u=x[l];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var o,a=e[t],l=-1,f=a.length;++l<f;)if(!isNaN(o=a[l][n]))return o;return Math.random()*r}for(var e,r,i=M.length,c=x.length,s=f[0],v=f[1],t=0;t<i;++t)(r=M[t]).index=t,r.weight=0;for(t=0;t<c;++t)"number"==typeof(r=x[t]).source&&(r.source=M[r.source]),"number"==typeof r.target&&(r.target=M[r.target]),++r.source.weight,++r.target.weight;for(t=0;t<i;++t)r=M[t],isNaN(r.x)&&(r.x=n("x",s)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof h)for(t=0;t<c;++t)u[t]=+h.call(this,x[t],t);else for(t=0;t<c;++t)u[t]=h;if(o=[],"function"==typeof p)for(t=0;t<c;++t)o[t]=+p.call(this,x[t],t);else for(t=0;t<c;++t)o[t]=p;if(a=[],"function"==typeof g)for(t=0;t<i;++t)a[t]=+g.call(this,M[t],t);else for(t=0;t<i;++t)a[t]=g;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){return r=r||ao.behavior.drag().origin(m).on("dragstart.force",Qr).on("drag.force",t).on("dragend.force",ni),arguments.length?void this.on("mouseover.force",ti).on("mouseout.force",ei).call(r):r},ao.rebind(l,c,"on")};var ml=20,Ml=1,xl=1/0;ao.layout.hierarchy=function(){function n(i){var u,l,c,f,o=[i],a=[];for(i.depth=0;null!=(u=o.pop());)if(a.push(u),(c=e.call(n,u,u.depth))&&(l=c.length)){for(;0<=--l;)o.push(f=c[l]),f.parent=u,f.depth=u.depth+1;r&&(u.value=0),u.children=c}else r&&(u.value=+r.call(n,u,u.depth)||0),delete u.children;return oi(i,function(n){var e,i;t&&(e=n.children)&&e.sort(t),r&&(i=n.parent)&&(i.value+=n.value)}),a}var t=ci,e=ai,r=li;return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return r&&(ui(t,function(n){n.children&&(n.value=0)}),oi(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},n},ao.layout.partition=function(){function e(e,o){o=r.call(this,e,o);return function n(t,e,r,i){var u=t.children;if(t.x=e,t.y=t.depth*i,t.dx=r,t.dy=i,u&&(o=u.length)){var o,l,c=-1;for(r=t.value?r/t.value:0;++c<o;)n(l=u[c],e,l=l.value*r,i),e+=l}}(o[0],0,i[0],i[1]/function t(n){var e=n.children,r=0;if(e&&(i=e.length))for(var i,u=-1;++u<i;)r=Math.max(r,t(e[u]));return 1+r}(o[0])),o}var r=ao.layout.hierarchy(),i=[1,1];return e.size=function(n){return arguments.length?(i=n,e):i},ii(e,r)},ao.layout.pie=function(){function n(o){var a,d=o.length,c=o.map(function(e,r){return+t.call(n,e,r)}),f=+("function"==typeof r?r.apply(this,arguments):r),s=("function"==typeof i?i.apply(this,arguments):i)-f,h=Math.min(Math.abs(s)/d,+("function"==typeof u?u.apply(this,arguments):u)),p=h*(s<0?-1:1),g=ao.sum(c),v=g?(s-d*p)/g:0,d=ao.range(d),y=[];return null!=e&&d.sort(e===bl?function(n,t){return c[t]-c[n]}:function(n,t){return e(o[n],o[t])}),d.forEach(function(n){y[n]={data:o[n],value:a=c[n],startAngle:f,endAngle:f+=a*v+p,padAngle:h}}),y}var t=Number,e=bl,r=0,i=Ho,u=0;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(i=t,n):i},n.padAngle=function(t){return arguments.length?(u=t,n):u},n};var bl={};ao.layout.stack=function(){function n(a,l){if(!(h=a.length))return a;for(var h,p,v,f=(c=a.map(function(e,r){return t.call(n,e,r)})).map(function(t){return t.map(function(t,e){return[u.call(n,t,e),o.call(n,t,e)]})}),s=e.call(n,f,l),c=ao.permute(c,s),f=ao.permute(f,s),d=r.call(n,f,l),y=c[0].length,g=0;g<y;++g)for(i.call(n,c[0][g],v=d[g],f[0][g][1]),p=1;p<h;++p)i.call(n,c[p][g],v+=f[p-1][g][1],f[p][g][1]);return a}var t=m,e=gi,r=vi,i=pi,u=si,o=hi;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:_l.get(t)||gi,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:wl.get(t)||vi,n):r},n.x=function(t){return arguments.length?(u=t,n):u},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(i=t,n):i},n};var _l=ao.map({"inside-out":function(n){for(var e,r=n.length,i=n.map(di),u=n.map(yi),o=ao.range(r).sort(function(n,t){return i[n]-i[t]}),a=0,l=0,c=[],f=[],t=0;t<r;++t)e=o[t],a<l?(a+=u[e],c.push(e)):(l+=u[e],f.push(e));return f.reverse().concat(c)},reverse:function(n){return ao.range(n.length).reverse()},default:gi}),wl=ao.map({silhouette:function(n){for(var t,r,i=n.length,u=n[0].length,o=[],a=0,l=[],e=0;e<u;++e){for(r=t=0;t<i;t++)r+=n[t][e][1];a<r&&(a=r),o.push(r)}for(e=0;e<u;++e)l[e]=(a-o[e])/2;return l},wiggle:function(n){var t,e,r,i,u,o,a,l,c,f=n.length,s=n[0],h=s.length,p=[];for(p[0]=l=c=0,e=1;e<h;++e){for(i=t=0;t<f;++t)i+=n[t][e][1];for(a=s[e][u=t=0]-s[e-1][0];t<f;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);r<t;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;u+=o*n[t][e][1]}p[e]=l-=i?u/i*a:0,l<c&&(c=l)}for(e=0;e<h;++e)p[e]-=c;return p},expand:function(n){for(var t,r,i=n.length,u=n[0].length,o=1/i,a=[],e=0;e<u;++e){for(r=t=0;t<i;t++)r+=n[t][e][1];if(r)for(t=0;t<i;t++)n[t][e][1]/=r;else for(t=0;t<i;t++)n[t][e][1]=o}for(e=0;e<u;++e)a[e]=0;return a},zero:vi});ao.layout.histogram=function(){function n(n,u){for(var o,a,l=[],c=n.map(e,this),f=r.call(this,c,u),s=i.call(this,f,c,u),u=-1,h=c.length,p=s.length-1,g=t?1:1/h;++u<p;)(o=l[u]=[]).dx=s[u+1]-(o.x=s[u]),o.y=0;if(0<p)for(u=-1;++u<h;)(a=c[u])>=f[0]&&a<=f[1]&&((o=l[ao.bisect(s,a,1,p)-1]).y+=g,o.push(n[u]));return l}var t=!0,e=Number,r=bi,i=Mi;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=En(t),n):r},n.bins=function(t){return arguments.length?(i="number"==typeof t?function(n){return xi(n,t)}:En(t),n):i},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},ao.layout.pack=function(){function n(l,c){var s,o=e.call(this,l,c),a=o[0],l=i[0],c=i[1],f=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};return a.x=a.y=0,oi(a,function(n){n.r=+f(n.value)}),oi(a,Ni),r&&(s=r*(t?1:Math.max(2*a.r/l,2*a.r/c))/2,oi(a,function(n){n.r+=s}),oi(a,Ni),oi(a,function(n){n.r-=s})),function Ci(n,t,e,r){var i=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,i)for(var u=-1,o=i.length;++u<o;)Ci(i[u],t,e,r)}(a,l/2,c/2,t?1:1/Math.max(2*a.r/l,2*a.r/c)),o}var t,e=ao.layout.hierarchy().sort(_i),r=0,i=[1,1];return n.size=function(t){return arguments.length?(i=t,n):i},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},ii(n,e)},ao.layout.tree=function(){function n(s,h){var p,g,v,d,y,m,f=o.call(this,s,h),s=f[0],h=function(e){for(var t,e={A:null,children:[e]},r=[e];null!=(t=r.pop());)for(var i,u=t.children,o=0,a=u.length;o<a;++o)r.push((u[o]=i={_:u[o],parent:t,children:(i=u[o].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=i);return e.children[0]}(s);return oi(h,e),h.parent.m=-h.z,ui(h,r),c?ui(s,u):(ui(v=g=p=s,function(n){n.x<p.x&&(p=n),n.x>g.x&&(g=n),n.depth>v.depth&&(v=n)}),d=a(p,g)/2-p.x,y=l[0]/(g.x+a(g,p)/2+d),m=l[1]/(v.depth||1),ui(s,function(n){n.x=(n.x+d)*y,n.y=n.depth*m})),f}function e(n){var u=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;u.length?(function(n){for(var t,e=0,r=0,i=n.children,u=i.length;0<=--u;)(t=i[u]).z+=e,t.m+=e,e+=t.s+(r+=t.c)}(n),u=(u[0].z+u[u.length-1].z)/2,r?(n.z=r.z+a(n._,r._),n.m=n.z-u):n.z=u):r&&(n.z=r.z+a(n._,r._)),n.parent.A=function(n,t,e){if(t){for(var r,i=n,u=n,o=t,l=i.parent.children[0],c=i.m,f=u.m,s=o.m,h=l.m;o=Ti(o),i=qi(i),o&&i;)l=qi(l),(u=Ti(u)).a=n,0<(r=o.z+s-i.z-c+a(o._,i._))&&(function(n,t,e){var r=e/(t.i-n.i);t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e}(function(n,t,e){return n.a.parent===t.parent?n.a:e}(o,n,e),n,r),c+=r,f+=r),s+=o.m,c+=i.m,h+=l.m,f+=u.m;o&&!Ti(u)&&(u.t=o,u.m+=s-f),i&&!qi(l)&&(l.t=i,l.m+=c-h,e=n)}return e}(n,r,n.parent.A||e[0])}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function u(n){n.x*=l[0],n.y=n.depth*l[1]}var o=ao.layout.hierarchy().sort(null).value(null),a=Li,l=[1,1],c=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(c=null==(l=t)?u:null,n):c?null:l},n.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:u,n):c?l:null},ii(n,o)},ao.layout.cluster=function(){function n(f,s){var o,a=t.call(this,f,s),l=a[0],c=0;oi(l,function(n){var t=n.children;t&&t.length?(n.x=function(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}(t),n.y=function(n){return 1+ao.max(n,function(n){return n.y})}(t)):(n.x=o?c+=e(n,o):0,n.y=0,o=n)});var f=function Fi(n){var t=n.children;return t&&t.length?Fi(t[0]):n}(l),s=function Hi(n){var t,e=n.children;return e&&(t=e.length)?Hi(e[t-1]):n}(l),h=f.x-e(f,s)/2,p=s.x+e(s,f)/2;return oi(l,i?function(n){n.x=(n.x-l.x)*r[0],n.y=(l.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(p-h)*r[0],n.y=(1-(l.y?n.y/l.y:1))*r[1]}),a}var t=ao.layout.hierarchy().sort(null).value(null),e=Li,r=[1,1],i=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(i=null==(r=t),n):i?null:r},n.nodeSize=function(t){return arguments.length?(i=null!=(r=t),n):i?r:null},ii(n,t)},ao.layout.treemap=function(){function n(n,t){for(var e,r,i=-1,u=n.length;++i<u;)r=(e=n[i]).value*(t<0?0:t),e.area=isNaN(r)||r<=0?0:r}function t(e){var u=e.children;if(u&&u.length){var a,o,c=s(e),f=[],h=u.slice(),g=1/0,v="slice"===p?c.dx:"dice"===p?c.dy:"slice-dice"===p?1&e.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(n(h,c.dx*c.dy/e.value),f.area=0;0<(o=h.length);)f.push(o=h[o-1]),f.area+=o.area,g="squarify"!==p||(a=r(f,v))<=g?(h.pop(),a):(f.area-=f.pop().area,i(f,v,c,!1),v=Math.min(c.dx,c.dy),1/(f.length=f.area=0));f.length&&(i(f,v,c,!0),f.length=f.area=0),u.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var u,o=s(t),a=r.slice(),l=[];for(n(a,o.dx*o.dy/t.value),l.area=0;u=a.pop();)l.push(u),l.area+=u.area,null!=u.z&&(i(l,u.z?o.dx:o.dy,o,!a.length),l.length=l.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,i=0,u=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(e<u&&(u=e),i<e&&(i=e));return t*=t,(r*=r)?Math.max(t*i*g/r,r/(t*u*g)):1/0}function i(n,t,e,r){var i,u=-1,o=n.length,a=e.x,c=e.y,f=t?l(n.area/t):0;if(t==e.dx){for((r||f>e.dy)&&(f=e.dy);++u<o;)(i=n[u]).x=a,i.y=c,i.dy=f,a+=i.dx=Math.min(e.x+e.dx-a,f?l(i.area/f):0);i.z=!0,i.dx+=e.x+e.dx-a,e.y+=f,e.dy-=f}else{for((r||f>e.dx)&&(f=e.dx);++u<o;)(i=n[u]).x=a,i.y=c,i.dx=f,c+=i.dy=Math.min(e.y+e.dy-c,f?l(i.area/f):0);i.z=!1,i.dy+=e.y+e.dy-c,e.x+=f,e.dx-=f}}function u(u){var i=o||a(u),u=i[0];return u.x=u.y=0,u.value?(u.dx=c[0],u.dy=c[1]):u.dx=u.dy=0,o&&a.revalue(u),n([u],u.dx*u.dy/u.value),(o?e:t)(u),h&&(o=i),i}var o,a=ao.layout.hierarchy(),l=Math.round,c=[1,1],f=null,s=Oi,h=!1,p="squarify",g=.5*(1+Math.sqrt(5));return u.size=function(n){return arguments.length?(c=n,u):c},u.padding=function(n){function e(t){return Ii(t,n)}return arguments.length?(s=null==(f=n)?Oi:"function"==(r=typeof n)?function(t){var e=n.call(u,t,t.depth);return null==e?Oi(t):Ii(t,"number"==typeof e?[e,e,e,e]:e)}:("number"==r&&(n=[n,n,n,n]),e),u):f;var r},u.round=function(n){return arguments.length?(l=n?Math.round:Number,u):l!=Number},u.sticky=function(n){return arguments.length?(h=n,o=null,u):h},u.ratio=function(n){return arguments.length?(g=n,u):g},u.mode=function(n){return arguments.length?(p=n+"",u):p},ii(u,a)},ao.random={normal:function(n,t){var e=arguments.length;return e<2&&(t=1),e<1&&(n=0),function(){for(var e,r,i;!(i=(e=2*Math.random()-1)*e+(r=2*Math.random()-1)*r)||1<i;);return n+t*e*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var n=ao.random.normal.apply(ao,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=ao.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;e<n;e++)t+=Math.random();return t}}},ao.scale={};var Sl={floor:m,ceil:m};ao.scale.linear=function(){return function Wi(n,t,e,r){function i(){var i=2<Math.min(n.length,t.length)?Bi:Vi,l=r?Wr:Br;return o=i(n,t,l,e),a=i(t,n,l,Mr),u}function u(n){return o(n)}var o,a;return u.invert=function(n){return a(n)},u.domain=function(t){return arguments.length?(n=t.map(Number),i()):n},u.range=function(n){return arguments.length?(t=n,i()):t},u.rangeRound=function(n){return u.range(n).interpolate(Ur)},u.clamp=function(n){return arguments.length?(r=n,i()):r},u.interpolate=function(n){return arguments.length?(e=n,i()):e},u.ticks=function(t){return Qi(n,t)},u.tickFormat=function(t,e){return nu(n,t,e)},u.nice=function(t){return Gi(n,t),i()},u.copy=function(){return Wi(n,t,e,r)},i()}([0,1],[0,1],Mr,!1)};var kl={s:1,g:1,p:1,r:1,e:1};ao.scale.log=function(){return function ru(n,t,e,r){function i(n){return(e?Math.log(n<0?0:n):-Math.log(0<n?0:-n))/Math.log(t)}function u(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(i(t))}return o.invert=function(t){return u(n.invert(t))},o.domain=function(t){return arguments.length?(e=0<=t[0],n.domain((r=t.map(Number)).map(i)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(i)),o):t},o.nice=function(){var t=Xi(r.map(i),e?Math:El);return n.domain(t),r=t.map(u),o},o.ticks=function(){var n=Yi(r),o=[],a=n[0],l=n[1],c=Math.floor(i(a)),f=Math.ceil(i(l)),s=t%1?2:t;if(isFinite(f-c)){if(e){for(;c<f;c++)for(var h=1;h<s;h++)o.push(u(c)*h);o.push(u(c))}else for(o.push(u(c));c++<f;)for(h=s-1;0<h;h--)o.push(u(c)*h);for(c=0;o[c]<a;c++);for(f=o.length;o[f-1]>l;f--);o=o.slice(c,f)}return o},o.tickFormat=function(n,e){if(!arguments.length)return Nl;arguments.length<2?e=Nl:"function"!=typeof e&&(e=ao.format(e));var r=Math.max(1,t*n/o.ticks().length);return function(n){var o=n/u(Math.round(i(n)));return o*t<t-.5&&(o*=t),o<=r?e(n):""}},o.copy=function(){return ru(n.copy(),t,e,r)},Ji(o,n)}(ao.scale.linear().domain([0,1]),10,!0,[1,10])};var Nl=ao.format(".0e"),El={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};ao.scale.pow=function(){return function iu(n,t,e){function r(t){return n(i(t))}var i=uu(t),u=uu(1/t);return r.invert=function(t){return u(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(i)),r):e},r.ticks=function(n){return Qi(e,n)},r.tickFormat=function(n,t){return nu(e,n,t)},r.nice=function(n){return r.domain(Gi(e,n))},r.exponent=function(o){return arguments.length?(i=uu(t=o),u=uu(1/t),n.domain(e.map(i)),r):t},r.copy=function(){return iu(n.copy(),t,e)},Ji(r,n)}(ao.scale.linear(),1,[0,1])},ao.scale.sqrt=function(){return ao.scale.pow().exponent(.5)},ao.scale.ordinal=function(){return function ou(n,t){function e(e){return u[((i.get(e)||("range"===t.t?i.set(e,n.push(e)):NaN))-1)%u.length]}function r(t,e){return ao.range(n.length).map(function(n){return t+e*n})}var i,u,o;return e.domain=function(r){if(!arguments.length)return n;n=[],i=new c;for(var u,o=-1,a=r.length;++o<a;)i.has(u=r[o])||i.set(u,n.push(u));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(u=n,o=0,t={t:"range",a:arguments},e):u},e.rangePoints=function(i,a){arguments.length<2&&(a=0);var l=i[0],f=i[1],f=n.length<2?(l=(l+f)/2,0):(f-l)/(n.length-1+a);return u=r(l+f*a/2,f),o=0,t={t:"rangePoints",a:arguments},e},e.rangeRoundPoints=function(i,a){arguments.length<2&&(a=0);var l=i[0],c=i[1],f=n.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(n.length-1+a)|0;return u=r(l+Math.round(f*a/2+(c-l-(n.length-1+a)*f)/2),f),o=0,t={t:"rangeRoundPoints",a:arguments},e},e.rangeBands=function(i,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var c=i[1]<i[0],f=i[+c],h=(i[1-c]-f)/(n.length-a+2*l);return u=r(f+h*l,h),c&&u.reverse(),o=h*(1-a),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(i,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var c=i[1]<i[0],f=i[+c],s=i[1-c],h=Math.floor((s-f)/(n.length-a+2*l));return u=r(f+Math.round((s-f-(n.length-a)*h)/2),h),c&&u.reverse(),o=Math.round(h*(1-a)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return Yi(t.a[0])},e.copy=function(){return ou(n,t)},e.domain(n)}([],{t:"range",a:[[]]})},ao.scale.category10=function(){return ao.scale.ordinal().range(Al)},ao.scale.category20=function(){return ao.scale.ordinal().range(Cl)},ao.scale.category20b=function(){return ao.scale.ordinal().range(zl)},ao.scale.category20c=function(){return ao.scale.ordinal().range(Ll)};var Al=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(xn),Cl=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(xn),zl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(xn),Ll=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(xn);ao.scale.quantile=function(){return function au(n,t){function u(){var e=0,r=t.length;for(a=[];++e<r;)a[e-1]=ao.quantile(n,e/r);return o}function o(n){return isNaN(n=+n)?void 0:t[ao.bisect(a,n)]}var a;return o.domain=function(t){return arguments.length?(n=t.map(r).filter(i).sort(e),u()):n},o.range=function(n){return arguments.length?(t=n,u()):t},o.quantiles=function(){return a},o.invertExtent=function(e){return(e=t.indexOf(e))<0?[NaN,NaN]:[0<e?a[e-1]:n[0],e<a.length?a[e]:n[n.length-1]]},o.copy=function(){return au(n,t)},u()}([],[])},ao.scale.quantize=function(){return function lu(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(u*(t-n))))]}function i(){return u=e.length/(t-n),o=e.length-1,r}var u,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],i()):[n,t]},r.range=function(n){return arguments.length?(e=n,i()):e},r.invertExtent=function(t){return[t=(t=e.indexOf(t))<0?NaN:t/u+n,t+1/u]},r.copy=function(){return lu(n,t,e)},i()}(0,1,[0,1])},ao.scale.threshold=function(){return function cu(n,t){function e(e){return e<=e?t[ao.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return cu(n,t)},e}([.5],[0,1])},ao.scale.identity=function(){return function fu(n){function t(n){return+n}return(t.invert=t).domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Qi(n,t)},t.tickFormat=function(t,e){return nu(n,t,e)},t.copy=function(){return fu(n)},t}([0,1])},ao.svg={},ao.svg.arc=function(){function n(){var n=Math.max(0,+e.apply(this,arguments)),c=Math.max(0,+r.apply(this,arguments)),O=o.apply(this,arguments)-Io,P=a.apply(this,arguments)-Io,j=Math.abs(P-O),p=P<O?0:1;if(c<n&&(g=c,c=n,n=g),Oo<=j)return t(c,p)+(n?t(n,1-p):"")+"Z";var g,d,y,b,C,m,M,x,k,L,_,w,S,U,I,Z,V,R=0,v=0,A=[];return(y=(+l.apply(this,arguments)||0)/2)&&(d=u===ql?Math.sqrt(n*n+c*c):+u.apply(this,arguments),p||(v*=-1),c&&(v=tn(d/c*Math.sin(y))),n&&(R=tn(d/n*Math.sin(y)))),c?(m=c*Math.cos(O+v),M=c*Math.sin(O+v),x=c*Math.cos(P-v),b=c*Math.sin(P-v),C=Math.abs(P-O-2*v)<=Fo?0:1,v&&yu(m,M,x,b)===p^C&&(Z=(O+P)/2,m=c*Math.cos(Z),M=c*Math.sin(Z),x=b=null)):m=M=0,n?(_=n*Math.cos(P-R),w=n*Math.sin(P-R),S=n*Math.cos(O+R),k=n*Math.sin(O+R),L=Math.abs(O-P+2*R)<=Fo?0:1,R&&yu(_,w,S,k)===1-p^L&&(U=(O+P)/2,_=n*Math.cos(U),w=n*Math.sin(U),S=k=null)):_=w=0,Uo<j&&.001<(g=Math.min(Math.abs(c-n)/2,+i.apply(this,arguments)))?(v=n<c^p?0:1,R=Z=g,j<Fo&&(P=m-(O=null==S?[_,w]:null==x?[m,M]:Re([m,M],[S,k],[x,b],[_,w]))[0],U=M-O[1],j=x-O[0],I=b-O[1],I=1/Math.sin(Math.acos((P*j+U*I)/(Math.sqrt(P*P+U*U)*Math.sqrt(j*j+I*I)))/2),O=Math.sqrt(O[0]*O[0]+O[1]*O[1]),R=Math.min(g,(n-O)/(I-1)),Z=Math.min(g,(c-O)/(1+I))),null!=x?(I=mu(null==S?[_,w]:[S,k],[m,M],c,Z,p),V=mu([x,b],[_,w],c,Z,p),g===Z?A.push("M",I[0],"A",Z,",",Z," 0 0,",v," ",I[1],"A",c,",",c," 0 ",1-p^yu(I[1][0],I[1][1],V[1][0],V[1][1]),",",p," ",V[1],"A",Z,",",Z," 0 0,",v," ",V[0]):A.push("M",I[0],"A",Z,",",Z," 0 1,",v," ",V[0])):A.push("M",m,",",M),null!=S?(Z=mu([m,M],[S,k],n,-R,p),V=mu([_,w],null==x?[m,M]:[x,b],n,-R,p),g===R?A.push("L",V[0],"A",R,",",R," 0 0,",v," ",V[1],"A",n,",",n," 0 ",p^yu(V[1][0],V[1][1],Z[1][0],Z[1][1]),",",1-p," ",Z[1],"A",R,",",R," 0 0,",v," ",Z[0]):A.push("L",V[0],"A",R,",",R," 0 0,",v," ",Z[0])):A.push("L",_,",",w)):(A.push("M",m,",",M),null!=x&&A.push("A",c,",",c," 0 ",C,",",p," ",x,",",b),A.push("L",_,",",w),null!=S&&A.push("A",n,",",n," 0 ",L,",",1-p," ",S,",",k)),A.push("Z"),A.join("")}function t(n,t){return"M0,"+n+"A"+n+","+n+" 0 1,"+t+" 0,"+-n+"A"+n+","+n+" 0 1,"+t+" 0,"+n}var e=hu,r=pu,i=su,u=ql,o=gu,a=vu,l=du;return n.innerRadius=function(t){return arguments.length?(e=En(t),n):e},n.outerRadius=function(t){return arguments.length?(r=En(t),n):r},n.cornerRadius=function(t){return arguments.length?(i=En(t),n):i},n.padRadius=function(t){return arguments.length?(u=t==ql?ql:En(t),n):u},n.startAngle=function(t){return arguments.length?(o=En(t),n):o},n.endAngle=function(t){return arguments.length?(a=En(t),n):a},n.padAngle=function(t){return arguments.length?(l=En(t),n):l},n.centroid=function(){var n=(+e.apply(this,arguments)+ +r.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Io;return[Math.cos(t)*n,Math.sin(t)*n]},n};var ql="auto";ao.svg.line=function(){return Mu(m)};var Tl=ao.map({linear:xu,"linear-closed":bu,step:function(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return 1<e&&i.push("H",r[0]),i.join("")},"step-before":wu,"step-after":Su,basis:zu,"basis-open":function(n){if(n.length<4)return xu(n);for(var t,e=[],r=-1,i=n.length,u=[0],o=[0];++r<3;)t=n[r],u.push(t[0]),o.push(t[1]);for(e.push(Ru(Pl,u)+","+Ru(Pl,o)),--r;++r<i;)t=n[r],u.shift(),u.push(t[0]),o.shift(),o.push(t[1]),Du(e,u,o);return e.join("")},"basis-closed":function(n){for(var t,e,r=-1,i=n.length,u=i+4,o=[],a=[];++r<4;)e=n[r%i],o.push(e[0]),a.push(e[1]);for(t=[Ru(Pl,o),",",Ru(Pl,a)],--r;++r<u;)e=n[r%i],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Du(t,o,a);return t.join("")},bundle:function(n,t){var e=n.length-1;if(e)for(var r,i,u=n[0][0],o=n[0][1],a=n[e][0]-u,l=n[e][1]-o,c=-1;++c<=e;)(r=n[c])[0]=t*r[0]+(1-t)*(u+(i=c/e)*a),r[1]=t*r[1]+(1-t)*(o+i*l);return zu(n)},cardinal:function(n,t){return n.length<3?xu(n):n[0]+Au(n,Cu(n,t))},"cardinal-open":function(n,t){return n.length<4?xu(n):n[1]+Au(n.slice(1,-1),Cu(n,t))},"cardinal-closed":function(n,t){return n.length<3?bu(n):n[0]+Au((n.push(n[0]),n),Cu([n[n.length-2]].concat(n,[n[1]]),t))},monotone:function(n){return n.length<3?xu(n):n[0]+Au(n,ju(n))}});Tl.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var Rl=[0,2/3,1/3,0],Dl=[0,1/3,2/3,0],Pl=[0,1/6,2/3,1/6];ao.svg.line.radial=function(){var n=Mu(Hu);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},(wu.reverse=Su).reverse=wu,ao.svg.area=function(){return Ou(m)},ao.svg.area.radial=function(){var n=Ou(Hu);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},ao.svg.chord=function(){function n(n,c){var l=t(this,u,n,c),c=t(this,o,n,c);return"M"+l.p0+r(l.r,l.p1,l.a1-l.a0)+(function(n,t){return n.a0==t.a0&&n.a1==t.a1}(l,c)?i(l.r,l.p1,l.r,l.p0):i(l.r,l.p1,c.r,c.p0)+r(c.r,c.p1,c.a1-c.a0)+i(c.r,c.p1,l.r,l.p0))+"Z"}function t(n,u,o,f){var i=u.call(n,o,f),u=a.call(n,i,f),o=l.call(n,i,f)-Io,f=c.call(n,i,f)-Io;return{r:u,a0:o,a1:f,p0:[u*Math.cos(o),u*Math.sin(o)],p1:[u*Math.cos(f),u*Math.sin(f)]}}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(Fo<e)+",1 "+t}function i(n,t,e,r){return"Q 0,0 "+r}var u=Me,o=xe,a=Iu,l=gu,c=vu;return n.radius=function(t){return arguments.length?(a=En(t),n):a},n.source=function(t){return arguments.length?(u=En(t),n):u},n.target=function(t){return arguments.length?(o=En(t),n):o},n.startAngle=function(t){return arguments.length?(l=En(t),n):l},n.endAngle=function(t){return arguments.length?(c=En(t),n):c},n},ao.svg.diagonal=function(){function n(l,a){var u=t.call(this,l,a),l=e.call(this,l,a),a=(u.y+l.y)/2,l=[u,{x:u.x,y:a},{x:l.x,y:a},l];return"M"+(l=l.map(r))[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=Me,e=xe,r=Yu;return n.source=function(e){return arguments.length?(t=En(e),n):t},n.target=function(t){return arguments.length?(e=En(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},ao.svg.diagonal.radial=function(){var n=ao.svg.diagonal(),t=Yu,e=n.projection;return n.projection=function(n){return arguments.length?e(function(n){return function(){var r=n.apply(this,arguments),e=r[0],r=r[1]-Io;return[e*Math.cos(r),e*Math.sin(r)]}}(t=n)):t},n},ao.svg.symbol=function(){function n(n,r){return(Ul.get(t.call(this,n,r))||$u)(e.call(this,n,r))}var t=Xu,e=Vu;return n.type=function(e){return arguments.length?(t=En(e),n):t},n.size=function(t){return arguments.length?(e=En(t),n):e},n};var Ul=ao.map({circle:$u,cross:function(t){t=Math.sqrt(t/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Fl)),e=t*Fl;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(t){t=Math.sqrt(t)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/jl),e=t*jl/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/jl),e=t*jl/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});ao.svg.symbolTypes=Ul.keys();var jl=Math.sqrt(3),Fl=Math.tan(30*Yo);Co.transition=function(n){for(var t,e,r=Hl||++Zl,i=Ku(n),u=[],o=Ol||{time:Date.now(),ease:Nr,delay:0,duration:250},a=-1,l=this.length;++a<l;){u.push(t=[]);for(var c=this[a],f=-1,s=c.length;++f<s;)(e=c[f])&&Qu(e,f,i,r,o),t.push(e)}return Wu(u,i,r)},Co.interrupt=function(n){return this.each(null==n?Il:Bu(Ku(n)))};var Hl,Ol,Il=Bu(Ku()),Yl=[],Zl=0;Yl.call=Co.call,Yl.empty=Co.empty,Yl.node=Co.node,Yl.size=Co.size,ao.transition=function(n,t){return n&&n.transition?Hl?n.transition(t):n:ao.selection().transition(n)},(ao.transition.prototype=Yl).select=function(n){var t,e,r,i=this.id,u=this.namespace,o=[];n=A(n);for(var a=-1,l=this.length;++a<l;){o.push(t=[]);for(var c=this[a],f=-1,s=c.length;++f<s;)(r=c[f])&&(e=n.call(r,r.__data__,f,a))?("__data__"in r&&(e.__data__=r.__data__),Qu(e,f,u,i,r[u][i]),t.push(e)):t.push(null)}return Wu(o,u,i)},Yl.selectAll=function(n){var t,e,r,i,u,o=this.id,a=this.namespace,l=[];n=C(n);for(var c=-1,f=this.length;++c<f;)for(var s=this[c],h=-1,p=s.length;++h<p;)if(r=s[h]){u=r[a][o],e=n.call(r,r.__data__,h,c),l.push(t=[]);for(var g=-1,v=e.length;++g<v;)(i=e[g])&&Qu(i,g,a,o,u),t.push(i)}return Wu(l,a,o)},Yl.filter=function(n){var t,r,i=[];"function"!=typeof n&&(n=O(n));for(var u=0,o=this.length;u<o;u++){i.push(t=[]);for(var e,a=0,l=(e=this[u]).length;a<l;a++)(r=e[a])&&n.call(r,r.__data__,a,u)&&t.push(r)}return Wu(i,this.namespace,this.id)},Yl.tween=function(n,t){var e=this.id,r=this.namespace;return arguments.length<2?this.node()[r][e].tween.get(n):Y(this,null==t?function(t){t[r][e].tween.remove(n)}:function(i){i[r][e].tween.set(n,t)})},Yl.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?$r:Mr,a=ao.ns.qualify(n);return Ju(this,"attr."+n,t,a.local?function(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}:function(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})})},Yl.attrTween=function(n,t){var i=ao.ns.qualify(n);return this.tween("attr."+n,i.local?function(n,e){var r=t.call(this,n,e,this.getAttributeNS(i.space,i.local));return r&&function(n){this.setAttributeNS(i.space,i.local,r(n))}}:function(n,e){var r=t.call(this,n,e,this.getAttribute(i));return r&&function(n){this.setAttribute(i,r(n))}})},Yl.style=function(n,e,r){function i(){this.style.removeProperty(n)}var o=arguments.length;if(o<3){if("string"!=typeof n){for(r in o<2&&(e=""),n)this.style(r,n[r],e);return this}r=""}return Ju(this,"style."+n,e,function(e){return null==e?i:(e+="",function(){var i,u=t(this).getComputedStyle(this,null).getPropertyValue(n);return u!==e&&(i=Mr(u,e),function(t){this.style.setProperty(n,i(t),r)})})})},Yl.styleTween=function(n,e,r){return arguments.length<3&&(r=""),this.tween("style."+n,function(i,u){var o=e.call(this,i,u,t(this).getComputedStyle(this,null).getPropertyValue(n));return o&&function(t){this.style.setProperty(n,o(t),r)}})},Yl.text=function(n){return Ju(this,"text",n,Gu)},Yl.remove=function(){var n=this.namespace;return this.each("end.transition",function(){var t;this[n].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Yl.ease=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].ease:("function"!=typeof n&&(n=ao.ease.apply(ao,arguments)),Y(this,function(r){r[e][t].ease=n}))},Yl.delay=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].delay:Y(this,"function"==typeof n?function(r,i,u){r[e][t].delay=+n.call(r,r.__data__,i,u)}:(n=+n,function(r){r[e][t].delay=n}))},Yl.duration=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].duration:Y(this,"function"==typeof n?function(r,i,u){r[e][t].duration=Math.max(1,n.call(r,r.__data__,i,u))}:(n=Math.max(1,n),function(r){r[e][t].duration=n}))},Yl.each=function(n,t){var e=this.id,r=this.namespace;if(arguments.length<2){var i=Ol,u=Hl;try{Hl=e,Y(this,function(t,i,u){Ol=t[r][e],n.call(t,t.__data__,i,u)})}finally{Ol=i,Hl=u}}else Y(this,function(u){u=u[r][e];(u.event||(u.event=ao.dispatch("start","end","interrupt"))).on(n,t)});return this},Yl.transition=function(){for(var n,e,r,i=this.id,u=++Zl,o=this.namespace,a=[],l=0,c=this.length;l<c;l++){a.push(n=[]);for(var t,f=0,s=(t=this[l]).length;f<s;f++)(e=t[f])&&Qu(e,f,o,u,{time:(r=e[o][i]).time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration}),n.push(e)}return Wu(a,o,u)},ao.svg.axis=function(){function n(n){n.each(function(){var n,C=ao.select(this),f=this.__chart__||e,s=this.__chart__=e.copy(),A=null==l?s.ticks?s.ticks.apply(s,a):s.domain():l,q=null==t?s.tickFormat?s.tickFormat.apply(s,a):m:t,L=C.selectAll(".tick").data(A,s),v=L.enter().insert("g",".domain").attr("class","tick").style("opacity",Uo),d=ao.transition(L.exit()).style("opacity",Uo).remove(),y=ao.transition(L.order()).style("opacity",1),M=Math.max(i,0)+o,x=Zi(s),z=C.selectAll(".domain").data([0]),_=(z.enter().append("path").attr("class","domain"),ao.transition(z));v.append("line"),v.append("text");var w,S,k,N,T,R,E=v.select("line"),A=y.select("line"),C=L.select("text").text(q),z=v.select("text"),L=y.select("text"),q="top"===r||"left"===r?-1:1;"bottom"===r||"top"===r?(n=no,w="x",k="y",S="x2",N="y2",C.attr("dy",q<0?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+x[0]+","+q*u+"V0H"+x[1]+"V"+q*u)):(n=to,w="y",k="x",S="y2",N="x2",C.attr("dy",".32em").style("text-anchor",q<0?"end":"start"),_.attr("d","M"+q*u+","+x[0]+"H0V"+x[1]+"H"+q*u)),E.attr(N,q*i),z.attr(k,q*M),A.attr(S,0).attr(N,q*i),L.attr(w,0).attr(k,q*M),s.rangeBand?(R=(T=s).rangeBand()/2,f=s=function(n){return T(n)+R}):f.rangeBand?f=s:d.call(n,s,f),v.call(n,f,s),y.call(n,s,s)})}var t,e=ao.scale.linear(),r=Vl,i=6,u=6,o=3,a=[10],l=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Xl?t+"":Vl,n):r},n.ticks=function(){return arguments.length?(a=co(arguments),n):a},n.tickValues=function(t){return arguments.length?(l=t,n):l},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(i=+t,u=+arguments[e-1],n):i},n.innerTickSize=function(t){return arguments.length?(i=+t,n):i},n.outerTickSize=function(t){return arguments.length?(u=+t,n):u},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Vl="bottom",Xl={top:1,right:1,bottom:1,left:1};ao.svg.brush=function(){function n(t){t.each(function(){var s=ao.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),h=s.selectAll(".background").data([0]);h.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),s.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=s.selectAll(".resize").data(v,m);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return $l[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var l,s=ao.transition(s),h=ao.transition(h);c&&(l=Zi(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),r(s)),f&&(l=Zi(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(s)),e(s)})}function e(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+s[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function r(n){n.select(".extent").attr("x",s[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",s[1]-s[0])}function i(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function u(){function d(){var n=ao.mouse(b),t=!1;x&&(n[0]+=x[0],n[1]+=x[1]),C||(ao.event.altKey?(M=M||[(s[0]+s[1])/2,(h[0]+h[1])/2],L[0]=s[+(n[0]<M[0])],L[1]=h[+(n[1]<M[1])]):M=null),E&&y(n,c,0)&&(r(k),t=!0),A&&y(n,f,1)&&(i(k),t=!0),t&&(e(k),w({type:"brush",mode:C?"move":"resize"}))}function y(r,v,e){var i,d=Zi(v),l=d[0],c=d[1],f=L[e],v=e?h:s,d=v[1]-v[0];return C&&(l-=f,c-=d+f),r=(e?g:p)?Math.max(l,Math.min(c,r[e])):r[e],C?i=(r+=f)+d:(f=M?Math.max(l,Math.min(c,2*M[e]-r)):f)<r?(i=r,r=f):i=f,(v[0]!=r||v[1]!=i)&&(e?a=null:o=null,v[0]=r,v[1]=i,1)}function m(){d(),k.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),ao.select("body").style("cursor",null),q.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),z(),w({type:"brushend"})}var M,T,x,b=this,_=ao.select(ao.event.target),w=l.of(b,arguments),k=ao.select(b),R=_.datum(),E=!/^(n|s)$/.test(R)&&c,A=!/^(e|w)$/.test(R)&&f,C=_.classed("extent"),z=W(b),L=ao.mouse(b),q=ao.select(t(b)).on("keydown.brush",function(){32==ao.event.keyCode&&(C||(M=null,L[0]-=s[1],L[1]-=h[1],C=2),S())}).on("keyup.brush",function(){32==ao.event.keyCode&&2==C&&(L[0]+=s[1],L[1]+=h[1],C=0,S())});ao.event.changedTouches?q.on("touchmove.brush",d).on("touchend.brush",m):q.on("mousemove.brush",d).on("mouseup.brush",m),k.interrupt().selectAll("*").interrupt(),C?(L[0]=s[0]-L[0],L[1]=h[0]-L[1]):R?(T=+/w$/.test(R),R=+/^n/.test(R),x=[s[1-T]-L[0],h[1-R]-L[1]],L[0]=s[T],L[1]=h[R]):ao.event.altKey&&(M=L.slice()),k.style("pointer-events","none").selectAll(".resize").style("display",null),ao.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),d()}var o,a,l=N(n,"brushstart","brush","brushend"),c=null,f=null,s=[0,0],h=[0,0],p=!0,g=!0,v=Bl[0];return n.event=function(n){n.each(function(){var n=l.of(this,arguments),t={x:s,y:h,i:o,j:a},e=this.__chart__||t;this.__chart__=t,Hl?ao.select(this).transition().each("start.brush",function(){o=e.i,a=e.j,s=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=xr(s,t.x),r=xr(h,t.y);return o=a=null,function(i){s=t.x=e(i),h=t.y=r(i),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=t.i,a=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(v=Bl[!(c=t)<<1|!f],n):c},n.y=function(t){return arguments.length?(v=Bl[!c<<1|!(f=t)],n):f},n.clamp=function(t){return arguments.length?(c&&f?(p=!!t[0],g=!!t[1]):c?p=!!t:f&&(g=!!t),n):c&&f?[p,g]:c?p:f?g:null},n.extent=function(t){var e,r,i,u,l;return arguments.length?(c&&(e=t[0],r=t[1],f&&(e=e[0],r=r[0]),o=[e,r],c.invert&&(e=c(e),r=c(r)),r<e&&(l=e,e=r,r=l),e==s[0]&&r==s[1]||(s=[e,r])),f&&(i=t[0],u=t[1],c&&(i=i[1],u=u[1]),a=[i,u],f.invert&&(i=f(i),u=f(u)),u<i&&(l=i,i=u,u=l),i==h[0]&&u==h[1]||(h=[i,u])),n):(c&&(o?(e=o[0],r=o[1]):(e=s[0],r=s[1],c.invert&&(e=c.invert(e),r=c.invert(r)),r<e&&(l=e,e=r,r=l))),f&&(a?(i=a[0],u=a[1]):(i=h[0],u=h[1],f.invert&&(i=f.invert(i),u=f.invert(u)),u<i&&(l=i,i=u,u=l))),c&&f?[[e,i],[r,u]]:c?[e,r]:f&&[i,u])},n.clear=function(){return n.empty()||(s=[0,0],h=[0,0],o=a=null),n},n.empty=function(){return!!c&&s[0]==s[1]||!!f&&h[0]==h[1]},ao.rebind(n,l,"on")};var $l={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Bl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Wl=ga.format=Gl.timeFormat,Jl=Wl.utc,Gl=Jl("%Y-%m-%dT%H:%M:%S.%LZ");Wl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?eo:Gl,eo.parse=function(t){t=new Date(t);return isNaN(t)?null:t},eo.toString=Gl.toString,ga.second=On(function(n){return new va(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ga.seconds=ga.second.range,ga.seconds.utc=ga.second.utc.range,ga.minute=On(function(n){return new va(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ga.minutes=ga.minute.range,ga.minutes.utc=ga.minute.utc.range,ga.hour=On(function(n){var t=n.getTimezoneOffset()/60;return new va(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ga.hours=ga.hour.range,ga.hours.utc=ga.hour.utc.range,ga.month=On(function(n){return(n=ga.day(n)).setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ga.months=ga.month.range,ga.months.utc=ga.month.utc.range;var Kl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Ql=[[ga.second,1],[ga.second,5],[ga.second,15],[ga.second,30],[ga.minute,1],[ga.minute,5],[ga.minute,15],[ga.minute,30],[ga.hour,1],[ga.hour,3],[ga.hour,6],[ga.hour,12],[ga.day,1],[ga.day,2],[ga.week,1],[ga.month,1],[ga.month,3],[ga.year,1]],nc=Wl.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",zt]]),tc={range:function(n,t,e){return ao.range(Math.ceil(n/e)*e,+t,e).map(io)},floor:m,ceil:m};Ql.year=ga.year,ga.scale=function(){return ro(ao.scale.linear(),Ql,nc)};var ec=Ql.map(function(n){return[n[0].utc,n[1]]}),rc=Jl.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",zt]]);ec.year=ga.year.utc,ga.scale.utc=function(){return ro(ao.scale.linear(),ec,rc)},ao.text=An(function(n){return n.responseText}),ao.json=function(n,t){return Cn(n,"application/json",uo,t)},ao.html=function(n,t){return Cn(n,"text/html",oo,t)},ao.xml=An(function(n){return n.responseXML}),"function"==typeof define&&define.amd?(this.d3=ao,define(ao)):"object"==typeof module&&module.exports?module.exports=ao:this.d3=ao}(),function($){var o=$({});$.subscribe=function(){o.on.apply(o,arguments)},$.unsubscribe=function(){o.off.apply(o,arguments)},$.publish=function(){o.trigger.apply(o,arguments)}}(jQuery),function(r,x){"object"==typeof module&&module.exports?module.exports=x():"function"==typeof define&&define.amd?define(x):r.IPv6=x(r)}(this,function(r){var x=r&&r.IPv6;return{best:function(k){var m=(k=k.toLowerCase().split(":")).length,d=8;for(""===k[0]&&""===k[1]&&""===k[2]?(k.shift(),k.shift()):""===k[0]&&""===k[1]?k.shift():""===k[m-1]&&""===k[m-2]&&k.pop(),-1!==k[(m=k.length)-1].indexOf(".")&&(d=7),q=0;q<m&&""!==k[q];q++);if(q<d)for(k.splice(q,1,"0000");k.length<d;)k.splice(q,0,"0000");for(q=0;q<d;q++){for(var m=k[q].split(""),E=0;E<3&&("0"===m[0]&&1<m.length);E++)m.splice(0,1);k[q]=m.join("")}for(var A=E=0,h=m=-1,p=!1,q=0;q<d;q++)p?"0"===k[q]?A+=1:(p=!1,E<A&&(m=h,E=A)):"0"===k[q]&&(p=!0,h=q,A=1);for(E<A&&(m=h,E=A),1<E&&k.splice(m,E,""),m=k.length,(d="")===k[0]&&(d=":"),q=0;q<m&&(d+=k[q],q!==m-1);q++)d+=":";return""===k[m-1]&&(d+=":"),d},noConflict:function(){return r.IPv6===this&&(r.IPv6=x),this}}}),function(r){function x(l){throw new RangeError(H[l])}function k(l,t){for(var C=l.length,y=[];C--;)y[C]=t(l[C]);return y}function m(l,t){var C=l.split("@"),y="";return 1<C.length&&(y=C[0]+"@",l=C[1]),y+(C=k(C=(l=l.replace(w,".")).split("."),t).join("."))}function d(l){for(var J,M,t=[],C=0,y=l.length;C<y;)55296<=(J=l.charCodeAt(C++))&&J<=56319&&C<y?56320==(64512&(M=l.charCodeAt(C++)))?t.push(((1023&J)<<10)+(1023&M)+65536):(t.push(J),C--):t.push(J);return t}function q(l){return k(l,function(t){var C="";return 65535<t&&(C+=g((t-=65536)>>>10&1023|55296),t=56320|1023&t),C+g(t)}).join("")}function E(l,t,C){var y=0;for(l=C?v(l/700):l>>1,l+=v(l/t);455<l;y+=36)l=v(l/35);return v(y+36*l/(l+38))}function A(l){var t=[],C=l.length,y=0,J=128,M=72,c=l.lastIndexOf("-");for(c<0&&(c=0),a=0;a<c;++a)128<=l.charCodeAt(a)&&x("not-basic"),t.push(l.charCodeAt(a));for(c=0<c?c+1:0;c<C;){for(var a=y,e=1,b=36;;b+=36){C<=c&&x("invalid-input");var f=l.charCodeAt(c++);(36<=(f=f-48<10?f-22:f-65<26?f-65:f-97<26?f-97:36)||f>v((2147483647-y)/e))&&x("overflow"),y+=f*e;var n=b<=M?1:M+26<=b?26:b-M;if(f<n)break;e>v(2147483647/(f=36-n))&&x("overflow"),e*=f}M=E(y-a,e=t.length+1,0==a),v(y/e)>2147483647-J&&x("overflow"),J+=v(y/e),y%=e,t.splice(y++,0,J)}return q(t)}function h(l){var t,C,J=[],M=(l=d(l)).length,a=128,b=0,c=72;for(y=0;y<M;++y){var e=l[y];e<128&&J.push(g(e))}for((t=C=J.length)&&J.push("-");t<M;){for(var f=2147483647,y=0;y<M;++y)a<=(e=l[y])&&e<f&&(f=e);var n=t+1;for(f-a>v((2147483647-b)/n)&&x("overflow"),b+=(f-a)*n,a=f,y=0;y<M;++y)if((e=l[y])<a&&2147483647<++b&&x("overflow"),e==a){for(var z=b,f=36;!(z<(e=f<=c?1:c+26<=f?26:f-c));f+=36){var I=z-e,L=J;e+=I%(z=36-e),L.push.call(L,g(+(e+22+75*(e<26)))),z=v(I/z)}J.push(g(+(z+22+75*(z<26)))),c=E(b,n,t==C),b=0,++t}++b,++a}return J.join("")}var p="object"==typeof exports&&exports&&!exports.nodeType&&exports,D="object"==typeof module&&module&&!module.nodeType&&module,u="object"==typeof global&&global;u.global!==u&&u.window!==u&&u.self!==u||(r=u);var B,K=/^xn--/,F=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=Math.floor,g=String.fromCharCode,G={version:"1.3.2",ucs2:{decode:d,encode:q},decode:A,encode:h,toASCII:function(l){return m(l,function(t){return F.test(t)?"xn--"+h(t):t})},toUnicode:function(l){return m(l,function(t){return K.test(t)?A(t.slice(4).toLowerCase()):t})}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return G});else if(p&&D)if(module.exports==p)D.exports=G;else for(B in G)G.hasOwnProperty(B)&&(p[B]=G[B]);else r.punycode=G}(this),function(r,x){"object"==typeof module&&module.exports?module.exports=x():"function"==typeof define&&define.amd?define(x):r.SecondLevelDomains=x(r)}(this,function(r){var x=r&&r.SecondLevelDomains,k={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(m){var d=m.lastIndexOf(".");if(d<=0||d>=m.length-1)return!1;var q=m.lastIndexOf(".",d-1);if(q<=0||d-1<=q)return!1;var E=k.list[m.slice(d+1)];return!!E&&0<=E.indexOf(" "+m.slice(q+1,d)+" ")},is:function(m){var d=m.lastIndexOf(".");if(d<=0||d>=m.length-1||0<=m.lastIndexOf(".",d-1))return!1;var q=k.list[m.slice(d+1)];return!!q&&0<=q.indexOf(" "+m.slice(0,d)+" ")},get:function(m){var d=m.lastIndexOf(".");if(d<=0||d>=m.length-1)return null;var q=m.lastIndexOf(".",d-1);if(q<=0||d-1<=q)return null;var E=k.list[m.slice(d+1)];return!E||E.indexOf(" "+m.slice(q+1,d)+" ")<0?null:m.slice(q+1)},noConflict:function(){return r.SecondLevelDomains===this&&(r.SecondLevelDomains=x),this}};return k}),function(r,x){"object"==typeof module&&module.exports?module.exports=x(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],x):r.URI=x(r.punycode,r.IPv6,r.SecondLevelDomains,r)}(this,function(r,x,k,m){function d(a,b){var c=1<=arguments.length;if(!(this instanceof d))return c?2<=arguments.length?new d(a,b):new d(a):new d;if(void 0===a){if(c)throw new TypeError("undefined is not a valid argument for URI");a="undefined"!=typeof location?location.href+"":""}if(null===a&&c)throw new TypeError("null is not a valid argument for URI");return this.href(a),void 0!==b?this.absoluteTo(b):this}function q(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function E(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function A(a){return"Array"===E(a)}function h(a,b){var c={};if("RegExp"===E(b))c=null;else if(A(b))for(var f=0,e=b.length;f<e;f++)c[b[f]]=!0;else c[b]=!0;for(f=0,e=a.length;f<e;f++)(c&&void 0!==c[a[f]]||!c&&b.test(a[f]))&&(a.splice(f,1),e--,f--);return a}function p(a,b){if(A(b)){for(var e=0,c=b.length;e<c;e++)if(!p(a,b[e]))return!1;return!0}var f=E(b),e=0;for(c=a.length;e<c;e++)if("RegExp"===f){if("string"==typeof a[e]&&a[e].match(b))return!0}else if(a[e]===b)return!0;return!1}function D(a,b){if(!A(a)||!A(b)||a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,e=a.length;c<e;c++)if(a[c]!==b[c])return!1;return!0}function u(a){return a.replace(/^\/+|\/+$/g,"")}function K(a){return escape(a)}function F(a){return encodeURIComponent(a).replace(/[!'()*]/g,K).replace(/\*/g,"%2A")}function w(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function H(a,b){return function(c,e){return void 0===c?this._parts[a]||"":(null!==c&&((c+="").charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!e),this)}}var v=m&&m.URI;d.version="1.19.7";var g=d.prototype,B=Object.prototype.hasOwnProperty;d._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:d.preventInvalidHostname,duplicateQueryParameters:d.duplicateQueryParameters,escapeQuerySpace:d.escapeQuerySpace}},d.preventInvalidHostname=!1,d.duplicateQueryParameters=!1,d.escapeQuerySpace=!0,d.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,d.idn_expression=/[^a-z0-9\._-]/i,d.punycode_expression=/(xn--)/i,d.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,d.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,d.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/gi,d.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},d.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},d.hostProtocols=["http","https"],d.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,d.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},d.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();if("input"!==b||"image"===a.type)return d.domAttributes[b]}},d.encode=F,d.decode=decodeURIComponent,d.iso8859=function(){d.encode=escape,d.decode=unescape},d.unicode=function(){d.encode=F,d.decode=decodeURIComponent},d.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},d.encodeQuery=function(c,b){c=d.encode(c+"");return(b=void 0===b?d.escapeQuerySpace:b)?c.replace(/%20/g,"+"):c},d.decodeQuery=function(a,b){a+="",void 0===b&&(b=d.escapeQuerySpace);try{return d.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}};function t(a,b){return function(c){try{return d[b](c+"").replace(d.characters[a][b].expression,function(e){return d.characters[a][b].map[e]})}catch(e){return c}}}var l,G={encode:"encode",decode:"decode"};for(l in G)d[l+"PathSegment"]=t("pathname",G[l]),d[l+"UrnPathSegment"]=t("urnpath",G[l]);G=function(a,b,c){return function(e){for(var f=c?function(I){return d[b](d[c](I))}:d[b],n=0,z=(e=(e+"").split(a)).length;n<z;n++)e[n]=f(e[n]);return e.join(a)}},d.decodePath=G("/","decodePathSegment"),d.decodeUrnPath=G(":","decodeUrnPathSegment"),d.recodePath=G("/","encodePathSegment","decode"),d.recodeUrnPath=G(":","encodeUrnPathSegment","decode"),d.encodeReserved=t("reserved","encode"),d.parse=function(a,b){b=b||{preventInvalidHostname:d.preventInvalidHostname};var c=a.indexOf("#");return-1<c&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),-1<(c=a.indexOf("?"))&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===(a=a.replace(/^(https?|ftp|wss?)?:[/\\]*/,"$1://")).substring(0,2)?(b.protocol=null,a=a.substring(2),a=d.parseAuthority(a,b)):-1<(c=a.indexOf(":"))&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(d.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3).replace(/\\/g,"/")?(a=a.substring(c+3),a=d.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0)),b.path=a,b},d.parseHost=function(a,b){var e,f,c=(a=(a=a||"").replace(/\\/g,"/")).indexOf("/");return-1===c&&(c=a.length),"["===a.charAt(0)?(e=a.indexOf("]"),b.hostname=a.substring(1,e)||null,b.port=a.substring(e+2,c)||null,"/"===b.port&&(b.port=null)):(f=a.indexOf(":"),e=a.indexOf("/"),-1!==(f=a.indexOf(":",f+1))&&(-1===e||f<e)?(b.hostname=a.substring(0,c)||null,b.port=null):(e=a.substring(0,c).split(":"),b.hostname=e[0]||null,b.port=e[1]||null)),b.hostname&&"/"!==a.substring(c).charAt(0)&&(c++,a="/"+a),b.preventInvalidHostname&&d.ensureValidHostname(b.hostname,b.protocol),b.port&&d.ensureValidPort(b.port),a.substring(c)||"/"},d.parseAuthority=function(a,b){return a=d.parseUserinfo(a,b),d.parseHost(a,b)},d.parseUserinfo=function(a,b){var c=a,e=(a=-1!==a.indexOf("\\")?a.replace(/\\/g,"/"):a).indexOf("/"),f=a.lastIndexOf("@",-1<e?e:a.length-1);return-1<f&&(-1===e||f<e)?(e=a.substring(0,f).split(":"),b.username=e[0]?d.decode(e[0]):null,e.shift(),b.password=e[0]?d.decode(e.join(":")):null,a=c.substring(f+1)):(b.username=null,b.password=null),a},d.parseQuery=function(a,b){if(!a)return{};if(!(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,z,c={},e=a.split("&"),f=e.length,I=0;I<f;I++)n=e[I].split("="),z=d.decodeQuery(n.shift(),b),n=n.length?d.decodeQuery(n.join("="),b):null,"__proto__"!==z&&(B.call(c,z)?("string"!=typeof c[z]&&null!==c[z]||(c[z]=[c[z]]),c[z].push(n)):c[z]=n);return c},d.build=function(a){var b="",c=!1;return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//",c=!0),b+=d.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&c&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},d.buildHost=function(a){var b="";return a.hostname?(b=d.ip6_expression.test(a.hostname)?b+("["+a.hostname)+"]":b+a.hostname,a.port&&(b+=":"+a.port),b):""},d.buildAuthority=function(a){return d.buildUserinfo(a)+d.buildHost(a)},d.buildUserinfo=function(a){var b="";return a.username&&(b+=d.encode(a.username)),a.password&&(b+=":"+d.encode(a.password)),b&&(b+="@"),b},d.buildQuery=function(a,b,c){var f,e="";for(f in a)if("__proto__"!==f&&B.call(a,f))if(A(a[f]))for(var z={},I=0,n=a[f].length;I<n;I++)void 0!==a[f][I]&&void 0===z[a[f][I]+""]&&(e+="&"+d.buildQueryParameter(f,a[f][I],c),!0!==b&&(z[a[f][I]+""]=!0));else void 0!==a[f]&&(e+="&"+d.buildQueryParameter(f,a[f],c));return e.substring(1)},d.buildQueryParameter=function(a,b,c){return d.encodeQuery(a,c)+(null!==b?"="+d.encodeQuery(b,c):"")},d.addQuery=function(a,b,c){if("object"==typeof b)for(var e in b)B.call(b,e)&&d.addQuery(a,e,b[e]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");void 0===a[b]?a[b]=c:("string"==typeof a[b]&&(a[b]=[a[b]]),A(c)||(c=[c]),a[b]=(a[b]||[]).concat(c))}},d.setQuery=function(a,b,c){if("object"==typeof b)for(var e in b)B.call(b,e)&&d.setQuery(a,e,b[e]);else{if("string"!=typeof b)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");a[b]=void 0===c?null:c}},d.removeQuery=function(a,b,c){if(A(b))for(c=0,e=b.length;c<e;c++)a[b[c]]=void 0;else if("RegExp"===E(b))for(var e in a)b.test(e)&&(a[e]=void 0);else if("object"==typeof b)for(e in b)B.call(b,e)&&d.removeQuery(a,e,b[e]);else{if("string"!=typeof b)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==c?"RegExp"===E(c)?!A(a[b])&&c.test(a[b])?a[b]=void 0:a[b]=h(a[b],c):a[b]!==String(c)||A(c)&&1!==c.length?A(a[b])&&(a[b]=h(a[b],c)):a[b]=void 0:a[b]=void 0}},d.hasQuery=function(a,b,c,e){switch(E(b)){case"String":break;case"RegExp":for(var f in a)if(B.call(a,f)&&b.test(f)&&(void 0===c||d.hasQuery(a,f,c)))return!0;return!1;case"Object":for(var n in b)if(B.call(b,n)&&!d.hasQuery(a,n,b[n]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(E(c)){case"Undefined":return b in a;case"Boolean":return c===(a=!(A(a[b])?!a[b].length:!a[b]));case"Function":return!!c(a[b],b,a);case"Array":return!!A(a[b])&&(e?p:D)(a[b],c);case"RegExp":return A(a[b])?!!e&&p(a[b],c):!(!a[b]||!a[b].match(c));case"Number":c=String(c);case"String":return A(a[b])?!!e&&p(a[b],c):a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},d.joinPaths=function(){for(var a=[],b=[],c=0,e=0;e<arguments.length;e++){var f=new d(arguments[e]);a.push(f);for(var f=f.segment(),n=0;n<f.length;n++)"string"==typeof f[n]&&b.push(f[n]),f[n]&&c++}return b.length&&c?(b=new d("").segment(b),""!==a[0].path()&&"/"!==a[0].path().slice(0,1)||b.path("/"+b.path()),b.normalize()):new d("")},d.commonPath=function(a,b){for(var c=Math.min(a.length,b.length),e=0;e<c;e++)if(a.charAt(e)!==b.charAt(e)){e--;break}return e<1?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":("/"===a.charAt(e)&&"/"===b.charAt(e)||(e=a.substring(0,e).lastIndexOf("/")),a.substring(0,e+1))},d.withinString=function(a,b,c){var e=(c=c||{}).start||d.findUri.start,f=c.end||d.findUri.end,n=c.trim||d.findUri.trim,z=c.parens||d.findUri.parens,I=/[a-z0-9-]=["']?$/i;for(e.lastIndex=0;;){var L=e.exec(a);if(!L)break;var P=L.index;if(c.ignoreHtml){var N=a.slice(Math.max(P-3,0),P);if(N&&I.test(N))continue}for(var O=P+a.slice(P).search(f),N=a.slice(P,O),O=-1;;){var Q=z.exec(N);if(!Q)break;O=Math.max(O,Q.index+Q[0].length)}(N=-1<O?N.slice(0,O)+N.slice(O).replace(n,""):N.replace(n,"")).length<=L[0].length||c.ignore&&c.ignore.test(N)||(void 0===(L=b(N,P,O=P+N.length,a))?e.lastIndex=O:(L=String(L),a=a.slice(0,P)+L+a.slice(O),e.lastIndex=P+L.length))}return e.lastIndex=0,a},d.ensureValidHostname=function(a,b){var c=!!a,e=!1;if((e=b?p(d.hostProtocols,b):e)&&!c)throw new TypeError("Hostname cannot be empty, if protocol is "+b);if(a&&a.match(d.invalid_hostname_characters)){if(!r)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(r.toASCII(a).match(d.invalid_hostname_characters))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-:_]')}},d.ensureValidPort=function(a){if(a){var b=Number(a);if(!(/^[0-9]+$/.test(b)&&0<b&&b<65536))throw new TypeError('Port "'+a+'" is not a valid port')}},d.noConflict=function(a){return a?(a={URI:this.noConflict()},m.URITemplate&&"function"==typeof m.URITemplate.noConflict&&(a.URITemplate=m.URITemplate.noConflict()),m.IPv6&&"function"==typeof m.IPv6.noConflict&&(a.IPv6=m.IPv6.noConflict()),m.SecondLevelDomains&&"function"==typeof m.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=m.SecondLevelDomains.noConflict()),a):(m.URI===this&&(m.URI=v),this)},g.build=function(a){return!0===a?this._deferred_build=!0:void 0!==a&&!this._deferred_build||(this._string=d.build(this._parts),this._deferred_build=!1),this},g.clone=function(){return new d(this)},g.valueOf=g.toString=function(){return this.build(!1)._string},g.protocol=w("protocol"),g.username=w("username"),g.password=w("password"),g.hostname=w("hostname"),g.port=w("port"),g.query=H("query","?"),g.fragment=H("fragment","#"),g.search=function(a,c){c=this.query(a,c);return"string"==typeof c&&c.length?"?"+c:c},g.hash=function(a,c){c=this.fragment(a,c);return"string"==typeof c&&c.length?"#"+c:c},g.pathname=function(a,c){if(void 0!==a&&!0!==a)return this._parts.path=this._parts.urn?a?d.recodeUrnPath(a):"":a?d.recodePath(a):"/",this.build(!c),this;c=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?d.decodeUrnPath:d.decodePath)(c):c},g.path=g.pathname,g.href=function(a,b){if(void 0===a)return this.toString();this._string="",this._parts=d._parts();var e=a instanceof d,f="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName&&(a=a[f=d.getDomAttribute(a)]||"",f=!1),"string"==typeof(a=!e&&f&&void 0!==a.pathname?a.toString():a)||a instanceof String)this._parts=d.parse(String(a),this._parts);else{if(!e&&!f)throw new TypeError("invalid input");for(var c in e=e?a._parts:a)"query"!==c&&B.call(this._parts,c)&&(this._parts[c]=e[c]);e.query&&this.query(e.query,!1)}return this.build(!b),this},g.is=function(a){var b=!1,c=!1,e=!1,f=!1,n=!1,z=!1,I=!1,L=!this._parts.urn;switch(this._parts.hostname&&(L=!1,c=d.ip4_expression.test(this._parts.hostname),e=d.ip6_expression.test(this._parts.hostname),n=(f=!(b=c||e))&&k&&k.has(this._parts.hostname),z=f&&d.idn_expression.test(this._parts.hostname),I=f&&d.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return L;case"absolute":return!L;case"domain":case"name":return f;case"sld":return n;case"ip":return b;case"ip4":case"ipv4":case"inet4":return c;case"ip6":case"ipv6":case"inet6":return e;case"idn":return z;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return I}return null};var C=g.protocol,y=g.port,J=g.hostname;g.protocol=function(a,b){if(a&&!(a=a.replace(/:(\/\/)?$/,"")).match(d.protocol_expression))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return C.call(this,a,b)},g.scheme=g.protocol,g.port=function(a,b){return this._parts.urn?void 0===a?"":this:(void 0!==a&&((a=0===a?null:a)&&(":"===(a+="").charAt(0)&&(a=a.substring(1)),d.ensureValidPort(a))),y.call(this,a,b))},g.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==d.parseHost(a,c))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');a=c.hostname,this._parts.preventInvalidHostname&&d.ensureValidHostname(a,this._parts.protocol)}return J.call(this,a,b)},g.origin=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a)return c=d(a),this.protocol(c.protocol()).authority(c.authority()).build(!b),this;var c=this.protocol();return this.authority()?(c?c+"://":"")+this.authority():""},g.host=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?d.buildHost(this._parts):"";if("/"!==d.parseHost(a,this._parts))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},g.authority=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?d.buildAuthority(this._parts):"";if("/"!==d.parseAuthority(a,this._parts))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},g.userinfo=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a)return"@"!==a[a.length-1]&&(a+="@"),d.parseUserinfo(a,this._parts),this.build(!c),this;c=d.buildUserinfo(this._parts);return c&&c.substring(0,c.length-1)},g.resource=function(c,b){if(void 0===c)return this.path()+this.search()+this.hash();c=d.parse(c);return this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this},g.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}if(c=this._parts.hostname.length-this.domain().length,c=this._parts.hostname.substring(0,c),c=new RegExp("^"+q(c)),a&&"."!==a.charAt(a.length-1)&&(a+="."),-1!==a.indexOf(":"))throw new TypeError("Domains cannot contain colons");return a&&d.ensureValidHostname(a,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(c,a),this.build(!b),this},g.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);return c&&c.length<2?this._parts.hostname:(c=this._parts.hostname.length-this.tld(b).length-1,c=this._parts.hostname.lastIndexOf(".",c-1)+1,this._parts.hostname.substring(c)||"")}if(!a)throw new TypeError("cannot set domain empty");if(-1!==a.indexOf(":"))throw new TypeError("Domains cannot contain colons");return d.ensureValidHostname(a,this._parts.protocol),!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(c=new RegExp(q(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)),this.build(!b),this},g.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.lastIndexOf("."),c=this._parts.hostname.substring(c+1);return!0!==b&&k&&k.list[c.toLowerCase()]&&k.get(this._parts.hostname)||c}if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!k||!k.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');c=new RegExp(q(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");c=new RegExp(q(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)}return this.build(!b),this},g.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&!0!==a)return c=this._parts.path.length-this.filename().length,c=this._parts.path.substring(0,c),c=new RegExp("^"+q(c)),this.is("relative")||"/"!==(a=a||"/").charAt(0)&&(a="/"+a),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=d.recodePath(a),this._parts.path=this._parts.path.replace(c,a),this.build(!b),this;if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?d.decodePath(c):c},g.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("string"!=typeof a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),c=this._parts.path.substring(c+1);return a?d.decodePathSegment(c):c}c=!1,(a="/"===a.charAt(0)?a.substring(1):a).match(/\.?\//)&&(c=!0);var e=new RegExp(q(this.filename())+"$");return a=d.recodePath(a),this._parts.path=this._parts.path.replace(e,a),c?this.normalizePath(b):this.build(!b),this},g.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this.filename(),e=c.lastIndexOf(".");return-1===e?"":(c=c.substring(e+1),c=/^[a-z0-9%]+$/i.test(c)?c:"",a?d.decodePathSegment(c):c)}if("."===a.charAt(0)&&(a=a.substring(1)),c=this.suffix())e=a?new RegExp(q(c)+"$"):new RegExp(q("."+c)+"$");else{if(!a)return this;this._parts.path+="."+d.recodePath(a)}return e&&(a=d.recodePath(a),this._parts.path=this._parts.path.replace(e,a)),this.build(!b),this},g.segment=function(a,b,c){var e=this._parts.urn?":":"/",n="/"===(f=this.path()).substring(0,1),f=f.split(e);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');if(n&&f.shift(),a<0&&(a=Math.max(f.length+a,0)),void 0===b)return void 0===a?f:f[a];if(null===a||void 0===f[a])if(A(b)){f=[],a=0;for(var z=b.length;a<z;a++)(b[a].length||f.length&&f[f.length-1].length)&&(f.length&&!f[f.length-1].length&&f.pop(),f.push(u(b[a])))}else!b&&"string"!=typeof b||(b=u(b),""===f[f.length-1]?f[f.length-1]=b:f.push(b));else b?f[a]=u(b):f.splice(a,1);return n&&f.unshift(""),this.path(f.join(e),c)},g.segmentCoded=function(a,b,c){if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(A(a=this.segment(a,b,c)))for(var f=0,e=a.length;f<e;f++)a[f]=d.decode(a[f]);else a=void 0!==a?d.decode(a):void 0;return a}if(A(b))for(f=0,e=b.length;f<e;f++)b[f]=d.encode(b[f]);else b="string"==typeof b||b instanceof String?d.encode(b):b;return this.segment(a,b,c)};var M=g.query;return g.query=function(e,b){if(!0===e)return d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"!=typeof e)return void 0!==e&&"string"!=typeof e?(this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):M.call(this,e,b);var c=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=e.call(this,c);return this._parts.query=d.buildQuery(e||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this},g.setQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)e[a]=void 0!==b?b:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var f in a)B.call(a,f)&&(e[f]=a[f])}return this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!(c="string"!=typeof a?b:c)),this},g.addQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.addQuery(e,a,void 0===b?null:b),this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!(c="string"!=typeof a?b:c)),this},g.removeQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.removeQuery(e,a,b),this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!(c="string"!=typeof a?b:c)),this},g.hasQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.hasQuery(e,a,b,c)},g.setSearch=g.setQuery,g.addSearch=g.addQuery,g.removeSearch=g.removeQuery,g.hasSearch=g.hasQuery,g.normalize=function(){return(this._parts.urn?this.normalizeProtocol(!1):this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1)).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},g.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},g.normalizeHostname=function(a){return this._parts.hostname&&(this.is("IDN")&&r?this._parts.hostname=r.toASCII(this._parts.hostname):this.is("IPv6")&&x&&(this._parts.hostname=x.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a)),this},g.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===d.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},g.normalizePath=function(a){var b=this._parts.path;if(!b)return this;if(this._parts.urn)return this._parts.path=d.recodeUrnPath(this._parts.path),this.build(!a),this;if("/"===this._parts.path)return this;var e,c="";for("/"!==(b=d.recodePath(b)).charAt(0)&&(e=!0,b="/"+b),"/.."!==b.slice(-3)&&"/."!==b.slice(-2)||(b+="/"),b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),e&&(c=b.substring(1).match(/^(\.\.\/)+/)||"")&&(c=c[0]);;){var n,f=b.search(/\/\.\.(\/|$)/);if(-1===f)break;0!==f?(-1===(n=b.substring(0,f).lastIndexOf("/"))&&(n=f),b=b.substring(0,n)+b.substring(f+3)):b=b.substring(3)}return e&&this.is("relative")&&(b=c+b.substring(1)),this._parts.path=b,this.build(!a),this},g.normalizePathname=g.normalizePath,g.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},g.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},g.normalizeSearch=g.normalizeQuery,g.normalizeHash=g.normalizeFragment,g.iso8859=function(){var a=d.encode,b=d.decode;d.encode=escape,d.decode=decodeURIComponent;try{this.normalize()}finally{d.encode=a,d.decode=b}return this},g.unicode=function(){var a=d.encode,b=d.decode;d.encode=F,d.decode=unescape;try{this.normalize()}finally{d.encode=a,d.decode=b}return this},g.readable=function(){var a=this.clone();a.username("").password("").normalize();var b="";if(a._parts.protocol&&(b+=a._parts.protocol+"://"),a._parts.hostname&&(a.is("punycode")&&r?(b+=r.toUnicode(a._parts.hostname),a._parts.port&&(b+=":"+a._parts.port)):b+=a.host()),a._parts.hostname&&a._parts.path&&"/"!==a._parts.path.charAt(0)&&(b+="/"),b+=a.path(!0),a._parts.query){for(var c="",e=0,f=a._parts.query.split("&"),n=f.length;e<n;e++){var z=(f[e]||"").split("=");c+="&"+d.decodeQuery(z[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==z[1]&&(c+="="+d.decodeQuery(z[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}b+="?"+c.substring(1)}return b+d.decodeQuery(a.hash(),!0)},g.absoluteTo=function(a){var e,f,b=this.clone(),c=["protocol","username","password","hostname","port"];if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(a instanceof d||(a=new d(a)),b._parts.protocol)return b;if(b._parts.protocol=a._parts.protocol,this._parts.hostname)return b;for(e=0;f=c[e];e++)b._parts[f]=a._parts[f];return b._parts.path?(".."===b._parts.path.substring(-2)&&(b._parts.path+="/"),"/"!==b.path().charAt(0)&&(c=(c=a.directory())?c:0===a.path().indexOf("/")?"/":"",b._parts.path=(c?c+"/":"")+b._parts.path,b.normalizePath())):(b._parts.path=a._parts.path,b._parts.query||(b._parts.query=a._parts.query)),b.build(),b},g.relativeTo=function(a){var b=this.clone().normalize();if(b._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");a=new d(a).normalize();var c=b._parts,e=a._parts,f=b.path();if(a=a.path(),"/"!==f.charAt(0))throw Error("URI is already relative");if("/"!==a.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");return c.protocol===e.protocol&&(c.protocol=null),c.username!==e.username||c.password!==e.password||null!==c.protocol||null!==c.username||null!==c.password||c.hostname!==e.hostname||c.port!==e.port?b.build():(c.hostname=null,c.port=null,f===a?c.path="":(f=d.commonPath(f,a))&&(e=e.path.substring(f.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),c.path=e+c.path.substring(f.length)||"./"),b.build())},g.equals=function(a){var e,b=this.clone(),c=new d(a);if(a={},b.normalize(),c.normalize(),b.toString()===c.toString())return!0;var f=b.query(),n=c.query();if(b.query(""),c.query(""),b.toString()!==c.toString()||f.length!==n.length)return!1;for(e in b=d.parseQuery(f,this._parts.escapeQuerySpace),n=d.parseQuery(n,this._parts.escapeQuerySpace),b)if(B.call(b,e)){if(A(b[e])){if(!D(b[e],n[e]))return!1}else if(b[e]!==n[e])return!1;a[e]=!0}for(e in n)if(B.call(n,e)&&!a[e])return!1;return!0},g.preventInvalidHostname=function(a){return this._parts.preventInvalidHostname=!!a,this},g.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},g.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},d}),function(r,x){"object"==typeof module&&module.exports?module.exports=x(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],x):r.URITemplate=x(r.URI,r)}(this,function(r,x){function k(h){return k._cache[h]||(this instanceof k?(this.expression=h,k._cache[h]=this):new k(h))}function m(h){this.data=h,this.cache={}}var d=x&&x.URITemplate,q=Object.prototype.hasOwnProperty,E=k.prototype,A={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return k._cache={},k.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,k.VARIABLE_PATTERN=/^([^*:.](?:\.?[^*:.])*)((\*)|:(\d+))?$/,k.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_.]/,k.LITERAL_PATTERN=/[<>{}"`^| \\]/,k.expand=function(h,p,D){var u=A[h.operator],K=u.named?"Named":"Unnamed";h=h.variables;for(var w,F=[],H=0;w=h[H];H++){var v=p.get(w.name);if(0===v.type&&D&&D.strict)throw Error('Missing expansion value for variable "'+w.name+'"');if(v.val.length){if(1<v.type&&w.maxlength)throw Error('Invalid expression: Prefix modifier not applicable to variable "'+w.name+'"');F.push(k["expand"+K](v,u,w.explode,w.explode&&u.separator||",",w.maxlength,w.name))}else v.type&&F.push("")}return F.length?u.prefix+F.join(u.separator):""},k.expandNamed=function(h,p,D,u,K,F){var w="",H=p.encode;p=p.empty_name_separator;for(var l,v=!h[H].length,g=2===h.type?"":r[H](F),G=0,B=h.val.length;G<B;G++)K?(l=r[H](h.val[G][1].substring(0,K)),2===h.type&&(g=r[H](h.val[G][0].substring(0,K)))):v?(l=r[H](h.val[G][1]),2===h.type?(g=r[H](h.val[G][0]),h[H].push([g,l])):h[H].push([void 0,l])):(l=h[H][G][1],2===h.type&&(g=h[H][G][0])),w&&(w+=u),D?w+=g+(p||l?"=":"")+l:(G||(w+=r[H](F)+(p||l?"=":"")),2===h.type&&(w+=g+","),w+=l);return w},k.expandUnnamed=function(h,p,D,u,K){var F="",w=p.encode;p=p.empty_name_separator;for(var B,H=!h[w].length,g=0,v=h.val.length;g<v;g++)K?B=r[w](h.val[g][1].substring(0,K)):H?(B=r[w](h.val[g][1]),h[w].push([2===h.type?r[w](h.val[g][0]):void 0,B])):B=h[w][g][1],F&&(F+=u),2===h.type&&(F+=K?r[w](h.val[g][0].substring(0,K)):h[w][g][0],F=D?F+(p||B?"=":""):F+","),F+=B;return F},k.noConflict=function(){return x.URITemplate===k&&(x.URITemplate=d),k},E.expand=function(h,p){var D="";this.parts&&this.parts.length||this.parse(),h instanceof m||(h=new m(h));for(var u=0,K=this.parts.length;u<K;u++)D+="string"==typeof this.parts[u]?this.parts[u]:k.expand(this.parts[u],h,p);return D},E.parse=function(){function H(t){if(t.match(K))throw Error('Invalid Literal "'+t+'"');return t}var h=this.expression,p=k.EXPRESSION_PATTERN,D=k.VARIABLE_PATTERN,u=k.VARIABLE_NAME_PATTERN,K=k.LITERAL_PATTERN,F=[],w=0;for(p.lastIndex=0;;){var v=p.exec(h);if(null===v){F.push(H(h.substring(w)));break}if(F.push(H(h.substring(w,v.index))),w=v.index+v[0].length,!A[v[1]])throw Error('Unknown Operator "'+v[1]+'" in "'+v[0]+'"');if(!v[3])throw Error('Unclosed Expression "'+v[0]+'"');for(var g=v[2].split(","),B=0,G=g.length;B<G;B++){var l=g[B].match(D);if(null===l)throw Error('Invalid Variable "'+g[B]+'" in "'+v[0]+'"');if(l[1].match(u))throw Error('Invalid Variable Name "'+l[1]+'" in "'+v[0]+'"');g[B]={name:l[1],explode:!!l[3],maxlength:l[4]&&parseInt(l[4],10)}}if(!g.length)throw Error('Expression Missing Variable(s) "'+v[0]+'"');F.push({expression:v[0],operator:v[1],variables:g})}return F.length||F.push(H(h)),this.parts=F,this},m.prototype.get=function(h){var p=this.data,D={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[h])return this.cache[h];if(this.cache[h]=D,null!=(p="[object Function]"===String(Object.prototype.toString.call(p))?p(h):"[object Function]"===String(Object.prototype.toString.call(p[h]))?p[h](h):p[h]))if("[object Array]"===String(Object.prototype.toString.call(p))){var u=0;for(h=p.length;u<h;u++)void 0!==p[u]&&null!==p[u]&&D.val.push([void 0,String(p[u])]);D.val.length&&(D.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(p))){for(u in p)q.call(p,u)&&void 0!==p[u]&&null!==p[u]&&D.val.push([u,String(p[u])]);D.val.length&&(D.type=2)}else D.type=1,D.val.push([void 0,String(p)]);return D},r.expand=function(h,D){D=new k(h).expand(D);return new r(D)},k}),function(q,u,c){function v(a,b,g){a.addEventListener?a.addEventListener(b,g,!1):a.attachEvent("on"+b,g)}function z(a){if("keypress"!=a.type)return n[a.which]||r[a.which]||String.fromCharCode(a.which).toLowerCase();var b=String.fromCharCode(a.which);return b=!a.shiftKey?b.toLowerCase():b}function w(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function A(a,b){for(var d=[],e="+"===(e=a)?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+"),g=0;g<e.length;++g){var m=e[g];B[m]&&(m=B[m]),b&&"keypress"!=b&&C[m]&&(m=C[m],d.push("shift")),w(m)&&d.push(m)}if(e=m,!(g=b)){if(!p)for(var c in p={},n)95<c&&c<112||n.hasOwnProperty(c)&&(p[n[c]]=c);g=p[e]?"keydown":"keypress"}return{key:m,modifiers:d,action:g="keypress"==g&&d.length?"keydown":g}}function d(a){function b(a){a=a||{};var l,b=!1;for(l in p)a[l]?b=!0:p[l]=0;b||(x=!1)}function g(a,b,t,f,g,d){var l,E=[],h=t.type;if(!k._callbacks[a])return[];for("keyup"==h&&w(a)&&(b=[a]),l=0;l<k._callbacks[a].length;++l){var e,c=k._callbacks[a][l];!f&&c.seq&&p[c.seq]!=c.level||h!=c.action||((e="keypress"==h&&!t.metaKey&&!t.ctrlKey)||(e=c.modifiers,e=b.sort().join(",")===e.sort().join(",")),e&&(e=f&&c.seq==f&&c.level==d,(!f&&c.combo==g||e)&&k._callbacks[a].splice(l,1),E.push(c)))}return E}function c(a,b,c,f){k.stopCallback(b,b.target||b.srcElement,c,f)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function e(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=z(a);b&&("keyup"==a.type&&y===b?y=!1:k.handleKey(b,function(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}(a),a))}function m(a,g,t,f){function l(g){c(t,g,a),"keyup"!==f&&(y=z(g)),setTimeout(b,10)}for(var d=p[a]=0;d<g.length;++d){var e=d+1===g.length?l:function(c){return function(){x=c,++p[a],clearTimeout(q),q=setTimeout(b,1e3)}}(f||A(g[d+1]).action);n(g[d],e,f,a,d)}}function n(a,b,c,f,d){k._directMap[a+":"+c]=b;var e=(a=a.replace(/\s+/g," ")).split(" ");1<e.length?m(a,e,b,c):(c=A(a,c),k._callbacks[c.key]=k._callbacks[c.key]||[],g(c.key,c.modifiers,{type:c.action},f,a,d),k._callbacks[c.key][f?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:f,level:d,combo:a}))}var k=this;if(a=a||u,!(k instanceof d))return new d(a);k.target=a,k._callbacks={},k._directMap={};var q,p={},y=!1,r=!1,x=!1;k._handleKey=function(a,d,e){for(var f=g(a,d,e),k=0,l=!(d={}),h=0;h<f.length;++h)f[h].seq&&(k=Math.max(k,f[h].level));for(h=0;h<f.length;++h)f[h].seq?f[h].level==k&&(l=!0,d[f[h].seq]=1,c(f[h].callback,e,f[h].combo,f[h].seq)):l||c(f[h].callback,e,f[h].combo);f="keypress"==e.type&&r,e.type!=x||w(a)||f||b(d),r=l&&"keydown"==e.type},k._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)n(a[d],b,c)},v(a,"keypress",e),v(a,"keydown",e),v(a,"keyup",e)}if(q){var p,n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},C={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},B={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};for(c=1;c<20;++c)n[111+c]="f"+c;for(c=0;c<=9;++c)n[c+96]=c.toString();d.prototype.bind=function(a,b,c){return a=a instanceof Array?a:[a],this._bindMultiple.call(this,a,b,c),this},d.prototype.unbind=function(a,b){return this.bind.call(this,a,function(){},b)},d.prototype.trigger=function(a,b){return this._directMap[a+":"+b]&&this._directMap[a+":"+b]({},a),this},d.prototype.reset=function(){return this._callbacks={},this._directMap={},this},d.prototype.stopCallback=function(a,b){return!(-1<(" "+b.className+" ").indexOf(" mousetrap ")||function D(a,b){return null!==a&&a!==u&&(a===b||D(a.parentNode,b))}(b,this.target))&&("composedPath"in a&&"function"==typeof a.composedPath&&((c=a.composedPath()[0])!==a.target&&(b=c)),"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable);var c},d.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},d.addKeycodes=function(a){for(var b in a)a.hasOwnProperty(b)&&(n[b]=a[b]);p=null},(d.init=function(){var b,a=d(u);for(b in a)"_"!==b.charAt(0)&&(d[b]=function(b){return function(){return a[b].apply(a,arguments)}}(b))})(),q.Mousetrap=d,"undefined"!=typeof module&&module.exports&&(module.exports=d),"function"==typeof define&&define.amd&&define(function(){return d})}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null);var Isfahan=function(configObject){var containerSize=function(containerId){return[document.getElementById(containerId).offsetWidth,document.getElementById(containerId).offsetHeight]},containerId=configObject.containerId,pad=d3_layout_cellPadNull,round=Math.round,padding=configObject.padding,hierarchy=d3.layout.hierarchy();configObject.layoutDescription;function calculateLayout(node){var children=node.children;if(children&&children.length){for(var n,rect=pad(node),group=(node.type,[]),remaining=children.slice();0<(n=remaining.length);)group.push(remaining[n-1]),remaining.pop();!function(group,groupType,rect){var d,o,i=-1,row="row"!==groupType,n=group.length,x=rect.x,y=rect.y,offset=0;for(;++i<n;)o=group[n-(i+1)],d=function(node,row,divisor,sum,n){var old=!1,dimension=row?"dy":"dx",divisor=divisor[dimension];{if(sum.forEach(function(item){item[dimension],0}),old){console.log("preserved");sum=sum.reduce(function(previousValue,currentValue,index,array){return previousValue[dimension]+currentValue[dimension]});return console.log("sum: "+sum),divisor=node[dimension]/sum*divisor,console.log("divisor: "+divisor),divisor}return n}}(o,row,rect,group,n),o.id=void 0!==o.id?o.id:genUuid(),o.x=row?x:x+offset,o.y=row?y+offset:y,o.dx=row?rect.dx:rect.dx/d,o.dy=row?rect.dy/d:rect.dy,offset+=row?o.dy:o.dx}(group,node.type,rect),children.forEach(function(child,index){child.address=node.address.concat("."+child.type+(index+1))}),children.forEach(calculateLayout)}}function isfahan(containerSelector){var nodes=hierarchy(containerSelector.layoutDescription),root=nodes[0];return size=(containerSelector=containerSelector.containerSelector,[jQuery(containerSelector).width(),jQuery(containerSelector).height()]),root.x=0,root.y=0,root.dx=containerSize(containerId)[0],root.dy=containerSize(containerId)[1],root.address=root.type+"1",root.id=root.id||genUuid(),calculateLayout(root),isfahan.padding(padding),nodes=nodes.map(function(node){return function merge(target,source){"object"!=typeof target&&(target={});for(var property in source){var sourceProperty;source.hasOwnProperty(property)&&(sourceProperty=source[property],target[property]="object"!=typeof sourceProperty?sourceProperty:util.merge(target[property],sourceProperty))}for(var a=2,l=arguments.length;a<l;a++)merge(target,arguments[a]);return target}(node,pad(node))})}function genUuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})}function d3_layout_cellPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_cellPad(node,dy){var x=node.x+dy[3],y=node.y+dy[0],dx=node.dx-dy[1]-dy[3],dy=node.dy-dy[0]-dy[2];return dx<0&&(x+=dx/2,dx=0),dy<0&&(y+=dy/2,dy=0),{x:x,y:y,dx:dx,dy:dy}}return isfahan.size=function(x){return arguments.length?(containerSize=x,isfahan):containerSize},isfahan.round=function(x){return arguments.length?(round=x?Math.round:Number,isfahan):round!=Number},isfahan.padding=function(x){return arguments.length?(pad=null==(padding=x)?d3_layout_cellPadNull:"function"==(type=typeof x)?function(node){var p=x.call(isfahan,node,node.depth);return console.log(p),null==p?d3_layout_cellPadNull(node):d3_layout_cellPad(node,"number"==typeof p?[p,p,p,p]:p)}:("number"==type&&(x=[x,x,x,x]),padConstant),isfahan):padding;function padConstant(node){return d3_layout_cellPad(node,x)}var type},isfahan(configObject)},paper=function(t,e){var i=(t=t||require("./node/window.js")).window,n=t.document,r=new function(){function t(t,e,r,s,a){function u(n,u){var c,f="function"==typeof(u="string"==typeof(u=u||(u=o(e,n))&&(u.get?u:u.value))&&"#"===u[0]?t[u.substring(1)]||u:u),d=u,_=a||f&&!u.base?u&&u.get?n in t:t[n]:null;a&&_||(f&&_&&(u.base=_),f&&!1!==s&&(c=n.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),d&&!f&&d.get&&"function"==typeof d.get&&i.isPlainObject(d)||(d={value:d,writable:!0}),(o(t,n)||{configurable:!0}).configurable&&(d.configurable=!0,d.enumerable=r),h(t,n,d))}var l={};if(e){for(var c in e)e.hasOwnProperty(c)&&!n.test(c)&&u(c);for(var c in l){var _=l[c],d=t["set"+_],_=t["get"+_]||d&&t["is"+_];!_||!0!==s&&0!==_.length||u(c,{get:_,set:d})}}return t}function i(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&c(this,i)}return this}function l(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)}function f(t,e,i){var n;return t&&((n=o(t,"length"))&&"number"==typeof n.value?u:l).call(t,e,i=i||t),i}var n=/^(statics|enumerable|beans|preserve)$/,r=[],s=r.slice,a=Object.create,o=Object.getOwnPropertyDescriptor,h=Object.defineProperty,u=r.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},c=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var r,n=arguments[e];for(r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t};return t(i,{inject:function(e){var i,n,r;e&&(i=!0===e.statics?e:e.statics,n=e.beans,r=e.preserve,i!==e&&t(this.prototype,e,e.enumerable,n,r),t(this,i,!0,n,r));for(var s=1,a=arguments.length;s<a;s++)this.inject(arguments[s]);return this},extend:function(){for(var e,i,n,r=this,s=0,o=arguments.length;s<o&&(!e||!i);s++)n=arguments[s],e=e||n.initialize,i=i||n.prototype;return i=(e=e||function(){r.apply(this,arguments)}).prototype=i||a(this.prototype),h(i,"constructor",{value:e,writable:!0,configurable:!0}),t(e,this,!0),arguments.length&&this.inject.apply(e,arguments),e.base=r,e}},!0).inject({initialize:i,set:i,inject:function(){for(var e=0,i=arguments.length;e<i;e++){var n=arguments[e];n&&t(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=a(this);return t.inject.apply(t,arguments)},each:function(t,e){return f(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:c,each:f,create:a,define:h,describe:o,clone:function(t){return c(new t.constructor,t)},isPlainObject:function(e){e=null!=e&&e.constructor;return e&&(e===Object||e===i||"Object"===e.name)},pick:function(t,i){return t!==e?t:i},slice:function(t,e,i){return s.call(t,e,i)}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,i){/^_/.test(i)||this.push(i+": "+("number"==(i=typeof t)?h.instance.number(t):"string"==i?"'"+t+"'":t))},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this},statics:{exports:{enumerable:!0},extend:function nt(){var t=nt.base.apply(this,arguments),e=t.prototype._class;return e&&!r.exports[e]&&(r.exports[e]=t),t},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((i=t.length)!==e.length)return!1;for(;i--;)if(!r.equals(t[i],e[i]))return!1}else{var i,n=Object.keys(t);if((i=n.length)!==Object.keys(e).length)return!1;for(;i--;){var s=n[i];if(!e.hasOwnProperty(s)||!r.equals(t[s],e[s]))return!1}}return!0}return!1},read:function(t,c,n,s){if(this===r){var l=this.peek(t,c);return t.__index++,l}var o=this.prototype,h=o._readIndex,u=c||h&&t.__index||0,l=t.length,c=t[u];return s=s||l-u,c instanceof this||n&&n.readNull&&null==c&&s<=1?(h&&(t.__index=u+1),c&&n&&n.clone?c.clone():c):(c=r.create(o),h&&(c.__read=!0),c=c.initialize.apply(c,0<u||u+s<l?r.slice(t,u,u+s):t)||c,h&&(t.__index=u+c.__read,c.__read=e),c)},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,a,i,n){for(var r,s=[],a=a||0,o=n?a+n:t.length,h=a;h<o;h++)s.push(Array.isArray(r=t[h])?this.read(r,0,i):this.read(t,h,i,1));return s},readNamed:function(t,i,n,s,a){var u,o=this.getNamed(t,i),h=o!==e;return h&&((u=t._filtered)||((u=t._filtered=r.create(t[0]))._unfiltered=t[0]),u[i]=e),this.read(h?[o]:t,n,s,a)},getNamed:function(t,i){var n=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(n)),t._hasObject)return i?n[i]:t._filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n,r){function s(r){var s;n&&r in n||a&&r in a||(s=i[r])!==e&&(t[r]=s)}var a;if(r){for(var o,h={},u=0,l=r.length;u<l;u++)(o=r[u])in i&&(s(o),h[o]=!0);a=h}return Object.keys(i._unfiltered||i).forEach(s),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var a=!n;if(a&&(e.formatter=new h(e.precision),n={length:0,definitions:{},references:{},add:function(s,r){var i="#"+s._id,n=this.references[i];return n||(this.length++,r=r.call(s),(s=s._class)&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]),n}}),t&&t._serialize){var s=t._serialize(e,n),o=t._class;!o||t._compactSerialize||!a&&i||s[0]===o||s.unshift(o)}else if(Array.isArray(t)){s=[];for(var u=0,l=t.length;u<l;u++)s[u]=r.serialize(t[u],e,i,n)}else if(r.isPlainObject(t)){s={};for(var c=Object.keys(t),u=0,l=c.length;u<l;u++){var f=c[u];s[f]=r.serialize(t[f],e,i,n)}}else s="number"==typeof t?e.formatter.number(t,e.precision):t;return a&&0<n.length?[["dictionary",n.definitions],s]:s},deserialize:function(t,e,i,n,s){var a=t,o=!i,h=o&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var u=t[0],l="dictionary"===u;if(1==t.length&&/^#/.test(u))return i.dictionary[u];for(var d,a=[],c=(u=r.exports[u])?1:0,f=t.length;c<f;c++)a.push(r.deserialize(t[c],e,i,l,h));u&&(d=a,e?a=e(u,d,o||s):(a=r.create(u.prototype),u.apply(a,d)))}else if(r.isPlainObject(t))for(var _ in a={},n&&(i.dictionary=a),t)a[_]=r.deserialize(t[_],e,i);return h?a[1]:a},exportJSON:function(i,e){i=r.serialize(i,e);return e&&!1===e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,o){var s=o&&e&&e.constructor===t,a=s?e:r.create(t.prototype);return!(1===i.length&&a instanceof w)||!s&&a instanceof b||(o=i[0],r.isPlainObject(o)&&(o.insert=!1)),(s?a.set:t).apply(a,i),s&&(e=null),a})},splice:function(t,i,n,h){var s=i&&i.length,a=n===e;(n=a?t.length:n)>t.length&&(n=t.length);for(var o=0;o<s;o++)i[o]._index=n+o;if(a)return t.push.apply(t,i),[];h=[n,h];i&&h.push.apply(h,i);for(var u=t.splice.apply(t,h),o=0,l=u.length;o<l;o++)u[o]._index=e;for(o=n+s,l=t.length;o<l;o++)t[o]._index=o;return u},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var s={on:function(t,e){var n,s;return"string"!=typeof t?r.each(t,function(t,e){this.on(e,t)},this):(n=(s=this._eventTypes)&&s[t],-1===(s=(s=this._callbacks=this._callbacks||{})[t]=s[t]||[]).indexOf(e)&&(s.push(e),n&&n.install&&1===s.length&&n.install.call(this,t))),this},off:function(t,e){if("string"==typeof t){var i,a=this._eventTypes,s=a&&a[t],a=this._callbacks&&this._callbacks[t];return a&&(!e||-1!==(i=a.indexOf(e))&&1===a.length?(s&&s.uninstall&&s.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&a.splice(i,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){if(!(i=this._callbacks&&this._callbacks[t]))return!1;var n=r.slice(arguments,1),s=e&&e.target&&!e.currentTarget,i=i.slice();s&&(e.currentTarget=this);for(var a=0,o=i.length;a<o;a++)if(!1===i[a].apply(this,n)){e&&e.stop&&e.stop();break}return s&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var a,e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)0<i[r].length&&((a=(a=e[r])&&a[n])&&a.call(this,r))},statics:{inject:function rt(t){var i,e=t._events;return e&&(i={},r.each(e,function(e,o){var s="string"==typeof e,a=s?e:o,o=r.capitalize(a),h=a.substring(2).toLowerCase();i[h]=s?{}:e,a="_"+a,t["get"+o]=function(){return this[a]},t["set"+o]=function(t){var e=this[a];e&&this.off(h,e),t&&this.on(h,t),this[a]=t}}),t._eventTypes=i),rt.base.apply(this,arguments)}}},a=r.extend({_class:"PaperScope",initialize:function st(){(paper=this).settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=st._id++,st._scopes[this._id]=this;var n,a,o,e=st.prototype;this.support||(a=Q.getContext(1,1)||{},e.support={nativeDash:"setLineDash"in a||"mozDash"in a,nativeBlendModes:tt.nativeModes},Q.release(a)),this.agent||(n=t.navigator.userAgent.toLowerCase(),a=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(n)||[])[0],o=e.agent=e.browser={platform:a="darwin"===a?"mac":a},a&&(o[a]=!0),n.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,s,n,r){o.chrome||(s="opera"===e?n:/^(node|trident)$/.test(e)?r:s,o.version=s,o.versionNumber=parseFloat(s),o.name=e="trident"===e?"msie":e,o[e]=!0)}),o.chrome&&delete o.webkit,o.atom&&delete o.chrome)},version:"0.10.3",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),U.updateFocus()},install:function(t){var i,e=this;for(i in r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})}),this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return(paper=this).project=new y(t),this},createCanvas:function(t,e){return Q.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,i=this.palettes,n=t.length-1;0<=n;n--)t[n].remove();for(n=e.length-1;0<=n;n--)e[n].remove();for(n=i.length-1;0<=n;n--)i[n].remove()},remove:function(){this.clear(),delete a._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),o=r.extend(s,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),(this._scope[this._reference]=this).emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),!(this._scope=null))},getView:function(){return this._scope.getView()}}),h=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});h.instance=new h;var u=new function(){function t(t,e,i){return t<e?e:i<t?i:t}function e(t,l,f){function n(t){var n=134217729*t,n=t-n+n;return[n,t-n]}var o,h,r=l*l-t*f,u=l*l+t*f;return 3*s(r)<u&&(o=n(t),h=n(l),u=n(f),r=(l=l*l)-(f=t*f)+(h[0]*h[0]-l+2*h[0]*h[1]+h[1]*h[1]-(o[0]*u[0]-f+o[0]*u[1]+o[1]*u[0]+o[1]*u[1]))),r}function i(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||1e8<t)?o(2,-Math.round(h(t))):0}var n=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],r=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],s=Math.abs,a=Math.sqrt,o=Math.pow,h=Math.log2||function(t){return Math.log(t)*Math.LOG2E},l=1e-12,c=112e-18;return{EPSILON:l,MACHINE_EPSILON:c,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(a(2)-1)/3,isZero:function(t){return-l<=t&&t<=l},clamp:t,integrate:function(t,e,i,s){for(var a=n[s-2],o=r[s-2],h=.5*(i-e),u=h+e,l=0,c=s+1>>1,f=1&s?o[l++]*t(u):0;l<c;){var d=h*a[l];f+=o[l++]*(t(u+d)+t(u-d))}return h*f},findRoot:function(e,i,n,r,a,o,h){for(var u=0;u<o;u++){var l=e(n),c=l/i(n),f=n-c;if(s(c)<h){n=f;break}n=0<l?(a=n,f<=r?.5*(r+a):f):(r=n,a<=f?.5*(r+a):f)}return t(n,r,a)},solveQuadratic:function(w,r,x,h,u,f){var d,_=1/0;if(s(w)<l){if(s(r)<l)return s(x)<l?-1:0;d=-x/r}else{var v,g=e(w,r*=-.5,x);g&&s(g)<c&&((v=i(s(w),s(r),s(x)))&&(g=e(w*=v,r*=v,x*=v))),-c<=g&&(y=g<0?0:a(g),_=0===(b=r+(r<0?-y:y))?-(d=x/w):(d=b/w,x/b))}var y=0,w=null==u,x=u-l,b=f+l;return isFinite(d)&&(w||x<d&&d<b)&&(h[y++]=w?d:t(d,u,f)),_!==d&&isFinite(_)&&(w||x<_&&_<b)&&(h[y++]=w?_:t(_,u,f)),y},solveCubic:function(e,n,r,h,f,d,_){function g(i){i=e*(v=i);y=(i+(p=i+n))*v+(m=p*v+r),w=m*v+h}var v,p,m,y,w,x=i(s(e),s(n),s(r),s(h));if(x&&(e*=x,n*=x,r*=x,h*=x),s(e)<l)e=n,p=r,m=h,v=1/0;else if(s(h)<l)p=n,m=r,v=0;else{g(-n/e/3);var z=w/e,T=o(s(z),1/3),S=z<0?-1:1,z=-y/e,z=0<z?1.324717957244746*Math.max(T,a(z)):T,M=v-S*z;if(M!==v){for(;g(M),S*v<S*(M=0===y?v:v-w/y/(1+c)););s(e)*v*v>s(h/v)&&(p=((m=-h/v)-r)/v)}}T=u.solveQuadratic(e,p,m,f,d,_),z=null==d;return isFinite(v)&&(0===T||0<T&&v!==f[0]&&v!==f[1])&&(z||d-l<v&&v<_+l)&&(f[T++]=z?v:t(v,d,_)),T}}},l={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return(e=e||(this._pools[t]={_id:1}))._id++}return this._id++}},c=r.extend({_class:"Point",_readIndex:!0,initialize:function(a,e){var s,i=typeof a,n=this.__read,r=0;return"number"==i?(this._set(a,(s="number"==typeof e)?e:a),n&&(r=s?2:1)):"undefined"==i||null===a?(this._set(0,0),n&&(r=null===a?1:0)):(a="string"==i?a.split(/[\s,]+/)||[]:a,r=1,Array.isArray(a)?this._set(+a[0],+(1<a.length?a[1]:a[0])):"x"in a?this._set(a.x||0,a.y||0):"width"in a?this._set(a.width||0,a.height||0):"angle"in a?(this._set(a.length||0,0),this.setAngle(a.angle||0)):(this._set(0,0),r=0)),n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new c(this.x,this.y)},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(e){e=e.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(i){var e;this.isZero()?(e=this._angle||0,this._set(Math.cos(e)*i,Math.sin(e)*i)):(i=i/this.getLength(),u.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i))},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=c.read(arguments),i=this.getLength()*t.getLength();if(u.isZero(i))return NaN;i=this.dot(t)/i;return Math.acos(i<-1?-1:1<i?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){var e;this._angle=t,this.isZero()||(e=this.getLength(),this._set(Math.cos(t)*e,Math.sin(t)*e))},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3}},{beans:!1,getDirectedAngle:function(){var t=c.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var n=c.read(arguments),e=n.x-this.x,n=n.y-this.y,n=e*e+n*n;return r.read(arguments)?n:Math.sqrt(n)},normalize:function(n){n===e&&(n=1);var r=this.getLength(),n=0!==r?n/r:0,r=new c(this.x*n,this.y*n);return 0<=n&&(r._angle=this._angle),r},rotate:function(r,e){if(0===r)return this.clone();r=r*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(r),r=Math.cos(r),i=new c(i.x*r-i.y*n,i.x*n+i.y*r);return e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=c.read(arguments);return new c(this.x+t.x,this.y+t.y)},subtract:function(){var t=c.read(arguments);return new c(this.x-t.x,this.y-t.y)},multiply:function(){var t=c.read(arguments);return new c(this.x*t.x,this.y*t.y)},divide:function(){var t=c.read(arguments);return new c(this.x/t.x,this.y/t.y)},modulo:function(){var t=c.read(arguments);return new c(this.x%t.x,this.y%t.y)},negate:function(){return new c(-this.x,-this.y)},isInside:function(){return g.read(arguments).contains(this)},isClose:function(){var t=c.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=c.read(arguments);return c.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=c.read(arguments);return c.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=u.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return 0<=this.x*(1<t&&t<4?-1:1)&&0<=this.y*(2<t?-1:1)},dot:function(){var t=c.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=c.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=c.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new c(t.x*e,t.y*e)},statics:{min:function(){var t=c.read(arguments),e=c.read(arguments);return new c(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=c.read(arguments),e=c.read(arguments);return new c(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new c(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new c(e(this.x),e(this.y))}},{})),f=c.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),d=r.extend({_class:"Size",_readIndex:!0,initialize:function(a,e){var s,i=typeof a,n=this.__read,r=0;return"number"==i?(this._set(a,(s="number"==typeof e)?e:a),n&&(r=s?2:1)):"undefined"==i||null===a?(this._set(0,0),n&&(r=null===a?1:0)):(a="string"==i?a.split(/[\s,]+/)||[]:a,r=1,Array.isArray(a)?this._set(+a[0],+(1<a.length?a[1]:a[0])):"width"in a?this._set(a.width||0,a.height||0):"x"in a?this._set(a.x||0,a.y||0):(this._set(0,0),r=0)),n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new d(this.width,this.height)},toString:function(){var t=h.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(e){e=e.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=d.read(arguments);return new d(this.width+t.width,this.height+t.height)},subtract:function(){var t=d.read(arguments);return new d(this.width-t.width,this.height-t.height)},multiply:function(){var t=d.read(arguments);return new d(this.width*t.width,this.height*t.height)},divide:function(){var t=d.read(arguments);return new d(this.width/t.width,this.height/t.height)},modulo:function(){var t=d.read(arguments);return new d(this.width%t.width,this.height%t.height)},negate:function(){return new d(-this.width,-this.height)},isZero:function(){var t=u.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new d(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new d(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new d(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new d(e(this.width),e(this.height))}},{})),_=d.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),g=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,s){var a,f,g,h,u,p,_=typeof t;return"number"==_?(this._set(t,i,n,s),a=4):"undefined"==_||null===t?(this._set(0,0,0,0),a=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),a=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),a=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.filter(this,t),a=1)),a===e&&(g=c.readNamed(arguments,"from"),f=r.peek(arguments),_=g.x,g=g.y,f&&f.x!==e||r.hasNamed(arguments,"to")?(h=(p=c.readNamed(arguments,"to")).x-_,u=p.y-g,h<0&&(_=p.x,h=-h),u<0&&(g=p.y,u=-u)):(h=(p=d.read(arguments)).width,u=p.height),this._set(_,g,h,u),a=arguments.__index),this.__read&&(this.__read=a),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new g(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?g.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(e){e=e.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?c:f)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=c.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?d:_)(this.width,this.height,this,"setSize")},setSize:function(){var t=d.read(arguments);this._fixX&&(this.x+=(this.width-t.width)*this._fixX),this._fixY&&(this.y+=(this.height-t.height)*this._fixY),this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){this._fixW||(this.width-=t-this.x),this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){this._fixH||(this.height-=t-this.y),this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(t){this._fixX!==e&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=t-this.width:this.width=t-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(t){this._fixY!==e&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=t-this.height:this.height=t-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){return new(t?c:f)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=c.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(g.read(arguments)):this._containsPoint(c.read(arguments))},_containsPoint:function(i){var e=i.x,i=i.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=g.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=g.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var r=g.read(arguments),e=Math.max(this.x,r.x),i=Math.max(this.y,r.y),n=Math.min(this.x+this.width,r.x+r.width),r=Math.min(this.y+this.height,r.y+r.height);return new g(e,i,n-e,r-i)},unite:function(){var r=g.read(arguments),e=Math.min(this.x,r.x),i=Math.min(this.y,r.y),n=Math.max(this.x+this.width,r.x+r.width),r=Math.max(this.y+this.height,r.y+r.height);return new g(e,i,n-e,r-i)},include:function(){var r=c.read(arguments),e=Math.min(this.x,r.x),i=Math.min(this.y,r.y),n=Math.max(this.x+this.width,r.x),r=Math.max(this.y+this.height,r.y);return new g(e,i,n-e,r-i)},expand:function(){var i=d.read(arguments),e=i.width,i=i.height;return new g(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,r){var i=t.join(""),s=/^[RL]/.test(i);4<=r&&(t[1]+=s?"Y":"X");var r=t[s?0:1],s=t[s?1:0],a="get"+r,o="get"+s,h="set"+r,u="set"+s,d="set"+i;this["get"+i]=function(t){return new(t?c:f)(this[a](),this[o](),this,d)},this[d]=function(){var t=c.read(arguments);this[h](t.x),this[u](t.y)}},{beans:!0})),v=g.extend({initialize:function(t,e,i,n,r,s){this._set(t,e,i,n,!0),this._owner=r,this._setter=s},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=g.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e.changeSelection&&e.changeSelection(2,t)}}))}),p=r.extend({_class:"Matrix",initialize:function at(t,e){var i=arguments.length,n=!0;if(6<=i?this._set.apply(this,arguments):1===i||2===i?t instanceof at?this._set(t._a,t._b,t._c,t._d,t._tx,t._ty,e):Array.isArray(t)?this._set.apply(this,e?t.concat([e]):t):n=!1:i?n=!1:this.reset(),!n)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,s,a){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new p(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=h.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var i=c.read(arguments),e=i.x,i=i.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var u=c.read(arguments,1),l=u.x,f=u.y,r=Math.cos(t),s=Math.sin(t),a=l-l*r+f*s,o=f-l*s-f*r,h=this._a,u=this._b,l=this._c,f=this._d;return this._a=r*h+s*l,this._b=r*u+s*f,this._c=-s*h+r*l,this._d=-s*u+r*f,this._tx+=a*h+o*l,this._ty+=a*u+o*f,this._changed(),this},shear:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0}),n=Math.PI/180,n=new c(Math.tan(t.x*n),Math.tan(t.y*n));return this.shear(n,e)},append:function(l){var e,i,n,r,s,a,o,h,u;return l&&(e=this._a,i=this._b,n=this._c,r=this._d,s=l._a,a=l._c,o=l._b,h=l._d,u=l._tx,l=l._ty,this._a=s*e+o*n,this._c=a*e+h*n,this._b=s*i+o*r,this._d=a*i+h*r,this._tx+=u*e+l*n,this._ty+=u*i+l*r,this._changed()),this},prepend:function(f){var e,i,n,r,s,a,o,h,u,l,c;return f&&(e=this._a,i=this._b,n=this._c,r=this._d,s=this._tx,a=this._ty,o=f._a,h=f._c,u=f._b,l=f._d,c=f._tx,f=f._ty,this._a=o*e+h*i,this._c=o*n+h*r,this._b=u*e+l*i,this._d=u*n+l*r,this._tx=o*s+h*a+c,this._ty=u*s+l*a+f,this._changed()),this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,a=t*n-e*i,o=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=n/a,this._b=-e/a,this._c=-i/a,this._d=t/a,this._tx=(i*s-n*r)/a,this._ty=(e*r-t*s)/a,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new p(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(c.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(r,e,i){var n=r.x,r=r.y;return(e=e||new c)._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var s=t[n],a=t[n+1];e[n]=s*this._a+a*this._c+this._tx,e[n+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(s){var e=s.x,i=s.y,n=e+s.width,s=i+s.height,s=[e,i,n,i,n,s,e,s];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=n[a],h=1&a;o<r[h]?r[h]=o:o>s[h]&&(s[h]=o)}return(e=e||new g)._set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(c.read(arguments))},_inverseTransform:function(d,e,i){var n=this._a,r=this._b,s=this._c,a=this._d,o=this._tx,f=this._ty,u=n*a-r*s,l=null;return u&&!isNaN(u)&&isFinite(o)&&isFinite(f)&&(f=d.x-this._tx,d=d.y-this._ty,l=(e=e||new c)._set((f*a-d*s)/u,(d*n-f*r)/u,i)),l},decompose:function(){var f,t,e,i,n=this._a,r=this._b,s=this._c,a=this._d,o=n*a-r*s,h=Math.sqrt,u=Math.atan2,l=180/Math.PI;return i=0!==n||0!==r?(f=h(n*n+r*r),t=Math.acos(n/f)*(0<r?1:-1),e=[f,o/f],[u(n*s+r*a,f*f),0]):0!==s||0!==a?(i=h(s*s+a*a),t=Math.asin(s/i)*(0<a?1:-1),e=[o/i,i],[0,u(n*s+r*a,i*i)]):e=[t=0,0],{translation:this.getTranslation(),rotation:t*l,scaling:new c(e),skewing:new c(i[0]*l,i[1]*l)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new c(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),m=r.extend({_class:"Line",initialize:function(t,e,i,n,r){(4<=arguments.length?(this._px=t,this._py=e,this._vx=i,this._vy=n,r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,i))||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new c(this._px,this._py)},getVector:function(){return new c(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return m.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return m.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(m.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return c.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return c.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,m,v,a,g,y,l){y||(i-=t,n-=e,a-=m,g-=v);y=i*g-n*a;if(!u.isZero(y)){m=t-m,v=e-v,g=(a*v-g*m)/y,v=(i*v-n*m)/y,m=-1e-12,y=1+1e-12;if(l||m<g&&g<y&&m<v&&v<y)return new c(t+(g=!l?g<=0?0:1<=g?1:g:g)*i,e+g*n)}},getSide:function(h,c,i,n,r,s,a,o){a||(i-=h,n-=c);h=r-h,c=h*n-(s-c)*i;return!o&&u.isZero(c)&&(0<=(c=(h*i+h*i)/(i*i+n*n))&&c<=1&&(c=0)),c<0?-1:0<c?1:0},getSignedDistance:function(t,e,i,n,r,s,a){return a||(i-=t,n-=e),0===i?0<n?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)},getDistance:function(t,e,i,n,r,s,a){return Math.abs(m.getSignedDistance(t,e,i,n,r,s,a))}}}),y=o.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){o.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new V(null,null,this),this._view=U.create(this,t||Q.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){1&t&&((a=this._view)&&(a._needsUpdate=!0,!a._requested&&a._autoUpdate&&a.requestUpdate()));var r,s,a,n=this._changes;n&&e&&((a=(r=this._changesById)[s=e._id])?a.flags|=t:n.push(r[s]={item:e,flags:t}))},clear:function(){for(var t=this._children,e=t.length-1;0<=e;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function ot(){return!!ot.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new b({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:P,match:function(r){var n=r._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var i,t=this._selectionItems,e=[];for(i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var e,t=this._selectionItems;for(e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(i,e){return e instanceof b?(e._remove(!1,!0),r.splice(this._children,[e],i,0),e._setProject(this,!0),(i=e._name)&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)):e=null,e},_insertItem:function(t,i,n){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new b(w.NO_INSERT),!0)).insertChild(t,i),n&&i.activate&&i.activate(),i},getItems:function(t){return w._getItems(this,t)},getItem:function(t){return w._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var s,r=i[n];for(s in e){var a=e[s];a&&a!=i&&delete a[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,s=new r({offset:new c(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new p],updateMatrix:!0}),a=0,o=n.length;a<o;a++)n[a].draw(t,s);if(t.restore(),0<this._selectionCount){t.save(),t.strokeWidth=1;var f,h=this._selectionItems,u=this._scope.settings.handleSize,l=this._updateVersion;for(f in h)h[f]._drawSelection(t,e,u,h,l);t.restore()}}}),w=r.extend(s,{statics:{extend:function ht(t){return t._serializeFields&&(t._serializeFields=r.set({},this.prototype._serializeFields,t._serializeFields)),ht.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new p,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),s=n&&!0===t.internal,a=this._matrix=new p,o=n&&t.project||paper.project,h=paper.settings;return this._id=s?null:l.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&h.applyMatrix,i&&a.translate(i),(a._owner=this)._style=new V(o._currentStyle,this,o),s||n&&!1===t.insert||!h.insertItems&&(!n||!0!==t.insert)?this._setProject(o):(n&&t.parent||o)._insertItem(e,this,!0),n&&t!==w.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){function i(i){for(var a in i){var o=s[a];r.equals(o,"leading"===a?1.2*i.fontSize:i[a])||(n[a]=r.serialize(o,t,"data"!==a,e))}}var n={},s=this;return i(this._serializeFields),this instanceof x||i(this._style._defaults),[this._class,n]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),n&&40&t&&w._clearBoundsCache(n),2&t&&w._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var n,r=this._getOwner();t&&r&&(n=r._children,((r=r._namedChildren)[t]=r[t]||[]).push(this),t in n||(n[t]=this)),this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide"],function(t){var e=r.capitalize(t),t="_"+t;this["get"+e]=function(){return this[t]},this["set"+e]=function(e){e!=this[t]&&(this[t]=e,this._changed("_locked"===t?128:129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(e){e!==this._selection&&(this._selection=e,(e=this._project)&&(e._updateSelection(this),this._changed(129)))},changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this.changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this.changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&((this._clipMask=t)&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(n){var e=this._position,i=n?c:f;return e||(n=this._pivot,e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)),new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(c.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new f(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=c.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof p,s=r.set({},i?e:t,this._boundsOptions);s.stroke&&!this.getStrokeScaling()||(s.cacheItem=this);s=this._getCachedBounds(i&&t,s);return arguments.length?s:new v(s.x,s.y,s.width,s.height,this,"setBounds")},setBounds:function(){var t=g.read(arguments),e=this.getBounds(),i=this._matrix,n=new p,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.set(i._backup||(new p).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(w._updateBoundsCache(this,e.cacheItem),w._getBounds(i,t,e)):new g},_getCachedBounds:function(t,e){t=t&&t._orNullIfIdentity();var s=e.internal,n=e.cacheItem,a=s?null:this._matrix._orNullIfIdentity(),s=n&&(!t||t.equals(a))&&[e.stroke?1:0,e.handle?1:0,s?1:0].join("");if(w._updateBoundsCache(this._parent||this._symbol,n),s&&this._bounds&&s in this._bounds)return this._bounds[s].rect.clone();a=this._getBounds(t||a,e);return s&&(this._bounds||(this._bounds={}),this._bounds[s]={rect:a.clone(),internal:e.internal}),a},_getStrokeMatrix:function(n,i){i=this.getStrokeScaling()?null:i&&i.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():n;return n&&n._shiftless()},statics:{_updateBoundsCache:function(n,e){var i;n&&e&&(i=e._id,(n=n._boundsCache=n._boundsCache||{ids:{},list:[]}).ids[i]||(n.list.push(e),n.ids[i]=e))},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,s=r.length;n<s;n++){var a=r[n];a!==t&&(a._bounds=a._position=e,a._boundsCache&&w._clearBoundsCache(a))}}},_getBounds:function(t,e,i){var s=n=1/0,a=r=-n;i=i||{};for(var o=0,h=t.length;o<h;o++){var n,r,l=t[o];l._visible&&!l.isEmpty()&&(l=l._getCachedBounds(e&&e.appended(l._matrix),i),n=Math.min(l.x,n),s=Math.min(l.y,s),r=Math.max(l.x+l.width,r),a=Math.max(l.y+l.height,a))}return isFinite(n)?new g(n,s,r-n,a-s):new g}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var i,e=this.getRotation();null!=e&&null!=t&&(i=this._decomposed,this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i))},getScaling:function(){var e=this._decompose(),e=e&&e.scaling;return new f(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var i,t=this.getScaling(),e=c.read(arguments,0,{clone:!0,readNull:!0});t&&e&&!t.equals(e)&&(i=this._decomposed,this.scale(e.x/t.x,e.y/t.y),i&&(i.scaling=e,this._decomposed=i))},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var n,e=this._globalMatrix,i=this._project._updateVersion;return(e=e&&e._updateVersion!==i?null:e)||(e=this._globalMatrix=this._matrix.clone(),(n=this._parent)&&e.prepend(n.getGlobalMatrix(!0)),e._updateVersion=i),t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function ut(t){ut.base.call(this,t);for(var e=this._children,i=0,n=e&&e.length;i<n;i++)e[i]._installEvents(t)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof b)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(a){var i=new this.constructor(w.NO_INSERT),n=this._children,h=r.pick(a?a.insert:e,a===e||!0===a),a=r.pick(a?a.deep:e,!0);n&&i.copyAttributes(this),n&&!a||i.copyContent(this),n||i.copyAttributes(this),h&&i.insertAbove(this);var o=this._name,h=this._parent;if(o&&h){for(var n=h._children,u=o,l=1;n[o];)o=u+" "+l++;o!==u&&i.setName(o)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,h){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,s=i.length;n<s;n++){var a=i[n];t.hasOwnProperty(a)&&(this[a]=t[a])}h||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,h=t._name;this._data=o?r.clone(o):null,h&&this.setName(h)},rasterize:function(l,i){var c=this.getStrokeBounds(),s=(l||this.getView().getResolution())/72,a=c.getTopLeft().floor(),f=c.getBottomRight().ceil(),h=new d(f.subtract(a)),u=new S(w.NO_INSERT);return h.isZero()||(c=(l=Q.getCanvas(h.multiply(s))).getContext("2d"),f=(new p).scale(s).translate(a.negate()),c.save(),f.applyToContext(c),this.draw(c,new r({matrices:[f]})),c.restore(),u.setCanvas(l)),u.transform((new p).translate(a.add(h.divide(2))).scale(1/s)),i!==e&&!i||u.insertAbove(this),u},contains:function(){return!!this._contains(this._matrix._inverseTransform(c.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;0<=i;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return g.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new L.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof w&&0<this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length}},new function(){function t(){return this._hitTest(c.read(arguments),M.getOptions(arguments))}function e(){var t=c.read(arguments),e=M.getOptions(arguments),i=[];return this._hitTest(t,r.set({all:i},e)),i}function i(t,e,i,n){var r=this._children;if(r)for(var s=r.length-1;0<=s;s--){var o=r[s],o=o!==n&&o._hitTest(t,e,i);if(o&&!e.all)return o}return null}return y.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,f){function n(t){return(t=t&&_&&!_(t)?null:t)&&e.all&&e.all.push(t),t}function s(e,i){var n=l["get"+i]();if(t.subtract(n).divide(u).length<=1)return new M(e,g,{name:r.hyphenate(i),point:n})}if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var a=this._matrix,o=f?f.appended(a):this.getGlobalMatrix().prepend(this.getView()._matrix),f=Math.max(e.tolerance,1e-12),u=e._tolerancePadding=new d(L._getStrokePadding(f,a.inverted()._shiftless()));if(!(t=a._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(u.multiply(2))._containsPoint(t))return null;var l,c,f=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),_=e.match,g=this;if(f&&(e.center||e.bounds)&&this._parent){if(l=this.getInternalBounds(),!(c=e.center?s("center","Center"):c)&&e.bounds)for(var v=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],p=0;p<8&&!c;p++)c=s("bounds",v[p]);c=n(c)}return(c=c||(this._hitTestChildren(t,e,o)||f&&n(this._hitTestSelf(t,e,o,this.getStrokeScaling()?null:o.inverted()._shiftless()))||null))&&c.point&&(c.point=a.transform(c.point)),c},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new M("fill",this)},matches:function(t,e){var a=typeof t;if("object"==a){for(var s in t)if(t.hasOwnProperty(s)&&!this.matches(s,t[s]))return!1;return!0}if("function"==a)return t(this);if("match"===t)return e(this);a=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;a=this._class}if("function"==typeof e)return!!e(a);if(e){if(e.test)return e.test(a);if(r.isPlainObject(e))return function i(t,e){for(var a in t)if(t.hasOwnProperty(a)){var s=t[a],a=e[a];if(r.isPlainObject(s)&&r.isPlainObject(a)){if(!i(s,a))return!1}else if(!r.equals(s,a))return!1}return!0}(e,a)}return r.equals(a,e)},getItems:function(t){return w._getItems(this,t,this._matrix)},getItem:function(t){return w._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function lt(t,e,i,n,s){var a,o,h;n||(o=(a="object"==typeof e&&e)&&a.overlapping,h=a&&a.inside,l=(u=o||h)&&g.read([u]),n={items:[],recursive:a&&!1!==a.recursive,inside:!!h,overlapping:!!o,rect:l,path:o&&new L.Rectangle({rectangle:l,insert:!1})},a&&(e=r.filter({},e,{recursive:!0,inside:!0,overlapping:!0})));var l,c=t._children,f=n.items;i=(l=n.rect)&&(i||new p);for(var d=0,_=c&&c.length;d<_;d++){var v=c[d],m=i&&i.appended(v._matrix),y=!0;if(l){var u=v.getBounds(m);if(!l.intersects(u))continue;l.contains(u)||n.overlapping&&(u.contains(l)||n.path.intersects(v,m))||(y=!1)}if(y&&v.matches(e)&&(f.push(v),s))break;if(!1!==n.recursive&&lt(v,e,m,n,s),s&&0<f.length)break}return f}}},{importJSON:function(e){e=r.importJSON(e,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,i){i=i?this.insertChildren(t,[i]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&0<e.length){for(var n=(e=r.slice(e)).length-1;0<=n;n--)(s=e[n])?s._remove(!1,!0):e.splice(n,1);r.splice(i,e,t,0);for(var a=this._project,o=a._changes,n=0,h=e.length;n<h;n++){var s,u=(s=e[n])._name;s._parent=this,s._setProject(a,!0),u&&s.setName(u),o&&this._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",copyTo:function(t){return t._insertItem(e,this.clone(!1))},reduce:function(i){var e=this._children;if(e&&1===e.length){i=e[0].reduce(i);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var e,i,n,r,s=this._getOwner();s&&(e=s._children,-1!==(s=(r=(i=s._namedChildren)[n=this._name])?r.indexOf(this):-1)&&(e[n]==this&&delete e[n],r.splice(s,1),r.length?e[n]=r[0]:delete i[n]))},_remove:function(t,e){var i=this._getOwner(),n=this._project,s=this._index;return!!i&&(this._name&&this._removeNamed(),null!=s&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,s,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),!(this._parent=null))},remove:function(){return this._remove(!0,!0)},replaceWith:function(e){e=e&&e.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;0<=n;n--)i[n]._remove(!0,!1);return 0<i.length&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){for(var e=[];e.unshift(t),t=t._parent;);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:c).read(arguments),n=c.read(arguments,0,{readNull:!0});return this.transform((new p)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new p;return this.transform(t.translate.apply(t,arguments))},transform:function(t,u,h,v){t&&t.isIdentity()&&(t=null);var a,c=this._matrix,s=(u||this._applyMatrix)&&(!c.isIdentity()||t||u&&h&&this._children);if(!t&&!s)return this;t&&(!t.isInvertible()&&c.isInvertible()&&(c._backup=c.getValues()),c.prepend(t)),(s=s&&this._transformContent(c,h,v))&&(a=this._pivot,h=(u=this._style).getFillColor(!0),u=u.getStrokeColor(!0),a&&c._transformPoint(a,a,!0),h&&h.transform(c),u&&u.transform(c),c.reset(!0),v&&this._canApplyMatrix&&(this._applyMatrix=!0));var l=this._bounds,c=this._position;this._changed(9);v=l&&t&&t.decompose();if(v&&!v.shearing&&v.rotation%90==0){for(var _ in l){_=l[_];!s&&_.internal||(g=_.rect,t._transformBounds(g,g))}var g,v=this._boundsGetter;(g=l[v&&v.getBounds||v||"getBounds"])&&(this._position=g.getCenter(!0)),this._bounds=l}else t&&c&&(this._position=t._transformPoint(c,c));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(c.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(c.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(c.read(arguments))},localToParent:function(){return this._matrix._transformPoint(c.read(arguments))},fitBounds:function(t,e){t=g.read(arguments);var i=this.getBounds(),n=i.height/i.width,a=t.height/t.width,a=(e?a<n:n<a)?t.width/i.width:t.height/i.height,a=new g(new c,new d(i.width*a,i.height*a));a.setCenter(t.getCenter()),this.setBounds(a)}}),{_setStyles:function(t,f,d){var r,o,h,n=this._style;n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t)),n.hasStroke()&&(t.strokeStyle=n.getStrokeColor().toCanvasStyle(t),t.lineWidth=n.getStrokeWidth(),r=n.getStrokeJoin(),o=n.getStrokeCap(),h=n.getMiterLimit(),r&&(t.lineJoin=r),o&&(t.lineCap=o),h&&(t.miterLimit=h),paper.support.nativeDash&&(o=n.getDashArray(),h=n.getDashOffset(),o&&o.length&&("setLineDash"in t?(t.setLineDash(o),t.lineDashOffset=h):(t.mozDash=o,t.mozDashOffset=h)))),n.hasShadow()&&(f=f.pixelRatio||1,f=(d=d._shiftless().prepend((new p).scale(f,f))).transform(new c(n.getShadowBlur(),0)),d=d.transform(this.getShadowOffset()),t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=f.getLength(),t.shadowOffsetX=d.x,t.shadowOffsetY=d.y)},draw:function(t,e,w){var g=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,s=e.viewMatrix,a=this._matrix,v=r[r.length-1].appended(a);if(v.isInvertible()){s=s?s.appended(v):v,r.push(v),e.updateMatrix&&(v._updateVersion=g,this._globalMatrix=v);var h,u,l,c=this._blendMode,f=this._opacity,m="normal"===c,_=tt.nativeModes[c],g=m&&1===f||e.dontStart||e.clip||(_||m&&f<1)&&this._canComposite(),v=e.pixelRatio||1;if(!g){var x=this.getStrokeBounds(s);if(!x.width||!x.height)return;l=e.offset,u=e.offset=x.getTopLeft().floor(),h=t,t=Q.getContext(x.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();m=w?w.appended(a):this._canScaleStroke&&!this.getStrokeScaling(!0)&&s,x=!g&&e.clipItem,w=!m||x;g?(t.globalAlpha=f,_&&(t.globalCompositeOperation=c)):w&&t.translate(-u.x,-u.y),w&&(g?a:s).applyToContext(t),x&&e.clipItem.draw(t,e.extend({clip:!0})),m&&(t.setTransform(v,0,0,v,0,0),(x=e.offset)&&t.translate(-x.x,-x.y)),this._draw(t,e,s,m),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),g||(tt.process(c,t,h,f,u.subtract(l).multiply(v)),Q.release(t),e.offset=l)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof N)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,c,i,n,r){var d=this._selection,a=1&d,o=2&d||a&&this._selectBounds,d=4&d;if(((a=!this._drawSelected?!1:a)||o||d)&&this._isUpdated(r)){var l=this.getSelectedColor(!0)||(l=this.getLayer())&&l.getSelectedColor(!0),c=c.appended(this.getGlobalMatrix(!0)),f=i/2;if(t.strokeStyle=t.fillStyle=l?l.toCanvasStyle(t):"#009dec",a&&this._drawSelected(t,c,n),d){var d=this.getPosition(!0),_=d.x,g=d.y;t.beginPath(),t.arc(_,g,f,0,2*Math.PI,!0),t.stroke();for(var v=[[0,-1],[1,0],[0,1],[-1,0]],p=f,m=i+1,y=0;y<4;y++){var b=v[y],x=b[0],b=b[1];t.moveTo(_+x*p,g+b*p),t.lineTo(_+x*m,g+b*m),t.stroke()}}if(o){var C=c._transformCorners(this.getInternalBounds());t.beginPath();for(y=0;y<8;y++)t[y?"lineTo":"moveTo"](C[y],C[++y]);t.closePath(),t.stroke();for(y=0;y<8;y++)t.fillRect(C[y]-f,C[++y]-f,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var r in t){var i;t[r]&&(i="mouse"+r,(r=(r=this._project)._removeSets=r._removeSets||{})[i]=r[i]||{},r[i][this._id]=this)}return this}})),x=w.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function ct(t){ct.base.call(this,t),1026&t&&(this._clipItem=e)},_getClipItem:function(){if((t=this._clipItem)===e){for(var t=null,i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function ft(t,e){var i=this._getClipItem();return i?i._getCachedBounds(t&&t.appended(i._matrix),r.set({},e,{stroke:!1})):ft.base.call(this,t,e)},_hitTestChildren:function dt(t,e,i){var n=this._getClipItem();return(!n||n.contains(t))&&dt.base.call(this,t,e,i,n)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,a=r.length;s<a;s++){var o=r[s];o!==n&&o.draw(t,e)}}}),b=x.extend({_class:"Layer",initialize:function(){x.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function _t(){return this._parent?_t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),C=w.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t){this._initialize(t)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new _(t.width,t.height,this,"setSize")},setSize:function(){var e,i,n,t=d.read(arguments);this._size?this._size.equals(t)||(e=this._type,i=t.width,n=t.height,"rectangle"===e?this._radius.set(d.min(this._radius,t.divide(2))):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)):this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new _(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size._set(i,i)}else if(t=d.read(arguments),this._radius){if(this._radius.equals(t))return;this._radius.set(t),"rectangle"===e?(i=d.max(this._size,t.multiply(2)),this._size.set(i)):"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new L[r.capitalize(this._type)]({center:new c,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),paper.settings.applyMatrix&&i.setApplyMatrix(!0),t!==e&&!t||i.insertAbove(this),i},toShape:"#clone",_draw:function(t,e,i,n){var f,d,m,w,b,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=e.dontFinish||e.clip,p=!n;(s||a||o)&&(m=this._type,w=this._radius,b="circle"===m,e.dontStart||t.beginPath(),p&&b?t.arc(0,0,w,0,2*Math.PI,!0):(f=b?w:w.width,d=b?w:w.height,w=(b=this._size).width,b=b.height,p&&"rectangle"===m&&0===f&&0===d?t.rect(-w/2,-b/2,w,b):(b=[-(p=w/2),-(m=b/2)+d,-p,(b=d*(w=.44771525016920644))-m,(w=f*w)-p,-m,-p+f,-m,p-f,-m,p-w,-m,p,b-m,p,-m+d,p,m-d,p,m-b,p-w,m,p-f,m,-p+f,m,w-p,m,-p,m-b,-p,m-d],n&&n.transform(b,b,32),t.moveTo(b[0],b[1]),t.bezierCurveTo(b[2],b[3],b[4],b[5],b[6],b[7]),p!==f&&t.lineTo(b[8],b[9]),t.bezierCurveTo(b[10],b[11],b[12],b[13],b[14],b[15]),m!==d&&t.lineTo(b[16],b[17]),t.bezierCurveTo(b[18],b[19],b[20],b[21],b[22],b[23]),p!==f&&t.lineTo(b[24],b[25]),t.bezierCurveTo(b[26],b[27],b[28],b[29],b[30],b[31]))),t.closePath()),o||!s&&!a||(this._setStyles(t,e,i),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0),r=this._style,r=e.stroke&&r.hasStroke()&&r.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(L._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=1;s<=4;s++){var a=new c(1<s&&s<4?-1:1,2<s?-1:1),o=a.multiply(r),h=o.subtract(a.multiply(n));if(new g(i?o.add(a.multiply(i)):o,h).contains(e))return{point:h,quadrant:s}}}function e(r,e,i,n){r=r.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function i(e){if("rectangle"!==this._type)return e.divide(this.size).getLength()<=.5;var n=t(this,e);return n?e.subtract(n.point).divide(this._radius).getLength()<=1:i.base.call(this,e)},_hitTestSelf:function n(i,r,s,a){var f,m,w,o=!1,y=this._style,u=r.stroke&&y.hasStroke(),_=r.fill&&y.hasFill();return(u||_)&&(m=this._type,f=this._radius,w=u?y.getStrokeWidth()/2:0,_=r._tolerancePadding.add(L._getStrokePadding(w,!y.getStrokeScaling()&&a)),o="rectangle"===m?(y=t(this,i,w=_.multiply(2)))?e(i.subtract(y.point),f,_,y.quadrant):(y=(m=new g(this._size).setCenter(0,0)).expand(w),w=m.expand(w.negate()),y._containsPoint(i)&&!w._containsPoint(i)):e(i,f,_)),o?new M(u?"stroke":"fill",this):n.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,a){a=new C(r.getNamed(a));return a._type=t,a._size=i,a._radius=n,a.translate(e)}return{Circle:function(){var e=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return t("circle",e,new d(2*i),i,arguments)},Rectangle:function(){var e=g.readNamed(arguments,"rectangle"),i=d.min(d.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=C._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;return i=r.hasNamed(t,"radius")?(e=c.readNamed(t,"center"),d.readNamed(t,"radius")):(e=(i=g.readNamed(t,"rectangle")).getCenter(!0),i.getSize(!0).divide(2)),{center:e,radius:i}}}}}),S=w.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],initialize:function(t,i){var r;this._initialize(t,i!==e&&c.read(arguments,1))||((r="string"==typeof t?n.getElementById(t):t)?this.setImage(r):this.setSource(t)),this._size||(this._size=new d,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var n=t._image,i=t._canvas;n?this._setImage(n):i&&((n=Q.getCanvas(t._size)).getContext("2d").drawImage(i,0,0),this._setImage(n)),this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new _(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var e,t=d.read(arguments);t.equals(this._size)||(0<t.width&&0<t.height?(e=this.getElement(),this._setImage(Q.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)):(this._canvas&&Q.release(this._canvas),this._size=t.clone()))},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,n=new c(0,0).transform(t),i=new c(1,0).transform(t).subtract(n),n=new c(0,1).transform(t).subtract(n);return new d(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){function e(t){var e=i.getView(),n=t&&t.type||"load";e&&i.responds(n)&&(paper=e._scope,i.emit(n,new G(t)))}var i=this;this._setImage(t),this._loaded?setTimeout(e,0):t&&Z.add(t,{load:function(n){i._setImage(t),e(n)},error:e})},_setImage:function(t){this._canvas&&Q.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new d(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=Q.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){Q.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var i=new t.Image,n=this._crossOrigin;n&&(i.crossOrigin=n),i.src=e,this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=g.read(arguments),e=Q.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=g.read(arguments),e=new S(w.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var i=this._image,i=i&&i.src;if(/^data:/.test(i))return i;i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=c.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(o){if(o?o instanceof A?l=(u=o).getBounds():"object"==typeof o&&("width"in o?l=new g(o):"x"in o&&(l=new g(o.x-.5,o.y-.5,1,1))):l=this.getBounds(),!l)return null;var s=Math.min(l.width,32),a=Math.min(l.height,32),o=S._sampleContext;o?o.clearRect(0,0,33,33):o=S._sampleContext=Q.getContext(new d(32)),o.save();var l=(new p).scale(s/l.width,a/l.height).translate(-l.x,-l.y);l.applyToContext(o),u&&u.draw(o,new r({clip:!0,matrices:[l]})),this._matrix.applyToContext(o);var u=this.getElement(),l=this._size;u&&o.drawImage(u,-l.width/2,-l.height/2),o.restore();for(var c=o.getImageData(.5,.5,Math.ceil(s),Math.ceil(a)).data,f=[0,0,0],_=0,v=0,m=c.length;v<m;v+=4){var y=c[v+3];_+=y,y/=255,f[0]+=c[v]*y,f[1]+=c[v+1]*y,f[2]+=c[v+2]*y}for(v=0;v<3;v++)f[v]/=_;return _?F.read(f):null},getPixel:function(){var e=c.read(arguments),e=this.getContext().getImageData(e.x,e.y,1,1).data;return new F("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=c.read(arguments),a=F.read(arguments),i=a._convert("rgb"),n=a._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*i[0],a[1]=255*i[1],a[2]=255*i[2],a[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=d.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=g.read(arguments);return t.isEmpty()&&(t=new g(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=c.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new M("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),P=w.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&c.read(arguments,1))||this.setDefinition(t instanceof I?t:new I(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,r,n){r=this._definition._item._hitTest(t,e,r);return r&&(r.item=this),r},_draw:function(t,e){this._definition._item.draw(t,e)}}),I=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=l.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&w._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),(this._item=t).remove(),t.setSelected(!1),e||t.setPosition(new c),(t._symbol=this)._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new P(this,t)},clone:function(){return new I(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),M=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&(i.enumerable=!0,this.inject(i))},statics:{getOptions:function(e){e=e&&r.read(e);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),T=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,s,a){var o,h,u,l,c=arguments.length;0<c&&(null==t||"object"==typeof t?l=1===c&&t&&"point"in t?(o=t.point,h=t.handleIn,u=t.handleOut,t.selection):(o=t,h=i,u=n,r):(o=[t,i],h=n!==e?[n,r]:null,u=s!==e?[s,a]:null)),new z(o,this,"_point"),new z(h,this,"_handleIn"),new z(u,this,"_handleOut"),l&&this.setSelection(l)},_serialize:function(t,e){var s=this._point,n=this._selection,s=n||this.hasHandles()?[s,this._handleIn,this._handleOut]:s;return n&&s.push(n),r.serialize(s,t,!0,e)},_changed:function(t){var i,n,r,e=this._path;e&&(n=e._curves,r=this._index,n&&(t&&t!==this._point&&t!==this._handleIn||!(i=0<r?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25))},getPoint:function(){return this._point},setPoint:function(){this._point.set(c.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(c.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(c.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(129))},changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this.changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(0<e&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new O(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(x,i,n){var g=x||{},p=g.type,y=g.factor,o=this.getPrevious(),h=this.getNext(),u=(o||this)._point,l=this._point,f=(h||this)._point,w=u.getDistance(l),x=l.getDistance(f);if(p&&"catmull-rom"!==p){if("geometric"!==p)throw new Error("Smoothing method '"+p+"' not supported.");o&&h&&(g=u.subtract(f),p=(b=y===e?.4:y)*w/(w+x),i||this.setHandleIn(g.multiply(p)),n||this.setHandleOut(g.multiply(p-b)))}else{var C,S,b=y===e?.5:y,y=Math.pow(w,b),w=y*y,x=Math.pow(x,b),b=x*x;!i&&o&&(C=2*b+3*x*y+w,this.setHandleIn(0!==(S=3*x*(x+y))?new c((b*u._x+C*l._x-w*f._x)/S-l._x,(b*u._y+C*l._y-w*f._y)/S-l._y):new c)),!n&&h&&(C=2*w+3*y*x+b,this.setHandleOut(0!==(S=3*y*(y+x))?new c((w*f._x+C*l._x-b*u._x)/S-l._x,(w*f._y+C*l._y-b*u._y)/S-l._y):new c))}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new T(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new T(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(l,u,h){var n=1-h,r=h,s=l._point,a=u._point,o=l._handleIn,h=u._handleIn,u=u._handleOut,l=l._handleOut;this._point._set(n*s._x+r*a._x,n*s._y+r*a._y,!0),this._handleIn._set(n*o._x+r*h._x,n*o._y+r*h._y,!0),this._handleOut._set(n*l._x+r*u._x,n*l._y+r*u._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,a=n._x,o=n._y,h=2;return e[0]=a,e[1]=o,r&&(e[h++]=r._x+a,e[h++]=r._y+o),s&&(e[h++]=s._x+a,e[h++]=s._y+o),t&&(t._transformCoordinates(e,e,h/2),a=e[0],o=e[1],i?(n._x=a,n._y=o,h=2,r&&(r._x=e[h++]-a,r._y=e[h++]-o),s&&(s._x=e[h++]-a,s._y=e[h++]-o)):(r||(e[h++]=a,e[h++]=o),s||(e[h++]=a,e[h++]=o))),e}}),z=c.extend({initialize:function(t,i,n){var r,s,a;t?(r=t[0])!==e?s=t[1]:((r=(a=t).x)===e&&(r=(a=c.read(arguments)).x),s=a.y,a=a.selected):r=s=0,this._x=r,this._y=s,(this._owner=i)[n]=this,a&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=u.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),k=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,s,a,o){var h,u,l,c,f,d,_=arguments.length;3===_?(this._path=t,h=e,u=i):_?1===_?"segment1"in t?(h=new T(t.segment1),u=new T(t.segment2)):"point1"in t?(l=t.point1,f=t.handle1,d=t.handle2,c=t.point2):Array.isArray(t)&&(l=[t[0],t[1]],c=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]):2===_?(h=new T(t),u=new T(e)):4===_?(l=t,f=e,d=i,c=n):8===_&&(l=[t,e],c=[a,o],f=[i-t,n-e],d=[r-a,s-o]):(h=new T,u=new T),this._segment1=h||new T(l,null,f),this._segment2=u||new T(c,d,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new k(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return k.classify(this.getValues())},remove:function(){var e,i,t=!1;return this._path&&(i=(e=this._segment2)._handleOut,(t=e.remove())&&this._segment1._handleOut.set(i)),t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(c.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(c.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(c.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(c.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return k.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new c(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=k.getLength(this.getValues(),0,1)),this._length},getArea:function(){return k.getArea(this.getValues())},getLine:function(){return new m(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new k(k.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return k.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(f,g){var a,o,h,u,l,d,r=null;return 1e-8<=f&&f<=1-1e-8&&(a=(d=k.subdivide(this.getValues(),f))[0],o=d[1],h=g||this.hasHandles(),u=this._segment1,l=this._segment2,f=this._path,h&&(u._handleOut._set(a[2]-a[0],a[3]-a[1]),l._handleIn._set(o[4]-o[6],o[5]-o[7])),d=a[6],g=a[7],g=new T(new c(d,g),h&&new c(a[4]-d,a[5]-g),h&&new c(o[2]-d,o[3]-g)),r=f?(f.insert(u._index+1,g),this.getNext()):(this._segment2=g,this._changed(),new k(g,l))),r},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new k(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(h,u,i,n){var l=h._point,s=h._handleOut,a=u._handleIn,f=u._point,h=l.x,u=l.y,l=f.x,f=f.y,f=n?[h,u,h,u,l,f,l,f]:[h,u,h+s._x,u+s._y,l+a._x,f+a._y,l,f];return i&&i._transformCoordinates(f,f,4),f},subdivide:function(v,C){var n=v[0],r=v[1],p=v[2],m=v[3],y=v[4],w=v[5],u=v[6],l=v[7],c=1-(C=C===e?.5:C),f=c*n+C*p,d=c*r+C*m,x=c*p+C*y,b=c*m+C*w,v=c*y+C*u,p=c*w+C*l,m=c*f+C*x,y=c*d+C*b,w=c*x+C*v,x=c*b+C*p,b=c*m+C*w,C=c*y+C*x;return[[n,r,f,d,m,y,b,C],[b,C,w,x,v,p,u,l]]},getMonoCurves:function(t,a){var _,g,i=[],o=a?0:1,p=t[0+o],v=t[2+o],a=t[4+o],o=t[6+o];return!(v<=p==a<=v&&a<=v==o<=a||k.isStraight(t))&&(g=u.solveQuadratic(3*(v-a)-p+o,2*(p+a)-4*v,v-p,_=[],1e-8,1-1e-8))?(_.sort(),v=_[0],p=k.subdivide(t,v),i.push(p[0]),1<g&&(v=(_[1]-v)/(1-v),p=k.subdivide(p[1],v),i.push(p[0])),i.push(p[1])):i.push(t),i},solveCubic:function(f,c,i,n,r,s){var a=f[c],d=f[c+2],h=f[c+4],f=f[c+6],c=0;return c=!(a<i&&f<i&&d<i&&h<i||i<a&&i<f&&i<d&&i<h)?u.solveCubic(f-a-(f=3*(d-a))-(d=3*(h-d)-f),d,f,a-i,n,r,s):c},getTimeOf:function(t,e){var i=new c(t[0],t[1]),n=new c(t[6],t[7]),s=1e-7;if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var o=[e.x,e.y],h=[],u=0;u<2;u++)for(var l=k.solveCubic(t,u,o[u],h,0,1),f=0;f<l;f++){var d=h[f];if(e.isClose(k.getPoint(t,d),s))return d}return e.isClose(i,s)?0:e.isClose(n,s)?1:null},getNearestTime:function(t,e){function i(i){if(0<=i&&i<=1){var n=e.getDistance(k.getPoint(t,i),!0);return n<d?(d=n,_=i,1):void 0}}if(k.isStraight(t)){var n=t[0],r=t[1],o=t[6]-n,h=t[7]-r,l=o*o+h*h;if(0==l)return 0;l=((e.x-n)*o+(e.y-r)*h)/l;return l<1e-12?0:.999999999999<l?1:k.getTimeOf(t,new c(n+l*o,r+l*h))}for(var d=1/0,_=0,g=0;g<=100;g++)i(g/100);for(var v=.005;1e-8<v;)i(_-v)||i(_+v)||(v/=2);return _},getPart:function(t,e,i){var r,n=i<e;return n&&(r=e,e=i,i=r),0<e&&(t=k.subdivide(t,e)[1]),i<1&&(t=k.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(u,e){var f=u[0],d=u[1],l=u[2],c=u[3],a=u[4],o=u[5],h=u[6],u=u[7],l=3*l-2*f-h,c=3*c-2*d-u,f=3*a-2*h-f,d=3*o-2*u-d;return Math.max(l*l,f*f)+Math.max(c*c,d*d)<=16*e*e},getArea:function(h){var e=h[0],i=h[1],n=h[2],r=h[3],s=h[4],a=h[5],o=h[6],h=h[7];return 3*((h-i)*(n+s)-(o-e)*(r+a)+r*(e-s)-n*(i-a)+h*(s+e/3)-o*(a+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)k._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new g(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,a,o,h){function l(t,n){var i=t-n,n=t+n;i<a[r]&&(a[r]=i),n>o[r]&&(o[r]=n)}var c=a[r]-(s/=2),f=o[r]+s;if(t<c||e<c||i<c||n<c||f<t||f<e||f<i||f<n)if(e<t!=e<n&&i<t!=i<n)l(t,s),l(n,s);else{var v=u.solveQuadratic(3*(e-i)-t+n,2*(t+i)-4*e,e-t,h);l(n,0);for(var y=0;y<v;y++){var w=h[y],x=1-w;1e-8<=w&&w<=1-1e-8&&l(x*x*x*t+3*x*x*w*e+3*x*w*w*i+w*w*w*n,s)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){return this._bounds||(this._bounds={}),(this._bounds[t]||(this._bounds[t]=L[t]([this._segment1,this._segment2],!1,this._path))).clone()}},{}),r.each({isStraight:function(t,h,i,u){if(h.isZero()&&i.isZero())return!0;var r=u.subtract(t);if(r.isZero())return!1;if(r.isCollinear(h)&&r.isCollinear(i)){var s=new m(t,u);if(s.getDistance(t.add(h))<1e-7&&s.getDistance(u.add(i))<1e-7){u=r.dot(r),h=r.dot(h)/u,u=r.dot(i)/u;return 0<=h&&h<=1&&u<=0&&-1<=u}}return!1},isLinear:function(r,e,i,n){r=n.subtract(r).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],s=e[6],a=e[7];return t(new c(n,r),new c(e[2]-n,e[3]-r),new c(e[4]-s,e[5]-a),new c(s,a),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&0<=t&&t<=1?new O(this,t):null},getTimeAt:function(t,e){return k.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(c.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return k.getTimeOf(this.getValues(),c.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=c.read(arguments),n=this.getValues(),i=k.getNearestTime(n,t),n=k.getPoint(n,i);return new O(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t&&t.getPoint()}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return k[t](n,i?e:k.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return k[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(h){var e=h[0],i=h[1],n=h[2],r=h[3],s=h[4],a=h[5],o=h[6],h=h[7],u=9*(n-s)+3*(o-e),l=6*(e+s)-12*n,c=3*(n-e),f=9*(r-a)+3*(h-i),d=6*(i+a)-12*r,_=3*(r-i);return function(i){var e=(u*i+l)*i+c,i=(f*i+d)*i+_;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(I,e,i,n){if(null==e||e<0||1<e)return null;var C=I[0],S=I[1],a=I[2],P=I[3],h=I[4],l=I[5],f=I[6],d=I[7],b=u.isZero;b(a-C)&&b(P-S)&&(a=C,P=S),b(h-f)&&b(l-d)&&(h=f,l=d);var v,g,p=3*(a-C),m=3*(h-a)-p,y=f-C-p-m,w=3*(P-S),I=3*(l-P)-w,b=d-S-w-I;return 0===i?(g=0===e?C:1===e?f:((y*e+m)*e+p)*e+C,v=0===e?S:1===e?d:((b*e+I)*e+w)*e+S):(S=1-(C=1e-8),v=e<C?(g=p,w):S<e?(g=3*(f-h),3*(d-l)):(g=(3*y*e+2*m)*e+p,(3*b*e+2*I)*e+w),n&&(0===g&&0===v&&(e<C||S<e)&&(g=h-a,v=l-P),(P=Math.sqrt(g*g+v*v))&&(g/=P,v/=P)),3===i&&(h=6*y*e+2*m,l=6*b*e+2*I,g=0!==(I=Math.pow(g*g+v*v,1.5))?(g*l-v*h)/I:0,v=0)),2===i?new c(v,-g):new c(g,v)}return{statics:{classify:function(d){function i(t,i,n){var r=i!==e,s=r&&0<i&&i<1,a=r&&0<n&&n<1;return!r||(s||a)&&("loop"!==t||s&&a)||(s=a=!(t="arch")),{type:t,roots:s||a?s&&a?i<n?[i,n]:[n,i]:[s?i:n]:null}}var n=d[0],r=d[1],b=d[2],v=d[3],C=d[4],x=d[5],S=d[6],y=d[7],d=b*(r-y)+v*(S-n)+n*y-r*S,b=3*(C*(v-r)+x*(n-b)+b*r-v*n),v=b-d,S=v-d+(n*(y-x)+r*(C-S)+S*x-y*C),x=Math.sqrt(S*S+v*v+b*b),y=0!==x?1/x:0,C=u.isZero,x="serpentine";if(v*=y,b*=y,C(S*=y))return C(v)?i(C(b)?"line":"quadratic"):i(x,b/(3*v));b=3*v*v-4*S*b;if(C(b))return i("cusp",v/(2*S));C=0<b?Math.sqrt(b/3):Math.sqrt(-b),S*=2;return i(0<b?x:"loop",(v+C)/S,(v-C)/S)},getLength:function(n,r,s,a){if(r===e&&(r=0),s===e&&(s=1),k.isStraight(n)){var l=n;s<1&&(l=k.subdivide(l,s)[0],r/=s);var h=(l=0<r?k.subdivide(l,r)[1]:l)[6]-l[0],l=l[7]-l[1];return Math.sqrt(h*h+l*l)}return u.integrate(a||t(n),r,s,i(r,s))},getTimeAt:function(g,r,s){if(s===e&&(s=r<0?1:0),0===r)return s;var o=Math.abs,l=0<r,c=l?s:0,f=l?1:s,d=t(g),_=k.getLength(g,c,f,d),g=o(r)-_;if(o(g)<1e-12)return l?f:c;if(1e-12<g)return null;var p=0;return u.findRoot(function(t){return p+=u.integrate(d,s,t,i(s,t)),s=t,p-r},d,s+r/_,c,f,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(d){var e=d[0],g=d[1],f=d[2],m=d[3],c=d[4],_=d[5],l=3*f-e-3*c+d[6],c=3*e-6*f+3*c,f=-3*e+3*f,d=3*m-g-3*_+d[7],_=3*g-6*m+3*_,g=-3*g+3*m,m=[];return u.solveCubic(9*(l*l+d*d),9*(l*c+_*d),2*(c*c+_*_)+3*(f*l+g*d),f*c+_*g,m,1e-8,1-1e-8),m.sort()}}}},new function(){function t(t,e,i,d,r,s,a,o,_){var u=!_&&i.getPrevious()===s,l=!_&&i!==s&&i.getNext()===s,c=1e-8,f=1-c;null!==(d=null==d?i.getTimeOf(r):d)&&(u?c:0)<=d&&d<=(l?f:1)&&(null!==(a=null==a?s.getTimeOf(o):a)&&(l?c:0)<=a&&a<=(u?f:1))&&(d=new O(i,d,r||i.getPointAtTime(d),_),_=new O(s,a,o||s.getPointAtTime(a),_),(d._intersection=_)._intersection=d,e&&!e(d)||O.insert(t,d,!0))}function e(r,s,a,o,h,u,l,c,f,R,_,g,v){if(4096<=++f||40<=++c)return f;var p,y,x=s[0],B=s[1],D=s[6],E=s[7],P=m.getSignedDistance,I=P(x,B,D,E,s[2],s[3]),M=P(x,B,D,E,s[4],s[5]),N=0<I*M?.75:4/9,z=N*Math.min(0,I,M),F=N*Math.max(0,I,M),A=P(x,B,D,E,r[0],r[1]),L=P(x,B,D,E,r[2],r[3]),N=P(x,B,D,E,r[4],r[5]),B=P(x,B,D,E,r[6],r[7]),D=function(l,u,i,c){var s=[0,l],a=[1/3,u],o=[2/3,i],r=[1,c],u=u-(2*l+c)/3,l=i-(l+2*c)/3;r=u*l<0?[[s,a,r],[s,o,r]]:[2<=(c=u/l)?[s,a,r]:c<=.5?[s,o,r]:[s,a,o,r],[s,r]];return(u||l)<0?r.reverse():r}(A,L,N,B),E=D[0],D=D[1];if(0===I&&0===M&&0===A&&0===L&&0===N&&0===B||null==(p=n(E,D,z,F))||null==(y=n(E.reverse(),D.reverse(),z,F)))return f;var q,H,V,F=R+(_-R)*p,R=R+(_-R)*y;return Math.max(v-g,R-F)<1e-9?(q=(F+R)/2,V=(g+v)/2,t(h,u,l?o:a,l?V:q,null,l?a:o,l?q:V,null)):(r=k.getPart(r,p,y),f=.8<y-p?v-g<R-F?(q=(F+R)/2,f=e(s,(H=k.subdivide(r,.5))[0],o,a,h,u,!l,c,f,g,v,F,q),e(s,H[1],o,a,h,u,!l,c,f,g,v,q,R)):(V=(g+v)/2,f=e((H=k.subdivide(s,.5))[0],r,o,a,h,u,!l,c,f,g,V,F,R),e(H[1],r,o,a,h,u,!l,c,f,V,v,F,R)):1e-9<=v-g?e(s,r,o,a,h,u,!l,c,f,g,v,F,R):e(r,s,a,o,h,u,l,c,f,F,R,g,v)),f}function n(t,e,i,n){return t[0][1]<i?r(t,!0,i):e[0][1]>n?r(e,!1,n):t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],h=t[s][1];if(e?i<=h:h<=i)return h===i?o:n+(i-r)*(o-n)/(h-r);n=o,r=h}return null}function s(t,e,i,d,r){var a=u.isZero;if(a(d)&&a(r)){a=k.getTimeOf(t,new c(e,i));return null===a?[]:[a]}for(var d=Math.atan2(-r,d),h=Math.sin(d),l=Math.cos(d),f=[],d=[],_=0;_<8;_+=2){var g=t[_]-e,v=t[_+1]-i;f.push(g*l-v*h,g*h+v*l)}return k.solveCubic(f,1,0,d,0,1),d}function a(e,i,n,r,a,o,h){for(var u=i[0],l=i[1],d=s(e,u,l,i[6]-u,i[7]-l),_=0,g=d.length;_<g;_++){var y,v=d[_],p=k.getPoint(e,v),m=k.getTimeOf(i,p);null!==m&&(y=k.getPoint(i,m),t(a,o,h?r:n,h?m:v,h?y:p,h?n:r,h?v:m,h?p:y))}}function o(e,o,n,r,s,a){o=m.intersect(e[0],e[1],e[6],e[7],o[0],o[1],o[6],o[7]);o&&t(s,a,n,null,o,r,null,o)}function h(i,n,r,s,h,u){var m=1e-12,p=Math.min,w=Math.max;if(w(i[0],i[2],i[4],i[6])+m>p(n[0],n[2],n[4],n[6])&&p(i[0],i[2],i[4],i[6])-m<w(n[0],n[2],n[4],n[6])&&w(i[1],i[3],i[5],i[7])+m>p(n[1],n[3],n[5],n[7])&&p(i[1],i[3],i[5],i[7])-m<w(n[1],n[3],n[5],n[7])){var _=d(i,n);if(_)for(var g=0;g<2;g++){var v=_[g];t(h,u,r,v[0],null,s,v[1],null,!0)}else{p=k.isStraight(i),m=k.isStraight(n),w=p&&!m;(p&&m?o:p||m?a:e)(w?n:i,w?i:n,w?s:r,w?r:s,h,u,w,0,0,0,1,0,1)}}return h}function l(a,i,n,r){a=k.classify(a);return"loop"===a.type&&t(n,r,i,(a=a.roots)[0],null,i,a[1],null),n}function d(M,T){function i(i){var e=i[6]-i[0],i=i[7]-i[1];return e*e+i*i}var n=Math.abs,r=m.getDistance,a=1e-7,o=k.isStraight(M),h=k.isStraight(T),u=o&&h,p=i(M)<i(T),f=p?T:M,d=p?M:T,_=f[0],g=f[1],v=f[6]-_,p=f[7]-g;if(r(_,g,v,p,d[0],d[1],!0)<a&&r(_,g,v,p,d[6],d[7],!0)<a)!u&&r(_,g,v,p,f[2],f[3],!0)<a&&r(_,g,v,p,f[4],f[5],!0)<a&&r(_,g,v,p,d[2],d[3],!0)<a&&r(_,g,v,p,d[4],d[5],!0)<a&&(o=h=u=!0);else if(u)return null;if(o^h)return null;for(var y=[M,T],w=[],x=0;x<4&&w.length<2;x++){var b=1&x,P=1^b,I=x>>1,P=k.getTimeOf(y[b],new c(y[P][I?6:0],y[P][I?7:1]));if(null!=P&&(I=b?[I,P]:[P,I],(!w.length||1e-8<n(I[0]-w[0][0])&&1e-8<n(I[1]-w[0][1]))&&w.push(I)),2<x&&!w.length)break}return 2!==w.length?w=null:u||(M=k.getPart(M,w[0][0],w[1][0]),(n((T=k.getPart(T,w[0][1],w[1][1]))[2]-M[2])>a||n(T[3]-M[3])>a||n(T[4]-M[4])>a||n(T[5]-M[5])>a)&&(w=null)),w}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?h(e,i,this,t,[]):l(e,this,[])},statics:{getOverlaps:d,getIntersections:function(t,e,i,n,r,s){for(var u,a=!e,c=t.length,f=(e=a?t:e).length,d=[],_=[],g=0;g<f;g++)d[g]=e[g].getValues(r);for(g=0;g<c;g++){var v=t[g],p=a?d[g]:v.getValues(n),m=v.getPath();m!==u&&(u=m,_.push(o=[])),a&&l(p,v,o,i);for(var y=a?g+1:0;y<f;y++){if(s&&o.length)return o;h(p,d[y],v,e[y],o,i)}}for(var o=[],g=0,w=_.length;g<w;g++)o.push.apply(o,_[g]);return o},getCurveLineIntersections:s}}}),O=r.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){var s;.99999999<=e&&((s=t.getNext())&&(e=0,t=s)),this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var e,i,t=this._segment;return t||(e=this.getCurve(),0===(i=this.getTime())?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t),t},getCurve:function(){function t(e){e=e&&e.getCurve();if(e&&null!=(i._time=e.getTimeOf(i._point)))return i._setCurve(e),e}var e=this._path,i=this;return e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){if(null==(t=this._offset)){var t=0,e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var e,i,t=this._curveOffset;return null==t&&(e=this.getCurve(),i=this.getTime(),this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)),t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var e=this.getCurve(),e=e&&e.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var i=this.getCurve(),e=i._path,i=i&&i.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(c,e){var s,o,u,l,i=this===c;return!i&&c instanceof O&&(u=this.getCurve(),l=c.getCurve(),(s=u._path)===l._path&&(u=(o=Math.abs)(this.getOffset()-c.getOffset()),l=!e&&this._intersection,c=!e&&c._intersection,i=(u<1e-7||s&&o(s.getLength()-u)<1e-7)&&(!l&&!c||l&&c&&l.equals(c,!0)))),i},toString:function(){var t=[],r=this.getPoint(),i=h.instance;r&&t.push("point: "+r);r=this.getIndex();null!=r&&t.push("index: "+r);r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var i=this._intersection;if(i&&this.getTangent().isCollinear(i.getTangent())){var e=this.getCurve(),i=i.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(r,e){var i=r.getValues(),s=k.classify(i).roots||k.getPeaks(i),r=s.length,s=e&&1<r?s[r-1]:0<r?s[0]:.5;d.push(k.getLength(i,e?s:0,e?1:s)/2)}function e(t,e,i){return e<i?e<t&&t<i:e<t||t<i}var f=this._intersection;if(!f)return!1;var n=this.getTime(),r=f.getTime(),b=1e-8,g=1-b,o=b<=n&&n<=g,h=b<=r&&r<=g;if(o&&h)return!this.isTouching();var x=this.getCurve(),w=n<b?x.getPrevious():x,C=f.getCurve(),f=r<b?C.getPrevious():C;if(g<n&&(x=x.getNext()),g<r&&(C=C.getNext()),!(w&&x&&f&&C))return!1;var d=[];o||(t(w,!0),t(x,!1)),h||(t(f,!0),t(C,!1));b=this.getPoint(),g=Math.min.apply(Math,d),x=o?x.getTangentAtTime(n):x.getPointAt(g).subtract(b),w=o?x.negate():w.getPointAt(-g).subtract(b),C=h?C.getTangentAtTime(r):C.getPointAt(g).subtract(b),b=h?C.negate():f.getPointAt(-g).subtract(b),w=w.getAngle(),x=x.getAngle(),b=b.getAngle(),C=C.getAngle();return!!(o?e(w,b,C)^e(x,b,C)&&e(w,C,b)^e(x,C,b):e(b,w,x)^e(C,w,x)&&e(b,x,w)^e(C,x,w))},hasOverlap:function(){return!!this._overlap}},r.each(k._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var s=i+n;-1<=s&&s<=r;s+=n){var a=t[(s%r+r)%r];if(!e.getPoint().isClose(a.getPoint(),1e-7))break;if(e.equals(a))return a}return null}for(var r=t.length,s=0,a=r-1;s<=a;){var o,h=s+a>>>1,u=t[h];if(i&&(o=e.equals(u)?u:n(h,-1)||n(h,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var l=e.getPath(),c=u.getPath();(l!==c?l._id-c._id:e.getIndex()+e.getTime()-(u.getIndex()+u.getTime()))<0?a=h-1:s=1+h}return t.splice(s,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;0<=n;n--)t(i,e[n]._intersection,!1);return i}}}}),A=w.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;return r.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i?n=(n=i[0])&&Array.isArray(n[0]):e&&(n=1<(e.match(/m/gi)||[]).length||/z\s*\S+/i.test(e)),new(n?N:L)(t)}},_asPathItem:function(){return this},isClockwise:function(){return 0<=this.getArea()},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){function e(i,e){i=+n[i];return o&&(i+=h[e]),i}function i(t){return new c(e(t,"x"),e(t+1,"y"))}var r,s,a=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),o=!1,h=new c,u=new c;this.clear();for(var l=0,f=a&&a.length;l<f;l++){var n,_=a[l],g=_[0],v=g.toLowerCase(),p=(n=_.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&n.length,o=g===v;switch("z"!==r||/[mz]/.test(v)||this.moveTo(h),v){case"m":case"l":for(var m="m"===v,y=0;y<p;y+=2)this[m?"moveTo":"lineTo"](h=i(y)),m&&(u=h,m=!1);s=h;break;case"h":case"v":for(var w="h"===v?"x":"y",h=h.clone(),y=0;y<p;y++)h[w]=e(y,w),this.lineTo(h);s=h;break;case"c":for(y=0;y<p;y+=6)this.cubicCurveTo(i(y),s=i(y+2),h=i(y+4));break;case"s":for(y=0;y<p;y+=4)this.cubicCurveTo(/[cs]/.test(r)?h.multiply(2).subtract(s):h,s=i(y),h=i(y+2)),r=v;break;case"q":for(y=0;y<p;y+=4)this.quadraticCurveTo(s=i(y),h=i(y+2));break;case"t":for(y=0;y<p;y+=2)this.quadraticCurveTo(s=/[qt]/.test(r)?h.multiply(2).subtract(s):h,h=i(y)),r=v;break;case"a":for(y=0;y<p;y+=7)this.arcTo(h=i(y+5),new d(+n[y],+n[y+1]),+n[y+2],+n[y+4],+n[y+3]);break;case"z":this.closePath(1e-12),h=u}r=v}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(e){e=e.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(e):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,a,n){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(a||t._matrix)._orNullIfIdentity();return r||this.getBounds(s).touches(t.getBounds(a))?k.getIntersections(this.getCurves(),!r&&t.getCurves(),e,s,a,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=c.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);a._distance<i&&(i=a._distance,n=a)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t&&t.getPoint()},interpolate:function(t,h,i){var n=!this._children,r=n?"_segments":"_children",s=t[r],a=h[r],o=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+h);var h=o.length,u=a.length;if(h<u)for(var l=n?T:L,c=h;c<u;c++)this.add(new l);else u<h&&this[n?"removeSegments":"removeChildren"](u,h);for(c=0;c<u;c++)o[c].interpolate(s[c],a[c],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(r){var e=!1;if(r){var i=this._children||[this],n=r._children?r._children.slice():[r],r=i.length,s=n.length,a=[],o=0;e=!0;for(var h=r-1;0<=h&&e;h--)for(var u=i[h],e=!1,l=s-1;0<=l&&!e;l--)u.compare(n[l])&&(a[l]||(a[l]=!0,o++),e=!0);e=e&&o===s}return e}}),L=A.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;i&&0<i.length?this.setSegments(i):(this._curves=e,this._segmentSelection=0,i||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!i&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function gt(t){if(gt.base.call(this,t),8&t){if(this._length=this._area=e,16&t)this._version++;else if(this._curves)for(var i=0,n=this._curves.length;i<n;i++)this._curves[i]._changed()}else 32&t&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof N?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var r,i=this.isFullySelected(),n=t&&t.length;this._segments.length=0,this._segmentSelection=0,this._curves=e,n&&("boolean"==typeof(r=t[n-1])&&(this.setClosed(r),n--),this._add(T.readList(t,0,{},n))),i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t)for(var i=this._countCurves(),t=this._curves=new Array(i),n=0;n<i;n++)t[n]=new k(this,e[n],e[n+1]||e[0]);return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){var e;this._closed!=(t=!!t)&&(this._closed=t,this._curves&&(e=this._curves.length=this._countCurves(),t&&(this._curves[e-1]=new k(this,this._segments[e-1],this._segments[0]))),this._changed(25))}},{beans:!0,getPathData:function(t,e){function i(h,f){h._transformCoordinates(t,g),n=g[0],r=g[1],v?(p.push("M"+_.pair(n,r)),v=!1):(o=g[2],u=g[3],o===n&&u===r&&l===s&&c===a?f||(h=n-s,f=r-a,p.push(0==h?"v"+_.number(f):0==f?"h"+_.number(h):"l"+_.pair(h,f))):p.push("c"+_.pair(l-s,c-a)+" "+_.pair(o-s,u-a)+" "+_.pair(n-s,r-a))),s=n,a=r,l=g[4],c=g[5]}var n,r,s,a,o,u,l,c,f=this._segments,d=f.length,_=new h(e),g=new Array(6),v=!0,p=[];if(!d)return"";for(var m=0;m<d;m++)i(f[m]);return this._closed&&0<d&&(i(f[0],!0),p.push("z")),p.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,c=null==e,e=c?i.length:e,a=0;a<r;a++){var o=t[a];(o=o._path?t[a]=o.clone():o)._path=this,o._index=e+a,o._selection&&this._updateSelection(o,0,o._selection)}if(c)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var a=e+r,h=i.length;a<h;a++)i[a]._index=a}if(n){var u=this._countCurves(),l=0<e&&e+r-1===u?e-1:e,c=l,f=Math.min(l+r,u);t._curves&&(n.splice.apply(n,[l,0].concat(t._curves)),c+=t._curves.length);for(a=c;a<f;a++)n.splice(a,0,new k(this,null,null));this._adjustCurves(l,f)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)(i=r[s])._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&0<t?t-1:t},add:function(t){return 1<arguments.length&&"number"!=typeof t?this._add(T.readList(arguments)):this._add([T.read(arguments)])[0]},insert:function(t,e){return 2<arguments.length&&"number"!=typeof e?this._add(T.readList(arguments,1),t):this._add([T.read(arguments,1)],t)[0]},addSegment:function(){return this._add([T.read(arguments)])[0]},insertSegment:function(t){return this._add([T.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(T.readList(t))},insertSegments:function(t,e){return this._add(T.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(f,e,i){f=f||0,e=r.pick(e,this._segments.length);var n=this._segments,s=this._curves,a=n.length,o=n.splice(f,e-f),h=o.length;if(!h)return o;for(var u=0;u<h;u++){var l=o[u];l._selection&&this._updateSelection(l,l._selection,0),l._index=l._path=null}for(var u=f,c=n.length;u<c;u++)n[u]._index=u;if(s){for(f=0<f&&e===a+(this._closed?1:0)?f-1:f,u=(s=s.splice(f,h)).length-1;0<=u;u--)s[u]._path=null;i&&(o._curves=s.slice(1)),this._adjustCurves(f,f)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){if(null==(t=this._area)){for(var e=this._segments,i=this._closed,t=0,n=0,r=e.length;n<r;n++){var s=n+1===r;t+=k.getArea(k.getValues(e[n],e[s?0:n+1],null,s&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&0<t&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function vt(t){1&t||this._selectSegments(!1),vt.base.call(this,t)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i,0<(this._segmentSelection+=i-e)&&this.setSelected(!0)},divideAt:function(i){var e,i=this.getLocationAt(i);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(n){var a=this.getLocationAt(n),h=a&&a.index,n=a&&a.time;1-1e-8<n&&(h++,n=0);a=this.getCurves();if(0<=h&&h<a.length){1e-8<=n&&a[h++].divideAtTime(n);var o,h=this.removeSegments(h,this._segments.length,!0);return this._closed?(this.setClosed(!1),o=this):((o=new L(w.NO_INSERT)).insertAbove(this),o.copyAttributes(this)),o._add(h,0),this.addSegment(h[0]),o}return null},split:function(n,r){r=r===e?n:(n=this.getCurves()[n])&&n.getLocationAtTime(r);return null!=r?this.splitAt(r):null},join:function(u,a){var i=a||0;if(u&&u!==this){var h=u._segments,o=this.getLastSegment(),s=u.getLastSegment();if(!s)return this;o&&o._point.isClose(s._point,i)&&u.reverse();a=u.getFirstSegment();o&&o._point.isClose(a._point,i)?(o.setHandleOut(a._handleOut),this._add(h.slice(1))):((o=this.getFirstSegment())&&o._point.isClose(a._point,i)&&u.reverse(),s=u.getLastSegment(),o&&o._point.isClose(s._point,i)?(o.setHandleIn(s._handleIn),this._add(h.slice(0,h.length-1),0)):this._add(h.slice())),u._closed&&this._add([h[0]]),u.remove()}h=this.getFirstSegment(),u=this.getLastSegment();return h!==u&&h._point.isClose(u._point,i)&&(h.setHandleIn(u._handleIn),u.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;0<=r;r--){var s=e[r];!s.hasHandles()&&(!s.hasLength(n)||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var i=new B(this,t||.25,256,!0).parts,n=i.length,r=[],s=0;s<n;s++)r.push(new T(i[s].curve.slice(0,2)));!this._closed&&0<n&&r.push(new T(i[n-1].curve.slice(6))),this.setSegments(r)},simplify:function(e){e=new j(this).fit(e||2.5);return e&&this.setSegments(e),!!e},smooth:function(y){function i(t,e){var i=t&&t.index;if(null!=i){var r=t.path;if(r&&r!==n)throw new Error(t._class+" "+i+" of "+r+" is not part of "+n);e&&t instanceof k&&i++}else i="number"==typeof t?t:e;return Math.min(i<0&&h?i%o:i<0?i+o:i,o-1)}var n=this,r=y||{},y=r.type||"asymmetric",a=this._segments,o=a.length,h=this._closed,u=h&&r.from===e&&r.to===e,l=i(r.from,0),c=i(r.to,o-1);if(c<l&&(h?l-=o:(_=l,l=c,c=_)),/^(?:asymmetric|continuous)$/.test(y)){var d="asymmetric"===y,_=Math.min,y=c-l+1,v=y-1,y=u?_(y,4):1,m=y,y=y,w=[];if(h||(m=_(1,l),y=_(1,o-c-1)),!((v+=m+y)<=1)){for(var x=0,b=l-m;x<=v;x++,b++)w[x]=a[(b<0?b+o:b)%o]._point;for(var I=v-1,M=[C=w[0]._x+2*w[1]._x],T=[S=w[0]._y+2*w[1]._y],z=[P=2],O=[],A=[],x=1;x<v;x++)var L=x<I,j=L?4:d?3:8,E=L?2:d?0:1,D=(L||d?1:2)/P,P=z[x]=(L?4:d?2:7)-D,C=M[x]=j*w[x]._x+E*w[x+1]._x-D*C,S=T[x]=j*w[x]._y+E*w[x+1]._y-D*S;O[I]=M[I]/z[I],A[I]=T[I]/z[I];for(x=v-2;0<=x;x--)O[x]=(M[x]-O[x+1])/z[x],A[x]=(T[x]-A[x+1])/z[x];O[v]=(3*w[v]._x-O[I])/2,A[v]=(3*w[v]._y-A[I])/2;for(var x=m,F=v-y,b=l;x<=F;x++,b++){var R=a[b<0?b+o:b],H=R._point,V=O[x]-H._x,H=A[x]-H._y;(u||x<F)&&R.setHandleOut(V,H),(u||m<x)&&R.setHandleIn(-V,-H)}}}else for(x=l;x<=c;x++)a[x<0?x+o:x].smooth(r,!u&&x===l,!u&&x===c)},toShape:function(t){function i(r,s){var i=c[r],n=i.getNext(),r=c[s],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function r(a){var o=c[a],h=o.getNext(),n=o._handleOut,r=h._handleIn,s=.5522847498307936;if(n.isOrthogonal(r)){a=o._point,o=h._point,h=new m(a,n,!0).intersect(new m(o,r,!0),!0);return h&&u.isZero(n.getLength()/h.subtract(a).getLength()-s)&&u.isZero(r.getLength()/h.subtract(o).getLength()-s)}}function s(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this._closed)return null;var a,o,l,c=this._segments;if(!this.hasHandles()&&4===c.length&&i(0,2)&&i(1,3)&&function(n){var e=c[n],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}(1)?(a=C.Rectangle,o=new d(s(0,3),s(0,1)),l=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&r(0)&&r(2)&&r(4)&&r(6)&&i(1,5)&&i(3,7)?(a=C.Rectangle,_=(o=new d(s(1,6),s(0,3))).subtract(new d(s(0,7),s(1,2))).divide(2),l=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&r(0)&&r(1)&&r(2)&&r(3)&&(_=u.isZero(s(0,2)-s(1,3))?(a=C.Circle,s(0,2)/2):(a=C.Ellipse,new d(s(2,0)/2,s(3,1)/2)),l=c[1]._point),a){var f=this.getPosition(!0),_=new a({center:f,size:o,radius:_,insert:!1});return _.copyAttributes(this,!0),_._matrix.prepend(this._matrix),_.rotate(l.subtract(f).getAngle()+90),t!==e&&!t||_.insertAbove(this),_}return null},toPath:"#clone",compare:function pt(t){if(!t||t instanceof N)return pt.base.call(this,t);var e=this.getCurves(),i=t.getCurves(),n=e.length,r=i.length;if(!n||!r)return n==r;for(var s,a,o=e[0].getValues(),h=[],u=0,l=0,c=0;c<r;c++){var f=i[c].getValues();if(h.push(f),d=k.getOverlaps(o,f)){s=!c&&0<d[0][0]?r-1:c,a=d[0][1];break}}for(var _,g=Math.abs,f=h[s];o&&f;){var d=k.getOverlaps(o,f);if(d)if(g(d[0][0]-l)<1e-8){1===(l=d[1][0])&&(o=++u<n?e[u].getValues():null,l=0);var m=d[0][1];if(g(m-a)<1e-8){if(_=_||[s,m],1===(a=d[1][1])&&(f=h[s=++s>=r?0:s]||i[s].getValues(),a=0),!o)return _[0]===s&&_[1]===a;continue}}break}return!1},_hitTestSelf:function(t,e,i,n){function r(e,i){return t.subtract(e).divide(i).length<=1}function s(t,i,n){if(!e.selected||i.isSelected()){var s=t._point;if(r(i=i!==s?i.add(s):i,x))return new M(n,g,{segment:t,point:i})}}function a(t,i){return(i||e.segments)&&s(t,t._point,"segment")||!i&&e.handles&&(s(t,t._handleIn,"handle-in")||s(t,t._handleOut,"handle-out"))}function o(t){f.add(t)}function h(s){var i=y||0<s._index&&s._index<m-1;return"round"===(i?u:l)?r(s._point,x):(f=new L({internal:!0,closed:!0}),i?s.isSmooth()||L._addBevelJoin(s,u,P,c,null,n,o,!0):"square"===l&&L._addSquareCap(s,l,P,null,n,o,!0),!f.isEmpty()&&(f.contains(t)||(s=f.getNearestLocation(t))&&r(s.getPoint(),w)))}var u,l,c,f,d,_,g=this,T=this.getStyle(),p=this._segments,m=p.length,y=this._closed,w=e._tolerancePadding,x=w,b=e.stroke&&T.hasStroke(),C=e.fill&&T.hasFill(),S=e.curves,P=b?T.getStrokeWidth()/2:C&&0<e.tolerance||S?0:null;if(null!==P&&(0<P?(u=T.getStrokeJoin(),l=T.getStrokeCap(),c=T.getMiterLimit(),x=x.add(L._getStrokePadding(P,n))):u=l="round"),!e.ends||e.segments||y){if(e.segments||e.handles)for(var I=0;I<m;I++)if(_=a(p[I]))return _}else if(_=a(p[0],!0)||a(p[m-1],!0))return _;if(null!==P&&((d=this.getNearestLocation(t))&&(0===(T=d.getTime())||1===T&&1<m?h(d.getSegment())||(d=null):r(d.getPoint(),x)||(d=null)),!d&&"miter"===u&&1<m))for(I=0;I<m;I++){var z=p[I];if(t.getDistance(z._point)<=c*P&&h(z)){d=z.getLocation();break}}return!d&&C&&this._contains(t)||d&&!b&&!S?new M("fill",this):d?new M(b?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},r.each(k._evaluateMethods,function(t){this[t+"At"]=function(i){i=this.getLocationAt(i);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=c.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var s=i,a=e[n];if(t<(i+=a.getLength()))return a.getLocationAt(t-s)}if(0<e.length&&t<=this.getLength())return new O(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null}}),new function(){function e(t,e,i){function n(e){var n,f;s=i?(e._transformCoordinates(i,_),r=_[0],_[1]):(n=e._point,r=n._x,n._y),g?(t.moveTo(r,s),g=!1):(u=i?(h=_[2],_[3]):(f=e._handleIn,h=r+f._x,s+f._y),h===r&&u===s&&l===a&&c===o?t.lineTo(r,s):t.bezierCurveTo(l,c,h,u,r,s)),a=r,o=s,c=i?(l=_[4],_[5]):(f=e._handleOut,l=a+f._x,o+f._y)}for(var r,s,a,o,h,u,l,c,f=e._segments,d=f.length,_=new Array(6),g=!0,v=0;v<d;v++)n(f[v]);e._closed&&0<d&&n(f[0])}return{_draw:function(t,i,n,r){function s(t){return c[(t%f+f)%f]}var a=i.dontStart,o=i.dontFinish||i.clip,h=this.getStyle(),u=h.hasFill(),l=h.hasStroke(),c=h.getDashArray(),f=!paper.support.nativeDash&&l&&c&&c.length;if(a||t.beginPath(),(u||l&&!f||o)&&(e(t,this,r),this._closed&&t.closePath()),!o&&(u||l)&&(this._setStyles(t,i,n),u&&(t.fill(h.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),l)){if(f){a||t.beginPath();var d,_=new B(this,.25,32,!1,r),g=_.length,v=-h.getDashOffset(),p=0;for(v%=g;0<v;)v-=s(p--)+s(p--);for(;v<g;)d=v+s(p++),(0<v||0<d)&&_.drawPart(t,Math.max(v,0),Math.max(d,0)),v=d+s(p++)}t.stroke()}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),function(t,e,i,n){function r(n){var i=h[n],n=h[n+1];s==i&&a==n||(t.beginPath(),t.moveTo(s,a),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var s,a,o=n/2,h=new Array(6),u=0,l=e.length;u<l;u++){var c=e[u],d=c._selection;c._transformCoordinates(i,h),s=h[0],a=h[1],2&d&&r(2),4&d&&r(4),t.fillRect(s-o,a-o,n,n),1&d||(d=t.fillStyle,t.fillStyle="#ffffff",t.fillRect(s-o+1,a-o+1,n-2,n-2),t.fillStyle=d)}}(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(e){e=e._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new T(c.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new T(c.read(arguments))])},cubicCurveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=c.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new T(n,i.subtract(n))])},quadraticCurveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=r.pick(r.read(arguments),.5),o=1-n,a=t(this)._point,o=e.subtract(a.multiply(o*o)).subtract(i.multiply(n*n)).divide(2*n*o);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(o,i)},arcTo:function(){var a,q=Math.abs,h=Math.sqrt,l=t(this),f=l._point,_=c.read(arguments),A=r.peek(arguments);if("boolean"==typeof(F=r.pick(A,!0)))var D=(y=f.add(_).divide(2)).add(y.subtract(f).rotate(F?-90:90));else if(r.remain(arguments)<=2)D=_,_=c.read(arguments);else{var N=d.read(arguments),L=u.isZero;if(L(N.width)||L(N.height))return this.lineTo(_);var Z=r.read(arguments),F=!!r.read(arguments),C=!!r.read(arguments),y=f.add(_).divide(2),P=(S=f.subtract(y).rotate(-Z)).x,I=S.y,B=q(N.width),j=q(N.height),k=B*B,O=j*j,A=P*P,L=I*I,N=h(A/k+L/O);if(1<N&&(k=(B*=N)*B,O=(j*=N)*j),(N=q(N=(k*O-k*L-O*A)/(k*L+O*A))<1e-12?0:N)<0)throw new Error("Cannot create an arc with the given arguments");i=new c(B*I/j,-j*P/B).multiply((C===F?-1:1)*h(N)).rotate(Z).add(y),Z=(s=(a=(new p).translate(i).rotate(Z).scale(B,j))._inverseTransform(f)).getDirectedAngle(a._inverseTransform(_)),!F&&0<Z?Z-=360:F&&Z<0&&(Z+=360)}if(D){var i,B=new m(f.add(D).divide(2),D.subtract(f).rotate(90),!0),j=new m(D.add(_).divide(2),_.subtract(D).rotate(90),!0),F=new m(f,_),D=F.getSide(D);if(!(i=B.intersect(j,!0))){if(!D)return this.lineTo(_);throw new Error("Cannot create an arc with the given arguments")}var s,Z=(s=f.subtract(i)).getDirectedAngle(_.subtract(i)),F=F.getSide(i);0===F?Z=D*q(Z):D===F&&(Z+=Z<0?360:-360)}for(var q=q(Z),V=360<=q?4:Math.ceil((q-1e-12)/90),H=Z/V,Z=H*Math.PI/360,U=4/3*Math.sin(Z)/(1+Math.cos(Z)),W=[],G=0;G<=V;G++){var X,S=_,J=null;G<V&&(J=s.rotate(90).multiply(U),a?(S=a._transformPoint(s),J=a._transformPoint(s.add(J)).subtract(S)):S=i.add(s)),G?(X=s.rotate(-90).multiply(U),a&&(X=a._transformPoint(s.add(X)).subtract(S)),W.push(new T(S,X,J))):l.setHandleOut(J),s=s.rotate(H)}this._add(W)},lineBy:function(){var e=c.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=r.read(arguments),s=t(this)._point;this.curveTo(s.add(e),s.add(i),n)},cubicCurveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=c.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(c.read(arguments)),n=r.pick(r.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(c.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return L[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,s){function a(i){i._transformCoordinates(n,h);for(var e=0;e<2;e++)k._addBounds(u[e],u[e+4],h[e+2],h[e],e,s?s[e]:0,l,c,f);i=u;u=h,h=i}var o=t[0];if(!o)return new g;for(var h=new Array(6),u=o._transformCoordinates(n,new Array(6)),l=u.slice(0,2),c=l.slice(),f=new Array(2),d=1,_=t.length;d<_;d++)a(t[d]);return e&&a(o),new g(l[0],l[1],c[0]-l[0],c[1]-l[1])},getStrokeBounds:function(t,e,i,n,r){function s(t){v=v.include(t)}function a(t){v=v.unite(x.setCenter(t._point.transform(n)))}function o(t,e){"round"===e||t.isSmooth()?a(t):L._addBevelJoin(t,e,p,w,n,f,s)}function h(t,e){"round"===e?a(t):L._addSquareCap(t,e,p,n,f,s)}var u=i.getStyle(),l=u.hasStroke(),y=u.getStrokeWidth(),f=l&&i._getStrokeMatrix(n,r),_=l&&L._getStrokePadding(y,f),v=L.getBounds(t,e,i,n,r,_);if(!l)return v;for(var p=y/2,m=u.getStrokeJoin(),y=u.getStrokeCap(),w=u.getMiterLimit(),x=new g(new d(_)),b=t.length-(e?0:1),C=1;C<b;C++)o(t[C],m);return e?o(t[0],m):0<b&&(h(t[0],y),h(t[t.length-1],y)),v},_getStrokePadding:function(a,o){if(!o)return[a,a];var h=new c(a,0).transform(o),f=new c(0,a).transform(o),l=h.getAngleInRadians(),s=h.getLength(),a=f.getLength(),o=Math.sin(l),h=Math.cos(l),f=Math.tan(l),l=Math.atan2(a*f,s),f=Math.atan2(a,f*s);return[Math.abs(s*Math.cos(l)*h+a*Math.sin(l)*o),Math.abs(a*Math.sin(f)*h+s*Math.cos(f)*o)]},_addBevelJoin:function(f,e,i,n,l,d,a,o){var _,h=f.getCurve(),f=h.getPrevious(),l=h.getPoint1().transform(l),f=f.getNormalAtTime(1).multiply(i).transform(d),d=h.getNormalAtTime(0).multiply(i).transform(d);f.getDirectedAngle(d)<0&&(f=f.negate(),d=d.negate()),o&&a(l),a(l.add(f)),"miter"===e&&(_=new m(l.add(f),new c(-f.y,f.x),!0).intersect(new m(l.add(d),new c(-d.y,d.x),!0),!0))&&l.getDistance(_)<=n*i&&a(_),a(l.add(d))},_addSquareCap:function(h,e,i,o,u,s,a){o=h._point.transform(o),h=h.getLocation(),u=h.getNormal().multiply(i).transform(u);"square"===e&&(a&&(s(o.subtract(u)),s(o.add(u))),o=o.add(u.rotate(0===h.getTime()?-90:90))),s(o.add(u)),s(o.subtract(u))},getHandleBounds:function(t,e,l,n,c){var s,a,u,o=l.getStyle();c.stroke&&o.hasStroke()&&(u=l._getStrokeMatrix(n,c),c=l=o.getStrokeWidth()/2,"miter"===o.getStrokeJoin()&&(c=l*o.getMiterLimit()),"square"===o.getStrokeCap()&&(c=Math.max(c,l*Math.SQRT2)),s=L._getStrokePadding(l,u),a=L._getStrokePadding(c,u));for(var f=new Array(6),d=1/0,_=-d,v=d,p=_,m=0,y=t.length;m<y;m++){t[m]._transformCoordinates(n,f);for(var x=0;x<6;x+=2){var M=x?s:a,z=M?M[0]:0,k=M?M[1]:0,T=f[x],I=f[x+1],M=T-z,T=T+z,z=I-k,k=I+k;M<d&&(d=M),_<T&&(_=T),z<v&&(v=z),p<k&&(p=k)}}return new g(d,v,_-d,p-v)}}});L.inject({statics:new function(){function t(t,e,s){var n=r.getNamed(s),s=new L(n&&!1===n.insert&&w.NO_INSERT);return s._add(t),s._closed=e,s.set(n)}function e(e,i,r){for(var s=new Array(4),a=0;a<4;a++){var o=n[a];s[a]=new T(o._point.multiply(i).add(e),o._handleIn.multiply(i),o._handleOut.multiply(i))}return t(s,!0,r)}var i=.5522847498307936,n=[new T([-1,0],[0,i],[0,-i]),new T([0,-1],[-i,0],[i,0]),new T([1,0],[0,-i],[0,i]),new T([0,1],[i,0],[-i,0])];return{Line:function(){return t([new T(c.readNamed(arguments,"from")),new T(c.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return e(t,new d(i),arguments)},Rectangle:function(){var u,l,c=g.readNamed(arguments,"rectangle"),f=d.readNamed(arguments,"radius",0,{readNull:!0}),s=c.getBottomLeft(!0),a=c.getTopLeft(!0),o=c.getTopRight(!0),h=c.getBottomRight(!0);return t(!f||f.isZero()?[new T(s),new T(a),new T(o),new T(h)]:(u=(f=d.min(f,c.getSize(!0).divide(2))).width,l=f.height,c=u*i,f=l*i,[new T(s.add(u,0),null,[-c,0]),new T(s.subtract(0,l),[0,f]),new T(a.add(0,l),null,[0,-f]),new T(a.add(u,0),[-c,0],null),new T(o.subtract(u,0),null,[c,0]),new T(o.add(0,l),[0,-f],null),new T(h.subtract(0,l),null,[0,f]),new T(h.subtract(u,0),[c,0])]),!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=C._readEllipse(arguments);return e(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=c.readNamed(arguments,"from"),e=c.readNamed(arguments,"through"),i=c.readNamed(arguments,"to"),n=r.getNamed(arguments),s=new L(n&&!1===n.insert&&w.NO_INSERT);return s.moveTo(t),s.arcTo(e,i),s.set(n)},RegularPolygon:function(){for(var e=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"sides"),n=r.readNamed(arguments,"radius"),s=360/i,a=i%3==0,o=new c(0,a?-n:n),h=a?-1:.5,u=new Array(i),l=0;l<i;l++)u[l]=new T(e.add(o.rotate((l+h)*s)));return t(u,!0,arguments)},Star:function(){for(var e=c.readNamed(arguments,"center"),i=2*r.readNamed(arguments,"points"),n=r.readNamed(arguments,"radius1"),s=r.readNamed(arguments,"radius2"),a=360/i,o=new c(0,-1),h=new Array(i),u=0;u<i;u++)h[u]=new T(e.add(o.rotate(a*u).multiply(u%2?s:n)));return t(h,!0,arguments)}}}});var N=A.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function mt(t,e){var i=e,n=i[0];n&&"number"==typeof n[0]&&(i=[i]);for(var s=e.length-1;0<=s;s--){var a=i[s];i!==e||a instanceof L||(i=r.slice(i)),Array.isArray(a)?i[s]=new L({segments:a,insert:!1}):a instanceof N&&(i.splice.apply(i,[s,1].concat(a.removeChildren())),a.remove())}return mt.base.call(this,t,i)},reduce:function yt(t){for(var n,e=this._children,i=e.length-1;0<=i;i--)(n=e[i].reduce(t)).isEmpty()&&n.remove();return e.length?yt.base.call(this):((n=new L(w.NO_INSERT)).copyAttributes(this),n.insertAbove(this),this.remove(),n)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n.push(a.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join("")},_hitTestChildren:function wt(t,e,i){return wt.base.call(this,t,e.class===L||"path"===e.type?e:r.set({},e,{fill:!1}),i)},_draw:function(t,e,o,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;s<a;s++)r[s].draw(t,e,n);e.clip||(this._setStyles(t,e,o),(o=this._style).hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke())}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;i[a._id]||a._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(i,e){i=i._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new L(w.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var n=t(this,!0),i=n&&n.getLastSegment(),n=c.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][t](e)||i;return i}},{}));A.inject(new function(){function t(i,e){i=i.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0):i}function i(a,e,i,n,r,s){a=new a(w.NO_INSERT);return a.addChildren(e,!0),i&&(a=a.reduce({simplify:!0})),s&&!1===s.insert||a.insertAbove(r&&n.isSibling(r)&&n.getIndex()<r.getIndex()?r:n),a.copyAttributes(n,!0),a}function n(e,n,y,a){function o(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];w.push.apply(w,n._segments),x.push.apply(x,n.getCurves()),n._overlapsOnly=!0}}if(a&&a.stroke&&/^(subtract|intersect)$/.test(y))return s(e,n,"subtract"===y);var u=t(e,!0),c=n&&e!==n&&t(n,!0),_=p[y];_[y]=!0,c&&(_.subtract||_.exclude)^(c.isClockwise()^u.isClockwise())&&c.reverse();var g,v=l(O.expand(u.getCrossings(c))),m=u._children||[u],y=c&&(c._children||[c]),w=[],x=[];if(v.length){o(m),y&&o(y);for(var b=0,C=v.length;b<C;b++)f(v[b]._segment,u,c,x,_);for(b=0,C=w.length;b<C;b++){var S=w[b],P=S._intersection;S._winding||f(S,u,c,x,_),P&&P._overlap||(S._path._overlapsOnly=!1)}g=d(w,_)}else g=h(y?m.concat(y):m.slice(),function(t){return!!_[t]});return i(N,g,!0,e,n,a)}function s(e,n,r){function s(t){return o.contains(t.getPointAt(t.getLength()/2))^r&&(u.unshift(t),1)}for(var a=t(e),o=t(n),h=a.getCrossings(o),u=[],l=h.length-1;0<=l;l--){var c=h[l].split();c&&(s(c)&&c.getFirstSegment().setHandleIn(0,0),a.getLastSegment().setHandleOut(0,0))}return s(a),i(x,u,!1,e,n)}function a(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;(t._next=e)._previous=t}}function o(t){for(var e=t.length-1;0<=e;e--)t[e].clearHandles()}function h(t,e,i){var n=t&&t.length;if(n){var s=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),a=t.slice().sort(function(t,e){return v(e.getArea())-v(t.getArea())}),o=a[0];null==i&&(i=o.isClockwise());for(var h=0;h<n;h++){for(var p,u=a[h],l=s[u._id],c=u.getInteriorPoint(),f=0,d=h-1;0<=d;d--){var _=a[d];if(_.contains(c)){var g=s[_._id],f=g.winding;l.winding+=f,l.container=g.exclude?g.container:_;break}}e(l.winding)===e(f)?(l.exclude=!0,t[l.index]=null):(p=l.container,u.setClockwise(p?!p.isClockwise():i))}}return t}function l(t,e,i){function n(t){return t._path._id+"."+t._segment1._index}for(var r,s,h,u=e&&[],l=1e-8,f=!1,d=i||[],_=i&&{},g=(i&&i.length)-1;0<=g;g--)(v=i[g])._path&&(_[n(v)]=!0);for(g=t.length-1;0<=g;g--){var v,I=t[g],y=I._time,b=y,x=e&&!e(I);if((v=I._curve)&&(v!==s?(f=!v.hasHandles()||_&&_[n(v)],r=[],h=null,s=v):l<=h&&(y/=h)),x)r&&r.push(I);else{if(e&&u.unshift(I),h=b,y<l)p=v._segment1;else if(.99999999<y)p=v._segment2;else{b=v.divideAtTime(y,!0);f&&d.push(v,b);for(var p=b._segment1,C=r.length-1;0<=C;C--){var S=r[C];S._time=(S._time-y)/(1-y)}}I._setSegment(p);var P=p._intersection,I=I._intersection;if(P){a(P,I);for(var M=P;M;)a(M._intersection,P),M=M._next}else p._intersection=I}}return i||o(d),u||t}function c(t,e,i,n,r){function s(s){var a=s[l+0],L=s[l+6];if(!(p<_(a,L)||p>g(a,L))){var f=s[u+0],O=s[u+2],A=s[u+4],M=s[u+6];if(a!==L){var T=p===a?0:p===L||w>g(f,O,A,M)||x<_(f,O,A,M)?1:1===k.solveCubic(s,l,p,I,0,1)?I[0]:.5,z=0===T?f:1===T?M:k.getPoint(s,T)[i?"y":"x"],O=L<a?1:-1,A=o[l]>o[l+6]?1:-1,L=o[u+6];return p!==a?(z<w?b+=O:x<z?C+=O:S=!0,d-y<z&&z<d+y&&(P/=2)):(O!=A?f<w?b+=O:x<f&&(C+=O):f!=L&&(L<x&&x<z?(C+=O,S=!0):w<L&&z<w&&(b+=O,S=!0)),P=0),o=s,!r&&w<z&&z<x&&0===k.getTangent(s,T)[i?"x":"y"]&&c(t,e,i?0:1,n,!0)}(f<x&&w<M||M<x&&w<f)&&(S=!0)}}function a(t){var h=t[l+0],c=t[l+2],f=t[l+4],d=t[l+6];if(p<=g(h,c,f,d)&&p>=_(h,c,f,d))for(var o,h=t[u+0],c=t[u+2],f=t[u+4],d=t[u+6],v=w>g(h,c,f,d)||x<_(h,c,f,d)?[t]:k.getMonoCurves(t,i),m=0,y=v.length;m<y;m++)if(o=s(v[m]))return o}for(var h,u=i?1:0,l=1^u,f=[t.x,t.y],d=f[u],p=f[l],y=1e-6,w=d-1e-9,x=d+1e-9,b=0,C=0,S=!1,P=1,I=[],M=0,T=e.length;M<T;M++){var O=e[M],A=O._path,z=O.getValues();if(!(M&&e[M-1]._path===A||(o=null,A._closed||(h=k.getValues(A.getLastCurve().getSegment2(),O.getSegment1(),null,!n))[l]!==h[l+6]&&(o=h),o)))for(var o=z,N=A.getLastCurve();N&&N!==O;){var B=N.getValues();if(B[l]!==B[l+6]){o=B;break}N=N.getPrevious()}if(z=a(z))return z;if(M+1===T||e[M+1]._path!==A){if(h&&(z=a(h)))return z;h=null}}return b=v(b),C=v(C),{winding:g(b,C),windingL:b,windingR:C,quality:P,onPath:S}}function f(t,e,i,n,r){var a=[],o=t,h=0;do{var f=(l=t.getCurve()).getLength()}while(a.push({segment:t,curve:l,length:f}),h+=f,(t=t.getNext())&&!t._intersection&&t!==o);for(var d=[.5,.25,.75],_={winding:0,quality:0},s=_,m=0;m<d.length&&s.quality<.5;m++)for(var f=h*d[m],y=0,w=a.length;y<w;y++){var I=a[y],b=I.length;if(f<=b){var l,C=(l=I.curve)._path,S=C._parent,T=u.clamp(l.getTimeAt(f),1e-8,1-1e-8),I=l.getPointAtTime(T),T=v(l.getTangentAtTime(T).normalize().y)<Math.SQRT1_2?1:0;S instanceof N&&(C=S);T=r.subtract&&i&&(C===e&&i._getWinding(I,T,!0).winding||C===i&&!e._getWinding(I,T,!0).winding)?_:c(I,n,T,!0);T.quality>s.quality&&(s=T);break}f-=b}for(y=a.length-1;0<=y;y--)a[y].segment._winding=s}function d(t,e){function i(i){return!(!i||i._visited||e&&(!e[(i=i._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function n(t){if(t)for(var e=0,i=a.length;e<i;e++)if(t===a[e])return!0;return!1}function r(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}var a,o=[];t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),s=!(!n||!n._overlap),a=t._path,o=e._path;return r^s?r?1:-1:!i^!n?i?1:-1:a!==o?a._id-o._id:t._index-e._index});for(var h=0,u=t.length;h<u;h++){var l,c,f,y,x,d=t[h],_=i(d),g=null,v=!1,p=!0,m=[];for(_&&d._path._overlapsOnly&&(y=d._path,x=d._intersection._segment._path,y.compare(x)&&(y.getArea()&&o.push(y.clone(!1)),r(y),r(x),_=!1));_;){var b=!g,C=function(t,e){function r(r,s){for(;r&&r!==s;){var o=r._segment,c=o._path,l=o.getNext()||c&&c.getFirstSegment(),c=l&&l._intersection;o!==t&&(n(o)||n(l)||l&&i(o)&&(i(l)||c&&i(c._segment)))&&h.push(o),e&&a.push(o),r=r._next}}var s=t._intersection,o=s,h=[];if(e&&(a=[t]),s){for(r(s);s&&s._prev;)s=s._prev;r(s,o)}return h}(d,b),z=C.shift(),P=!(v=!b&&(n(d)||n(z)))&&z;if(b&&(g=new L(w.NO_INSERT),l=null),v){(d.isFirst()||d.isLast())&&(p=d._path._closed),d._visited=!0;break}if(P&&l&&(m.push(l),l=null),l||(P&&C.push(d),l={start:g._segments.length,crossings:C,visited:c=[],handleIn:f}),!i(d=P?z:d)){g.removeSegments(l.start);for(var I=0,M=c.length;I<M;I++)c[I]._visited=!1;for(c.length=0;(d=l&&l.crossings.shift())||(l=m.pop())&&(c=l.visited,f=l.handleIn),l&&!i(d););if(!d)break}z=d.getNext();g.add(new T(d._point,f,z&&d._handleOut)),d._visited=!0,c.push(d),d=z||d._path.getFirstSegment(),f=z&&z._handleIn}v&&(p&&(g.firstSegment.setHandleIn(f),g.setClosed(p)),0!==g.getArea()&&o.push(g))}return o}var _=Math.min,g=Math.max,v=Math.abs,p={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};return{_getWinding:function(t,e,i){return c(t,this.getCurves(),e,i)},unite:function(t,e){return n(this,t,"unite",e)},intersect:function(t,e){return n(this,t,"intersect",e)},subtract:function(t){return n(this,t,"subtract")},exclude:function(t,e){return n(this,t,"exclude",e)},divide:function(t,e){return i(x,[this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){function t(e){e=e&&e._intersection;return e&&e._overlap}var e=this._children,i=e||[this],n=!1,s=!1,a=this.getIntersections(null,function(t){return t.hasOverlap()?n=!0:t.isCrossing()&&(s=!0)}),p=n&&s&&[],a=O.expand(a);if(n)for(var u=l(a,function(t){return t.hasOverlap()},p),c=u.length-1;0<=c;c--){var f=u[c]._segment,_=f.getPrevious(),g=f.getNext();t(_)&&t(g)&&(f.remove(),_._handleOut._set(0,0),g._handleIn._set(0,0),_===f||_.getCurve().hasLength()||(g._handleIn.set(_._handleIn),_.remove()))}s&&(l(a,n&&function(r){var e=r.getCurve(),i=r.getSegment(),s=r._intersection,r=s._curve,s=s._segment;return!!(e&&r&&e._path&&r._path)||(i&&(i._intersection=null),void(s&&(s._intersection=null)))},p),p&&o(p),i=d(r.each(i,function(t){this.push.apply(this,t._segments)},[])));var v,p=i.length;return 1<p&&e?(i!==e&&this.setChildren(i),v=this):1!==p||e||(i[0]!==this&&this.setSegments(i[0].removeSegments()),v=this),v||((v=new N(w.NO_INSERT)).addChildren(i),(v=v.reduce()).copyAttributes(this),this.replaceWith(v)),v},reorient:function(t,i){var n=this._children;return n&&n.length?this.setChildren(h(this.removeChildren(),function(e){return!!(t?e:1&e)},i)):i!==e&&this.setClockwise(i),this},getInteriorPoint:function(){var e=this.getBounds().getCenter(!0);if(!this.contains(e)){for(var i=this.getCurves(),n=e.y,r=[],s=[],a=0,o=i.length;a<o;a++){var h=i[a].getValues(),u=h[1],l=h[3],c=h[5],f=h[7];if(n>=_(u,l,c,f)&&n<=g(u,l,c,f))for(var d=k.getMonoCurves(h),v=0,p=d.length;v<p;v++){var x=d[v],y=x[1],w=x[7];y!==w&&(y<=n&&n<=w||w<=n&&n<=y)&&(x=n===y?x[0]:n===w?x[6]:1===k.solveCubic(x,1,n,s,0,1)?k.getPoint(x,s[0]).x:(x[0]+x[6])/2,r.push(x))}}1<r.length&&(r.sort(function(t,e){return t-e}),e.x=(r[0]+r[1])/2)}return e}}});var B=r.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){function s(t,i){i=k.getValues(t,i,r);h.push(i),a(i,t._index,0,1)}function a(d,i,_,s){var o,f;!(c<s-_)||n&&k.isStraight(d)||k.isFlatEnough(d,e||.25)?(o=d[6]-d[0],f=d[7]-d[1],0<(f=Math.sqrt(o*o+f*f))&&(l+=f,u.push({offset:l,curve:d,index:i,time:s}))):(a((d=k.subdivide(d,.5))[0],i,_,_=(_+s)/2),a(d[1],i,_,s))}for(var o,h=[],u=[],l=0,c=1/(i||32),f=t._segments,d=f[0],_=1,g=f.length;_<g;_++)s(d,o=f[_]),d=o;t._closed&&s(o,f[0]),this.curves=h,this.parts=u,this.length=l,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;(e=r)&&!(i[--r].offset<t););for(;e<n;e++){var s=i[e];if(s.offset>=t){var h=i[(this.index=e)-1],o=h&&h.index===s.index?h.time:0,h=h?h.offset:0;return{index:s.index,time:o+(s.time-o)*(t-h)/(s.offset-h)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),s=n.index,a=r.index;s<=a;s++){var o=k.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(k._evaluateMethods,function(t){this[t+"At"]=function(i){i=this._get(i);return k[t](this.curves[i.index],i.time)}},{})),j=r.extend({initialize:function(r){for(var e,i=this.points=[],n=r._segments,r=r._closed,s=0,a=n.length;s<a;s++){var o=n[s].point;e&&e.equals(o)||i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return 0<i&&(n=[new T(e[0])],1<i&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,s){var u=this.points;if(n-i!=1){for(var l,c=this.chordLengthParameterize(i,n),f=Math.max(e,e*e),d=!0,_=0;_<=4;_++){var g=this.generateBezier(i,n,c,r,s),v=this.findMaxError(i,n,g,c);if(v.error<e&&d)return void this.addCurve(t,g);if(l=v.index,v.error>=f)break;d=this.reparameterize(i,n,c,g),f=v.error}var h=u[l-1].subtract(u[l+1]);this.fitCubic(t,e,i,l,r,h),this.fitCubic(t,e,l,n,h.negate(),s)}else{var o=u[i],h=u[n],u=o.getDistance(h)/3;this.addCurve(t,[o,o.add(r.normalize(u)),h.add(s.normalize(u)),h])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new T(e[3],e[2].subtract(e[3])))},generateBezier:function(t,z,i,n,r){for(var B=1e-12,a=Math.abs,o=this.points,h=o[t],u=o[z],l=[[0,0],[0,0]],c=[0,0],f=0,d=z-t+1;f<d;f++){var b=i[f],C=1-b,x=3*b*C,p=C*C*C,m=x*C,y=x*b,C=b*b*b,x=n.normalize(m),b=r.normalize(y),C=o[t+f].subtract(h.multiply(p+m)).subtract(u.multiply(y+C));l[0][0]+=x.dot(x),l[0][1]+=x.dot(b),l[1][0]=l[0][1],l[1][1]+=b.dot(b),c[0]+=x.dot(C),c[1]+=b.dot(C)}var S,P,z=l[0][0]*l[1][1]-l[1][0]*l[0][1];a(z)>B?(P=l[0][0]*c[1]-l[1][0]*c[0],S=(c[0]*l[1][1]-c[1]*l[0][1])/z,P=P/z):(z=l[0][0]+l[0][1],L=l[1][0]+l[1][1],S=P=a(z)>B?c[0]/z:a(L)>B?c[1]/L:0);var O,A,L=u.getDistance(h),B=B*L;return S<B||P<B?S=P=L/3:(B=u.subtract(h),O=n.normalize(S),A=r.normalize(P),O.dot(B)-A.dot(B)>L*L&&(S=P=L/3,O=A=null)),[h,h.add(O||n.normalize(S)),u.add(A||r.normalize(P)),u]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,l,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var a=this.evaluate(3,t,i),o=this.evaluate(2,n,i),c=this.evaluate(1,r,i),l=a.subtract(l),c=o.dot(o)+l.dot(c);return u.isZero(c)?i:i-l.dot(o)/c},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var u=this.evaluate(3,i,n[a-t]).subtract(this.points[a]),u=u.x*u.x+u.y*u.y;s<=u&&(s=u,r=a)}return{error:s,index:r}}}),E=w.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&c.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),D=E.extend({_class:"PointText",initialize:function(){E.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new f(t.x,t.y,this,"setPoint")},setPoint:function(){var t=c.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,r){if(this._content){this._setStyles(t,e,r);var n=this._lines,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=r.getLeading(),h=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var u=0,l=n.length;u<l;u++){t.shadowColor=h;var c=n[u];s&&(t.fillText(c,0,0),t.shadowColor="rgba(0,0,0,0)"),a&&t.strokeText(c,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var o=this._style,h=this._lines,r=h.length,s=o.getJustification(),u=o.getLeading(),o=this.getView().getTextWidth(o.getFontStyle(),h),h=0;"left"!==s&&(h-=o/("center"===s?2:1));u=new g(h,r?-.75*u:0,o,r*u);return t?t._transformBounds(u,u):u}}),F=r.extend(new function(){function t(t){var l,u,r=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r)for(var n=[0,0,0],s=0;s<3;s++){var o=r[s+1];n[s]=parseInt(1==o.length?o+o:o,16)/255}else if(r=t.match(/^rgba?\((.*)\)$/))for(var s=0,h=(n=r[1].split(",")).length;s<h;s++){o=+n[s];n[s]=s<3?o/255:o}else n=i?((u=a[t])||(e||((e=Q.getContext(1,1)).globalCompositeOperation="copy"),e.fillStyle="rgba(0,0,0,0)",e.fillStyle=t,e.fillRect(0,0,1,1),l=e.getImageData(0,0,1,1).data,u=a[t]=[l[0]/255,l[1]/255,l[2]/255]),u.slice()):[0,0,0];return n}var e,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},s={},a={},o=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],u={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),s=n-Math.min(t,e,i);return[0==s?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),0===n?0:s/n,n]},"hsb-rgb":function(s,e,i){s=(s/60%6+6)%6;var n=Math.floor(s),s=s-n,s=[i,i*(1-e),i*(1-e*s),i*(1-e*(1-s))];return[s[(n=o[n])[0]],s[n[1]],s[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0==s,h=(n+r)/2;return[a?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),a?0:h<.5?s/(n+r):s/(2-n-r),h]},"hsl-rgb":function(t,e,i){if(0===e)return[i,i,i];for(var n=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[],o=0;o<3;o++){var h=n[o];h<0&&(h+=1),1<h&&--h,a[o]=6*h<1?s+6*(r-s)*h:2*h<1?r:3*h<2?s+(r-s)*(2/3-h)*6:s}return a},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(n,function(t,e){s[e]=[],r.each(t,function(t,i){var a=r.capitalize(t),o=/^(hue|saturation)$/.test(t),h=s[e][i]="gradient"===t?function(t){var e=this._components[0];return e!==(t=R.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===e?function(){return c.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+a]=function(){return(this._type===e||o&&/^hs[bl]$/.test(this._type)?this._components:this._convert(e))[i]},this["set"+a]=function(t){this._type===e||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(e),this._properties=n[e],this._type=e),this._components[i]=h.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function l(e){var a,h,u=arguments,c=this.__read,f=0,d=null!=(e=Array.isArray(e)?(u=e)[0]:e)&&typeof e;if("string"===d&&e in n&&(i=e,e=u[1],Array.isArray(e)?(a=e,o=u[2]):(c&&(f=1),u=r.slice(u,1),d=typeof e)),!a){if(h="number"===d?u:"object"===d&&null!=e.length?e:null){var i=i||(3<=h.length?"rgb":"gray"),_=n[i].length,o=h[_];c&&(f+=h===arguments?_+(null!=o?1:0):1),h.length>_&&(h=r.slice(h,0,_))}else if("string"===d)i="rgb",4===(a=t(e)).length&&(o=a[3],a.length--);else if("object"===d)if(e.constructor===l){if(i=e._type,a=e._components.slice(),o=e._alpha,"gradient"===i)for(var g=1,v=a.length;g<v;g++){var p=a[g];p&&(a[g]=p.clone())}}else if(e.constructor===R)i="gradient",h=u;else{i="hue"in e?"lightness"in e?"hsl":"hsb":"gradient"in e||"stops"in e||"radial"in e?"gradient":"gray"in e?"gray":"rgb";var m=n[i],y=s[i];this._components=a=[];for(g=0,v=m.length;g<v;g++)null==(w=e[m[g]])&&!g&&"gradient"===i&&"stops"in e&&(w={stops:e.stops,radial:e.radial}),null!=(w=y[g].call(this,w))&&(a[g]=w);o=e.alpha}c&&i&&(f=1)}if(this._type=i||"rgb",!a){this._components=a=[];for(var w,g=0,v=(y=s[this._type]).length;g<v;g++)null!=(w=y[g].call(this,h&&h[g]))&&(a[g]=w)}return this._components=a,this._properties=n[this._type],this._alpha=o,c&&(this.__read=f),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=u[this._type+"-"+t])?e.apply(this,this._components):u["rgb-"+t].apply(this,u[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new F(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?F.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=h.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:1<t?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha,i=[e(i[0]),e(i[1]),e(i[2])];return n<1&&i.push(n<0?0:n),t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var o,e,u=this._components,l=u[0],r=l._stops,s=u[1],a=u[2];e=l._radial?(o=a.getDistance(s),!(l=u[3])||(u=l.subtract(s)).getLength()>o&&(l=s.add(u.normalize(o-.1))),t.createRadialGradient((l=l||s).x,l.y,0,s.x,s.y,o)):t.createLinearGradient(s.x,s.y,a.x,a.y);for(var c=0,f=r.length;c<f;c++){var d=r[c],_=d._offset;e.addColorStop(null==_?c/(f-1):_,d._color.toCanvasStyle())}return this._canvasStyle=e},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new F(t(),t(),t())}}})},new function(){return r.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=F.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,a=n.length;s<a;s++)r[s]=t(n[s],r[s]);return new F(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),R=r.extend({_class:"Gradient",initialize:function(t,e){this._id=l.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(i){i=this._owners?this._owners.indexOf(i):-1;-1!=i&&(this._owners.splice(i,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new R(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;for(n=0,r=(i=this._stops=q.readList(t,0,{clone:!0})).length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),q=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new q(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=F.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),V=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new c,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new F}),s={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},a={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||paper.project,this._defaults=!r||r instanceof x?i:r instanceof E?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),h="shadowOffset"===i,u=r.capitalize(i),l=s[i],f="set"+u,d="get"+u;o[f]=function(t){var h,r=this._owner,s=r&&r._children;if(s&&0<s.length&&!(r instanceof N))for(var a=0,o=s.length;a<o;a++)s[a]._style[f](t);else i in this._defaults&&((h=this._values[i])!==t&&(n&&(h&&h._owner!==e&&(h._owner=e),t&&t.constructor===F&&((t=t._owner?t.clone():t)._owner=r)),this._values[i]=t,r&&r._changed(l||65)))},o[d]=function(u){var s,a=this._owner,o=a&&a._children;if(i in this._defaults&&(!o||!o.length||u||a instanceof N))(s=this._values[i])===e?(s=this._defaults[i])&&s.clone&&(s=s.clone()):!(u=n?F:h?c:null)||s&&s.constructor===u||(this._values[i]=s=u.read([s],0,{readNull:!0,clone:!0}),s&&n&&(s._owner=a));else if(o)for(var l=0,f=o.length;l<f;l++){var _=o[l]._style[d]();if(l){if(!r.equals(s,_))return e}else s=_}return s},a[d]=function(t){return this._style[d](t)},a[f]=function(t){this._style[f](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,n){var i="get"+n,n="set"+n;o[i]=a[i]="#get"+t,o[n]=a[n]="#set"+t}),w.inject(a),o},{set:function(t){this._values={};var r,e=t instanceof V,i=e?t._values:t;if(i)for(var n in i)n in this._defaults&&(r=i[n],this[n]=r&&e&&r.clone?r.clone():r)},equals:function(t){function i(t,i,n){var h,s=t._values,a=i._values,o=i._defaults;for(h in s){var u=s[h],l=a[h];if(!(n&&h in a||r.equals(u,l===e?o[h]:l)))return!1}return!0}return t===this||t&&this._class===t._class&&i(this,t)&&i(t,this,!0)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&0<t.alpha},hasStroke:function(){var t=this.getStrokeColor();return!!t&&0<t.alpha&&0<this.getStrokeWidth()},hasShadow:function(){var t=this.getShadowColor();return!!t&&0<t.alpha&&(0<this.getShadowBlur()||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function xt(){var t=xt.base.call(this),e=this.getFontSize();return/pt|em|%|px/.test(e)&&(e=this.getView().getPixelSize(e)),null!=t?t:1.2*e}}),H=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var h=r[a],h=h?h+s:e;if(h in t){if(!i)return t[h];t[h]=n;break}}}return{getStyles:function(t){var i=t&&9!==t.nodeType?t.ownerDocument:t,i=i&&i.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(h,e){var i,u=h.ownerDocument,r=u.body,s=u.documentElement;try{i=h.getBoundingClientRect()}catch(a){i={left:0,top:0,width:0,height:0}}var o=i.left-(s.clientLeft||r.clientLeft||0),h=i.top-(s.clientTop||r.clientTop||0);return e||(o+=(u=u.defaultView).pageXOffset||s.scrollLeft||r.scrollLeft,h+=u.pageYOffset||s.scrollTop||r.scrollTop),new g(o,h,i.width,i.height)},getViewportBounds:function(i){var n=i.ownerDocument,i=n.defaultView,n=n.documentElement;return new g(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return H.getBounds(t,e).getPoint()},getSize:function(t){return H.getBounds(t,!0).getSize()},isInvisible:function(t){return H.getSize(t).equals(new d(0,0))},isInView:function(t){return!H.isInvisible(t)&&H.getViewportBounds(t).intersects(H.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},Z={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.addEventListener(r[s],n,!1)},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(e){e=e.targetTouches?(e.targetTouches.length?e.targetTouches:e.changedTouches)[0]:e;return new c(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return Z.getPoint(t).subtract(H.getOffset(e||Z.getTarget(t)))}};Z.requestAnimationFrame=new function(){function t(){var e=s;s=[];for(var i=0,a=e.length;i<a;i++)e[i]();(r=n&&s.length)&&n(t)}var e,n=H.getPrefixed(i,"requestAnimationFrame"),r=!1,s=[];return function(i){s.push(i),n?r||(n(t),r=!0):e=e||setInterval(t,1e3/60)}};var U=r.extend(s,{_class:"View",initialize:function bt(t,e){function r(t){return e[t]||parseInt(e.getAttribute(t),10)}function s(){var t=H.getSize(e);return t.isNaN()||t.isZero()?new d(r("width"),r("height")):t}var u,l,c,f,o;i&&e?(this._id=e.getAttribute("id"),null==this._id&&e.setAttribute("id",this._id="view-"+bt._id++),Z.add(e,this._viewEvents),H.setPrefixed(e.style,{userDrag:f="none",userSelect:f,touchCallout:f,contentZooming:f,tapHighlightColor:"rgba(0,0,0,0)"}),a.hasAttribute(e,"resize")&&Z.add(i,(u=this)._windowEvents={resize:function(){u.setViewSize(s())}}),o=s(),a.hasAttribute(e,"stats")&&"undefined"!=typeof Stats&&(this._stats=new Stats,c=(l=this._stats.domElement).style,f=H.getOffset(e),c.position="absolute",c.left=f.x+"px",c.top=f.y+"px",n.body.appendChild(l))):(o=new d(e),e=null),this._project=t,this._scope=t._scope,this._element=e,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(o.width,o.height),this._viewSize=o,bt._views.push(this),((bt._viewsById[this._id]=this)._matrix=new p)._owner=this,bt._focused||(bt._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;U._focused===this&&(U._focused=null),U._views.splice(U._views.indexOf(this),1),delete U._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),Z.remove(this._element,this._viewEvents),Z.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(w._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){(this._autoUpdate=t)&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){var t;this._requested||(t=this,Z.requestAnimationFrame(function(){var e;t._requested=!1,t._animate&&(t.requestUpdate(),e=t._element,H.getPrefixed(n,"hidden")&&"true"!==a.getAttribute(e,"keepalive")||!H.isInView(e)||t._handleFrame()),t._autoUpdate&&t.update()}),this._requested=!0)},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var i in this._frameItems){i=this._frameItems[i];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new _(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=d.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new g(new c,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return H.isInView(this._element)},isInserted:function(){return H.isInserted(this._element)},getPixelSize:function(t){var e,r,s=this._element;return s?(r=s.parentNode,(s=n.createElement("div")).style.fontSize=t,r.appendChild(s),e=parseFloat(H.getStyles(s).fontSize),r.removeChild(s)):e=parseFloat(e),e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:c).read(arguments),n=c.read(arguments,0,{readNull:!0});return this.transform((new p)[t](i,n||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new p;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=c.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var e=this._decompose(),e=e&&e.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new p).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var i=this._decompose(),i=i&&i.scaling;return i?new f(i.x,i.y,this,"setScaling"):e},setScaling:function(){var t=this.getScaling(),e=c.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(c.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(c.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(c.read(arguments))},getEventPoint:function(t){return this.viewToProject(Z.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return n&&"string"==typeof e&&(e=n.getElementById(e)),new(i?W:U)(t,e)}}},new function(){function t(e){e=Z.getTarget(e);return e.getAttribute&&U._viewsById[e.getAttribute("id")]}function e(){var t=U._focused;if(!t||!t.isVisible())for(var e=0,i=U._views.length;e<i;e++)if((t=U._views[e]).isVisible()){U._focused=h=t;break}}function r(t,e,i){t._handleMouseEvent("mousemove",e,i)}function s(t,e,i,n,r,s,a){for(var h,u=!1;t&&t!==a&&!function o(t,a){if(t.responds(a)){if(h=h||new $(a,n,r,e||t,s?r.subtract(s):null),t.emit(a,h)&&(I=!0,h.prevented&&(M=!0),h.stopped))return u=!0}else if(a=T[a])return o(t,a)}(t,i);)t=t._parent;return u}function a(t,e,i,n,r,a){return t._project.removeOn(i),M=I=!1,b&&s(b,null,i,n,r,a)||e&&e!==b&&!e.isDescendant(b)&&s(e,null,T[i]||i,n,r,a,b)||s(t,b||e||t,i,n,r,a)}if(i){var o,h,u,l,c,f=!1,d=!1,v=i.navigator;v.pointerEnabled||v.msPointerEnabled?(u="pointerdown MSPointerDown",l="pointermove MSPointerMove",c="pointerup pointercancel MSPointerUp MSPointerCancel"):(u="touchstart",l="touchmove",c="touchend touchcancel","ontouchstart"in i&&v.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(u+=" mousedown",l+=" mousemove",c+=" mouseup"));var g={},v={mouseout:function(t){var n,s,u,e=U._focused,o=Z.getRelatedTarget(t);!e||o&&"HTML"!==o.nodeName||(s=(n=Z.getOffset(t,e._element)).x,o=(u=Math.abs)(s),n.x=u(u=o-(1<<25))<o?u*(s<0?-1:1):s,r(e,t,e.viewToProject(n)))},scroll:e};g[u]=function(e){var i=U._focused=t(e);f||(f=!0,i._handleMouseEvent("mousedown",e))},v[l]=function(i){var s,n=U._focused;d||((s=t(i))?n!==s&&(n&&r(n,i),o=o||n,n=U._focused=h=s):h&&h===n&&(o&&!o.isInserted()&&(o=null),n=U._focused=o,o=null,e())),n&&r(n,i)},v[u]=function(){d=!0},v[c]=function(t){var e=U._focused;e&&f&&e._handleMouseEvent("mouseup",t),d=f=!1},Z.add(n,v),Z.add(i,{load:e});var m,y,w,x,b,C,S,P,I=!1,M=!1,T={doubleclick:"click",mousedrag:"mousemove"},z=!1,k={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:g,_handleMouseEvent:function(t,e,i){function n(t){return r.virtual[t]||l.responds(t)||u&&u.responds(t)}var r=this._itemEvents,o=r.native[t],h="mousemove"===t,u=this._scope.tool,l=this;h&&f&&n("mousedrag")&&(t="mousedrag"),i=i||this.getEventPoint(e);var c=this.getBounds().contains(i),v=o&&c&&l._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),_=v&&v.item||null,g=!1,v={};v[t.substr(5)]=!0,o&&_!==x&&(x&&s(x,null,"mouseleave",e,i),_&&s(_,null,"mouseenter",e,i),x=_),z^c&&(s(this,null,c?"mouseenter":"mouseleave",e,i),g=!0),!c&&!v.drag||i.equals(y)||(a(this,_,h?t:"mousemove",e,i,y),g=!0),z=c,(v.down&&c||v.up&&m)&&(a(this,_,t,e,i,m),v.down?(P=_===C&&Date.now()-S<300,w=C=_,b=!M&&_,m=i):v.up&&(M||_!==w||(S=Date.now(),a(this,_,P?"doubleclick":"click",e,i,m),P=!1),w=b=null),g=!(z=!1)),y=i,((I=g&&u?u._handleMouseEvent(t,e,i,v)||I:I)&&!v.move||v.down&&n("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){function r(r){r.responds(t)&&(paper=a,r.emit(t,s=s||new J(t,e,i,n)))}var s,a=this._scope,o=a.tool;this.isVisible()&&(r(this),o&&o.responds(t)&&r(o))},_countItemEvent:function(t,e){var s,r=this._itemEvents,n=r.native,r=r.virtual;for(s in k)n[s]=(n[s]||0)+(k[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:e}}}}),W=U.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var o=d.read(arguments,1);if(o.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=Q.getCanvas(o)}var h=this._context=e.getContext("2d");h.save(),this._pixelRatio=1,/^off|false$/.test(a.getAttribute(e,"hidpi"))||(o=i.devicePixelRatio||1,h=H.getPrefixed(h,"backingStorePixelRatio")||1,this._pixelRatio=o/h),U.call(this,t,e),this._needsUpdate=!0},remove:function Ct(){return this._context.restore(),Ct.base.call(this)},_setElementSize:function St(t,e){var r,s,i=this._pixelRatio;St.base.call(this,t*i,e*i),1!==i&&(s=this._element,r=this._context,a.hasAttribute(s,"resize")||((s=s.style).width=t+"px",s.height=e+"px"),r.restore(),r.save(),r.scale(i,i))},getPixelSize:function Pt(t){var e,n,r=paper.agent;return r&&r.firefox?e=Pt.base.call(this,t):(r=(n=this._context).font,n.font=t+" serif",e=parseFloat(n.font),n.font=r),e},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),!(this._needsUpdate=!1)}}),G=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return X.modifiers}}),J=G.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),X=new function(){function t(t){var e=t.key||t.keyIdentifier,e=/^U\+/.test(e)?String.fromCharCode(parseInt(e.substr(2),16)):/^Arrow[A-Z]/.test(e)?e.substr(5):"Unidentified"===e?String.fromCharCode(t.keyCode):e;return o[e]||(1<e.length?r.hyphenate(e):e.toLowerCase())}function e(t,i,n,a){var o,h=U._focused;if((u[i]=t)?l[i]=n:delete l[i],1<i.length&&(o=r.camelize(i))in c){c[o]=t;var f=paper&&paper.agent;if("meta"===o&&f&&f.mac)if(t)s={};else{for(var d in s)d in l&&e(!1,d,s[d],a);s=null}}else t&&s&&(s[i]=n);h&&h._handleKeyEvent(t?"keydown":"keyup",a,i,n)}var s,a,o={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},h={tab:"\t",space:" ",enter:"\r"},u={},l={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});return Z.add(n,{keydown:function(i){var n=t(i),r=paper&&paper.agent;1<n.length||r&&r.chrome&&(i.altKey||r.mac&&i.metaKey||!r.mac&&i.ctrlKey)?e(!0,n,h[n]||(1<n.length?"":n),i):a=n},keypress:function(i){var n,s;a&&(n=t(i),s=32<=(s=i.charCode)?String.fromCharCode(s):1<n.length?"":n,e(!0,n=n!==a?s.toLowerCase():n,s,i),a=null)},keyup:function(i){var n=t(i);n in l&&e(!1,n,l[n],i)}}),Z.add(i,{blur:function(t){for(var i in l)e(!1,i,l[i],t)}}),{modifiers:c,isDown:function(t){return!!u[t]}}},$=G.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Y=G.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)i=(e=i)._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),K=(o.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){o.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){null!=(this._minDistance=t)&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){function r(t,e){var r=i,s=a?c._point:c._downPoint||r;if(a){if(c._moveCount&&r.equals(s))return;if(s&&(null!=t||null!=e)){var o=r.subtract(s),h=o.getLength();if(h<(t||0))return;e&&(r=s.add(o.normalize(Math.min(h,e))))}c._moveCount++}return c._point=r,c._lastPoint=s||r,n.down&&(c._moveCount=-1,c._downPoint=r,c._downCount++),1}function s(){o&&(l=c.emit(t,new Y(c,t,e))||l)}paper=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var a=n.move||n.drag,o=this.responds(t),h=this.minDistance,u=this.maxDistance,l=!1,c=this;if(n.down)r(),s();else if(n.up)r(null,u),s();else if(o)for(;r(h,u);)s();return l}}),{request:function(e){var i=new t.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var t=i.status;0===t||200===t?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,n='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(n);e.onError(n,t)},i.send(null)}}),Q={canvases:[],getCanvas:function(t,e){if(!i)return null;var r,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=n.createElement("canvas"),s=!1);var a=r.getContext("2d");if(!a)throw new Error("Canvas "+r+" is unable to provide a 2D context.");return r.width===t&&r.height===e?s&&a.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),a.save(),r},getContext:function(t,i){i=this.getCanvas(t,i);return i?i.getContext("2d"):null},release:function(e){e=e&&e.canvas?e.canvas:e;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},tt=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function e(e,i,a,r){var u,l=r-t(e,i,a),r=t(d=e+l,_=i+l,g=a+l),a=v(d,_,g),l=p(d,_,g);a<0&&(d=r+(d-r)*r/(u=r-a),_=r+(_-r)*r/u,g=r+(g-r)*r/u),255<l&&(d=r+(d-r)*(u=255-r)/(l=l-r),_=r+(_-r)*u/l,g=r+(g-r)*u/l)}function i(t,e,i){return p(t,e,i)-v(t,e,i)}function n(t,r,o,n){var s=[t,r,o],a=p(t,r,o),o=v(t,r,o),r=0===v(o=o===t?0:o===r?1:2,a=a===t?0:a===r?1:2)?1===p(o,a)?2:1:0;s[a]>s[o]?(s[r]=(s[r]-s[o])*n/(s[a]-s[o]),s[a]=n):s[r]=s[a]=0,s[o]=0,d=s[0],_=s[1],g=s[2]}var s,a,o,h,u,l,c,f,d,_,g,v=Math.min,p=Math.max,m=Math.abs,y={multiply:function(){d=u*s/255,_=l*a/255,g=c*o/255},screen:function(){d=u+s-u*s/255,_=l+a-l*a/255,g=c+o-c*o/255},overlay:function(){d=u<128?2*u*s/255:255-2*(255-u)*(255-s)/255,_=l<128?2*l*a/255:255-2*(255-l)*(255-a)/255,g=c<128?2*c*o/255:255-2*(255-c)*(255-o)/255},"soft-light":function(){var t=s*u/255;d=t+u*(255-(255-u)*(255-s)/255-t)/255,_=(t=a*l/255)+l*(255-(255-l)*(255-a)/255-t)/255,g=(t=o*c/255)+c*(255-(255-c)*(255-o)/255-t)/255},"hard-light":function(){d=s<128?2*s*u/255:255-2*(255-s)*(255-u)/255,_=a<128?2*a*l/255:255-2*(255-a)*(255-l)/255,g=o<128?2*o*c/255:255-2*(255-o)*(255-c)/255},"color-dodge":function(){d=0===u?0:255===s?255:v(255,255*u/(255-s)),_=0===l?0:255===a?255:v(255,255*l/(255-a)),g=0===c?0:255===o?255:v(255,255*c/(255-o))},"color-burn":function(){d=255===u?255:0===s?0:p(0,255-255*(255-u)/s),_=255===l?255:0===a?0:p(0,255-255*(255-l)/a),g=255===c?255:0===o?0:p(0,255-255*(255-c)/o)},darken:function(){d=u<s?u:s,_=l<a?l:a,g=c<o?c:o},lighten:function(){d=s<u?u:s,_=a<l?l:a,g=o<c?c:o},difference:function(){(d=u-s)<0&&(d=-d),(_=l-a)<0&&(_=-_),(g=c-o)<0&&(g=-g)},exclusion:function(){d=u+s*(255-u-u)/255,_=l+a*(255-l-l)/255,g=c+o*(255-c-c)/255},hue:function(){n(s,a,o,i(u,l,c)),e(d,_,g,t(u,l,c))},saturation:function(){n(u,l,c,i(s,a,o)),e(d,_,g,t(u,l,c))},luminosity:function(){e(u,l,c,t(s,a,o))},color:function(){e(s,a,o,t(u,l,c))},add:function(){d=v(u+s,255),_=v(l+a,255),g=v(c+o,255)},subtract:function(){d=p(u-s,0),_=p(l-a,0),g=p(c-o,0)},average:function(){d=(u+s)/2,_=(l+a)/2,g=(c+o)/2},negation:function(){d=255-m(255-s-u),_=255-m(255-a-l),g=255-m(255-o-c)}},w=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),x=Q.getContext(1,1);x&&(r.each(y,function(t,e){var i="darken"===e,n=!1;x.save();try{x.fillStyle=i?"#300":"#a00",x.fillRect(0,0,1,1),x.globalCompositeOperation=e,x.globalCompositeOperation===e&&(x.fillStyle=i?"#a00":"#300",x.fillRect(0,0,1,1),n=x.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(r){}x.restore(),w[e]=n}),Q.release(x)),this.process=function(x,e,i,n,r){var v=e.canvas,p="normal"===x;if(p||w[x])i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,p||(i.globalCompositeOperation=x),i.drawImage(v,r.x,r.y),i.restore();else{var m=y[x];if(m){for(var x=i.getImageData(r.x,r.y,v.width,v.height),b=x.data,C=e.getImageData(0,0,v.width,v.height).data,S=0,P=b.length;S<P;S+=4){s=C[S],u=b[S],a=C[S+1],l=b[S+1],o=C[S+2],c=b[S+2],h=C[S+3],f=b[S+3],m();var I=h*n/255,M=1-I;b[S]=I*d+M*u,b[S+1]=I*_+M*l,b[S+2]=I*g+M*c,b[S+3]=h*n+M*f}i.putImageData(x,r.x,r.y)}}}},et=new function(){function i(t,e,i){for(var n in e){var r=e[n],s=o[n];"number"==typeof r&&i&&(r=i.number(r)),s?t.setAttributeNS(s,n,r):t.setAttribute(n,r)}return t}var r="http://www.w3.org/2000/svg",s="http://www.w3.org/2000/xmlns",a="http://www.w3.org/1999/xlink",o={href:a,xlink:s,xmlns:s+"/","xmlns:xlink":s+"/"};return{svg:r,xmlns:s,xlink:a,create:function(t,e,s){return i(n.createElementNS(r,t),e,s)},get:function(t,n){var i=o[n];return"null"===(n=i?t.getAttributeNS(i,n):t.getAttribute(n))?null:n},set:i}},it=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof A||t instanceof C||t instanceof E)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});return function(){function e(t,h,l){var c,f,n=new r,s=t.getTranslation();return h&&(c=(t=t._shiftless())._inverseTransform(s),n[l?"cx":"x"]=c.x,n[l?"cy":"y"]=c.y,s=null),t.isIdentity()||((f=t.decompose())?(h=[],l=f.rotation,c=f.scaling,f=f.skewing,s&&!s.isZero()&&h.push("translate("+S.point(s)+")"),l&&h.push("rotate("+S.number(l)+")"),u.isZero(c.x-1)&&u.isZero(c.y-1)||h.push("scale("+S.point(c)+")"),f&&f.x&&h.push("skewX("+S.number(f.x)+")"),f&&f.y&&h.push("skewY("+S.number(f.y)+")"),n.transform=h.join(" ")):n.transform="matrix("+t.getValues().join(",")+")"),n}function i(t,i){for(var n=e(t._matrix),r=t._children,s=et.create("g",n,S),a=0,o=r.length;a<o;a++){var l,h=r[a],u=b(h,i);u&&(h.isClipMask()?((l=et.create("clipPath")).appendChild(u),m(h,l,"clip"),et.set(s,{"clip-path":"url(#"+l.id+")"})):s.appendChild(u))}return s}function a(a){var o,i=a._type,n=a._radius,r=e(a._matrix,!0,"rectangle"!==i);return"rectangle"===i&&(i="rect",a=(o=a._size).width,o=o.height,r.x-=a/2,r.y-=o/2,r.width=a,r.height=o,n.isZero()&&(n=null)),n&&("circle"===i?r.r=n:(r.rx=n.width,r.ry=n.height)),et.create(i,r,S)}function _(t,e,i){var n={},s=!i&&t.getParent(),a=[];return null!=t._name&&(n.id=t._name),r.each(it,function(e){var u=e.get,o=e.type,h=t[u]();(e.exportFilter?!e.exportFilter(t,h):s&&r.equals(s[u](),h))||("color"!==o||null==h||(u=h.getAlpha())<1&&(n[e.attribute+"-opacity"]=u),"style"===o?a.push(e.attribute+": "+h):n[e.attribute]=null==h?"none":"color"===o?h.gradient?function(t){if(!(e=v(t,"color"))){var i,o,n=t.getGradient(),r=n._radial,s=t.getOrigin(),a=t.getDestination();r?(i={cx:s.x,cy:s.y,r:s.getDistance(a)},(o=t.getHighlight())&&(i.fx=o.x,i.fy=o.y)):i={x1:s.x,y1:s.y,x2:a.x,y2:a.y},i.gradientUnits="userSpaceOnUse";for(var e=et.create((r?"radial":"linear")+"Gradient",i,S),h=n._stops,u=0,l=h.length;u<l;u++){var _=h[u],f=_._color,d=f.getAlpha(),_=_._offset;i={offset:null==_?u/(l-1):_},f&&(i["stop-color"]=f.toCSS(!0)),d<1&&(i["stop-opacity"]=d),e.appendChild(et.create("stop",i,S))}m(t,e,"color")}return"url(#"+e.id+")"}(h):h.toCSS(!0):"array"===o?h.join(","):"lookup"===o?e.toSVG[h]:h)}),a.length&&(n.style=a.join(";")),1===n.opacity&&delete n.opacity,t._visible||(n.visibility="hidden"),et.set(e,n,S)}function v(t,e){return P=P||{ids:{},svgs:{}},t&&P.svgs[e+"-"+(t._id||t.__id||(t.__id=l.get("svg")))]}function m(t,e,i){P||v();var n=P.ids[i]=(P.ids[i]||0)+1;e.id=i+"-"+n,P.svgs[i+"-"+(t._id||t.__id)]=e}function x(e,i){var n=e,r=null;if(P){for(var s in n="svg"===e.nodeName.toLowerCase()&&e,P.svgs)r||(n||(n=et.create("svg"),n.appendChild(e)),r=n.insertBefore(et.create("defs"),n.firstChild)),r.appendChild(P.svgs[s]);P=null}return i.asString?(new t.XMLSerializer).serializeToString(n):n}function b(t,a,i){var s=I[t._class],r=s&&s(t,a);return r&&((s=a.onExport)&&(r=s(t,r,a)||r),(a=JSON.stringify(t._data))&&"{}"!==a&&"null"!==a&&r.setAttribute("data-paper-data",a)),r&&_(t,r,i)}function C(t){return S=new h((t=t||{}).precision),t}var S,P,I={Group:i,Layer:i,Raster:function(t,i){var n=e(t._matrix,!0),r=t.getSize(),s=t.getImage();return n.x-=r.width/2,n.y-=r.height/2,n.width=r.width,n.height=r.height,n.href=!1===i.embedImages&&s&&s.src||t.toDataURL(),et.create("image",n,S)},Path:function(t,i){var d=i.matchShapes;if(d){var f=t.toShape(!1);if(f)return a(f)}var o=t._segments,h=o.length,u=e(t._matrix);if(d&&2<=h&&!t.hasHandles())if(2<h){for(var s=t._closed?"polygon":"polyline",l=[],c=0;c<h;c++)l.push(S.point(o[c]._point));u.points=l.join(" ")}else{s="line";f=o[0]._point,d=o[1]._point;u.set({x1:f.x,y1:f.y,x2:d.x,y2:d.y})}else s="path",u.d=t.getPathData(null,i.precision);return et.create(s,u,S)},Shape:a,CompoundPath:function(t,r){var n=e(t._matrix);return(r=t.getPathData(null,r.precision))&&(n.d=r),et.create("path",n,S)},SymbolItem:function(o,i){var n=e(o._matrix,!0),r=o._definition,s=v(r,"symbol"),a=r._item,o=a.getBounds();return s||((s=et.create("symbol",{viewBox:S.rectangle(o)})).appendChild(b(a,i)),m(r,s,"symbol")),n.href="#"+s.id,n.x+=o.x,n.y+=o.y,n.width=o.width,n.height=o.height,n.overflow="visible",et.create("use",n,S)},PointText:function(t){var i=et.create("text",e(t._matrix,!0),S);return i.textContent=t._content,i}};w.inject({exportSVG:function(t){return x(b(this,t=C(t),!0),t)}}),y.inject({exportSVG:function(t){t=C(t);var i=this._children,h=this.getView(),l=r.pick(t.bounds,"view"),o=t.matrix||"view"===l&&h._matrix,o=o&&p.read([o]),h="view"===l?new g([0,0],h.getViewSize()):"content"===l?w._getBounds(i,o,{stroke:!0}):g.read([l],0,{readNull:!0}),l={version:"1.1",xmlns:et.svg,"xmlns:xlink":et.xlink};h&&(l.width=h.width,l.height=h.height,(h.x||h.y)&&(l.viewBox=S.rectangle(h)));var l=et.create("svg",l,S),c=l;o&&!o.isIdentity()&&(c=l.appendChild(et.create("g",e(o),S)));for(var f=0,d=i.length;f<d;f++)c.appendChild(b(i[f],t,!0));return x(l,t)}})}(),function(){function s(s,e,a,n,r){s=et.get(s,e),a=null==s?n?null:a?"":0:a?s:parseFloat(s);return/%\s*$/.test(s)?a/100*(r?1:k[/x|^width/.test(e)?"width":"height"]):a}function a(t,e,i,n,r){return e=s(t,e||"x",!1,n,r),i=s(t,i||"y",!1,n,r),!n||null!=e&&null!=i?new c(e,i):null}function o(t,e,i,n,r){return e=s(t,e||"width",!1,n,r),i=s(t,i||"height",!1,n,r),!n||null!=e&&null!=i?new d(e,i):null}function h(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?M(t)||t:"lookup"===e?i[t]:t}function u(t,u,i,n){var r=t.childNodes,s="clippath"===u,a="defs"===u,o=new x,h=o._project,u=h._currentStyle,l=[];if(s||a||(o=P(o,t,n),h._currentStyle=o._style.clone()),n)for(var c=t.querySelectorAll("defs"),f=0,d=c.length;f<d;f++)T(c[f],i,!1);for(f=0,d=r.length;f<d;f++){var _,g=r[f];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(_=T(g,i,!1))||_ instanceof I||l.push(_)}return o.addChildren(l),s&&(o=P(o.reduce(),t,n)),h._currentStyle=u,(s||a)&&(o.remove(),o=null),o}function l(a,e){for(var i=a.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new c(parseFloat(i[r]),parseFloat(i[r+1])));a=new L(n);return"polygon"===e&&a.closePath(),a}function _(t,r){var i,g=(s(t,"href",!0)||"").substring(1),r="radialgradient"===r;if(g)(i=O[g].getGradient())._radial^r&&((i=i.clone())._radial=r);else{for(var o=t.childNodes,h=[],u=0,l=o.length;u<l;u++){var c=o[u];1===c.nodeType&&h.push(P(new q,c))}i=new R(h,r)}var f,d,_,g="userSpaceOnUse"!==s(t,"gradientUnits",!0);return r?(d=(f=a(t,"cx","cy",!1,g)).add(s(t,"r",!1,!1,g),0),_=a(t,"fx","fy",!0,g)):(f=a(t,"x1","y1",!1,g),d=a(t,"x2","y2",!1,g)),P(new F(i,f,d,_),t)._scaleToBounds=g,null}function v(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new p,a=0,o=r.length;a<o;a++){var l=r[a];if(!l)break;for(var u=l.split(/\(\s*/),l=u[0],c=u[1].split(/[\s,]+/g),f=0,d=c.length;f<d;f++)c[f]=parseFloat(c[f]);switch(l){case"matrix":s.append(new p(c[0],c[1],c[2],c[3],c[4],c[5]));break;case"rotate":s.rotate(c[0],c[1],c[2]);break;case"translate":s.translate(c[0],c[1]);break;case"scale":s.scale(c);break;case"skewX":s.skew(c[0],0);break;case"skewY":s.skew(0,c[0])}}t.transform(s)}}function m(t,e,r){r="fill-opacity"===r?"getFillColor":"getStrokeColor",r=t[r]&&t[r]();r&&r.setAlpha(parseFloat(e))}function b(t,o,n){var a=t.attributes[o],a=a&&a.value;return a||(o=r.camelize(o),(a=t.style[o])||n.node[o]===n.parent[o]||(a=n.node[o])),a?"none"===a?null:a:e}function P(t,i,n){var s=i.parentNode,a={node:H.getStyles(i)||{},parent:!n&&!/^defs$/i.test(s.tagName)&&H.getStyles(s)||{}};return r.each(B,function(n,r){var s=b(i,r,a);t=s!==e&&n(t,s,r,i,a)||t}),t}function M(r){r=r&&r.match(/\((?:["'#]*)([^"')]+)/),r=r&&r[1],r=r&&O[i?r.replace(i.location.href.split("#")[0]+"#",""):r];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function T(t,e,i){var s,a,h,v=t.nodeName.toLowerCase(),m="#document"!==v,c=n.body;i&&m&&(k=o(t,null,null,!0)||paper.getView().getSize(),s=et.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),a=t.parentNode,h=t.nextSibling,s.appendChild(t),c.appendChild(s));var p=paper.settings,d=p.applyMatrix,_=p.insertItems;p.applyMatrix=!1,p.insertItems=!1;var g=N[v],v=g&&g(t,v,e,i)||null;return p.insertItems=_,p.applyMatrix=d,v&&(!m||v instanceof x||(v=P(v,t,i)),p=e.onImport,m=m&&t.getAttribute("data-paper-data"),p&&(v=p(t,v,e)||v),e.expandShapes&&v instanceof C&&(v.remove(),v=v.toPath()),m&&(v._data=JSON.parse(m))),s&&(c.removeChild(s),a&&(h?a.insertBefore(t,h):a.appendChild(t))),i&&(O={},v&&r.pick(e.applyMatrix,d)&&v.matrix.apply(!0,!0)),v}function z(i,r,s){function a(n){try{var a="object"==typeof n?n:(new t.DOMParser).parseFromString(n,"image/svg+xml");if(!a.nodeName)throw a=null,new Error("Unsupported SVG source: "+i);paper=h,u=T(a,r,!0),r&&!1===r.insert||s._insertItem(e,u);var l=r.onLoad;l&&l(u,n)}catch(c){o(c)}}function o(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if(!i)return null;r="function"==typeof r?{onLoad:r}:r||{};var h=paper,u=null;if("string"!=typeof i||/^.*</.test(i)){if("undefined"!=typeof File&&i instanceof File){var l=new FileReader;return l.onload=function(){a(l.result)},l.onerror=function(){o(l.error)},l.readAsText(i)}a(i)}else{var c=n.getElementById(i);c?a(c):K.request({url:i,async:!0,onLoad:a,onError:o})}return u}var k,O={},N={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType)return T(o,i,n)}},g:u,svg:u,clippath:u,polygon:l,polyline:l,path:function(t){return A.create(t.getAttribute("d"))},lineargradient:_,radialgradient:_,image:function(t){var e=new S(s(t,"href",!0));return e.on("load",function(){var i=o(t);this.setSize(i);i=this._matrix._transformPoint(a(t).add(i.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new I(u(t,e,i,n),!0)},defs:u,use:function(n){var i=(s(n,"href",!0)||"").substring(1),i=O[i],n=a(n);return i?i instanceof I?i.place(n):i.clone().translate(n):null},circle:function(t){return new C.Circle(a(t,"cx","cy"),s(t,"r"))},ellipse:function(t){return new C.Ellipse({center:a(t,"cx","cy"),radius:o(t,"rx","ry")})},rect:function(t){return new C.Rectangle(new g(a(t),o(t)),o(t,"rx","ry"))},line:function(t){return new L.Line(a(t,"x1","y1"),a(t,"x2","y2"))},text:function(t){var e=new D(a(t).add(a(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},B=r.set(r.each(it,function(t){this[t.attribute]=function(e,r){var n;!e[t.set]||(e[t.set](h(r,t.type,t.fromSVG)),"color"!==t.type)||(n=e[t.get]())&&(n._scaleToBounds&&(r=e.getBounds(),n.transform((new p).translate(r.getPoint()).scale(r.getSize()))),e instanceof C&&n.transform((new p).translate(e.getPosition(!0).negate())))}},{}),{id:function(t,e){(O[e]=t).setName&&t.setName(e)},"clip-path":function(t,i){i=M(i);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof x))return new x(i,t);t.insertChild(0,i)}},gradientTransform:v,transform:v,"fill-opacity":m,"stroke-opacity":m,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){var i;t.setOffset&&(i=e.match(/(.*)%$/),t.setOffset(i?i[1]/100:parseFloat(e)))},viewBox:function(t,l,i,n,r){var a,s,f=new g(h(l,"array")),l=o(n,null,null,!0);t instanceof x?(s=l?l.divide(f.getSize()):1,a=(new p).scale(s).translate(f.getPoint().negate()),s=t):t instanceof I&&(l&&f.setSize(l),s=t._item),s&&("visible"!==b(n,"overflow",r)&&((f=new C.Rectangle(f)).setClipMask(!0),s.addChild(f)),a&&s.transform(a))}});w.inject({importSVG:function(t,e){return z(t,e,this)}}),y.inject({importSVG:function(t,e){return this.activate(),z(t,e,this)}})}(),(paper=new(a.inject(r.exports,{enumerable:!0,Base:r,Numerical:u,Key:X,DomEvent:Z,DomElement:H,document:n,window:i,Symbol:I,PlacedSymbol:P}))).agent.node&&require("./node/extend.js")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("jquery")):factory(jQuery)}(function($,undefined){"use strict";var style,defaultOpts={beforeShow:noop,move:noop,change:noop,show:noop,hide:noop,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},spectrums=[],IE=!!/msie/i.exec(window.navigator.userAgent),rgbaSupport=((style=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",contains(style.backgroundColor,"rgba")||contains(style.backgroundColor,"hsla")),replaceInput=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),markup=function(){var gradientFix="";if(IE)for(var i=1;i<=6;i++)gradientFix+="<div class='sp-"+i+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",gradientFix,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function contains(str,substr){return!!~(""+str).indexOf(substr)}function paletteTemplate(p,color,className,opts){for(var html=[],i=0;i<p.length;i++){var tiny,c,formattedString,swatchStyle=p[i];swatchStyle?(c=(tiny=tinycolor(swatchStyle)).toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",c+=tinycolor.equals(color,swatchStyle)?" sp-thumb-active":"",formattedString=tiny.toString(opts.preferredFormat||"rgb"),swatchStyle=rgbaSupport?"background-color:"+tiny.toRgbString():"filter:"+tiny.toFilter(),html.push('<span title="'+formattedString+'" data-color="'+tiny.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+swatchStyle+';"></span></span>')):html.push($("<div />").append($('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",opts.noColorSelectedText)).html())}return"<div class='sp-cf "+className+"'>"+html.join("")+"</div>"}function spectrum(isInputTypeColor,theme){var func,wait,debounce,timeout,opts=function(opts,callbackContext){return(opts=$.extend({},defaultOpts,opts)).callbacks={move:bind(opts.move,callbackContext),change:bind(opts.change,callbackContext),show:bind(opts.show,callbackContext),hide:bind(opts.hide,callbackContext),beforeShow:bind(opts.beforeShow,callbackContext)},opts}(theme,isInputTypeColor),flat=opts.flat,showSelectionPalette=opts.showSelectionPalette,localStorageKey=opts.localStorageKey,theme=opts.theme,callbacks=opts.callbacks,resize=(func=reflow,function(){var context=this,args=arguments;debounce&&clearTimeout(timeout),!debounce&&timeout||(timeout=setTimeout(function(){timeout=null,func.apply(context,args)},wait))}),visible=!(wait=10),isDragging=!1,dragWidth=0,dragHeight=0,dragHelperHeight=0,slideHeight=0,alphaWidth=0,alphaSlideHelperWidth=0,slideHelperHeight=0,currentHue=0,currentSaturation=0,currentValue=0,currentAlpha=1,palette=[],paletteArray=[],paletteLookup={},selectionPalette=opts.selectionPalette.slice(0),maxSelectionSize=opts.maxSelectionSize,draggingClass="sp-dragging",shiftMovementDirection=null,doc=isInputTypeColor.ownerDocument,boundElement=(doc.body,$(isInputTypeColor)),disabled=!1,container=$(markup,doc).addClass(theme),pickerContainer=container.find(".sp-picker-container"),dragger=container.find(".sp-color"),dragHelper=container.find(".sp-dragger"),slider=container.find(".sp-hue"),slideHelper=container.find(".sp-slider"),alphaSliderInner=container.find(".sp-alpha-inner"),alphaSlider=container.find(".sp-alpha"),alphaSlideHelper=container.find(".sp-alpha-handle"),textInput=container.find(".sp-input"),paletteContainer=container.find(".sp-palette"),initialColorContainer=container.find(".sp-initial"),cancelButton=container.find(".sp-cancel"),clearButton=container.find(".sp-clear"),chooseButton=container.find(".sp-choose"),toggleButton=container.find(".sp-palette-toggle"),isInput=boundElement.is("input"),isInputTypeColor=isInput&&"color"===boundElement.attr("type")&&inputTypeColorSupport(),shouldReplace=isInput&&!flat,replacer=shouldReplace?$(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName):$([]),offsetElement=shouldReplace?replacer:boundElement,previewElement=replacer.find(".sp-preview-inner"),initialColor=opts.color||isInput&&boundElement.val(),colorOnShow=!1,currentPreferredFormat=opts.preferredFormat,clickoutFiresChange=!opts.showButtons||opts.clickoutFiresChange,isEmpty=!initialColor,allowEmpty=opts.allowEmpty&&!isInputTypeColor;function applyOptions(){if(opts.showPaletteOnly&&(opts.showPalette=!0),toggleButton.text(opts.showPaletteOnly?opts.togglePaletteMoreText:opts.togglePaletteLessText),opts.palette){palette=opts.palette.slice(0),paletteArray=$.isArray(palette[0])?palette:[palette],paletteLookup={};for(var i=0;i<paletteArray.length;i++)for(var j=0;j<paletteArray[i].length;j++){var rgb=tinycolor(paletteArray[i][j]).toRgbString();paletteLookup[rgb]=!0}}container.toggleClass("sp-flat",flat),container.toggleClass("sp-input-disabled",!opts.showInput),container.toggleClass("sp-alpha-enabled",opts.showAlpha),container.toggleClass("sp-clear-enabled",allowEmpty),container.toggleClass("sp-buttons-disabled",!opts.showButtons),container.toggleClass("sp-palette-buttons-disabled",!opts.togglePaletteOnly),container.toggleClass("sp-palette-disabled",!opts.showPalette),container.toggleClass("sp-palette-only",opts.showPaletteOnly),container.toggleClass("sp-initial-disabled",!opts.showInitial),container.addClass(opts.className).addClass(opts.containerClassName),reflow()}function updateSelectionPaletteFromStorage(){if(localStorageKey&&window.localStorage){try{var oldPalette=window.localStorage[localStorageKey].split(",#");1<oldPalette.length&&(delete window.localStorage[localStorageKey],$.each(oldPalette,function(i,c){addColorToSelectionPalette(c)}))}catch(e){}try{selectionPalette=window.localStorage[localStorageKey].split(";")}catch(e){}}}function addColorToSelectionPalette(rgb){if(showSelectionPalette){rgb=tinycolor(rgb).toRgbString();if(!paletteLookup[rgb]&&-1===$.inArray(rgb,selectionPalette))for(selectionPalette.push(rgb);selectionPalette.length>maxSelectionSize;)selectionPalette.shift();if(localStorageKey&&window.localStorage)try{window.localStorage[localStorageKey]=selectionPalette.join(";")}catch(e){}}}function drawPalette(){var currentColor=get(),html=$.map(paletteArray,function(palette,i){return paletteTemplate(palette,currentColor,"sp-palette-row sp-palette-row-"+i,opts)});updateSelectionPaletteFromStorage(),selectionPalette&&html.push(paletteTemplate(function(){var unique=[];if(opts.showPalette)for(var i=0;i<selectionPalette.length;i++){var rgb=tinycolor(selectionPalette[i]).toRgbString();paletteLookup[rgb]||unique.push(selectionPalette[i])}return unique.reverse().slice(0,opts.maxSelectionSize)}(),currentColor,"sp-palette-row sp-palette-row-selection",opts)),paletteContainer.html(html.join(""))}function drawInitial(){var initial,current;opts.showInitial&&(initial=colorOnShow,current=get(),initialColorContainer.html(paletteTemplate([initial,current],current,"sp-palette-row-initial",opts)))}function dragStart(){(dragHeight<=0||dragWidth<=0||slideHeight<=0)&&reflow(),isDragging=!0,container.addClass(draggingClass),shiftMovementDirection=null,boundElement.trigger("dragstart.spectrum",[get()])}function dragStop(){isDragging=!1,container.removeClass(draggingClass),boundElement.trigger("dragstop.spectrum",[get()])}function setFromTextInput(){var tiny=textInput.val();null!==tiny&&""!==tiny||!allowEmpty?(tiny=tinycolor(tiny)).isValid()?(set(tiny),move(),updateOriginalInput()):textInput.addClass("sp-validation-error"):(set(null),move(),updateOriginalInput())}function toggle(){(visible?hide:show)()}function show(){var event=$.Event("beforeShow.spectrum");visible?reflow():(boundElement.trigger(event,[get()]),!1===callbacks.beforeShow(get())||event.isDefaultPrevented()||(function(){for(var i=0;i<spectrums.length;i++)spectrums[i]&&spectrums[i].hide()}(),visible=!0,$(doc).on("keydown.spectrum",onkeydown),$(doc).on("click.spectrum",clickout),$(window).on("resize.spectrum",resize),replacer.addClass("sp-active"),container.removeClass("sp-hidden"),reflow(),updateUI(),colorOnShow=get(),drawInitial(),callbacks.show(colorOnShow),boundElement.trigger("show.spectrum",[colorOnShow])))}function onkeydown(e){27===e.keyCode&&hide()}function clickout(e){2!=e.button&&(isDragging||(clickoutFiresChange?updateOriginalInput(!0):revert(),hide()))}function hide(){visible&&!flat&&(visible=!1,$(doc).off("keydown.spectrum",onkeydown),$(doc).off("click.spectrum",clickout),$(window).off("resize.spectrum",resize),replacer.removeClass("sp-active"),container.addClass("sp-hidden"),callbacks.hide(get()),boundElement.trigger("hide.spectrum",[get()]))}function revert(){set(colorOnShow,!0),updateOriginalInput(!0)}function set(newHsv,ignoreFormatChange){var newColor;tinycolor.equals(newHsv,get())?updateUI():(!newHsv&&allowEmpty?isEmpty=!0:(isEmpty=!1,newHsv=(newColor=tinycolor(newHsv)).toHsv(),currentHue=newHsv.h%360/360,currentSaturation=newHsv.s,currentValue=newHsv.v,currentAlpha=newHsv.a),updateUI(),newColor&&newColor.isValid()&&!ignoreFormatChange&&(currentPreferredFormat=opts.preferredFormat||newColor.getFormat()))}function get(opts){return opts=opts||{},allowEmpty&&isEmpty?null:tinycolor.fromRatio({h:currentHue,s:currentSaturation,v:currentValue,a:Math.round(1e3*currentAlpha)/1e3},{format:opts.format||currentPreferredFormat})}function move(){updateUI(),callbacks.move(get()),boundElement.trigger("move.spectrum",[get()])}function updateUI(){textInput.removeClass("sp-validation-error"),updateHelperLocations();var gradient=tinycolor.fromRatio({h:currentHue,s:1,v:1});dragger.css("background-color",gradient.toHexString());var format=currentPreferredFormat;currentAlpha<1&&(0!==currentAlpha||"name"!==format)&&("hex"!==format&&"hex3"!==format&&"hex6"!==format&&"name"!==format||(format="rgb"));var realHex,realAlpha,realColor=get({format:format}),displayColor="";previewElement.removeClass("sp-clear-display"),previewElement.css("background-color","transparent"),!realColor&&allowEmpty?previewElement.addClass("sp-clear-display"):(realHex=realColor.toHexString(),realAlpha=realColor.toRgbString(),rgbaSupport||1===realColor.alpha?previewElement.css("background-color",realAlpha):(previewElement.css("background-color","transparent"),previewElement.css("filter",realColor.toFilter())),opts.showAlpha&&((gradient=realColor.toRgb()).a=0,gradient="linear-gradient(left, "+(realAlpha=tinycolor(gradient).toRgbString())+", "+realHex+")",IE?alphaSliderInner.css("filter",tinycolor(realAlpha).toFilter({gradientType:1},realHex)):(alphaSliderInner.css("background","-webkit-"+gradient),alphaSliderInner.css("background","-moz-"+gradient),alphaSliderInner.css("background","-ms-"+gradient),alphaSliderInner.css("background","linear-gradient(to right, "+realAlpha+", "+realHex+")"))),displayColor=realColor.toString(format)),opts.showInput&&textInput.val(displayColor),opts.showPalette&&drawPalette(),drawInitial()}function updateHelperLocations(){var slideY=currentSaturation,dragY=currentValue;allowEmpty&&isEmpty?(alphaSlideHelper.hide(),slideHelper.hide(),dragHelper.hide()):(alphaSlideHelper.show(),slideHelper.show(),dragHelper.show(),slideY=slideY*dragWidth,dragY=dragHeight-dragY*dragHeight,slideY=Math.max(-dragHelperHeight,Math.min(dragWidth-dragHelperHeight,slideY-dragHelperHeight)),dragY=Math.max(-dragHelperHeight,Math.min(dragHeight-dragHelperHeight,dragY-dragHelperHeight)),dragHelper.css({top:dragY+"px",left:slideY+"px"}),slideY=currentAlpha*alphaWidth,alphaSlideHelper.css({left:slideY-alphaSlideHelperWidth/2+"px"}),slideY=currentHue*slideHeight,slideHelper.css({top:slideY-slideHelperHeight+"px"}))}function updateOriginalInput(fireCallback){var color=get(),displayColor="",hasChanged=!tinycolor.equals(color,colorOnShow);color&&(displayColor=color.toString(currentPreferredFormat),addColorToSelectionPalette(color)),isInput&&boundElement.val(displayColor),fireCallback&&hasChanged&&(callbacks.change(color),boundElement.trigger("change",[color]))}function reflow(){var viewHeight,offsetTop,dpWidth,dpHeight,inputHeight,offsetLeft,offset,viewWidth;visible&&(dragWidth=dragger.width(),dragHeight=dragger.height(),dragHelperHeight=dragHelper.height(),slider.width(),slideHeight=slider.height(),slideHelperHeight=slideHelper.height(),alphaWidth=alphaSlider.width(),alphaSlideHelperWidth=alphaSlideHelper.width(),flat||(container.css("position","absolute"),opts.offset?container.offset(opts.offset):container.offset((offsetTop=offsetElement,dpWidth=(viewHeight=container).outerWidth(),dpHeight=viewHeight.outerHeight(),inputHeight=offsetTop.outerHeight(),offsetLeft=viewHeight[0].ownerDocument,offset=offsetLeft.documentElement,viewWidth=offset.clientWidth+$(offsetLeft).scrollLeft(),viewHeight=offset.clientHeight+$(offsetLeft).scrollTop(),offset=offsetTop.offset(),offsetLeft=offset.left,offsetTop=offset.top,offsetTop+=inputHeight,offsetLeft-=Math.min(offsetLeft,viewWidth<offsetLeft+dpWidth&&dpWidth<viewWidth?Math.abs(offsetLeft+dpWidth-viewWidth):0),{top:offsetTop-=Math.min(offsetTop,viewHeight<offsetTop+dpHeight&&dpHeight<viewHeight?Math.abs(+(dpHeight+inputHeight)):0),bottom:offset.bottom,left:offsetLeft,right:offset.right,width:offset.width,height:offset.height}))),updateHelperLocations(),opts.showPalette&&drawPalette(),boundElement.trigger("reflow.spectrum"))}function disable(){hide(),disabled=!0,boundElement.attr("disabled",!0),offsetElement.addClass("sp-disabled")}!function(){function paletteElementClick(e){return e.data&&e.data.ignore?(set($(e.target).closest(".sp-thumb-el").data("color")),move()):(set($(e.target).closest(".sp-thumb-el").data("color")),move(),opts.hideAfterPaletteSelect?(updateOriginalInput(!0),hide()):updateOriginalInput()),!1}IE&&container.find("*:not(input)").attr("unselectable","on"),applyOptions(),shouldReplace&&boundElement.after(replacer).hide(),allowEmpty||clearButton.hide(),flat?boundElement.after(container).hide():(paletteEvent=1!==(paletteEvent="parent"===opts.appendTo?boundElement.parent():$(opts.appendTo)).length?$("body"):paletteEvent).append(container),updateSelectionPaletteFromStorage(),offsetElement.on("click.spectrum touchstart.spectrum",function(e){disabled||toggle(),e.stopPropagation(),$(e.target).is("input")||e.preventDefault()}),!boundElement.is(":disabled")&&!0!==opts.disabled||disable(),container.click(stopPropagation),textInput.change(setFromTextInput),textInput.on("paste",function(){setTimeout(setFromTextInput,1)}),textInput.keydown(function(e){13==e.keyCode&&setFromTextInput()}),cancelButton.text(opts.cancelText),cancelButton.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),revert(),hide()}),clearButton.attr("title",opts.clearText),clearButton.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),isEmpty=!0,move(),flat&&updateOriginalInput(!0)}),chooseButton.text(opts.chooseText),chooseButton.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),IE&&textInput.is(":focus")&&textInput.trigger("change"),textInput.hasClass("sp-validation-error")||(updateOriginalInput(!0),hide())}),toggleButton.text(opts.showPaletteOnly?opts.togglePaletteMoreText:opts.togglePaletteLessText),toggleButton.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),opts.showPaletteOnly=!opts.showPaletteOnly,opts.showPaletteOnly||flat||container.css("left","-="+(pickerContainer.outerWidth(!0)+5)),applyOptions()}),draggable(alphaSlider,function(dragX,dragY,e){currentAlpha=dragX/alphaWidth,isEmpty=!1,e.shiftKey&&(currentAlpha=Math.round(10*currentAlpha)/10),move()},dragStart,dragStop),draggable(slider,function(dragX,dragY){currentHue=parseFloat(dragY/slideHeight),isEmpty=!1,opts.showAlpha||(currentAlpha=1),move()},dragStart,dragStop),draggable(dragger,function(dragX,dragY,oldDragX){oldDragX.shiftKey?shiftMovementDirection||(oldDragX=currentSaturation*dragWidth,setValue=dragHeight-currentValue*dragHeight,setValue=Math.abs(dragX-oldDragX)>Math.abs(dragY-setValue),shiftMovementDirection=setValue?"x":"y"):shiftMovementDirection=null;var setValue=!shiftMovementDirection||"y"===shiftMovementDirection;shiftMovementDirection&&"x"!==shiftMovementDirection||(currentSaturation=parseFloat(dragX/dragWidth)),setValue&&(currentValue=parseFloat((dragHeight-dragY)/dragHeight)),isEmpty=!1,opts.showAlpha||(currentAlpha=1),move()},dragStart,dragStop),initialColor?(set(initialColor),updateUI(),currentPreferredFormat=opts.preferredFormat||tinycolor(initialColor).format,addColorToSelectionPalette(initialColor)):updateUI(),flat&&show();var paletteEvent=IE?"mousedown.spectrum":"click.spectrum touchstart.spectrum";paletteContainer.on(paletteEvent,".sp-thumb-el",paletteElementClick),initialColorContainer.on(paletteEvent,".sp-thumb-el:nth-child(1)",{ignore:!0},paletteElementClick)}();var spect={show:show,hide:hide,toggle:toggle,reflow:reflow,option:function(optionName,optionValue){return optionName===undefined?$.extend({},opts):optionValue===undefined?opts[optionName]:(opts[optionName]=optionValue,"preferredFormat"===optionName&&(currentPreferredFormat=opts.preferredFormat),void applyOptions())},enable:function(){disabled=!1,boundElement.attr("disabled",!1),offsetElement.removeClass("sp-disabled")},disable:disable,offset:function(coord){opts.offset=coord,reflow()},set:function(c){set(c),updateOriginalInput()},get:get,destroy:function(){boundElement.show(),offsetElement.off("click.spectrum touchstart.spectrum"),container.remove(),replacer.remove(),spectrums[spect.id]=null},container:container};return spect.id=spectrums.push(spect)-1,spect}function noop(){}function stopPropagation(e){e.stopPropagation()}function bind(func,obj){var slice=Array.prototype.slice,args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)))}}function draggable(element,onmove,onstart,onstop){onmove=onmove||function(){},onstart=onstart||function(){},onstop=onstop||function(){};var doc=document,dragging=!1,offset={},maxHeight=0,maxWidth=0,hasTouch="ontouchstart"in window,duringDragEvents={};function prevent(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function move(e){if(dragging){if(IE&&doc.documentMode<9&&!e.button)return stop();var dragY=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],dragX=dragY&&dragY.pageX||e.pageX,dragY=dragY&&dragY.pageY||e.pageY,dragX=Math.max(0,Math.min(dragX-offset.left,maxWidth)),dragY=Math.max(0,Math.min(dragY-offset.top,maxHeight));hasTouch&&prevent(e),onmove.apply(element,[dragX,dragY,e])}}function stop(){dragging&&($(doc).off(duringDragEvents),$(doc.body).removeClass("sp-dragging"),setTimeout(function(){onstop.apply(element,arguments)},0)),dragging=!1}duringDragEvents.selectstart=prevent,duringDragEvents.dragstart=prevent,duringDragEvents["touchmove mousemove"]=move,duringDragEvents["touchend mouseup"]=stop,$(element).on("touchstart mousedown",function(e){(e.which?3==e.which:2==e.button)||dragging||!1!==onstart.apply(element,arguments)&&(dragging=!0,maxHeight=$(element).height(),maxWidth=$(element).width(),offset=$(element).offset(),$(doc).on(duringDragEvents),$(doc.body).addClass("sp-dragging"),move(e),prevent(e))})}function inputTypeColorSupport(){return $.fn.spectrum.inputTypeColorSupport()}$.fn.spectrum=function(opts,extra){if("string"!=typeof opts)return this.spectrum("destroy").each(function(){var spect=spectrum(this,$.extend({},$(this).data(),opts));$(this).data("spectrum.id",spect.id)});var returnValue=this,args=Array.prototype.slice.call(arguments,1);return this.each(function(){var spect=spectrums[$(this).data("spectrum.id")];if(spect){var method=spect[opts];if(!method)throw new Error("Spectrum: no such method: '"+opts+"'");"get"==opts?returnValue=spect.get():"container"==opts?returnValue=spect.container:"option"==opts?returnValue=spect.option.apply(spect,args):"destroy"==opts?(spect.destroy(),$(this).removeData("spectrum.id")):method.apply(spect,args)}}),returnValue},$.fn.spectrum.load=!0,$.fn.spectrum.loadOpts={},$.fn.spectrum.draggable=draggable,$.fn.spectrum.defaults=defaultOpts,$.fn.spectrum.inputTypeColorSupport=function inputTypeColorSupport(){var colorInput;return void 0===inputTypeColorSupport._cachedResult&&(colorInput=$("<input type='color'/>")[0],inputTypeColorSupport._cachedResult="color"===colorInput.type&&""!==colorInput.value),inputTypeColorSupport._cachedResult},$.spectrum={},$.spectrum.localization={},$.spectrum.palettes={},$.fn.spectrum.processNativeColorInputs=function(){var colorInputs=$("input[type=color]");colorInputs.length&&!inputTypeColorSupport()&&colorInputs.spectrum({preferredFormat:"hex6"})},function(){function tinycolor(color,opts){if(opts=opts||{},(color=color||"")instanceof tinycolor)return color;if(!(this instanceof tinycolor))return new tinycolor(color,opts);var rgb=function(color){var rgb={r:0,g:0,b:0},a=1,ok=!1,format=!1;"string"==typeof color&&(color=function(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var match,named=!1;if(names[color])color=names[color],named=!0;else if("transparent"==color)return{r:0,g:0,b:0,a:0,format:"name"};if(match=matchers.rgb.exec(color))return{r:match[1],g:match[2],b:match[3]};if(match=matchers.rgba.exec(color))return{r:match[1],g:match[2],b:match[3],a:match[4]};if(match=matchers.hsl.exec(color))return{h:match[1],s:match[2],l:match[3]};if(match=matchers.hsla.exec(color))return{h:match[1],s:match[2],l:match[3],a:match[4]};if(match=matchers.hsv.exec(color))return{h:match[1],s:match[2],v:match[3]};if(match=matchers.hsva.exec(color))return{h:match[1],s:match[2],v:match[3],a:match[4]};if(match=matchers.hex8.exec(color))return{a:function(h){return parseIntFromHex(h)/255}(match[1]),r:parseIntFromHex(match[2]),g:parseIntFromHex(match[3]),b:parseIntFromHex(match[4]),format:named?"name":"hex8"};if(match=matchers.hex6.exec(color))return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"};if(match=matchers.hex3.exec(color))return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"};return!1}(color));"object"==typeof color&&(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")?(rgb=function(r,g,b){return{r:255*bound01(r,255),g:255*bound01(g,255),b:255*bound01(b,255)}}(color.r,color.g,color.b),ok=!0,format="%"===String(color.r).substr(-1)?"prgb":"rgb"):color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")?(color.s=convertToPercentage(color.s),color.v=convertToPercentage(color.v),rgb=function(q,t,v){q=6*bound01(q,360),t=bound01(t,100),v=bound01(v,100);var mod=math.floor(q),f=q-mod,p=v*(1-t),q=v*(1-f*t),t=v*(1-(1-f)*t),mod=mod%6;return{r:255*[v,q,p,p,t,v][mod],g:255*[t,v,v,q,p,p][mod],b:255*[p,p,t,v,v,q][mod]}}(color.h,color.s,color.v),ok=!0,format="hsv"):color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")&&(color.s=convertToPercentage(color.s),color.l=convertToPercentage(color.l),rgb=function(h,p,q){var r,g,b;function hue2rgb(p,q,t){return t<0&&(t+=1),1<t&&--t,t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}h=bound01(h,360),p=bound01(p,100),q=bound01(q,100),0===p?r=g=b=q:(r=hue2rgb(p=2*q-(q=q<.5?q*(1+p):q+p-q*p),q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3));return{r:255*r,g:255*g,b:255*b}}(color.h,color.s,color.l),ok=!0,format="hsl"),color.hasOwnProperty("a")&&(a=color.a));return a=boundAlpha(a),{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}(color);this._originalInput=color,this._r=rgb.r,this._g=rgb.g,this._b=rgb.b,this._a=rgb.a,this._roundA=mathRound(1e3*this._a)/1e3,this._format=opts.format||rgb.format,this._gradientType=opts.gradientType,this._r<1&&(this._r=mathRound(this._r)),this._g<1&&(this._g=mathRound(this._g)),this._b<1&&(this._b=mathRound(this._b)),this._ok=rgb.ok,this._tc_id=tinyCounter++}var trimLeft=/^[\s,#]+/,trimRight=/\s+$/,tinyCounter=0,math=Math,mathRound=math.round,mathMin=math.min,mathMax=math.max,mathRandom=math.random;function rgbToHsl(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,max=mathMax(r,g,b),min=mathMin(r,g,b),l=(max+min)/2;if(max==min)h=s=0;else{var d=max-min,s=.5<l?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}}function rgbToHsv(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,max=mathMax(r,g,b),min=mathMin(r,g,b),v=max,d=max-min,s=0===max?0:d/max;if(max==min)h=0;else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,v:v}}function rgbToHex(r,g,hex,allow3Char){hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(hex).toString(16))];return allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)?hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0):hex.join("")}function rgbaToHex(r,g,b,a){return[pad2(Math.round(255*parseFloat(a)).toString(16)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))].join("")}function desaturate(hsl,amount){amount=0===amount?0:amount||10;hsl=tinycolor(hsl).toHsl();return hsl.s-=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function saturate(hsl,amount){amount=0===amount?0:amount||10;hsl=tinycolor(hsl).toHsl();return hsl.s+=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function greyscale(color){return tinycolor(color).desaturate(100)}function lighten(hsl,amount){amount=0===amount?0:amount||10;hsl=tinycolor(hsl).toHsl();return hsl.l+=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function brighten(rgb,amount){amount=0===amount?0:amount||10;rgb=tinycolor(rgb).toRgb();return rgb.r=mathMax(0,mathMin(255,rgb.r-mathRound(-amount/100*255))),rgb.g=mathMax(0,mathMin(255,rgb.g-mathRound(-amount/100*255))),rgb.b=mathMax(0,mathMin(255,rgb.b-mathRound(-amount/100*255))),tinycolor(rgb)}function darken(hsl,amount){amount=0===amount?0:amount||10;hsl=tinycolor(hsl).toHsl();return hsl.l-=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function spin(hsl,hue){hsl=tinycolor(hsl).toHsl(),hue=(mathRound(hsl.h)+hue)%360;return hsl.h=hue<0?360+hue:hue,tinycolor(hsl)}function complement(hsl){hsl=tinycolor(hsl).toHsl();return hsl.h=(hsl.h+180)%360,tinycolor(hsl)}function triad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]}function tetrad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]}function splitcomplement(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]}function analogous(color,results,slices){results=results||6,slices=slices||30;var hsl=tinycolor(color).toHsl(),part=360/slices,ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;)hsl.h=(hsl.h+part)%360,ret.push(tinycolor(hsl));return ret}function monochromatic(hsv,results){results=results||6;for(var hsv=tinycolor(hsv).toHsv(),h=hsv.h,s=hsv.s,v=hsv.v,ret=[],modification=1/results;results--;)ret.push(tinycolor({h:h,s:s,v:v})),v=(v+modification)%1;return ret}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var rgb=this.toRgb();return(299*rgb.r+587*rgb.g+114*rgb.b)/1e3},setAlpha:function(value){return this._a=boundAlpha(value),this._roundA=mathRound(1e3*this._a)/1e3,this},toHsv:function(){var hsv=rgbToHsv(this._r,this._g,this._b);return{h:360*hsv.h,s:hsv.s,v:hsv.v,a:this._a}},toHsvString:function(){var v=rgbToHsv(this._r,this._g,this._b),h=mathRound(360*v.h),s=mathRound(100*v.s),v=mathRound(100*v.v);return 1==this._a?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+this._roundA+")"},toHsl:function(){var hsl=rgbToHsl(this._r,this._g,this._b);return{h:360*hsl.h,s:hsl.s,l:hsl.l,a:this._a}},toHslString:function(){var l=rgbToHsl(this._r,this._g,this._b),h=mathRound(360*l.h),s=mathRound(100*l.s),l=mathRound(100*l.l);return 1==this._a?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+this._roundA+")"},toHex:function(allow3Char){return rgbToHex(this._r,this._g,this._b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(){return rgbaToHex(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:mathRound(this._r),g:mathRound(this._g),b:mathRound(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+")":"rgba("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound(100*bound01(this._r,255))+"%",g:mathRound(100*bound01(this._g,255))+"%",b:mathRound(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%)":"rgba("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function(secondColor){var hex8String="#"+rgbaToHex(this._r,this._g,this._b,this._a),secondHex8String=hex8String;return"progid:DXImageTransform.Microsoft.gradient("+(this._gradientType?"GradientType = 1, ":"")+"startColorstr="+hex8String+",endColorstr="+(secondHex8String=secondColor?tinycolor(secondColor).toHex8String():secondHex8String)+")"},toString:function(format){var formatSet=!!format;format=format||this._format;var formattedString=!1,hasAlpha=this._a<1&&0<=this._a;return formatSet||!hasAlpha||"hex"!==format&&"hex6"!==format&&"hex3"!==format&&"name"!==format?("rgb"===format&&(formattedString=this.toRgbString()),"prgb"===format&&(formattedString=this.toPercentageRgbString()),"hex"!==format&&"hex6"!==format||(formattedString=this.toHexString()),"hex3"===format&&(formattedString=this.toHexString(!0)),"hex8"===format&&(formattedString=this.toHex8String()),"name"===format&&(formattedString=this.toName()),"hsl"===format&&(formattedString=this.toHslString()),(formattedString="hsv"===format?this.toHsvString():formattedString)||this.toHexString()):"name"===format&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(fn,color){color=fn.apply(null,[this].concat([].slice.call(color)));return this._r=color._r,this._g=color._g,this._b=color._b,this.setAlpha(color._a),this},lighten:function(){return this._applyModification(lighten,arguments)},brighten:function(){return this._applyModification(brighten,arguments)},darken:function(){return this._applyModification(darken,arguments)},desaturate:function(){return this._applyModification(desaturate,arguments)},saturate:function(){return this._applyModification(saturate,arguments)},greyscale:function(){return this._applyModification(greyscale,arguments)},spin:function(){return this._applyModification(spin,arguments)},_applyCombination:function(fn,args){return fn.apply(null,[this].concat([].slice.call(args)))},analogous:function(){return this._applyCombination(analogous,arguments)},complement:function(){return this._applyCombination(complement,arguments)},monochromatic:function(){return this._applyCombination(monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement,arguments)},triad:function(){return this._applyCombination(triad,arguments)},tetrad:function(){return this._applyCombination(tetrad,arguments)}},tinycolor.fromRatio=function(color,opts){if("object"==typeof color){var i,newColor={};for(i in color)color.hasOwnProperty(i)&&(newColor[i]="a"===i?color[i]:convertToPercentage(color[i]));color=newColor}return tinycolor(color,opts)},tinycolor.equals=function(color1,color2){return!(!color1||!color2)&&tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})},tinycolor.mix=function(rgba,w1,w2){w2=0===w2?0:w2||50;var rgb1=tinycolor(rgba).toRgb(),rgb2=tinycolor(w1).toRgb(),rgba=w2/100,w1=2*rgba-1,w2=rgb2.a-rgb1.a,w1=w1*w2==-1?w1:(w1+w2)/(1+w1*w2),w2=1-(w1=(w1+1)/2),rgba={r:rgb2.r*w1+rgb1.r*w2,g:rgb2.g*w1+rgb1.g*w2,b:rgb2.b*w1+rgb1.b*w2,a:rgb2.a*rgba+rgb1.a*(1-rgba)};return tinycolor(rgba)},tinycolor.readability=function(rgb1,colorDiff){var brightnessA=tinycolor(rgb1),brightnessB=tinycolor(colorDiff),rgb1=brightnessA.toRgb(),colorDiff=brightnessB.toRgb(),brightnessA=brightnessA.getBrightness(),brightnessB=brightnessB.getBrightness(),colorDiff=Math.max(rgb1.r,colorDiff.r)-Math.min(rgb1.r,colorDiff.r)+Math.max(rgb1.g,colorDiff.g)-Math.min(rgb1.g,colorDiff.g)+Math.max(rgb1.b,colorDiff.b)-Math.min(rgb1.b,colorDiff.b);return{brightness:Math.abs(brightnessA-brightnessB),color:colorDiff}},tinycolor.isReadable=function(color1,readability){readability=tinycolor.readability(color1,readability);return 125<readability.brightness&&500<readability.color},tinycolor.mostReadable=function(baseColor,colorList){for(var bestColor=null,bestScore=0,bestIsReadable=!1,i=0;i<colorList.length;i++){var score=tinycolor.readability(baseColor,colorList[i]),readable=125<score.brightness&&500<score.color,score=score.brightness/125*3+score.color/500;(readable&&!bestIsReadable||readable&&bestIsReadable&&bestScore<score||!readable&&!bestIsReadable&&bestScore<score)&&(bestIsReadable=readable,bestScore=score,bestColor=tinycolor(colorList[i]))}return bestColor};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=function(o){var i,flipped={};for(i in o)o.hasOwnProperty(i)&&(flipped[o[i]]=i);return flipped}(names);function boundAlpha(a){return a=parseFloat(a),a=isNaN(a)||a<0||1<a?1:a}function bound01(n,max){var processPercent=function(n){return"string"==typeof n&&-1!=n.indexOf("%")}(n=function(n){return"string"==typeof n&&-1!=n.indexOf(".")&&1===parseFloat(n)}(n)?"100%":n);return n=mathMin(max,mathMax(0,parseFloat(n))),processPercent&&(n=parseInt(n*max,10)/100),math.abs(n-max)<1e-6?1:n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function pad2(c){return 1==c.length?"0"+c:""+c}function convertToPercentage(n){return n=n<=1?100*n+"%":n}var PERMISSIVE_MATCH4,PERMISSIVE_MATCH3,matchers=(PERMISSIVE_MATCH3="[\\s|\\(]+("+(PERMISSIVE_MATCH4="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+PERMISSIVE_MATCH4+")[,|\\s]+("+PERMISSIVE_MATCH4+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+PERMISSIVE_MATCH4+")[,|\\s]+("+PERMISSIVE_MATCH4+")[,|\\s]+("+PERMISSIVE_MATCH4+")[,|\\s]+("+PERMISSIVE_MATCH4+")\\s*\\)?",{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});window.tinycolor=tinycolor}(),$(function(){$.fn.spectrum.load&&$.fn.spectrum.processNativeColorInputs()})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.i18next=e()}(this,function(){"use strict";function t(t){return null==t?"":""+t}function n(t,e,n){function o(t){return t&&-1<t.indexOf("###")?t.replace(/###/g,"."):t}for(var r="string"!=typeof e?[].concat(e):e.split(".");1<r.length;){if(!t)return{};var i=o(r.shift());!t[i]&&n&&(t[i]=new n),t=t[i]}return t?{obj:t,k:o(r.shift())}:{}}function o(t,r,o){r=n(t,r,Object);r.obj[r.k]=o}function r(s,a,o,r){s=n(s,a,Object),a=s.obj,s=s.k;a[s]=a[s]||[],r&&(a[s]=a[s].concat(o)),r||a[s].push(o)}function i(i,r){i=n(i,r),r=i.obj,i=i.k;if(r)return r[i]}function s(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function u(t){return"string"==typeof t?t.replace(/[&<>"'\/]/g,function(t){return R[t]}):t}function l(t){return t.interpolation={unescapeSuffix:"HTML"},t.interpolation.prefix=t.interpolationPrefix||"__",t.interpolation.suffix=t.interpolationSuffix||"__",t.interpolation.escapeValue=t.escapeInterpolation||!1,t.interpolation.nestingPrefix=t.reusePrefix||"$t(",t.interpolation.nestingSuffix=t.reuseSuffix||")",t}function f(t){return(t=t.interpolationPrefix||t.interpolationSuffix||t.escapeInterpolation?l(t):t).nsSeparator=t.nsseparator,t.keySeparator=t.keyseparator,t.returnObjects=t.returnObjectTrees,t}function h(t){return t.charAt(0).toUpperCase()+t.slice(1)}function y(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,saveMissingTo:"fallback",missingKeyHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,overloadTranslationOptionHandler:function(t){return{defaultValue:t[1]}},interpolation:{escapeValue:!0,format:function(t,e,n){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",defaultVariables:void 0}}}function b(t){return"string"==typeof t.ns&&(t.ns=[t.ns]),"string"==typeof t.fallbackLng&&(t.fallbackLng=[t.fallbackLng]),"string"==typeof t.fallbackNS&&(t.fallbackNS=[t.fallbackNS]),t.whitelist&&t.whitelist.indexOf("cimode")<0&&t.whitelist.push("cimode"),t}function m(){}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function O(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o,n=arguments[e];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},N=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(r)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},L={type:"logger",log:function(t){this._output("log",t)},warn:function(t){this._output("warn",t)},error:function(t){this._output("error",t)},_output:function(t,e){console&&console[t]&&console[t].apply(console,Array.prototype.slice.call(e))}},C=new(function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};k(this,t),this.init(e,n)}return t.prototype.init=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.prefix=e.prefix||"i18next:",this.logger=t||L,this.options=e,this.debug=!1!==e.debug},t.prototype.setDebug=function(t){this.debug=t},t.prototype.log=function(){this.forward(arguments,"log","",!0)},t.prototype.warn=function(){this.forward(arguments,"warn","",!0)},t.prototype.error=function(){this.forward(arguments,"error","")},t.prototype.deprecate=function(){this.forward(arguments,"warn","WARNING DEPRECATED: ",!0)},t.prototype.forward=function(t,e,n,o){o&&!this.debug||("string"==typeof t[0]&&(t[0]=n+this.prefix+" "+t[0]),this.logger[e](t))},t.prototype.create=function(e){return new t(this.logger,S({prefix:this.prefix+":"+e+":"},this.options))},t}()),P=function(){function t(){k(this,t),this.observers={}}return t.prototype.on=function(t,e){var n=this;t.split(" ").forEach(function(t){n.observers[t]=n.observers[t]||[],n.observers[t].push(e)})},t.prototype.off=function(t,e){var n=this;this.observers[t]&&this.observers[t].forEach(function(){var o;e?-1<(o=n.observers[t].indexOf(e))&&n.observers[t].splice(o,1):delete n.observers[t]})},t.prototype.emit=function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.observers[t]&&this.observers[t].forEach(function(t){t.apply(void 0,n)}),this.observers["*"]&&this.observers["*"].forEach(function(o){o.apply(o,(o=[t]).concat.apply(o,n))})},t}(),R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},E=function(t){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};k(this,e);var r=O(this,t.call(this));return r.data=n,r.options=o,r}return w(e,t),e.prototype.addNamespaces=function(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)},e.prototype.removeNamespaces=function(e){e=this.options.ns.indexOf(e);-1<e&&this.options.ns.splice(e,1)},e.prototype.getResource=function(t,a,n){var r=(3<arguments.length&&void 0!==arguments[3]?arguments[3]:{}).keySeparator||this.options.keySeparator;void 0===r&&(r=".");a=[t,a];return n&&"string"!=typeof n&&(a=a.concat(n)),n&&"string"==typeof n&&(a=a.concat(r?n.split(r):n)),-1<t.indexOf(".")&&(a=t.split(".")),i(this.data,a)},e.prototype.addResource=function(t,e,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{silent:!1},a=this.options.keySeparator;void 0===a&&(a=".");var s=[t,e];n&&(s=s.concat(a?n.split(a):n)),-1<t.indexOf(".")&&(r=e,e=(s=t.split("."))[1]),this.addNamespaces(e),o(this.data,s,r),i.silent||this.emit("added",t,e,n,r)},e.prototype.addResources=function(t,e,n){for(var o in n)"string"==typeof n[o]&&this.addResource(t,e,o,n[o],{silent:!0});this.emit("added",t,e,n)},e.prototype.addResourceBundle=function(t,e,n,r,s){var u=[t,e];-1<t.indexOf(".")&&(r=n,n=e,e=(u=t.split("."))[1]),this.addNamespaces(e);var l=i(this.data,u)||{};r?function a(t,e,n){for(var o in e)o in t?"string"==typeof t[o]||t[o]instanceof String||"string"==typeof e[o]||e[o]instanceof String?n&&(t[o]=e[o]):a(t[o],e[o],n):t[o]=e[o];return t}(l,n,s):l=S({},l,n),o(this.data,u,l),this.emit("added",t,e,n)},e.prototype.removeResourceBundle=function(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)},e.prototype.hasResourceBundle=function(t,e){return void 0!==this.getResource(t,e)},e.prototype.getResourceBundle=function(t,e){return e=e||this.options.defaultNS,"v1"===this.options.compatibilityAPI?S({},this.getResource(t,e)):this.getResource(t,e)},e.prototype.toJSON=function(){return this.data},e}(P),_={processors:{},addPostProcessor:function(t){this.processors[t.name]=t},handle:function(t,e,n,o,r){var i=this;return t.forEach(function(t){i.processors[t]&&(e=i.processors[t].process(e,n,o,r))}),e}},A=function(t){function n(o){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};k(this,n);var i=O(this,t.call(this));return function(t,e,n){t.forEach(function(t){e[t]&&(n[t]=e[t])})}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector"],o,i),i.options=r,i.logger=C.create("translator"),i}return w(n,t),n.prototype.changeLanguage=function(t){t&&(this.language=t)},n.prototype.exists=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};return"v1"===this.options.compatibilityAPI&&(e=f(e)),void 0!==this.resolve(t,e)},n.prototype.extractFromKey=function(t,o){var r=o.nsSeparator||this.options.nsSeparator,o=o.ns||this.options.defaultNS;return(r=void 0===r?":":r)&&-1<t.indexOf(r)&&(o=(r=t.split(r))[0],t=r[1]),{key:t,namespaces:o="string"==typeof o?[o]:o}},n.prototype.translate=function(v){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("object"!==(void 0===e?"undefined":x(e))?e=this.options.overloadTranslationOptionHandler(arguments):"v1"===this.options.compatibilityAPI&&(e=f(e)),null==v||""===v)return"";"string"==typeof(v="number"==typeof v?String(v):v)&&(v=[v]);var n=e.lng||this.language;if(n&&"cimode"===n.toLowerCase())return v[v.length-1];var o=e.keySeparator||this.options.keySeparator||".",d=this.extractFromKey(v[v.length-1],e),i=d.key,a=d.namespaces,s=a[a.length-1],u=this.resolve(v,e),d=Object.prototype.toString.apply(u),v=(void 0!==e.joinArrays?e:this.options).joinArrays;if(u&&"string"!=typeof u&&["[object Number]","[object Function]","[object RegExp]"].indexOf(d)<0&&(!v||"[object Array]"!==d)){if(!e.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(i,u,e):"key '"+i+" ("+this.language+")' returned an object instead of string.";var h,g="[object Array]"===d?[]:{};for(h in u)g[h]=this.translate(""+i+o+h,S({joinArrays:!1,ns:a},e));u=g}else if(v&&"[object Array]"===d)u=(u=u.join(v))&&this.extendTranslation(u,i,e);else{d=!1,v=!1;if(this.isValidLookup(u)||void 0===e.defaultValue||(d=!0,u=e.defaultValue),this.isValidLookup(u)||(v=!0,u=i),v||d){this.logger.log("missingKey",n,s,i,u);var y=[],b=this.languageUtils.getFallbackCodes(this.options.fallbackLng,e.lng||this.language);if("fallback"===this.options.saveMissingTo&&b&&b[0])for(var m=0;m<b.length;m++)y.push(b[m]);else"all"===this.options.saveMissingTo?y=this.languageUtils.toResolveHierarchy(e.lng||this.language):y.push(e.lng||this.language);this.options.saveMissing&&(this.options.missingKeyHandler?this.options.missingKeyHandler(y,s,i,u):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(y,s,i,u)),this.emit("missingKey",y,s,i,u)}u=this.extendTranslation(u,i,e),v&&u===i&&this.options.appendNamespaceToMissingKey&&(u=s+":"+i),v&&this.options.parseMissingKeyHandler&&(u=this.options.parseMissingKeyHandler(u))}return u},n.prototype.extendTranslation=function(t,e,n){var o=this;n.interpolation&&this.interpolator.init(S({},n,{interpolation:S({},this.options.interpolation,n.interpolation)}));var a=n.replace&&"string"!=typeof n.replace?n.replace:n;this.options.interpolation.defaultVariables&&(a=S({},this.options.interpolation.defaultVariables,a)),t=this.interpolator.interpolate(t,a,this.language),t=this.interpolator.nest(t,function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return o.translate.apply(o,e)},n),n.interpolation&&this.interpolator.reset();a=n.postProcess||this.options.postProcess,a="string"==typeof a?[a]:a;return t=void 0!==t&&a&&a.length&&!1!==n.applyPostProcessor?_.handle(a,t,e,n,this):t},n.prototype.resolve=function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=void 0;return(t="string"==typeof t?[t]:t).forEach(function(a){var i,s,u,l;e.isValidLookup(o)||(a=e.extractFromKey(a,n),i=a.key,a=a.namespaces,e.options.fallbackNS&&(a=a.concat(e.options.fallbackNS)),s=void 0!==n.count&&"string"!=typeof n.count,u=void 0!==n.context&&"string"==typeof n.context&&""!==n.context,l=n.lngs||e.languageUtils.toResolveHierarchy(n.lng||e.language),a.forEach(function(t){e.isValidLookup(o)||l.forEach(function(r){if(!e.isValidLookup(o)){var a=i,l=[a],c=void 0;s&&(c=e.pluralResolver.getSuffix(r,n.count)),s&&u&&l.push(a+c),u&&l.push(a+=""+e.options.contextSeparator+n.context),s&&l.push(a+=c);for(var p;p=l.pop();)e.isValidLookup(o)||(o=e.getResource(r,t,p,n))}})}))}),o},n.prototype.isValidLookup=function(t){return!(void 0===t||!this.options.returnNull&&null===t||!this.options.returnEmptyString&&""===t)},n.prototype.getResource=function(t,e,n){return this.resourceStore.getResource(t,e,n,3<arguments.length&&void 0!==arguments[3]?arguments[3]:{})},n}(P),M=function(){function t(e){k(this,t),this.options=e,this.whitelist=this.options.whitelist||!1,this.logger=C.create("languageUtils")}return t.prototype.getLanguagePartFromCode=function(t){if(t.indexOf("-")<0)return t;var n=t.split("-");return this.formatLanguageCode(-1<["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(t)?n[1].toLowerCase():n[0])},t.prototype.getScriptPartFromCode=function(e){if(e.indexOf("-")<0)return null;e=e.split("-");return 2===e.length?null:(e.pop(),this.formatLanguageCode(e.join("-")))},t.prototype.getLanguagePartFromCode=function(t){if(t.indexOf("-")<0)return t;var n=t.split("-");return this.formatLanguageCode(-1<["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(t)?n[1].toLowerCase():n[0])},t.prototype.formatLanguageCode=function(t){if("string"==typeof t&&-1<t.indexOf("-")){var e=["hans","hant","latn","cyrl","cans","mong","arab"],n=t.split("-");return this.options.lowerCaseLng?n=n.map(function(t){return t.toLowerCase()}):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),-1<e.indexOf(n[1].toLowerCase())&&(n[1]=h(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),-1<e.indexOf(n[1].toLowerCase())&&(n[1]=h(n[1].toLowerCase())),-1<e.indexOf(n[2].toLowerCase())&&(n[2]=h(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t},t.prototype.isWhitelisted=function(t,e){return("languageOnly"===this.options.load||this.options.nonExplicitWhitelist&&!e)&&(t=this.getLanguagePartFromCode(t)),!this.whitelist||!this.whitelist.length||-1<this.whitelist.indexOf(t)},t.prototype.getFallbackCodes=function(t,e){if(!t)return[];if("string"==typeof t&&(t=[t]),"[object Array]"===Object.prototype.toString.apply(t))return t;var n=t[e];return(n=(n=(n=n||t[this.getScriptPartFromCode(e)])||t[this.formatLanguageCode(e)])||t.default)||[]},t.prototype.toResolveHierarchy=function(t,o){function i(t){t&&(n.isWhitelisted(t,1<arguments.length&&void 0!==arguments[1]&&arguments[1])?r.push(t):n.logger.warn("rejecting non-whitelisted language code: "+t))}var n=this,o=this.getFallbackCodes(o||this.options.fallbackLng||[],t),r=[];return"string"==typeof t&&-1<t.indexOf("-")?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(t),!0),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(t),!0),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(t))):"string"==typeof t&&i(this.formatLanguageCode(t)),o.forEach(function(t){r.indexOf(t)<0&&i(n.formatLanguageCode(t))}),r},t}(),T=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","es_ar","et","eu","fi","fo","fur","fy","gl","gu","ha","he","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt","pt_br","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21}],H={1:function(t){return Number(1<t)},2:function(t){return Number(1!=t)},3:function(t){return 0},4:function(t){return Number(t%10==1&&t%100!=11?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2)},5:function(t){return Number(0===t?0:1==t?1:2==t?2:3<=t%100&&t%100<=10?3:11<=t%100?4:5)},6:function(t){return Number(1==t?0:2<=t&&t<=4?1:2)},7:function(t){return Number(1==t?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2)},8:function(t){return Number(1==t?0:2==t?1:8!=t&&11!=t?2:3)},9:function(t){return Number(2<=t)},10:function(t){return Number(1==t?0:2==t?1:t<7?2:t<11?3:4)},11:function(t){return Number(1==t||11==t?0:2==t||12==t?1:2<t&&t<20?2:3)},12:function(t){return Number(t%10!=1||t%100==11)},13:function(t){return Number(0!==t)},14:function(t){return Number(1==t?0:2==t?1:3==t?2:3)},15:function(t){return Number(t%10==1&&t%100!=11?0:2<=t%10&&(t%100<10||20<=t%100)?1:2)},16:function(t){return Number(t%10==1&&t%100!=11?0:0!==t?1:2)},17:function(t){return Number(1==t||t%10==1?0:1)},18:function(t){return Number(0==t?0:1==t?1:2)},19:function(t){return Number(1==t?0:0===t||1<t%100&&t%100<11?1:10<t%100&&t%100<20?2:3)},20:function(t){return Number(1==t?0:0===t||0<t%100&&t%100<20?1:2)},21:function(t){return Number(t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0)}},V=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};k(this,t),this.languageUtils=e,this.options=n,this.logger=C.create("pluralResolver"),this.rules=function(){var t={};return T.forEach(function(e){e.lngs.forEach(function(n){return t[n]={numbers:e.nr,plurals:H[e.fc]}})}),t}()}return t.prototype.addRule=function(t,e){this.rules[t]=e},t.prototype.getRule=function(t){return this.rules[this.languageUtils.getLanguagePartFromCode(t)]},t.prototype.needsPlural=function(e){e=this.getRule(e);return!(e&&e.numbers.length<=1)},t.prototype.getSuffix=function(r,e){var n=this,o=this.getRule(r);if(!o)return this.logger.warn("no plural rule found for: "+r),"";r=function(){if(1===o.numbers.length)return{v:""};var t=o.noAbs?o.plurals(e):o.plurals(Math.abs(e)),r=o.numbers[t];2===o.numbers.length&&1===o.numbers[0]&&(2===r?r="plural":1===r&&(r=""));function i(){return n.options.prepend&&r.toString()?n.options.prepend+r.toString():r.toString()}return"v1"===n.options.compatibilityJSON?1===r?{v:""}:"number"==typeof r?{v:"_plural_"+r.toString()}:{v:i()}:"v2"===n.options.compatibilityJSON||2===o.numbers.length&&1===o.numbers[0]||2===o.numbers.length&&1===o.numbers[0]?{v:i()}:{v:n.options.prepend&&t.toString()?n.options.prepend+t.toString():t.toString()}}();return"object"===(void 0===r?"undefined":x(r))?r.v:void 0},t}(),U=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};k(this,e),this.logger=C.create("interpolator"),this.init(t,!0)}return e.prototype.init=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};arguments[1]&&(this.options=n,this.format=n.interpolation&&n.interpolation.format||function(t){return t},this.escape=n.interpolation&&n.interpolation.escape||u),n.interpolation||(n.interpolation={escapeValue:!0});n=n.interpolation;this.escapeValue=void 0===n.escapeValue||n.escapeValue,this.prefix=n.prefix?s(n.prefix):n.prefixEscaped||"{{",this.suffix=n.suffix?s(n.suffix):n.suffixEscaped||"}}",this.formatSeparator=n.formatSeparator?s(n.formatSeparator):n.formatSeparator||",",this.unescapePrefix=n.unescapeSuffix?"":n.unescapePrefix||"-",this.unescapeSuffix=!this.unescapePrefix&&n.unescapeSuffix||"",this.nestingPrefix=n.nestingPrefix?s(n.nestingPrefix):n.nestingPrefixEscaped||s("$t("),this.nestingSuffix=n.nestingSuffix?s(n.nestingSuffix):n.nestingSuffixEscaped||s(")"),this.resetRegExp()},e.prototype.reset=function(){this.options&&this.init(this.options)},e.prototype.resetRegExp=function(){var n=this.prefix+"(.+?)"+this.suffix;this.regexp=new RegExp(n,"g");n=this.prefix+this.unescapePrefix+"(.+?)"+this.unescapeSuffix+this.suffix;this.regexpUnescape=new RegExp(n,"g");n=this.nestingPrefix+"(.+?)"+this.nestingSuffix;this.nestingRegexp=new RegExp(n,"g")},e.prototype.interpolate=function(e,n,o){function l(r){if(r.indexOf(a.formatSeparator)<0)return i(n,r);var r=(s=r.split(a.formatSeparator)).shift().trim(),s=s.join(a.formatSeparator).trim();return a.format(i(n,r),s,o)}var a=this,s=void 0,u=void 0;for(this.resetRegExp();s=this.regexpUnescape.exec(e);){var c=l(s[1].trim());e=e.replace(s[0],c),this.regexpUnescape.lastIndex=0}for(;s=this.regexp.exec(e);)(u="string"!=typeof(u=l(s[1].trim()))?t(u):u)||(this.logger.warn("missed to pass in variable "+s[1]+" for interpolating "+e),u=""),u=(this.escapeValue?this.escape(u):u).replace(/\$/g,"$$$$"),e=e.replace(s[0],u),this.regexp.lastIndex=0;return e},e.prototype.nest=function(e,n){function r(t){if(t.indexOf(",")<0)return t;var e=t.split(",");t=e.shift();var n=e.join(",");n=(n=this.interpolate(n,l)).replace(/'/g,'"');try{l=JSON.parse(n)}catch(e){this.logger.error("failed parsing options string in nesting for key "+t,e)}return t}var a=void 0,s=void 0,l=JSON.parse(JSON.stringify(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}));for(l.applyPostProcessor=!1;a=this.nestingRegexp.exec(e);)(s="string"!=typeof(s=n(r.call(this,a[1].trim()),l))?t(s):s)||(this.logger.warn("missed to pass in variable "+a[1]+" for interpolating "+e),s=""),s=(this.escapeValue?u(s):s).replace(/\$/g,"$$$$"),e=e.replace(a[0],s),this.regexp.lastIndex=0;return e},e}(),F=function(t){function e(n,o,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};k(this,e);var a=O(this,t.call(this));return a.backend=n,a.store=o,a.services=r,a.options=i,a.logger=C.create("backendConnector"),a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(r,i.backend,i),a}return w(e,t),e.prototype.queueLoad=function(t,e,n){var o=this,r=[],i=[],a=[],s=[];return t.forEach(function(t){var n=!0;e.forEach(function(e){var a=t+"|"+e;o.store.hasResourceBundle(t,e)?o.state[a]=2:o.state[a]<0||(1===o.state[a]?i.indexOf(a)<0&&i.push(a):(o.state[a]=1,n=!1,i.indexOf(a)<0&&i.push(a),r.indexOf(a)<0&&r.push(a),s.indexOf(e)<0&&s.push(e)))}),n||a.push(t)}),(r.length||i.length)&&this.queue.push({pending:i,loaded:{},errors:[],callback:n}),{toLoad:r,pending:i,toLoadLanguages:a,toLoadNamespaces:s}},e.prototype.loaded=function(t,e,n){var o=this,a=t.split("|"),a=N(a,2),s=a[0],u=a[1];e&&this.emit("failedLoading",s,u,e),n&&this.store.addResourceBundle(s,u,n),this.state[t]=e?-1:2,this.queue.forEach(function(n){r(n.loaded,[s],u),function(t,e){for(var n=t.indexOf(e);-1!==n;)t.splice(n,1),n=t.indexOf(e)}(n.pending,t),e&&n.errors.push(e),0!==n.pending.length||n.done||(o.emit("loaded",n.loaded),n.errors.length?n.callback(n.errors):n.callback(),n.done=!0)}),this.queue=this.queue.filter(function(t){return!t.done})},e.prototype.read=function(t,e,n,o,r,i){var a=this;return o=o||0,r=r||250,t.length?void this.backend[n](t,e,function(s,u){return s&&u&&o<5?void setTimeout(function(){a.read.call(a,t,e,n,++o,2*r,i)},r):void i(s,u)}):i(null,{})},e.prototype.load=function(t,e,n){var o=this;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();var r=S({},this.backend.options,this.options.backend);"string"==typeof t&&(t=this.services.languageUtils.toResolveHierarchy(t));var a=this.queueLoad(t,e="string"==typeof e?[e]:e,n);return a.toLoad.length?void(r.allowMultiLoading&&this.backend.readMulti?this.read(a.toLoadLanguages,a.toLoadNamespaces,"readMulti",null,null,function(t,e){t&&o.logger.warn("loading namespaces "+a.toLoadNamespaces.join(", ")+" for languages "+a.toLoadLanguages.join(", ")+" via multiloading failed",t),!t&&e&&o.logger.log("loaded namespaces "+a.toLoadNamespaces.join(", ")+" for languages "+a.toLoadLanguages.join(", ")+" via multiloading",e),a.toLoad.forEach(function(n){var u=n.split("|"),l=N(u,2),c=l[0],u=l[1],l=i(e,[c,u]);l?o.loaded(n,t,l):(o.loaded(n,c="loading namespace "+u+" for language "+c+" via multiloading failed"),o.logger.error(c))})}):a.toLoad.forEach(function(e){!function(t){var e=this,o=t.split("|"),o=N(o,2),r=o[0],i=o[1];this.read(r,i,"read",null,null,function(n,o){n&&e.logger.warn("loading namespace "+i+" for language "+r+" failed",n),!n&&o&&e.logger.log("loaded namespace "+i+" for language "+r,o),e.loaded(t,n,o)})}.call(o,e)})):void(a.pending.length||n())},e.prototype.reload=function(t,e){var n=this;this.backend||this.logger.warn("No backend was added via i18next.use. Will not load resources.");var o=S({},this.backend.options,this.options.backend);"string"==typeof t&&(t=this.services.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]),o.allowMultiLoading&&this.backend.readMulti?this.read(t,e,"readMulti",null,null,function(o,r){o&&n.logger.warn("reloading namespaces "+e.join(", ")+" for languages "+t.join(", ")+" via multiloading failed",o),!o&&r&&n.logger.log("reloaded namespaces "+e.join(", ")+" for languages "+t.join(", ")+" via multiloading",r),t.forEach(function(t){e.forEach(function(s){var a=i(r,[t,s]);a?n.loaded(t+"|"+s,o,a):(n.loaded(t+"|"+s,s="reloading namespace "+s+" for language "+t+" via multiloading failed"),n.logger.error(s))})})}):t.forEach(function(t){e.forEach(function(e){!function(t){var e=this,o=t.split("|"),o=N(o,2),r=o[0],i=o[1];this.read(r,i,"read",null,null,function(n,o){n&&e.logger.warn("reloading namespace "+i+" for language "+r+" failed",n),!n&&o&&e.logger.log("reloaded namespace "+i+" for language "+r,o),e.loaded(t,n,o)})}.call(n,t+"|"+e)})})},e.prototype.saveMissing=function(t,e,n,o){this.backend&&this.backend.create&&this.backend.create(t,e,n,o),t&&t[0]&&this.store.addResource(t[0],e,n,o)},e}(P),I=function(t){function e(n,o,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};k(this,e);var a=O(this,t.call(this));return a.cache=n,a.store=o,a.services=r,a.options=i,a.logger=C.create("cacheConnector"),a.cache&&a.cache.init&&a.cache.init(r,i.cache,i),a}return w(e,t),e.prototype.load=function(t,e,n){var o=this;if(!this.cache)return n&&n();var r=S({},this.cache.options,this.options.cache);"string"==typeof t&&(t=this.services.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]),r.enabled?this.cache.load(t,function(e,r){if(e&&o.logger.error("loading languages "+t.join(", ")+" from cache failed",e),r)for(var i in r)for(var a in r[i]){var s;"i18nStamp"===a||(s=r[i][a])&&o.store.addResourceBundle(i,a,s)}n&&n()}):n&&n()},e.prototype.save=function(){this.cache&&this.options.cache&&this.options.cache.enabled&&this.cache.save(this.store.data)},e}(P);return new(function(t){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=arguments[1];k(this,e);var r=O(this,t.call(this));return r.options=b(n),r.services={},r.logger=C,r.modules={},o&&!r.isInitialized&&r.init(n,o),r}return w(e,t),e.prototype.init=function(t,e){function n(t){if(t)return"function"==typeof t?new t:t}var i,o=this;"function"==typeof t&&(e=t,t={}),"v1"===(t=t||{}).compatibilityAPI?this.options=S({},y(),b(function(t){return t.resStore&&(t.resources=t.resStore),t.ns&&t.ns.defaultNs?(t.defaultNS=t.ns.defaultNs,t.ns=t.ns.namespaces):t.defaultNS=t.ns||"translation",t.fallbackToDefaultNS&&t.defaultNS&&(t.fallbackNS=t.defaultNS),t.saveMissing=t.sendMissing,t.saveMissingTo=t.sendMissingTo||"current",t.returnNull=!t.fallbackOnNull,t.returnEmptyString=!t.fallbackOnEmpty,t.returnObjects=t.returnObjectTrees,t.joinArrays="\n",t.returnedObjectHandler=t.objectTreeKeyHandler,t.parseMissingKeyHandler=t.parseMissingKey,t.appendNamespaceToMissingKey=!0,t.nsSeparator=t.nsseparator,t.keySeparator=t.keyseparator,"sprintf"===t.shortcutFunction&&(t.overloadTranslationOptionHandler=function(t){for(var e=[],n=1;n<t.length;n++)e.push(t[n]);return{postProcess:"sprintf",sprintf:e}}),t.whitelist=t.lngWhitelist,t.preload=t.preload,"current"===t.load&&(t.load="currentOnly"),"unspecific"===t.load&&(t.load="languageOnly"),t.backend=t.backend||{},t.backend.loadPath=t.resGetPath||"locales/__lng__/__ns__.json",t.backend.addPath=t.resPostPath||"locales/add/__lng__/__ns__",t.backend.allowMultiLoading=t.dynamicLoad,t.cache=t.cache||{},t.cache.prefix="res_",t.cache.expirationTime=6048e5,t.cache.enabled=!!t.useLocalStorage,(t=l(t)).defaultVariables&&(t.interpolation.defaultVariables=t.defaultVariables),t}(t)),{}):"v1"===t.compatibilityJSON?this.options=S({},y(),b(function(t){return(t=l(t)).joinArrays="\n",t}(t)),{}):this.options=S({},y(),this.options,b(t)),e=e||m,this.options.isClone||(this.modules.logger?C.init(n(this.modules.logger),this.options):C.init(null,this.options),s=new M(this.options),this.store=new E(this.options.resources,this.options),(i=this.services).logger=C,i.resourceStore=this.store,i.resourceStore.on("added removed",function(t,e){i.cacheConnector.save()}),i.languageUtils=s,i.pluralResolver=new V(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON}),i.interpolator=new U(this.options),i.backendConnector=new F(n(this.modules.backend),i.resourceStore,i,this.options),i.backendConnector.on("*",function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];o.emit.apply(o,[t].concat(n))}),i.backendConnector.on("loaded",function(t){i.cacheConnector.save()}),i.cacheConnector=new I(n(this.modules.cache),i.resourceStore,i,this.options),i.cacheConnector.on("*",function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];o.emit.apply(o,[t].concat(n))}),this.modules.languageDetector&&(i.languageDetector=n(this.modules.languageDetector),i.languageDetector.init(i,this.options.detection,this.options)),this.translator=new A(this.services,this.options),this.translator.on("*",function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];o.emit.apply(o,[t].concat(n))}));["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle"].forEach(function(t){o[t]=function(){return this.store[t].apply(this.store,arguments)}}),"v1"===this.options.compatibilityAPI&&function(t){t.lng=function(){return C.deprecate("i18next.lng() can be replaced by i18next.language for detected language or i18next.languages for languages ordered by translation lookup."),t.services.languageUtils.toResolveHierarchy(t.language)[0]},t.preload=function(e,n){C.deprecate("i18next.preload() can be replaced with i18next.loadLanguages()"),t.loadLanguages(e,n)},t.setLng=function(e,n,o){return C.deprecate("i18next.setLng() can be replaced with i18next.changeLanguage() or i18next.getFixedT() to get a translation function with fixed language or namespace."),"function"==typeof n&&(o=n,n={}),!0===(n=n||{}).fixLng&&o?o(null,t.getFixedT(e)):void t.changeLanguage(e,o)},t.addPostProcessor=function(e,n){C.deprecate("i18next.addPostProcessor() can be replaced by i18next.use({ type: 'postProcessor', name: 'name', process: fc })"),t.use({type:"postProcessor",name:e,process:n})}}(this);var s=function(){o.changeLanguage(o.options.lng,function(t,n){o.isInitialized=!0,o.emit("initialized",o.options),o.logger.log("initialized",o.options),e(t,n)})};return this.options.resources||!this.options.initImmediate?s():setTimeout(s,0),this},e.prototype.loadResources=function(t){var e=this;if(t=t||m,this.options.resources)t(null);else{var n=function(){if(e.language&&"cimode"===e.language.toLowerCase())return{v:t()};function o(t){e.services.languageUtils.toResolveHierarchy(t).forEach(function(t){n.indexOf(t)<0&&n.push(t)})}var n=[];o(e.language),e.options.preload&&e.options.preload.forEach(function(t){o(t)}),e.services.cacheConnector.load(n,e.options.ns,function(){e.services.backendConnector.load(n,e.options.ns,t)})}();if("object"===(void 0===n?"undefined":x(n)))return n.v}},e.prototype.reloadResources=function(t,e){t=t||this.languages,e=e||this.options.ns,this.services.backendConnector.reload(t,e)},e.prototype.use=function(t){return"backend"===t.type&&(this.modules.backend=t),"cache"===t.type&&(this.modules.cache=t),("logger"===t.type||t.log&&t.warn&&t.warn)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"postProcessor"===t.type&&_.addPostProcessor(t),this},e.prototype.changeLanguage=function(t,e){function o(o){t&&(n.emit("languageChanged",t),n.logger.log("languageChanged",t)),e&&e(o,function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];return n.t.apply(n,e)})}var n=this;(t=!t&&this.services.languageDetector?this.services.languageDetector.detect():t)&&(this.language=t,this.languages=this.services.languageUtils.toResolveHierarchy(t),this.translator.changeLanguage(t),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage(t)),this.loadResources(function(t){o(t)})},e.prototype.getFixedT=function(t,e){var n=this,o=function t(e){var r=S({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});return r.lng=r.lng||t.lng,r.ns=r.ns||t.ns,n.t(e,r)};return o.lng=t,o.ns=e,o},e.prototype.t=function(){return this.translator&&this.translator.translate.apply(this.translator,arguments)},e.prototype.exists=function(){return this.translator&&this.translator.exists.apply(this.translator,arguments)},e.prototype.setDefaultNamespace=function(t){this.options.defaultNS=t},e.prototype.loadNamespaces=function(t,e){var n=this;return this.options.ns?((t="string"==typeof t?[t]:t).forEach(function(t){n.options.ns.indexOf(t)<0&&n.options.ns.push(t)}),void this.loadResources(e)):e&&e()},e.prototype.loadLanguages=function(o,e){var n=this.options.preload||[],o=(o="string"==typeof o?[o]:o).filter(function(t){return n.indexOf(t)<0});return o.length?(this.options.preload=n.concat(o),void this.loadResources(e)):e()},e.prototype.dir=function(t){if(!(t=t||this.language))return"rtl";return 0<=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(t))?"rtl":"ltr"},e.prototype.createInstance=function(){return new e(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},arguments[1])},e.prototype.cloneInstance=function(){var t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=arguments[1],r=new e(S({},n,this.options,{isClone:!0}),o);return["store","services","language"].forEach(function(e){r[e]=t[e]}),r.translator=new A(r.services,r.options),r.translator.on("*",function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r.emit.apply(r,[t].concat(n))}),r},e}(P))}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.i18nextBrowserLanguageDetector=t()}(this,function(){"use strict";function e(e){return a.call(i.call(arguments,1),function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])}),e}var o={classCallCheck:function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}};o.createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();var n=[],a=n.forEach,i=n.slice,r_create=function(e,t,o,n){var i,a=void 0,a=o?((i=new Date).setTime(i.getTime()+60*o*1e3),"; expires="+i.toGMTString()):"";n=n?"domain="+n+";":"",document.cookie=e+"="+t+a+";"+n+"path=/"},r_read=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var a=o[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},u={name:"cookie",lookup:function(o){var t=void 0;return!o.lookupCookie||"undefined"==typeof document||(o=r_read(o.lookupCookie))&&(t=o),t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&r_create(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain)}},c={name:"querystring",lookup:function(e){var t=void 0;if("undefined"!=typeof window)for(var n=window.location.search.substring(1).split("&"),a=0;a<n.length;a++){var i=n[a].indexOf("=");0<i&&n[a].substring(0,i)===e.lookupQuerystring&&(t=n[a].substring(i+1))}return t}},l=void 0;try{var l="undefined"!==window&&null!==window.localStorage,h="i18next.translate.boo";window.localStorage.setItem(h,"foo"),window.localStorage.removeItem(h)}catch(g){l=!1}var f={name:"localStorage",lookup:function(o){var t=void 0;return o.lookupLocalStorage&&l&&((o=window.localStorage.getItem(o.lookupLocalStorage))&&(t=o)),t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&l&&window.localStorage.setItem(t.lookupLocalStorage,e)}},d={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var o=0;o<navigator.languages.length;o++)t.push(navigator.languages[o]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return 0<t.length?t:void 0}},v={name:"htmlTag",lookup:function(o){var t=void 0,o=o.htmlTag||("undefined"!=typeof document?document.documentElement:null);return t=o&&"function"==typeof o.getAttribute?o.getAttribute("lang"):t}},h=function(){function n(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o.classCallCheck(this,n),this.type="languageDetector",this.detectors={},this.init(e,t)}return o.createClass(n,[{key:"init",value:function(o){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this.services=o,this.options=e(n,this.options||{},{order:["querystring","cookie","localStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"]}),this.i18nOptions=a,this.addDetector(u),this.addDetector(c),this.addDetector(f),this.addDetector(d),this.addDetector(v)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e=e||this.options.order;var o=[];e.forEach(function(n){!t.detectors[n]||(n=(n=t.detectors[n].lookup(t.options))&&"string"==typeof n?[n]:n)&&(o=o.concat(n))});var n=void 0;return o.forEach(function(o){n||(o=t.services.languageUtils.formatLanguageCode(o),t.services.languageUtils.isWhitelisted(o)&&(n=o))}),n||this.i18nOptions.fallbackLng[0]}},{key:"cacheUserLanguage",value:function(e,t){var o=this;(t=t||this.options.caches)&&t.forEach(function(t){o.detectors[t]&&o.detectors[t].cacheUserLanguage(e,o.options)})}}]),n}();return h.type="languageDetector",h}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.i18nextXHRBackend=e()}(this,function(){"use strict";function e(t,e){if(e&&"object"===(void 0===e?"undefined":l(e))){var i,n="",o=encodeURIComponent;for(i in e)n+="&"+o(i)+"="+o(e[i]);if(!n)return t;t=t+(-1!==t.indexOf("?")?"&":"?")+n.slice(1)}return t}function n(t,n,o,i,a){i&&"object"===(void 0===i?"undefined":l(i))&&(a||(i._t=new Date),i=e("",i).slice(1)),n.queryStringParams&&(t=e(t,n.queryStringParams));try{var r=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");r.open(i?"POST":"GET",t,1),n.crossDomain||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!!n.withCredentials,i&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.overrideMimeType&&r.overrideMimeType("application/json");var s=n.customHeaders;if(s)for(var u in s)r.setRequestHeader(u,s[u]);r.onreadystatechange=function(){3<r.readyState&&o&&o(r.responseText,r)},r.send(i)}catch(t){console&&console.log(t)}}function i(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:JSON.parse,crossDomain:!1,ajax:n}}var c=[],r=c.forEach,s=c.slice,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),c=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),this.init(t,n),this.type="backend"}return u(e,[{key:"init",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=function(t){return r.call(s.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t}(n,this.options||{},i())}},{key:"readMulti",value:function(t,i,n){var o=this.options.loadPath;"function"==typeof this.options.loadPath&&(o=this.options.loadPath(t,i));i=this.services.interpolator.interpolate(o,{lng:t.join("+"),ns:i.join("+")});this.loadUrl(i,n)}},{key:"read",value:function(t,i,n){var o=this.options.loadPath;"function"==typeof this.options.loadPath&&(o=this.options.loadPath([t],[i]));i=this.services.interpolator.interpolate(o,{lng:t,ns:i});this.loadUrl(i,n)}},{key:"loadUrl",value:function(t,e){var n=this;this.options.ajax(t,this.options,function(o,r){if(500<=r.status&&r.status<600)return e("failed loading "+t,!0);if(400<=r.status&&r.status<500)return e("failed loading "+t,!1);var a=void 0,r=void 0;try{a=n.options.parse(o,t)}catch(e){r="failed parsing "+t+" to json"}if(r)return e(r,!1);e(null,a)})}},{key:"create",value:function(t,e,n,o){var i=this;"string"==typeof t&&(t=[t]);var a={};a[n]=o||"",t.forEach(function(n){n=i.services.interpolator.interpolate(i.options.addPath,{lng:n,ns:e});i.options.ajax(n,i.options,function(t,e){},a)})}}]),e}();return c.type="backend",c}),function($){var methods={init:function(options){var o=$.extend({items:1,itemsOnPage:1,pages:0,displayedPages:5,edges:2,currentPage:0,hrefTextPrefix:"#page-",hrefTextSuffix:"",prevText:"Prev",nextText:"Next",ellipseText:"&hellip;",ellipsePageSet:!0,cssStyle:"light-theme",listStyle:"",labelMap:[],selectOnClick:!0,nextAtFront:!1,invertPageOrder:!1,useStartEdge:!0,useEndEdge:!0,onPageClick:function(pageNumber,event){},onInit:function(){}},options||{}),self=this;return o.pages=o.pages||(Math.ceil(o.items/o.itemsOnPage)?Math.ceil(o.items/o.itemsOnPage):1),o.currentPage?o.currentPage=o.currentPage-1:o.currentPage=o.invertPageOrder?o.pages-1:0,o.halfDisplayed=o.displayedPages/2,this.each(function(){self.addClass(o.cssStyle+" simple-pagination").data("pagination",o),methods._draw.call(self)}),o.onInit(),this},selectPage:function(page){return methods._selectPage.call(this,page-1),this},prevPage:function(){var o=this.data("pagination");return o.invertPageOrder?o.currentPage<o.pages-1&&methods._selectPage.call(this,o.currentPage+1):0<o.currentPage&&methods._selectPage.call(this,o.currentPage-1),this},nextPage:function(){var o=this.data("pagination");return o.invertPageOrder?0<o.currentPage&&methods._selectPage.call(this,o.currentPage-1):o.currentPage<o.pages-1&&methods._selectPage.call(this,o.currentPage+1),this},getPagesCount:function(){return this.data("pagination").pages},setPagesCount:function(count){this.data("pagination").pages=count},getCurrentPage:function(){return this.data("pagination").currentPage+1},destroy:function(){return this.empty(),this},drawPage:function(page){var o=this.data("pagination");return o.currentPage=page-1,this.data("pagination",o),methods._draw.call(this),this},redraw:function(){return methods._draw.call(this),this},disable:function(){var o=this.data("pagination");return o.disabled=!0,this.data("pagination",o),methods._draw.call(this),this},enable:function(){var o=this.data("pagination");return o.disabled=!1,this.data("pagination",o),methods._draw.call(this),this},updateItems:function(newItems){var o=this.data("pagination");o.items=newItems,o.pages=methods._getPages(o),this.data("pagination",o),methods._draw.call(this)},updateItemsOnPage:function(itemsOnPage){var o=this.data("pagination");return o.itemsOnPage=itemsOnPage,o.pages=methods._getPages(o),this.data("pagination",o),methods._selectPage.call(this,0),this},getItemsOnPage:function(){return this.data("pagination").itemsOnPage},_draw:function(){var o=this.data("pagination"),interval=methods._getInterval(o);methods.destroy.call(this);var $panel="UL"===("function"==typeof this.prop?this.prop("tagName"):this.attr("tagName"))?this:$("<ul"+(o.listStyle?' class="'+o.listStyle+'"':"")+"></ul>").appendTo(this);if(o.prevText&&methods._appendItem.call(this,o.invertPageOrder?o.currentPage+1:o.currentPage-1,{text:o.prevText,classes:"prev"}),o.nextText&&o.nextAtFront&&methods._appendItem.call(this,o.invertPageOrder?o.currentPage-1:o.currentPage+1,{text:o.nextText,classes:"next"}),o.invertPageOrder){if(interval.end<o.pages&&0<o.edges){if(o.useStartEdge){var begin=Math.max(o.pages-o.edges,interval.end);for(i=o.pages-1;begin<=i;i--)methods._appendItem.call(this,i)}o.pages-o.edges>interval.end&&o.pages-o.edges-interval.end!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):o.pages-o.edges-interval.end==1&&methods._appendItem.call(this,interval.end)}}else if(0<interval.start&&0<o.edges){if(o.useStartEdge)for(var end=Math.min(o.edges,interval.start),i=0;i<end;i++)methods._appendItem.call(this,i);o.edges<interval.start&&interval.start-o.edges!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):interval.start-o.edges==1&&methods._appendItem.call(this,o.edges)}if(o.invertPageOrder)for(i=interval.end-1;i>=interval.start;i--)methods._appendItem.call(this,i);else for(i=interval.start;i<interval.end;i++)methods._appendItem.call(this,i);if(o.invertPageOrder){if(0<interval.start&&0<o.edges&&(o.edges<interval.start&&interval.start-o.edges!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):interval.start-o.edges==1&&methods._appendItem.call(this,o.edges),o.useEndEdge))for(i=(end=Math.min(o.edges,interval.start))-1;0<=i;i--)methods._appendItem.call(this,i)}else if(interval.end<o.pages&&0<o.edges&&(o.pages-o.edges>interval.end&&o.pages-o.edges-interval.end!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):o.pages-o.edges-interval.end==1&&methods._appendItem.call(this,interval.end),o.useEndEdge))for(i=begin=Math.max(o.pages-o.edges,interval.end);i<o.pages;i++)methods._appendItem.call(this,i);o.nextText&&!o.nextAtFront&&methods._appendItem.call(this,o.invertPageOrder?o.currentPage-1:o.currentPage+1,{text:o.nextText,classes:"next"}),o.ellipsePageSet&&!o.disabled&&methods._ellipseClick.call(this,$panel)},_getPages:function(o){return Math.ceil(o.items/o.itemsOnPage)||1},_getInterval:function(o){return{start:Math.ceil(o.currentPage>o.halfDisplayed?Math.max(Math.min(o.currentPage-o.halfDisplayed,o.pages-o.displayedPages),0):0),end:Math.ceil(o.currentPage>o.halfDisplayed?Math.min(o.currentPage+o.halfDisplayed,o.pages):Math.min(o.displayedPages,o.pages))}},_appendItem:function(pageIndex,opts){var $link,self=this,o=self.data("pagination"),$linkWrapper=$("<li></li>"),$ul=self.find("ul"),options={text:(pageIndex=pageIndex<0?0:pageIndex<o.pages?pageIndex:o.pages-1)+1,classes:""};o.labelMap.length&&o.labelMap[pageIndex]&&(options.text=o.labelMap[pageIndex]),options=$.extend(options,opts||{}),pageIndex==o.currentPage||o.disabled?(o.disabled||"prev"===options.classes||"next"===options.classes?$linkWrapper.addClass("disabled"):$linkWrapper.addClass("active"),$link=$('<span class="current">'+options.text+"</span>")):($link=$('<a href="'+o.hrefTextPrefix+(pageIndex+1)+o.hrefTextSuffix+'" class="page-link">'+options.text+"</a>")).click(function(event){return methods._selectPage.call(self,pageIndex,event)}),options.classes&&$link.addClass(options.classes),$linkWrapper.append($link),($ul.length?$ul:self).append($linkWrapper)},_selectPage:function(pageIndex,event){var o=this.data("pagination");return o.currentPage=pageIndex,o.selectOnClick&&methods._draw.call(this),o.onPageClick(pageIndex+1,event)},_ellipseClick:function($panel){var self=this,o=this.data("pagination"),$ellip=$panel.find(".ellipse");$ellip.addClass("clickable").parent().removeClass("disabled"),$ellip.click(function(event){var $this,val;return o.disable||($this=$(this),val=(parseInt($this.parent().prev().text(),10)||0)+1,$this.html('<input type="number" min="1" max="'+o.pages+'" step="1" value="'+val+'">').find("input").focus().click(function(event){event.stopPropagation()}).keyup(function(event){var val=$(this).val();13===event.which&&""!==val?0<val&&val<=o.pages&&methods._selectPage.call(self,val-1):27===event.which&&$ellip.empty().html(o.ellipseText)}).bind("blur",function(event){var val=$(this).val();return""!==val&&methods._selectPage.call(self,val-1),$ellip.empty().html(o.ellipseText),!1})),!1})}};$.fn.pagination=function(method){return methods[method]&&"_"!=method.charAt(0)?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.pagination"):methods.init.apply(this,arguments)}}(jQuery),function(e,t,n){function r(e,t){return typeof e===t}function a(argument_0){return"function"!=typeof t.createElement?t.createElement(argument_0):b?t.createElementNS.call(t,"http://www.w3.org/2000/svg",argument_0):t.createElement.apply(t,arguments)}function f(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function p(s,n,r,o){var i,l,u,c="modernizr",f=a("div"),p=function(){var e=t.body;return e||((e=a(b?"svg":"body")).fake=!0),e}();if(parseInt(r,10))for(;r--;)(l=a("div")).id=o?o[r]:c+(r+1),f.appendChild(l);return(i=a("style")).type="text/css",i.id="s"+c,(p.fake?p:f).appendChild(i),p.appendChild(f),i.styleSheet?i.styleSheet.cssText=s:i.appendChild(t.createTextNode(s)),f.id=c,p.fake&&(p.style.background="",p.style.overflow="hidden",u=C.style.overflow,C.style.overflow="hidden",C.appendChild(p)),s=n(f,s),p.fake?(p.parentNode.removeChild(p),C.style.overflow=u,C.offsetHeight):f.parentNode.removeChild(f),!!s}function m(t,r){var o=t.length;if("CSS"in e&&"supports"in e.CSS){for(;o--;)if(e.CSS.supports(f(t[o]),r))return!0;return!1}if("CSSSupportsRule"in e){for(var i=[];o--;)i.push("("+f(t[o])+":"+r+")");return p("@supports ("+(i=i.join(" or "))+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return n}function h(e,t,o,i){function u(){f&&(delete z.style,delete z.modElem)}if(i=void 0!==i&&i,void 0!==o){var c=m(e,o);if(void 0!==c)return c}for(var f,d,p,h,v,g=["modernizr","tspan","samp"];!z.style&&g.length;)f=!0,z.modElem=a(g.shift()),z.style=z.modElem.style;for(p=e.length,d=0;d<p;d++)if(h=e[d],v=z.style[h],~(""+h).indexOf("-")&&(h=function(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}(h)),z.style[h]!==n){if(i||void 0===o)return u(),"pfx"!=t||h;try{z.style[h]=o}catch(y){}if(z.style[h]!=v)return u(),"pfx"!=t||h}return u(),!1}function v(e,t,n,o,i){var a=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+T.join(a+" ")+a).split(" ");return r(t,"string")||void 0===t?h(s,t,o,i):function(e,t,n){var o,i;for(i in e)if(e[i]in t)return!1===n?e[i]:(o=t[e[i]],r(o,"function")?function(e,t){return function(){return e.apply(t,arguments)}}(o,n||t):o);return!1}(s=(e+" "+j.join(a+" ")+a).split(" "),t,n)}function g(e,t,r){return v(e,n,n,t,r)}var y=[],E=[],S={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){E.push({name:e,fn:t,options:n})},addAsyncTest:function(e){E.push({name:null,fn:e})}};(Modernizr=function(){}).prototype=S;var Modernizr=new Modernizr,C=t.documentElement,b="svg"===C.nodeName.toLowerCase(),x=S._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];S._prefixes=x;var w="CSS"in e&&"supports"in e.CSS,N="supportsCSS"in e;Modernizr.addTest("supports",w||N),b||function(e,t){function n(r,t){var n=r.createElement("p"),r=r.getElementsByTagName("head")[0]||r.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=w.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=x[e[C]];return t||(t={},b++,e[C]=b,x[b]=t),t}function a(e,o,r){return o=o||t,v?o.createElement(e):!(o=(r=r||i(o)).cache[e]?r.cache[e].cloneNode():S.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e)).canHaveChildren||E.test(e)||o.tagUrn?o:r.frag.appendChild(o)}function l(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return w.shivMethods?a(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-:]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(w,t.frag)}function u(e){var r=i(e=e||t);return!w.shivCSS||h||r.hasCSS||(r.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),v||l(e,r),e}function c(e){for(var t,n=e.getElementsByTagName("*"),o=n.length,i=RegExp("^(?:"+r().join("|")+")$","i"),a=[];o--;)t=n[o],i.test(t.nodeName)&&a.push(t.applyElement(function(e){for(var t,n=e.attributes,r=n.length,o=e.ownerDocument.createElement(N+":"+e.nodeName);r--;)(t=n[r]).specified&&o.setAttribute(t.nodeName,t.nodeValue);return o.style.cssText=e.style.cssText,o}(t)));return a}function d(e){for(var t,n=e.split("{"),o=n.length,i=RegExp("(^|[\\s,>+~])("+r().join("|")+")(?=[[\\s,>+~#.:]|$)","gi"),a="$1"+N+"\\:$2";o--;)(t=n[o]=n[o].split("}"))[t.length-1]=t[t.length-1].replace(i,a),n[o]=t.join("}");return n.join("{")}function m(e){function t(){clearTimeout(a._removeSheetTimer),r&&r.removeNode(!0),r=null}var r,o,a=i(e),s=e.namespaces,l=e.parentWindow;return!T||e.printShived||(void 0===s[N]&&s.add(N),l.attachEvent("onbeforeprint",function(){t();for(var i,a,s,l=e.styleSheets,u=[],f=l.length,p=Array(f);f--;)p[f]=l[f];for(;s=p.pop();)if(!s.disabled&&_.test(s.media)){try{a=(i=s.imports).length}catch(m){a=0}for(f=0;f<a;f++)p.push(i[f]);try{u.push(s.cssText)}catch(m){}}u=d(u.reverse().join("")),o=c(e),r=n(e,u)}),l.attachEvent("onafterprint",function(){(function(e){for(var t=e.length;t--;)e[t].removeNode()})(o),clearTimeout(a._removeSheetTimer),a._removeSheetTimer=setTimeout(t,500)}),e.printShived=!0),e}var h,v,y=e.html5||{},E=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,S=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,C="_html5shiv",b=0,x={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",h="hidden"in e,v=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(n){v=h=!0}}();var w={elements:y.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:"3.7.3",shivCSS:!1!==y.shivCSS,supportsUnknownElements:v,shivMethods:!1!==y.shivMethods,type:"default",shivDocument:u,createElement:a,createDocumentFragment:function(e,n){if(e=e||t,v)return e.createDocumentFragment();for(var o=(n=n||i(e)).frag.cloneNode(),a=0,s=r(),l=s.length;a<l;a++)o.createElement(s[a]);return o},addElements:function(e,t){var n=w.elements;"string"!=typeof n&&(n=n.join(" ")),"string"!=typeof e&&(e=e.join(" ")),w.elements=n+" "+e,u(t)}};e.html5=w,u(t);var _=/^$|\b(?:all|print)\b/,N="html5shiv",T=!v&&function(){var n=t.documentElement;return!(void 0===t.namespaces||void 0===t.parentWindow||void 0===n.applyElement||void 0===n.removeNode||void 0===e.attachEvent)}();w.type+=" print",(w.shivPrint=m)(t),"object"==typeof module&&module.exports&&(module.exports=w)}(void 0!==e?e:this,t);var N="Moz O ms Webkit",T=S._config.usePrefixes?N.split(" "):[];S._cssomPrefixes=T;var j=S._config.usePrefixes?N.toLowerCase().split(" "):[];S._domPrefixes=j;var k={elem:a("modernizr")};Modernizr._q.push(function(){delete k.elem});var z={style:k.elem.style};Modernizr._q.unshift(function(){delete z.style}),S.testAllProps=v,S.testAllProps=g,Modernizr.addTest("cssfilters",function(){if(Modernizr.supports)return g("filter","blur(2px)");var e=a("a");return e.style.cssText=x.join("filter:blur(2px); "),!!e.style.length&&(t.documentMode===n||9<t.documentMode)}),function(){var e,t,n,o,i,s,l;for(l in E)if(E.hasOwnProperty(l)){if(e=[],(t=E[l]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(o=r(t.fn,"function")?t.fn():t.fn,i=0;i<e.length;i++)1===(s=e[i].split(".")).length?Modernizr[s[0]]=o:(!Modernizr[s[0]]||Modernizr[s[0]]instanceof Boolean||(Modernizr[s[0]]=new Boolean(Modernizr[s[0]])),Modernizr[s[0]][s[1]]=o),y.push((o?"":"no-")+s.join("-"))}}(),function(e){var r,t=C.className,n=Modernizr._config.classPrefix||"";b&&(t=t.baseVal),Modernizr._config.enableJSClass&&(r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)"),t=t.replace(r,"$1"+n+"js$2")),Modernizr._config.enableClasses&&(t+=" "+n+e.join(" "+n),b?C.className.baseVal=t:C.className=t)}(y),delete S.addTest,delete S.addAsyncTest;for(var P=0;P<Modernizr._q.length;P++)Modernizr._q[P]();e.Modernizr=Modernizr}(window,document),function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).sanitizeHtml=f()}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!u&&l)return l(o,!0);if(i)return i(o,!0);l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var htmlparser=require("htmlparser2"),extend=require("xtend"),quoteRegexp=require("regexp-quote");function each(obj,cb){obj&&Object.keys(obj).forEach(function(key){cb(obj[key],key)})}function has(obj,key){return{}.hasOwnProperty.call(obj,key)}function sanitizeHtml(html,options,_recursing){var result="";function Frame(tag,attribs){var that=this;this.tag=tag,this.attribs=attribs||{},this.tagPosition=result.length,this.text="",this.updateParentNodeText=function(){stack.length&&(stack[stack.length-1].text+=that.text)}}options?(options=extend(sanitizeHtml.defaults,options)).parser?options.parser=extend(htmlParserDefaults,options.parser):options.parser=htmlParserDefaults:(options=sanitizeHtml.defaults).parser=htmlParserDefaults;var allowedAttributesMap,allowedAttributesGlobMap,nonTextTagsArray=options.nonTextTags||["script","style","textarea"];options.allowedAttributes&&(allowedAttributesMap={},allowedAttributesGlobMap={},each(options.allowedAttributes,function(attributes,tag){allowedAttributesMap[tag]=[];var globRegex=[];attributes.forEach(function(name){0<=name.indexOf("*")?globRegex.push(quoteRegexp(name).replace(/\\\*/g,".*")):allowedAttributesMap[tag].push(name)}),allowedAttributesGlobMap[tag]=new RegExp("^("+globRegex.join("|")+")$")}));var allowedClassesMap={};each(options.allowedClasses,function(classes,tag){allowedAttributesMap&&(has(allowedAttributesMap,tag)||(allowedAttributesMap[tag]=[]),allowedAttributesMap[tag].push("class")),allowedClassesMap[tag]=classes});var transformTagsAll,transformTagsMap={};each(options.transformTags,function(transform,tag){var transFun;"function"==typeof transform?transFun=transform:"string"==typeof transform&&(transFun=sanitizeHtml.simpleTransform(transform)),"*"===tag?transformTagsAll=transFun:transformTagsMap[tag]=transFun});var depth=0,stack=[],skipMap={},transformMap={},skipText=!1,skipTextDepth=0,parser=new htmlparser.Parser({onopentag:function(name,attribs){var frame,skip,hasText,transformedTag;skipText?skipTextDepth++:(frame=new Frame(name,attribs),stack.push(frame),skip=!1,hasText=!!frame.text,has(transformTagsMap,name)&&(transformedTag=transformTagsMap[name](name,attribs),frame.attribs=attribs=transformedTag.attribs,void 0!==transformedTag.text&&(frame.innerText=transformedTag.text),name!==transformedTag.tagName&&(frame.name=name=transformedTag.tagName,transformMap[depth]=transformedTag.tagName)),transformTagsAll&&(transformedTag=transformTagsAll(name,attribs),frame.attribs=attribs=transformedTag.attribs,name!==transformedTag.tagName&&(frame.name=name=transformedTag.tagName,transformMap[depth]=transformedTag.tagName)),options.allowedTags&&-1===options.allowedTags.indexOf(name)&&(skip=!0,-1!==nonTextTagsArray.indexOf(name)&&(skipText=!0,skipTextDepth=1),skipMap[depth]=!0),depth++,skip||(result+="<"+name,allowedAttributesMap&&!has(allowedAttributesMap,name)&&!allowedAttributesMap["*"]||each(attribs,function(value,a){var classes,allowed;(!allowedAttributesMap||has(allowedAttributesMap,name)&&-1!==allowedAttributesMap[name].indexOf(a)||allowedAttributesMap["*"]&&-1!==allowedAttributesMap["*"].indexOf(a)||has(allowedAttributesGlobMap,name)&&allowedAttributesGlobMap[name].test(a)||allowedAttributesGlobMap["*"]&&allowedAttributesGlobMap["*"].test(a))&&("href"!==a&&"src"!==a||!function(name,scheme){scheme=(scheme=(scheme=scheme.replace(/[\x00-\x20]+/g,"")).replace(/<\!\-\-.*?\-\-\>/g,"")).match(/^([a-zA-Z]+)\:/);if(!scheme)return!1;scheme=scheme[1].toLowerCase();if(has(options.allowedSchemesByTag,name))return-1===options.allowedSchemesByTag[name].indexOf(scheme);return!options.allowedSchemes||-1===options.allowedSchemes.indexOf(scheme)}(name,value))&&("class"!==a||(classes=value,(value=(allowed=allowedClassesMap[name])?(classes=classes.split(/\s+/)).filter(function(clss){return-1!==allowed.indexOf(clss)}).join(" "):classes).length))?(result+=" "+a,value.length&&(result+='="'+escapeHtml(value)+'"')):delete frame.attribs[a]}),-1!==options.selfClosing.indexOf(name)?result+=" />":(result+=">",!frame.innerText||hasText||options.textFilter||(result+=frame.innerText))))},ontext:function(text){var lastFrame,escaped;skipText||((lastFrame=stack[stack.length-1])&&(escaped=lastFrame.tag,text=void 0!==lastFrame.innerText?lastFrame.innerText:text),"script"===escaped||"style"===escaped?result+=text:(escaped=escapeHtml(text),options.textFilter?result+=options.textFilter(escaped):result+=escaped),stack.length&&(stack[stack.length-1].text+=text))},onclosetag:function(name){if(skipText){if(--skipTextDepth)return;skipText=!1}var frame=stack.pop();if(frame){if(skipText=!1,skipMap[--depth])return delete skipMap[depth],void frame.updateParentNodeText();transformMap[depth]&&(name=transformMap[depth],delete transformMap[depth]),options.exclusiveFilter&&options.exclusiveFilter(frame)?result=result.substr(0,frame.tagPosition):(frame.updateParentNodeText(),-1===options.selfClosing.indexOf(name)&&(result+="</"+name+">"))}}},options.parser);return parser.write(html),parser.end(),result;function escapeHtml(s){return"string"!=typeof s&&(s+=""),s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;")}}module.exports=sanitizeHtml;var htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},sanitizeHtml.simpleTransform=function(newTagName,newAttribs,merge){return merge=void 0===merge||merge,newAttribs=newAttribs||{},function(tagName,attribs){if(merge)for(var attrib in newAttribs)attribs[attrib]=newAttribs[attrib];else attribs=newAttribs;return{tagName:newTagName,attribs:attribs}}}},{htmlparser2:36,"regexp-quote":59,xtend:60}],2:[function(require,module,exports){},{}],3:[function(require,module,exports){!function(global){"use strict";var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer.prototype:(that=null===that?new Buffer(length):that).length=length,that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"!=typeof arg)return from(this,arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?function(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer.prototype:that=fromArrayLike(that,array);return that}(that,value,encodingOrOffset,length):"string"==typeof value?function(that,string,actual){"string"==typeof actual&&""!==actual||(actual="utf8");if(!Buffer.isEncoding(actual))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,actual),actual=(that=createBuffer(that,length)).write(string,actual);actual!==length&&(that=that.slice(0,actual));return that}(that,value,encodingOrOffset):function(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length?that:(obj.copy(that,0,0,len),that)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||function(val){return val!=val}(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;var len=(string="string"!=typeof string?""+string:string).length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,(byteOffset=(byteOffset=isNaN(byteOffset)?dir?0:buffer.length-1:byteOffset)<0?buffer.length+byteOffset:byteOffset)>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)lo=str.charCodeAt(i),hi=lo>>8,lo=lo%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return function(that,size,fill,encoding){return assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0==length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return 0<this.length&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return function(buf,string,offset,length){offset=Number(offset)||0;var strLen=buf.length-offset;if((!length||strLen<(length=Number(length)))&&(length=strLen),(strLen=string.length)%2!=0)throw new TypeError("Invalid hex string");strLen/2<length&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}(this,string,offset,length);case"utf8":case"utf-8":return function(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return function(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0),i=0;i<sliceLen;++i)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(val,noAssert){noAssert||checkOffset(val,2,this.length);val=this[val]|this[val+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(val,noAssert){noAssert||checkOffset(val,2,this.length);val=this[val+1]|this[val]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset|=0,byteLength|=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset|=0,byteLength|=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,limit){value=+value,offset|=0,limit||checkInt(this,value,offset,byteLength,(limit=Math.pow(2,8*byteLength-1))-1,-limit);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,limit){value=+value,offset|=0,limit||checkInt(this,value,offset,byteLength,(limit=Math.pow(2,8*byteLength-1))-1,-limit);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var i,len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){var code;if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1!==val.length||(code=val.charCodeAt(0))<256&&(val=code),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else for(var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length,i=0;i<end-start;++i)this[i+start]=bytes[i%len];return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":4,ieee754:5,isarray:6}],4:[function(require,module,exports){"use strict";exports.toByteArray=function(b64){var i,l,tmp,placeHolders,arr,len=b64.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");placeHolders="="===b64[len-2]?2:"="===b64[len-1]?1:0,arr=new Arr(3*len/4-placeHolders),l=0<placeHolders?len-4:len;var L=0;for(i=0;i<l;i+=4,0)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;2==placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1==placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(function(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(function(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}(tmp));return output.join("")}(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="=");return parts.push(output),parts.join("")};var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array;!function(){for(var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}()},{}],5:[function(require,module,exports){exports.read=function(buffer,offset,s,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=s?nBytes-1:0,d=s?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,c,mLen,s){var e,m,eLen=8*s-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=c?0:s-1,d=c?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),2<=(value+=1<=e+eBias?rt/c:rt*Math.pow(2,1-eBias))*c&&(e++,c/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],6:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],7:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}((module.exports=EventEmitter).EventEmitter=EventEmitter).prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(void 0===(handler=this._events[type]))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),len=(listeners=handler.slice()).length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=void 0!==this._maxListeners?this._maxListeners:EventEmitter.defaultMaxListeners)&&0<m&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(length=(list=this._events[type]).length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;0<i--;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(listeners=this._events[type]))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(ret){ret=this._events&&this._events[ret]?isFunction(this._events[ret])?[this._events[ret]]:this._events[ret].slice():[];return ret},EventEmitter.prototype.listenerCount=function(evlistener){if(this._events){evlistener=this._events[evlistener];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],8:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;function TempCtor(){}TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],9:[function(require,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||function(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}(obj)||!!obj._isBuffer)}},{}],10:[function(require,process,exports){var cachedSetTimeout,cachedClearTimeout,process=process.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],11:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":12}],12:[function(require,util,exports){"use strict";var objectKeys=Object.keys||function(obj){var key,keys=[];for(key in obj)keys.push(key);return keys};util.exports=Duplex;var processNextTick=require("process-nextick-args"),util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}},{"./_stream_readable":14,"./_stream_writable":16,"core-util-is":19,inherits:8,"process-nextick-args":21}],13:[function(require,util,exports){"use strict";util.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":15,"core-util-is":19,inherits:8}],14:[function(require,module,exports){!function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args"),isArray=require("isarray");Readable.ReadableState=ReadableState;function EElistenerCount(emitter,type){return emitter.listeners(type).length}var Stream;require("events").EventEmitter;!function(){try{Stream=require("stream")}catch(_){}finally{Stream=Stream||require("events").EventEmitter}}();var Buffer=require("buffer").Buffer,bufferShim=require("buffer-shims"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder,Duplex,debugUtil=require("util"),debug=void 0,debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){},BufferList=require("./internal/streams/BufferList");function ReadableState(options,defaultHwm){Duplex=Duplex||require("./_stream_duplex"),this.objectMode=!!(options=options||{}).objectMode,defaultHwm instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder=StringDecoder||require("string_decoder/").StringDecoder,this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),Stream.call(this)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var _e,skipAdd,er=function(state,chunk){var er=null;Buffer.isBuffer(chunk)||"string"==typeof chunk||null==chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk"));return er}(state,chunk);return er?stream.emit("error",er):null===chunk?(state.reading=!1,function(stream,state){var chunk;state.ended||(!state.decoder||(chunk=state.decoder.end())&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length),state.ended=!0,emitReadable(stream))}(stream,state)):state.objectMode||chunk&&0<chunk.length?state.ended&&!addToFront?(_e=new Error("stream.push() after EOF"),stream.emit("error",_e)):state.endEmitted&&addToFront?(_e=new Error("stream.unshift() after end event"),stream.emit("error",_e)):(!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk),skipAdd=!state.objectMode&&0===chunk.length),addToFront||(state.reading=!1),skipAdd||(state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream))),function(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}(stream,state)):addToFront||(state.reading=!1),function(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}(state)}util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=bufferShim.from(chunk,encoding),encoding=""),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,this._readableState,chunk,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder=StringDecoder||require("string_decoder/").StringDecoder,this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?(state.flowing&&state.length?state.buffer.head.data:state).length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return MAX_HWM<=n?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){return 0===state.length?null:(state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=function(n,list,hasStrings){var ret;n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():(hasStrings?function(n,list){var p=list.head,c=1,ret=p.data;n-=ret.length;for(;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p).data=str.slice(nb);break}++c}return list.length-=c,ret}:function(n,list){var ret=bufferShim.allocUnsafe(n),p=list.head,c=1;p.data.copy(ret),n-=p.data.length;for(;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p).data=buf.slice(nb);break}++c}return list.length-=c,ret})(n,list);return ret}(n,state.buffer,state.decoder),ret);var ret}function endReadable(stream){var state=stream._readableState;if(0<state.length)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),(0===state.length&&state.ended?endReadable:emitReadable)(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var ret=state.needReadable;return debug("need readable",ret),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",ret=!0),state.ended||state.reading?debug("reading or ended",ret=!1):ret&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state))),null===(ret=0<n?fromList(n,state):null)?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,endFn){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,endFn);endFn=(!endFn||!1!==endFn.end)&&dest!==process.stdout&&dest!==process.stderr?onend:cleanup;function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=function(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}(src);dest.on("drain",ondrain);var cleanedUp=!1;function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}var increasedAwaitDrain=!1;function ondata(chunk){debug("ondata"),(increasedAwaitDrain=!1)!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||1<state.pipesCount&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}return src.on("data",ondata),function(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes||(dest=dest||state.pipes,state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this)),this;if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var _i=0;_i<len;_i++)dests[_i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i||(state.pipes.splice(i,1),--state.pipesCount,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this)),this},Readable.prototype.on=function(state,res){res=Stream.prototype.on.call(this,state,res);return"data"===state?!1!==this._readableState.flowing&&this.resume():"readable"===state&&((state=this._readableState).endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):processNextTick(nReadingNextTick,this))),res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var i,state=this._readableState,paused=!1,self=this;for(i in stream.on("end",function(){var chunk;debug("wrapped end"),!state.decoder||state.ended||(chunk=state.decoder.end())&&chunk.length&&self.push(chunk),self.push(null)}),stream.on("data",function(chunk){debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),state.objectMode&&null==chunk||(state.objectMode||chunk&&chunk.length)&&(self.push(chunk)||(paused=!0,stream.pause()))}),stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));return function(xs,f){for(var i=0,l=xs.length;i<l;i++)f(xs[i],i)}(["error","close","destroy","pause","resume"],function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}.call(this,require("_process"))},{"./_stream_duplex":12,"./internal/streams/BufferList":17,_process:10,buffer:3,"buffer-shims":18,"core-util-is":19,events:7,inherits:8,isarray:20,"process-nextick-args":21,"string_decoder/":28,util:2}],15:[function(require,util,exports){"use strict";util.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");function TransformState(stream){this.afterTransform=function(er,data){return function(stream,rs,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,(ts.writecb=null)!=data&&stream.push(data);cb(rs);rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,ts){if(ts)return stream.emit("error",ts);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("Not implemented")},Transform.prototype._write=function(chunk,rs,cb){var ts=this._transformState;ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=rs,ts.transforming||(rs=this._readableState,(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark))},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":12,"core-util-is":19,inherits:8}],16:[function(require,module,exports){!function(util){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args"),asyncWrite=!util.browser&&-1<["v0.10","v0.9."].indexOf(util.version.slice(0,5))?setImmediate:processNextTick;Writable.WritableState=WritableState;util=require("core-util-is");util.inherits=require("inherits");var Stream,internalUtil={deprecate:require("util-deprecate")};!function(){try{Stream=require("stream")}catch(_){}finally{Stream=Stream||require("events").EventEmitter}}();var Duplex,Buffer=require("buffer").Buffer,bufferShim=require("buffer-shims");function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),this.objectMode=!!(options=options||{}).objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,noDecode=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:noDecode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;noDecode=(this.finished=!1)===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,finished){var state=stream._writableState,sync=state.sync,cb=state.writecb;(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0})(state),finished?function(stream,state,sync,er,cb){--state.pendingcb,sync?processNextTick(cb,er):cb(er);stream._writableState.errorEmitted=!0,stream.emit("error",er)}(stream,state,sync,finished,cb):((finished=needFinish(state))||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb))}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Writable||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),Stream.call(this)}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var holder=state.bufferedRequestCount,buffer=new Array(holder),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0;entry;)entry=(buffer[count]=entry).next,count+=1;doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(err){var entry=_this.entry;for(_this.entry=null;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=_this:state.corkedRequestsFree=_this}}util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(_){}}(),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),encoding=Buffer.isBuffer(chunk)?"buffer":encoding||state.defaultEncoding,"function"!=typeof cb&&(cb=nop),state.ended?function(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}(this,cb):function(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):Buffer.isBuffer(chunk)||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),processNextTick(cb,er),valid=!1),valid}(this,state,chunk,cb)&&(state.pendingcb++,ret=function(stream,state,chunk,encoding,cb){chunk=function(state,chunk,encoding){state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=bufferShim.from(chunk,encoding));return chunk}(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;ret||(state.needDrain=!0);{var last;state.writing||state.corked?(last=state.lastBufferedRequest,state.lastBufferedRequest=new WriteReq(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1):doWrite(stream,state,!1,len,chunk,encoding,cb)}return ret}(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,encoding=chunk=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!=chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb));state.ended=!0,stream.writable=!1}(this,state,cb)}}.call(this,require("_process"))},{"./_stream_duplex":12,_process:10,buffer:3,"buffer-shims":18,"core-util-is":19,events:7,inherits:8,"process-nextick-args":21,"util-deprecate":22}],17:[function(require,module,exports){"use strict";require("buffer").Buffer;var bufferShim=require("buffer-shims");function BufferList(){this.head=null,this.tail=null,this.length=0}(module.exports=BufferList).prototype.push=function(entry){entry={data:entry,next:null};0<this.length?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(entry){entry={data:entry,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return bufferShim.alloc(0);if(1===this.length)return this.head.data;for(var ret=bufferShim.allocUnsafe(n>>>0),p=this.head,i=0;p;)p.data.copy(ret,i),i+=p.data.length,p=p.next;return ret}},{buffer:3,"buffer-shims":18}],18:[function(require,module,exports){!function(global){"use strict";var buffer=require("buffer"),Buffer=buffer.Buffer,SlowBuffer=buffer.SlowBuffer,MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function(size,_fill,enc){if("function"==typeof Buffer.alloc)return Buffer.alloc(size,_fill,enc);if("number"==typeof enc)throw new TypeError("encoding must not be number");if("number"!=typeof size)throw new TypeError("size must be a number");if(MAX_LEN<size)throw new RangeError("size is too large");void 0===_fill&&(enc=void 0,_fill=0);var buf=new Buffer(size);if("string"==typeof _fill)for(var fillBuf=new Buffer(_fill,enc),flen=fillBuf.length,i=-1;++i<size;)buf[i]=fillBuf[i%flen];else buf.fill(_fill);return buf},exports.allocUnsafe=function(size){if("function"==typeof Buffer.allocUnsafe)return Buffer.allocUnsafe(size);if("number"!=typeof size)throw new TypeError("size must be a number");if(MAX_LEN<size)throw new RangeError("size is too large");return new Buffer(size)},exports.from=function(value,offset,length){if("function"==typeof Buffer.from&&(!global.Uint8Array||Uint8Array.from!==Buffer.from))return Buffer.from(value,offset,length);if("number"==typeof value)throw new TypeError('"value" argument must not be a number');if("string"==typeof value)return new Buffer(value,offset);if("undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer){offset=offset;if(1===arguments.length)return new Buffer(value);void 0===offset&&(offset=0);var out=length;if(void 0===out&&(out=value.byteLength-offset),offset>=value.byteLength)throw new RangeError("'offset' is out of bounds");if(out>value.byteLength-offset)throw new RangeError("'length' is out of bounds");return new Buffer(value.slice(offset,offset+out))}if(Buffer.isBuffer(value)){out=new Buffer(value.length);return value.copy(out,0,0,value.length),out}if(value){if(Array.isArray(value)||"undefined"!=typeof ArrayBuffer&&value.buffer instanceof ArrayBuffer||"length"in value)return new Buffer(value);if("Buffer"===value.type&&Array.isArray(value.data))return new Buffer(value.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},exports.allocUnsafeSlow=function(size){if("function"==typeof Buffer.allocUnsafeSlow)return Buffer.allocUnsafeSlow(size);if("number"!=typeof size)throw new TypeError("size must be a number");if(MAX_LEN<=size)throw new RangeError("size is too large");return new SlowBuffer(size)}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:3}],19:[function(require,module,exports){!function(Buffer){function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=function(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)},exports.isBoolean=function(arg){return"boolean"==typeof arg},exports.isNull=function(arg){return null===arg},exports.isNullOrUndefined=function(arg){return null==arg},exports.isNumber=function(arg){return"number"==typeof arg},exports.isString=function(arg){return"string"==typeof arg},exports.isSymbol=function(arg){return"symbol"==typeof arg},exports.isUndefined=function(arg){return void 0===arg},exports.isRegExp=function(re){return"[object RegExp]"===objectToString(re)},exports.isObject=function(arg){return"object"==typeof arg&&null!==arg},exports.isDate=function(d){return"[object Date]"===objectToString(d)},exports.isError=function(e){return"[object Error]"===objectToString(e)||e instanceof Error},exports.isFunction=function(arg){return"function"==typeof arg},exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=Buffer.isBuffer}.call(this,{isBuffer:require("../../../../insert-module-globals/node_modules/is-buffer/index.js")})},{"../../../../insert-module-globals/node_modules/is-buffer/index.js":9}],20:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{dup:6}],21:[function(require,module,exports){!function(process){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=function(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}:module.exports=process.nextTick}.call(this,require("_process"))},{_process:10}],22:[function(require,module,exports){!function(global){function config(val){try{if(!global.localStorage)return}catch(_){return}val=global.localStorage[val];return null!=val&&"true"===String(val).toLowerCase()}module.exports=function(fn,msg){if(config("noDeprecation"))return fn;var warned=!1;return function(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":13}],24:[function(require,module,exports){!function(process){var Stream=function(){try{return require("stream")}catch(_){}}();(exports=module.exports=require("./lib/_stream_readable.js")).Stream=Stream||exports,(exports.Readable=exports).Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js"),!process.browser&&"disable"===process.env.READABLE_STREAM&&Stream&&(module.exports=Stream)}.call(this,require("_process"))},{"./lib/_stream_duplex.js":12,"./lib/_stream_passthrough.js":13,"./lib/_stream_readable.js":14,"./lib/_stream_transform.js":15,"./lib/_stream_writable.js":16,_process:10}],25:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":15}],26:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":16}],27:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;function Stream(){EE.call(this)}require("inherits")(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),(Stream.Stream=Stream).prototype.pipe=function(dest,options){var source=this;function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:7,inherits:8,"readable-stream/duplex.js":11,"readable-stream/passthrough.js":23,"readable-stream/readable.js":24,"readable-stream/transform.js":25,"readable-stream/writable.js":26}],28:[function(require,module,StringDecoder){var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};StringDecoder=StringDecoder.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),function(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";if(buffer=buffer.slice(available,buffer.length),!(55296<=(charCode=(charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(charStr.length-1))&&charCode<=56319)){if((this.charReceived=this.charLength=0)===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived);var charCode,end=(charStr+=buffer.toString(this.encoding,0,end)).length-1;if(55296<=(charCode=charStr.charCodeAt(end))&&charCode<=56319){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=3<=buffer.length?3:buffer.length;0<i;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(enc){var cr,buf,res="";return enc&&enc.length&&(res=this.write(enc)),this.charReceived&&(cr=this.charReceived,buf=this.charBuffer,enc=this.encoding,res+=buf.slice(0,cr).toString(enc)),res}},{buffer:3}],29:[function(require,module,exports){function CollectingHandler(cbs){this._cbs=cbs||{},this.events=[]}module.exports=CollectingHandler;var EVENTS=require("./").EVENTS;Object.keys(EVENTS).forEach(function(name){if(0===EVENTS[name])name="on"+name,CollectingHandler.prototype[name]=function(){this.events.push([name]),this._cbs[name]&&this._cbs[name]()};else if(1===EVENTS[name])name="on"+name,CollectingHandler.prototype[name]=function(a){this.events.push([name,a]),this._cbs[name]&&this._cbs[name](a)};else{if(2!==EVENTS[name])throw Error("wrong number of arguments");name="on"+name,CollectingHandler.prototype[name]=function(a,b){this.events.push([name,a,b]),this._cbs[name]&&this._cbs[name](a,b)}}}),CollectingHandler.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},CollectingHandler.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var num,i=0,len=this.events.length;i<len;i++)this._cbs[this.events[i][0]]&&(1===(num=this.events[i].length)?this._cbs[this.events[i][0]]():2===num?this._cbs[this.events[i][0]](this.events[i][1]):this._cbs[this.events[i][0]](this.events[i][1],this.events[i][2]))}},{"./":36}],30:[function(require,module,exports){var index=require("./index.js"),DomHandler=index.DomHandler,DomUtils=index.DomUtils;function FeedHandler(callback,options){this.init(callback,options)}function getElements(what,where){return DomUtils.getElementsByTagName(what,where,!0)}function getOneElement(what,where){return DomUtils.getElementsByTagName(what,where,!0,1)[0]}function fetch(what,where,recurse){return DomUtils.getText(DomUtils.getElementsByTagName(what,where,recurse,1)).trim()}function addConditionally(obj,prop,what,where,tmp){tmp=fetch(what,where,tmp);tmp&&(obj[prop]=tmp)}require("inherits")(FeedHandler,DomHandler),FeedHandler.prototype.init=DomHandler;function isValidFeed(value){return"rss"===value||"feed"===value||"rdf:RDF"===value}FeedHandler.prototype.onend=function(){var tmp,childs,feed={},feedRoot=getOneElement(isValidFeed,this.dom);feedRoot&&("feed"===feedRoot.name?(childs=feedRoot.children,feed.type="atom",addConditionally(feed,"id","id",childs),addConditionally(feed,"title","title",childs),(tmp=getOneElement("link",childs))&&(tmp=tmp.attribs)&&(tmp=tmp.href)&&(feed.link=tmp),addConditionally(feed,"description","subtitle",childs),(tmp=fetch("updated",childs))&&(feed.updated=new Date(tmp)),addConditionally(feed,"author","email",childs,!0),feed.items=getElements("entry",childs).map(function(item){var tmp,entry={};return addConditionally(entry,"id","id",item=item.children),addConditionally(entry,"title","title",item),(tmp=getOneElement("link",item))&&(tmp=tmp.attribs)&&(tmp=tmp.href)&&(entry.link=tmp),(tmp=fetch("summary",item)||fetch("content",item))&&(entry.description=tmp),(tmp=fetch("updated",item))&&(entry.pubDate=new Date(tmp)),entry})):(childs=getOneElement("channel",feedRoot.children).children,feed.type=feedRoot.name.substr(0,3),feed.id="",addConditionally(feed,"title","title",childs),addConditionally(feed,"link","link",childs),addConditionally(feed,"description","description",childs),(tmp=fetch("lastBuildDate",childs))&&(feed.updated=new Date(tmp)),addConditionally(feed,"author","managingEditor",childs,!0),feed.items=getElements("item",feedRoot.children).map(function(tmp){var entry={};return addConditionally(entry,"id","guid",tmp=tmp.children),addConditionally(entry,"title","title",tmp),addConditionally(entry,"link","link",tmp),addConditionally(entry,"description","description",tmp),(tmp=fetch("pubDate",tmp))&&(entry.pubDate=new Date(tmp)),entry}))),this.dom=feed,DomHandler.prototype._handleCallback.call(this,feedRoot?null:Error("couldn't find root of feed"))},module.exports=FeedHandler},{"./index.js":36,inherits:58}],31:[function(require,module,exports){var Tokenizer=require("./Tokenizer.js"),formTags={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},openImpliesClose={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:formTags,input:formTags,output:formTags,button:formTags,datalist:formTags,textarea:formTags,option:{option:!0},optgroup:{optgroup:!0}},voidElements={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},re_nameEnd=/\s|\//;function Parser(cbs,options){this._options=options||{},this._cbs=cbs||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(Tokenizer=this._options.Tokenizer),this._tokenizer=new Tokenizer(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}require("inherits")(Parser,require("events").EventEmitter),Parser.prototype._updatePosition=function(initialOffset){null===this.endIndex?this._tokenizer._sectionStart<=initialOffset?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-initialOffset:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},Parser.prototype.ontext=function(data){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(data)},Parser.prototype.onopentagname=function(name){if(this._lowerCaseTagNames&&(name=name.toLowerCase()),this._tagname=name,!this._options.xmlMode&&name in openImpliesClose)for(var el;(el=this._stack[this._stack.length-1])in openImpliesClose[name];this.onclosetag(el));!this._options.xmlMode&&name in voidElements||this._stack.push(name),this._cbs.onopentagname&&this._cbs.onopentagname(name),this._cbs.onopentag&&(this._attribs={})},Parser.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in voidElements&&this._cbs.onclosetag(this._tagname),this._tagname=""},Parser.prototype.onclosetag=function(name){if(this._updatePosition(1),this._lowerCaseTagNames&&(name=name.toLowerCase()),!this._stack.length||name in voidElements&&!this._options.xmlMode)this._options.xmlMode||"br"!==name&&"p"!==name||(this.onopentagname(name),this._closeCurrentTag());else{var pos=this._stack.lastIndexOf(name);if(-1!==pos)if(this._cbs.onclosetag)for(pos=this._stack.length-pos;pos--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=pos;else"p"!==name||this._options.xmlMode||(this.onopentagname(name),this._closeCurrentTag())}},Parser.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},Parser.prototype._closeCurrentTag=function(){var name=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===name&&(this._cbs.onclosetag&&this._cbs.onclosetag(name),this._stack.pop())},Parser.prototype.onattribname=function(name){this._lowerCaseAttributeNames&&(name=name.toLowerCase()),this._attribname=name},Parser.prototype.onattribdata=function(value){this._attribvalue+=value},Parser.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},Parser.prototype._getInstructionName=function(value){var name=value.search(re_nameEnd),name=name<0?value:value.substr(0,name);return name=this._lowerCaseTagNames?name.toLowerCase():name},Parser.prototype.ondeclaration=function(value){var name;this._cbs.onprocessinginstruction&&(name=this._getInstructionName(value),this._cbs.onprocessinginstruction("!"+name,"!"+value))},Parser.prototype.onprocessinginstruction=function(value){var name;this._cbs.onprocessinginstruction&&(name=this._getInstructionName(value),this._cbs.onprocessinginstruction("?"+name,"?"+value))},Parser.prototype.oncomment=function(value){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(value),this._cbs.oncommentend&&this._cbs.oncommentend()},Parser.prototype.oncdata=function(value){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(value),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+value+"]]")},Parser.prototype.onerror=function(err){this._cbs.onerror&&this._cbs.onerror(err)},Parser.prototype.onend=function(){if(this._cbs.onclosetag)for(var i=this._stack.length;0<i;this._cbs.onclosetag(this._stack[--i]));this._cbs.onend&&this._cbs.onend()},Parser.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},Parser.prototype.parseComplete=function(data){this.reset(),this.end(data)},Parser.prototype.write=function(chunk){this._tokenizer.write(chunk)},Parser.prototype.end=function(chunk){this._tokenizer.end(chunk)},Parser.prototype.pause=function(){this._tokenizer.pause()},Parser.prototype.resume=function(){this._tokenizer.resume()},Parser.prototype.parseChunk=Parser.prototype.write,Parser.prototype.done=Parser.prototype.end,module.exports=Parser},{"./Tokenizer.js":34,events:7,inherits:58}],32:[function(require,module,exports){function ProxyHandler(cbs){this._cbs=cbs||{}}module.exports=ProxyHandler;var EVENTS=require("./").EVENTS;Object.keys(EVENTS).forEach(function(name){if(0===EVENTS[name])name="on"+name,ProxyHandler.prototype[name]=function(){this._cbs[name]&&this._cbs[name]()};else if(1===EVENTS[name])name="on"+name,ProxyHandler.prototype[name]=function(a){this._cbs[name]&&this._cbs[name](a)};else{if(2!==EVENTS[name])throw Error("wrong number of arguments");name="on"+name,ProxyHandler.prototype[name]=function(a,b){this._cbs[name]&&this._cbs[name](a,b)}}})},{"./":36}],33:[function(require,module,exports){module.exports=Stream;var Parser=require("./WritableStream.js");function Stream(options){Parser.call(this,new Cbs(this),options)}function Cbs(scope){this.scope=scope}require("inherits")(Stream,Parser),Stream.prototype.readable=!0;var EVENTS=require("../").EVENTS;Object.keys(EVENTS).forEach(function(name){if(0===EVENTS[name])Cbs.prototype["on"+name]=function(){this.scope.emit(name)};else if(1===EVENTS[name])Cbs.prototype["on"+name]=function(a){this.scope.emit(name,a)};else{if(2!==EVENTS[name])throw Error("wrong number of arguments!");Cbs.prototype["on"+name]=function(a,b){this.scope.emit(name,a,b)}}})},{"../":36,"./WritableStream.js":35,inherits:58}],34:[function(j,module,exports){module.exports=Tokenizer;var char,SUCCESS,decodeCodePoint=j("entities/lib/decode_codepoint.js"),entityMap=j("entities/maps/entities.json"),legacyMap=j("entities/maps/legacy.json"),xmlMap=j("entities/maps/xml.json"),j=0,TEXT=j++,j=(j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,j++,0),SPECIAL_NONE=j++;j++;function whitespace(c){return" "===c||"\n"===c||"\t"===c||"\f"===c||"\r"===c}function ifElseState(upper,SUCCESS,FAILURE){var lower=upper.toLowerCase();return upper===lower?function(c){c===lower?this._state=SUCCESS:(this._state=FAILURE,this._index--)}:function(c){c===lower||c===upper?this._state=SUCCESS:(this._state=FAILURE,this._index--)}}function consumeSpecialNameChar(upper,NEXT_STATE){var lower=upper.toLowerCase();return function(c){c===lower||c===upper?this._state=NEXT_STATE:(this._state=2,this._index--)}}function Tokenizer(options,cbs){this._state=TEXT,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=TEXT,this._special=SPECIAL_NONE,this._cbs=cbs,this._running=!0,this._ended=!1,this._xmlMode=!(!options||!options.xmlMode),this._decodeEntities=!(!options||!options.decodeEntities)}Tokenizer.prototype._stateText=function(c){"<"===c?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=1,this._sectionStart=this._index):this._decodeEntities&&this._special===SPECIAL_NONE&&"&"===c&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=TEXT,this._state=50,this._sectionStart=this._index)},Tokenizer.prototype._stateBeforeTagName=function(c){"/"===c?this._state=4:"<"===c?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===c||this._special!==SPECIAL_NONE||whitespace(c)?this._state=TEXT:"!"===c?(this._state=14,this._sectionStart=this._index+1):"?"===c?(this._state=16,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==c&&"S"!==c?2:30,this._sectionStart=this._index)},Tokenizer.prototype._stateInTagName=function(c){"/"!==c&&">"!==c&&!whitespace(c)||(this._emitToken("onopentagname"),this._state=7,this._index--)},Tokenizer.prototype._stateBeforeCloseingTagName=function(c){whitespace(c)||(">"===c?this._state=TEXT:this._special!==SPECIAL_NONE?"s"===c||"S"===c?this._state=31:(this._state=TEXT,this._index--):(this._state=5,this._sectionStart=this._index))},Tokenizer.prototype._stateInCloseingTagName=function(c){">"!==c&&!whitespace(c)||(this._emitToken("onclosetag"),this._state=6,this._index--)},Tokenizer.prototype._stateAfterCloseingTagName=function(c){">"===c&&(this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer.prototype._stateBeforeAttributeName=function(c){">"===c?(this._cbs.onopentagend(),this._state=TEXT,this._sectionStart=this._index+1):"/"===c?this._state=3:whitespace(c)||(this._state=8,this._sectionStart=this._index)},Tokenizer.prototype._stateInSelfClosingTag=function(c){">"===c?(this._cbs.onselfclosingtag(),this._state=TEXT,this._sectionStart=this._index+1):whitespace(c)||(this._state=7,this._index--)},Tokenizer.prototype._stateInAttributeName=function(c){"="!==c&&"/"!==c&&">"!==c&&!whitespace(c)||(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=9,this._index--)},Tokenizer.prototype._stateAfterAttributeName=function(c){"="===c?this._state=10:"/"===c||">"===c?(this._cbs.onattribend(),this._state=7,this._index--):whitespace(c)||(this._cbs.onattribend(),this._state=8,this._sectionStart=this._index)},Tokenizer.prototype._stateBeforeAttributeValue=function(c){'"'===c?(this._state=11,this._sectionStart=this._index+1):"'"===c?(this._state=12,this._sectionStart=this._index+1):whitespace(c)||(this._state=13,this._sectionStart=this._index,this._index--)},Tokenizer.prototype._stateInAttributeValueDoubleQuotes=function(c){'"'===c?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7):this._decodeEntities&&"&"===c&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},Tokenizer.prototype._stateInAttributeValueSingleQuotes=function(c){"'"===c?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7):this._decodeEntities&&"&"===c&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},Tokenizer.prototype._stateInAttributeValueNoQuotes=function(c){whitespace(c)||">"===c?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7,this._index--):this._decodeEntities&&"&"===c&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},Tokenizer.prototype._stateBeforeDeclaration=function(c){this._state="["===c?21:"-"===c?17:15},Tokenizer.prototype._stateInDeclaration=function(c){">"===c&&(this._cbs.ondeclaration(this._getSection()),this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer.prototype._stateInProcessingInstruction=function(c){">"===c&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer.prototype._stateBeforeComment=function(c){"-"===c?(this._state=18,this._sectionStart=this._index+1):this._state=15},Tokenizer.prototype._stateInComment=function(c){"-"===c&&(this._state=19)},Tokenizer.prototype._stateAfterComment1=function(c){this._state="-"===c?20:18},Tokenizer.prototype._stateAfterComment2=function(c){">"===c?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):"-"!==c&&(this._state=18)},Tokenizer.prototype._stateBeforeCdata1=ifElseState("C",22,15),Tokenizer.prototype._stateBeforeCdata2=ifElseState("D",23,15),Tokenizer.prototype._stateBeforeCdata3=ifElseState("A",24,15),Tokenizer.prototype._stateBeforeCdata4=ifElseState("T",25,15),Tokenizer.prototype._stateBeforeCdata5=ifElseState("A",26,15),Tokenizer.prototype._stateBeforeCdata6=function(c){"["===c?(this._state=27,this._sectionStart=this._index+1):(this._state=15,this._index--)},Tokenizer.prototype._stateInCdata=function(c){"]"===c&&(this._state=28)},Tokenizer.prototype._stateAfterCdata1=(char="]",SUCCESS=29,function(c){c===char&&(this._state=SUCCESS)}),Tokenizer.prototype._stateAfterCdata2=function(c){">"===c?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):"]"!==c&&(this._state=27)},Tokenizer.prototype._stateBeforeSpecial=function(c){"c"===c||"C"===c?this._state=32:"t"===c||"T"===c?this._state=42:(this._state=2,this._index--)},Tokenizer.prototype._stateBeforeSpecialEnd=function(c){1!==this._special||"c"!==c&&"C"!==c?2!==this._special||"t"!==c&&"T"!==c?this._state=TEXT:this._state=46:this._state=37},Tokenizer.prototype._stateBeforeScript1=consumeSpecialNameChar("R",33),Tokenizer.prototype._stateBeforeScript2=consumeSpecialNameChar("I",34),Tokenizer.prototype._stateBeforeScript3=consumeSpecialNameChar("P",35),Tokenizer.prototype._stateBeforeScript4=consumeSpecialNameChar("T",36),Tokenizer.prototype._stateBeforeScript5=function(c){"/"!==c&&">"!==c&&!whitespace(c)||(this._special=1),this._state=2,this._index--},Tokenizer.prototype._stateAfterScript1=ifElseState("R",38,TEXT),Tokenizer.prototype._stateAfterScript2=ifElseState("I",39,TEXT),Tokenizer.prototype._stateAfterScript3=ifElseState("P",40,TEXT),Tokenizer.prototype._stateAfterScript4=ifElseState("T",41,TEXT),Tokenizer.prototype._stateAfterScript5=function(c){">"===c||whitespace(c)?(this._special=SPECIAL_NONE,this._state=5,this._sectionStart=this._index-6,this._index--):this._state=TEXT},Tokenizer.prototype._stateBeforeStyle1=consumeSpecialNameChar("Y",43),Tokenizer.prototype._stateBeforeStyle2=consumeSpecialNameChar("L",44),Tokenizer.prototype._stateBeforeStyle3=consumeSpecialNameChar("E",45),Tokenizer.prototype._stateBeforeStyle4=function(c){"/"!==c&&">"!==c&&!whitespace(c)||(this._special=2),this._state=2,this._index--},Tokenizer.prototype._stateAfterStyle1=ifElseState("Y",47,TEXT),Tokenizer.prototype._stateAfterStyle2=ifElseState("L",48,TEXT),Tokenizer.prototype._stateAfterStyle3=ifElseState("E",49,TEXT),Tokenizer.prototype._stateAfterStyle4=function(c){">"===c||whitespace(c)?(this._special=SPECIAL_NONE,this._state=5,this._sectionStart=this._index-5,this._index--):this._state=TEXT},Tokenizer.prototype._stateBeforeEntity=ifElseState("#",51,52),Tokenizer.prototype._stateBeforeNumericEntity=ifElseState("X",54,53),Tokenizer.prototype._parseNamedEntityStrict=function(){var entity,map;this._sectionStart+1<this._index&&(entity=this._buffer.substring(this._sectionStart+1,this._index),(map=this._xmlMode?xmlMap:entityMap).hasOwnProperty(entity)&&(this._emitPartial(map[entity]),this._sectionStart=this._index+1))},Tokenizer.prototype._parseLegacyEntity=function(){var start=this._sectionStart+1,limit=this._index-start;for(6<limit&&(limit=6);2<=limit;){var entity=this._buffer.substr(start,limit);if(legacyMap.hasOwnProperty(entity))return this._emitPartial(legacyMap[entity]),void(this._sectionStart+=limit+1);limit--}},Tokenizer.prototype._stateInNamedEntity=function(c){";"===c?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(c<"a"||"z"<c)&&(c<"A"||"Z"<c)&&(c<"0"||"9"<c)&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==TEXT?"="!==c&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},Tokenizer.prototype._decodeNumericEntity=function(entity,parsed){entity=this._sectionStart+entity;entity!==this._index?(entity=this._buffer.substring(entity,this._index),parsed=parseInt(entity,parsed),this._emitPartial(decodeCodePoint(parsed)),this._sectionStart=this._index):this._sectionStart--,this._state=this._baseState},Tokenizer.prototype._stateInNumericEntity=function(c){";"===c?(this._decodeNumericEntity(2,10),this._sectionStart++):(c<"0"||"9"<c)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},Tokenizer.prototype._stateInHexEntity=function(c){";"===c?(this._decodeNumericEntity(3,16),this._sectionStart++):(c<"a"||"f"<c)&&(c<"A"||"F"<c)&&(c<"0"||"9"<c)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},Tokenizer.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._index=0,this._bufferOffset+=this._index):this._running&&(this._state===TEXT?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},Tokenizer.prototype.write=function(chunk){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=chunk,this._parse()},Tokenizer.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var c=this._buffer.charAt(this._index);this._state===TEXT?this._stateText(c):1===this._state?this._stateBeforeTagName(c):2===this._state?this._stateInTagName(c):4===this._state?this._stateBeforeCloseingTagName(c):5===this._state?this._stateInCloseingTagName(c):6===this._state?this._stateAfterCloseingTagName(c):3===this._state?this._stateInSelfClosingTag(c):7===this._state?this._stateBeforeAttributeName(c):8===this._state?this._stateInAttributeName(c):9===this._state?this._stateAfterAttributeName(c):10===this._state?this._stateBeforeAttributeValue(c):11===this._state?this._stateInAttributeValueDoubleQuotes(c):12===this._state?this._stateInAttributeValueSingleQuotes(c):13===this._state?this._stateInAttributeValueNoQuotes(c):14===this._state?this._stateBeforeDeclaration(c):15===this._state?this._stateInDeclaration(c):16===this._state?this._stateInProcessingInstruction(c):17===this._state?this._stateBeforeComment(c):18===this._state?this._stateInComment(c):19===this._state?this._stateAfterComment1(c):20===this._state?this._stateAfterComment2(c):21===this._state?this._stateBeforeCdata1(c):22===this._state?this._stateBeforeCdata2(c):23===this._state?this._stateBeforeCdata3(c):24===this._state?this._stateBeforeCdata4(c):25===this._state?this._stateBeforeCdata5(c):26===this._state?this._stateBeforeCdata6(c):27===this._state?this._stateInCdata(c):28===this._state?this._stateAfterCdata1(c):29===this._state?this._stateAfterCdata2(c):30===this._state?this._stateBeforeSpecial(c):31===this._state?this._stateBeforeSpecialEnd(c):32===this._state?this._stateBeforeScript1(c):33===this._state?this._stateBeforeScript2(c):34===this._state?this._stateBeforeScript3(c):35===this._state?this._stateBeforeScript4(c):36===this._state?this._stateBeforeScript5(c):37===this._state?this._stateAfterScript1(c):38===this._state?this._stateAfterScript2(c):39===this._state?this._stateAfterScript3(c):40===this._state?this._stateAfterScript4(c):41===this._state?this._stateAfterScript5(c):42===this._state?this._stateBeforeStyle1(c):43===this._state?this._stateBeforeStyle2(c):44===this._state?this._stateBeforeStyle3(c):45===this._state?this._stateBeforeStyle4(c):46===this._state?this._stateAfterStyle1(c):47===this._state?this._stateAfterStyle2(c):48===this._state?this._stateAfterStyle3(c):49===this._state?this._stateAfterStyle4(c):50===this._state?this._stateBeforeEntity(c):51===this._state?this._stateBeforeNumericEntity(c):52===this._state?this._stateInNamedEntity(c):53===this._state?this._stateInNumericEntity(c):54===this._state?this._stateInHexEntity(c):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},Tokenizer.prototype.pause=function(){this._running=!1},Tokenizer.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},Tokenizer.prototype.end=function(chunk){this._ended&&this._cbs.onerror(Error(".end() after done!")),chunk&&this.write(chunk),this._ended=!0,this._running&&this._finish()},Tokenizer.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},Tokenizer.prototype._handleTrailingData=function(){var data=this._buffer.substr(this._sectionStart);27===this._state||28===this._state||29===this._state?this._cbs.oncdata(data):18===this._state||19===this._state||20===this._state?this._cbs.oncomment(data):52!==this._state||this._xmlMode?53!==this._state||this._xmlMode?54!==this._state||this._xmlMode?2!==this._state&&7!==this._state&&10!==this._state&&9!==this._state&&8!==this._state&&12!==this._state&&11!==this._state&&13!==this._state&&5!==this._state&&this._cbs.ontext(data):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},Tokenizer.prototype.reset=function(){Tokenizer.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},Tokenizer.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},Tokenizer.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},Tokenizer.prototype._emitToken=function(name){this._cbs[name](this._getSection()),this._sectionStart=-1},Tokenizer.prototype._emitPartial=function(value){this._baseState!==TEXT?this._cbs.onattribdata(value):this._cbs.ontext(value)}},{"entities/lib/decode_codepoint.js":52,"entities/maps/entities.json":55,"entities/maps/legacy.json":56,"entities/maps/xml.json":57}],35:[function(require,module,exports){module.exports=Stream;var Parser=require("./Parser.js"),WritableStream=require("stream").Writable||require("readable-stream").Writable,StringDecoder=require("string_decoder").StringDecoder,Buffer=require("buffer").Buffer;function Stream(cbs,options){var parser=this._parser=new Parser(cbs,options),decoder=this._decoder=new StringDecoder;WritableStream.call(this,{decodeStrings:!1}),this.once("finish",function(){parser.end(decoder.end())})}require("inherits")(Stream,WritableStream),WritableStream.prototype._write=function(chunk,encoding,cb){chunk instanceof Buffer&&(chunk=this._decoder.write(chunk)),this._parser.write(chunk),cb()}},{"./Parser.js":31,buffer:3,inherits:58,"readable-stream":2,stream:27,string_decoder:28}],36:[function(require,module,exports){var Parser=require("./Parser.js"),DomHandler=require("domhandler");function defineProp(name,value){return delete module.exports[name],module.exports[name]=value}module.exports={Parser:Parser,Tokenizer:require("./Tokenizer.js"),ElementType:require("domelementtype"),DomHandler:DomHandler,get FeedHandler(){return defineProp("FeedHandler",require("./FeedHandler.js"))},get Stream(){return defineProp("Stream",require("./Stream.js"))},get WritableStream(){return defineProp("WritableStream",require("./WritableStream.js"))},get ProxyHandler(){return defineProp("ProxyHandler",require("./ProxyHandler.js"))},get DomUtils(){return defineProp("DomUtils",require("domutils"))},get CollectingHandler(){return defineProp("CollectingHandler",require("./CollectingHandler.js"))},DefaultHandler:DomHandler,get RssHandler(){return defineProp("RssHandler",this.FeedHandler)},parseDOM:function(data,options){var handler=new DomHandler(options);return new Parser(handler,options).end(data),handler.dom},parseFeed:function(feed,options){var handler=new module.exports.FeedHandler(options);return new Parser(handler,options).end(feed),handler.dom},createDomStream:function(cb,options,handler){handler=new DomHandler(cb,options,handler);return new Parser(handler,options)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":29,"./FeedHandler.js":30,"./Parser.js":31,"./ProxyHandler.js":32,"./Stream.js":33,"./Tokenizer.js":34,"./WritableStream.js":35,domelementtype:37,domhandler:38,domutils:41}],37:[function(require,module,exports){module.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(elem){return"tag"===elem.type||"script"===elem.type||"style"===elem.type}}},{}],38:[function(require,module,exports){var ElementType=require("domelementtype"),re_whitespace=/\s+/g,NodePrototype=require("./lib/node"),ElementPrototype=require("./lib/element");function DomHandler(callback,options,elementCB){"object"==typeof callback?(elementCB=options,options=callback,callback=null):"function"==typeof options&&(elementCB=options,options=defaultOpts),this._callback=callback,this._options=options||defaultOpts,this._elementCB=elementCB,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var defaultOpts={normalizeWhitespace:!1,withStartIndices:!1};DomHandler.prototype.onparserinit=function(parser){this._parser=parser},DomHandler.prototype.onreset=function(){DomHandler.call(this,this._callback,this._options,this._elementCB)},DomHandler.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},DomHandler.prototype._handleCallback=DomHandler.prototype.onerror=function(error){if("function"==typeof this._callback)this._callback(error,this.dom);else if(error)throw error},DomHandler.prototype.onclosetag=function(){var elem=this._tagStack.pop();this._elementCB&&this._elementCB(elem)},DomHandler.prototype._addDomElement=function(element){var parent=this._tagStack[this._tagStack.length-1],siblings=parent?parent.children:this.dom,previousSibling=siblings[siblings.length-1];element.next=null,this._options.withStartIndices&&(element.startIndex=this._parser.startIndex),this._options.withDomLvl1&&(element.__proto__="tag"===element.type?ElementPrototype:NodePrototype),previousSibling?(element.prev=previousSibling).next=element:element.prev=null,siblings.push(element),element.parent=parent||null},DomHandler.prototype.onopentag=function(name,element){element={type:"script"===name?ElementType.Script:"style"===name?ElementType.Style:ElementType.Tag,name:name,attribs:element,children:[]};this._addDomElement(element),this._tagStack.push(element)},DomHandler.prototype.ontext=function(data){var lastTag,normalize=this._options.normalizeWhitespace||this._options.ignoreWhitespace;!this._tagStack.length&&this.dom.length&&(lastTag=this.dom[this.dom.length-1]).type===ElementType.Text||this._tagStack.length&&(lastTag=this._tagStack[this._tagStack.length-1])&&(lastTag=lastTag.children[lastTag.children.length-1])&&lastTag.type===ElementType.Text?normalize?lastTag.data=(lastTag.data+data).replace(re_whitespace," "):lastTag.data+=data:(normalize&&(data=data.replace(re_whitespace," ")),this._addDomElement({data:data,type:ElementType.Text}))},DomHandler.prototype.oncomment=function(element){var lastTag=this._tagStack[this._tagStack.length-1];lastTag&&lastTag.type===ElementType.Comment?lastTag.data+=element:(element={data:element,type:ElementType.Comment},this._addDomElement(element),this._tagStack.push(element))},DomHandler.prototype.oncdatastart=function(){var element={children:[{data:"",type:ElementType.Text}],type:ElementType.CDATA};this._addDomElement(element),this._tagStack.push(element)},DomHandler.prototype.oncommentend=DomHandler.prototype.oncdataend=function(){this._tagStack.pop()},DomHandler.prototype.onprocessinginstruction=function(name,data){this._addDomElement({name:name,data:data,type:ElementType.Directive})},module.exports=DomHandler},{"./lib/element":39,"./lib/node":40,domelementtype:37}],39:[function(NodePrototype,module,exports){var NodePrototype=NodePrototype("./node"),ElementPrototype=module.exports=Object.create(NodePrototype),domLvl1={tagName:"name"};Object.keys(domLvl1).forEach(function(key){var shorthand=domLvl1[key];Object.defineProperty(ElementPrototype,key,{get:function(){return this[shorthand]||null},set:function(val){return this[shorthand]=val}})})},{"./node":40}],40:[function(require,module,exports){var NodePrototype=module.exports={get firstChild(){var children=this.children;return children&&children[0]||null},get lastChild(){var children=this.children;return children&&children[children.length-1]||null},get nodeType(){return nodeTypes[this.type]||nodeTypes.element}},domLvl1={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},nodeTypes={element:1,text:3,cdata:4,comment:8};Object.keys(domLvl1).forEach(function(key){var shorthand=domLvl1[key];Object.defineProperty(NodePrototype,key,{get:function(){return this[shorthand]||null},set:function(val){return this[shorthand]=val}})})},{}],41:[function(require,module,exports){var DomUtils=module.exports;[require("./lib/stringify"),require("./lib/traversal"),require("./lib/manipulation"),require("./lib/querying"),require("./lib/legacy"),require("./lib/helpers")].forEach(function(ext){Object.keys(ext).forEach(function(key){DomUtils[key]=ext[key].bind(DomUtils)})})},{"./lib/helpers":42,"./lib/legacy":43,"./lib/manipulation":44,"./lib/querying":45,"./lib/stringify":46,"./lib/traversal":47}],42:[function(require,module,exports){exports.removeSubsets=function(nodes){for(var node,ancestor,replace,idx=nodes.length;-1<--idx;){for(node=ancestor=nodes[idx],replace=!(nodes[idx]=null);ancestor;){if(-1<nodes.indexOf(ancestor)){replace=!1,nodes.splice(idx,1);break}ancestor=ancestor.parent}replace&&(nodes[idx]=node)}return nodes};var POSITION_DISCONNECTED=1,POSITION_PRECEDING=2,POSITION_FOLLOWING=4,POSITION_CONTAINS=8,POSITION_CONTAINED_BY=16,comparePos=exports.compareDocumentPosition=function(nodeA,nodeB){var current,sharedParent,siblings,aSibling,bSibling,idx,aParents=[],bParents=[];if(nodeA===nodeB)return 0;for(current=nodeA;current;)aParents.unshift(current),current=current.parent;for(current=nodeB;current;)bParents.unshift(current),current=current.parent;for(idx=0;aParents[idx]===bParents[idx];)idx++;return 0===idx?POSITION_DISCONNECTED:(siblings=(sharedParent=aParents[idx-1]).children,aSibling=aParents[idx],bSibling=bParents[idx],siblings.indexOf(aSibling)>siblings.indexOf(bSibling)?sharedParent===nodeB?POSITION_FOLLOWING|POSITION_CONTAINED_BY:POSITION_FOLLOWING:sharedParent===nodeA?POSITION_PRECEDING|POSITION_CONTAINS:POSITION_PRECEDING)};exports.uniqueSort=function(nodes){var position,idx=nodes.length;for(nodes=nodes.slice();-1<--idx;)position=nodes[idx],-1<(position=nodes.indexOf(position))&&position<idx&&nodes.splice(idx,1);return nodes.sort(function(a,relative){relative=comparePos(a,relative);return relative&POSITION_PRECEDING?-1:relative&POSITION_FOLLOWING?1:0}),nodes}},{}],43:[function(ElementType,module,exports){var ElementType=ElementType("domelementtype"),isTag=exports.isTag=ElementType.isTag;exports.testElement=function(options,element){for(var key in options)if(options.hasOwnProperty(key)){if("tag_name"===key){if(!isTag(element)||!options.tag_name(element.name))return!1}else if("tag_type"===key){if(!options.tag_type(element.type))return!1}else if("tag_contains"===key){if(isTag(element)||!options.tag_contains(element.data))return!1}else if(!element.attribs||!options[key](element.attribs[key]))return!1}else;return!0};var Checks={tag_name:function(name){return"function"==typeof name?function(elem){return isTag(elem)&&name(elem.name)}:"*"===name?isTag:function(elem){return isTag(elem)&&elem.name===name}},tag_type:function(type){return"function"==typeof type?function(elem){return type(elem.type)}:function(elem){return elem.type===type}},tag_contains:function(data){return"function"==typeof data?function(elem){return!isTag(elem)&&data(elem.data)}:function(elem){return!isTag(elem)&&elem.data===data}}};function getAttribCheck(attrib,value){return"function"==typeof value?function(elem){return elem.attribs&&value(elem.attribs[attrib])}:function(elem){return elem.attribs&&elem.attribs[attrib]===value}}function combineFuncs(a,b){return function(elem){return a(elem)||b(elem)}}exports.getElements=function(options,element,recurse,limit){var funcs=Object.keys(options).map(function(key){var value=options[key];return key in Checks?Checks[key](value):getAttribCheck(key,value)});return 0===funcs.length?[]:this.filter(funcs.reduce(combineFuncs),element,recurse,limit)},exports.getElementById=function(id,element,recurse){return Array.isArray(element)||(element=[element]),this.findOne(getAttribCheck("id",id),element,!1!==recurse)},exports.getElementsByTagName=function(name,element,recurse,limit){return this.filter(Checks.tag_name(name),element,recurse,limit)},exports.getElementsByTagType=function(type,element,recurse,limit){return this.filter(Checks.tag_type(type),element,recurse,limit)}},{domelementtype:37}],44:[function(require,module,exports){exports.removeElement=function(elem){var childs;elem.prev&&(elem.prev.next=elem.next),elem.next&&(elem.next.prev=elem.prev),elem.parent&&(childs=elem.parent.children).splice(childs.lastIndexOf(elem),1)},exports.replaceElement=function(elem,replacement){var childs=replacement.prev=elem.prev;childs&&(childs.next=replacement);childs=replacement.next=elem.next;childs&&(childs.prev=replacement);childs=replacement.parent=elem.parent;childs&&((childs=childs.children)[childs.lastIndexOf(elem)]=replacement)},exports.appendChild=function(sibling,child){1!==(child.parent=sibling).children.push(child)&&(((sibling=sibling.children[sibling.children.length-2]).next=child).prev=sibling,child.next=null)},exports.append=function(childs,next){var parent=childs.parent,currNext=childs.next;next.next=currNext,((next.prev=childs).next=next).parent=parent,currNext?(currNext.prev=next,parent&&(childs=parent.children).splice(childs.lastIndexOf(currNext),0,next)):parent&&parent.children.push(next)},exports.prepend=function(elem,prev){var childs,parent=elem.parent;parent&&(childs=parent.children).splice(childs.lastIndexOf(elem),0,prev),elem.prev&&(elem.prev.next=prev),prev.parent=parent,prev.prev=elem.prev,(prev.next=elem).prev=prev}},{}],45:[function(require,module,exports){var isTag=require("domelementtype").isTag;function find(test,elems,recurse,limit){for(var childs,result=[],i=0,j=elems.length;i<j&&!(test(elems[i])&&(result.push(elems[i]),--limit<=0))&&(childs=elems[i].children,!(recurse&&childs&&0<childs.length&&(childs=find(test,childs,recurse,limit),result=result.concat(childs),(limit-=childs.length)<=0)));i++);return result}module.exports={filter:function(test,element,recurse,limit){Array.isArray(element)||(element=[element]);"number"==typeof limit&&isFinite(limit)||(limit=1/0);return find(test,element,!1!==recurse,limit)},find:find,findOneChild:function(test,elems){for(var i=0,l=elems.length;i<l;i++)if(test(elems[i]))return elems[i];return null},findOne:function findOne(test,elems){var elem=null;for(var i=0,l=elems.length;i<l&&!elem;i++)isTag(elems[i])&&(test(elems[i])?elem=elems[i]:0<elems[i].children.length&&(elem=findOne(test,elems[i].children)));return elem},existsOne:function existsOne(test,elems){for(var i=0,l=elems.length;i<l;i++)if(isTag(elems[i])&&(test(elems[i])||0<elems[i].children.length&&existsOne(test,elems[i].children)))return!0;return!1},findAll:function findAll(test,elems){var result=[];for(var i=0,j=elems.length;i<j;i++)isTag(elems[i])&&(test(elems[i])&&result.push(elems[i]),0<elems[i].children.length&&(result=result.concat(findAll(test,elems[i].children))));return result}}},{domelementtype:37}],46:[function(require,module,exports){var ElementType=require("domelementtype"),getOuterHTML=require("dom-serializer"),isTag=ElementType.isTag;module.exports={getInnerHTML:function(elem,opts){return elem.children?elem.children.map(function(elem){return getOuterHTML(elem,opts)}).join(""):""},getOuterHTML:getOuterHTML,getText:function getText(elem){if(Array.isArray(elem))return elem.map(getText).join("");if(isTag(elem)||elem.type===ElementType.CDATA)return getText(elem.children);if(elem.type===ElementType.Text)return elem.data;return""}}},{"dom-serializer":48,domelementtype:37}],47:[function(require,module,exports){var getChildren=exports.getChildren=function(elem){return elem.children},getParent=exports.getParent=function(elem){return elem.parent};exports.getSiblings=function(elem){var parent=getParent(elem);return parent?getChildren(parent):[elem]},exports.getAttributeValue=function(elem,name){return elem.attribs&&elem.attribs[name]},exports.hasAttrib=function(elem,name){return!!elem.attribs&&hasOwnProperty.call(elem.attribs,name)},exports.getName=function(elem){return elem.name}},{}],48:[function(require,module,exports){var ElementType=require("domelementtype"),entities=require("entities"),booleanAttributes={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},unencodedElements={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};var singleTag={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},render=module.exports=function(dom,opts){Array.isArray(dom)||dom.cheerio||(dom=[dom]),opts=opts||{};for(var output="",i=0;i<dom.length;i++){var elem=dom[i];"root"===elem.type?output+=render(elem.children,opts):ElementType.isTag(elem)?output+=function(elem,opts){"svg"===elem.name&&(opts={decodeEntities:opts.decodeEntities,xmlMode:!0});var tag="<"+elem.name,attribs=function(attributes,opts){if(attributes){var value,key,output="";for(key in attributes)output&&(output+=" "),!(value=attributes[key])&&booleanAttributes[key]?output+=key:output+=key+'="'+(opts.decodeEntities?entities.encodeXML(value):value)+'"';return output}}(elem.attribs,opts);attribs&&(tag+=" "+attribs);!opts.xmlMode||elem.children&&0!==elem.children.length?(tag+=">",elem.children&&(tag+=render(elem.children,opts)),singleTag[elem.name]&&!opts.xmlMode||(tag+="</"+elem.name+">")):tag+="/>";return tag}(elem,opts):elem.type===ElementType.Directive?output+="<"+elem.data+">":elem.type===ElementType.Comment?output+="\x3c!--"+elem.data+"--\x3e":elem.type===ElementType.CDATA?output+="<![CDATA["+elem.children[0].data+"]]>":output+=function(elem,opts){var data=elem.data||"";!opts.decodeEntities||elem.parent&&elem.parent.name in unencodedElements||(data=entities.encodeXML(data));return data}(elem,opts)}return output}},{domelementtype:49,entities:50}],49:[function(require,module,exports){module.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",isTag:function(elem){return"tag"===elem.type||"script"===elem.type||"style"===elem.type}}},{}],50:[function(require,module,exports){var encode=require("./lib/encode.js"),decode=require("./lib/decode.js");exports.decode=function(data,level){return(!level||level<=0?decode.XML:decode.HTML)(data)},exports.decodeStrict=function(data,level){return(!level||level<=0?decode.XML:decode.HTMLStrict)(data)},exports.encode=function(data,level){return(!level||level<=0?encode.XML:encode.HTML)(data)},exports.encodeXML=encode.XML,exports.encodeHTML4=exports.encodeHTML5=exports.encodeHTML=encode.HTML,exports.decodeXML=exports.decodeXMLStrict=decode.XML,exports.decodeHTML4=exports.decodeHTML5=exports.decodeHTML=decode.HTML,exports.decodeHTML4Strict=exports.decodeHTML5Strict=exports.decodeHTMLStrict=decode.HTMLStrict,exports.escape=encode.escape},{"./lib/decode.js":51,"./lib/encode.js":53}],51:[function(decodeHTMLStrict,module,exports){var entityMap=decodeHTMLStrict("../maps/entities.json"),legacyMap=decodeHTMLStrict("../maps/legacy.json"),decodeHTML=decodeHTMLStrict("../maps/xml.json"),decodeCodePoint=decodeHTMLStrict("./decode_codepoint.js"),decodeXMLStrict=getStrictDecoder(decodeHTML),decodeHTMLStrict=getStrictDecoder(entityMap);function getStrictDecoder(map){var keys=Object.keys(map).join("|"),replace=getReplacer(map);keys+="|#[xX][\\da-fA-F]+|#\\d+";var re=new RegExp("&(?:"+keys+");","g");return function(str){return String(str).replace(re,replace)}}decodeHTML=function(){for(var legacy=Object.keys(legacyMap).sort(sorter),keys=Object.keys(entityMap).sort(sorter),i=0,j=0;i<keys.length;i++)legacy[j]===keys[i]?(keys[i]+=";?",j++):keys[i]+=";";var re=new RegExp("&(?:"+keys.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),replace=getReplacer(entityMap);function replacer(str){return";"!==str.substr(-1)&&(str+=";"),replace(str)}return function(str){return String(str).replace(re,replacer)}}();function sorter(a,b){return a<b?1:-1}function getReplacer(map){return function(str){return"#"===str.charAt(1)?"X"===str.charAt(2)||"x"===str.charAt(2)?decodeCodePoint(parseInt(str.substr(3),16)):decodeCodePoint(parseInt(str.substr(2),10)):map[str.slice(1,-1)]}}module.exports={XML:decodeXMLStrict,HTML:decodeHTML,HTMLStrict:decodeHTMLStrict}},{"../maps/entities.json":55,"../maps/legacy.json":56,"../maps/xml.json":57,"./decode_codepoint.js":52}],52:[function(require,module,exports){var decodeMap=require("../maps/decode.json");module.exports=function(codePoint){if(55296<=codePoint&&codePoint<=57343||1114111<codePoint)return"ï¿½";codePoint in decodeMap&&(codePoint=decodeMap[codePoint]);var output="";65535<codePoint&&(codePoint-=65536,output+=String.fromCharCode(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint);return output+=String.fromCharCode(codePoint)}},{"../maps/decode.json":54}],53:[function(htmlReplacer,module,exports){var inverseXML=getInverseObj(htmlReplacer("../maps/xml.json")),inverseHTML=getInverseReplacer(inverseXML);exports.XML=getInverse(inverseXML,inverseHTML);inverseHTML=getInverseObj(htmlReplacer("../maps/entities.json")),htmlReplacer=getInverseReplacer(inverseHTML);function getInverseObj(obj){return Object.keys(obj).sort().reduce(function(inverse,name){return inverse[obj[name]]="&"+name+";",inverse},{})}function getInverseReplacer(inverse){var single=[],multiple=[];return Object.keys(inverse).forEach(function(k){1===k.length?single.push("\\"+k):multiple.push(k)}),multiple.unshift("["+single.join("")+"]"),new RegExp(multiple.join("|"),"g")}exports.HTML=getInverse(inverseHTML,htmlReplacer);var re_nonASCII=/[^\0-\x7F]/g,re_astralSymbols=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function singleCharReplacer(c){return"&#x"+c.charCodeAt(0).toString(16).toUpperCase()+";"}function astralReplacer(c){return"&#x"+(1024*(c.charCodeAt(0)-55296)+c.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function getInverse(inverse,re){function func(name){return inverse[name]}return function(data){return data.replace(re,func).replace(re_astralSymbols,astralReplacer).replace(re_nonASCII,singleCharReplacer)}}var re_xmlChars=getInverseReplacer(inverseXML);exports.escape=function(data){return data.replace(re_xmlChars,singleCharReplacer).replace(re_astralSymbols,astralReplacer).replace(re_nonASCII,singleCharReplacer)}},{"../maps/entities.json":55,"../maps/xml.json":57}],54:[function(require,module,exports){module.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],55:[function(require,module,exports){module.exports={Aacute:"Ã",aacute:"Ã¡",Abreve:"Ä",abreve:"Ä",ac:"â¾",acd:"â¿",acE:"â¾Ì³",Acirc:"Ã",acirc:"Ã¢",acute:"Â´",Acy:"Ð",acy:"Ð°",AElig:"Ã",aelig:"Ã¦",af:"â¡",Afr:"ð",afr:"ð",Agrave:"Ã",agrave:"Ã ",alefsym:"âµ",aleph:"âµ",Alpha:"Î",alpha:"Î±",Amacr:"Ä",amacr:"Ä",amalg:"â¨¿",amp:"&",AMP:"&",andand:"â©",And:"â©",and:"â§",andd:"â©",andslope:"â©",andv:"â©",ang:"â ",ange:"â¦¤",angle:"â ",angmsdaa:"â¦¨",angmsdab:"â¦©",angmsdac:"â¦ª",angmsdad:"â¦«",angmsdae:"â¦¬",angmsdaf:"â¦­",angmsdag:"â¦®",angmsdah:"â¦¯",angmsd:"â¡",angrt:"â",angrtvb:"â¾",angrtvbd:"â¦",angsph:"â¢",angst:"Ã",angzarr:"â¼",Aogon:"Ä",aogon:"Ä",Aopf:"ð¸",aopf:"ð",apacir:"â©¯",ap:"â",apE:"â©°",ape:"â",apid:"â",apos:"'",ApplyFunction:"â¡",approx:"â",approxeq:"â",Aring:"Ã",aring:"Ã¥",Ascr:"ð",ascr:"ð¶",Assign:"â",ast:"*",asymp:"â",asympeq:"â",Atilde:"Ã",atilde:"Ã£",Auml:"Ã",auml:"Ã¤",awconint:"â³",awint:"â¨",backcong:"â",backepsilon:"Ï¶",backprime:"âµ",backsim:"â½",backsimeq:"â",Backslash:"â",Barv:"â«§",barvee:"â½",barwed:"â",Barwed:"â",barwedge:"â",bbrk:"âµ",bbrktbrk:"â¶",bcong:"â",Bcy:"Ð",bcy:"Ð±",bdquo:"â",becaus:"âµ",because:"âµ",Because:"âµ",bemptyv:"â¦°",bepsi:"Ï¶",bernou:"â¬",Bernoullis:"â¬",Beta:"Î",beta:"Î²",beth:"â¶",between:"â¬",Bfr:"ð",bfr:"ð",bigcap:"â",bigcirc:"â¯",bigcup:"â",bigodot:"â¨",bigoplus:"â¨",bigotimes:"â¨",bigsqcup:"â¨",bigstar:"â",bigtriangledown:"â½",bigtriangleup:"â³",biguplus:"â¨",bigvee:"â",bigwedge:"â",bkarow:"â¤",blacklozenge:"â§«",blacksquare:"âª",blacktriangle:"â´",blacktriangledown:"â¾",blacktriangleleft:"â",blacktriangleright:"â¸",blank:"â£",blk12:"â",blk14:"â",blk34:"â",block:"â",bne:"=â¥",bnequiv:"â¡â¥",bNot:"â«­",bnot:"â",Bopf:"ð¹",bopf:"ð",bot:"â¥",bottom:"â¥",bowtie:"â",boxbox:"â§",boxdl:"â",boxdL:"â",boxDl:"â",boxDL:"â",boxdr:"â",boxdR:"â",boxDr:"â",boxDR:"â",boxh:"â",boxH:"â",boxhd:"â¬",boxHd:"â¤",boxhD:"â¥",boxHD:"â¦",boxhu:"â´",boxHu:"â§",boxhU:"â¨",boxHU:"â©",boxminus:"â",boxplus:"â",boxtimes:"â ",boxul:"â",boxuL:"â",boxUl:"â",boxUL:"â",boxur:"â",boxuR:"â",boxUr:"â",boxUR:"â",boxv:"â",boxV:"â",boxvh:"â¼",boxvH:"âª",boxVh:"â«",boxVH:"â¬",boxvl:"â¤",boxvL:"â¡",boxVl:"â¢",boxVL:"â£",boxvr:"â",boxvR:"â",boxVr:"â",boxVR:"â ",bprime:"âµ",breve:"Ë",Breve:"Ë",brvbar:"Â¦",bscr:"ð·",Bscr:"â¬",bsemi:"â",bsim:"â½",bsime:"â",bsolb:"â§",bsol:"\\",bsolhsub:"â",bull:"â¢",bullet:"â¢",bump:"â",bumpE:"âª®",bumpe:"â",Bumpeq:"â",bumpeq:"â",Cacute:"Ä",cacute:"Ä",capand:"â©",capbrcup:"â©",capcap:"â©",cap:"â©",Cap:"â",capcup:"â©",capdot:"â©",CapitalDifferentialD:"â",caps:"â©ï¸",caret:"â",caron:"Ë",Cayleys:"â­",ccaps:"â©",Ccaron:"Ä",ccaron:"Ä",Ccedil:"Ã",ccedil:"Ã§",Ccirc:"Ä",ccirc:"Ä",Cconint:"â°",ccups:"â©",ccupssm:"â©",Cdot:"Ä",cdot:"Ä",cedil:"Â¸",Cedilla:"Â¸",cemptyv:"â¦²",cent:"Â¢",centerdot:"Â·",CenterDot:"Â·",cfr:"ð ",Cfr:"â­",CHcy:"Ð§",chcy:"Ñ",check:"â",checkmark:"â",Chi:"Î§",chi:"Ï",circ:"Ë",circeq:"â",circlearrowleft:"âº",circlearrowright:"â»",circledast:"â",circledcirc:"â",circleddash:"â",CircleDot:"â",circledR:"Â®",circledS:"â",CircleMinus:"â",CirclePlus:"â",CircleTimes:"â",cir:"â",cirE:"â§",cire:"â",cirfnint:"â¨",cirmid:"â«¯",cirscir:"â§",ClockwiseContourIntegral:"â²",CloseCurlyDoubleQuote:"â",CloseCurlyQuote:"â",clubs:"â£",clubsuit:"â£",colon:":",Colon:"â·",Colone:"â©´",colone:"â",coloneq:"â",comma:",",commat:"@",comp:"â",compfn:"â",complement:"â",complexes:"â",cong:"â",congdot:"â©­",Congruent:"â¡",conint:"â®",Conint:"â¯",ContourIntegral:"â®",copf:"ð",Copf:"â",coprod:"â",Coproduct:"â",copy:"Â©",COPY:"Â©",copysr:"â",CounterClockwiseContourIntegral:"â³",crarr:"âµ",cross:"â",Cross:"â¨¯",Cscr:"ð",cscr:"ð¸",csub:"â«",csube:"â«",csup:"â«",csupe:"â«",ctdot:"â¯",cudarrl:"â¤¸",cudarrr:"â¤µ",cuepr:"â",cuesc:"â",cularr:"â¶",cularrp:"â¤½",cupbrcap:"â©",cupcap:"â©",CupCap:"â",cup:"âª",Cup:"â",cupcup:"â©",cupdot:"â",cupor:"â©",cups:"âªï¸",curarr:"â·",curarrm:"â¤¼",curlyeqprec:"â",curlyeqsucc:"â",curlyvee:"â",curlywedge:"â",curren:"Â¤",curvearrowleft:"â¶",curvearrowright:"â·",cuvee:"â",cuwed:"â",cwconint:"â²",cwint:"â±",cylcty:"â­",dagger:"â ",Dagger:"â¡",daleth:"â¸",darr:"â",Darr:"â¡",dArr:"â",dash:"â",Dashv:"â«¤",dashv:"â£",dbkarow:"â¤",dblac:"Ë",Dcaron:"Ä",dcaron:"Ä",Dcy:"Ð",dcy:"Ð´",ddagger:"â¡",ddarr:"â",DD:"â",dd:"â",DDotrahd:"â¤",ddotseq:"â©·",deg:"Â°",Del:"â",Delta:"Î",delta:"Î´",demptyv:"â¦±",dfisht:"â¥¿",Dfr:"ð",dfr:"ð¡",dHar:"â¥¥",dharl:"â",dharr:"â",DiacriticalAcute:"Â´",DiacriticalDot:"Ë",DiacriticalDoubleAcute:"Ë",DiacriticalGrave:"`",DiacriticalTilde:"Ë",diam:"â",diamond:"â",Diamond:"â",diamondsuit:"â¦",diams:"â¦",die:"Â¨",DifferentialD:"â",digamma:"Ï",disin:"â²",div:"Ã·",divide:"Ã·",divideontimes:"â",divonx:"â",DJcy:"Ð",djcy:"Ñ",dlcorn:"â",dlcrop:"â",dollar:"$",Dopf:"ð»",dopf:"ð",Dot:"Â¨",dot:"Ë",DotDot:"â",doteq:"â",doteqdot:"â",DotEqual:"â",dotminus:"â¸",dotplus:"â",dotsquare:"â¡",doublebarwedge:"â",DoubleContourIntegral:"â¯",DoubleDot:"Â¨",DoubleDownArrow:"â",DoubleLeftArrow:"â",DoubleLeftRightArrow:"â",DoubleLeftTee:"â«¤",DoubleLongLeftArrow:"â¸",DoubleLongLeftRightArrow:"âº",DoubleLongRightArrow:"â¹",DoubleRightArrow:"â",DoubleRightTee:"â¨",DoubleUpArrow:"â",DoubleUpDownArrow:"â",DoubleVerticalBar:"â¥",DownArrowBar:"â¤",downarrow:"â",DownArrow:"â",Downarrow:"â",DownArrowUpArrow:"âµ",DownBreve:"Ì",downdownarrows:"â",downharpoonleft:"â",downharpoonright:"â",DownLeftRightVector:"â¥",DownLeftTeeVector:"â¥",DownLeftVectorBar:"â¥",DownLeftVector:"â½",DownRightTeeVector:"â¥",DownRightVectorBar:"â¥",DownRightVector:"â",DownTeeArrow:"â§",DownTee:"â¤",drbkarow:"â¤",drcorn:"â",drcrop:"â",Dscr:"ð",dscr:"ð¹",DScy:"Ð",dscy:"Ñ",dsol:"â§¶",Dstrok:"Ä",dstrok:"Ä",dtdot:"â±",dtri:"â¿",dtrif:"â¾",duarr:"âµ",duhar:"â¥¯",dwangle:"â¦¦",DZcy:"Ð",dzcy:"Ñ",dzigrarr:"â¿",Eacute:"Ã",eacute:"Ã©",easter:"â©®",Ecaron:"Ä",ecaron:"Ä",Ecirc:"Ã",ecirc:"Ãª",ecir:"â",ecolon:"â",Ecy:"Ð­",ecy:"Ñ",eDDot:"â©·",Edot:"Ä",edot:"Ä",eDot:"â",ee:"â",efDot:"â",Efr:"ð",efr:"ð¢",eg:"âª",Egrave:"Ã",egrave:"Ã¨",egs:"âª",egsdot:"âª",el:"âª",Element:"â",elinters:"â§",ell:"â",els:"âª",elsdot:"âª",Emacr:"Ä",emacr:"Ä",empty:"â",emptyset:"â",EmptySmallSquare:"â»",emptyv:"â",EmptyVerySmallSquare:"â«",emsp13:"â",emsp14:"â",emsp:"â",ENG:"Å",eng:"Å",ensp:"â",Eogon:"Ä",eogon:"Ä",Eopf:"ð¼",eopf:"ð",epar:"â",eparsl:"â§£",eplus:"â©±",epsi:"Îµ",Epsilon:"Î",epsilon:"Îµ",epsiv:"Ïµ",eqcirc:"â",eqcolon:"â",eqsim:"â",eqslantgtr:"âª",eqslantless:"âª",Equal:"â©µ",equals:"=",EqualTilde:"â",equest:"â",Equilibrium:"â",equiv:"â¡",equivDD:"â©¸",eqvparsl:"â§¥",erarr:"â¥±",erDot:"â",escr:"â¯",Escr:"â°",esdot:"â",Esim:"â©³",esim:"â",Eta:"Î",eta:"Î·",ETH:"Ã",eth:"Ã°",Euml:"Ã",euml:"Ã«",euro:"â¬",excl:"!",exist:"â",Exists:"â",expectation:"â°",exponentiale:"â",ExponentialE:"â",fallingdotseq:"â",Fcy:"Ð¤",fcy:"Ñ",female:"â",ffilig:"ï¬",fflig:"ï¬",ffllig:"ï¬",Ffr:"ð",ffr:"ð£",filig:"ï¬",FilledSmallSquare:"â¼",FilledVerySmallSquare:"âª",fjlig:"fj",flat:"â­",fllig:"ï¬",fltns:"â±",fnof:"Æ",Fopf:"ð½",fopf:"ð",forall:"â",ForAll:"â",fork:"â",forkv:"â«",Fouriertrf:"â±",fpartint:"â¨",frac12:"Â½",frac13:"â",frac14:"Â¼",frac15:"â",frac16:"â",frac18:"â",frac23:"â",frac25:"â",frac34:"Â¾",frac35:"â",frac38:"â",frac45:"â",frac56:"â",frac58:"â",frac78:"â",frasl:"â",frown:"â¢",fscr:"ð»",Fscr:"â±",gacute:"Çµ",Gamma:"Î",gamma:"Î³",Gammad:"Ï",gammad:"Ï",gap:"âª",Gbreve:"Ä",gbreve:"Ä",Gcedil:"Ä¢",Gcirc:"Ä",gcirc:"Ä",Gcy:"Ð",gcy:"Ð³",Gdot:"Ä ",gdot:"Ä¡",ge:"â¥",gE:"â§",gEl:"âª",gel:"â",geq:"â¥",geqq:"â§",geqslant:"â©¾",gescc:"âª©",ges:"â©¾",gesdot:"âª",gesdoto:"âª",gesdotol:"âª",gesl:"âï¸",gesles:"âª",Gfr:"ð",gfr:"ð¤",gg:"â«",Gg:"â",ggg:"â",gimel:"â·",GJcy:"Ð",gjcy:"Ñ",gla:"âª¥",gl:"â·",glE:"âª",glj:"âª¤",gnap:"âª",gnapprox:"âª",gne:"âª",gnE:"â©",gneq:"âª",gneqq:"â©",gnsim:"â§",Gopf:"ð¾",gopf:"ð",grave:"`",GreaterEqual:"â¥",GreaterEqualLess:"â",GreaterFullEqual:"â§",GreaterGreater:"âª¢",GreaterLess:"â·",GreaterSlantEqual:"â©¾",GreaterTilde:"â³",Gscr:"ð¢",gscr:"â",gsim:"â³",gsime:"âª",gsiml:"âª",gtcc:"âª§",gtcir:"â©º",gt:">",GT:">",Gt:"â«",gtdot:"â",gtlPar:"â¦",gtquest:"â©¼",gtrapprox:"âª",gtrarr:"â¥¸",gtrdot:"â",gtreqless:"â",gtreqqless:"âª",gtrless:"â·",gtrsim:"â³",gvertneqq:"â©ï¸",gvnE:"â©ï¸",Hacek:"Ë",hairsp:"â",half:"Â½",hamilt:"â",HARDcy:"Ðª",hardcy:"Ñ",harrcir:"â¥",harr:"â",hArr:"â",harrw:"â­",Hat:"^",hbar:"â",Hcirc:"Ä¤",hcirc:"Ä¥",hearts:"â¥",heartsuit:"â¥",hellip:"â¦",hercon:"â¹",hfr:"ð¥",Hfr:"â",HilbertSpace:"â",hksearow:"â¤¥",hkswarow:"â¤¦",hoarr:"â¿",homtht:"â»",hookleftarrow:"â©",hookrightarrow:"âª",hopf:"ð",Hopf:"â",horbar:"â",HorizontalLine:"â",hscr:"ð½",Hscr:"â",hslash:"â",Hstrok:"Ä¦",hstrok:"Ä§",HumpDownHump:"â",HumpEqual:"â",hybull:"â",hyphen:"â",Iacute:"Ã",iacute:"Ã­",ic:"â£",Icirc:"Ã",icirc:"Ã®",Icy:"Ð",icy:"Ð¸",Idot:"Ä°",IEcy:"Ð",iecy:"Ðµ",iexcl:"Â¡",iff:"â",ifr:"ð¦",Ifr:"â",Igrave:"Ã",igrave:"Ã¬",ii:"â",iiiint:"â¨",iiint:"â­",iinfin:"â§",iiota:"â©",IJlig:"Ä²",ijlig:"Ä³",Imacr:"Äª",imacr:"Ä«",image:"â",ImaginaryI:"â",imagline:"â",imagpart:"â",imath:"Ä±",Im:"â",imof:"â·",imped:"Æµ",Implies:"â",incare:"â",in:"â",infin:"â",infintie:"â§",inodot:"Ä±",intcal:"âº",int:"â«",Int:"â¬",integers:"â¤",Integral:"â«",intercal:"âº",Intersection:"â",intlarhk:"â¨",intprod:"â¨¼",InvisibleComma:"â£",InvisibleTimes:"â¢",IOcy:"Ð",iocy:"Ñ",Iogon:"Ä®",iogon:"Ä¯",Iopf:"ð",iopf:"ð",Iota:"Î",iota:"Î¹",iprod:"â¨¼",iquest:"Â¿",iscr:"ð¾",Iscr:"â",isin:"â",isindot:"âµ",isinE:"â¹",isins:"â´",isinsv:"â³",isinv:"â",it:"â¢",Itilde:"Ä¨",itilde:"Ä©",Iukcy:"Ð",iukcy:"Ñ",Iuml:"Ã",iuml:"Ã¯",Jcirc:"Ä´",jcirc:"Äµ",Jcy:"Ð",jcy:"Ð¹",Jfr:"ð",jfr:"ð§",jmath:"È·",Jopf:"ð",jopf:"ð",Jscr:"ð¥",jscr:"ð¿",Jsercy:"Ð",jsercy:"Ñ",Jukcy:"Ð",jukcy:"Ñ",Kappa:"Î",kappa:"Îº",kappav:"Ï°",Kcedil:"Ä¶",kcedil:"Ä·",Kcy:"Ð",kcy:"Ðº",Kfr:"ð",kfr:"ð¨",kgreen:"Ä¸",KHcy:"Ð¥",khcy:"Ñ",KJcy:"Ð",kjcy:"Ñ",Kopf:"ð",kopf:"ð",Kscr:"ð¦",kscr:"ð",lAarr:"â",Lacute:"Ä¹",lacute:"Äº",laemptyv:"â¦´",lagran:"â",Lambda:"Î",lambda:"Î»",lang:"â¨",Lang:"âª",langd:"â¦",langle:"â¨",lap:"âª",Laplacetrf:"â",laquo:"Â«",larrb:"â¤",larrbfs:"â¤",larr:"â",Larr:"â",lArr:"â",larrfs:"â¤",larrhk:"â©",larrlp:"â«",larrpl:"â¤¹",larrsim:"â¥³",larrtl:"â¢",latail:"â¤",lAtail:"â¤",lat:"âª«",late:"âª­",lates:"âª­ï¸",lbarr:"â¤",lBarr:"â¤",lbbrk:"â²",lbrace:"{",lbrack:"[",lbrke:"â¦",lbrksld:"â¦",lbrkslu:"â¦",Lcaron:"Ä½",lcaron:"Ä¾",Lcedil:"Ä»",lcedil:"Ä¼",lceil:"â",lcub:"{",Lcy:"Ð",lcy:"Ð»",ldca:"â¤¶",ldquo:"â",ldquor:"â",ldrdhar:"â¥§",ldrushar:"â¥",ldsh:"â²",le:"â¤",lE:"â¦",LeftAngleBracket:"â¨",LeftArrowBar:"â¤",leftarrow:"â",LeftArrow:"â",Leftarrow:"â",LeftArrowRightArrow:"â",leftarrowtail:"â¢",LeftCeiling:"â",LeftDoubleBracket:"â¦",LeftDownTeeVector:"â¥¡",LeftDownVectorBar:"â¥",LeftDownVector:"â",LeftFloor:"â",leftharpoondown:"â½",leftharpoonup:"â¼",leftleftarrows:"â",leftrightarrow:"â",LeftRightArrow:"â",Leftrightarrow:"â",leftrightarrows:"â",leftrightharpoons:"â",leftrightsquigarrow:"â­",LeftRightVector:"â¥",LeftTeeArrow:"â¤",LeftTee:"â£",LeftTeeVector:"â¥",leftthreetimes:"â",LeftTriangleBar:"â§",LeftTriangle:"â²",LeftTriangleEqual:"â´",LeftUpDownVector:"â¥",LeftUpTeeVector:"â¥ ",LeftUpVectorBar:"â¥",LeftUpVector:"â¿",LeftVectorBar:"â¥",LeftVector:"â¼",lEg:"âª",leg:"â",leq:"â¤",leqq:"â¦",leqslant:"â©½",lescc:"âª¨",les:"â©½",lesdot:"â©¿",lesdoto:"âª",lesdotor:"âª",lesg:"âï¸",lesges:"âª",lessapprox:"âª",lessdot:"â",lesseqgtr:"â",lesseqqgtr:"âª",LessEqualGreater:"â",LessFullEqual:"â¦",LessGreater:"â¶",lessgtr:"â¶",LessLess:"âª¡",lesssim:"â²",LessSlantEqual:"â©½",LessTilde:"â²",lfisht:"â¥¼",lfloor:"â",Lfr:"ð",lfr:"ð©",lg:"â¶",lgE:"âª",lHar:"â¥¢",lhard:"â½",lharu:"â¼",lharul:"â¥ª",lhblk:"â",LJcy:"Ð",ljcy:"Ñ",llarr:"â",ll:"âª",Ll:"â",llcorner:"â",Lleftarrow:"â",llhard:"â¥«",lltri:"âº",Lmidot:"Ä¿",lmidot:"Å",lmoustache:"â°",lmoust:"â°",lnap:"âª",lnapprox:"âª",lne:"âª",lnE:"â¨",lneq:"âª",lneqq:"â¨",lnsim:"â¦",loang:"â¬",loarr:"â½",lobrk:"â¦",longleftarrow:"âµ",LongLeftArrow:"âµ",Longleftarrow:"â¸",longleftrightarrow:"â·",LongLeftRightArrow:"â·",Longleftrightarrow:"âº",longmapsto:"â¼",longrightarrow:"â¶",LongRightArrow:"â¶",Longrightarrow:"â¹",looparrowleft:"â«",looparrowright:"â¬",lopar:"â¦",Lopf:"ð",lopf:"ð",loplus:"â¨­",lotimes:"â¨´",lowast:"â",lowbar:"_",LowerLeftArrow:"â",LowerRightArrow:"â",loz:"â",lozenge:"â",lozf:"â§«",lpar:"(",lparlt:"â¦",lrarr:"â",lrcorner:"â",lrhar:"â",lrhard:"â¥­",lrm:"â",lrtri:"â¿",lsaquo:"â¹",lscr:"ð",Lscr:"â",lsh:"â°",Lsh:"â°",lsim:"â²",lsime:"âª",lsimg:"âª",lsqb:"[",lsquo:"â",lsquor:"â",Lstrok:"Å",lstrok:"Å",ltcc:"âª¦",ltcir:"â©¹",lt:"<",LT:"<",Lt:"âª",ltdot:"â",lthree:"â",ltimes:"â",ltlarr:"â¥¶",ltquest:"â©»",ltri:"â",ltrie:"â´",ltrif:"â",ltrPar:"â¦",lurdshar:"â¥",luruhar:"â¥¦",lvertneqq:"â¨ï¸",lvnE:"â¨ï¸",macr:"Â¯",male:"â",malt:"â ",maltese:"â ",Map:"â¤",map:"â¦",mapsto:"â¦",mapstodown:"â§",mapstoleft:"â¤",mapstoup:"â¥",marker:"â®",mcomma:"â¨©",Mcy:"Ð",mcy:"Ð¼",mdash:"â",mDDot:"âº",measuredangle:"â¡",MediumSpace:"â",Mellintrf:"â³",Mfr:"ð",mfr:"ðª",mho:"â§",micro:"Âµ",midast:"*",midcir:"â«°",mid:"â£",middot:"Â·",minusb:"â",minus:"â",minusd:"â¸",minusdu:"â¨ª",MinusPlus:"â",mlcp:"â«",mldr:"â¦",mnplus:"â",models:"â§",Mopf:"ð",mopf:"ð",mp:"â",mscr:"ð",Mscr:"â³",mstpos:"â¾",Mu:"Î",mu:"Î¼",multimap:"â¸",mumap:"â¸",nabla:"â",Nacute:"Å",nacute:"Å",nang:"â â",nap:"â",napE:"â©°Ì¸",napid:"âÌ¸",napos:"Å",napprox:"â",natural:"â®",naturals:"â",natur:"â®",nbsp:"Â ",nbump:"âÌ¸",nbumpe:"âÌ¸",ncap:"â©",Ncaron:"Å",ncaron:"Å",Ncedil:"Å",ncedil:"Å",ncong:"â",ncongdot:"â©­Ì¸",ncup:"â©",Ncy:"Ð",ncy:"Ð½",ndash:"â",nearhk:"â¤¤",nearr:"â",neArr:"â",nearrow:"â",ne:"â ",nedot:"âÌ¸",NegativeMediumSpace:"â",NegativeThickSpace:"â",NegativeThinSpace:"â",NegativeVeryThinSpace:"â",nequiv:"â¢",nesear:"â¤¨",nesim:"âÌ¸",NestedGreaterGreater:"â«",NestedLessLess:"âª",NewLine:"\n",nexist:"â",nexists:"â",Nfr:"ð",nfr:"ð«",ngE:"â§Ì¸",nge:"â±",ngeq:"â±",ngeqq:"â§Ì¸",ngeqslant:"â©¾Ì¸",nges:"â©¾Ì¸",nGg:"âÌ¸",ngsim:"âµ",nGt:"â«â",ngt:"â¯",ngtr:"â¯",nGtv:"â«Ì¸",nharr:"â®",nhArr:"â",nhpar:"â«²",ni:"â",nis:"â¼",nisd:"âº",niv:"â",NJcy:"Ð",njcy:"Ñ",nlarr:"â",nlArr:"â",nldr:"â¥",nlE:"â¦Ì¸",nle:"â°",nleftarrow:"â",nLeftarrow:"â",nleftrightarrow:"â®",nLeftrightarrow:"â",nleq:"â°",nleqq:"â¦Ì¸",nleqslant:"â©½Ì¸",nles:"â©½Ì¸",nless:"â®",nLl:"âÌ¸",nlsim:"â´",nLt:"âªâ",nlt:"â®",nltri:"âª",nltrie:"â¬",nLtv:"âªÌ¸",nmid:"â¤",NoBreak:"â ",NonBreakingSpace:"Â ",nopf:"ð",Nopf:"â",Not:"â«¬",not:"Â¬",NotCongruent:"â¢",NotCupCap:"â­",NotDoubleVerticalBar:"â¦",NotElement:"â",NotEqual:"â ",NotEqualTilde:"âÌ¸",NotExists:"â",NotGreater:"â¯",NotGreaterEqual:"â±",NotGreaterFullEqual:"â§Ì¸",NotGreaterGreater:"â«Ì¸",NotGreaterLess:"â¹",NotGreaterSlantEqual:"â©¾Ì¸",NotGreaterTilde:"âµ",NotHumpDownHump:"âÌ¸",NotHumpEqual:"âÌ¸",notin:"â",notindot:"âµÌ¸",notinE:"â¹Ì¸",notinva:"â",notinvb:"â·",notinvc:"â¶",NotLeftTriangleBar:"â§Ì¸",NotLeftTriangle:"âª",NotLeftTriangleEqual:"â¬",NotLess:"â®",NotLessEqual:"â°",NotLessGreater:"â¸",NotLessLess:"âªÌ¸",NotLessSlantEqual:"â©½Ì¸",NotLessTilde:"â´",NotNestedGreaterGreater:"âª¢Ì¸",NotNestedLessLess:"âª¡Ì¸",notni:"â",notniva:"â",notnivb:"â¾",notnivc:"â½",NotPrecedes:"â",NotPrecedesEqual:"âª¯Ì¸",NotPrecedesSlantEqual:"â ",NotReverseElement:"â",NotRightTriangleBar:"â§Ì¸",NotRightTriangle:"â«",NotRightTriangleEqual:"â­",NotSquareSubset:"âÌ¸",NotSquareSubsetEqual:"â¢",NotSquareSuperset:"âÌ¸",NotSquareSupersetEqual:"â£",NotSubset:"ââ",NotSubsetEqual:"â",NotSucceeds:"â",NotSucceedsEqual:"âª°Ì¸",NotSucceedsSlantEqual:"â¡",NotSucceedsTilde:"â¿Ì¸",NotSuperset:"ââ",NotSupersetEqual:"â",NotTilde:"â",NotTildeEqual:"â",NotTildeFullEqual:"â",NotTildeTilde:"â",NotVerticalBar:"â¤",nparallel:"â¦",npar:"â¦",nparsl:"â«½â¥",npart:"âÌ¸",npolint:"â¨",npr:"â",nprcue:"â ",nprec:"â",npreceq:"âª¯Ì¸",npre:"âª¯Ì¸",nrarrc:"â¤³Ì¸",nrarr:"â",nrArr:"â",nrarrw:"âÌ¸",nrightarrow:"â",nRightarrow:"â",nrtri:"â«",nrtrie:"â­",nsc:"â",nsccue:"â¡",nsce:"âª°Ì¸",Nscr:"ð©",nscr:"ð",nshortmid:"â¤",nshortparallel:"â¦",nsim:"â",nsime:"â",nsimeq:"â",nsmid:"â¤",nspar:"â¦",nsqsube:"â¢",nsqsupe:"â£",nsub:"â",nsubE:"â«Ì¸",nsube:"â",nsubset:"ââ",nsubseteq:"â",nsubseteqq:"â«Ì¸",nsucc:"â",nsucceq:"âª°Ì¸",nsup:"â",nsupE:"â«Ì¸",nsupe:"â",nsupset:"ââ",nsupseteq:"â",nsupseteqq:"â«Ì¸",ntgl:"â¹",Ntilde:"Ã",ntilde:"Ã±",ntlg:"â¸",ntriangleleft:"âª",ntrianglelefteq:"â¬",ntriangleright:"â«",ntrianglerighteq:"â­",Nu:"Î",nu:"Î½",num:"#",numero:"â",numsp:"â",nvap:"ââ",nvdash:"â¬",nvDash:"â­",nVdash:"â®",nVDash:"â¯",nvge:"â¥â",nvgt:">â",nvHarr:"â¤",nvinfin:"â§",nvlArr:"â¤",nvle:"â¤â",nvlt:"<â",nvltrie:"â´â",nvrArr:"â¤",nvrtrie:"âµâ",nvsim:"â¼â",nwarhk:"â¤£",nwarr:"â",nwArr:"â",nwarrow:"â",nwnear:"â¤§",Oacute:"Ã",oacute:"Ã³",oast:"â",Ocirc:"Ã",ocirc:"Ã´",ocir:"â",Ocy:"Ð",ocy:"Ð¾",odash:"â",Odblac:"Å",odblac:"Å",odiv:"â¨¸",odot:"â",odsold:"â¦¼",OElig:"Å",oelig:"Å",ofcir:"â¦¿",Ofr:"ð",ofr:"ð¬",ogon:"Ë",Ograve:"Ã",ograve:"Ã²",ogt:"â§",ohbar:"â¦µ",ohm:"Î©",oint:"â®",olarr:"âº",olcir:"â¦¾",olcross:"â¦»",oline:"â¾",olt:"â§",Omacr:"Å",omacr:"Å",Omega:"Î©",omega:"Ï",Omicron:"Î",omicron:"Î¿",omid:"â¦¶",ominus:"â",Oopf:"ð",oopf:"ð ",opar:"â¦·",OpenCurlyDoubleQuote:"â",OpenCurlyQuote:"â",operp:"â¦¹",oplus:"â",orarr:"â»",Or:"â©",or:"â¨",ord:"â©",order:"â´",orderof:"â´",ordf:"Âª",ordm:"Âº",origof:"â¶",oror:"â©",orslope:"â©",orv:"â©",oS:"â",Oscr:"ðª",oscr:"â´",Oslash:"Ã",oslash:"Ã¸",osol:"â",Otilde:"Ã",otilde:"Ãµ",otimesas:"â¨¶",Otimes:"â¨·",otimes:"â",Ouml:"Ã",ouml:"Ã¶",ovbar:"â½",OverBar:"â¾",OverBrace:"â",OverBracket:"â´",OverParenthesis:"â",para:"Â¶",parallel:"â¥",par:"â¥",parsim:"â«³",parsl:"â«½",part:"â",PartialD:"â",Pcy:"Ð",pcy:"Ð¿",percnt:"%",period:".",permil:"â°",perp:"â¥",pertenk:"â±",Pfr:"ð",pfr:"ð­",Phi:"Î¦",phi:"Ï",phiv:"Ï",phmmat:"â³",phone:"â",Pi:"Î ",pi:"Ï",pitchfork:"â",piv:"Ï",planck:"â",planckh:"â",plankv:"â",plusacir:"â¨£",plusb:"â",pluscir:"â¨¢",plus:"+",plusdo:"â",plusdu:"â¨¥",pluse:"â©²",PlusMinus:"Â±",plusmn:"Â±",plussim:"â¨¦",plustwo:"â¨§",pm:"Â±",Poincareplane:"â",pointint:"â¨",popf:"ð¡",Popf:"â",pound:"Â£",prap:"âª·",Pr:"âª»",pr:"âº",prcue:"â¼",precapprox:"âª·",prec:"âº",preccurlyeq:"â¼",Precedes:"âº",PrecedesEqual:"âª¯",PrecedesSlantEqual:"â¼",PrecedesTilde:"â¾",preceq:"âª¯",precnapprox:"âª¹",precneqq:"âªµ",precnsim:"â¨",pre:"âª¯",prE:"âª³",precsim:"â¾",prime:"â²",Prime:"â³",primes:"â",prnap:"âª¹",prnE:"âªµ",prnsim:"â¨",prod:"â",Product:"â",profalar:"â®",profline:"â",profsurf:"â",prop:"â",Proportional:"â",Proportion:"â·",propto:"â",prsim:"â¾",prurel:"â°",Pscr:"ð«",pscr:"ð",Psi:"Î¨",psi:"Ï",puncsp:"â",Qfr:"ð",qfr:"ð®",qint:"â¨",qopf:"ð¢",Qopf:"â",qprime:"â",Qscr:"ð¬",qscr:"ð",quaternions:"â",quatint:"â¨",quest:"?",questeq:"â",quot:'"',QUOT:'"',rAarr:"â",race:"â½Ì±",Racute:"Å",racute:"Å",radic:"â",raemptyv:"â¦³",rang:"â©",Rang:"â«",rangd:"â¦",range:"â¦¥",rangle:"â©",raquo:"Â»",rarrap:"â¥µ",rarrb:"â¥",rarrbfs:"â¤ ",rarrc:"â¤³",rarr:"â",Rarr:"â ",rArr:"â",rarrfs:"â¤",rarrhk:"âª",rarrlp:"â¬",rarrpl:"â¥",rarrsim:"â¥´",Rarrtl:"â¤",rarrtl:"â£",rarrw:"â",ratail:"â¤",rAtail:"â¤",ratio:"â¶",rationals:"â",rbarr:"â¤",rBarr:"â¤",RBarr:"â¤",rbbrk:"â³",rbrace:"}",rbrack:"]",rbrke:"â¦",rbrksld:"â¦",rbrkslu:"â¦",Rcaron:"Å",rcaron:"Å",Rcedil:"Å",rcedil:"Å",rceil:"â",rcub:"}",Rcy:"Ð ",rcy:"Ñ",rdca:"â¤·",rdldhar:"â¥©",rdquo:"â",rdquor:"â",rdsh:"â³",real:"â",realine:"â",realpart:"â",reals:"â",Re:"â",rect:"â­",reg:"Â®",REG:"Â®",ReverseElement:"â",ReverseEquilibrium:"â",ReverseUpEquilibrium:"â¥¯",rfisht:"â¥½",rfloor:"â",rfr:"ð¯",Rfr:"â",rHar:"â¥¤",rhard:"â",rharu:"â",rharul:"â¥¬",Rho:"Î¡",rho:"Ï",rhov:"Ï±",RightAngleBracket:"â©",RightArrowBar:"â¥",rightarrow:"â",RightArrow:"â",Rightarrow:"â",RightArrowLeftArrow:"â",rightarrowtail:"â£",RightCeiling:"â",RightDoubleBracket:"â§",RightDownTeeVector:"â¥",RightDownVectorBar:"â¥",RightDownVector:"â",RightFloor:"â",rightharpoondown:"â",rightharpoonup:"â",rightleftarrows:"â",rightleftharpoons:"â",rightrightarrows:"â",rightsquigarrow:"â",RightTeeArrow:"â¦",RightTee:"â¢",RightTeeVector:"â¥",rightthreetimes:"â",RightTriangleBar:"â§",RightTriangle:"â³",RightTriangleEqual:"âµ",RightUpDownVector:"â¥",RightUpTeeVector:"â¥",RightUpVectorBar:"â¥",RightUpVector:"â¾",RightVectorBar:"â¥",RightVector:"â",ring:"Ë",risingdotseq:"â",rlarr:"â",rlhar:"â",rlm:"â",rmoustache:"â±",rmoust:"â±",rnmid:"â«®",roang:"â­",roarr:"â¾",robrk:"â§",ropar:"â¦",ropf:"ð£",Ropf:"â",roplus:"â¨®",rotimes:"â¨µ",RoundImplies:"â¥°",rpar:")",rpargt:"â¦",rppolint:"â¨",rrarr:"â",Rrightarrow:"â",rsaquo:"âº",rscr:"ð",Rscr:"â",rsh:"â±",Rsh:"â±",rsqb:"]",rsquo:"â",rsquor:"â",rthree:"â",rtimes:"â",rtri:"â¹",rtrie:"âµ",rtrif:"â¸",rtriltri:"â§",RuleDelayed:"â§´",ruluhar:"â¥¨",rx:"â",Sacute:"Å",sacute:"Å",sbquo:"â",scap:"âª¸",Scaron:"Å ",scaron:"Å¡",Sc:"âª¼",sc:"â»",sccue:"â½",sce:"âª°",scE:"âª´",Scedil:"Å",scedil:"Å",Scirc:"Å",scirc:"Å",scnap:"âªº",scnE:"âª¶",scnsim:"â©",scpolint:"â¨",scsim:"â¿",Scy:"Ð¡",scy:"Ñ",sdotb:"â¡",sdot:"â",sdote:"â©¦",searhk:"â¤¥",searr:"â",seArr:"â",searrow:"â",sect:"Â§",semi:";",seswar:"â¤©",setminus:"â",setmn:"â",sext:"â¶",Sfr:"ð",sfr:"ð°",sfrown:"â¢",sharp:"â¯",SHCHcy:"Ð©",shchcy:"Ñ",SHcy:"Ð¨",shcy:"Ñ",ShortDownArrow:"â",ShortLeftArrow:"â",shortmid:"â£",shortparallel:"â¥",ShortRightArrow:"â",ShortUpArrow:"â",shy:"Â­",Sigma:"Î£",sigma:"Ï",sigmaf:"Ï",sigmav:"Ï",sim:"â¼",simdot:"â©ª",sime:"â",simeq:"â",simg:"âª",simgE:"âª ",siml:"âª",simlE:"âª",simne:"â",simplus:"â¨¤",simrarr:"â¥²",slarr:"â",SmallCircle:"â",smallsetminus:"â",smashp:"â¨³",smeparsl:"â§¤",smid:"â£",smile:"â£",smt:"âªª",smte:"âª¬",smtes:"âª¬ï¸",SOFTcy:"Ð¬",softcy:"Ñ",solbar:"â¿",solb:"â§",sol:"/",Sopf:"ð",sopf:"ð¤",spades:"â ",spadesuit:"â ",spar:"â¥",sqcap:"â",sqcaps:"âï¸",sqcup:"â",sqcups:"âï¸",Sqrt:"â",sqsub:"â",sqsube:"â",sqsubset:"â",sqsubseteq:"â",sqsup:"â",sqsupe:"â",sqsupset:"â",sqsupseteq:"â",square:"â¡",Square:"â¡",SquareIntersection:"â",SquareSubset:"â",SquareSubsetEqual:"â",SquareSuperset:"â",SquareSupersetEqual:"â",SquareUnion:"â",squarf:"âª",squ:"â¡",squf:"âª",srarr:"â",Sscr:"ð®",sscr:"ð",ssetmn:"â",ssmile:"â£",sstarf:"â",Star:"â",star:"â",starf:"â",straightepsilon:"Ïµ",straightphi:"Ï",strns:"Â¯",sub:"â",Sub:"â",subdot:"âª½",subE:"â«",sube:"â",subedot:"â«",submult:"â«",subnE:"â«",subne:"â",subplus:"âª¿",subrarr:"â¥¹",subset:"â",Subset:"â",subseteq:"â",subseteqq:"â«",SubsetEqual:"â",subsetneq:"â",subsetneqq:"â«",subsim:"â«",subsub:"â«",subsup:"â«",succapprox:"âª¸",succ:"â»",succcurlyeq:"â½",Succeeds:"â»",SucceedsEqual:"âª°",SucceedsSlantEqual:"â½",SucceedsTilde:"â¿",succeq:"âª°",succnapprox:"âªº",succneqq:"âª¶",succnsim:"â©",succsim:"â¿",SuchThat:"â",sum:"â",Sum:"â",sung:"âª",sup1:"Â¹",sup2:"Â²",sup3:"Â³",sup:"â",Sup:"â",supdot:"âª¾",supdsub:"â«",supE:"â«",supe:"â",supedot:"â«",Superset:"â",SupersetEqual:"â",suphsol:"â",suphsub:"â«",suplarr:"â¥»",supmult:"â«",supnE:"â«",supne:"â",supplus:"â«",supset:"â",Supset:"â",supseteq:"â",supseteqq:"â«",supsetneq:"â",supsetneqq:"â«",supsim:"â«",supsub:"â«",supsup:"â«",swarhk:"â¤¦",swarr:"â",swArr:"â",swarrow:"â",swnwar:"â¤ª",szlig:"Ã",Tab:"\t",target:"â",Tau:"Î¤",tau:"Ï",tbrk:"â´",Tcaron:"Å¤",tcaron:"Å¥",Tcedil:"Å¢",tcedil:"Å£",Tcy:"Ð¢",tcy:"Ñ",tdot:"â",telrec:"â",Tfr:"ð",tfr:"ð±",there4:"â´",therefore:"â´",Therefore:"â´",Theta:"Î",theta:"Î¸",thetasym:"Ï",thetav:"Ï",thickapprox:"â",thicksim:"â¼",ThickSpace:"ââ",ThinSpace:"â",thinsp:"â",thkap:"â",thksim:"â¼",THORN:"Ã",thorn:"Ã¾",tilde:"Ë",Tilde:"â¼",TildeEqual:"â",TildeFullEqual:"â",TildeTilde:"â",timesbar:"â¨±",timesb:"â ",times:"Ã",timesd:"â¨°",tint:"â­",toea:"â¤¨",topbot:"â¶",topcir:"â«±",top:"â¤",Topf:"ð",topf:"ð¥",topfork:"â«",tosa:"â¤©",tprime:"â´",trade:"â¢",TRADE:"â¢",triangle:"âµ",triangledown:"â¿",triangleleft:"â",trianglelefteq:"â´",triangleq:"â",triangleright:"â¹",trianglerighteq:"âµ",tridot:"â¬",trie:"â",triminus:"â¨º",TripleDot:"â",triplus:"â¨¹",trisb:"â§",tritime:"â¨»",trpezium:"â¢",Tscr:"ð¯",tscr:"ð",TScy:"Ð¦",tscy:"Ñ",TSHcy:"Ð",tshcy:"Ñ",Tstrok:"Å¦",tstrok:"Å§",twixt:"â¬",twoheadleftarrow:"â",twoheadrightarrow:"â ",Uacute:"Ã",uacute:"Ãº",uarr:"â",Uarr:"â",uArr:"â",Uarrocir:"â¥",Ubrcy:"Ð",ubrcy:"Ñ",Ubreve:"Å¬",ubreve:"Å­",Ucirc:"Ã",ucirc:"Ã»",Ucy:"Ð£",ucy:"Ñ",udarr:"â",Udblac:"Å°",udblac:"Å±",udhar:"â¥®",ufisht:"â¥¾",Ufr:"ð",ufr:"ð²",Ugrave:"Ã",ugrave:"Ã¹",uHar:"â¥£",uharl:"â¿",uharr:"â¾",uhblk:"â",ulcorn:"â",ulcorner:"â",ulcrop:"â",ultri:"â¸",Umacr:"Åª",umacr:"Å«",uml:"Â¨",UnderBar:"_",UnderBrace:"â",UnderBracket:"âµ",UnderParenthesis:"â",Union:"â",UnionPlus:"â",Uogon:"Å²",uogon:"Å³",Uopf:"ð",uopf:"ð¦",UpArrowBar:"â¤",uparrow:"â",UpArrow:"â",Uparrow:"â",UpArrowDownArrow:"â",updownarrow:"â",UpDownArrow:"â",Updownarrow:"â",UpEquilibrium:"â¥®",upharpoonleft:"â¿",upharpoonright:"â¾",uplus:"â",UpperLeftArrow:"â",UpperRightArrow:"â",upsi:"Ï",Upsi:"Ï",upsih:"Ï",Upsilon:"Î¥",upsilon:"Ï",UpTeeArrow:"â¥",UpTee:"â¥",upuparrows:"â",urcorn:"â",urcorner:"â",urcrop:"â",Uring:"Å®",uring:"Å¯",urtri:"â¹",Uscr:"ð°",uscr:"ð",utdot:"â°",Utilde:"Å¨",utilde:"Å©",utri:"âµ",utrif:"â´",uuarr:"â",Uuml:"Ã",uuml:"Ã¼",uwangle:"â¦§",vangrt:"â¦",varepsilon:"Ïµ",varkappa:"Ï°",varnothing:"â",varphi:"Ï",varpi:"Ï",varpropto:"â",varr:"â",vArr:"â",varrho:"Ï±",varsigma:"Ï",varsubsetneq:"âï¸",varsubsetneqq:"â«ï¸",varsupsetneq:"âï¸",varsupsetneqq:"â«ï¸",vartheta:"Ï",vartriangleleft:"â²",vartriangleright:"â³",vBar:"â«¨",Vbar:"â««",vBarv:"â«©",Vcy:"Ð",vcy:"Ð²",vdash:"â¢",vDash:"â¨",Vdash:"â©",VDash:"â«",Vdashl:"â«¦",veebar:"â»",vee:"â¨",Vee:"â",veeeq:"â",vellip:"â®",verbar:"|",Verbar:"â",vert:"|",Vert:"â",VerticalBar:"â£",VerticalLine:"|",VerticalSeparator:"â",VerticalTilde:"â",VeryThinSpace:"â",Vfr:"ð",vfr:"ð³",vltri:"â²",vnsub:"ââ",vnsup:"ââ",Vopf:"ð",vopf:"ð§",vprop:"â",vrtri:"â³",Vscr:"ð±",vscr:"ð",vsubnE:"â«ï¸",vsubne:"âï¸",vsupnE:"â«ï¸",vsupne:"âï¸",Vvdash:"âª",vzigzag:"â¦",Wcirc:"Å´",wcirc:"Åµ",wedbar:"â©",wedge:"â§",Wedge:"â",wedgeq:"â",weierp:"â",Wfr:"ð",wfr:"ð´",Wopf:"ð",wopf:"ð¨",wp:"â",wr:"â",wreath:"â",Wscr:"ð²",wscr:"ð",xcap:"â",xcirc:"â¯",xcup:"â",xdtri:"â½",Xfr:"ð",xfr:"ðµ",xharr:"â·",xhArr:"âº",Xi:"Î",xi:"Î¾",xlarr:"âµ",xlArr:"â¸",xmap:"â¼",xnis:"â»",xodot:"â¨",Xopf:"ð",xopf:"ð©",xoplus:"â¨",xotime:"â¨",xrarr:"â¶",xrArr:"â¹",Xscr:"ð³",xscr:"ð",xsqcup:"â¨",xuplus:"â¨",xutri:"â³",xvee:"â",xwedge:"â",Yacute:"Ã",yacute:"Ã½",YAcy:"Ð¯",yacy:"Ñ",Ycirc:"Å¶",ycirc:"Å·",Ycy:"Ð«",ycy:"Ñ",yen:"Â¥",Yfr:"ð",yfr:"ð¶",YIcy:"Ð",yicy:"Ñ",Yopf:"ð",yopf:"ðª",Yscr:"ð´",yscr:"ð",YUcy:"Ð®",yucy:"Ñ",yuml:"Ã¿",Yuml:"Å¸",Zacute:"Å¹",zacute:"Åº",Zcaron:"Å½",zcaron:"Å¾",Zcy:"Ð",zcy:"Ð·",Zdot:"Å»",zdot:"Å¼",zeetrf:"â¨",ZeroWidthSpace:"â",Zeta:"Î",zeta:"Î¶",zfr:"ð·",Zfr:"â¨",ZHcy:"Ð",zhcy:"Ð¶",zigrarr:"â",zopf:"ð«",Zopf:"â¤",Zscr:"ðµ",zscr:"ð",zwj:"â",zwnj:"â"}},{}],56:[function(require,module,exports){module.exports={Aacute:"Ã",aacute:"Ã¡",Acirc:"Ã",acirc:"Ã¢",acute:"Â´",AElig:"Ã",aelig:"Ã¦",Agrave:"Ã",agrave:"Ã ",amp:"&",AMP:"&",Aring:"Ã",aring:"Ã¥",Atilde:"Ã",atilde:"Ã£",Auml:"Ã",auml:"Ã¤",brvbar:"Â¦",Ccedil:"Ã",ccedil:"Ã§",cedil:"Â¸",cent:"Â¢",copy:"Â©",COPY:"Â©",curren:"Â¤",deg:"Â°",divide:"Ã·",Eacute:"Ã",eacute:"Ã©",Ecirc:"Ã",ecirc:"Ãª",Egrave:"Ã",egrave:"Ã¨",ETH:"Ã",eth:"Ã°",Euml:"Ã",euml:"Ã«",frac12:"Â½",frac14:"Â¼",frac34:"Â¾",gt:">",GT:">",Iacute:"Ã",iacute:"Ã­",Icirc:"Ã",icirc:"Ã®",iexcl:"Â¡",Igrave:"Ã",igrave:"Ã¬",iquest:"Â¿",Iuml:"Ã",iuml:"Ã¯",laquo:"Â«",lt:"<",LT:"<",macr:"Â¯",micro:"Âµ",middot:"Â·",nbsp:"Â ",not:"Â¬",Ntilde:"Ã",ntilde:"Ã±",Oacute:"Ã",oacute:"Ã³",Ocirc:"Ã",ocirc:"Ã´",Ograve:"Ã",ograve:"Ã²",ordf:"Âª",ordm:"Âº",Oslash:"Ã",oslash:"Ã¸",Otilde:"Ã",otilde:"Ãµ",Ouml:"Ã",ouml:"Ã¶",para:"Â¶",plusmn:"Â±",pound:"Â£",quot:'"',QUOT:'"',raquo:"Â»",reg:"Â®",REG:"Â®",sect:"Â§",shy:"Â­",sup1:"Â¹",sup2:"Â²",sup3:"Â³",szlig:"Ã",THORN:"Ã",thorn:"Ã¾",times:"Ã",Uacute:"Ã",uacute:"Ãº",Ucirc:"Ã",ucirc:"Ã»",Ugrave:"Ã",ugrave:"Ã¹",uml:"Â¨",Uuml:"Ã",uuml:"Ã¼",Yacute:"Ã",yacute:"Ã½",yen:"Â¥",yuml:"Ã¿"}},{}],57:[function(require,module,exports){module.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],58:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],59:[function(require,module,exports){module.exports=function(string){return string.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],60:[function(require,module,exports){module.exports=function(){for(var target={},i=0;i<arguments.length;i++){var key,source=arguments[i];for(key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var hasOwnProperty=Object.prototype.hasOwnProperty},{}]},{},[1])(1)}),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.iiifEventedCanvas=factory():root.iiifEventedCanvas=factory()}(this,function(){return modules=[function(module,exports){function ImageResource(config){"use strict";this.id=config.id,this.label=config.label||"No Label",this.needed=config.needed||!1,this.visible=config.visible||!1,this.clipRegion=config.clipRegion,this.opacity=config.opacity||1,this.bounds=config.bounds||{x:0,y:0,width:1,height:1},this.zIndex=config.zIndex,this.tileSource=config.tileSource,this.thumbUrl=config.thumbUrl,this.dynamic=config.dynamic||!1,this.imageType=config.imageType||"main",this.status="initialized",this.parent=config.parent,this.dispatcher=config.parent.dispatcher}ImageResource.prototype={show:function(timeout){this.needed||this.setNeeded(!0),this.visible=!0,this.dispatcher.emit("image-show",this)},hide:function(timeout){this.visible=!1,this.dispatcher.emit("image-hide",this)},getVisible:function(){return this.visible},setNeeded:function(needed){(this.needed=needed)&&this.dispatcher.emit("image-needed",this)},getThumbnailNeeded:function(){return this.needed},getFullNeeded:function(){return this.needed},setOpacity:function(opacity){this.opacity=opacity,this.visible&&this.dispatcher.emit("image-opacity-updated",this)},getOpacity:function(){return this.opacity},getImageType:function(){return this.imageType},getLocalBounds:function(){return this.bounds},getGlobalBounds:function(){return{x:this.parent.bounds.x+this.parent.bounds.width*this.bounds.x,y:this.parent.bounds.y+this.parent.bounds.width*this.bounds.y,width:this.parent.bounds.width*this.bounds.width,height:this.parent.bounds.height*this.bounds.height}},containsGlobalPoint:function(point){var bounds=this.getGlobalBounds(),rectRight=bounds.x+bounds.width,rectBottom=bounds.y+bounds.height;return bounds.x<=point.x&&rectRight>=point.x&&bounds.y<=point.y&&rectBottom>=point.y},setStatus:function(status){this.status=status,this.dispatcher.emit("image-status-updated",this)},getStatus:function(){return this.status},remove:function(){this.dispatcher.emit("image-removed",this)},moveToIndex:function(index){this.parent.moveToIndex(this,index)},moveToBottom:function(){this.parent.moveToBottom(this)},moveToTop:function(image){this.parent.moveToTop(this)},insertAboveIndex:function(image,index){this.parent.insertAboveIndex(this,index)},insertBelowIndex:function(image,index){this.parent.insertBelowIndex(this,index)},insertAboveResource:function(image,resource){this.parent.insertAboveResource(this,resource)},insertBelowResource:function(image,resource){this.parent.insertBelowResource(this,resource)},moveUpOne:function(image){this.parent.moveUpOne(this)},moveDownOne:function(image){this.parent.moveDownOne(this)}},module.exports=ImageResource},function(module,exports,ThumbnailFactory){"use strict";function getThumbUrl(resource,width){var serviceVersion="http://iiif.io/api/image/2/context.json"==resource["@context"]?"2.0":"1.1",id=resource["@id"];if((id="string"==typeof resource||resource instanceof String?resource:id).toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/))return id.replace("/full/full/","/full/"+width+",/");var format=function(mimeType){switch(mimeType){case"image/jpeg":case"image/jpg":return"jpg";case"image/png":return"png";case"image/gif":return"gif";default:return"jpg"}}(resource.format);return resource.service?resource.service["@id"]+"/full/"+width+",/0/"+("2.0"===serviceVersion?"default":"native")+"."+format:id}function makeThumbnailConfig(resource,parent){var bounds=parent.getBounds();return{tileSource:{type:"legacy-image-pyramid",levels:[getThumbLevel(resource,bounds.width,bounds.height)]},parent:parent,imageType:"thumbnail",dynamic:!1,zIndex:9999}}var ImageResource=ThumbnailFactory(0),getThumbLevel=function(resource,width,height){var scaleFactor=200/width,scaledWidth=width*scaleFactor;return resource.default?getThumbLevel(resource.default,scaledWidth,height*scaleFactor):{url:getThumbUrl(resource,scaledWidth),height:height,width:width}},ThumbnailFactory=function(canvas,parent){if(canvas.thumbnail)return new ImageResource(makeThumbnailConfig(canvas.thumbnail,parent));if(canvas.images)try{var config=makeThumbnailConfig(canvas.images[0].resource,parent);return new ImageResource(config)}catch(error){if("Unsupported image format for LegacyTileSource."==error)return"A thumbnail cannot be built for this object";throw error}};ThumbnailFactory.getThumbUrl=getThumbUrl,module.exports=ThumbnailFactory},function(module,exports,CanvasObject){CanvasObject(0);var ImageResourceFactory=CanvasObject(3),ThumbnailFactory=CanvasObject(1),CanvasObject=function(config){"use strict";var self=this;this.dispatcher=config.dispatcher,this.id=config.canvas["@id"],this.label=config.canvas.label,this.canvas=config.canvas,this.clipRegion=config.clipRegion,this.opacity=config.opacity||1,this.index=config.index,this.bounds={x:config.x||0,y:config.y||0,height:config.canvas.height,width:config.canvas.width},this.viewingHint=config.canvas.viewingHint,this.images=[],config.canvas.images&&config.canvas.images.forEach(function(imageResources){imageResources=ImageResourceFactory(imageResources,self);imageResources&&(self.images=self.images.concat(imageResources))}),this.thumbnailResource=ThumbnailFactory(this.canvas,self)};CanvasObject.prototype={containsPoint:function(point){var rectRight=this.bounds.x+this.bounds.width,rectBottom=this.bounds.y+this.bounds.height;return this.bounds.x<=point.x&&rectRight>=point.x&&this.bounds.y<=point.y&&rectBottom>=point.y},getVisibleImages:function(){return this.images.filter(function(image){return!0===image.visible})},getAlternateImages:function(){return this.images.filter(function(image){return"alternate"===image.imageType})},getMainImages:function(){return this.images.filter(function(image){return"main"===image.imageType})},getImageById:function(id){return this.images.filter(function(image){return image.id===id})[0]},getThumbnailResource:function(){return this.thumbnailResource},setBounds:function(x,y,width,height){this.bounds.x=x,this.bounds.y=y,this.bounds.width=width,this.bounds.height=height,this.dispatcher.emit("canvas-position-updated",this)},getBounds:function(){var self=this;return{x:this.bounds.x,y:this.bounds.y,width:this.bounds.width,height:this.bounds.height,getTopLeft:function(){return{x:self.bounds.x,y:self.bounds.y}}}},canvasToWorldCoordinates:function(canvasRegion){var scaleFactor=this.bounds.width/this.canvas.width;return{x:this.bounds.x+canvasRegion.x*scaleFactor,y:this.bounds.y+canvasRegion.y*scaleFactor,width:canvasRegion.width*scaleFactor,height:canvasRegion.height*scaleFactor}},getAspectRatio:function(){return this.bounds.width/this.bounds.height},getThumbnailNeeded:function(){return this.thumbnailNeeded},setThumbnailNeeded:function(needed){(this.thumbnailNeeded=needed)&&(this.thumbnailResource.setNeeded(!0),this.dispatcher.emit("canvas-thumbnail-needed",this))},show:function(timeout){var self=this;this.needed||this.setNeeded(!0),this.visible=!0,this.getMainImages().forEach(function(image){image.show(),self.dispatcher.on("image-status-updated",function(){"drawn"===image.getStatus()&&self.thumbnailResource.remove()})}),this.dispatcher.emit("canvas-show",this)},hide:function(timeout){this.visible=!1,this.dispatcher.emit("canvas-hide",this)},getVisible:function(){return this.visible},setNeeded:function(needed){(this.needed=needed)&&this.dispatcher.emit("canvas-needed",this)},getNeeded:function(){return this.needed},getOpacity:function(){return this.opacity},setOpacity:function(opacity){this.opacity=opacity,this.images.forEach(function(image){image.updateOpacity()})},_floatImagesToBottom:function(){for(var i=0;i<this.images;i++)this.images[i].zIndex=i,this.images[i].updateItemIndex()},moveToIndex:function(image,index){this._floatImagesToBottom();var oldIndex=this.images.indexOf(image);if(index!==oldIndex&&-1!==oldIndex){if(index>=this.images.length)throw new Error("Index bigger than number of images.");image.zIndex=index,this.images.splice(oldIndex,1),this.images.splice(index,0,image),image.updateItemIndex()}},moveToBottom:function(image){this.moveToIndex(image,0)},moveToTop:function(image){this.moveToIndex(image,this.images.length-1)},insertAboveIndex:function(image,index){0!==index&&this.moveToIndex(image,index-1)},insertBelowIndex:function(image,index){index<this.images.length-1&&this.moveToIndex(image,index+1)},insertAboveResource:function(image,resource){this.insertAboveIndex(image,this.images.indexOf(resource))},insertBelowResource:function(image,resource){this.insertBelowIndex(image,this.images.indexOf(resource))},moveUpOne:function(image){this.insertAboveResource(image,image)},moveDownOne:function(image){this.insertBelowResource(image,image)}},module.exports=CanvasObject},function(module,exports,__webpack_require__){function _buildChoiceConfigs(resource){function _buildImageChoice(config,type){return(config=_buildImageConfig(config))&&(config.imageType=type),config}var configs=[],choice=_buildImageChoice(resource.default,"main");return choice&&configs.push(choice),resource.item.forEach(function(choice){choice=_buildImageChoice(choice,"alternate");choice&&configs.push(choice)}),configs}var ImageResource=__webpack_require__(0),ThumbnailFactory=__webpack_require__(1),_getRectFromStringArray=function(rectArray){rectArray=rectArray.map(function(number){return parseInt(number,10)});return{x:rectArray[0],y:rectArray[1],width:rectArray[2],height:rectArray[3]}},_getSegmentFromUrl=function(segment){var bounds=segment.split("#"),segment=null;return 1<bounds.length&&(bounds=bounds[1].split("="),segment=_getRectFromStringArray(bounds[1].split(","))),segment},_buildImageConfig=function(resource){if("rdf:nil"!=resource){if(resource.full)return _buildImageConfig(resource.full);var isDynamic=!!resource.service&&("http://iiif.io/api/image/2/context.json"==resource.service["@context"]||"https://iiif.io/api/image/2/context.json"==resource.service["@context"]||"http://iiif.io/api/image/1/context.json"==resource.service["@context"]||"https://iiif.io/api/image/1/context.json"==resource.service["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"==resource.service["@context"]),idObj=resource,id=(idObj=isDynamic?resource.service:idObj)["@id"];return{id:id.replace(/[^a-z0-9-_]+/gi,"")+Math.floor(1e3*Math.random()),label:resource.label,tileSource:isDynamic?id.replace(/\/+$/,"")+"/info.json":{type:"image",url:id},clipRegion:_getSegmentFromUrl(id),dynamic:isDynamic,thumbUrl:ThumbnailFactory.getThumbUrl(resource,200)}}};module.exports=function(image,parent){function _makeImageFromConfig(config){if(config){config.parent=parent;var bounds=_getSegmentFromUrl(image.on);return bounds&&(config.imageType="detail",config.bounds=function(bounds){return{x:bounds.x/parent.bounds.width,y:bounds.y/parent.bounds.width,width:bounds.width/parent.bounds.width,height:bounds.height/parent.bounds.height}}(bounds)),new ImageResource(config)}}var resourceType=image.resource["@type"];switch(resourceType){case"dctypes:Image":case"dcTypes:Image":case"dcterms:Image":case"dcTerms:Image":var config=_buildImageConfig(image.resource,parent);return _makeImageFromConfig(config);case"oa:Choice":return _buildChoiceConfigs(image.resource).map(_makeImageFromConfig);case"oa:SpecificResource":var clipArray=image.resource;return(config=_buildImageConfig(clipArray))&&clipArray.selector&&clipArray.selector.region&&(clipArray=clipArray.selector.region.split(","),config.clipRegion=_getRectFromStringArray(clipArray)),_makeImageFromConfig(config);default:throw new Error("Cannot create an image from type "+resourceType)}}},function(module,exports,CanvasObject){CanvasObject=CanvasObject(2);module.exports=CanvasObject}],installedModules={},__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=4);function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var modules,installedModules}),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.manifestLayout=factory():root.manifestLayout=factory()}(this,function(){return modules=[function(module,exports){module.exports=function(options){options.maxCanvasHeight,options.maxCanvasWidth,options.minCanvasWidth,options.minCanvasHeight;var canvasHeight=options.canvasHeight*options.scaleFactor||100,framePadding=(options.canvasWidth,options.scaleFactor,options.scaleFactor,options.columns,{top:options.framePadding.top||0,bottom:options.framePadding.bottom||0,left:options.framePadding.left||0,right:options.framePadding.right||0}),facingCanvasPadding=options.facingCanvasPadding,containerHeight=(options.minimumImageGap,options.height),containerWidth=options.width,canvases=options.canvases,selectedCanvas=options.selectedCanvas,viewingDirection=(options.framingStrategy,options.viewingDirection||"left-to-right"),viewingMode=options.viewingMode||"individuals",viewport=(options.viewingMode,function(width,height,verticalMargin){var horizontalMargin,viewport={padding:verticalMargin||{top:0,left:0,right:0,bottom:0},width:width,height:height,aspectRatio:width/height};return horizontalMargin=viewport.padding.left+viewport.padding.right,verticalMargin=viewport.padding.top+viewport.padding.bottom,viewport.paddedWidth=width-width*(horizontalMargin/100),viewport.paddedHeight=height-height*(verticalMargin/100),viewport.paddedAspectRatio=viewport.paddedWidth/viewport.paddedHeight,viewport}(containerWidth,containerHeight,options.viewportPadding));function pruneCanvas(canvas,index){return{id:canvas["@id"],label:canvas.label,height:canvas.height,width:canvas.width,aspectRatio:canvas.width/canvas.height,selected:canvas["@id"]===selectedCanvas,sequencePosition:index}}function fitHeight(canvas,canvasHeight){canvas.aspectRatio;var scaleFactor=canvasHeight/canvas.height;return canvas.height=canvasHeight,canvas.width=canvas.width*scaleFactor,canvas}function frame(canvas,padding){return canvas.localX=padding.left,canvas.localY=padding.top,{width:canvas.width+padding.left+padding.right,height:canvas.height+padding.top+padding.bottom,canvas:canvas}}function bindCanvases(canvases,viewingMode,viewingDirection,framePadding,facingCanvasPadding){if("paged"===viewingMode){var pages=canvases.filter(function(canvas){return"non-paged"!==canvas.viewingHint});return"left-to-right"===viewingDirection?pages.map(function(canvas,index){var boundPagePadding;return 0===index?((boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:framePadding.right}).left=canvas.width+facingCanvasPadding/100*canvas.width,frame(canvas,boundPagePadding)):frame(canvas,boundPagePadding=(index+1)%2==0?{top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:canvas.width*facingCanvasPadding/100/2}:{top:framePadding.top,bottom:framePadding.bottom,left:canvas.width*facingCanvasPadding/100/2,right:framePadding.right})}):"right-to-left"===viewingDirection?pages.map(function(canvas,index){var boundPagePadding;return 0===index?((boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:canvas.width*facingCanvasPadding/100/2}).left=canvas.width+facingCanvasPadding/100*canvas.width,frame(canvas,boundPagePadding)):frame(canvas,boundPagePadding=(index+1)%2==0?{top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:canvas.width*facingCanvasPadding/100/2}:{top:framePadding.top,bottom:framePadding.bottom,left:canvas.width*facingCanvasPadding/100/2,right:framePadding.right})}):void 0}if("continuous"!==viewingMode)return canvases.map(function(canvas){return frame(canvas,framePadding)});var boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:0,right:0};return canvases.map(function(canvas){return frame(canvas,boundPagePadding)})}var Lines=function(lineWidth,frames){this.x=0,this.y=0,this.lineWidth=lineWidth,this.frames=frames};function updateCanvases(frames){return frames.forEach(function(frame){frame.canvas.x=frame.x+frame.canvas.localX,frame.canvas.y=frame.y+frame.canvas.localY}),frames}function overviewLayout(){var frames=bindCanvases(canvases.map(pruneCanvas).map(function(canvas){return fitHeight(canvas,canvasHeight)}),viewingMode,viewingDirection,framePadding,facingCanvasPadding);return(frames=updateCanvases(frames=function(frames){return frames.map(function(frame){return frame.x=frame.x+containerWidth*viewport.padding.left/100,frame.y=frame.y+containerHeight*viewport.padding.top/100,frame})}(function(frames,lineWidth){var lines=new Lines(lineWidth,frames);return frames.map(function(frame){var lineStats=lines.addItem(frame);return frame.x=lineStats.x,frame.y=lineStats.y,frame.canvas.x=frame.x+frame.canvas.localX,frame.canvas.y=frame.y+frame.canvas.localY,frame})}(frames,viewport.paddedWidth)))).filter(function(frame){return frame.canvas.selected})[0].vantage=function(vantage){var selectedVantageTop=vantage.filter(function(frame){return frame.canvas.selected})[0],vantage=padVantage({x:0,y:0,width:viewport.paddedWidth,height:viewport.paddedHeight});{if(selectedVantageTop){selectedVantageTop=function(frame){return{x:frame.x+frame.width/2,y:frame.y+frame.height/2}}(selectedVantageTop).y-vantage.height/2;return vantage.x=0,vantage.y=selectedVantageTop<0?0:selectedVantageTop,vantage}return vantage}}(frames),frames}function intermediateLayoutHorizontal(frames){var selectedFrame=frames.filter(function(frame){return frame.canvas.selected})[0],facingCanvas=getFacingCanvas(selectedFrame.canvas,frames),canvasPosition=selectedFrame.canvas.sequencePosition;return selectedFrame.vantage=getVantageForCanvas(selectedFrame.canvas,facingCanvas),"continuous"!==viewingMode&&frames.forEach(function(frame,index,allFrames){frame.y===selectedFrame.y&&frame.canvas.id!==selectedFrame.canvas.id?"paged"===viewingMode&&frame.canvas.id===facingCanvas.id||("left-to-right"===viewingDirection?frame.x=index<canvasPosition?frame.x-(selectedFrame.vantage.leftMargin+framePadding.left):frame.x+(selectedFrame.vantage.rightMargin+framePadding.right):"right-to-left"===viewingDirection&&(frame.x=canvasPosition<index?frame.x-(selectedFrame.vantage.leftMargin+framePadding.left):frame.x+(selectedFrame.vantage.rightMargin+framePadding.right))):frame.y>selectedFrame.y?frame.y=frame.y+(selectedFrame.vantage.bottomMargin+framePadding.bottom):frame.y<selectedFrame.y&&(frame.y=frame.y-(selectedFrame.vantage.topMargin+framePadding.top))}),frames=updateCanvases(frames)}Lines.prototype={_getFacingFrame:function(index){var type=function(index){return 0===index?"firstPage":index%2==0?"rightPage":"leftPage"}(index);return"leftPage"===type?this.frames[index+1]:"rightPage"===type?this.frames[index-1]:null},addItem:function(frame){var output,facingFrame,lineItemWidth=frame.width;return"paged"!==viewingMode||(facingFrame=this._getFacingFrame(frame.canvas.sequencePosition))&&(facingFrame.canvas.sequencePosition>frame.canvas.sequencePosition?lineItemWidth+=facingFrame.width:lineItemWidth=0),"left-to-right"===viewingDirection&&(this.x+lineItemWidth>this.lineWidth&&(this.x=0,this.y+=frame.height),output={x:this.x,y:this.y},this.x+=frame.width),"right-to-left"===viewingDirection&&(this.x-lineItemWidth>this.lineWidth&&(this.x=0,this.y+=frame.height),output={x:this.lineWidth-(this.x-lineItemWidth),y:this.y},this.x+=frame.width),output}};function getVantageForCanvas(selectedCanvas,pairHeight){var combinedCanvasWidths,x,selectionIndex;return function(boundingBox){var vantageWidth,vantageHeight,horizontalMargin,verticalMargin=boundingBox.width/boundingBox.height;viewport.paddedAspectRatio>=verticalMargin?(vantageHeight=100*boundingBox.height/90,vantageWidth=vantageHeight*viewport.paddedAspectRatio):(vantageWidth=100*boundingBox.width/90,vantageHeight=vantageWidth/viewport.paddedAspectRatio);return horizontalMargin=(vantageWidth-boundingBox.width)/2,verticalMargin=(vantageHeight-boundingBox.height)/2,padVantage({x:boundingBox.x-horizontalMargin,y:boundingBox.y-verticalMargin,width:vantageWidth,height:vantageHeight,topMargin:verticalMargin,bottomMargin:verticalMargin,leftMargin:horizontalMargin,rightMargin:horizontalMargin})}("paged"===viewingMode?(pairHeight=0===(selectionIndex=selectedCanvas.sequencePosition)?(combinedCanvasWidths=2*selectedCanvas.width,x=selectedCanvas.x-selectedCanvas.width,selectedCanvas.height):(x=selectionIndex%2==0?(combinedCanvasWidths=selectedCanvas.width+pairHeight.width,combinedCanvasWidths+=facingCanvasPadding/100*combinedCanvasWidths,pairHeight.x):(combinedCanvasWidths=selectedCanvas.width+pairHeight.width,combinedCanvasWidths+=facingCanvasPadding/100*combinedCanvasWidths,selectedCanvas.x),Math.max(selectedCanvas.height,pairHeight.height)),{x:x,y:selectedCanvas.y,width:combinedCanvasWidths,height:pairHeight}):(x=selectedCanvas.x,{x:selectedCanvas.x,y:selectedCanvas.y,width:selectedCanvas.width,height:selectedCanvas.height}))}function padVantage(vantage){var paddedVantageWidth=viewport.padding.left+viewport.padding.right,paddedVantageHeight=viewport.padding.top+viewport.padding.bottom,paddedVantageWidth=100*vantage.width/(100-paddedVantageWidth),paddedVantageHeight=100*vantage.height/(100-paddedVantageHeight);return{x:vantage.x-paddedVantageWidth*(viewport.padding.left/100),y:vantage.y-paddedVantageHeight*(viewport.padding.top/100),width:paddedVantageWidth,height:paddedVantageHeight,topMargin:vantage.topMargin+paddedVantageHeight*viewport.padding.top/100,bottomMargin:vantage.bottomMargin+paddedVantageHeight*viewport.padding.bottom/100,leftMargin:vantage.leftMargin+paddedVantageWidth*(viewport.padding.left/100),rightMargin:vantage.rightMargin+paddedVantageWidth*(viewport.padding.right/100)}}function getFacingCanvas(canvas,frames){var selectedIndex;return frames.forEach(function(frame,index){frame.canvas.id===canvas.id&&(selectedIndex=index)}),0===selectedIndex?canvas.id:(selectedIndex===frames.length-1?frames[selectedIndex]:(selectedIndex+1)%2==0?frames[selectedIndex+1]:frames[selectedIndex-1]).canvas}return{overview:overviewLayout,intermediate:function(){return intermediateLayoutHorizontal(overviewLayout())},detail:function(){return function(){var frames=bindCanvases(canvases.map(pruneCanvas).map(function(canvas){return fitHeight(canvas,canvasHeight)}),viewingMode,viewingDirection,framePadding,facingCanvasPadding),x=0;"left-to-right"===viewingDirection?(frames.forEach(function(frame){frame.x=x,frame.y=0,x+=frame.width}),updateCanvases(frames),frames=intermediateLayoutHorizontal(frames)):"right-to-left"===viewingDirection&&(frames.reverse().forEach(function(frame){frame.x=x,frame.y=0,x+=frame.width}),updateCanvases(frames),frames=intermediateLayoutHorizontal(frames.reverse()));return frames}()},viewport:viewport}}}],installedModules={},__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0);function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var modules,installedModules}),function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t),t}:n(jQuery)}(function(d){var e=function(){var e,t,n,h,o,s,f,g,m,v,y,_,r,a,w,l;function b(e,t){return r.call(e,t)}function c(e,s){var n,i,r,o,a,l,c,u,d,p,h=s&&s.split("/"),f=y.map,g=f&&f["*"]||{};if(e){for(s=(e=e.split("/")).length-1,y.nodeIdCompat&&w.test(e[s])&&(e[s]=e[s].replace(w,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),u=0;u<e.length;u++)if("."===(p=e[u]))e.splice(u,1),--u;else if(".."===p){if(0===u||1===u&&".."===e[2]||".."===e[u-1])continue;0<u&&(e.splice(u-1,2),u-=2)}e=e.join("/")}if((h||g)&&f){for(u=(n=e.split("/")).length;0<u;--u){if(i=n.slice(0,u).join("/"),h)for(d=h.length;0<d;--d)if(r=(r=f[h.slice(0,d).join("/")])&&r[i]){o=r,a=u;break}if(o)break;!l&&g&&g[i]&&(l=g[i],c=u)}!o&&l&&(o=l,a=c),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function A(t,n){return function(){var e=a.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),s.apply(h,e.concat([t,n]))}}function D(e){var t;if(b(v,e)&&(t=v[e],delete v[e],_[e]=!0,o.apply(h,t)),!b(m,e)&&!b(_,e))throw new Error("No "+e);return m[e]}function u(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return e?u(e):[]}return(e=d&&d.fn&&d.fn.select2&&d.fn.select2.amd?d.fn.select2.amd:e)&&e.requirejs||(e?n=e:e={},m={},v={},y={},_={},r=Object.prototype.hasOwnProperty,a=[].slice,w=/\.js$/,f=function(e,s){var n,i,r=u(e),o=r[0],s=s[1];return e=r[1],o&&(n=D(o=c(o,s))),o?e=n&&n.normalize?n.normalize(e,(i=s,function(e){return c(e,i)})):c(e,s):(o=(r=u(e=c(e,s)))[0],e=r[1],o&&(n=D(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},g={require:function(e){return A(e)},exports:function(e){var t=m[e];return void 0!==t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:(t=e,function(){return y&&y.config&&y.config[t]||{}})};var t}},o=function(e,t,n,i){var r,o,a,l,u,d=[],s=typeof n,c=S(i=i||e);if("undefined"==s||"function"==s){for(t=!t.length&&n.length?["require","exports","module"]:t,l=0;l<t.length;l+=1)if("require"===(o=(a=f(t[l],c)).f))d[l]=g.require(e);else if("exports"===o)d[l]=g.exports(e),u=!0;else if("module"===o)r=d[l]=g.module(e);else if(b(m,o)||b(v,o)||b(_,o))d[l]=D(o);else{if(!a.p)throw new Error(e+" missing "+o);a.p.load(a.n,A(i,!0),function(t){return function(e){m[t]=e}}(o),{}),d[l]=m[o]}s=n?n.apply(m[e],d):void 0,e&&(r&&r.exports!==h&&r.exports!==m[e]?m[e]=r.exports:s===h&&u||(m[e]=s))}else e&&(m[e]=n)},t=n=s=function(e,t,n,i,r){if("string"==typeof e)return g[e]?g[e](t):D(f(e,S(t)).f);if(!e.splice){if((y=e).deps&&s(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=h}return t=t||function(){},"function"==typeof n&&(n=i,i=r),i?o(h,e,t,n):setTimeout(function(){o(h,e,t,n)},4),s},s.config=function(e){return s(e)},t._defined=m,(l=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),b(m,e)||b(v,e)||(v[e]=[e,t,n])}).amd={jQuery:!0},e.requirejs=t,e.require=n,e.define=l),e.define("almond",function(){}),e.define("jquery",[],function(){var e=d||$;return null==e&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),e}),e.define("select2/utils",["jquery"],function(o){var r={};function u(e){var i,t=e.prototype,n=[];for(i in t)"function"==typeof t[i]&&"constructor"!==i&&n.push(i);return n}function e(){this.listeners={}}r.Extend=function(e,t){var r,n={}.hasOwnProperty;function i(){this.constructor=e}for(r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},r.Decorate=function(i,r){var e=u(r),t=u(i);function o(){var e=Array.prototype.unshift,t=r.prototype.constructor.length,n=i.prototype.constructor;0<t&&(e.call(arguments,i.prototype.constructor),n=r.prototype.constructor),n.apply(this,arguments)}r.displayName=i.displayName,o.prototype=new function(){this.constructor=o};for(var n=0;n<t.length;n++){var s=t[n];o.prototype[s]=i.prototype[s]}for(var l=0;l<e.length;l++){var c=e[l];o.prototype[c]=function(e){var t=function(){};e in o.prototype&&(t=o.prototype[e]);var n=r.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),n.apply(this,arguments)}}(c)}return o},e.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},e.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},0===(n=null==n?[]:n).length&&n.push({}),(n[0]._type=e)in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},e.prototype.invoke=function(e,t){for(var n=0,i=e.length;n<i;n++)e[n].apply(this,t)},r.Observable=e,r.generateChars=function(e){for(var t="",n=0;n<e;n++)t+=Math.floor(36*Math.random()).toString(36);return t},r.bind=function(e,t){return function(){e.apply(t,arguments)}},r._convertData=function(e){for(var t in e){var n=t.split("-"),i=e;if(1!==n.length){for(var r=0;r<n.length;r++){var o=n[r];(o=o.substring(0,1).toLowerCase()+o.substring(1))in i||(i[o]={}),r==n.length-1&&(i[o]=e[t]),i=i[o]}delete e[t]}}return e},r.hasScroll=function(e,t){var n=o(t),i=t.style.overflowX,r=t.style.overflowY;return(i!==r||"hidden"!==r&&"visible"!==r)&&("scroll"===i||"scroll"===r||n.innerHeight()<t.scrollHeight||n.innerWidth()<t.scrollWidth)},r.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},r.appendMany=function(e,t){var n;"1.7"===o.fn.jquery.substr(0,3)&&(n=o(),o.map(t,function(e){n=n.add(e)}),t=n),e.append(t)},r.__cache={};var n=0;return r.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null==t&&(e.id?(t=e.id,e.setAttribute("data-select2-id",t)):(e.setAttribute("data-select2-id",++n),t=n.toString())),t},r.StoreData=function(i,t,n){i=r.GetUniqueElementId(i);r.__cache[i]||(r.__cache[i]={}),r.__cache[i][t]=n},r.GetData=function(e,t){var n=r.GetUniqueElementId(e);return t?r.__cache[n]&&null!=r.__cache[n][t]?r.__cache[n][t]:o(e).data(t):r.__cache[n]},r.RemoveData=function(e){var t=r.GetUniqueElementId(e);null!=r.__cache[t]&&delete r.__cache[t],e.removeAttribute("data-select2-id")},r}),e.define("select2/results",["jquery","./utils"],function(h,f){function i(e,t,n){this.$element=e,this.data=n,this.options=t,i.__super__.constructor.call(this)}return f.Extend(i,f.Observable),i.prototype.render=function(){var e=h('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&e.attr("aria-multiselectable","true"),this.$results=e},i.prototype.clear=function(){this.$results.empty()},i.prototype.displayMessage=function(e){var t=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var n=h('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),i=this.options.get("translations").get(e.message);n.append(t(i(e.args))),n[0].className+=" select2-results__message",this.$results.append(n)},i.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},i.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var r=e.results[n],r=this.option(r);t.push(r)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},i.prototype.position=function(e,t){t.find(".select2-results").append(e)},i.prototype.sort=function(e){return this.options.get("sorter")(e)},i.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");(0<t.length?t:e).first().trigger("mouseenter"),this.ensureHighlightVisible()},i.prototype.setClasses=function(){var t=this;this.data.current(function(e){var i=h.map(e,function(e){return e.id.toString()});t.$results.find(".select2-results__option[aria-selected]").each(function(){var e=h(this),t=f.GetData(this,"data"),n=""+t.id;null!=t.element&&t.element.selected||null==t.element&&-1<h.inArray(n,i)?e.attr("aria-selected","true"):e.attr("aria-selected","false")})})},i.prototype.showLoading=function(n){this.hideLoading();n={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(n)},n=this.option(n);n.className+=" loading-results",this.$results.prepend(n)},i.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},i.prototype.option=function(e){var t=document.createElement("li");t.className="select2-results__option";var r,n={role:"option","aria-selected":"false"},p=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(r in(null!=e.element&&p.call(e.element,":disabled")||null==e.element&&e.disabled)&&(delete n["aria-selected"],n["aria-disabled"]="true"),null==e.id&&delete n["aria-selected"],null!=e._resultId&&(t.id=e._resultId),e.title&&(t.title=e.title),e.children&&(n.role="group",n["aria-label"]=e.text,delete n["aria-selected"]),n){var o=n[r];t.setAttribute(r,o)}if(e.children){var s=h(t),a=document.createElement("strong");a.className="select2-results__group",h(a),this.template(e,a);for(var l=[],c=0;c<e.children.length;c++){var d=e.children[c],d=this.option(d);l.push(d)}p=h("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});p.append(l),s.append(a),s.append(p)}else this.template(e,t);return f.StoreData(t,"data",e),t},i.prototype.bind=function(t,e){var l=this,n=t.id+"-results";this.$results.attr("id",n),t.on("results:all",function(e){l.clear(),l.append(e.data),t.isOpen()&&(l.setClasses(),l.highlightFirstItem())}),t.on("results:append",function(e){l.append(e.data),t.isOpen()&&l.setClasses()}),t.on("query",function(e){l.hideMessages(),l.showLoading(e)}),t.on("select",function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())}),t.on("unselect",function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())}),t.on("open",function(){l.$results.attr("aria-expanded","true"),l.$results.attr("aria-hidden","false"),l.setClasses(),l.ensureHighlightVisible()}),t.on("close",function(){l.$results.attr("aria-expanded","false"),l.$results.attr("aria-hidden","true"),l.$results.removeAttr("aria-activedescendant")}),t.on("results:toggle",function(){var e=l.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),t.on("results:select",function(){var t,e=l.getHighlightedResults();0!==e.length&&(t=f.GetData(e[0],"data"),"true"==e.attr("aria-selected")?l.trigger("close",{}):l.trigger("select",{data:t}))}),t.on("results:previous",function(){var i,o=l.getHighlightedResults(),s=l.$results.find("[aria-selected]"),a=s.index(o);a<=0||(i=a-1,0===o.length&&(i=0),(a=s.eq(i)).trigger("mouseenter"),o=l.$results.offset().top,s=a.offset().top,a=l.$results.scrollTop()+(s-o),0===i?l.$results.scrollTop(0):s-o<0&&l.$results.scrollTop(a))}),t.on("results:next",function(){var s,r=l.getHighlightedResults(),o=l.$results.find("[aria-selected]"),n=o.index(r)+1;n>=o.length||((s=o.eq(n)).trigger("mouseenter"),r=l.$results.offset().top+l.$results.outerHeight(!1),o=s.offset().top+s.outerHeight(!1),s=l.$results.scrollTop()+o-r,0===n?l.$results.scrollTop(0):r<o&&l.$results.scrollTop(s))}),t.on("results:focus",function(e){e.element.addClass("select2-results__option--highlighted")}),t.on("results:message",function(e){l.displayMessage(e)}),h.fn.mousewheel&&this.$results.on("mousewheel",function(e){var i=l.$results.scrollTop(),r=l.$results.get(0).scrollHeight-i+e.deltaY,i=0<e.deltaY&&i-e.deltaY<=0,r=e.deltaY<0&&r<=l.$results.height();i?(l.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):r&&(l.$results.scrollTop(l.$results.get(0).scrollHeight-l.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(e){var t=h(this),n=f.GetData(this,"data");"true"!==t.attr("aria-selected")?l.trigger("select",{originalEvent:e,data:n}):l.options.get("multiple")?l.trigger("unselect",{originalEvent:e,data:n}):l.trigger("close",{})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(e){var t=f.GetData(this,"data");l.getHighlightedResults().removeClass("select2-results__option--highlighted"),l.trigger("results:focus",{data:t,element:h(this)})})},i.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},i.prototype.destroy=function(){this.$results.remove()},i.prototype.ensureHighlightVisible=function(){var t,i,r,o,e=this.getHighlightedResults();0!==e.length&&(t=this.$results.find("[aria-selected]").index(e),o=this.$results.offset().top,i=e.offset().top,r=this.$results.scrollTop()+(i-o),o=i-o,r-=2*e.outerHeight(!1),t<=2?this.$results.scrollTop(0):(o>this.$results.outerHeight()||o<0)&&this.$results.scrollTop(r))},i.prototype.template=function(r,t){var n=this.options.get("templateResult"),i=this.options.get("escapeMarkup"),r=n(r,t);null==r?t.style.display="none":"string"==typeof r?t.innerHTML=i(r):h(t).append(r)},i}),e.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),e.define("select2/selection/base",["jquery","../utils","../keys"],function(n,i,r){function o(e,t){this.$element=e,this.options=t,o.__super__.constructor.call(this)}return i.Extend(o,i.Observable),o.prototype.render=function(){var e=n('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=i.GetData(this.$element[0],"old-tabindex")?this._tabindex=i.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),e.attr("title",this.$element.attr("title")),e.attr("tabindex",this._tabindex),e.attr("aria-disabled","false"),this.$selection=e},o.prototype.bind=function(e,t){var n=this,i=e.id+"-results";this.container=e,this.$selection.on("focus",function(e){n.trigger("focus",e)}),this.$selection.on("blur",function(e){n._handleBlur(e)}),this.$selection.on("keydown",function(e){n.trigger("keypress",e),e.which===r.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){n.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){n.update(e.data)}),e.on("open",function(){n.$selection.attr("aria-expanded","true"),n.$selection.attr("aria-owns",i),n._attachCloseHandler(e)}),e.on("close",function(){n.$selection.attr("aria-expanded","false"),n.$selection.removeAttr("aria-activedescendant"),n.$selection.removeAttr("aria-owns"),n.$selection.trigger("focus"),n._detachCloseHandler(e)}),e.on("enable",function(){n.$selection.attr("tabindex",n._tabindex),n.$selection.attr("aria-disabled","false")}),e.on("disable",function(){n.$selection.attr("tabindex","-1"),n.$selection.attr("aria-disabled","true")})},o.prototype._handleBlur=function(e){var t=this;window.setTimeout(function(){document.activeElement==t.$selection[0]||n.contains(t.$selection[0],document.activeElement)||t.trigger("blur",e)},1)},o.prototype._attachCloseHandler=function(e){n(document.body).on("mousedown.select2."+e.id,function(e){var t=n(e.target).closest(".select2");n(".select2.select2-container--open").each(function(){this!=t[0]&&i.GetData(this,"element").select2("close")})})},o.prototype._detachCloseHandler=function(e){n(document.body).off("mousedown.select2."+e.id)},o.prototype.position=function(e,t){t.find(".selection").append(e)},o.prototype.destroy=function(){this._detachCloseHandler(this.container)},o.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},o.prototype.isEnabled=function(){return!this.isDisabled()},o.prototype.isDisabled=function(){return this.options.get("disabled")},o}),e.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,n,i){function r(){r.__super__.constructor.apply(this,arguments)}return n.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},r.prototype.bind=function(t,e){var n=this;r.__super__.bind.apply(this,arguments);var i=t.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",i).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",i),this.$selection.on("mousedown",function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),t.on("focus",function(e){t.isOpen()||n.$selection.trigger("focus")})},r.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},r.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},r.prototype.selectionContainer=function(){return e("<span></span>")},r.prototype.update=function(i){var n,r;0!==i.length?(r=i[0],n=this.$selection.find(".select2-selection__rendered"),i=this.display(r,n),n.empty().append(i),(r=r.title||r.text)?n.attr("title",r):n.removeAttr("title")):this.clear()},r}),e.define("select2/selection/multiple",["jquery","./base","../utils"],function(r,e,l){function n(e,t){n.__super__.constructor.apply(this,arguments)}return l.Extend(n,e),n.prototype.render=function(){var e=n.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},n.prototype.bind=function(e,t){var i=this;n.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){i.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(e){var n;i.isDisabled()||(n=r(this).parent(),n=l.GetData(n[0],"data"),i.trigger("unselect",{originalEvent:e,data:n}))})},n.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},n.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},n.prototype.selectionContainer=function(){return r('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},n.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=this.selectionContainer(),s=this.display(i,r);r.append(s);s=i.title||i.text;s&&r.attr("title",s),l.StoreData(r[0],"data",i),t.push(r)}var a=this.$selection.find(".select2-selection__rendered");l.appendMany(a,t)}},n}),e.define("select2/selection/placeholder",["../utils"],function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return t="string"==typeof t?{id:"",text:t}:t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,i){var n=1==i.length&&i[0].id!=this.placeholder.id;if(1<i.length||n)return e.call(this,i);this.clear();i=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(i)},t}),e.define("select2/selection/allowClear",["jquery","../keys","../utils"],function(r,i,a){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){i._handleClear(e)}),t.on("keypress",function(e){i._handleKeyboardClear(e,t)})},e.prototype._handleClear=function(e,t){if(!this.isDisabled()){var n=this.$selection.find(".select2-selection__clear");if(0!==n.length){t.stopPropagation();var i=a.GetData(n[0],"data"),r=this.$element.val();this.$element.val(this.placeholder.id);var o={data:i};if(this.trigger("clear",o),o.prevented)this.$element.val(r);else{for(var s=0;s<i.length;s++)if(o={data:i[s]},this.trigger("unselect",o),o.prevented)return void this.$element.val(r);this.$element.trigger("input").trigger("change"),this.trigger("toggle",{})}}}},e.prototype._handleKeyboardClear=function(e,t,n){n.isOpen()||t.which!=i.DELETE&&t.which!=i.BACKSPACE||this._handleClear(t)},e.prototype.update=function(i,t){i.call(this,t),0<this.$selection.find(".select2-selection__placeholder").length||0===t.length||(i=this.options.get("translations").get("removeAllItems"),i=r('<span class="select2-selection__clear" title="'+i()+'">&times;</span>'),a.StoreData(i[0],"data",t),this.$selection.find(".select2-selection__rendered").prepend(i))},e}),e.define("select2/selection/search",["jquery","../utils","../keys"],function(i,a,l){function e(e,t,n){e.call(this,t,n)}return e.prototype.render=function(n){var t=i('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></li>');this.$searchContainer=t,this.$search=t.find("input");n=n.call(this);return this._transferTabIndex(),n},e.prototype.bind=function(e,o,n){var i=this,r=o.id+"-results";e.call(this,o,n),o.on("open",function(){i.$search.attr("aria-controls",r),i.$search.trigger("focus")}),o.on("close",function(){i.$search.val(""),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.trigger("focus")}),o.on("enable",function(){i.$search.prop("disabled",!1),i._transferTabIndex()}),o.on("disable",function(){i.$search.prop("disabled",!0)}),o.on("focus",function(e){i.$search.trigger("focus")}),o.on("results:focus",function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")}),this.$selection.on("focusin",".select2-search--inline",function(e){i.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){i._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){var n;e.stopPropagation(),i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented(),e.which===l.BACKSPACE&&""===i.$search.val()&&0<(n=i.$searchContainer.prev(".select2-selection__choice")).length&&(n=a.GetData(n[0],"data"),i.searchRemoveChoice(n),e.preventDefault())}),this.$selection.on("click",".select2-search--inline",function(e){i.$search.val()&&e.stopPropagation()});var o=document.documentMode,s=o&&o<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){s?i.$selection.off("input.search input.searchcheck"):i.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){var t;s&&"input"===e.type?i.$selection.off("input.search input.searchcheck"):(t=e.which)!=l.SHIFT&&t!=l.CTRL&&t!=l.ALT&&t!=l.TAB&&i.handleSearch(e)})},e.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},e.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},e.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n&&this.$search.trigger("focus")},e.prototype.handleSearch=function(){var e;this.resizeSearch(),this._keyUpPrevented||(e=this.$search.val(),this.trigger("query",{term:e})),this._keyUpPrevented=!1},e.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},e.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="",e=""!==this.$search.attr("placeholder")?this.$selection.find(".select2-selection__rendered").width():.75*(this.$search.val().length+1)+"em";this.$search.css("width",e)},e}),e.define("select2/selection/eventRelay",["jquery"],function(s){function e(){}return e.prototype.bind=function(e,t,n){var i=this,r=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],o=["opening","closing","selecting","unselecting","clearing"];e.call(this,t,n),t.on("*",function(e,t){var n;-1!==s.inArray(e,r)&&(n=s.Event("select2:"+e,{params:t=t||{}}),i.$element.trigger(n),-1!==s.inArray(e,o)&&(t.prevented=n.isDefaultPrevented()))})},e}),e.define("select2/translation",["jquery","require"],function(t,n){function i(e){this.dict=e||{}}return i.prototype.all=function(){return this.dict},i.prototype.get=function(e){return this.dict[e]},i.prototype.extend=function(e){this.dict=t.extend({},e.all(),this.dict)},i._cache={},i.loadPath=function(e){var t;return e in i._cache||(t=n(e),i._cache[e]=t),new i(i._cache[e])},i}),e.define("select2/diacritics",[],function(){return{"â¶":"A","ï¼¡":"A","Ã":"A","Ã":"A","Ã":"A","áº¦":"A","áº¤":"A","áºª":"A","áº¨":"A","Ã":"A","Ä":"A","Ä":"A","áº°":"A","áº®":"A","áº´":"A","áº²":"A","È¦":"A","Ç ":"A","Ã":"A","Ç":"A","áº¢":"A","Ã":"A","Çº":"A","Ç":"A","È":"A","È":"A","áº ":"A","áº¬":"A","áº¶":"A","á¸":"A","Ä":"A","Èº":"A","â±¯":"A","ê²":"AA","Ã":"AE","Ç¼":"AE","Ç¢":"AE","ê´":"AO","ê¶":"AU","ê¸":"AV","êº":"AV","ê¼":"AY","â·":"B","ï¼¢":"B","á¸":"B","á¸":"B","á¸":"B","É":"B","Æ":"B","Æ":"B","â¸":"C","ï¼£":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ã":"C","á¸":"C","Æ":"C","È»":"C","ê¾":"C","â¹":"D","ï¼¤":"D","á¸":"D","Ä":"D","á¸":"D","á¸":"D","á¸":"D","á¸":"D","Ä":"D","Æ":"D","Æ":"D","Æ":"D","ê¹":"D","Ç±":"DZ","Ç":"DZ","Ç²":"Dz","Ç":"Dz","âº":"E","ï¼¥":"E","Ã":"E","Ã":"E","Ã":"E","á»":"E","áº¾":"E","á»":"E","á»":"E","áº¼":"E","Ä":"E","á¸":"E","á¸":"E","Ä":"E","Ä":"E","Ã":"E","áºº":"E","Ä":"E","È":"E","È":"E","áº¸":"E","á»":"E","È¨":"E","á¸":"E","Ä":"E","á¸":"E","á¸":"E","Æ":"E","Æ":"E","â»":"F","ï¼¦":"F","á¸":"F","Æ":"F","ê»":"F","â¼":"G","ï¼§":"G","Ç´":"G","Ä":"G","á¸ ":"G","Ä":"G","Ä ":"G","Ç¦":"G","Ä¢":"G","Ç¤":"G","Æ":"G","ê ":"G","ê½":"G","ê¾":"G","â½":"H","ï¼¨":"H","Ä¤":"H","á¸¢":"H","á¸¦":"H","È":"H","á¸¤":"H","á¸¨":"H","á¸ª":"H","Ä¦":"H","â±§":"H","â±µ":"H","ê":"H","â¾":"I","ï¼©":"I","Ã":"I","Ã":"I","Ã":"I","Ä¨":"I","Äª":"I","Ä¬":"I","Ä°":"I","Ã":"I","á¸®":"I","á»":"I","Ç":"I","È":"I","È":"I","á»":"I","Ä®":"I","á¸¬":"I","Æ":"I","â¿":"J","ï¼ª":"J","Ä´":"J","É":"J","â":"K","ï¼«":"K","á¸°":"K","Ç¨":"K","á¸²":"K","Ä¶":"K","á¸´":"K","Æ":"K","â±©":"K","ê":"K","ê":"K","ê":"K","ê¢":"K","â":"L","ï¼¬":"L","Ä¿":"L","Ä¹":"L","Ä½":"L","á¸¶":"L","á¸¸":"L","Ä»":"L","á¸¼":"L","á¸º":"L","Å":"L","È½":"L","â±¢":"L","â± ":"L","ê":"L","ê":"L","ê":"L","Ç":"LJ","Ç":"Lj","â":"M","ï¼­":"M","á¸¾":"M","á¹":"M","á¹":"M","â±®":"M","Æ":"M","â":"N","ï¼®":"N","Ç¸":"N","Å":"N","Ã":"N","á¹":"N","Å":"N","á¹":"N","Å":"N","á¹":"N","á¹":"N","È ":"N","Æ":"N","ê":"N","ê¤":"N","Ç":"NJ","Ç":"Nj","â":"O","ï¼¯":"O","Ã":"O","Ã":"O","Ã":"O","á»":"O","á»":"O","á»":"O","á»":"O","Ã":"O","á¹":"O","È¬":"O","á¹":"O","Å":"O","á¹":"O","á¹":"O","Å":"O","È®":"O","È°":"O","Ã":"O","Èª":"O","á»":"O","Å":"O","Ç":"O","È":"O","È":"O","Æ ":"O","á»":"O","á»":"O","á» ":"O","á»":"O","á»¢":"O","á»":"O","á»":"O","Çª":"O","Ç¬":"O","Ã":"O","Ç¾":"O","Æ":"O","Æ":"O","ê":"O","ê":"O","Å":"OE","Æ¢":"OI","ê":"OO","È¢":"OU","â":"P","ï¼°":"P","á¹":"P","á¹":"P","Æ¤":"P","â±£":"P","ê":"P","ê":"P","ê":"P","â":"Q","ï¼±":"Q","ê":"Q","ê":"Q","É":"Q","â":"R","ï¼²":"R","Å":"R","á¹":"R","Å":"R","È":"R","È":"R","á¹":"R","á¹":"R","Å":"R","á¹":"R","É":"R","â±¤":"R","ê":"R","ê¦":"R","ê":"R","â":"S","ï¼³":"S","áº":"S","Å":"S","á¹¤":"S","Å":"S","á¹ ":"S","Å ":"S","á¹¦":"S","á¹¢":"S","á¹¨":"S","È":"S","Å":"S","â±¾":"S","ê¨":"S","ê":"S","â":"T","ï¼´":"T","á¹ª":"T","Å¤":"T","á¹¬":"T","È":"T","Å¢":"T","á¹°":"T","á¹®":"T","Å¦":"T","Æ¬":"T","Æ®":"T","È¾":"T","ê":"T","ê¨":"TZ","â":"U","ï¼µ":"U","Ã":"U","Ã":"U","Ã":"U","Å¨":"U","á¹¸":"U","Åª":"U","á¹º":"U","Å¬":"U","Ã":"U","Ç":"U","Ç":"U","Ç":"U","Ç":"U","á»¦":"U","Å®":"U","Å°":"U","Ç":"U","È":"U","È":"U","Æ¯":"U","á»ª":"U","á»¨":"U","á»®":"U","á»¬":"U","á»°":"U","á»¤":"U","á¹²":"U","Å²":"U","á¹¶":"U","á¹´":"U","É":"U","â":"V","ï¼¶":"V","á¹¼":"V","á¹¾":"V","Æ²":"V","ê":"V","É":"V","ê ":"VY","â":"W","ï¼·":"W","áº":"W","áº":"W","Å´":"W","áº":"W","áº":"W","áº":"W","â±²":"W","â":"X","ï¼¸":"X","áº":"X","áº":"X","â":"Y","ï¼¹":"Y","á»²":"Y","Ã":"Y","Å¶":"Y","á»¸":"Y","È²":"Y","áº":"Y","Å¸":"Y","á»¶":"Y","á»´":"Y","Æ³":"Y","É":"Y","á»¾":"Y","â":"Z","ï¼º":"Z","Å¹":"Z","áº":"Z","Å»":"Z","Å½":"Z","áº":"Z","áº":"Z","Æµ":"Z","È¤":"Z","â±¿":"Z","â±«":"Z","ê¢":"Z","â":"a","ï½":"a","áº":"a","Ã ":"a","Ã¡":"a","Ã¢":"a","áº§":"a","áº¥":"a","áº«":"a","áº©":"a","Ã£":"a","Ä":"a","Ä":"a","áº±":"a","áº¯":"a","áºµ":"a","áº³":"a","È§":"a","Ç¡":"a","Ã¤":"a","Ç":"a","áº£":"a","Ã¥":"a","Ç»":"a","Ç":"a","È":"a","È":"a","áº¡":"a","áº­":"a","áº·":"a","á¸":"a","Ä":"a","â±¥":"a","É":"a","ê³":"aa","Ã¦":"ae","Ç½":"ae","Ç£":"ae","êµ":"ao","ê·":"au","ê¹":"av","ê»":"av","ê½":"ay","â":"b","ï½":"b","á¸":"b","á¸":"b","á¸":"b","Æ":"b","Æ":"b","É":"b","â":"c","ï½":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ã§":"c","á¸":"c","Æ":"c","È¼":"c","ê¿":"c","â":"c","â":"d","ï½":"d","á¸":"d","Ä":"d","á¸":"d","á¸":"d","á¸":"d","á¸":"d","Ä":"d","Æ":"d","É":"d","É":"d","êº":"d","Ç³":"dz","Ç":"dz","â":"e","ï½":"e","Ã¨":"e","Ã©":"e","Ãª":"e","á»":"e","áº¿":"e","á»":"e","á»":"e","áº½":"e","Ä":"e","á¸":"e","á¸":"e","Ä":"e","Ä":"e","Ã«":"e","áº»":"e","Ä":"e","È":"e","È":"e","áº¹":"e","á»":"e","È©":"e","á¸":"e","Ä":"e","á¸":"e","á¸":"e","É":"e","É":"e","Ç":"e","â":"f","ï½":"f","á¸":"f","Æ":"f","ê¼":"f","â":"g","ï½":"g","Çµ":"g","Ä":"g","á¸¡":"g","Ä":"g","Ä¡":"g","Ç§":"g","Ä£":"g","Ç¥":"g","É ":"g","ê¡":"g","áµ¹":"g","ê¿":"g","â":"h","ï½":"h","Ä¥":"h","á¸£":"h","á¸§":"h","È":"h","á¸¥":"h","á¸©":"h","á¸«":"h","áº":"h","Ä§":"h","â±¨":"h","â±¶":"h","É¥":"h","Æ":"hv","â":"i","ï½":"i","Ã¬":"i","Ã­":"i","Ã®":"i","Ä©":"i","Ä«":"i","Ä­":"i","Ã¯":"i","á¸¯":"i","á»":"i","Ç":"i","È":"i","È":"i","á»":"i","Ä¯":"i","á¸­":"i","É¨":"i","Ä±":"i","â":"j","ï½":"j","Äµ":"j","Ç°":"j","É":"j","â":"k","ï½":"k","á¸±":"k","Ç©":"k","á¸³":"k","Ä·":"k","á¸µ":"k","Æ":"k","â±ª":"k","ê":"k","ê":"k","ê":"k","ê£":"k","â":"l","ï½":"l","Å":"l","Äº":"l","Ä¾":"l","á¸·":"l","á¸¹":"l","Ä¼":"l","á¸½":"l","á¸»":"l","Å¿":"l","Å":"l","Æ":"l","É«":"l","â±¡":"l","ê":"l","ê":"l","ê":"l","Ç":"lj","â":"m","ï½":"m","á¸¿":"m","á¹":"m","á¹":"m","É±":"m","É¯":"m","â":"n","ï½":"n","Ç¹":"n","Å":"n","Ã±":"n","á¹":"n","Å":"n","á¹":"n","Å":"n","á¹":"n","á¹":"n","Æ":"n","É²":"n","Å":"n","ê":"n","ê¥":"n","Ç":"nj","â":"o","ï½":"o","Ã²":"o","Ã³":"o","Ã´":"o","á»":"o","á»":"o","á»":"o","á»":"o","Ãµ":"o","á¹":"o","È­":"o","á¹":"o","Å":"o","á¹":"o","á¹":"o","Å":"o","È¯":"o","È±":"o","Ã¶":"o","È«":"o","á»":"o","Å":"o","Ç":"o","È":"o","È":"o","Æ¡":"o","á»":"o","á»":"o","á»¡":"o","á»":"o","á»£":"o","á»":"o","á»":"o","Ç«":"o","Ç­":"o","Ã¸":"o","Ç¿":"o","É":"o","ê":"o","ê":"o","Éµ":"o","Å":"oe","Æ£":"oi","È£":"ou","ê":"oo","â":"p","ï½":"p","á¹":"p","á¹":"p","Æ¥":"p","áµ½":"p","ê":"p","ê":"p","ê":"p","â ":"q","ï½":"q","É":"q","ê":"q","ê":"q","â¡":"r","ï½":"r","Å":"r","á¹":"r","Å":"r","È":"r","È":"r","á¹":"r","á¹":"r","Å":"r","á¹":"r","É":"r","É½":"r","ê":"r","ê§":"r","ê":"r","â¢":"s","ï½":"s","Ã":"s","Å":"s","á¹¥":"s","Å":"s","á¹¡":"s","Å¡":"s","á¹§":"s","á¹£":"s","á¹©":"s","È":"s","Å":"s","È¿":"s","ê©":"s","ê":"s","áº":"s","â£":"t","ï½":"t","á¹«":"t","áº":"t","Å¥":"t","á¹­":"t","È":"t","Å£":"t","á¹±":"t","á¹¯":"t","Å§":"t","Æ­":"t","Ê":"t","â±¦":"t","ê":"t","ê©":"tz","â¤":"u","ï½":"u","Ã¹":"u","Ãº":"u","Ã»":"u","Å©":"u","á¹¹":"u","Å«":"u","á¹»":"u","Å­":"u","Ã¼":"u","Ç":"u","Ç":"u","Ç":"u","Ç":"u","á»§":"u","Å¯":"u","Å±":"u","Ç":"u","È":"u","È":"u","Æ°":"u","á»«":"u","á»©":"u","á»¯":"u","á»­":"u","á»±":"u","á»¥":"u","á¹³":"u","Å³":"u","á¹·":"u","á¹µ":"u","Ê":"u","â¥":"v","ï½":"v","á¹½":"v","á¹¿":"v","Ê":"v","ê":"v","Ê":"v","ê¡":"vy","â¦":"w","ï½":"w","áº":"w","áº":"w","Åµ":"w","áº":"w","áº":"w","áº":"w","áº":"w","â±³":"w","â§":"x","ï½":"x","áº":"x","áº":"x","â¨":"y","ï½":"y","á»³":"y","Ã½":"y","Å·":"y","á»¹":"y","È³":"y","áº":"y","Ã¿":"y","á»·":"y","áº":"y","á»µ":"y","Æ´":"y","É":"y","á»¿":"y","â©":"z","ï½":"z","Åº":"z","áº":"z","Å¼":"z","Å¾":"z","áº":"z","áº":"z","Æ¶":"z","È¥":"z","É":"z","â±¬":"z","ê£":"z","Î":"Î","Î":"Î","Î":"Î","Î":"Î","Îª":"Î","Î":"Î","Î":"Î¥","Î«":"Î¥","Î":"Î©","Î¬":"Î±","Î­":"Îµ","Î®":"Î·","Î¯":"Î¹","Ï":"Î¹","Î":"Î¹","Ï":"Î¿","Ï":"Ï","Ï":"Ï","Î°":"Ï","Ï":"Ï","Ï":"Ï","â":"'"}}),e.define("select2/data/base",["../utils"],function(i){function n(e,t){n.__super__.constructor.call(this)}return i.Extend(n,i.Observable),n.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},n.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},n.prototype.bind=function(e,t){},n.prototype.destroy=function(){},n.prototype.generateResultId=function(n,t){n=n.id+"-result-";return n+=i.generateChars(4),null!=t.id?n+="-"+t.id.toString():n+="-"+i.generateChars(4),n},n}),e.define("select2/data/select",["./base","../utils","jquery"],function(e,a,l){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return a.Extend(n,e),n.prototype.current=function(e){var n=[],i=this;this.$element.find(":selected").each(function(){var t=l(this),t=i.item(t);n.push(t)}),e(n)},n.prototype.select=function(r){var e,o=this;if(r.selected=!0,l(r.element).is("option"))return r.element.selected=!0,void this.$element.trigger("input").trigger("change");this.$element.prop("multiple")?this.current(function(e){var t=[];(r=[r]).push.apply(r,e);for(var n=0;n<r.length;n++){var i=r[n].id;-1===l.inArray(i,t)&&t.push(i)}o.$element.val(t),o.$element.trigger("input").trigger("change")}):(e=r.id,this.$element.val(e),this.$element.trigger("input").trigger("change"))},n.prototype.unselect=function(r){var o=this;if(this.$element.prop("multiple")){if(r.selected=!1,l(r.element).is("option"))return r.element.selected=!1,void this.$element.trigger("input").trigger("change");this.current(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].id;i!==r.id&&-1===l.inArray(i,t)&&t.push(i)}o.$element.val(t),o.$element.trigger("input").trigger("change")})}},n.prototype.bind=function(e,t){var n=this;(this.container=e).on("select",function(e){n.select(e.data)}),e.on("unselect",function(e){n.unselect(e.data)})},n.prototype.destroy=function(){this.$element.find("*").each(function(){a.RemoveData(this)})},n.prototype.query=function(i,e){var r=[],o=this;this.$element.children().each(function(){var n=l(this);(n.is("option")||n.is("optgroup"))&&(n=o.item(n),null!==(n=o.matches(i,n))&&r.push(n))}),e({results:r})},n.prototype.addOptions=function(e){a.appendMany(this.$element,e)},n.prototype.option=function(i){var t;i.children?(t=document.createElement("optgroup")).label=i.text:void 0!==(t=document.createElement("option")).textContent?t.textContent=i.text:t.innerText=i.text,void 0!==i.id&&(t.value=i.id),i.disabled&&(t.disabled=!0),i.selected&&(t.selected=!0),i.title&&(t.title=i.title);var n=l(t),i=this._normalizeItem(i);return i.element=t,a.StoreData(t,"data",i),n},n.prototype.item=function(e){var t={};if(null!=(t=a.GetData(e[0],"data")))return t;if(e.is("option"))t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){for(var t={text:e.prop("label"),children:[],title:e.prop("title")},n=e.children("option"),i=[],r=0;r<n.length;r++){var s=l(n[r]),s=this.item(s);i.push(s)}t.children=i}return(t=this._normalizeItem(t)).element=e[0],a.StoreData(e[0],"data",t),t},n.prototype._normalizeItem=function(e){return e!==Object(e)&&(e={id:e,text:e}),null!=(e=l.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),l.extend({},{selected:!1,disabled:!1},e)},n.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},n}),e.define("select2/data/array",["./select","../utils","jquery"],function(e,f,g){function i(e,t){this._dataToConvert=t.get("data")||[],i.__super__.constructor.call(this,e,t)}return f.Extend(i,e),i.prototype.bind=function(e,t){i.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},i.prototype.select=function(n){var e;0===(e=this.$element.find("option").filter(function(e,t){return t.value==n.id.toString()})).length&&(e=this.option(n),this.addOptions(e)),i.__super__.select.call(this,n)},i.prototype.convertToOptions=function(e){var t=this,n=this.$element.find("option"),i=n.map(function(){return t.item(g(this)).id}).get(),r=[];for(var s=0;s<e.length;s++){var l,p,h=this._normalizeItem(e[s]);0<=g.inArray(h.id,i)?(l=n.filter(function(e){return function(){return g(this).val()==e.id}}(h)),p=this.item(l),p=g.extend(!0,{},h,p),p=this.option(p),l.replaceWith(p)):(p=this.option(h),h.children&&(h=this.convertToOptions(h.children),f.appendMany(p,h)),r.push(p))}return r},i}),e.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,o){function n(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),n.__super__.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype._applyDefaults=function(e){var t={data:function(e){return o.extend({},e,{q:e.term})},transport:function(i,t,n){i=o.ajax(i);return i.then(t),i.fail(n),i}};return o.extend({},t,e,!0)},n.prototype.processResults=function(e){return e},n.prototype.query=function(n,i){var r=this;null!=this._request&&(o.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var t=o.extend({type:"GET"},this.ajaxOptions);function e(){var e=t.transport(t,function(t){t=r.processResults(t,n);r.options.get("debug")&&window.console&&console.error&&(t&&t.results&&o.isArray(t.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),i(t)},function(){"status"in e&&(0===e.status||"0"===e.status)||r.trigger("results:message",{message:"errorLoading"})});r._request=e}"function"==typeof t.url&&(t.url=t.url.call(this.$element,n)),"function"==typeof t.data&&(t.data=t.data.call(this.$element,n)),this.ajaxOptions.delay&&null!=n.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(e,this.ajaxOptions.delay)):e()},n}),e.define("select2/data/tags",["jquery"],function(u){function e(e,t,n){var i=n.get("tags"),o=n.get("createTag");void 0!==o&&(this.createTag=o);o=n.get("insertTag");if(void 0!==o&&(this.insertTag=o),e.call(this,t,n),u.isArray(i))for(var s=0;s<i.length;s++){var c=i[s],c=this._normalizeItem(c),c=this.option(c);this.$element.append(c)}}return e.prototype.query=function(e,c,u){var d=this;this._removeOldTags(),null!=c.term&&null==c.page?e.call(this,c,function e(t,n){for(var i=t.results,r=0;r<i.length;r++){var o=i[r],s=null!=o.children&&!e({results:o.children},!0);if((o.text||"").toUpperCase()===(c.term||"").toUpperCase()||s)return!n&&(t.data=i,void u(t))}if(n)return!0;var l,a=d.createTag(c);null!=a&&((l=d.option(a)).attr("data-select2-tag",!0),d.addOptions([l]),d.insertTag(i,a)),t.results=i,u(t)}):e.call(this,c,u)},e.prototype.createTag=function(e,n){n=u.trim(n.term);return""===n?null:{id:n,text:n}},e.prototype.insertTag=function(e,t,n){t.unshift(n)},e.prototype._removeOldTags=function(e){this.$element.find("option[data-select2-tag]").each(function(){this.selected||u(this).remove()})},e}),e.define("select2/data/tokenizer",["jquery"],function(d){function e(e,t,n){var i=n.get("tokenizer");void 0!==i&&(this.tokenizer=i),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},e.prototype.query=function(e,t,n){var r=this;t.term=t.term||"";var i=this.tokenizer(t,this.options,function(i){var n=r._normalizeItem(i);r.$element.find("option").filter(function(){return d(this).val()===n.id}).length||((i=r.option(n)).attr("data-select2-tag",!0),r._removeOldTags(),r.addOptions([i])),r.trigger("select",{data:n})});i.term!==t.term&&(this.$search.length&&(this.$search.val(i.term),this.$search.trigger("focus")),t.term=i.term),e.call(this,t,n)},e.prototype.tokenizer=function(e,t,n,i){for(var r=n.get("tokenSeparators")||[],o=t.term,s=0,a=this.createTag||function(e){return{id:e.term,text:e.term}};s<o.length;){var u=o[s];-1!==d.inArray(u,r)?(u=o.substr(0,s),null!=(u=a(d.extend({},t,{term:u})))?(i(u),o=o.substr(s+1)||"",s=0):s++):s++}return{term:o}},e}),e.define("select2/data/minimumInputLength",[],function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),e.define("select2/data/maximumInputLength",[],function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),e.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(){i._checkIfMaximumSelected()})},e.prototype.query=function(e,t,n){var i=this;this._checkIfMaximumSelected(function(){e.call(i,t,n)})},e.prototype._checkIfMaximumSelected=function(e,n){var i=this;this.current(function(t){t=null!=t?t.length:0;0<i.maximumSelectionLength&&t>=i.maximumSelectionLength?i.trigger("results:message",{message:"maximumSelected",args:{maximum:i.maximumSelectionLength}}):n&&n()})},e}),e.define("select2/dropdown",["jquery","./utils"],function(t,e){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return e.Extend(n,e.Observable),n.prototype.render=function(){var e=t('<span class="select2-dropdown"><span class="select2-results"></span></span>');return e.attr("dir",this.options.get("dir")),this.$dropdown=e},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n}),e.define("select2/dropdown/search",["jquery","../utils"],function(o,e){function t(){}return t.prototype.render=function(n){var t=n.call(this),n=o('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=n,this.$search=n.find("input"),t.prepend(n),t},t.prototype.bind=function(e,t,n){var i=this,r=t.id+"-results";e.call(this,t,n),this.$search.on("keydown",function(e){i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(e){o(this).off("keyup")}),this.$search.on("keyup input",function(e){i.handleSearch(e)}),t.on("open",function(){i.$search.attr("tabindex",0),i.$search.attr("aria-controls",r),i.$search.trigger("focus"),window.setTimeout(function(){i.$search.trigger("focus")},0)}),t.on("close",function(){i.$search.attr("tabindex",-1),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.val(""),i.$search.trigger("blur")}),t.on("focus",function(){t.isOpen()||i.$search.trigger("focus")}),t.on("results:all",function(e){null!=e.query.term&&""!==e.query.term||(i.showSearch(e)?i.$searchContainer.removeClass("select2-search--hide"):i.$searchContainer.addClass("select2-search--hide"))}),t.on("results:focus",function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")})},t.prototype.handleSearch=function(e){var t;this._keyUpPrevented||(t=this.$search.val(),this.trigger("query",{term:t})),this._keyUpPrevented=!1},t.prototype.showSearch=function(e,t){return!0},t}),e.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,n,i){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,i)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return t="string"==typeof t?{id:"",text:t}:t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),i=t.length-1;0<=i;i--){var r=t[i];this.placeholder.id===r.id&&n.splice(i,1)}return n},e}),e.define("select2/dropdown/infiniteScroll",["jquery"],function(n){function e(e,t,n,i){this.lastParams={},e.call(this,t,n,i),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return e.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("query",function(e){i.lastParams=e,i.loading=!0}),t.on("query:append",function(e){i.lastParams=e,i.loading=!0}),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},e.prototype.loadMoreIfNeeded=function(){var t=n.contains(document.documentElement,this.$loadingMore[0]);!this.loading&&t&&(t=this.$results.offset().top+this.$results.outerHeight(!1),this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=t+50&&this.loadMore())},e.prototype.loadMore=function(){this.loading=!0;var e=n.extend({},{page:1},this.lastParams);e.page++,this.trigger("query:append",e)},e.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},e.prototype.createLoadingMore=function(){var e=n('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),t=this.options.get("translations").get("loadingMore");return e.html(t(this.lastParams)),e},e}),e.define("select2/dropdown/attachBody",["jquery","../utils"],function(f,a){function e(e,t,n){this.$dropdownParent=f(n.get("dropdownParent")||document.body),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("open",function(){i._showDropdown(),i._attachPositioningHandler(t),i._bindContainerResultHandlers(t)}),t.on("close",function(){i._hideDropdown(),i._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},e.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},e.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},e.prototype.render=function(n){var t=f("<span></span>"),n=n.call(this);return t.append(n),this.$dropdownContainer=t},e.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},e.prototype._bindContainerResultHandlers=function(e,t){var n;this._containerResultsHandlersBound||(n=this,t.on("results:all",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:append",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:message",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("select",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("unselect",function(){n._positionDropdown(),n._resizeDropdown()}),this._containerResultsHandlersBound=!0)},e.prototype._attachPositioningHandler=function(e,s){var n=this,i="scroll.select2."+s.id,r="resize.select2."+s.id,o="orientationchange.select2."+s.id,s=this.$container.parents().filter(a.hasScroll);s.each(function(){a.StoreData(this,"select2-scroll-position",{x:f(this).scrollLeft(),y:f(this).scrollTop()})}),s.on(i,function(e){var t=a.GetData(this,"select2-scroll-position");f(this).scrollTop(t.y)}),f(window).on(i+" "+r+" "+o,function(e){n._positionDropdown(),n._resizeDropdown()})},e.prototype._detachPositioningHandler=function(e,r){var n="scroll.select2."+r.id,i="resize.select2."+r.id,r="orientationchange.select2."+r.id;this.$container.parents().filter(a.hasScroll).off(n),f(window).off(n+" "+i+" "+r)},e.prototype._positionDropdown=function(){var u=f(window),t=this.$dropdown.hasClass("select2-dropdown--above"),n=this.$dropdown.hasClass("select2-dropdown--below"),i=null,h=this.$container.offset();h.bottom=h.top+this.$container.outerHeight(!1);var o={height:this.$container.outerHeight(!1)};o.top=h.top,o.bottom=h.top+o.height;var s=this.$dropdown.outerHeight(!1),d=u.scrollTop(),p=u.scrollTop()+u.height(),c=d<h.top-s,u=p>h.bottom+s,d={left:h.left,top:o.bottom},p=this.$dropdownParent;"static"===p.css("position")&&(p=p.offsetParent());h={top:0,left:0};(f.contains(document.body,p[0])||p[0].isConnected)&&(h=p.offset()),d.top-=h.top,d.left-=h.left,t||n||(i="below"),u||!c||t?!c&&u&&t&&(i="below"):i="above",("above"==i||t&&"below"!==i)&&(d.top=o.top-h.top-s),null!=i&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+i),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+i)),this.$dropdownContainer.css(d)},e.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},e.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},e}),e.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(e,t,n,i){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,i)}return e.prototype.showSearch=function(e,t){return!(function e(t){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.children?n+=e(r.children):n++}return n}(t.data.results)<this.minimumResultsForSearch)&&e.call(this,t)},e}),e.define("select2/dropdown/selectOnClose",["../utils"],function(o){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("close",function(e){i._handleSelectOnClose(e)})},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var r=t.originalSelect2Event;if("select"===r._type||"unselect"===r._type)return}r=this.getHighlightedResults();r.length<1||(null!=(r=o.GetData(r[0],"data")).element&&r.element.selected||null==r.element&&r.selected||this.trigger("select",{data:r}))},e}),e.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(e){i._selectTriggered(e)}),t.on("unselect",function(e){i._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e}),e.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(n){var t=n.input.length-n.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more resultsâ¦"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searchingâ¦"},removeAllItems:function(){return"Remove all items"}}}),e.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(c,u,d,p,h,f,g,m,v,y,s,t,_,w,$,b,A,x,D,S,C,E,O,T,q,j,L,I,e){function n(){this.reset()}return n.prototype.apply=function(e){var t,i,o;null==(e=c.extend(!0,{},this.defaults,e)).dataAdapter&&(null!=e.ajax?e.dataAdapter=$:null!=e.data?e.dataAdapter=w:e.dataAdapter=_,0<e.minimumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,x)),0<e.maximumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,D)),0<e.maximumSelectionLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,S)),e.tags&&(e.dataAdapter=y.Decorate(e.dataAdapter,b)),null==e.tokenSeparators&&null==e.tokenizer||(e.dataAdapter=y.Decorate(e.dataAdapter,A)),null!=e.query&&(t=u(e.amdBase+"compat/query"),e.dataAdapter=y.Decorate(e.dataAdapter,t)),null!=e.initSelection&&(i=u(e.amdBase+"compat/initSelection"),e.dataAdapter=y.Decorate(e.dataAdapter,i))),null==e.resultsAdapter&&(e.resultsAdapter=d,null!=e.ajax&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,T)),null!=e.placeholder&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,O)),e.selectOnClose&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,L))),null==e.dropdownAdapter&&(e.multiple?e.dropdownAdapter=C:(i=y.Decorate(C,E),e.dropdownAdapter=i),0!==e.minimumResultsForSearch&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,j)),e.closeOnSelect&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,I)),null==e.dropdownCssClass&&null==e.dropdownCss&&null==e.adaptDropdownCssClass||(o=u(e.amdBase+"compat/dropdownCss"),e.dropdownAdapter=y.Decorate(e.dropdownAdapter,o)),e.dropdownAdapter=y.Decorate(e.dropdownAdapter,q)),null==e.selectionAdapter&&(e.multiple?e.selectionAdapter=h:e.selectionAdapter=p,null!=e.placeholder&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,f)),e.allowClear&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,g)),e.multiple&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,m)),null==e.containerCssClass&&null==e.containerCss&&null==e.adaptContainerCssClass||(o=u(e.amdBase+"compat/containerCss"),e.selectionAdapter=y.Decorate(e.selectionAdapter,o)),e.selectionAdapter=y.Decorate(e.selectionAdapter,v)),e.language=this._resolveLanguage(e.language),e.language.push("en");for(var s=[],a=0;a<e.language.length;a++){var l=e.language[a];-1===s.indexOf(l)&&s.push(l)}return e.language=s,e.translations=this._processTranslations(e.language,e.debug),e},n.prototype.reset=function(){function a(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return t[e]||e})}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:y.escapeMarkup,language:{},matcher:function e(t,n){if(""===c.trim(t.term))return n;if(n.children&&0<n.children.length){for(var i=c.extend(!0,{},n),r=n.children.length-1;0<=r;r--)null==e(t,n.children[r])&&i.children.splice(r,1);return 0<i.children.length?i:e(t,i)}var o=a(n.text).toUpperCase(),s=a(t.term).toUpperCase();return-1<o.indexOf(s)?n:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},n.prototype.applyFromElement=function(e,s){var n=e.language,i=this.defaults.language,r=s.prop("lang"),s=s.closest("[lang]").prop("lang"),s=Array.prototype.concat.call(this._resolveLanguage(r),this._resolveLanguage(n),this._resolveLanguage(i),this._resolveLanguage(s));return e.language=s,e},n.prototype._resolveLanguage=function(e){if(!e)return[];if(c.isEmptyObject(e))return[];if(c.isPlainObject(e))return[e];for(var r,t=c.isArray(e)?e:[e],n=[],i=0;i<t.length;i++)n.push(t[i]),"string"==typeof t[i]&&0<t[i].indexOf("-")&&(r=t[i].split("-")[0],n.push(r));return n},n.prototype._processTranslations=function(e,t){for(var n=new s,i=0;i<e.length;i++){var r=new s,o=e[i];if("string"==typeof o)try{r=s.loadPath(o)}catch(e){try{o=this.defaults.amdLanguageBase+o,r=s.loadPath(o)}catch(e){t&&window.console&&console.warn&&console.warn('Select2: The language file for "'+o+'" could not be automatically loaded. A fallback will be used instead.')}}else r=c.isPlainObject(o)?new s(o):o;n.extend(r)}return n},n.prototype.set=function(e,t){var i={};i[c.camelCase(e)]=t;i=y._convertData(i);c.extend(!0,this.defaults,i)},new n}),e.define("select2/options",["require","jquery","./defaults","./utils"],function(i,d,r,p){function e(e,n){this.options=e,null!=n&&this.fromElement(n),null!=n&&(this.options=r.applyFromElement(this.options,n)),this.options=r.apply(this.options),n&&n.is("input")&&(n=i(this.get("amdBase")+"compat/inputData"),this.options.dataAdapter=p.Decorate(this.options.dataAdapter,n))}return e.prototype.fromElement=function(e){var t=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),p.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),p.StoreData(e[0],"data",p.GetData(e[0],"select2Tags")),p.StoreData(e[0],"tags",!0)),p.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",p.GetData(e[0],"ajaxUrl")),p.StoreData(e[0],"ajax-Url",p.GetData(e[0],"ajaxUrl")));var n={};function i(e,t){return t.toUpperCase()}for(var r=0;r<e[0].attributes.length;r++){var a=e[0].attributes[r].name,l="data-";a.substr(0,l.length)==l&&(a=a.substring(l.length),l=p.GetData(e[0],a),n[a.replace(/-([a-z])/g,i)]=l)}d.fn.jquery&&"1."==d.fn.jquery.substr(0,2)&&e[0].dataset&&(n=d.extend(!0,{},e[0].dataset,n));var u,c=d.extend(!0,{},p.GetData(e[0]),n);for(u in c=p._convertData(c))-1<d.inArray(u,t)||(d.isPlainObject(this.options[u])?d.extend(this.options[u],c[u]):this.options[u]=c[u]);return this},e.prototype.get=function(e){return this.options[e]},e.prototype.set=function(e,t){this.options[e]=t},e}),e.define("select2/core",["jquery","./options","./utils","./keys"],function(o,c,u,i){function d(e,s){null!=u.GetData(e[0],"select2")&&u.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),this.options=new c(s=s||{},e),d.__super__.constructor.call(this);var a=e.attr("tabindex")||0;u.StoreData(e[0],"old-tabindex",a),e.attr("tabindex","-1"),s=this.options.get("dataAdapter"),this.dataAdapter=new s(e,this.options),a=this.render(),this._placeContainer(a),s=this.options.get("selectionAdapter"),this.selection=new s(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,a),s=this.options.get("dropdownAdapter"),this.dropdown=new s(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,a),a=this.options.get("resultsAdapter"),this.results=new a(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var l=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){l.trigger("selection:update",{data:e})}),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),u.StoreData(e[0],"select2",this),e.data("select2",this)}return u.Extend(d,u.Observable),d.prototype._generateId=function(e){return"select2-"+(null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+u.generateChars(2):u.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},d.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},d.prototype._resolveWidth=function(o,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var r=this._resolveWidth(o,"style");return null!=r?r:this._resolveWidth(o,"element")}if("element"==t){r=o.outerWidth(!1);return r<=0?"auto":r+"px"}if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(o[0]).width;o=o.attr("style");if("string"!=typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;a<l;a+=1){var c=s[a].replace(/\s/g,"").match(n);if(null!==c&&1<=c.length)return c[1]}return null},d.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},d.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=u.bind(this._syncAttributes,this),this._syncS=u.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=e?(this._observer=new e(function(e){t._syncA(),t._syncS(null,e)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},d.prototype._registerDataEvents=function(){var n=this;this.dataAdapter.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerSelectionEvents=function(){var n=this,i=["toggle","focus"];this.selection.on("toggle",function(){n.toggleDropdown()}),this.selection.on("focus",function(e){n.focus(e)}),this.selection.on("*",function(e,t){-1===o.inArray(e,i)&&n.trigger(e,t)})},d.prototype._registerDropdownEvents=function(){var n=this;this.dropdown.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerResultsEvents=function(){var n=this;this.results.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerEvents=function(){var n=this;this.on("open",function(){n.$container.addClass("select2-container--open")}),this.on("close",function(){n.$container.removeClass("select2-container--open")}),this.on("enable",function(){n.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){n.$container.addClass("select2-container--disabled")}),this.on("blur",function(){n.$container.removeClass("select2-container--focus")}),this.on("query",function(t){n.isOpen()||n.trigger("open",{}),this.dataAdapter.query(t,function(e){n.trigger("results:all",{data:e,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(e){n.trigger("results:append",{data:e,query:t})})}),this.on("keypress",function(e){var t=e.which;n.isOpen()?t===i.ESC||t===i.TAB||t===i.UP&&e.altKey?(n.close(e),e.preventDefault()):t===i.ENTER?(n.trigger("results:select",{}),e.preventDefault()):t===i.SPACE&&e.ctrlKey?(n.trigger("results:toggle",{}),e.preventDefault()):t===i.UP?(n.trigger("results:previous",{}),e.preventDefault()):t===i.DOWN&&(n.trigger("results:next",{}),e.preventDefault()):(t===i.ENTER||t===i.SPACE||t===i.DOWN&&e.altKey)&&(n.open(),e.preventDefault())})},d.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.isDisabled()?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},d.prototype._isChangeMutation=function(e,t){var n=!1,i=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&0<t.addedNodes.length)for(var r=0;r<t.addedNodes.length;r++)t.addedNodes[r].selected&&(n=!0);else t.removedNodes&&0<t.removedNodes.length?n=!0:o.isArray(t)&&o.each(t,function(e,t){if(i._isChangeMutation(e,t))return!(n=!0)});else n=!0;return n}},d.prototype._syncSubtree=function(e,n){var n=this._isChangeMutation(e,n),i=this;n&&this.dataAdapter.current(function(e){i.trigger("selection:update",{data:e})})},d.prototype.trigger=function(e,t){var n=d.__super__.trigger,i={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in i){var o={prevented:!1,name:e,args:t};if(n.call(this,i[e],o),o.prevented)return void(t.prevented=!0)}n.call(this,e,t)},d.prototype.toggleDropdown=function(){this.isDisabled()||(this.isOpen()?this.close():this.open())},d.prototype.open=function(){this.isOpen()||this.isDisabled()||this.trigger("query",{})},d.prototype.close=function(e){this.isOpen()&&this.trigger("close",{originalEvent:e})},d.prototype.isEnabled=function(){return!this.isDisabled()},d.prototype.isDisabled=function(){return this.options.get("disabled")},d.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},d.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},d.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},d.prototype.enable=function(t){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.');t=!(t=null==t||0===t.length?[!0]:t)[0];this.$element.prop("disabled",t)},d.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var t=[];return this.dataAdapter.current(function(e){t=e}),t},d.prototype.val=function(t){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==t||0===t.length)return this.$element.val();t=t[0];o.isArray(t)&&(t=o.map(t,function(e){return e.toString()})),this.$element.val(t).trigger("input").trigger("change")},d.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",u.GetData(this.$element[0],"old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),u.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},d.prototype.render=function(){var e=o('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return e.attr("dir",this.options.get("dir")),this.$container=e,this.$container.addClass("select2-container--"+this.options.get("theme")),u.StoreData(e[0],"element",this.$element),e},d}),e.define("select2/compat/utils",["jquery"],function(s){return{syncCssClasses:function(e,t,n){var i,r,o=[];(i=s.trim(e.attr("class")))&&s((i=""+i).split(/\s+/)).each(function(){0===this.indexOf("select2-")&&o.push(this)}),(i=s.trim(t.attr("class")))&&s((i=""+i).split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(r=n(this))&&o.push(r)}),e.attr("class",o.join(" "))}}}),e.define("select2/compat/containerCss",["jquery","./utils"],function(s,a){function l(e){return null}function e(){}return e.prototype.render=function(o){var t=o.call(this),n=this.options.get("containerCssClass")||"";s.isFunction(n)&&(n=n(this.$element));var r,i=this.options.get("adaptContainerCssClass");i=i||l,-1!==n.indexOf(":all:")&&(n=n.replace(":all:",""),r=i,i=function(e){var t=r(e);return null!=t?t+" "+e:e});o=this.options.get("containerCss")||{};return s.isFunction(o)&&(o=o(this.$element)),a.syncCssClasses(t,this.$element,i),t.css(o),t.addClass(n),t},e}),e.define("select2/compat/dropdownCss",["jquery","./utils"],function(s,a){function l(e){return null}function e(){}return e.prototype.render=function(o){var t=o.call(this),n=this.options.get("dropdownCssClass")||"";s.isFunction(n)&&(n=n(this.$element));var r,i=this.options.get("adaptDropdownCssClass");i=i||l,-1!==n.indexOf(":all:")&&(n=n.replace(":all:",""),r=i,i=function(e){var t=r(e);return null!=t?t+" "+e:e});o=this.options.get("dropdownCss")||{};return s.isFunction(o)&&(o=o(this.$element)),a.syncCssClasses(t,this.$element,i),t.css(o),t.addClass(n),t},e}),e.define("select2/compat/initSelection",["jquery"],function(i){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),this.initSelection=n.get("initSelection"),this._isInitialized=!1,e.call(this,t,n)}return e.prototype.current=function(e,t){var n=this;this._isInitialized?e.call(this,t):this.initSelection.call(null,this.$element,function(e){n._isInitialized=!0,i.isArray(e)||(e=[e]),t(e)})},e}),e.define("select2/compat/inputData",["jquery","../utils"],function(s,i){function e(e,t,n){this._currentData=[],this._valueSeparator=n.get("valueSeparator")||",","hidden"===t.prop("type")&&n.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),e.call(this,t,n)}return e.prototype.current=function(e,t){for(var n=[],r=0;r<this._currentData.length;r++){var o=this._currentData[r];n.push.apply(n,function i(e,t){var n=[];return e.selected||-1!==s.inArray(e.id,t)?(e.selected=!0,n.push(e)):e.selected=!1,e.children&&n.push.apply(n,i(e.children,t)),n}(o,this.$element.val().split(this._valueSeparator)))}t(n)},e.prototype.select=function(e,t){var n;this.options.get("multiple")?(n=this.$element.val(),n+=this._valueSeparator+t.id,this.$element.val(n)):(this.current(function(e){s.map(e,function(e){e.selected=!1})}),this.$element.val(t.id)),this.$element.trigger("input").trigger("change")},e.prototype.unselect=function(e,r){var o=this;r.selected=!1,this.current(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];r.id!=i.id&&t.push(i.id)}o.$element.val(t.join(o._valueSeparator)),o.$element.trigger("input").trigger("change")})},e.prototype.query=function(e,t,n){for(var i=[],r=0;r<this._currentData.length;r++){var s=this._currentData[r],s=this.matches(t,s);null!==s&&i.push(s)}n({results:i})},e.prototype.addOptions=function(e,n){n=s.map(n,function(e){return i.GetData(e[0],"data")});this._currentData.push.apply(this._currentData,n)},e}),e.define("select2/compat/matcher",["jquery"],function(s){return function(o){return function(e,t){var n=s.extend(!0,{},t);if(null==e.term||""===s.trim(e.term))return n;if(t.children){for(var i=t.children.length-1;0<=i;i--){var r=t.children[i];o(e.term,r.text,r)||n.children.splice(i,1)}if(0<n.children.length)return n}return o(e.term,t.text,t)?n:null}}}),e.define("select2/compat/query",[],function(){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.callback=n,this.options.get("query").call(null,t)},e}),e.define("select2/dropdown/attachContainer",[],function(){function e(e,t,n){e.call(this,t,n)}return e.prototype.position=function(e,t,n){n.find(".dropdown-wrapper").append(t),t.addClass("select2-dropdown--below"),n.addClass("select2-container--below")},e}),e.define("select2/dropdown/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$dropdown.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(e){e.stopPropagation()})},e}),e.define("select2/selection/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$selection.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(e){e.stopPropagation()})},e}),l=function(p){var h,f,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],g=Array.prototype.slice;if(p.event.fixHooks)for(var n=e.length;n;)p.event.fixHooks[e[--n]]=p.event.mouseHooks;var m=p.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],i,!1);else this.onmousewheel=i;p.data(this,"mousewheel-line-height",m.getLineHeight(this)),p.data(this,"mousewheel-page-height",m.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],i,!1);else this.onmousewheel=null;p.removeData(this,"mousewheel-line-height"),p.removeData(this,"mousewheel-page-height")},getLineHeight:function(n){var t=p(n),n=t["offsetParent"in p.fn?"offsetParent":"parent"]();return n.length||(n=p("body")),parseInt(n.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(e){return p(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function i(e){var c,n=e||window.event,i=g.call(arguments,1),r=0,o=0,s=0,a=0,l=0;if((e=p.event.fix(n)).type="mousewheel","detail"in n&&(s=-1*n.detail),"wheelDelta"in n&&(s=n.wheelDelta),"wheelDeltaY"in n&&(s=n.wheelDeltaY),"wheelDeltaX"in n&&(o=-1*n.wheelDeltaX),"axis"in n&&n.axis===n.HORIZONTAL_AXIS&&(o=-1*s,s=0),r=0===s?o:s,"deltaY"in n&&(r=s=-1*n.deltaY),"deltaX"in n&&(o=n.deltaX,0===s&&(r=-1*o)),0!==s||0!==o){1===n.deltaMode?(r*=c=p.data(this,"mousewheel-line-height"),s*=c,o*=c):2===n.deltaMode&&(r*=d=p.data(this,"mousewheel-page-height"),s*=d,o*=d);var d=Math.max(Math.abs(s),Math.abs(o));return(!f||d<f)&&y(n,f=d)&&(f/=40),y(n,d)&&(r/=40,o/=40,s/=40),r=Math[1<=r?"floor":"ceil"](r/f),o=Math[1<=o?"floor":"ceil"](o/f),s=Math[1<=s?"floor":"ceil"](s/f),m.settings.normalizeOffset&&this.getBoundingClientRect&&(d=this.getBoundingClientRect(),a=e.clientX-d.left,l=e.clientY-d.top),e.deltaX=o,e.deltaY=s,e.deltaFactor=f,e.offsetX=a,e.offsetY=l,e.deltaMode=0,i.unshift(e,r,o,s),h&&clearTimeout(h),h=setTimeout(v,200),(p.event.dispatch||p.event.handle).apply(this,i)}}function v(){f=null}function y(e,t){return m.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}p.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof e.define&&e.define.amd?e.define("jquery-mousewheel",["jquery"],l):"object"==typeof exports?module.exports=l:l(d),e.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],function(r,e,o,t,s){var a;return null==r.fn.select2&&(a=["open","close","destroy"],r.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var e=r.extend(!0,{},t);new o(r(this),e)}),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var n,i=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=s.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),n=e[t].apply(e,i)}),-1<r.inArray(t,a)?this:n}),null==r.fn.select2.defaults&&(r.fn.select2.defaults=t),o}),{define:e.define,require:e.require}}(),t=e.require("jquery.select2");return d.fn.select2.amd=e,t}),function(global){function Mirador(config){return this instanceof Mirador?(container=config.id,(container=jQuery("#"+container)).hasClass("mirador-container")||container.addClass("mirador-container"),this.eventEmitter=new Mirador.EventEmitter,this.saveController=new Mirador.SaveController(jQuery.extend(!0,{},config,{eventEmitter:this.eventEmitter})),this.viewer=new Mirador.Viewer({state:this.saveController,eventEmitter:this.eventEmitter}),this):new Mirador(config);var container}global.Mirador=global.Mirador||Mirador}(window),Mirador.Handlebars=Handlebars.create(),Mirador.DEFAULT_SETTINGS={workspaceType:"singleObject",saveSession:!1,workspaces:{singleObject:{label:"Single Object",addNew:!1,move:!1,iconClass:"image"},compare:{label:"Compare",iconClass:"columns"},bookReading:{defaultWindowOptions:{},label:"Book Reading",addNew:!0,move:!1,iconClass:"book"}},manifests:[],data:[],layout:"1x1",openManifestsPage:!1,preserveManifestOrder:!1,windowSettings:{availableViews:["ThumbnailsView","ImageView","ScrollView","BookView"],viewType:"ImageView",bottomPanel:!0,bottomPanelVisible:!0,sidePanel:!0,sidePanelOptions:{toc:!0,annotations:!1,tocTabAvailable:!0,layersTabAvailable:!1,searchTabAvailable:!1,annotationTabAvailable:!1},sidePanelVisible:!0,overlay:!0,canvasControls:{annotations:{annotationLayer:!0,annotationCreation:!0,annotationState:"off",annotationRefresh:!1},imageManipulation:{manipulationLayer:!0,controls:{rotate:!0,brightness:!0,contrast:!0,saturate:!0,grayscale:!0,invert:!0,mirror:!1}}},fullScreen:!0,displayLayout:!0,layoutOptions:{newObject:!0,close:!0,slotRight:!0,slotLeft:!0,slotAbove:!0,slotBelow:!0}},windowObjects:[],autoHideControls:!0,fadeDuration:400,timeoutDuration:3e3,availableAnnotationModes:[],availableAnnotationDrawingTools:["Rectangle","Ellipse","Freehand","Polygon","Pin"],availableAnnotationStylePickers:["StrokeColor","FillColor","StrokeType"],drawingToolsSettings:{doubleClickReactionTime:300,strokeColor:"deepSkyBlue",fillColor:"deepSkyBlue",fillColorAlpha:0,shapeHandleSize:10,fixedShapeSize:10,newlyCreatedShapeStrokeWidthFactor:5,hoverColor:"yellow"},availableExternalCommentsPanel:!1,shapeHandleSize:10,availableCanvasTools:[],mainMenuSettings:{show:!0,buttons:{bookmark:!1,layout:!0,options:!1,fullScreenViewer:!0}},workspacePanelSettings:{maxRows:5,maxColumns:5,preserveWindows:!0},showAddFromURLBox:!0,buildPath:"build/mirador/",i18nPath:"locales/",imagesPath:"images/",annotationEndpoint:{},annotationBodyEditor:{module:"TinyMCEAnnotationBodyEditor",options:{config:{plugins:"image link media directionality",toolbar:"bold italic | bullist numlist | link image media | removeformat | ltr rtl",tags:[]}}},jsonStorageEndpoint:{name:"JSONBlob API Endpoint",module:"JSONBlobAPI",options:{ssl:!0,port:"443",host:"jsonblob.com"}},manifestsPanel:{name:"Classic Mirador Manifests Panel",module:"ManifestsPanel",options:{}},sharingEndpoint:{url:"",storeId:123,APIKey:"23983hf98j3f9283jf2983fj"},lockController:{lockProfile:"lazyZoom",notifyMaxMin:!0}},function($){$.Viewer=function(options){jQuery.extend(!0,this,{id:null,data:null,element:null,canvas:null,workspaceType:null,layout:null,workspace:null,mainMenu:null,workspaceAutoSave:null,windowSize:{},resizeRatio:{},currentWorkspaceVisible:!0,state:null,eventEmitter:null,overlayStates:{workspacePanelVisible:!1,manifestsPanelVisible:!1,optionsPanelVisible:!1,bookmarkPanelVisible:!1},manifests:[]},options),this.id=this.state.getStateProperty("id"),this.data=this.state.getStateProperty("data"),this.element=this.element||jQuery("#"+this.id),options.availableAnnotationDrawingTools&&0<options.availableAnnotationDrawingTools.length&&(this.availableAnnotationDrawingTools=options.availableAnnotationDrawingTools),this.data&&this.init()},$.Viewer.prototype={init:function(){var i18nextOptions={fallbackLng:"en",load:"unspecific",debug:!1,backend:{loadPath:this.state.getStateProperty("buildPath")+this.state.getStateProperty("i18nPath")+"{{lng}}/{{ns}}.json"}},configuredLanguage=this.state.getStateProperty("language");configuredLanguage&&(i18nextOptions.lng=configuredLanguage),i18next.use(i18nextXHRBackend).use(i18nextBrowserLanguageDetector).init(i18nextOptions,this.setupViewer.bind(this))},setupViewer:function(){var backgroundImage=this.state.getStateProperty("buildPath")+this.state.getStateProperty("imagesPath")+"debut_dark.png";this.element.css("background-color","#333").css("background-image","url("+backgroundImage+")").css("background-position","left top").css("background-repeat","repeat"),$.Handlebars.registerHelper("t",function(result){result=i18next.t(result);return new $.Handlebars.SafeString(result)});var showMainMenu=!1;jQuery.each(this.state.getStateProperty("mainMenuSettings").buttons,function(key,value){value&&(showMainMenu=!0)}),this.state.getStateProperty("mainMenuSettings").userButtons&&0<this.state.getStateProperty("mainMenuSettings").userButtons.length&&(showMainMenu=!0),this.state.getStateProperty("mainMenuSettings").userLogo&&!jQuery.isEmptyObject(this.state.getStateProperty("mainMenuSettings").userLogo)&&(showMainMenu=!0),(showMainMenu=!1===this.state.getStateProperty("mainMenuSettings").show?!1:showMainMenu)&&(this.mainMenu=new $.MainMenu({appendTo:this.element,state:this.state,eventEmitter:this.eventEmitter}),this.eventEmitter.publish("mainMenuInitialized")),this.canvas=jQuery("<div/>").addClass("mirador-viewer").appendTo(this.element),showMainMenu||this.canvas.css("top","0px"),this.layout="string"!=typeof this.state.getStateProperty("layout")?JSON.stringify(this.state.getStateProperty("layout")):this.state.getStateProperty("layout"),this.workspace=new $.Workspace({layoutDescription:"{"===this.layout.charAt(0)?JSON.parse(this.layout):$.layoutDescriptionFromGridString(this.layout),appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}),this.workspacePanel=new $.WorkspacePanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}),this.manifestsPanel=new $[this.state.getStateProperty("manifestsPanel").module](jQuery.extend({},this.state.getStateProperty("manifestsPanel").options,{appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter})),showMainMenu&&this.state.getStateProperty("mainMenuSettings").buttons.bookmark&&(this.bookmarkPanel=new $.BookmarkPanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter})),this.set("currentWorkspaceVisible",!0),this.bindEvents(),this.listenForActions(),this.getManifestsData(),0===this.state.getStateProperty("windowObjects").length&&this.state.getStateProperty("openManifestsPage")&&this.workspace.slots[0].addItem()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestReceived",function(event,newManifest){var check;_this.state.getStateProperty("windowObjects")&&(check=jQuery.grep(_this.state.getStateProperty("windowObjects"),function(object,index){return object.loadedManifest===newManifest.uri}),jQuery.each(check,function(index,config){_this.loadManifestFromConfig(config)}))}),_this.eventEmitter.subscribe("TOGGLE_WORKSPACE_PANEL",function(event){_this.toggleWorkspacePanel()}),_this.eventEmitter.subscribe("TOGGLE_BOOKMARK_PANEL",function(event){_this.toggleBookmarkPanel()}),_this.eventEmitter.subscribe("TOGGLE_FULLSCREEN",function(event){$.fullscreenElement()?($.exitFullscreen(),_this.eventEmitter.publish("ENABLE_WINDOW_FULLSCREEN")):($.enterFullscreen(_this.element[0]),_this.eventEmitter.publish("DISABLE_WINDOW_FULLSCREEN"))}),jQuery(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){_this.eventEmitter.publish("MAINMENU_FULLSCREEN_BUTTON"),$.fullscreenElement()||_this.eventEmitter.publish("ENABLE_WINDOW_FULLSCREEN")}),_this.eventEmitter.subscribe("TOGGLE_LOAD_WINDOW",function(event){_this.toggleLoadWindow()}),_this.eventEmitter.subscribe("ADD_MANIFEST_FROM_URL",function(event,url,location){_this.addManifestFromUrl(url,location)}),_this.eventEmitter.subscribe("TOGGLE_OVERLAYS_FALSE",function(event){jQuery.each(_this.overlayStates,function(oState,value){_this.set(oState,!1,{parent:"overlayStates"})})})},bindEvents:function(){},get:function(prop,parent){return(parent?this[parent]:this)[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value,this.eventEmitter.publish(prop+".set",value)},toggleOverlay:function(state){var _this=this;jQuery.each(this.overlayStates,function(oState,value){state!==oState&&_this.set(oState,!1,{parent:"overlayStates"})});var currentState=this.get(state,"overlayStates");this.set(state,!currentState,{parent:"overlayStates"})},toggleLoadWindow:function(){this.toggleOverlay("manifestsPanelVisible")},toggleWorkspacePanel:function(){this.toggleOverlay("workspacePanelVisible")},toggleBookmarkPanel:function(){this.toggleOverlay("bookmarkPanelVisible")},getManifestsData:function(){var _this=this;_this.data.forEach(function(manifest){var url,collectionUrl;manifest.hasOwnProperty("manifestContent")?(url=manifest.manifestContent,_this.addManifestFromUrl(url["@id"],manifest.location||"",url)):manifest.hasOwnProperty("manifestUri")?(url=manifest.manifestUri,_this.addManifestFromUrl(url,manifest.location||"",null)):manifest.hasOwnProperty("collectionContent")?(collectionUrl=manifest.collectionContent,_this.addCollectionFromUrl(collectionUrl["@id"],manifest.location||"",collectionUrl)):manifest.hasOwnProperty("collectionUri")&&(collectionUrl=manifest.collectionUri,_this.addCollectionFromUrl(collectionUrl,manifest.location||"",null))})},hasWidgets:function(collection){return void 0!==collection.widgets&&collection.widgets&&!jQuery.isEmptyObject(collection.widgets)&&0<collection.widgets.length},addManifestFromUrl:function(url,location,content){var manifest,_this=this;_this.state.getStateProperty("manifests")[url]||(manifest=new $.Manifest(url,location,content),_this.eventEmitter.publish("manifestQueued",manifest,location),manifest.request.done(function(){_this.eventEmitter.publish("manifestReceived",manifest)}))},addCollectionFromUrl:function(url,location,content){var collection,_this=this;_this.state.getStateProperty("manifests")[url]||(collection=new $.Collection(url,location,content),_this.eventEmitter.publish("manifestQueued",collection,location),collection.request.done(function(){_this.eventEmitter.publish("collectionReceived",[collection,url,null])}))},loadManifestFromConfig:function(options){var windowConfig=jQuery.extend(!0,{},options);this.eventEmitter.publish("DELETE_FROM_CONFIG",options),this.eventEmitter.publish("ADD_WINDOW",windowConfig)}}}(Mirador),function($){$.Workspace=function(uid){jQuery.extend(!0,this,{workspaceSlotCls:"slot",focusedSlot:null,slots:[],windows:[],appendTo:null,layoutDescription:null,state:null,eventEmitter:null},uid);uid=$.genUUID();this.element=this.element||jQuery('<div class="workspace-container" id="workspace-'+uid+'">'),this.init()},$.Workspace.prototype={init:function(){this.element.appendTo(this.appendTo),this.calculateLayout(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("resizeMirador",function(event){_this.calculateLayout()}),_this.eventEmitter.subscribe("manifestQueued",function(event,manifestPromise){_this.state.getStateProperty("windowObjects")&&_this.state.getStateProperty("windowObjects").forEach(function(windowConfig,index){windowConfig.slotAddress?_this.getSlotFromAddress(windowConfig.slotAddress):_this.focusedSlot||_this.slots.filter(function(slot){return!!slot.hasOwnProperty("window")})[0]})}),_this.eventEmitter.subscribe("REMOVE_WINDOW",function(event,windowId){_this.removeWindow(windowId)}),_this.eventEmitter.subscribe("REMOVE_NODE",function(event,node){_this.removeNode(node)}),_this.eventEmitter.subscribe("ADD_SLOT_ITEM",function(event,slot){_this.addItem(slot)}),_this.eventEmitter.subscribe("ADD_WINDOW",function(event,windowConfig){_this.addWindow(windowConfig)}),_this.eventEmitter.subscribe("SPLIT_RIGHT",function(event,slot){_this.splitRight(slot)}),_this.eventEmitter.subscribe("SPLIT_LEFT",function(event,slot){_this.splitLeft(slot)}),_this.eventEmitter.subscribe("SPLIT_DOWN",function(event,slot){_this.splitDown(slot)}),_this.eventEmitter.subscribe("SPLIT_UP",function(event,slot){_this.splitUp(slot)}),_this.eventEmitter.subscribe("RESET_WORKSPACE_LAYOUT",function(event,options){_this.resetLayout(options.layoutDescription)})},bindEvents:function(){var _this=this;d3.select(window).on("resize",function(event){_this.calculateLayout()})},get:function(prop,parent){return(parent?this[parent]:this)[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value,this.eventEmitter.publish(prop+".set",value)},calculateLayout:function(resetting){var _this=this;_this.layout=root=new Isfahan({containerId:_this.element.attr("id"),layoutDescription:_this.layoutDescription,configuration:null,padding:3});var root=root.filter(function(d){return!d.children}),root=d3.select("#"+_this.element.attr("id")).selectAll(".layout-slot").data(root,function(d){return d.id});function cell(){this.style("left",function(d){return d.x+"px"}).style("top",function(d){return d.y+"px"}).style("width",function(d){return Math.max(0,d.dx)+"px"}).style("height",function(d){return Math.max(0,d.dy)+"px"})}root.call(cell).each(function(d){_this.slots.forEach(function(slot){slot.slotID===d.id&&(slot.layoutAddress=d.address)})}),root.enter().append("div").attr("class","layout-slot").attr("data-layout-slot-id",function(d){return d.id}).call(cell).each(function(d){var appendTo=_this.element.children("div").filter('[data-layout-slot-id="'+d.id+'"]')[0];_this.slots.push(new $.Slot({slotID:d.id,layoutAddress:d.address,focused:!0,appendTo:appendTo,state:_this.state,eventEmitter:_this.eventEmitter}))}),root.exit().remove("div").each(function(d){var slot=_this.slots.reduce(function(map,temp_slot){return d.id===temp_slot.slotID&&(map[d.id]=temp_slot),map},{})[d.id];slot&&slot.window&&!resetting&&_this.eventEmitter.publish("REMOVE_WINDOW",slot.window.id),slot.window=null,_this.slots.splice(_this.slots.indexOf(slot),1)});root=jQuery.grep(_this.layout,function(node){return!node.parent})[0];_this.eventEmitter.publish("layoutChanged",root),_this.eventEmitter.publish("slotsUpdated",{slots:_this.slots}),_this.slots.length<=1?_this.eventEmitter.publish("HIDE_REMOVE_SLOT"):_this.eventEmitter.publish("SHOW_REMOVE_SLOT")},split:function(targetSlot,direction){var _this=this,root=jQuery.grep(_this.layout,function(node){return node.id===targetSlot.slotID})[0];function addSibling(node,indexDifference){if(nodeIsNotRoot){var siblingIndex=nodeIndex+indexDifference,newSibling=_this.newNode(node.type,node);return node.parent.children.splice(siblingIndex,0,newSibling),_this.layout.push(newSibling),newSibling}node.type="row"===node.type?"column":"row",mutateAndAdd(node,indexDifference)}function mutateAndAdd(node,indexDifference){var newParent=_this.newNode(node.type,node.parent);node.type="row"===node.type?"column":"row",newSibling=_this.newNode(node.type,newParent),newParent.children=[],newParent.children.push(node),newParent.children.splice(indexDifference,0,newSibling),nodeIsNotRoot&&(newParent.parent=node.parent,newParent.parent.children[nodeIndex]=newParent),node.parent=newParent,_this.layout.push(newParent,newSibling)}nodeIndex=root.parent?root.parent.children.indexOf(root):0,nodeIsNotRoot=root.parent,"column"===root.type?"r"===direction||"l"===direction?(indexDifference="r"===direction?1:0,addSibling(root,indexDifference)):(indexDifference="d"===direction?1:0,mutateAndAdd(root,indexDifference)):"r"===direction||"l"===direction?(indexDifference="r"===direction?1:0,mutateAndAdd(root,indexDifference)):(indexDifference="d"===direction?1:0,addSibling(root,indexDifference));root=jQuery.grep(_this.layout,function(node){return!node.parent})[0];_this.layoutDescription=root,_this.calculateLayout()},splitRight:function(targetSlot){this.split(targetSlot,"r")},splitLeft:function(targetSlot){this.split(targetSlot,"l")},splitUp:function(targetSlot){this.split(targetSlot,"u")},splitDown:function(targetSlot){this.split(targetSlot,"d")},removeNode:function(targetSlot){var remainingNode,node=jQuery.grep(this.layout,function(node){return node.id===targetSlot.slotID})[0],nodeIndex=node.parent.children.indexOf(node),root=jQuery.grep(this.layout,function(node){return!node.parent})[0];2===node.parent.children.length?(node.parent.children.splice(nodeIndex,1),(remainingNode=node.parent.children[0]).parent.id=remainingNode.id,delete node.parent):1===node.parent.children.length||node.parent.children.splice(nodeIndex,1),this.layoutDescription=root,this.calculateLayout(),this.eventEmitter.publish("slotRemoved",targetSlot)},newNode:function(type,parent){return void 0===parent?{type:type,id:$.genUUID()}:{type:type,id:$.genUUID(),parent:parent}},getSlotFromAddress:function(address){return this.slots.filter(function(slot){return slot.layoutAddress===address})[0]},resetLayout:function(layoutDescription){this.layoutDescription=layoutDescription,this.calculateLayout(!0),this.placeWindows()},placeWindows:function(){var _this=this;_this.windows.length>_this.slots.length&&_this.windows.slice(0,_this.windows.length-_this.slots.length).forEach(function(removedWindow){_this.eventEmitter.publish("REMOVE_WINDOW",removedWindow.id)}),_this.windows.forEach(function(window){var slot=_this.getAvailableSlot();(slot.window=window).update({id:window.id,slotAddress:slot.layoutAddress,state:_this.state,appendTo:slot.element,canvasID:window.canvasID,viewType:window.viewType})})},getAvailableSlot:function(){return this.slots.filter(function(slot){return!slot.window})[0]},clearSlot:function(slotId){this.slots[slotId].windowElement&&this.slots[slotId].windowElement.remove(),this.slots[slotId].window=null},addItem:function(slot){this.focusedSlot=slot,this.eventEmitter.publish("TOGGLE_LOAD_WINDOW")},addWindow:function(windowConfig){var targetSlot;this.eventEmitter.publish("TOGGLE_OVERLAYS_FALSE"),targetSlot=windowConfig.slotAddress?this.getSlotFromAddress(windowConfig.slotAddress):this.focusedSlot||this.getAvailableSlot(),windowConfig.appendTo=targetSlot.element,windowConfig.state=this.state,windowConfig.eventEmitter=this.eventEmitter,targetSlot.window&&this.eventEmitter.publish("REMOVE_WINDOW",targetSlot.window.id),windowConfig.slotAddress=targetSlot.layoutAddress,windowConfig.id=windowConfig.id||$.genUUID(),this.eventEmitter.publish("windowSlotAdded",{id:windowConfig.id,slotAddress:windowConfig.slotAddress});var newWindow=jQuery.extend(!0,{},this.state.getStateProperty("windowSettings"),windowConfig);newWindow.hasOwnProperty("loadedManifest")&&(newWindow.manifest=this.state.getStateProperty("manifests")[newWindow.loadedManifest],delete newWindow.loadedManifest),newWindow.hasOwnProperty("bottomPanel")&&(newWindow.bottomPanelAvailable=newWindow.bottomPanel,delete newWindow.bottomPanel),newWindow.hasOwnProperty("sidePanel")&&(newWindow.sidePanelAvailable=newWindow.sidePanel,delete newWindow.sidePanel),windowConfig.state.currentConfig.hasOwnProperty("sidePanelOptions")&&jQuery.extend(newWindow.sidePanelOptions,windowConfig.state.currentConfig.sidePanelOptions),newWindow.hasOwnProperty("overlay")&&(newWindow.overlayAvailable=newWindow.overlay,delete newWindow.overlay),newWindow=new $.Window(newWindow),this.windows.push(newWindow),targetSlot.window=newWindow,this.eventEmitter.publish("windowAdded",{id:windowConfig.id,slotAddress:windowConfig.slotAddress})},removeWindow:function(windowId){this.windows=this.windows.filter(function(window){return window.id!==windowId}),this.eventEmitter.publish("windowRemoved",windowId)}}}(Mirador),function($){$.BookmarkPanel=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,state:null,eventEmitter:null},options),this.init()},$.BookmarkPanel.prototype={init:function(){this.element=jQuery(this.template()).appendTo(this.appendTo);var saveOptions=this.state.getStateProperty("jsonStorageEndpoint"),saveModule=saveOptions.module,saveOptions=saveOptions.options;this.storageModule=new $[saveModule](saveOptions),this.bindEvents(),this.listenForActions()},bindEvents:function(){},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("bookmarkPanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)}),_this.eventEmitter.subscribe("saveControllerConfigUpdated",function(){_this.onConfigUpdated()})},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},onConfigUpdated:function(){var _this=this;_this.storageModule.save(_this.state.cleanup(_this.state.currentConfig)).then(function(bookmarkURL){bookmarkURL=window.location.href.replace(window.location.hash,"")+"?json="+bookmarkURL;_this.element.find("#share-url").val(bookmarkURL).focus().select()})},hide:function(){jQuery(this.element).hide({effect:"slide",direction:"up",duration:300,easing:"swing"})},show:function(){jQuery(this.element).show({effect:"slide",direction:"up",duration:300,easing:"swing"})},template:$.Handlebars.compile(['<div id="bookmark-panel">','<h3>{{t "bookmarkTitle"}}</h3>',"<span>",'{{t "url"}}: <input id="share-url" type="text"></input>','<a href="javascript:;" class="mirador-btn mirador-icon-copy" data-clipboard-target="share-url"><i class="fa fa-files-o fa-lg"></i></a>',"</span>","</div>"].join(""))}}(Mirador),function($){$.CollectionTreeManifestsPanel=function(options){jQuery.extend(!0,this,{element:null,listItems:null,appendTo:null,manifestListItems:[],manifestListElement:null,manifestLoadStatusIndicator:null,treeElement:null,expectedThings:[],preloadedManifests:[],userManifests:[],nodeManifests:{},nodeCollections:{},nodeIdToUri:{},uriToNodeId:{},nodeChildren:{},unexpandedNodes:{},topCollectionsUris:{},treeQueue:[],resultsWidth:0,state:null,eventEmitter:null},options);this.init()},$.CollectionTreeManifestsPanel.prototype={init:function(){var _this=this;this.element=jQuery(this.template({showURLBox:this.state.getStateProperty("showAddFromURLBox")})).appendTo(this.appendTo),this.manifestListElement=this.element.find("ul"),jQuery.each(this.state.currentConfig.data,function(_,v){v.hasOwnProperty("manifestUri")&&_this.preloadedManifests.push(v.manifestUri)}),this.expectedThings=this.preloadedManifests,this.treeElement=jQuery("#collection-tree").jstree({core:{data:[{id:"preload",text:i18next.t("preloadedManifests"),icon:"fa fa-suitcase",state:{selected:!0},children:[]},{id:"user",text:i18next.t("myManifests"),icon:"fa fa-user",children:[]}],themes:{dots:!1},check_callback:!0,multiple:!1}}).on("select_node.jstree",function(event,data){_this.changeNode(data.node)}).on("open_node.jstree",function(event,data){_this.expandNode(data.node)}).on("ready.jstree",function(){var theQueue=_this.treeQueue.slice(0);delete _this.treeQueue,jQuery.each(theQueue,function(_,v){(4==v.length?_this.onCollectionReceived:_this.onCollectionNotReceived).apply(_this,v)})});var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".member-select-results").outerWidth(),this.controlsHeight=clone.find(".manifest-panel-controls").outerHeight(),this.paddingListElement=this.controlsHeight,this.manifestListElement.css("padding-bottom",this.paddingListElement),clone.remove(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestsPanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)}),_this.eventEmitter.subscribe("manifestReceived",function(event,newManifest){_this.onManifestReceived(event,newManifest)}),_this.eventEmitter.subscribe("collectionReceived",function(event,newCollection,parentUri,parentNodeId){_this.onCollectionReceived(event,newCollection,parentUri,parentNodeId)}),_this.eventEmitter.subscribe("collectionNotReceived",function(event,parentUri,parentNodeId){_this.onCollectionNotReceived(event,parentUri,parentNodeId)}),_this.eventEmitter.subscribe("ADD_MANIFEST_FROM_URL",function(event,url){-1==_this.userManifests.indexOf(url)&&_this.userManifests.push(url),_this.treeElement.jstree("deselect_all"),_this.treeElement.jstree("select_node","user")}),_this.eventEmitter.subscribe("ADD_COLLECTION_FROM_URL",function(event,url,source){_this.addCollectionFromUrl(url,null,!0)}),_this.eventEmitter.subscribe("ADD_OBJECT_FROM_URL",function(event,url,source){_this.addObjectFromUrl(url,source,!0)})},bindEvents:function(){var _this=this;this.element.find("form#url-load-form").on("submit",function(event){event.preventDefault(),_this.addObjectUrl(jQuery(this).find("input").val())}),this.element.find(".remove-object-option").on("click",function(event){_this.togglePanel(event)}),this.element.find("#manifest-search").on("keyup input",function(event){_this.filterManifests(this.value)}),this.element.find("#manifest-search-form").on("submit",function(event){event.preventDefault()}),jQuery(window).resize($.throttle(function(){_this.resizePanel()},50,!0))},hide:function(){jQuery(this.element).hide({effect:"fade",duration:160,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:160,easing:"easeInCubic"})},addManifestUrl:function(url){this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,"(Added from URL)"])},addObjectUrl:function(url){this.eventEmitter.publish("ADD_OBJECT_FROM_URL",[url,"(Added from URL)"])},togglePanel:function(event){this.eventEmitter.publish("TOGGLE_LOAD_WINDOW")},filterManifests:function(value){0<value.length?this.element.find(".items-listing li").show().filter(function(){return-1===jQuery(this).text().toLowerCase().indexOf(value.toLowerCase())}).hide():this.element.find(".items-listing li").show()},resizePanel:function(){var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".member-select-results").outerWidth(),clone.remove(),this.eventEmitter.publish("manifestPanelWidthChanged",this.resultsWidth)},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},onManifestReceived:function(event,newManifest){-1!=this.expectedThings.indexOf(newManifest.uri)&&(this.manifestListItems.push(new $.ManifestListItem({manifest:newManifest,resultsWidth:this.resultsWidth,state:this.state,eventEmitter:this.eventEmitter,forcedIndex:this.expectedThings.indexOf(newManifest.uri),appendTo:this.manifestListElement})),this.element.find("#manifest-search").keyup())},onCollectionReceived:function(event,newCollection,uri,parentNodeId){void 0===this.treeQueue?parentNodeId?this.updateCollectionNode(parentNodeId,newCollection):this.addCollectionNode(parentNodeId,newCollection):this.treeQueue.push([event,newCollection,uri,parentNodeId])},onCollectionNotReceived:function(event,uri,parentNodeId){var _this;void 0===this.treeQueue?(_this=this,jQuery.each(this.uriToNodeId[uri],function(_,nodeId){_this.treeElement.jstree("set_icon",nodeId,"fa fa-ban"),_this.treeElement.jstree("disable_node",nodeId)})):this.treeQueue.push([event,uri,parentNodeId])},clearManifestItems:function(){this.manifestListItems=[],this.manifestListElement.html("")},registerNodeIdUriPair:function(nodeId,uri){this.nodeIdToUri[nodeId]=uri,this.uriToNodeId[uri]?this.uriToNodeId[uri].push(nodeId):this.uriToNodeId[uri]=[nodeId]},changeNode:function(node){var _this=this;switch(this.clearManifestItems(),node.id){case"preload":_this.expectedThings=_this.preloadedManifests;break;case"user":_this.expectedThings=_this.userManifests;break;default:_this.expectedThings=_this.nodeManifests[node.id]}jQuery.each(_this.expectedThings,function(_,expectedThing){_this.addManifestFromUrl(expectedThing)}),this.element.find("#manifest-search").keyup()},expandNode:function(node){var _this=this;jQuery.each(_this.nodeCollections[node.id],function(_,uri){_this.updateCollectionFromUrl(uri,node.id)})},addObjectFromUrl:function(url,source){var _this=this,object=_this.state.getStateProperty("manifests")[url];if(object){if(object.jsonLd)switch(object.jsonLd["@type"]){case"sc:Collection":_this.eventEmitter.publish("ADD_COLLECTION_FROM_URL",[url,source]);break;case"sc:Manifest":_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,source])}}else jQuery.ajax({url:url,dataType:"json",type:"GET",success:function(data){switch(data["@type"]){case"sc:Collection":object=new $.Collection(url,source,data),_this.eventEmitter.publish("manifestQueued",object,""),_this.eventEmitter.publish("ADD_COLLECTION_FROM_URL",[url,source]);break;case"sc:Manifest":object=new $.Manifest(url,source,data),_this.eventEmitter.publish("manifestQueued",object,""),_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,source])}}})},addManifestFromUrl:function(url){var manifest,_this=this;_this.state.getStateProperty("manifests")[url]?(manifest=_this.state.getStateProperty("manifests")[url]).jsonLd&&_this.manifestListItems.push(new $.ManifestListItem({manifest:manifest,resultsWidth:_this.resultsWidth,state:_this.state,eventEmitter:_this.eventEmitter,forcedIndex:_this.expectedThings.indexOf(url),appendTo:_this.manifestListElement})):(manifest=new $.Manifest(url,""),_this.eventEmitter.publish("manifestQueued",manifest,""),manifest.request.done(function(){_this.eventEmitter.publish("manifestReceived",manifest)}))},addCollectionFromUrl:function(url,nodeId,jumpToIt){var newNode,collection,_this=this;if(!nodeId){if(_this.topCollectionsUris[url])return;_this.topCollectionsUris[url]=!0}void 0!==_this.state.getStateProperty("manifests")[url]?(collection=_this.state.getStateProperty("manifests")[url]).jsonLd&&(newNode=_this.addCollectionNode(nodeId,collection),jumpToIt&&(_this.treeElement.jstree("deselect_all"),_this.treeElement.jstree("select_node",newNode),0<collection.getCollectionUris().length&&_this.treeElement.jstree("open_node",newNode))):(collection=new $.Collection(url,""),_this.eventEmitter.publish("manifestQueued",collection,""),collection.request.done(function(){_this.eventEmitter.publish("collectionReceived",[collection,url,nodeId||null])}),collection.request.fail(function(){_this.eventEmitter.publish("collectionNotReceived",[url,nodeId||null])}))},updateCollectionFromUrl:function(url,nodeId){var collection,_this=this;void 0!==_this.state.getStateProperty("manifests")[url]?(collection=_this.state.getStateProperty("manifests")[url]).jsonLd&&_this.updateCollectionNode(nodeId,collection):(collection=new $.Collection(url,""),_this.eventEmitter.publish("manifestQueued",collection,""),collection.request.done(function(){_this.eventEmitter.publish("collectionReceived",[collection,url,nodeId||null])}),collection.request.fail(function(){_this.eventEmitter.publish("collectionNotReceived",[url,nodeId||null])}))},addCollectionNode:function(nodeId,collection,unexpanded){var _this=this,subcollectionBlocks=collection.getCollectionBlocks(),newNodeId=_this.treeElement.jstree("create_node",nodeId||null,{text:collection.jsonLd.label,icon:unexpanded?"fa fa-spinner fa-pulse":"fa fa-folder",children:[]},"last");return unexpanded&&_this.treeElement.jstree("disable_node",newNodeId),_this.registerNodeIdUriPair(newNodeId,collection.jsonLd["@id"]),_this.nodeCollections[newNodeId]=collection.getCollectionUris(),_this.nodeManifests[newNodeId]=collection.getManifestUris(),_this.nodeChildren[newNodeId]=[],unexpanded?_this.unexpandedNodes[newNodeId]=!0:jQuery.each(subcollectionBlocks,function(i,v){var nid=_this.treeElement.jstree("create_node",newNodeId,{text:v.label,icon:"fa fa-spinner fa-pulse",children:[]},"last");_this.registerNodeIdUriPair(nid,v["@id"]),_this.unexpandedNodes[nid]=!0,_this.nodeChildren[newNodeId].push(nid),_this.treeElement.jstree("disable_node",nid)}),newNodeId},updateCollectionNode:function(nodeId,collection){var _this=this,atId=collection.uri,collectionBlocks=collection.getCollectionBlocks(),collectionUris=collection.getCollectionUris(),manifestUris=collection.getManifestUris();jQuery.each(_this.nodeChildren[nodeId],function(_,n){_this.nodeIdToUri[n]==atId&&_this.unexpandedNodes[n]&&(_this.nodeCollections[n]=collectionUris,_this.nodeManifests[n]=manifestUris,_this.nodeChildren[n]=[],jQuery.each(collectionBlocks,function(i,nn){nn=_this.addCollectionNode(n,new $.Collection(nn["@id"],null,nn),!0);_this.nodeChildren[n].push(nn),_this.unexpandedNodes[nn]=!0}),delete _this.unexpandedNodes[n],_this.treeElement.jstree("set_icon",n,"fa fa-folder"),_this.treeElement.jstree("enable_node",n))})},template:$.Handlebars.compile(['<div id="manifest-select-menu">','<div class="container">','<div class="manifest-panel-controls">','<a class="remove-object-option"><i class="fa fa-times fa-lg fa-fw"></i>{{t "close"}}</a>','<div id="load-controls">',"{{#if showURLBox}}",'<form action="" id="url-load-form">','<label for="url-loader">{{t "addNewObject"}}:</label>','<input type="text" id="url-loader" name="url-load" placeholder="https://...">','<input type="submit" value="{{t "load"}}">',"</form>","{{/if}}",'<form action="" id="manifest-search-form">','<label for="manifest-search">{{t "filterObjects"}}:</label>','<input id="manifest-search" type="text" name="manifest-filter">',"</form>","</div>","</div>",'<div id="collection-tree">',"</div>",'<div class="member-select-results">','<ul class="items-listing">',"</ul>","</div>","</div>","</div>"].join(""))}}(Mirador),function($){$.MainMenu=function(options){jQuery.extend(!0,this,{element:null,mainMenuHeight:null,mainMenuWidth:null,windowOptionsMenu:null,loadWindow:null,clearLocalStorage:"",viewerCls:"mirador-viewer",mainMenuBarCls:"mirador-main-menu-bar",mainMenuCls:"mirador-main-menu",windowOptionsMenuCls:"mirador-window-options-menu",clearLocalStorageCls:"clear-local-storage",clearLocalStorageDialogCls:"mirador-main-menu-clear-local-storage",collectionsListingCls:"mirador-listing-collections",state:null,eventEmitter:null},options),this.element=this.element||jQuery("<div/>"),this.init()},$.MainMenu.prototype={init:function(){this.element.addClass(this.mainMenuBarCls).appendTo(this.appendTo),this.element.append(this.template({mainMenuCls:this.mainMenuCls,showBookmark:this.state.getStateProperty("mainMenuSettings").buttons.bookmark,showLayout:this.state.getStateProperty("mainMenuSettings").buttons.layout,showOptions:this.state.getStateProperty("mainMenuSettings").buttons.options,showFullScreenViewer:this.state.getStateProperty("mainMenuSettings").buttons.fullScreenViewer,userButtons:this.state.getStateProperty("mainMenuSettings").userButtons,userLogo:this.state.getStateProperty("mainMenuSettings").userLogo})),this.element.find(".mainmenu-button").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"top center",at:"bottom center"},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})}),this.listenForActions(),this.bindEvents()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("MAINMENU_FULLSCREEN_BUTTON",function(event){var fullScreenButton=_this.element.find(".fullscreen-viewer span");fullScreenButton.hasClass("fa-expand")?fullScreenButton.removeClass("fa-expand").addClass("fa-compress"):fullScreenButton.removeClass("fa-compress").addClass("fa-expand")})},bindEvents:function(){var _this=this;this.element.find(".change-layout").on("click",function(){_this.eventEmitter.publish("TOGGLE_WORKSPACE_PANEL"),_this.element.find(".bookmark-workspace").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")}),this.element.find(".bookmark-workspace").on("click",function(){_this.eventEmitter.publish("TOGGLE_BOOKMARK_PANEL"),_this.element.find(".change-layout").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")}),this.element.find(".window-options").on("click",function(){}),this.element.find(".fullscreen-viewer").on("click",function(){_this.eventEmitter.publish("TOGGLE_FULLSCREEN")})},template:$.Handlebars.compile(["{{#if userLogo}}",'<ul class="user-logo {{mainMenuCls}}">',"{{userlogo userLogo}}","</ul>","{{/if}}",'<ul class="{{mainMenuCls}}">',"{{#if showBookmark}}","<li>",'<a href="javascript:;" class="bookmark-workspace mainmenu-button" title="{{t "bookmarkTooltip"}}" aria-label="{{t "bookmarkTooltip"}}">','<span class="fa fa-bookmark fa-lg fa-fw"></span> {{t "bookmark"}}',"</a>","</li>","{{/if}}","{{#if showLayout}}","<li>",'<a href="javascript:;" class="change-layout mainmenu-button" title="{{t "changeLayoutTooltip"}}" aria-label="{{t "changeLayoutTooltip"}}">','<span class="fa fa-th-large fa-lg fa-fw"></span> {{t "changeLayout"}}',"</a>","</li>","{{/if}}","{{#if showFullScreenViewer}}","<li>",'<a href="javascript:;" class="fullscreen-viewer mainmenu-button" title="{{t "fullScreenTooltip"}}" aria-label="{{t "fullScreenTooltip"}}">','<span class="fa fa-expand fa-lg fa-fw"></span> {{t "fullScreen"}}',"</a>","</li>","{{/if}}","</ul>","{{#if userButtons}}","{{userbtns userButtons}}","{{/if}}"].join(""))};function processUserBtn(btn){var $sub_ul,$li=jQuery("<li>"),$a=jQuery("<a>");try{if(btn.li_attributes&&$li.attr(btn.li_attributes),!btn.label)throw"userButtons must have labels";return $a.text(btn.label),btn.iconClass&&$a.prepend('<span class="'+btn.iconClass+'"></span> '),btn.attributes&&$a.attr(btn.attributes),$li.append($a),btn.sublist&&($sub_ul=jQuery("<ul>"),btn.ul_attributes&&$sub_ul.attr(btn.ul_attributes),$sub_ul.append(processUserButtons(btn.sublist)),$li.append($sub_ul)),$li}catch(err){return console&&console.log&&console.log(err),jQuery()}}var processUserButtons=function(btns){for(var output=[],btns_len=btns.length,i=0;i<btns_len;i++)output.push(processUserBtn(btns[i]));return output};$.Handlebars.registerHelper("userbtns",function(userButtons){return new $.Handlebars.SafeString(jQuery('<ul class="user-buttons '+this.mainMenuCls+'"></ul>').append(processUserButtons(userButtons)).get(0).outerHTML)}),$.Handlebars.registerHelper("userlogo",function(userLogo){return new $.Handlebars.SafeString(processUserBtn(userLogo).get(0).outerHTML)})}(Mirador),function($){$.ManifestListItem=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,loadStatus:null,thumbHeight:80,urlHeight:150,resultsWidth:0,maxPreviewImagesWidth:0,repoWidth:80,metadataWidth:450,margin:15,remainingWidth:20,imagesTotalWidth:0,tplData:null,allImages:[],remaining:0,forcedIndex:null,state:null,eventEmitter:null},options),this.init()},$.ManifestListItem.prototype={init:function(){var liList,_this=this;this.maxPreviewImagesWidth=this.resultsWidth-(this.repoWidth+this.margin+this.metadataWidth+this.margin+this.remainingWidth),this.maxPreviewImagesWidth=.95*this.maxPreviewImagesWidth,$.Handlebars.registerHelper("pluralize",function(count,singular,plural){return 1===count?singular:plural}),this.fetchTplData(this.manifestId),null!==this.forcedIndex&&(this.tplData.index=this.forcedIndex),!_this.state.getStateProperty("preserveManifestOrder")||0===this.appendTo.children().length?this.element=jQuery(this.template(this.tplData)).prependTo(this.appendTo).hide().fadeIn("slow"):(liList=_this.appendTo.find("li"),jQuery.each(liList,function(current,item){var prev=parseFloat(jQuery(item).attr("data-index-number")),next=parseFloat(jQuery(liList[current+1]).attr("data-index-number")),current=_this.tplData.index;return current<=prev&&(current<next||isNaN(next))?(_this.element=jQuery(_this.template(_this.tplData)).insertBefore(jQuery(item)).hide().fadeIn("slow"),!1):prev<current&&(current<next||isNaN(next))?(_this.element=jQuery(_this.template(_this.tplData)).insertAfter(jQuery(item)).hide().fadeIn("slow"),!1):void 0})),this.bindEvents(),this.listenForActions()},fetchTplData:function(){var _this=this,location=_this.manifest.location,manifest=_this.manifest.jsonLd;this.tplData={label:$.JsonLd.getTextValue(manifest.label),repository:location,canvasCount:manifest.sequences[0].canvases.length,images:[],index:_this.state.getManifestIndex(manifest["@id"])},this.tplData.repoImage=function(){_this.tplData.repository;if(manifest.logo){if("string"==typeof manifest.logo)return manifest.logo;if(void 0!==manifest.logo["@id"])return manifest.logo["@id"]}return""}();for(var i=0;i<manifest.sequences[0].canvases.length;i++){var width,url,canvas=manifest.sequences[0].canvases[i];0!==canvas.width&&(url=canvas.height/canvas.width,width=_this.thumbHeight/url,url=_this.manifest.getThumbnailForCanvas(canvas,width),_this.allImages.push({url:url,width:width,height:_this.thumbHeight,id:canvas["@id"],index:i}))}jQuery.each(_this.allImages,function(index,value){var width=value.width;if(_this.imagesTotalWidth+=width+_this.margin,_this.imagesTotalWidth>=_this.maxPreviewImagesWidth)return value.width>_this.maxPreviewImagesWidth&&_this.tplData.images.push(value),_this.imagesTotalWidth-=width+_this.margin,!1;_this.tplData.images.push(value)}),_this.remaining=this.tplData.remaining=function(){var remaining=_this.allImages.length-_this.tplData.images.length;if(0<remaining)return remaining}()},render:function(){},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestPanelWidthChanged",function(event,newWidth){_this.updateDisplay(newWidth)})},bindEvents:function(){var _this=this;this.element.find("img").on("load",function(){jQuery(this).hide().fadeIn(600)}),this.element.on("click",function(){var windowConfig={manifest:_this.manifest,canvasID:null,viewType:"ThumbnailsView"};_this.eventEmitter.publish("ADD_WINDOW",windowConfig)}),this.element.find(".preview-image").on("click",function(windowConfig){windowConfig.stopPropagation();windowConfig={manifest:_this.manifest,canvasID:jQuery(this).attr("data-image-id"),viewType:_this.state.getStateProperty("windowSettings").viewType};_this.eventEmitter.publish("ADD_WINDOW",windowConfig)})},updateDisplay:function(currentLastImage){var newMaxPreviewWidth=currentLastImage-(this.repoWidth+this.margin+this.metadataWidth+this.margin+this.remainingWidth),image=null;if((newMaxPreviewWidth*=.95)<this.maxPreviewImagesWidth){for(;this.imagesTotalWidth>=newMaxPreviewWidth&&(image=this.tplData.images.pop());)this.imagesTotalWidth-=image.width+this.margin,this.element.find('img[data-image-id="'+image.id+'"]').remove();0===this.remaining&&0<this.allImages.length-this.tplData.images.length&&this.element.find(".preview-images").after('<i class="fa fa fa-ellipsis-h remaining"></i>'),this.remaining=this.allImages.length-this.tplData.images.length}else if(newMaxPreviewWidth>this.maxPreviewImagesWidth){var currentLastImage=this.tplData.images[this.tplData.images.length-1],index=currentLastImage?currentLastImage.index+1:0;if(image=this.allImages[index]){for(;this.imagesTotalWidth+image.width+this.margin<newMaxPreviewWidth&&(this.tplData.images.push(image),this.imagesTotalWidth+=image.width+this.margin,this.element.find(".preview-images").append('<img src="'+image.url+'" width="'+image.width+'" height="'+image.height+'" class="preview-image flash" data-image-id="'+image.id+'">'),image=this.allImages[++index]););0<this.remaining&&this.allImages.length-this.tplData.images.length==0&&this.element.find(".remaining").remove(),this.remaining=this.allImages.length-this.tplData.images.length}}this.maxPreviewImagesWidth=newMaxPreviewWidth,this.eventEmitter.publish("manifestListItemRendered")},hide:function(){},show:function(){},template:$.Handlebars.compile(["<li data-index-number={{index}}>",'<div class="repo-image">',"{{#if repoImage}}",'<img src="{{repoImage}}" alt="repoImg">',"{{else}}",'<span class="default-logo"></span>',"{{/if}}","</div>",'<div class="select-metadata">','<div class="manifest-title">','<h3 title="{{{label}}}">{{{label}}}</h3>',"</div>",'<div class="item-info">','<div class="item-info-row">',"{{#if repository}}",'<div class="repo-label">{{repository}}</div>',"{{/if}}",'<div class="canvas-count">{{canvasCount}} {{pluralize canvasCount (t "item") (t "items")}}</div>',"</div>","</div>","</div>",'<div class="preview-thumb">','<div class="preview-images">',"{{#each images}}",'<img src="{{url}}" width="{{width}}" height="{{height}}" class="preview-image flash" data-image-id="{{id}}">',"{{/each}}","</div>","{{#if remaining}}",'<i class="fa fa fa-ellipsis-h remaining"></i>',"{{/if}}","</div>","</li>"].join(""))}}(Mirador),function($){$.ManifestsPanel=function(options){jQuery.extend(!0,this,{element:null,listItems:null,appendTo:null,manifestListItems:[],manifestListElement:null,manifestLoadStatusIndicator:null,resultsWidth:0,state:null,eventEmitter:null},options);this.init()},$.ManifestsPanel.prototype={init:function(){this.element=jQuery(this.template({showURLBox:this.state.getStateProperty("showAddFromURLBox")})).appendTo(this.appendTo),this.manifestListElement=this.element.find("ul");var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".select-results").outerWidth(),this.controlsHeight=clone.find(".manifest-panel-controls").outerHeight(),this.paddingListElement=this.controlsHeight,this.manifestListElement.css("padding-bottom",this.paddingListElement),clone.remove(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestsPanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)}),_this.eventEmitter.subscribe("manifestReceived",function(event,newManifest){_this.onManifestReceived(event,newManifest)}),_this.eventEmitter.subscribe("collectionReceived",function(event,newCollection){_this.onCollectionReceived(event,newCollection)})},bindEvents:function(){var _this=this;this.element.find("form#url-load-form").on("submit",function(event){event.preventDefault(),_this.addManifestUrl(jQuery(this).find("input").val())}),this.element.find(".remove-object-option").on("click",function(event){_this.togglePanel(event)}),this.element.find("#manifest-search").on("keyup input",function(event){_this.filterManifests(this.value)}),this.element.find("#manifest-search-form").on("submit",function(event){event.preventDefault()}),jQuery(window).resize($.throttle(function(){_this.resizePanel()},50,!0))},hide:function(){jQuery(this.element).hide({effect:"fade",duration:160,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:160,easing:"easeInCubic"})},addManifestUrl:function(url){this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,"(Added from URL)"])},togglePanel:function(event){this.eventEmitter.publish("TOGGLE_LOAD_WINDOW")},filterManifests:function(value){0<value.length?this.element.find(".items-listing li").show().filter(function(){return-1===jQuery(this).text().toLowerCase().indexOf(value.toLowerCase())}).hide():this.element.find(".items-listing li").show()},resizePanel:function(){var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".select-results").outerWidth(),clone.remove(),this.eventEmitter.publish("manifestPanelWidthChanged",this.resultsWidth)},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},onManifestReceived:function(event,newManifest){this.manifestListItems.push(new $.ManifestListItem({manifest:newManifest,resultsWidth:this.resultsWidth,state:this.state,eventEmitter:this.eventEmitter,appendTo:this.manifestListElement})),this.element.find("#manifest-search").keyup()},onCollectionReceived:function(event,newCollection){var _this=this;jQuery.each(newCollection.getManifestUris(),function(_,v){_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[v,newCollection.location])})},template:$.Handlebars.compile(['<div id="manifest-select-menu">','<div class="container">','<div class="manifest-panel-controls">','<a class="remove-object-option"><i class="fa fa-times fa-lg fa-fw"></i>{{t "close"}}</a>','<div id="load-controls">',"{{#if showURLBox}}",'<form action="" id="url-load-form">','<label for="url-loader">{{t "addNewObject"}}:</label>','<input type="text" id="url-loader" name="url-load" placeholder="https://...">','<input type="submit" value="{{t "load"}}">',"</form>","{{/if}}",'<form action="" id="manifest-search-form">','<label for="manifest-search">{{t "filterObjects"}}:</label>','<input id="manifest-search" type="text" name="manifest-filter">',"</form>","</div>","</div>",'<div class="select-results">','<ul class="items-listing">',"</ul>","</div>","</div>","</div>"].join(""))}}(Mirador),function($){$.WorkspacePanel=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,workspace:null,state:null,eventEmitter:null},options),this.init()},$.WorkspacePanel.prototype={init:function(){var backgroundImage={rows:$.layoutDescriptionFromGridString(this.state.getStateProperty("workspacePanelSettings").maxColumns+"x"+this.state.getStateProperty("workspacePanelSettings").maxRows).children.map(function(column,rowIndex){return column.columns=column.children.map(function(row,columnIndex){return row.gridString=rowIndex+1+"x"+(columnIndex+1),row}),column})};this.element=jQuery(this.template(backgroundImage)).appendTo(this.appendTo);backgroundImage=this.state.getStateProperty("buildPath")+this.state.getStateProperty("imagesPath")+"debut_dark.png";this.element.css("background-image","url("+backgroundImage+")").css("background-repeat","repeat"),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("workspacePanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)})},bindEvents:function(){var _this=this;_this.element.find(".grid-item").on("click",function(){var gridString=jQuery(this).data("gridstring");_this.select(gridString)}),_this.element.find(".grid-item").on("mouseover",function(){var gridString=jQuery(this).data("gridstring");_this.hover(gridString)}),_this.element.find(".select-grid").on("mouseout",function(){_this.reset()})},select:function(layoutDescription){layoutDescription=$.layoutDescriptionFromGridString(layoutDescription);this.eventEmitter.publish("RESET_WORKSPACE_LAYOUT",{layoutDescription:layoutDescription}),this.eventEmitter.publish("TOGGLE_WORKSPACE_PANEL")},hover:function(gridString){var highestRow=gridString.charAt(0),highestColumn=gridString.charAt(2),gridItems=this.element.find(".grid-item");gridItems.removeClass("hovered"),gridItems.filter(function(index){var gridString=jQuery(this).data("gridstring");return gridString.charAt(0)<=highestRow&&gridString.charAt(2)<=highestColumn}).addClass("hovered"),this.element.find(".grid-instructions").hide(),this.element.find(".grid-text").text(gridString).show()},reset:function(){this.element.find(".grid-item").removeClass("hovered"),this.element.find(".grid-instructions").show(),this.element.find(".grid-text").hide()},hide:function(){jQuery(this.element).hide({effect:"fade",duration:160,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:160,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block")}})},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},template:$.Handlebars.compile(['<div id="workspace-select-menu">','<h1>{{t "changeLayout"}}</h1>','<h3 class="grid-text"></h3>','<h3 class="grid-instructions">{{t "selectGrid"}}</h3>','<div class="select-grid">',"{{#each rows}}",'<div class="grid-row">',"{{#each columns}}",'<a class="grid-item" data-gridString="{{gridString}}">','<div class="grid-icon"></div>',"</a>","{{/each}}","</div>","{{/each}}","</div>","</div>"].join(""))}}(Mirador),function($){$.Collection=function(collectionUri,location,collectionContent){collectionContent?(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:collectionUri,request:null}),this.initFromCollectionContent(collectionContent)):(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:collectionUri,request:null}),this.init(collectionUri))},$.Collection.prototype={init:function(collectionUri){var _this=this;this.request=jQuery.ajax({url:collectionUri,dataType:"json",async:!0}),this.request.done(function(jsonLd){_this.jsonLd=jsonLd})},initFromCollectionContent:function(collectionContent){var _this=this;this.request=jQuery.Deferred(),this.request.done(function(jsonLd){_this.jsonLd=jsonLd}),_this.request.resolve(collectionContent)},getVersion:function(){return{"http://www.shared-canvas.org/ns/context.json":"1","http://iiif.io/api/presentation/1/context.json":"1","http://iiif.io/api/presentation/2/context.json":"2","http://iiif.io/api/presentation/2.1/context.json":"2.1"}[this.jsonLd["@context"]]},getManifestUris:function(){return this.jsonLd.manifests?jQuery.map(this.jsonLd.manifests,function(v,_){return v["@id"]}):this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Manifest"===v["@type"])return v["@id"]}):[]},getManifestBlocks:function(){return this.jsonLd.manifests||(this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Manifest"===v["@type"])return v}):[])},getCollectionUris:function(){return this.jsonLd.collections?jQuery.map(this.jsonLd.collections,function(v,_){return v["@id"]}):this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Collection"===v["@type"])return v["@id"]}):[]},getCollectionBlocks:function(){return this.jsonLd.collections||(this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Collection"===v["@type"])return v}):[])}}}(Mirador),function($){$.Manifest=function(manifestUri,location,manifestContent){manifestContent?(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:manifestUri,request:null}),this.initFromManifestContent(manifestContent)):-1!==manifestUri.indexOf("info.json")?(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:manifestUri,request:null}),this.initFromInfoJson(manifestUri)):(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:manifestUri,request:null}),this.init(manifestUri))},$.Manifest.prototype={init:function(manifestUri){var _this=this;this.request=jQuery.ajax({url:manifestUri,dataType:"json",async:!0}),this.request.done(function(jsonLd){_this.jsonLd=jsonLd})},buildCanvasMap:function(){var _this=this;this.canvasMap={},this.getCanvases()&&this.getCanvases().forEach(function(canvas){_this.canvasMap[canvas["@id"]]=canvas})},initFromInfoJson:function(infoJsonUrl){var _this=this;this.request=jQuery.ajax({url:infoJsonUrl,dataType:"json",async:!0}),this.request.done(function(jsonLd){_this.jsonLd=_this.generateInfoWrapper(jsonLd)})},initFromManifestContent:function(manifestContent){var _this=this;this.request=jQuery.Deferred(),this.request.done(function(jsonLd){_this.jsonLd=jsonLd}),_this.request.resolve(manifestContent)},getThumbnailForCanvas:function(resource,width){var service,version="1.1",compliance=-1;return width=parseInt(width,10),resource.hasOwnProperty("thumbnail")?"string"==typeof resource.thumbnail?resource.thumbnail:!resource.thumbnail.hasOwnProperty("service")||0===(compliance=(service=resource.thumbnail.service).hasOwnProperty("profile")?$.Iiif.getComplianceLevelFromProfile(service.profile):compliance)?resource.thumbnail["@id"]:(service.hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),$.Iiif.makeUriWithWidth(service["@id"],width,version)):((service=((resource=resource.images[0].resource).default||resource).service).hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),$.Iiif.makeUriWithWidth(service["@id"],width,version))},getVersion:function(){return{"http://www.shared-canvas.org/ns/context.json":"1","http://iiif.io/api/presentation/1/context.json":"1","http://iiif.io/api/presentation/2/context.json":"2","http://iiif.io/api/presentation/2.1/context.json":"2.1"}[this.jsonLd["@context"]]},getCanvases:function(){return this.jsonLd.sequences&&this.jsonLd.sequences[0].canvases},getAnnotationsListUrls:function(canvasId){var canvas=jQuery.grep(this.getCanvases(),function(canvas,index){return canvas["@id"]===canvasId})[0],annotationsListUrls=[];if(canvas&&canvas.otherContent)for(var i=0;i<canvas.otherContent.length;i++)annotationsListUrls.push(canvas.otherContent[i]["@id"]);return annotationsListUrls},getStructures:function(){return this.jsonLd.structures},generateInfoWrapper:function(infoJson){return{"@context":"http://www.shared-canvas.org/ns/context.json","@id":infoJson["@id"],"@type":"sc:Manifest",label:infoJson["@id"].split("/")[infoJson["@id"].split("/").length-1],sequences:[{"@id":infoJson["@id"]+"/sequence/1","@type":"sc:Sequence",canvases:[{"@id":infoJson["@id"]+"/sequence/1/canvas/1","@type":"sc:Canvas",width:infoJson.width,height:infoJson.height,images:[{"@id":infoJson["@id"]+"/sequence/1/canvas/1/image/1","@type":"sc:image",motivation:"sc:painting",resource:{"@id":infoJson,"@type":"dctypes:Image",format:"image/jpeg",height:infoJson.height,width:infoJson.width,service:{"@id":infoJson["@id"],"@context":infoJson["@context"],profile:infoJson.profile}}}]}]}]}},getSearchWithinService:function(){var serviceProperty=this.jsonLd.service,service=[];if(void 0===serviceProperty)service=null;else if(serviceProperty.constructor===Array)for(var i=0;i<serviceProperty.length;i++)"http://iiif.io/api/search/0/context.json"!==serviceProperty[i]["@context"]&&"http://iiif.io/api/search/1/context.json"!==serviceProperty[i]["@context"]||service.push(serviceProperty[i]);else"http://iiif.io/api/search/0/context.json"===this.jsonLd.service["@context"]||"http://iiif.io/api/search/1/context.json"===serviceProperty["@context"]?service.push(this.jsonLd.service):service=null;return service},getCanvasLabel:function(canvas){if(console.assert(canvas&&""!==canvas,"No canvasId was specified."),this.canvasMap&&0<=canvas.indexOf("#")){canvas=this.canvasMap[canvas.split("#")[0]];return canvas?canvas.label:void 0}},getViewingDirection:function(){return this.jsonLd.viewingDirection||this.jsonLd.sequences[0].viewingDirection}}}(Mirador),function($){function PaperItem(item){this.item=item}function Group(paperScope,item){item=new paperScope.Group(item);PaperItem.call(this,item)}$.AnnotationUtils=function(){},PaperItem.prototype={getItem:function(){return this.item},translateByXY:function(x,y){this.item.position.x+=x,this.item.position.y+=y},translateByPoint:function(point){this.item.position=this.item.position.add(point)},setOnMouseDownListener:function(callback){this.mouseDown=callback},onMouseDown:function(){this.mouseDown.call(this,this.item)},remove:function(){this.item.remove()},rotate:function(angle,pivot){pivot?this.item.rotate(angle,pivot):this.item.rotate(angle)},setPosition:function(point){this.item.position=point},getWidth:function(){return this.item.width},getHeight:function(){return this.item.height},addData:function(key,data){this.item.data[key]=data},getData:function(key){return this.item.data[key]},resize:function(size){this.item.size=size}},Group.prototype=Object.create(PaperItem.prototype,{}),Group.constructor=Group;function Icon(item,opts){item=new(this.paperScope=item).Raster(opts),PaperItem.call(this,item),opts&&opts.onLoad&&(this.item.onLoad=opts.onLoad)}function PointText(paperScope,text){text=new paperScope.PointText(text);PaperItem.call(this,text)}function PointTextIcon(paperScope,opts){this.paperScope=paperScope,opts.justification="center",opts.font="FontAwesome",this.content=opts.content,PointText.call(this,paperScope,opts),this.rasterMask.addData("self",this)}function DeleteActionIcon(paperScope,opts){this.paperScope=paperScope,opts.fillColor=opts.fillColor||"black",opts.fontSize=opts.size||24/paperScope.view.zoom,opts.content="ï",this.rasterMask=new Icon(paperScope,{name:opts.name.replace("delete","Delete_mask"),size:new paperScope.Size(opts.fontSize,opts.fontSize)}),PointTextIcon.call(this,paperScope,opts)}function RotationIcon(paperScope,opts){this.paperScope=paperScope,opts.justification="center",opts.fillColor=opts.fillColor||"black",opts.fontSize=opts.size||16/paperScope.view.zoom,opts.content="ï",this.rasterMask=new Icon(paperScope,{name:opts.name.replace("rotation","Rotation_mask"),size:new paperScope.Size(opts.fontSize,opts.fontSize)}),PointTextIcon.call(this,paperScope,opts)}Icon.prototype=Object.create(PaperItem.prototype,{}),Icon.constructor=Icon,(PointText.prototype=Object.create(PaperItem.prototype)).resize=function(newSize){this.item.fontSize=newSize},PointText.constructor=PointText,(PointTextIcon.prototype=Object.create(PointText.prototype,{})).setPosition=function(point){this.rasterMask.setPosition(point),PointText.prototype.setPosition.call(this,point)},PointTextIcon.prototype.rotate=function(angle,pivot){this.rasterMask.rotate(angle,pivot),PointText.prototype.rotate.call(this,angle,pivot)},PointTextIcon.prototype.translateByPoint=function(point){this.rasterMask.translateByPoint(point),PointText.prototype.translateByPoint.call(this,point)},PointTextIcon.prototype.translateByXY=function(x,y){this.rasterMask.translateByXY(x,y),PointText.prototype.translateByXY.call(this,x,y)},PointTextIcon.prototype.remove=function(){this.rasterMask.remove(),PointText.prototype.remove.call(this)},PointTextIcon.prototype.resize=function(size){this.rasterMask.resize(new this.paperScope.Size(size,size)),PointText.prototype.resize.call(this,size)},PointTextIcon.prototype.getMask=function(){return this.rasterMask},PointTextIcon.prototype.constructor=PointTextIcon,(DeleteActionIcon.prototype=Object.create(PointTextIcon.prototype,{})).setOnMouseDownListener=function(overlay){this.mouseDown=function(){overlay.eventEmitter.publish("deleteShape."+overlay.windowId,[this.getData("parent")]),overlay.mode="delete"}},(RotationIcon.prototype=Object.create(PointTextIcon.prototype,{})).setOnMouseDownListener=function(overlay){this.mouseDown=function(){overlay.mode="rotate"}},$.AnnotationUtils.prototype={Icon:Icon,PointText:PointText,DeleteActionIcon:DeleteActionIcon,RotationIcon:RotationIcon,Group:Group}}(Mirador),function($){$.AnnotationTooltip=function(options){jQuery.extend(this,{targetElement:null,annotations:[],windowId:"",eventEmitter:null},options),this.init()},$.AnnotationTooltip.prototype={init:function(){this.editor=$[this.state.currentConfig.annotationBodyEditor.module],this.editorOptions=this.state.currentConfig.annotationBodyEditor.options,this.activeEditor=null,this.activeEditorTip=null,this.inEditOrCreateMode=!1},showEditor:function(params){var editorContainer,selector,_this=this;_this.activeEditor||(editorContainer=_this.editorTemplate({id:jQuery.isEmptyObject(params.annotation)?"":params.annotation["@id"],windowId:_this.windowId}),selector="#annotation-editor-"+_this.windowId,_this.activeEditor=new _this.editor(jQuery.extend({},_this.editorOptions,{annotation:params.annotation,windowId:_this.windowId})),_this.activeEditorTip=_this.targetElement.qtip({content:{text:editorContainer},position:{my:"center",at:"center",container:_this.targetElement,viewport:_this.targetElement},style:{classes:"qtip-bootstrap qtip"+_this.windowId},show:{event:!1},hide:{fixed:!0,delay:300,event:!1},events:{render:function(event,api){_this.eventEmitter.publish("disableTooltips."+_this.windowId),api.elements.tooltip.draggable(),jQuery(selector).on("submit",function(event){event.preventDefault(),jQuery(selector+" a.save").click()}),jQuery(selector+" a.cancel").on("click",function(event){event.preventDefault();_this.eventEmitter.publish("onAnnotationCreatedCanceled."+_this.windowId,[function(){api.destroy()},!_this.activeEditor.isDirty()])}),jQuery(selector+" a.save").on("click",function(annotation){annotation.preventDefault(),params.onSaveClickCheck()&&(annotation=_this.activeEditor.createAnnotation(),params.onAnnotationCreated&&params.onAnnotationCreated(annotation),api.destroy(),_this.activeEditor=null,_this.activeEditorTip=null)}),_this.activeEditor.show(selector),_this.eventEmitter.publish("annotationEditorAvailable."+_this.windowId)}}}),_this.activeEditorTip.qtip("show"))},initializeViewerUpgradableToEditor:function(params){var _this=this;_this.activeEditorTip=jQuery(_this.targetElement).qtip({overwrite:!0,content:{text:""},position:{target:"mouse",my:"bottom left",at:"top right",adjust:{mouse:!1,method:"shift"},container:params.container,viewport:params.viewport},style:{classes:"qtip-bootstrap qtip-viewer",tip:!1},show:{event:!1},hide:{fixed:!0,delay:300,event:!1},events:{show:function(event,api){params.onTooltipShown&&params.onTooltipShown(event,api),api.cache.hidden=!1},hidden:function(event,api){params.onTooltipHidden&&params.onTooltipHidden(event,api),_this.removeAllEvents(api,params),api.cache.hidden=!0},visible:function(event,api){},move:function(event,api){}}});var api=jQuery(_this.targetElement).qtip("api");api.cache.annotations=[],api.cache.hidden=!0,api.cache.params=params},removeAllEvents:function(api,viewerParams){var editorSelector="#annotation-editor-"+this.windowId,viewerSelector="#annotation-viewer-"+this.windowId;jQuery(viewerSelector+" a.delete").off("click"),jQuery(viewerSelector+" a.edit").off("click"),jQuery(editorSelector+" a.save").off("click"),jQuery(editorSelector+" a.cancel").off("click")},addViewerEvents:function(api,viewerParams){var _this=this,selector="#annotation-viewer-"+_this.windowId;jQuery(selector+" a.delete").on("click",function(event){event.preventDefault();var elem=this;new $.DialogBuilder(viewerParams.container).dialog({message:i18next.t("deleteAnnotation"),closeButton:!1,buttons:{no:{label:i18next.t("no"),className:"btn-default",callback:function(){}},yes:{label:i18next.t("yes"),className:"btn-primary",callback:function(){var display=jQuery(elem).parents(".annotation-display"),id=display.attr("data-anno-id");_this.eventEmitter.publish("onAnnotationDeleted."+_this.windowId,[id,function(){_this.removeAllEvents(),api.hide(),display.remove()}])}}}})}),jQuery(selector+" a.edit").on("click",function(oaAnno){oaAnno.preventDefault();var id=jQuery(this).parents(".annotation-display").attr("data-anno-id"),oaAnno=viewerParams.getAnnoFromRegion(id)[0];_this.state.getStateProperty("availableExternalCommentsPanel")?(_this.eventEmitter.publish("annotationInEditMode."+_this.windowId,[oaAnno]),_this.removeAllEvents(viewerParams),api.destroy(),jQuery(api.tooltip).remove()):(_this.freezeQtip(api,oaAnno,viewerParams),_this.removeAllEvents(api,viewerParams),_this.addEditorEvents(api,viewerParams)),_this.eventEmitter.publish("SET_ANNOTATION_EDITING."+_this.windowId,{annotationId:id,isEditable:!0,tooltip:_this}),_this.eventEmitter.publish("modeChange."+_this.windowId,"editingAnnotation")})},addEditorEvents:function(api,viewerParams){var _this=this,selector="#annotation-editor-"+_this.windowId;jQuery(selector).on("submit",function(event){event.preventDefault(),jQuery(selector+" a.save").click()}),jQuery(selector+" a.save").on("click",function(oaAnno){oaAnno.preventDefault();oaAnno=jQuery(this).parents(".annotation-editor").attr("data-anno-id"),oaAnno=viewerParams.getAnnoFromRegion(oaAnno)[0];_this.activeEditor.updateAnnotation(oaAnno),_this.eventEmitter.publish("annotationEditSave."+_this.windowId,[oaAnno])}),jQuery(selector+" a.cancel").on("click",function(oaAnno){oaAnno.preventDefault();var id=jQuery(this).parents(".annotation-editor").attr("data-anno-id"),oaAnno=viewerParams.getAnnoFromRegion(id)[0];_this.removeAllEvents(),_this.unFreezeQtip(api,oaAnno,viewerParams),_this.eventEmitter.publish("annotationEditCancel."+_this.windowId,[id])})},showViewer:function(params){var api=jQuery(this.targetElement).qtip("api");if(api&&(!params.shouldDisplayTooltip||params.shouldDisplayTooltip(api)))if(0===params.annotations.length)api.cache.hidden||(api.disable(!1),api.hide(params.triggerEvent),api.cache.annotations=[],api.cache.hidden=!0,api.disable(!0));else{var oldAnnotations=api.cache.annotations,isTheSame=oldAnnotations.length==params.annotations.length;if(isTheSame)for(var i=0;i<params.annotations.length;i++)if(oldAnnotations[i]!=params.annotations[i]){isTheSame=!1;break}!api.cache.hidden&&isTheSame||(api.disable(!1),this.setTooltipContent(params.annotations),api.cache.origin=params.triggerEvent,api.reposition(params.triggerEvent,!0),api.show(params.triggerEvent),api.cache.annotations=params.annotations,api.cache.hidden=!1,this.removeAllEvents(),this.addViewerEvents(api,api.cache.params))}},setTooltipContent:function(annotations){var api=jQuery(this.targetElement).qtip("api");api&&(api.set({"content.text":this.getViewerContent(annotations)}),this.eventEmitter.publish("tooltipViewerSet."+this.windowId))},getViewerContent:function(annotations){var annoText,tags=[],htmlAnnotations=[];return jQuery.each(annotations,function(index,annotation){tags=[],jQuery.isArray(annotation.resource)?jQuery.each(annotation.resource,function(index,value){"oa:Tag"===value["@type"]?tags.push(value.chars):annoText=value.chars}):annoText=annotation.resource.chars;var username="";annotation.annotatedBy&&annotation.annotatedBy.name&&(username=annotation.annotatedBy.name);var showUpdate=!1;"manifest"!==annotation.endpoint&&(showUpdate=annotation.endpoint.userAuthorize("update",annotation));var showDelete=!1;"manifest"!==annotation.endpoint&&(showDelete=annotation.endpoint.userAuthorize("delete",annotation)),htmlAnnotations.push({annoText:$.sanitizeHtml(annoText),tags:tags,id:annotation["@id"],username:username,showUpdate:showUpdate,showDelete:showDelete})}),this.viewerTemplate({annotations:htmlAnnotations,windowId:this.windowId})},freezeQtip:function(api,oaAnno,viewerParams){if(this.inEditOrCreateMode)throw"AnnotationTooltip already in edit mode";this.inEditOrCreateMode=!0,this.eventEmitter.publish("disableRectTool."+this.windowId);var editorContainer=this.editorTemplate({id:jQuery.isEmptyObject(oaAnno)?"":oaAnno["@id"],windowId:this.windowId});api.set({"content.text":editorContainer,"hide.event":!1}),this.activeEditor=new this.editor(jQuery.extend({},this.editorOptions,{annotation:oaAnno,windowId:this.windowId})),this.activeEditor.show("form#annotation-editor-"+this.windowId),this.eventEmitter.publish("annotationEditorAvailable."+this.windowId),jQuery(api.elements.tooltip).removeClass("qtip-viewer"),api.elements.tooltip.draggable(),viewerParams.onEnterEditMode&&viewerParams.onEnterEditMode(api,oaAnno)},unFreezeQtip:function(api,oaAnno,viewerParams){if(!this.inEditOrCreateMode)throw"AnnotationTooltip not in edit mode";this.inEditOrCreateMode=!1,this.eventEmitter.publish("enableRectTool."+this.windowId),api.set({"content.text":this.getViewerContent([oaAnno]),"hide.event":"mouseleave"}).hide(),jQuery(api.elements.tooltip).addClass("qtip-viewer"),viewerParams.onExitEditMode&&viewerParams.onExitEditMode(api,oaAnno)},editorTemplate:$.Handlebars.compile(['<form id="annotation-editor-{{windowId}}" class="annotation-editor annotation-tooltip" {{#if id}}data-anno-id="{{id}}"{{/if}}>',"<div>",'<div class="button-container">','<a href="#cancel" class="cancel"><i class="fa fa-times-circle-o fa-fw"></i>{{t "cancel"}}</a>','<a href="#save" class="save"><i class="fa fa-database fa-fw"></i>{{t "save"}}</a>',"</div>","</div>","</form>"].join("")),viewerTemplate:$.Handlebars.compile(['<div class="all-annotations" id="annotation-viewer-{{windowId}}">',"{{#each annotations}}",'<div class="annotation-display annotation-tooltip" data-anno-id="{{id}}">','<div class="button-container">','{{#if showUpdate}}<a href="#edit" class="edit"><i class="fa fa-pencil-square-o fa-fw"></i>{{t "edit"}}</a>{{/if}}','{{#if showDelete}}<a href="#delete" class="delete"><i class="fa fa-trash-o fa-fw"></i>{{t "delete"}}</a>{{/if}}',"</div>",'<div class="text-viewer">','{{#if username}}<p class="user">{{username}}:</p>{{/if}}',"<p>{{{annoText}}}</p>","</div>",'<div id="tags-viewer-{{windowId}}" class="tags-viewer">',"{{#each tags}}",'<span class="tag">{{this}}</span>',"{{/each}}","</div>","</div>","{{/each}}","</div>"].join(""))}}(Mirador),function($){$.CatchEndpoint=function(options){jQuery.extend(this,{token:null,prefix:null,params:"",dfd:null,context_id:"None",collection_id:"None",userid:"test@mirador.org",username:"mirador-test",annotationsList:[],annotationsListCatch:null,windowID:null,eventEmitter:null},options),this.init()},$.CatchEndpoint.prototype={init:function(){this.catchOptions={user:{id:this.userid,name:this.username},permissions:{read:[],update:[this.userid],delete:[this.userid],admin:[this.userid]}}},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},search:function(options,successCallback,errorCallback){var _this=this;this.annotationsList=[],jQuery.ajax({url:this.prefix+"/search"+this.params,type:"GET",dataType:"json",headers:{"x-annotator-auth-token":this.token},data:{uri:options.uri,userid:options.userid||void 0,username:options.username||void 0,text:options.text||void 0,tag:options.tag||void 0,parentid:options.parentid||void 0,contextId:_this.context_id,collectionId:_this.collection_id,media:options.media||"image",limit:options.limit||-1},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback?successCallback(data):(_this.annotationsListCatch=data.rows,jQuery.each(_this.annotationsListCatch,function(index,value){_this.annotationsList.push(_this.getAnnotationInOA(value))}),_this.dfd.resolve(!0),_this.eventEmitter.publish("catchAnnotationsLoaded."+_this.windowID,_this.annotationsListCatch))},error:function(){"function"==typeof errorCallback?errorCallback():console.log("There was an error searching this endpoint")}})},deleteAnnotation:function(annotationID,successCallback,errorCallback){var _this=this;jQuery.ajax({url:this.prefix+"/destroy/"+annotationID+this.params,type:"DELETE",dataType:"json",headers:{"x-annotator-auth-token":this.token},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(),_this.eventEmitter.publish("catchAnnotationDeleted."+_this.windowID,annotationID)},error:function(){"function"==typeof errorCallback&&errorCallback()}})},update:function(annotations,successCallback,errorCallback){var annotations=this.getAnnotationInEndpoint(annotations),_this=this;annotations.forEach(function(annotation){var annotationID=annotation.id;jQuery.ajax({url:_this.prefix+"/update/"+annotationID+_this.params,type:"POST",dataType:"json",headers:{"x-annotator-auth-token":_this.token},data:JSON.stringify(annotation),contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(_this.getAnnotationInOA(data)),_this.eventEmitter.publish("catchAnnotationUpdated."+_this.windowID,annotation)},error:function(){"function"==typeof errorCallback&&errorCallback()}})})},create:function(oaAnnotation,successCallback,errorCallback){var _this=this;this.getAnnotationInEndpoint(oaAnnotation).forEach(function(annotation){_this.createCatchAnnotation(annotation,successCallback,errorCallback)})},createCatchAnnotation:function(catchAnnotation,successCallback,errorCallback){var _this=this;jQuery.ajax({url:this.prefix+"/create"+this.params,type:"POST",dataType:"json",headers:{"x-annotator-auth-token":this.token},data:JSON.stringify(catchAnnotation),contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(_this.getAnnotationInOA(data)),_this.eventEmitter.publish("catchAnnotationCreated."+_this.windowID,data)},error:function(){"function"==typeof errorCallback&&errorCallback()}})},userAuthorize:function(permissionUserIds,annotation){if(this.roles&&(-1!==this.roles.indexOf("Instructor")||-1!==this.roles.indexOf("Administrator")))return!0;if(annotation.permissions){permissionUserIds=annotation.permissions[permissionUserIds]||[];return 0===permissionUserIds.length?!0:-1!==permissionUserIds.indexOf(this.userid)}return!annotation.user||this.userid===annotation.user.userid},getAnnotationInOA:function(annotation){var on,motivation=[],resource=[],id=annotation.id;0<annotation.tags.length&&(motivation.push("oa:tagging"),jQuery.each(annotation.tags,function(index,value){resource.push({"@type":"oa:Tag",chars:value})})),on=annotation.parent&&"0"!==annotation.parent?(motivation.push("oa:replying"),annotation.parent):(motivation.push("oa:commenting"),jQuery.isArray(annotation.rangePosition)?annotation.rangePosition:"object"==typeof annotation.rangePosition?(annotatedBy="xywh="+annotation.rangePosition.x+","+annotation.rangePosition.y+","+annotation.rangePosition.width+","+annotation.rangePosition.height,{"@type":"oa:SpecificResource",full:annotation.uri,selector:{"@type":"oa:FragmentSelector",value:annotatedBy}}):(annotatedBy=annotation.rangePosition,{"@type":"oa:SpecificResource",full:annotation.uri,selector:{"@type":"oa:SvgSelector",value:annotatedBy}})),resource.push({"@type":"dctypes:Text",format:"text/html",chars:annotation.text});var annotatedBy={"@id":annotation.user.id,name:annotation.user.name};return{"@context":"http://iiif.io/api/presentation/2/context.json","@id":String(id),"@type":"oa:Annotation",motivation:motivation,resource:resource,on:on,annotatedBy:annotatedBy,annotatedAt:annotation.created,serializedAt:annotation.updated,permissions:annotation.permissions,endpoint:this}},getAnnotationInEndpoint:function(oaAnnotation){var _this=this,uris=[];oaAnnotation.on.forEach(function(value){-1===jQuery.inArray(value.full,uris)&&uris.push(value.full)});var annotations=[];return uris.forEach(function(imageUrl){var text,annotation={},tags=[];oaAnnotation["@id"]&&(annotation.id=oaAnnotation["@id"]),annotation.media="image",jQuery.each(oaAnnotation.resource,function(index,value){"oa:Tag"===value["@type"]?tags.push(value.chars):"dctypes:Text"===value["@type"]&&(text=value.chars)}),annotation.tags=tags,annotation.text=text,annotation.uri=imageUrl,annotation.contextId=_this.context_id,annotation.collectionId=_this.collection_id,annotation.rangePosition=oaAnnotation.on;var coordsArray=[];oaAnnotation.on.forEach(function(xywh){xywh=xywh.selector.default.value.split("=")[1].split(",");coordsArray.push(xywh.map(function(i){return parseInt(i)}))});var left=coordsArray.map(function(i){return i[0]}),newRect=coordsArray.map(function(i){return i[1]}),right=coordsArray.map(function(i){return i[0]+i[2]}),bottom=coordsArray.map(function(i){return i[1]+i[3]}),newRect={x:Math.min.apply(null,left),y:Math.min.apply(null,newRect),width:Math.max.apply(null,right)-Math.min.apply(null,left),height:Math.max.apply(null,bottom)-Math.min.apply(null,newRect)},imageUrl=_this.imagesList[$.getImageIndexById(_this.imagesList,imageUrl)],imageUrl=(imageUrl=$.getThumbnailForCanvas(imageUrl,300)).replace("full",newRect.x+","+newRect.y+","+newRect.width+","+newRect.height);annotation.thumb=imageUrl,annotation.bounds={x:newRect.x,y:newRect.y,width:newRect.width,height:newRect.height},annotation.updated=(new Date).toISOString(),oaAnnotation.annotatedAt?annotation.created=oaAnnotation.annotatedAt:annotation.created=annotation.updated,annotation.user={},oaAnnotation.annotatedBy?(annotation.user.name=oaAnnotation.annotatedBy.name,annotation.user.id=oaAnnotation.annotatedBy["@id"]):annotation.user=_this.catchOptions.user,annotation.permissions=_this.catchOptions.permissions,annotation.archived=!1,annotation.ranges=[],annotation.parent="0",annotations.push(annotation)}),annotations}}}(Mirador),function($){$.Endpoint=function(options){jQuery.extend(this,{dfd:null,annotationsList:[],windowID:null,eventEmitter:null},options),this.init()},$.Endpoint.prototype={init:function(){},search:function(options,successCallback,errorCallback){var _this=this;jQuery.ajax({url:"",type:"GET",dataType:"json",headers:{},data:{},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback?successCallback(data):(jQuery.each(data,function(index,value){_this.annotationsList.push(_this.getAnnotationInOA(value))}),_this.dfd.resolve(!0))},error:function(){"function"==typeof errorCallback&&errorCallback()}})},deleteAnnotation:function(annotationID,successCallback,errorCallback){jQuery.ajax({url:"",type:"DELETE",dataType:"json",headers:{},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback()},error:function(){"function"==typeof errorCallback&&errorCallback()}})},update:function(oaAnnotation,successCallback,errorCallback){this.getAnnotationInEndpoint(oaAnnotation);jQuery.ajax({url:"",type:"POST",dataType:"json",headers:{},data:"",contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback()},error:function(){"function"==typeof errorCallback&&errorCallback()}})},create:function(oaAnnotation,successCallback,errorCallback){var _this=this;jQuery.ajax({url:"",type:"POST",dataType:"json",headers:{},data:"",contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(_this.getAnnotationInOA(data))},error:function(){"function"==typeof errorCallback&&errorCallback()}})},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},getAnnotationInOA:function(annotation){},getAnnotationInEndpoint:function(oaAnnotation){}}}(Mirador),function($){$.LegacyOpenAnnotationStrategy=function(options){jQuery.extend(this,{},options),this.init()},$.LegacyOpenAnnotationStrategy.prototype={init:function(){},isThisType:function(annotation){return!(!annotation.on||"string"!=typeof annotation.on)&&-1!==annotation.on.indexOf("xywh=")},buildAnnotation:function(bounds){var oaAnno=bounds.annotation,win=bounds.window,bounds=bounds.overlay.draftPaths[0].bounds;return oaAnno.on=win.canvasID+"#xywh="+Math.round(bounds.x)+","+Math.round(bounds.y)+","+Math.round(bounds.width)+","+Math.round(bounds.height),oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation))return osdRegionDrawTool.parseRectangle(annotation.on,annotation)}}}(Mirador),function($){$.LocalStorageEndpoint=function(options){jQuery.extend(this,{token:null,prefix:null,dfd:null,annotationsList:[],windowID:null,eventEmitter:null},options),this.init()},$.LocalStorageEndpoint.prototype={init:function(){},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},search:function(options,successCallback,errorCallback){var _this=this;this.annotationsList=[];try{_this.annotationsList=_this.getAnnotationList(options.uri),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback?successCallback(_this.annotationsList):_this.dfd.resolve(!0)}catch(e){"function"==typeof errorCallback?errorCallback():console.log("There was an error searching this endpoint")}},deleteAnnotation:function(annotationID,successCallback,errorCallback){var _this=this,keys=[];jQuery.each(_this.annotationsList[0].on,function(index,value){-1===jQuery.inArray(value.full,keys)&&keys.push(value.full)}),0===keys.length&&"function"==typeof errorCallback&&errorCallback(),jQuery.each(keys,function(index,key){try{_this.annotationsList=jQuery.grep(_this.annotationsList,function(value,index){return value["@id"]!==annotationID}),jQuery.each(_this.annotationsList,function(index,value){delete value.endpoint}),localStorage.setItem(key,JSON.stringify(_this.annotationsList)),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback&&successCallback()}catch(e){"function"==typeof errorCallback&&errorCallback()}})},update:function(oaAnnotation,successCallback,errorCallback){var _this=this,annotationID=oaAnnotation["@id"],keys=[];jQuery.each(oaAnnotation.on,function(index,value){-1===jQuery.inArray(value.full,keys)&&keys.push(value.full)}),0===keys.length&&"function"==typeof errorCallback&&errorCallback(),jQuery.each(keys,function(index,key){try{0===_this.annotationsList.length&&(_this.annotationsList=_this.getAnnotationList(key)),jQuery.each(_this.annotationsList,function(index,value){if(value["@id"]===annotationID)return _this.annotationsList[index]=oaAnnotation,!1}),jQuery.each(_this.annotationsList,function(index,value){delete value.endpoint}),localStorage.setItem(key,JSON.stringify(_this.annotationsList)),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback&&successCallback(oaAnnotation)}catch(e){"function"==typeof errorCallback&&errorCallback()}})},create:function(oaAnnotation,successCallback,errorCallback){var _this=this,keys=[];jQuery.each(oaAnnotation.on,function(index,value){-1===jQuery.inArray(value.full,keys)&&keys.push(value.full)}),0===keys.length&&"function"==typeof errorCallback&&errorCallback(),jQuery.each(keys,function(index,key){try{0===_this.annotationsList.length&&(_this.annotationsList=_this.getAnnotationList(key)),oaAnnotation["@id"]=$.genUUID(),_this.annotationsList.push(oaAnnotation),jQuery.each(_this.annotationsList,function(index,value){delete value.endpoint}),localStorage.setItem(key,JSON.stringify(_this.annotationsList)),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback&&successCallback(oaAnnotation)}catch(e){"function"==typeof errorCallback&&errorCallback()}})},getAnnotationList:function(data){data=localStorage.getItem(data);return data?JSON.parse(data):[]},userAuthorize:function(action,annotation){return!0}}}(Mirador),function($){$.Mirador21Strategy=function(options){jQuery.extend(this,{},options),this.init()},$.Mirador21Strategy.prototype={init:function(){},isThisType:function(annotation){return!!(annotation.on&&"object"==typeof annotation.on&&annotation.on.selector&&"object"==typeof annotation.on.selector&&annotation.on.selector.value&&"string"==typeof annotation.on.selector.value&&"oa:SvgSelector"===annotation.on.selector["@type"])},buildAnnotation:function(svg){var oaAnno=svg.annotation,win=svg.window,svg=svg.overlay,svg=svg.getSVGString(svg.draftPaths);return oaAnno.on={"@type":"oa:SpecificResource",full:win.canvasID,selector:{"@type":"oa:SvgSelector",value:svg},within:{"@id":win.loadedManifest,"@type":"sc:Manifest"}},oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation))return osdRegionDrawTool.svgOverlay.parseSVG(annotation.on.selector.value,annotation)}}}(Mirador),function($){$.MiradorDualStrategy=function(options){jQuery.extend(this,{},options),this.init()},$.MiradorDualStrategy.prototype={init:function(){},isThisType:function(annotation){return!!(annotation.on&&jQuery.isArray(annotation.on)&&0<annotation.on.length&&"object"==typeof annotation.on[0]&&annotation.on[0].selector&&"object"==typeof annotation.on[0].selector&&"oa:Choice"===annotation.on[0].selector["@type"]&&annotation.on[0].selector.default&&"object"==typeof annotation.on[0].selector.default&&annotation.on[0].selector.default.value&&"string"==typeof annotation.on[0].selector.default.value&&annotation.on[0].selector.item&&"object"==typeof annotation.on[0].selector.item&&annotation.on[0].selector.item.value&&"string"==typeof annotation.on[0].selector.item.value)&&(0===annotation.on[0].selector.default.value.indexOf("xywh=")&&0===annotation.on[0].selector.item.value.indexOf("<svg"))},buildAnnotation:function(options){var oaAnno=options.annotation,win=options.window,overlay=options.overlay;return oaAnno.on=[],jQuery.each(overlay.draftPaths,function(index,bounds){var svg=overlay.getSVGString([bounds]),bounds=bounds.bounds;oaAnno.on.push({"@type":"oa:SpecificResource",full:win.canvasID,selector:{"@type":"oa:Choice",default:{"@type":"oa:FragmentSelector",value:"xywh="+Math.round(bounds.x)+","+Math.round(bounds.y)+","+Math.round(bounds.width)+","+Math.round(bounds.height)},item:{"@type":"oa:SvgSelector",value:svg}},within:{"@id":win.loadedManifest,"@type":"sc:Manifest"}})}),oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation)){var regionArray=[];return jQuery.each(annotation.on,function(index,target){regionArray=regionArray.concat(osdRegionDrawTool.svgOverlay.parseSVG(target.selector.item.value,annotation))}),regionArray}}}}(Mirador),function($){$.MiradorLegacyStrategy=function(options){jQuery.extend(this,{},options),this.init()},$.MiradorLegacyStrategy.prototype={init:function(){},isThisType:function(annotation){return!!(annotation.on&&"object"==typeof annotation.on&&annotation.on.selector&&"object"==typeof annotation.on.selector&&annotation.on.selector.value&&"string"==typeof annotation.on.selector.value&&"oa:FragmentSelector"===annotation.on.selector["@type"])&&0===annotation.on.selector.value.indexOf("xywh=")},buildAnnotation:function(bounds){var oaAnno=bounds.annotation,win=bounds.window,bounds=bounds.overlay.draftPaths[0].bounds;return oaAnno.on={"@type":"oa:SpecificResource",full:win.canvasID,selector:{"@type":"oa:FragmentSelector",value:"xywh="+Math.round(bounds.x)+","+Math.round(bounds.y)+","+Math.round(bounds.width)+","+Math.round(bounds.height)}},oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation))return osdRegionDrawTool.parseRectangle(annotation.on.full+"#"+annotation.on.selector.value,annotation)}}}(Mirador),function($){$.OsdRegionDrawTool=function(options){jQuery.extend(this,{osdViewer:null,parent:null,osd:null,list:null,annotationsToShapesMap:{},eventEmitter:null},options),this.eventsSubscriptions=[],this.init()},$.OsdRegionDrawTool.prototype={init:function(){this.svgOverlay=this.osdViewer.svgOverlay(this.osdViewer.id,this.windowId,this.state,this.eventEmitter),this.svgOverlay.show(),this.svgOverlay.disable(),this.horizontallyFlipped=!1,this.listenForActions()},enterDisplayAnnotations:function(){this.svgOverlay.setMouseTool(),this.svgOverlay.inEditOrCreateMode?this.svgOverlay.checkToRemoveFocus():(this.exitEditMode(!0),this.render())},enterCreateAnnotation:function(){this.svgOverlay.inEditOrCreateMode?this.svgOverlay.checkToRemoveFocus():(this.osdViewer.setMouseNavEnabled(!1),this.svgOverlay.show(),this.svgOverlay.enable(),this.render())},enterCreateShape:function(){this.svgOverlay.inEditOrCreateMode?this.svgOverlay.checkToRemoveFocus():(this.osdViewer.setMouseNavEnabled(!1),this.svgOverlay.show(),this.svgOverlay.enable())},enterEditAnnotation:function(){this.osdViewer.setMouseNavEnabled(!1),this.svgOverlay.show(),this.svgOverlay.enableEdit()},enterDefault:function(){this.svgOverlay.removeMouseTool(),this.exitEditMode(!1)},exitEditMode:function(showAnnotations){this.osdViewer.setMouseNavEnabled(!0),this.svgOverlay.disable(),showAnnotations?this.svgOverlay.show():this.svgOverlay.hide()},render:function(){if(this.parent.mode===$.AnnotationsLayer.DISPLAY_ANNOTATIONS){this.svgOverlay.restoreEditedShapes(),this.svgOverlay.paperScope.activate(),this.svgOverlay.paperScope.project.clear();this.annotationsToShapesMap={};for(var strategies=[new $.Mirador21Strategy,new $.LegacyOpenAnnotationStrategy,new $.MiradorLegacyStrategy,new $.MiradorDualStrategy],i=0;i<this.list.length;i++){var annotation=this.list[i];try{var shapeArray=this.prepareShapeArray(annotation,strategies);0<shapeArray.length?(this.svgOverlay.restoreLastView(shapeArray),this.annotationsToShapesMap[annotation["@id"]]=shapeArray):console.log("ERROR couldn't find a strategy for "+annotation["@id"])}catch(e){console.log("ERROR OsdRegionDrawTool#render anno:",annotation,"error:",e)}}var windowElement=this.state.getWindowElement(this.windowId);this.annoTooltip=new $.AnnotationTooltip({targetElement:jQuery(this.osdViewer.element),state:this.state,eventEmitter:this.eventEmitter,windowId:this.windowId}),this.annoTooltip.initializeViewerUpgradableToEditor({container:windowElement,viewport:windowElement,getAnnoFromRegion:this.getAnnoFromRegion.bind(this)}),this.svgOverlay.paperScope.view.draw(),this.eventEmitter.publish("annotationsRendered."+this.windowId)}},prepareShapeArray:function(annotation,strategies){if("object"==typeof annotation&&annotation.on)for(var i=0;i<strategies.length;i++)if(strategies[i].isThisType(annotation))return strategies[i].parseRegion(annotation,this);return[]},parseRectangle:function(shape,annotation){shape=shape.split("=")[1].split(","),shape={x:parseInt(shape[0]),y:parseInt(shape[1]),width:parseInt(shape[2]),height:parseInt(shape[3])};return this.svgOverlay.createRectangle(shape,annotation)},showTooltipsFromMousePosition:function(event,location,absoluteLocation){var key,_this=this,currentCanvasModel=this.state.getWindowObjectById(this.windowId),currentCanvasModel=currentCanvasModel.canvases[currentCanvasModel.canvasID],hitOptions={fill:!0,stroke:!0,segments:!0},hoverColor=this.state.getStateProperty("drawingToolsSettings").hoverColor,annotations=[];for(key in this.horizontallyFlipped&&(location.x=currentCanvasModel.getBounds().width-location.x),_this.annotationsToShapesMap)if(_this.annotationsToShapesMap.hasOwnProperty(key))for(var shapeArray=_this.annotationsToShapesMap[key],idx=0;idx<shapeArray.length;idx++){var shapeTool=this.svgOverlay.getTool(shapeArray[idx]),hoverWidth=shapeArray[idx].data.strokeWidth/this.svgOverlay.paperScope.view.zoom;if(shapeArray[idx].hitTest(location,hitOptions)){if(annotations.push(shapeArray[idx].data.annotation),shapeTool.onHover)for(var k=0;k<shapeArray.length;k++)shapeTool.onHover(!0,shapeArray[k],hoverWidth,hoverColor);break}shapeTool.onHover&&shapeTool.onHover(!1,shapeArray[idx],hoverWidth)}this.svgOverlay.paperScope.view.draw(),_this.annoTooltip.showViewer({annotations:annotations,triggerEvent:event,shouldDisplayTooltip:function(bottomSide){if(bottomSide.elements.tooltip){var cursorWithinTooltip=!0,leftSide=bottomSide.elements.tooltip.offset().left-_this.svgOverlay.hitOptions.tolerance,topSide=bottomSide.elements.tooltip.offset().left+bottomSide.elements.tooltip.width()+_this.svgOverlay.hitOptions.tolerance;(absoluteLocation.x<leftSide||topSide<absoluteLocation.x)&&(cursorWithinTooltip=!1);topSide=bottomSide.elements.tooltip.offset().top-_this.svgOverlay.hitOptions.tolerance,bottomSide=bottomSide.elements.tooltip.offset().top+bottomSide.elements.tooltip.height()+_this.svgOverlay.hitOptions.tolerance;return!(cursorWithinTooltip=absoluteLocation.y<topSide||bottomSide<absoluteLocation.y?!1:cursorWithinTooltip)}return!0}})},listenForActions:function(){var _this=this;this._thisDestroy=function(){_this.destroy()},_this.osdViewer.addHandler("close",this._thisDestroy),this.eventsSubscriptions.push(this.eventEmitter.subscribe("DESTROY_EVENTS."+this.windowId,function(event){_this.destroy()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("updateTooltips."+_this.windowId,function(event,location,absoluteLocation){_this.annoTooltip&&!_this.annoTooltip.inEditOrCreateMode&&_this.showTooltipsFromMousePosition(event,location,absoluteLocation)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("removeTooltips."+_this.windowId,function(){jQuery(_this.osdViewer.element).qtip("destroy",!0)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("disableTooltips."+_this.windowId,function(){_this.annoTooltip&&(_this.annoTooltip.inEditOrCreateMode=!0)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("enableTooltips."+_this.windowId,function(){_this.annoTooltip&&(_this.annoTooltip.inEditOrCreateMode=!1),_this.svgOverlay.restoreDraftShapes()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("SET_ANNOTATION_EDITING."+_this.windowId,function(event,options){jQuery.each(_this.annotationsToShapesMap,function(key,paths){key===options.annotationId?(options.isEditable?_this.eventEmitter.publish("SET_OVERLAY_TOOLTIP."+_this.windowId,{tooltip:options.tooltip,visible:!0,paths:paths}):_this.eventEmitter.publish("SET_OVERLAY_TOOLTIP."+_this.windowId,{tooltip:null,visible:!1,paths:[]}),jQuery.each(paths,function(index,path){path.data.editable=options.isEditable,options.isEditable?path.strokeWidth=(path.data.strokeWidth+5)/_this.svgOverlay.paperScope.view.zoom:path.strokeWidth=path.data.strokeWidth/_this.svgOverlay.paperScope.view.zoom,_this.svgOverlay.getTool(path).onHover(!1,path,path.strokeWidth)})):jQuery.each(paths,function(index,path){path.data.editable=!1})}),_this.svgOverlay.paperScope.view.draw()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("refreshOverlay."+_this.windowId,function(event){_this.render()})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("enableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!0)})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("disableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!1)}))},getAnnoFromRegion:function(regionId){return this.list.filter(function(annotation){return annotation["@id"]===regionId})},destroy:function(){var _this=this;this.eventsSubscriptions.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)}),this.osdViewer.removeHandler("close",this._thisDestroy)}}}(Mirador),function($){$.Ellipse=function(options){jQuery.extend(this,{name:"Ellipse",logoClass:"radio_button_unchecked",idPrefix:"ellipse_",tooltip:"ellipseTooltip"},options),this.init()},$.Ellipse.prototype={init:function(){},createShape:function(initialPoint,overlay){overlay.mode="create";var shape=[],pixel=1/overlay.paperScope.view.zoom;shape.push(new overlay.paperScope.Point(initialPoint.x-2*pixel,initialPoint.y-2*pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x-pixel,initialPoint.y-(Math.sqrt(2)+1)*pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x-pixel,initialPoint.y-(Math.sqrt(2)+1)*pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x-pixel,initialPoint.y-(Math.sqrt(2)+1)*pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y-2*pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x+(Math.sqrt(2)-1)*pixel,initialPoint.y-pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y)),shape.push(new overlay.paperScope.Point(initialPoint.x-pixel,initialPoint.y+(Math.sqrt(2)-1)*pixel)),shape.push(new overlay.paperScope.Point(initialPoint.x-2*pixel,initialPoint.y)),shape.push(new overlay.paperScope.Point(initialPoint.x-(Math.sqrt(2)+1)*pixel,initialPoint.y-pixel));shape=new overlay.paperScope.Path({segments:shape,name:overlay.getName(this)});return shape.dashArray=overlay.dashArray,shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape.strokeColor=overlay.strokeColor,shape.fillColor=overlay.fillColor,shape.fillColor.alpha=overlay.fillColorAlpha,shape.closed=!0,shape.data.rotation=0,overlay.segment=shape.segments[6],this.updateSelection(!0,shape,overlay),shape},updateSelection:function(point,item,overlay){var inHandle,outHandle;-1!=item._name.toString().indexOf(this.idPrefix)&&(10<item.segments.length&&item.removeSegment(10),item.smooth({from:-7,to:1}),item.selected=point,item.segments[2].selected=point,inHandle=(inHandle=item.segments[7].handleIn.clone()).multiply(-1),outHandle=(outHandle=item.segments[7].handleOut.clone()).multiply(-1),item.segments[1].handleIn=inHandle,item.segments[1].handleOut=new overlay.paperScope.Point(0,0),item.segments[2].handleIn=new overlay.paperScope.Point(0,0),item.segments[2].handleOut=new overlay.paperScope.Point(0,0),item.segments[3].handleIn=new overlay.paperScope.Point(0,0),item.segments[3].handleOut=outHandle,point?(point=(point=item.segments[2].point.clone()).add(item.segments[2].handleOut),item.contains(point)&&(item.segments[2].handleOut=item.segments[2].handleOut.rotate(180,item.segments[2])),item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.addData("pivot",item.segments[7].point),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.setOnMouseDownListener(overlay)),item.data.rotationIcon||(item.data.rotationIcon=new overlay.annotationUtils.RotationIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"rotation",fillColor:item.selectedColor}),item.data.rotationIcon.addData("pivot",item.segments[3].point),item.data.rotationIcon.addData("type","rotationIcon"),item.data.rotationIcon.addData("self",item.data.rotationIcon),item.data.rotationIcon.addData("parent",item),item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.setOnMouseDownListener(overlay)),item.data.group||(item.data.group=new overlay.annotationUtils.Group(overlay.paperScope,[item,item.data.deleteIcon.getItem(),item.data.deleteIcon.getMask().getItem(),item.data.rotationIcon.getItem(),item.data.rotationIcon.getMask().getItem()])),item.contains(item.data.deleteIcon.getItem().position)&&(item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.rotate(180,item.data.deleteIcon.getData("pivot")),item.data.deleteIcon.rotate(180)),item.contains(item.data.rotationIcon.getItem().position)&&(item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.rotate(180,item.data.rotationIcon.getData("pivot")),item.data.rotationIcon.rotate(180))):(item.data.group&&(item.data.group.remove(),item.data.group=null,overlay.paperScope.project.activeLayer.addChild(item)),item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null),item.data.rotationIcon&&(item.data.rotationIcon.remove(),item.data.rotationIcon=null),item.segments[2].handleOut=new overlay.paperScope.Point(0,0)))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&(-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(24/overlay.paperScope.view.zoom)),-1!==item._name.toString().indexOf("rotation")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(16/overlay.paperScope.view.zoom)))},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){"create"==overlay.mode&&overlay.path?overlay.onDrawFinish():("translate"===overlay.mode||"deform"===overlay.mode&&overlay.path)&&overlay.onEditFinish()},translate:function(event,overlay){for(var i=0;i<overlay.path.segments.length;i++)overlay.path.segments[i].point.x+=event.delta.x,overlay.path.segments[i].point.y+=event.delta.y;overlay.path.data.rotationIcon.translateByXY(event.delta.x,event.delta.y),overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y)},rotate:function(event,overlay){var rotation=overlay.path.position,rotation=Math.atan2(event.point.y-rotation.y+event.delta.y,event.point.x-rotation.x+event.delta.x)-Math.atan2(event.point.y-rotation.y,event.point.x-rotation.x);rotation*=180/Math.PI,overlay.path.data.group.rotate(rotation,overlay.path.position),overlay.path.data.deleteIcon.rotate(-rotation),overlay.path.data.rotationIcon.rotate(-rotation),overlay.path.data.rotation+=rotation},onMouseDrag:function(event,overlay){if("translate"!=overlay.mode)if("rotate"!==overlay.mode){if("create"==overlay.mode||"deform"==overlay.mode){for(var idx=-1,l=0;l<overlay.path.segments.length;l++)if(overlay.path.segments[l]==overlay.segment){idx=l;break}var moveRightSize=new overlay.paperScope.Point(event.delta.x,event.delta.y),moveLeftSize=overlay.path.data.rotation,moveRightSize=moveRightSize.rotate(-moveLeftSize),point=(point=new overlay.paperScope.Point(moveRightSize.x,0)).rotate(moveLeftSize),translationY=(translationY=new overlay.paperScope.Point(0,moveRightSize.y)).rotate(moveLeftSize);0!==idx&&4!==idx&&6!==idx&&8!==idx||(point=point.multiply(2/(1+Math.sqrt(.5))),translationY=translationY.multiply(2/(1+Math.sqrt(.5))));var trBottom,trLeft,moveTopSize=0===idx||1===idx||2===idx||3===idx||4===idx,moveBottomSize=6===idx||7===idx||8===idx,moveRightSize=4===idx||5===idx||6===idx,moveLeftSize=0===idx||8===idx||9===idx;moveTopSize&&(overlay.path.data.rotationIcon.translateByPoint(translationY),overlay.path.segments[1].point=overlay.path.segments[1].point.add(translationY),overlay.path.segments[2].point=overlay.path.segments[2].point.add(translationY),overlay.path.segments[3].point=overlay.path.segments[3].point.add(translationY),trBottom=(trBottom=translationY.clone()).multiply((1+Math.sqrt(.5))/2),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trBottom),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trBottom),trBottom=trBottom.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trBottom),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trBottom)),moveBottomSize&&(overlay.path.data.deleteIcon.translateByPoint(translationY),overlay.path.segments[7].point=overlay.path.segments[7].point.add(translationY),trBottom=(trBottom=translationY.clone()).multiply((1+Math.sqrt(.5))/2),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trBottom),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trBottom),trBottom=trBottom.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trBottom),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trBottom)),(moveTopSize||moveBottomSize)&&(translationY=translationY.multiply(.5),overlay.path.segments[5].point=overlay.path.segments[5].point.add(translationY),overlay.path.segments[9].point=overlay.path.segments[9].point.add(translationY)),moveRightSize&&(overlay.path.segments[5].point=overlay.path.segments[5].point.add(point),trLeft=(trLeft=point.clone()).multiply((1+Math.sqrt(.5))/2),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trLeft),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trLeft),trLeft=trLeft.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trLeft),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trLeft)),moveLeftSize&&(overlay.path.segments[9].point=overlay.path.segments[9].point.add(point),trLeft=(trLeft=point.clone()).multiply((1+Math.sqrt(.5))/2),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trLeft),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trLeft),trLeft=trLeft.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trLeft),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trLeft)),(moveRightSize||moveLeftSize)&&(point=point.multiply(.5),overlay.path.data.rotationIcon.translateByPoint(point),overlay.path.data.deleteIcon.translateByPoint(point),overlay.path.segments[1].point=overlay.path.segments[1].point.add(point),overlay.path.segments[2].point=overlay.path.segments[2].point.add(point),overlay.path.segments[3].point=overlay.path.segments[3].point.add(point),overlay.path.segments[7].point=overlay.path.segments[7].point.add(point));point=(point=overlay.path.segments[2].point.clone()).add(overlay.path.segments[2].handleOut);overlay.path.contains(point)&&(overlay.path.segments[2].handleOut=overlay.path.segments[2].handleOut.rotate(180,overlay.path.segments[2])),overlay.path.contains(overlay.path.data.deleteIcon.getItem().position)&&(overlay.path.data.deleteIcon.rotate(180,overlay.path.data.deleteIcon.getData("pivot")),overlay.path.data.deleteIcon.rotate(180)),overlay.path.contains(overlay.path.data.rotationIcon.getItem().position)&&(overlay.path.data.rotationIcon.rotate(180,overlay.path.data.rotationIcon.getData("pivot")),overlay.path.data.rotationIcon.rotate(180)),10<overlay.path.segments.length&&overlay.path.removeSegment(10),overlay.path.smooth({from:-7,to:1})}}else this.rotate(event,overlay);else this.translate(event,overlay)},onMouseMove:function(hitResult,overlay){hitResult=overlay.paperScope.project.hitTest(hitResult.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type&&"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type?"pixel"!==hitResult.type&&!hitResult.segment||jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)&&"deform"!=overlay.mode&&"translate"!=overlay.mode&&"create"!=overlay.mode){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return hitResult.item.data.self.onMouseDown(),void("rotate"===overlay.mode&&(overlay.path=hitResult.item.data.self.getItem().data.parent));"segment"===hitResult.type&&(overlay.mode="deform",overlay.segment=null,overlay.path=null,this.setCursor(hitResult,overlay)),"stroke"!==hitResult.type&&"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type||(overlay.mode="translate",overlay.segment=null,overlay.path=null)}"translate"!==overlay.mode?"deform"!==overlay.mode?overlay.path=this.createShape(event.point,overlay):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):(overlay.path=hitResult.item,overlay.segment=hitResult.segment):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):overlay.path=hitResult.item},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.Freehand=function(options){jQuery.extend(this,{name:"Freehand",logoClass:"gesture",idPrefix:"smooth_path_",tooltip:"freehandTooltip"},options),this.init()},$.Freehand.prototype={init:function(){},createShape:function(shape,overlay){overlay.mode="create";shape=new overlay.paperScope.Path({segments:[shape],dashArray:overlay.dashArray,strokeColor:overlay.strokeColor,name:overlay.getName(this)});return shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape},updateSelection:function(selected,item,overlay){-1!==item._name.toString().indexOf(this.idPrefix)&&((item.selected=selected)?item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(item))),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.deleteIcon.setOnMouseDownListener(overlay)):item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.self.resize(24/overlay.paperScope.view.zoom))},getPivotPointForDeleteIcon:function(item){for(var points=[],i=0;i<item.segments.length;i++)points.push(item.segments[i].point);return{x:this.getGeometricCenterOfPoints(points).x,y:this.getLowestPoint(points).y}},getLowestPoint:function(points){for(var lx=0,ly=0,i=0;i<points.length;i++)lx=Math.max(lx,points[i].x),ly=Math.max(ly,points[i].y);return{x:lx,y:ly}},getGeometricCenterOfPoints:function(points){for(var cx=0,cy=0,i=0;i<points.length;i++)cx+=points[i].x,cy+=points[i].y;return{x:cx/points.length,y:cy/points.length}},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){"create"===overlay.mode&&overlay.path&&(overlay.path.simplify(),overlay.onDrawFinish())},onMouseDrag:function(path,overlay){"deform"!==overlay.mode?"translate"!==overlay.mode?"create"===overlay.mode&&(overlay.path.add(path.point),overlay.path.data.deleteIcon&&(overlay.path.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(overlay.path))),overlay.path.data.deleteIcon.setPosition(overlay.path.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))))):overlay.path&&(overlay.path.position.x+=path.delta.x,overlay.path.position.y+=path.delta.y,overlay.path.data.deleteIcon&&overlay.path.data.deleteIcon.translateByXY(path.delta.x,path.delta.y)):overlay.segment&&(overlay.segment.point.x+=path.delta.x,overlay.segment.point.y+=path.delta.y,overlay.path.smooth(),(path=overlay.segment.path).data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(path))),path.data.deleteIcon.setPosition(path.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))))},onMouseMove:function(hitResult,overlay){hitResult=overlay.paperScope.project.hitTest(hitResult.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type?"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type&&"pixel"!==hitResult.type&&!hitResult.segment||jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return void hitResult.item.data.self.onMouseDown();if("create"!==overlay.mode){if("stroke"===hitResult.type)return overlay.mode="translate",void(overlay.path=hitResult.item);if("segment"===hitResult.type||"handle-out"===hitResult.type||"handle-in"===hitResult.type)return event.modifiers.shift&&2<hitResult.item.segments.length?void hitResult.segment.remove():(overlay.mode="deform",overlay.segment=hitResult.segment,void(overlay.path=hitResult.item))}}else"create"!==overlay.mode&&(overlay.mode="");""===overlay.mode&&(overlay.path=this.createShape(event.point,overlay))},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.getTools=function(options){return this.svgOverlayTools||(options.partOfPrefix="_partOf",this.svgOverlayTools=[new $.Rectangle(options),new $.Freehand(options),new $.Polygon(options),new $.Ellipse(options),new $.Pin(options)],this.svgOverlayTools)},OpenSeadragon.Viewer.prototype.svgOverlay=function(osdViewerId,windowId,state,eventEmitter){return new $.Overlay(this,osdViewerId,windowId,state,eventEmitter)};$.Overlay=function(viewer,osdViewerId,windowId,state,eventEmitter){var drawingToolsSettings=state.getStateProperty("drawingToolsSettings");this.drawingToolsSettings=drawingToolsSettings;var availableAnnotationDrawingTools=state.getStateProperty("availableAnnotationDrawingTools"),availableExternalCommentsPanel=state.getStateProperty("availableExternalCommentsPanel");jQuery.extend(this,{disabled:!0,inEditOrCreateMode:!1,osdViewerId:osdViewerId,windowId:windowId,commentPanel:null,mode:"",draftPaths:[],editedPaths:[],hoveredPath:null,path:null,segment:null,latestMouseDownTime:-1,doubleClickReactionTime:drawingToolsSettings.doubleClickReactionTime,availableAnnotationDrawingTools:availableAnnotationDrawingTools,availableExternalCommentsPanel:availableExternalCommentsPanel,dashArray:[],strokeWidth:1,fixedShapeSize:drawingToolsSettings.fixedShapeSize,selectedColor:drawingToolsSettings.selectedColor||"#004c66",shapeHandleSize:drawingToolsSettings.shapeHandleSize,partOfPrefix:"_partOf",hitOptions:{handles:!0,stroke:!0,segments:!0,tolerance:5}}),this.tools=$.getTools(drawingToolsSettings),this.currentTool=null,this.dashArray=[],this.strokeWidth=1,this.strokeColor=drawingToolsSettings.strokeColor,this.fillColor=drawingToolsSettings.fillColor,this.fillColorAlpha=drawingToolsSettings.fillColorAlpha,this.viewer=viewer,this.canvas=document.createElement("canvas"),jQuery(this.canvas).attr("tabindex","0").mousedown(function(){jQuery(this).focus()}),this.canvas.id="draw_canvas_"+this.windowId,this.viewer.canvas.appendChild(this.canvas);this.slotWindowElement=state.getWindowElement(this.windowId),this.state=state,this.eventEmitter=eventEmitter,this.eventsSubscriptions=[],this.horizontallyFlipped=!1,this.resize(),this.show(),this.init()},$.Overlay.prototype={init:function(){var _this=this;this.lastAngle=0,this.paperScope=new paper.PaperScope,this.paperScope.setup("draw_canvas_"+_this.windowId),this.paperScope.activate(),this.paperScope.project.options.handleSize=_this.state.getStateProperty("shapeHandleSize"),jQuery(_this.canvas).attr("keepalive","true"),this.annotationUtils=new $.AnnotationUtils,this.paperScope.view.onFrame=function(event){var distanceToFirst;_this.paperScope.snapPoint&&(_this.paperScope.snapPoint.remove(),_this.paperScope.snapPoint=null),_this.path&&!_this.path.closed&&_this.cursorLocation&&_this.currentTool&&-1!=_this.currentTool.idPrefix.indexOf("rough_path_")&&(distanceToFirst=_this.path.segments[0].point.getDistance(_this.cursorLocation),1<_this.path.segments.length&&distanceToFirst<_this.hitOptions.tolerance&&(_this.paperScope.snapPoint=new _this.paperScope.Path.Circle({name:"snapPoint",center:_this.path.segments[0].point,radius:_this.hitOptions.tolerance/_this.paperScope.view.zoom,fillColor:_this.path.strokeColor,strokeColor:_this.path.strokeColor,strokeWidth:_this.path.strokeWidth})))},this.mouseToolKey="draw_canvas_"+_this.windowId,this.setMouseTool(),this.listenForActions()},setMouseTool:function(){this.removeMouseTool(),this.paperScope.activate(),this.mouseTool=new this.paperScope.Tool,(this.mouseTool.overlay=this).mouseTool.onMouseUp=this.onMouseUp,this.mouseTool.onMouseDrag=this.onMouseDrag,this.mouseTool.onMouseMove=this.onMouseMove,this.mouseTool.onMouseDown=this.onMouseDown,this.mouseTool.onDoubleClick=this.onDoubleClick,this.mouseTool.onKeyDown=function(event){}},removeMouseTool:function(){this.mouseTool&&this.mouseTool.remove()},handleDeleteShapeEvent:function(event,shape){var _this=this;new $.DialogBuilder(this.slotWindowElement).dialog({message:i18next.t("deleteShape"),closeButton:!1,className:"mirador-dialog",buttons:{no:{label:i18next.t("no"),className:"btn-default",callback:function(){}},yes:{label:i18next.t("yes"),className:"btn-primary",callback:function(){_this.deleteShape(shape)}}}})},listenForActions:function(){var _this=this;this._thisResize=function(){_this.resize()},this._thisRotate=function(event){_this.rotate(event),_this.resize()},this.viewer.addHandler("animation",this._thisResize),this.viewer.addHandler("open",this._thisResize),this.viewer.addHandler("animation-finish",this._thisResize),this.viewer.addHandler("update-viewport",this._thisResize),this.viewer.addHandler("resize",this._thisResize),this.viewer.addHandler("rotate",this._thisRotate),this.viewer.addHandler("constrain",this._thisResize),this._thisDestroy=function(){_this.destroy()},this.viewer.addHandler("close",this._thisDestroy),this.eventsSubscriptions.push(this.eventEmitter.subscribe("DESTROY_EVENTS."+this.windowId,function(event){_this.destroy()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("toggleDrawingTool."+_this.windowId,function(event,tool){if(!_this.disabled){_this.currentTool=null,_this.mode="";for(var i=0;i<_this.tools.length;i++)_this.tools[i].logoClass===tool&&(_this.currentTool=_this.tools[i])}}));this.eventsSubscriptions.push(_this.eventEmitter.subscribe("deleteShape."+_this.windowId,function(event,shape){_this.handleDeleteShapeEvent(event,shape)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("changeBorderColor."+_this.windowId,function(event,color){_this.strokeColor=color,_this.hoveredPath&&(_this.hoveredPath.strokeColor=color,_this.paperScope.view.draw())})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("changeFillColor."+_this.windowId,function(event,color,alpha){_this.fillColor=color,_this.fillColorAlpha=alpha=0===alpha?1e-5:alpha,_this.hoveredPath&&_this.hoveredPath.closed&&(_this.hoveredPath.fillColor=color,_this.hoveredPath.fillColor.alpha=alpha,_this.paperScope.view.draw())})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("toggleBorderType."+_this.windowId,function(event,type){"solid"==type?(_this.dashArray=[],_this.strokeWidth=1):"thick"==type?(_this.dashArray=[],_this.strokeWidth=3):"thickest"==type?(_this.dashArray=[],_this.strokeWidth=6):"dashed"==type?(_this.dashArray=[5,5],_this.strokeWidth=1):"dotdashed"==type&&(_this.dashArray=[2,5,7,5],_this.strokeWidth=1),_this.hoveredPath&&(_this.hoveredPath.dashArray=_this.dashArray,_this.hoveredPath.strokeWidth=_this.strokeWidth,_this.paperScope.view.draw())})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("annotationEditSave."+_this.windowId,function(event,oaAnno){var onAnnotationSaved=jQuery.Deferred();_this.draftPaths.length?((new $.MiradorDualStrategy).buildAnnotation({annotation:oaAnno,window:_this.state.getWindowObjectById(_this.windowId),overlay:_this}),_this.eventEmitter.publish("annotationUpdated."+_this.windowId,[oaAnno]),onAnnotationSaved.resolve()):new $.DialogBuilder(_this.slotWindowElement).dialog({message:i18next.t("editModalSaveAnnotationWithNoShapesMsg"),closeButton:!1,className:"mirador-dialog",buttons:{success:{label:i18next.t("editModalBtnSaveWithoutShapes"),className:"btn-success",callback:function(){oaAnno.on={"@type":"oa:SpecificResource",full:_this.state.getWindowObjectById(_this.windowId).canvasID},_this.eventEmitter.publish("annotationUpdated."+_this.windowId,[oaAnno]),onAnnotationSaved.resolve()}},danger:{label:i18next.t("editModalBtnDeleteAnnotation"),className:"btn-danger",callback:function(){_this.eventEmitter.publish("annotationDeleted."+_this.windowId,[oaAnno["@id"]]),onAnnotationSaved.resolve()}},main:{label:i18next.t("cancel"),className:"btn-default",callback:function(){onAnnotationSaved.reject()}}}}),jQuery.when(onAnnotationSaved.promise()).then(function(){_this.eventEmitter.publish("annotationEditSaveSuccessful."+_this.windowId),_this.eventEmitter.publish("SET_ANNOTATION_EDITING."+_this.windowId,{annotationId:oaAnno["@id"],isEditable:!1,tooltip:_this}),_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId)},function(){})})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("annotationEditCancel."+_this.windowId,function(event,id){_this.eventEmitter.publish("SET_ANNOTATION_EDITING."+_this.windowId,{annotationId:id,isEditable:!1,tooltip:_this.annoTooltip}),_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("clearDraftPaths."+_this.windowId,function(){_this.clearDraftData()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("onAnnotationCreated."+_this.windowId,function(event,oaAnno){for(var i=0;i<_this.draftPaths.length;i++)_this.draftPaths[i].data&&_this.draftPaths[i].data.newlyCreated&&(_this.draftPaths[i].strokeWidth=_this.draftPaths[i].data.strokeWidth,delete _this.draftPaths[i].data.newlyCreated,delete _this.draftPaths[i].data.newlyCreatedStrokeFactor);(new $.MiradorDualStrategy).buildAnnotation({annotation:oaAnno,window:_this.state.getWindowObjectById(_this.windowId),overlay:_this}),_this.eventEmitter.publish("annotationCreated."+_this.windowId,[oaAnno,function(){_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId),_this.eventEmitter.publish("enableTooltips."+_this.windowId),_this.clearDraftData(),_this.annoTooltip=null,_this.annoEditorVisible=!1}])})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("onAnnotationCreatedCanceled."+_this.windowId,function(event,cancelCallback,immediate){function cancel(){_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId),_this.clearDraftData(),_this.annoTooltip=null,_this.annoEditorVisible=!1}immediate?cancel():new $.DialogBuilder(_this.slotWindowElement).dialog({message:i18next.t("cancelAnnotation"),closeButton:!1,className:"mirador-dialog",buttons:{no:{label:i18next.t("no"),className:"btn-default",callback:function(){}},yes:{label:i18next.t("yes"),className:"btn-primary",callback:function(){cancel(),cancelCallback&&cancelCallback()}}}})})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("onAnnotationDeleted."+_this.windowId,function(event,id,callback){_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("annotationDeleted."+_this.windowId,[id]),_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId),callback&&callback()})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("SET_OVERLAY_TOOLTIP."+this.windowId,function(event,options){_this.annoTooltip=options.tooltip,_this.annoEditorVisible=options.visible,_this.draftPaths=options.paths})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("CANCEL_ACTIVE_ANNOTATIONS."+this.windowId,function(event){_this.clearDraftData(),_this.annoTooltip=null,_this.annoEditorVisible=!1})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("ANNOTATIONS_LIST_UPDATED",function(event,options){options.windowId&&_this.eventEmitter.publish("refreshOverlay."+_this.windowId)})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("enableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!0)})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("disableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!1)}))},deleteShape:function(shape){for(var i=0;i<this.draftPaths.length;i++)if(this.draftPaths[i]._name.toString()===shape._name.toString()){this.draftPaths.splice(i,1);break}this.removeFocus(),shape.remove()},getMousePositionInImage:function(mousePosition){var currentCanvasModel=this.state.getWindowObjectById(this.windowId),currentCanvasModel=currentCanvasModel.canvases[currentCanvasModel.canvasID];return mousePosition.x<0&&(mousePosition.x=0),mousePosition.x>currentCanvasModel.getBounds().width&&(mousePosition.x=currentCanvasModel.getBounds().width),mousePosition.y<0&&(mousePosition.y=0),mousePosition.y>currentCanvasModel.getBounds().height&&(mousePosition.y=currentCanvasModel.getBounds().height),this.horizontallyFlipped&&(mousePosition.x=currentCanvasModel.getBounds().width-mousePosition.x),mousePosition},adjustDeltaForShape:function(lastPoint,currentPoint,delta,bounds){var currentCanvasModel=this.state.getWindowObjectById(this.windowId),currentCanvasModel=currentCanvasModel.canvases[currentCanvasModel.canvasID];return lastPoint.x<currentPoint.x?bounds.x+bounds.width>currentCanvasModel.getBounds().width&&(delta.x=currentCanvasModel.getBounds().width-(bounds.x+bounds.width)):bounds.x<0&&(delta.x=Math.abs(bounds.x)),this.horizontallyFlipped&&(delta.x=-delta.x),lastPoint.y<currentPoint.y?bounds.y+bounds.height>currentCanvasModel.getBounds().height&&(delta.y=currentCanvasModel.getBounds().height-(bounds.y+bounds.height)):bounds.y<0&&(delta.y=Math.abs(bounds.y)),delta},onMouseUp:function(event){this.overlay.disabled||(event.stopPropagation(),this.overlay.currentTool&&this.overlay.currentTool.onMouseUp(event,this.overlay))},onMouseDrag:function(event){var bounds;this.overlay.disabled?(bounds={x:event.event.clientX,y:event.event.clientY},this.overlay.eventEmitter.publish("updateTooltips."+this.overlay.windowId,[event.point,bounds])):(event.stopPropagation(),this.overlay.currentTool&&("Freehand"===this.overlay.currentTool.name&&"create"===this.overlay.mode?(event.point=this.overlay.getMousePositionInImage(event.point),event.delta=event.point-event.lastPoint):this.overlay.path&&(bounds=this.overlay.path.bounds,event.delta=this.overlay.adjustDeltaForShape(event.lastPoint,event.point,event.delta,bounds)),this.overlay.currentTool.onMouseDrag(event,this.overlay))),this.overlay.paperScope.view.draw()},onMouseMove:function(event){var absolutePoint;this.overlay.disabled?(absolutePoint={x:event.event.clientX,y:event.event.clientY},this.overlay.eventEmitter.publish("updateTooltips."+this.overlay.windowId,[event.point,absolutePoint])):(this.overlay.paperScope.project.hitTest(event.point,this.overlay.hitOptions)?this.overlay.eventEmitter.publish("POINTER_CURSOR."+this.overlay.windowId):this.overlay.currentTool&&!this.overlay.path?this.overlay.eventEmitter.publish("CROSSHAIR_CURSOR."+this.overlay.windowId):this.overlay.eventEmitter.publish("DEFAULT_CURSOR."+this.overlay.windowId),event.stopPropagation(),this.overlay.currentTool&&this.overlay.currentTool.onMouseMove(event,this.overlay)),this.overlay.paperScope.view.draw()},onMouseDown:function(event){if(!this.overlay.disabled){event.stopPropagation();var overlayEditable=(new Date).getTime();if(overlayEditable-this.overlay.latestMouseDownTime<this.overlay.doubleClickReactionTime)this.overlay.latestMouseDownTime=overlayEditable,this.onDoubleClick(event);else{this.overlay.latestMouseDownTime=overlayEditable;var hitResult=this.overlay.paperScope.project.hitTest(event.point,this.overlay.hitOptions);if("create"!==this.overlay.mode&&""!==this.overlay.mode&&(this.overlay.mode="",this.overlay.currentTool=null),hitResult&&"create"!==this.overlay.mode){overlayEditable=!1;if(void 0!==hitResult.item.data.editable&&(overlayEditable=hitResult.item.data.editable),!(overlayEditable=-1!==hitResult.item._name.toString().indexOf(this.overlay.partOfPrefix)?!0:overlayEditable))return}if(hitResult&&(!this.overlay.currentTool||-1===hitResult.item._name.toString().indexOf(this.overlay.currentTool.idPrefix)&&""===this.overlay.mode))for(var prefix=(prefix=hitResult.item._name.toString()).substring(0,prefix.indexOf("_")+1),longPrefix=(longPrefix=hitResult.item._name.toString().split("_"))[0]+"_"+longPrefix[1]+"_",j=0;j<this.overlay.tools.length;j++)if(this.overlay.tools[j].idPrefix===prefix||this.overlay.tools[j].idPrefix===longPrefix){this.overlay.eventEmitter.publish("toggleDrawingTool."+this.overlay.windowId,this.overlay.tools[j].logoClass);break}this.overlay.currentTool&&(this.overlay.eventEmitter.publish("HUD_REMOVE_CLASS."+this.overlay.windowId,[".hud-dropdown","hud-disabled"]),event.point=this.overlay.getMousePositionInImage(event.point),this.overlay.currentTool.onMouseDown(event,this.overlay))}this.overlay.hover(),this.overlay.paperScope.view.draw()}},onDoubleClick:function(event){event.stopPropagation(),this.overlay.currentTool&&this.overlay.currentTool.onDoubleClick(event,this.overlay)},fitFixedSizeShapes:function(shape){var scale;shape.data.fixedSize=!0,-1!=shape.name.toString().indexOf("pin_")&&(scale=1/shape.bounds.width,scale*=this.fixedShapeSize/this.paperScope.view.zoom,shape.scale(scale,shape.segments[0].point))},updateSelection:function(selected,item){var shapeTool;item&&item._name&&((shapeTool=this.getTool(item))&&(item.selectedColor=this.selectedColor,shapeTool.updateSelection(selected,item,this)))},rotate:function(event){this.paperScope&&this.paperScope.view&&(this.paperScope.view._matrix.rotate(event.degrees-this.lastAngle,this.paperScope.view.center),this.lastAngle=event.degrees)},resize:function(){this.viewer.viewport.getBounds(!0);this.canvas.width=this.viewer.viewport.containerSize.x,this.canvas.height=this.viewer.viewport.containerSize.y;var transform="translate(0px,0px)";if(this.canvas.style.WebkitTransform=transform,this.canvas.style.msTransform=transform,this.canvas.style.transform=transform,this.canvas.style.marginLeft="0px",this.canvas.style.marginTop="0px",this.paperScope&&this.paperScope.view){this.paperScope.view.viewSize=new this.paperScope.Size(this.canvas.width,this.canvas.height),this.paperScope.view.zoom=this.canvas.width*this.viewer.viewport.getZoom(!0),this.paperScope.view.center=new this.paperScope.Size(this.viewer.viewport.getCenter(!0).x,this.viewer.viewport.getCenter(!0).y),this.paperScope.view.update(!0);for(var allItems=this.paperScope.project.getItems({name:/_/}),j=0;j<allItems.length;j++)allItems[j].data.fixedSize&&this.fitFixedSizeShapes(allItems[j]),this.getTool(allItems[j]).onResize&&this.getTool(allItems[j]).onResize(allItems[j],this),allItems[j].strokeWidth=allItems[j].data.strokeWidth/this.paperScope.view.zoom,allItems[j].style&&(allItems[j].style.strokeWidth=allItems[j].data.strokeWidth/this.paperScope.view.zoom)}},hover:function(){if(this.currentTool)if(!this.currentTool&&this.hoveredPath&&(this.updateSelection(!1,this.hoveredPath),this.hoveredPath=null),this.hoveredPath){if(-1===this.hoveredPath._name.toString().indexOf(this.currentTool.idPrefix)&&(this.updateSelection(!1,this.hoveredPath),this.hoveredPath=null),this.path&&-1!==this.path._name.toString().indexOf(this.currentTool.idPrefix)){if(this.currentTool.partOfPrefix&&-1!==this.path._name.toString().indexOf(this.currentTool.partOfPrefix))return;if(this.hoveredPath){if(this.hoveredPath._name.toString()===this.path._name.toString())return;this.updateSelection(!1,this.hoveredPath)}this.hoveredPath=this.path,this.updateSelection(!0,this.hoveredPath)}}else this.path&&-1!=this.path._name.toString().indexOf(this.currentTool.idPrefix)&&(this.hoveredPath=this.path,this.updateSelection(!0,this.hoveredPath))},removeFocus:function(){this.hoveredPath&&(this.updateSelection(!1,this.hoveredPath),this.hoveredPath=null),this.path&&(this.updateSelection(!1,this.path),this.path=null)},restoreEditedShapes:function(){this.editedPaths=[],this.removeFocus()},restoreDraftShapes:function(){this.clearDraftData(),this.removeFocus()},getTool:function(shape){for(var i=0;i<this.tools.length;i++)if(-1!==shape.name.toString().indexOf(this.tools[i].idPrefix))return this.tools[i]},replaceShape:function(shape,annotation){var cloned=this.getTool(shape);cloned&&cloned.SEGMENT_POINTS_COUNT&&cloned.SEGMENT_POINTS_COUNT!==shape.segments.length&&cloned.adaptSegments(shape,this);cloned=new this.paperScope.Path({segments:shape.segments,name:shape.name});return cloned.data.strokeWidth=shape.data.strokeWidth||1,cloned.strokeWidth=cloned.data.strokeWidth/this.paperScope.view.zoom,cloned.strokeColor=shape.strokeColor,cloned.dashArray=shape.dashArray,shape.fillColor&&(cloned.fillColor=shape.fillColor,0===shape.fillColor.alpha&&(shape.fillColor.alpha=1e-5),shape.fillColor.alpha&&(cloned.fillColor.alpha=shape.fillColor.alpha)),cloned.closed=shape.closed,cloned.data.rotation=shape.data.rotation,cloned.data.fixedSize=shape.data.fixedSize,cloned.data.annotation=annotation,cloned.data.fixedSize&&this.fitFixedSizeShapes(cloned),shape.remove(),cloned},createRectangle:function(eventData,annotation){var paperItems=[],rect=new $.Rectangle,initialPoint={x:eventData.x,y:eventData.y},currentMode=this.mode,currentPath=this.path,strokeWidth=this.strokeWidth,strokeColor=this.strokeColor,fillColor=this.fillColor,fillColorAlpha=this.fillColorAlpha||1e-5;this.strokeColor=this.state.getStateProperty("drawingToolsSettings").strokeColor,this.fillColor=this.state.getStateProperty("drawingToolsSettings").fillColor,this.fillColorAlpha=this.state.getStateProperty("drawingToolsSettings").fillColorAlpha||1e-5,this.mode="create",this.path=rect.createShape(initialPoint,this);eventData={delta:{x:eventData.width,y:eventData.height}};return rect.onMouseDrag(eventData,this),paperItems.push(this.path),paperItems[0].data.annotation=annotation,this.updateSelection(!1,paperItems[0]),this.strokeColor=strokeColor,this.strokeWidth=strokeWidth,this.fillColor=fillColor,this.fillColorAlpha=fillColorAlpha,this.path=currentPath,this.mode=currentMode,paperItems},parseSVG:function(body,annotation){var paperItems=[];if("parsererror"!=(new DOMParser).parseFromString(body,"text/xml").documentElement.nodeName){var svgTag=this.paperScope.project.importSVG(body),body=svgTag.removeChildren()[0];if(svgTag.remove(),"Group"==body.className){for(var items=body.removeChildren(),itemIdx=0;itemIdx<items.length;itemIdx++)paperItems.push(this.replaceShape(items[itemIdx],annotation));body.remove()}else paperItems.push(this.replaceShape(body,annotation));return this.paperScope.view.update(!0),paperItems}},restoreLastView:function(shapeArray){for(var i=0;i<this.editedPaths.length;i++)for(var idx=0;idx<shapeArray.length;idx++)shapeArray[idx].name==this.editedPaths[i].name&&(shapeArray[idx].segments=this.editedPaths[i].segments,shapeArray[idx].name=this.editedPaths[i].name,shapeArray[idx].strokeWidth=this.editedPaths[i].strokeWidth,shapeArray[idx].strokeColor=this.editedPaths[i].strokeColor,shapeArray[idx].dashArray=this.editedPaths[i].dashArray,this.editedPaths[i].fillColor&&(shapeArray[idx].fillColor=this.editedPaths[i].fillColor,this.editedPaths[i].fillColor.alpha&&(shapeArray[idx].fillColor.alpha=this.editedPaths[i].fillColor.alpha)),this.editedPaths[i].style&&(shapeArray[idx].style=this.editedPaths[i].style,shapeArray[idx].style.strokeWidth=shapeArray[idx].data.strokeWidth/this.paperScope.view.zoom),shapeArray[idx].closed=this.editedPaths[i].closed,shapeArray[idx].data.rotation=this.editedPaths[i].data.rotation,shapeArray[idx].data.fixedSize=this.editedPaths[i].data.fixedSize,shapeArray[idx].data.annotation=this.editedPaths[i].data.annotation,shapeArray[idx].data.fixedSize&&this.fitFixedSizeShapes(shapeArray[idx]))},deselectAll:function(){this.paperScope&&this.paperScope.view&&this.paperScope.project&&(this.paperScope.project.deselectAll(),this.paperScope.view.update(!0),this.destroyCommentPanel())},hide:function(){this.canvas.style.display="none",this.deselectAll()},show:function(){this.canvas.style.display="block"},checkToRemoveFocus:function(){this.currentTool="",this.inEditOrCreateMode&&this.path&&this.removeFocus()},disable:function(){this.disabled=!0,this.inEditOrCreateMode=!1,this.eventEmitter.publish("enableTooltips."+this.windowId),this.deselectAll()},enableEdit:function(){this.disabled=!1,this.inEditOrCreateMode=!0,this.eventEmitter.publish("disableTooltips."+this.windowId)},enable:function(){this.disabled=!1,this.eventEmitter.publish("disableTooltips."+this.windowId)},refresh:function(){this.paperScope.view.update(!0)},destroyCommentPanel:function(){this.eventEmitter.publish("removeTooltips."+this.windowId),jQuery(this.canvas).parents(".mirador-osd").qtip("destroy",!0),this.commentPanel=null},getName:function(tool){return tool.idPrefix+$.genUUID()},getSVGString:function(shapes){var svg="<svg xmlns='http://www.w3.org/2000/svg'>";if(1<shapes.length){svg+="<g>";for(var i=0;i<shapes.length;i++){this.updateSelection(!1,shapes[i]),shapes[i].data.fixedSize&&this.fitFixedSizeShapes(shapes[i]);var anno=shapes[i].data.annotation;shapes[i].data.annotation=null,svg+=shapes[i].exportSVG({asString:!0}),shapes[i].data.annotation=anno}svg+="</g>"}else{this.updateSelection(!1,shapes[0]),shapes[0].data.fixedSize&&this.fitFixedSizeShapes(shapes[0]);var annoSingle=shapes[0].data.annotation;shapes[0].data.annotation=null,svg+=shapes[0].exportSVG({asString:!0}),shapes[0].data.annotation=annoSingle}return svg+="</svg>"},onDrawFinish:function(){var newlyCreatedStrokeFactor,_this,shape=this.path;shape&&(this.inEditOrCreateMode=!0,this.hoveredPath&&this.updateSelection(!1,this.hoveredPath),newlyCreatedStrokeFactor=this.drawingToolsSettings.newlyCreatedShapeStrokeWidthFactor||5,shape.data.newlyCreatedStrokeFactor=newlyCreatedStrokeFactor,shape.data.newlyCreated=!0,shape.strokeWidth=shape.data.strokeWidth*newlyCreatedStrokeFactor,this.hoveredPath=shape,this.segment=null,this.path=null,this.mode="",this.draftPaths.push(shape),shape.data.editable=!0,this.updateSelection(!0,this.hoveredPath),void 0!==this.annoTooltip&&this.annoTooltip||(this.annoTooltip=new $.AnnotationTooltip({targetElement:jQuery(this.canvas).parents(".mirador-osd"),state:this.state,eventEmitter:this.eventEmitter,windowId:this.windowId})),this.availableExternalCommentsPanel?this.eventEmitter.publish("annotationShapeCreated."+this.windowId,[this,shape]):void 0!==(_this=this).annoEditorVisible&&this.annoEditorVisible||(this.annoTooltip.showEditor({annotation:{},onSaveClickCheck:function(){return _this.draftPaths.length},onAnnotationCreated:function(oaAnno){_this.eventEmitter.publish("onAnnotationCreated."+_this.windowId,[oaAnno])}}),_this.annoEditorVisible=!0))},onEditFinish:function(){var _this=this;jQuery.each(this.draftPaths,function(index,value){_this.path.name===value.name&&(_this.draftPaths[index]=_this.path)})},clearDraftData:function(){for(var idx=0;idx<this.draftPaths.length;idx++)this.updateSelection(!1,this.draftPaths[idx]),this.draftPaths[idx].remove();this.draftPaths=[],this.path&&this.path.remove(),this.paperScope.view.update(!0),this.hoveredPath=null,this.segment=null,this.path=null,this.mode=""},destroy:function(){var _this=this;this.eventsSubscriptions.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)}),this.viewer.removeHandler("animation",this._thisResize),this.viewer.removeHandler("open",this._thisResize),this.viewer.removeHandler("animation-finish",this._thisResize),this.viewer.removeHandler("update-viewport",this._thisResize),this.viewer.removeHandler("resize",this._thisResize),this.viewer.removeHandler("rotate",this._thisResize),this.viewer.removeHandler("constrain",this._thisResize),this.viewer.removeHandler("close",this._thisDestroy)}}}(Mirador),function($){$.Pin=function(options){jQuery.extend(this,{name:"Pin",logoClass:"room",idPrefix:"pin_",tooltip:"pinTooltip"},options),this.init()},$.Pin.prototype={init:function(){},createShape:function(initialPoint,overlay){overlay.mode="create";var size=overlay.fixedShapeSize,shape="";shape+="M"+initialPoint.x+","+initialPoint.y,shape+=" Q"+initialPoint.x+","+(initialPoint.y-size),shape+=" "+(initialPoint.x+size)+","+(initialPoint.y-2*size),shape+=" A"+size+","+size+" 0 1 0",shape+=" "+(initialPoint.x-size)+","+(initialPoint.y-2*size),shape+=" Q"+initialPoint.x+","+(initialPoint.y-size),shape+=" "+initialPoint.x+","+initialPoint.y;shape=new overlay.paperScope.Path(shape);return shape.name=overlay.getName(this),shape.dashArray=overlay.dashArray,shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape.strokeColor=overlay.strokeColor,shape.fillColor=overlay.fillColor,shape.fillColor.alpha=overlay.fillColorAlpha,shape.closed=!0,overlay.fitFixedSizeShapes(shape),shape},updateSelection:function(selected,item,overlay){-1!==item._name.toString().indexOf(this.idPrefix)&&(selected?(item.strokeColor=overlay.selectedColor,item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",item.segments[0].point),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.deleteIcon.setOnMouseDownListener(overlay))):(item.strokeColor=overlay.strokeColor,item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null)))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.self.resize(24/overlay.paperScope.view.zoom))},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){},onMouseDrag:function(event,overlay){"translate"===overlay.mode&&overlay.path&&(overlay.path.position.x+=event.delta.x,overlay.path.position.y+=event.delta.y,overlay.path.data.deleteIcon&&overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y))},onMouseMove:function(hitResult,overlay){hitResult=overlay.paperScope.project.hitTest(hitResult.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type&&"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type&&"segment"!==hitResult.type?"pixel"===hitResult.type&&jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return void hitResult.item.data.self.onMouseDown();"translate"!==overlay.mode&&(overlay.mode="translate",overlay.segment=null,overlay.path=null)}"translate"!==overlay.mode?(overlay.path=this.createShape(event.point,overlay),overlay.onDrawFinish()):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):overlay.path=hitResult.item},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.Polygon=function(options){jQuery.extend(this,{name:"Polygon",logoClass:"timeline",idPrefix:"rough_path_",tooltip:"polygonTooltip"},options),this.init()},$.Polygon.prototype={init:function(){},createShape:function(shape,overlay){overlay.mode="create";shape=new overlay.paperScope.Path({segments:[shape],dashArray:overlay.dashArray,strokeColor:overlay.strokeColor,name:overlay.getName(this)});return shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape},updateSelection:function(selected,item,overlay){-1!=item._name.toString().indexOf(this.idPrefix)&&((item.selected=selected)?item.data.deleteIcon||"create"===overlay.mode||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(item))),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.deleteIcon.setOnMouseDownListener(overlay)):item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.self.resize(24/overlay.paperScope.view.zoom))},getPivotPointForDeleteIcon:function(item){for(var points=[],i=0;i<item.segments.length;i++)points.push(item.segments[i].point);return{x:this.getGeometricCenterOfPoints(points).x,y:this.getLowestPoint(points).y}},getLowestPoint:function(points){for(var lx=0,ly=0,i=0;i<points.length;i++)lx=Math.max(lx,points[i].x),ly=Math.max(ly,points[i].y);return{x:lx,y:ly}},getGeometricCenterOfPoints:function(points){for(var cx=0,cy=0,i=0;i<points.length;i++)cx+=points[i].x,cy+=points[i].y;return{x:cx/points.length,y:cy/points.length}},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){},onMouseDrag:function(event,overlay){var path;"deform"===overlay.mode&&overlay.segment?(overlay.segment.point.x+=event.delta.x,overlay.segment.point.y+=event.delta.y,(path=overlay.segment.path).data.deleteIcon&&(path.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(path))),path.data.deleteIcon.setPosition(path.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))))):"translate"===overlay.mode&&overlay.path&&(overlay.path.position.x+=event.delta.x,overlay.path.position.y+=event.delta.y,overlay.path.data.deleteIcon&&overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y))},onMouseMove:function(hitResult,overlay){hitResult=overlay.paperScope.project.hitTest(hitResult.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type?"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type&&"pixel"!==hitResult.type&&!hitResult.segment||jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return void hitResult.item.data.self.onMouseDown();if("create"!==overlay.mode){if(overlay.path?document.body.style.cursor="default":(overlay.mode="edit",overlay.segment=null,overlay.path=null,document.body.style.cursor="move"),"stroke"===hitResult.type)return overlay.mode="translate",void(overlay.path=hitResult.item);if("segment"===hitResult.type)return event.modifiers.shift&&2<hitResult.item.segments.length?void hitResult.segment.remove():(overlay.mode="deform",overlay.segment=hitResult.segment,void(overlay.path=hitResult.item))}}else"create"!==overlay.mode&&(overlay.mode="");""!==overlay.mode?"create"===overlay.mode&&overlay.path.add(event.point):overlay.path=this.createShape(event.point,overlay)},onDoubleClick:function(event,overlay){"create"===overlay.mode&&overlay.path&&1<overlay.path.segments.length&&(overlay.path.segments[0].point.getDistance(overlay.path.segments[overlay.path.segments.length-1].point)*overlay.paperScope.view.zoom<overlay.hitOptions.tolerance&&(overlay.path.closed=!0,overlay.path.fillColor=overlay.fillColor,overlay.path.fillColor.alpha=overlay.fillColorAlpha,overlay.path.segments[overlay.path.segments.length-1].remove()),overlay.onDrawFinish())}}}(Mirador),function($){$.Rectangle=function(options){jQuery.extend(this,{name:"Rectangle",logoClass:"check_box_outline_blank",idPrefix:"rectangle_",tooltip:"rectangleTooltip"},options),this.init()},$.Rectangle.prototype={init:function(){this.SEGMENT_POINTS_COUNT=9},createShape:function(shape,overlay){overlay.mode="create";shape=this._createSegments(shape,overlay),shape=new overlay.paperScope.Path({segments:shape,fullySelected:!0,name:overlay.getName(this)});return shape.dashArray=overlay.dashArray,shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape.strokeColor=overlay.strokeColor,shape.fillColor=overlay.fillColor,shape.fillColor.alpha=overlay.fillColorAlpha,shape.closed=!0,shape.data.rotation=0,overlay.segment=shape.segments[5],this.updateSelection(!0,shape,overlay),shape},_createSegments:function(initialPoint,overlay){var segments=[];return segments.push(new overlay.paperScope.Point(initialPoint.x-2,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x-1,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x-1,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y-1)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-1,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-2,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-2,initialPoint.y-1)),segments},updateSelection:function(point,item,overlay){-1!=item._name.toString().indexOf(this.idPrefix)&&-1==item._name.toString().indexOf(this.partOfPrefix)&&((item.selected=point)?(item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",item.segments[6].point),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.setOnMouseDownListener(overlay)),item.data.rotationIcon||(item.data.rotationIcon=new overlay.annotationUtils.RotationIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"rotation",fillColor:item.selectedColor}),item.data.rotationIcon.addData("pivot",item.segments[1].point),item.data.rotationIcon.addData("type","rotationIcon"),item.data.rotationIcon.addData("self",item.data.rotationIcon),item.data.rotationIcon.addData("parent",item),item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.setOnMouseDownListener(overlay)),item.data.group||(item.data.group=new overlay.annotationUtils.Group(overlay.paperScope,[item,item.data.deleteIcon.getItem(),item.data.deleteIcon.getMask().getItem(),item.data.rotationIcon.getItem(),item.data.rotationIcon.getMask().getItem()])),point=(point=item.segments[1].point.clone()).add(item.segments[1].handleOut),item.contains(point)&&(item.segments[1].handleOut=item.segments[1].handleOut.rotate(180,item.segments[1])),item.contains(item.data.deleteIcon.getItem().position)&&(item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.rotate(180,item.data.deleteIcon.getData("pivot")),item.data.deleteIcon.rotate(180)),item.contains(item.data.rotationIcon.getItem().position)&&(item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.rotate(180,item.data.rotationIcon.getData("pivot")),item.data.rotationIcon.rotate(180)),item.segments[1].handleOut.selected=!1):(item.data.group&&(item.data.group.remove(),item.data.group=null,overlay.paperScope.project.activeLayer.addChild(item)),item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null),item.data.rotationIcon&&(item.data.rotationIcon.remove(),item.data.rotationIcon=null),item.segments[1].handleOut=new overlay.paperScope.Point(0,0)))},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColorColor,delete shape.data.hovered)},adaptSegments:function(shape,overlay){var handleSegment=shape.segments[1].clone();shape.segments.splice(1,0,handleSegment)},onMouseUp:function(event,overlay){"create"===overlay.mode&&overlay.path?overlay.onDrawFinish():("translate"===overlay.mode||"deform"===overlay.mode&&overlay.path)&&overlay.onEditFinish()},translate:function(event,overlay){for(var i=0;i<overlay.path.segments.length;i++)overlay.path.segments[i].point.x+=event.delta.x,overlay.path.segments[i].point.y+=event.delta.y;overlay.path.data.rotationIcon.translateByXY(event.delta.x,event.delta.y),overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y)},rotate:function(event,overlay){var rotation=overlay.path.position,rotation=Math.atan2(event.point.y-rotation.y+event.delta.y,event.point.x-rotation.x+event.delta.x)-Math.atan2(event.point.y-rotation.y,event.point.x-rotation.x);rotation*=180/Math.PI,overlay.path.data.group.rotate(rotation,overlay.path.position),overlay.path.data.deleteIcon.rotate(-rotation),overlay.path.data.rotationIcon.rotate(-rotation),overlay.path.data.rotation+=rotation},onMouseDrag:function(event,overlay){if("translate"!=overlay.mode)if("rotate"!==overlay.mode){if("create"==overlay.mode||"deform"==overlay.mode){for(var idx=-1,l=0;l<overlay.path.segments.length;l++)if(overlay.path.segments[l]==overlay.segment){idx=l;break}var moveRightSize=new overlay.paperScope.Point(event.delta.x,event.delta.y),moveLeftSize=overlay.path.data.rotation,moveRightSize=moveRightSize.rotate(-moveLeftSize),point=(point=new overlay.paperScope.Point(moveRightSize.x,0)).rotate(moveLeftSize),translationY=(translationY=new overlay.paperScope.Point(0,moveRightSize.y)).rotate(moveLeftSize),moveTopSize=0===idx||1===idx||2===idx||3===idx,moveBottomSize=5===idx||6===idx||7===idx,moveRightSize=3===idx||4===idx||5===idx,moveLeftSize=0===idx||7===idx||8===idx;moveTopSize&&(overlay.path.data.rotationIcon.translateByPoint(translationY),overlay.path.segments[0].point=overlay.path.segments[0].point.add(translationY),overlay.path.segments[1].point=overlay.path.segments[1].point.add(translationY),overlay.path.segments[2].point=overlay.path.segments[2].point.add(translationY),overlay.path.segments[3].point=overlay.path.segments[3].point.add(translationY)),moveBottomSize&&(overlay.path.data.deleteIcon.translateByPoint(translationY),overlay.path.segments[5].point=overlay.path.segments[5].point.add(translationY),overlay.path.segments[6].point=overlay.path.segments[6].point.add(translationY),overlay.path.segments[7].point=overlay.path.segments[7].point.add(translationY)),(moveTopSize||moveBottomSize)&&(translationY=translationY.multiply(.5),overlay.path.segments[4].point=overlay.path.segments[4].point.add(translationY),overlay.path.segments[8].point=overlay.path.segments[8].point.add(translationY)),moveRightSize&&(overlay.path.segments[3].point=overlay.path.segments[3].point.add(point),overlay.path.segments[4].point=overlay.path.segments[4].point.add(point),overlay.path.segments[5].point=overlay.path.segments[5].point.add(point)),moveLeftSize&&(overlay.path.segments[0].point=overlay.path.segments[0].point.add(point),overlay.path.segments[7].point=overlay.path.segments[7].point.add(point),overlay.path.segments[8].point=overlay.path.segments[8].point.add(point)),(moveRightSize||moveLeftSize)&&(point=point.multiply(.5),overlay.path.data.rotationIcon.translateByPoint(point),overlay.path.data.deleteIcon.translateByPoint(point),overlay.path.segments[1].point=overlay.path.segments[1].point.add(point),overlay.path.segments[2].point=overlay.path.segments[2].point.add(point),overlay.path.segments[6].point=overlay.path.segments[6].point.add(point));point=(point=overlay.path.segments[1].point.clone()).add(overlay.path.segments[1].handleOut);overlay.path.contains(point)&&(overlay.path.segments[1].handleOut=overlay.path.segments[1].handleOut.rotate(180,overlay.path.segments[1])),overlay.path.contains(overlay.path.data.deleteIcon.getItem().position)&&(overlay.path.data.deleteIcon.rotate(180,overlay.path.data.deleteIcon.getData("pivot")),overlay.path.data.deleteIcon.rotate(180)),overlay.path.contains(overlay.path.data.rotationIcon.getItem().position)&&(overlay.path.data.rotationIcon.rotate(180,overlay.path.data.rotationIcon.getData("pivot")),overlay.path.data.rotationIcon.rotate(180))}}else this.rotate(event,overlay);else this.translate(event,overlay)},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&(-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(24/overlay.paperScope.view.zoom)),-1!==item._name.toString().indexOf("rotation")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(16/overlay.paperScope.view.zoom)))},onMouseMove:function(hitResult,overlay){hitResult=overlay.paperScope.project.hitTest(hitResult.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type?"pixel"!==hitResult.type&&!hitResult.segment||jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)&&"deform"!==overlay.mode&&"translate"!==overlay.mode&&"create"!==overlay.mode){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return hitResult.item.data.self.onMouseDown(),void("rotate"===overlay.mode&&(overlay.path=hitResult.item.data.self.getItem().data.parent));"segment"===hitResult.type&&(overlay.mode="deform",overlay.segment=null,overlay.path=null,this.setCursor(hitResult,overlay)),"stroke"===hitResult.type&&(overlay.mode="translate",overlay.segment=null,overlay.path=null)}"translate"!==overlay.mode?"deform"!==overlay.mode?overlay.path=this.createShape(event.point,overlay):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):(overlay.path=hitResult.item,overlay.segment=hitResult.segment):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):overlay.path=hitResult.item},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.SimpleASEndpoint=function(options){jQuery.extend(this,{token:null,uri:null,url:options.url,dfd:null,annotationsList:[],idMapper:{}},options),this.init()},$.SimpleASEndpoint.prototype={init:function(){this.catchOptions={user:{id:this.userid,name:this.username},permissions:{read:[],update:[this.userid],delete:[this.userid],admin:[this.userid]}}},search:function(options,successCallback,errorCallback){var _this=this;this.annotationsList=[],jQuery.ajax({url:_this.url+"/search",cache:!1,type:"GET",dataType:"json",headers:{},data:{uri:options.uri,APIKey:_this.APIKey,media:"image",limit:1e4},contentType:"application/json; charset=utf-8",success:function(data){_this.annotationsList=data,jQuery.each(_this.annotationsList,function(index,value){value.fullId=value["@id"],value["@id"]=$.genUUID(),_this.idMapper[value["@id"]]=value.fullId,(value.endpoint=_this).fixOn(value)}),"function"==typeof successCallback?successCallback(data):_this.dfd.resolve(!0)},error:function(xhr,statusText,err){"function"==typeof errorCallback?errorCallback():(_this.dfd.reject(),console.log("The request for annotations has caused an error for endpoint: "+options.uri+" due to "+statusText))}})},fixOn:function(annotation){var oldOn;annotation&&annotation.on&&!jQuery.isArray(annotation.on)&&annotation.on.selector&&annotation.on.selector.default&&(oldOn=annotation.on,annotation.on=[oldOn])},deleteAnnotation:function(annotationID,returnSuccess,returnError){jQuery.ajax({url:this.url+"/destroy?uri="+encodeURIComponent(this.idMapper[annotationID])+"&APIKey="+this.APIKey,type:"DELETE",dataType:"json",headers:{},data:{uri:annotationID},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof returnSuccess&&returnSuccess()},error:function(xhr,statusText,err){"function"==typeof returnError?returnError():console.log("Failed to delete annotation "+annotationID+" due to "+statusText)}})},update:function(oaAnnotation,returnSuccess,returnError){var annotation=oaAnnotation,_this=this,shortId=annotation["@id"];annotation.fullId;annotation["@id"]=annotation.fullId,delete annotation.fullId,delete annotation.endpoint,jQuery.ajax({url:_this.url+"/update?APIKey="+_this.APIKey,type:"POST",dataType:"json",headers:{},data:JSON.stringify(annotation),contentType:"application/json; charset=utf-8",success:function(data){_this.fixOn(data),"function"==typeof returnSuccess&&returnSuccess(data)},error:function(xhr,statusText,err){"function"==typeof returnError?returnError():console.log("Failed to update annotation: "+oaAnnotation["@id"]+" due to "+statusText)}}),annotation.endpoint=_this,annotation.fullId=annotation["@id"],annotation["@id"]=shortId},create:function(oaAnnotation,returnSuccess,returnError){var _this=this;jQuery.ajax({url:_this.url+"/create?APIKey="+_this.APIKey,type:"POST",dataType:"json",headers:{},data:JSON.stringify(oaAnnotation),contentType:"application/json; charset=utf-8",success:function(data){data.fullId=data["@id"],data["@id"]=$.genUUID(),(data.endpoint=_this).idMapper[data["@id"]]=data.fullId,_this.fixOn(data),"function"==typeof returnSuccess&&returnSuccess(data)},error:function(xhr,statusText,err){"function"==typeof returnError?returnError():console.log("Failed to create annotation: "+oaAnnotation["@id"]+" due to "+statusText)}})},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},userAuthorize:function(action,annotation){return!0}}}(Mirador),function($){$.TinyMCEAnnotationBodyEditor=function(options){jQuery.extend(this,{annotation:null,windowId:null,config:{plugins:"",toolbar:"",tags:[]}},options),this.init()},$.TinyMCEAnnotationBodyEditor.prototype={init:function(){var annoText="",selectedTags=[],tags=[];jQuery.isEmptyObject(this.annotation)||(jQuery.isArray(this.annotation.resource)?jQuery.each(this.annotation.resource,function(index,value){"oa:Tag"===value["@type"]?selectedTags.push(value.chars):annoText=value.chars}):annoText=this.annotation.resource.chars),(this.config.tags||[]).forEach(function(item){selectedTags.indexOf(item)<0&&tags.push(item)}),tags=tags.concat(selectedTags),this.editorMarkup=this.editorTemplate({content:annoText,selectedTags:selectedTags,tags:tags,windowId:this.windowId})},show:function(selector){this.editorContainer=jQuery(selector).prepend(this.editorMarkup),tinymce.init({selector:selector+" textarea",plugins:this.config.plugins,menubar:!1,statusbar:!1,toolbar_items_size:"small",toolbar:this.config.toolbar,default_link_target:"_blank",setup:function(editor){editor.on("init",function(args){tinymce.execCommand("mceFocus",!1,args.target.id),jQuery(".tags-editor").select2({tags:!0,placeholder:"Add tags here..."})})}})},isDirty:function(){return tinymce.activeEditor.isDirty()},createAnnotation:function(){var tags=this.editorContainer.find(".tags-editor").val(),resourceText=tinymce.activeEditor.getContent(),motivation=[],resource=[];return tags&&0<tags.length&&(motivation.push("oa:tagging"),jQuery.each(tags,function(index,value){resource.push({"@type":"oa:Tag",chars:value})})),motivation.push("oa:commenting"),resource.push({"@type":"dctypes:Text",format:"text/html",chars:resourceText}),{"@context":"http://iiif.io/api/presentation/2/context.json","@type":"oa:Annotation",motivation:motivation,resource:resource}},updateAnnotation:function(oaAnno){var selectedTags=this.editorContainer.find(".tags-editor").val(),resourceText=tinymce.activeEditor.getContent();oaAnno.motivation=jQuery.grep(oaAnno.motivation,function(value){return"oa:tagging"!==value}),oaAnno.resource=jQuery.grep(oaAnno.resource,function(value){return"oa:Tag"!==value["@type"]}),0<selectedTags.length&&(oaAnno.motivation.push("oa:tagging"),jQuery.each(selectedTags,function(index,value){oaAnno.resource.push({"@type":"oa:Tag",chars:value})})),jQuery.each(oaAnno.resource,function(index,value){"dctypes:Text"===value["@type"]&&(value.chars=resourceText)})},editorTemplate:$.Handlebars.compile(['<textarea class="text-editor" placeholder="{{t "comments"}}â¦">{{#if content}}{{content}}{{/if}}</textarea>','<select id="tags-editor-{{windowId}}" class="tags-editor" multiple="true">{{#each tags}}','<option value="{{this}}" {{#ifContains ../selectedTags this }}selected="selected"{{/ifContains}}>{{this}}</option>',"{{/each}}</select>"].join(""))},$.Handlebars.registerHelper("ifContains",function(array,value,options){return-1<(array=array instanceof Array?array:[array]).indexOf(value)?options.fn(this):""})}(Mirador),function($){$.Slot=function(options){jQuery.extend(!0,this,{workspaceSlotCls:"slot",slotID:null,layoutAddress:null,focused:null,appendTo:null,window:null,windowElement:null,state:null,eventEmitter:null},options),this.init()},$.Slot.prototype={init:function(){this.events=[],this.element=jQuery(this.template({workspaceSlotCls:this.workspaceSlotCls,slotID:this.slotId})),this.element.appendTo(this.appendTo),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;this.events=[_this.eventEmitter.subscribe("slotRemoved",function(event,slot){_this.slotID===slot.slotID&&_this.clearSlot()}),_this.eventEmitter.subscribe("layoutChanged",function(event,layoutRoot){_this.window&&(_this.window.slotAddress=_this.layoutAddress,_this.eventEmitter.publish("windowSlotAddressUpdated",{id:_this.window.id,slotAddress:_this.window.slotAddress}))}),_this.eventEmitter.subscribe("HIDE_REMOVE_SLOT",function(event){_this.element.find(".remove-slot-option").hide(),_this.window&&_this.eventEmitter.publish("HIDE_REMOVE_OBJECT."+_this.window.id)}),_this.eventEmitter.subscribe("SHOW_REMOVE_SLOT",function(event){_this.element.find(".remove-slot-option").show(),_this.window&&_this.eventEmitter.publish("SHOW_REMOVE_OBJECT."+_this.window.id)}),_this.eventEmitter.subscribe("ADD_ITEM_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.addItem()}),_this.eventEmitter.subscribe("REMOVE_SLOT_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("REMOVE_NODE",_this)}),_this.eventEmitter.subscribe("SPLIT_RIGHT_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_RIGHT",_this)}),_this.eventEmitter.subscribe("SPLIT_LEFT_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_LEFT",_this)}),_this.eventEmitter.subscribe("SPLIT_DOWN_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_DOWN",_this)}),_this.eventEmitter.subscribe("SPLIT_UP_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_UP",_this)})]},bindEvents:function(){var _this=this,dropTarget=this.element.find(".dropMask");this.element.find(".addItemLink").on("click",function(){_this.addItem()}),this.element.find(".remove-slot-option").on("click",function(){_this.eventEmitter.publish("REMOVE_NODE",_this)}),this.element.on("dragover",function(e){e.preventDefault(),dropTarget.show()}),dropTarget.on("dragenter",function(e){e.preventDefault(),_this.element.addClass("draggedOver")}),dropTarget.on("dragleave",function(e){e.preventDefault(),_this.element.removeClass("draggedOver"),dropTarget.hide()}),this.element.on("drop",function(e){_this.dropItem(e)})},dropItem:function(e){var _this=this;e.preventDefault();var text_url=e.originalEvent.dataTransfer.getData("text/plain");text_url?_this.handleDrop(text_url):e.originalEvent.dataTransfer.items[0].getAsString(function(url){_this.handleDrop(url)})},handleDrop:function(windowConfig){var _this=this;windowConfig=windowConfig||text_url;var manifestUrl=$.getQueryParams(windowConfig).manifest||windowConfig,collectionUrl=$.getQueryParams(windowConfig).collection,canvasId=$.getQueryParams(windowConfig).canvas,imageInfoUrl=$.getQueryParams(windowConfig).image;void 0!==_this.state.getStateProperty("manifests")[manifestUrl]?(windowConfig={manifest:_this.state.getStateProperty("manifests")[manifestUrl],slotAddress:_this.getAddress()},canvasId&&(windowConfig.canvasID=canvasId,windowConfig.viewType="ImageView"),_this.eventEmitter.publish("ADD_WINDOW",windowConfig)):void 0!==imageInfoUrl?_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[imageInfoUrl,"(Added from URL)"]):void 0!==collectionUrl?(jQuery.getJSON(collectionUrl).done(function(data,status,jqXHR){data.hasOwnProperty("manifests")?jQuery.each(data.manifests,function(ci,mfst){_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[mfst["@id"],"(Added from URL)"])}):data.hasOwnProperty("members")&&jQuery.each(data.members,function(ci,mfst){_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[mfst["@id"],"(Added from URL)"])})}),_this.addItem()):_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[manifestUrl,"(Added from URL)"]),_this.eventEmitter.subscribe("manifestReceived",function(event,manifest){var windowConfig;manifest.jsonLd["@id"]!==manifestUrl&&manifest.jsonLd["@id"]+"/info.json"!==imageInfoUrl||(windowConfig={manifest:manifest,slotAddress:_this.getAddress()},(canvasId=manifest.jsonLd["@id"]+"/info.json"===imageInfoUrl?manifest.jsonLd.sequences[0].canvases[0]["@id"]:canvasId)&&(windowConfig.canvasID=canvasId,windowConfig.viewType="ImageView"),_this.eventEmitter.publish("ADD_WINDOW",windowConfig))})},destroyEvents:function(){var _this=this;this.events.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)})},clearSlot:function(){this.destroyEvents(),this.window&&delete this.window},getAddress:function(){return this.layoutAddress},addItem:function(){this.focused=!0,this.eventEmitter.publish("ADD_SLOT_ITEM",this)},template:$.Handlebars.compile(['<div id="{{slotID}}" class="{{workspaceSlotCls}}">','<a class="remove-slot-option"><i class="fa fa-times fa-lg fa-fw"></i> {{t "close"}}</a>','<div class="slotIconContainer">','<h1 class="plus" role="presentation" aria-label="Add item using Link">',"<span>+</span>",'<div class="dropIcon">','<i class="fa fa-level-down"></i>',"</div>","</h1>",'<h1 class="addItemText">{{t "addItem"}}</h1>','<h1 class="dropMeMessage">{{t "dropToLoad"}}</h1>',"</div>",'<a class="addItemLink" role="button" aria-label="Add item"></a>','<a class="dropMask"></a>',"</div>"].join(""))}}(Mirador),function($){$.Window=function(options){jQuery.extend(this,{state:null,eventEmitter:null,element:null,scrollImageRatio:.9,canvasID:null,currentCanvasModel:null,focusImages:[],imagesList:null,canvasModels:null,annotationsList:[],endpoint:null,currentImageMode:"ImageView",imageModes:["ImageView","BookView"],originalImageModes:["ImageView","BookView"],focuses:["ThumbnailsView","ImageView","ScrollView","BookView"],focusModules:{ThumbnailsView:null,ImageView:null,ScrollView:null,BookView:null},focusOverlaysAvailable:{ThumbnailsView:{overlay:{MetadataView:!1},bottomPanel:{"":!1}},ImageView:{overlay:{MetadataView:!1},bottomPanel:{ThumbnailsView:!0}},ScrollView:{overlay:{MetadataView:!1},bottomPanel:{"":!1}},BookView:{overlay:{MetadataView:!1},bottomPanel:{ThumbnailsView:!0}}},windowOptions:null,sidePanel:null,annotationsAvailable:{ThumbnailsView:!1,ImageView:!0,ScrollView:!1,BookView:!1},bottomPanel:null,overlay:null,annoEndpointAvailable:!1,iconClasses:{ImageView:"fa fa-photo fa-lg fa-fw",BookView:"fa fa-columns fa-lg fa-fw",ScrollView:"fa fa-ellipsis-h fa-lg fa-fw",ThumbnailsView:"fa fa-th fa-lg fa-rotate-90 fa-fw"},userButtons:null},options),this.init(),this.bindAnnotationEvents()},$.Window.prototype={init:function(){var _this=this,manifest=_this.manifest.jsonLd,focusState=_this.viewType,templateData={};for(this.events=[];0<_this.annotationsList.length;)_this.annotationsList.pop();switch(_this.eventEmitter.unsubscribe("currentCanvasIDUpdated."+_this.id),_this.eventEmitter.publish("DESTROY_EVENTS."+_this.id),_this.removeBookView(),this.viewingDirection=_this.manifest.getViewingDirection(),"right-to-left"==this.viewingDirection?_this.vDirectionStatus="rtl":_this.vDirectionStatus="",this.imageModes=this.originalImageModes,this.imageModes=jQuery.map(this.imageModes,function(value,index){return-1===jQuery.inArray(value,_this.focuses)?null:value}),_this.imagesList=_this.manifest.getCanvases(),1===_this.imagesList.length&&(_this.bottomPanelVisible=!1),_this.canvasID||(_this.canvasID=_this.imagesList[0]["@id"]),_this.canvases=_this.buildCanvasesIndex(_this.manifest.getCanvases()),"rtl"==_this.vDirectionStatus?(_this.imagesListLtr=_this.imagesList.concat(),_this.imagesListRtl=_this.imagesList.concat(),_this.imagesListRtl.reverse()):(_this.imagesListRtl=[],_this.imagesListLtr=[]),this.annoEndpointAvailable=!jQuery.isEmptyObject(_this.state.getStateProperty("annotationEndpoint")),this.canvasControls.annotations.annotationLayer||(this.canvasControls.annotations.annotationCreation=!1,this.annoEndpointAvailable=!1,this.canvasControls.annotations.annotationState="off"),_this.getAnnotations(),this.canvasControls.imageManipulation.manipulationLayer&&(this.canvasControls.imageManipulation.manipulationLayer=!Object.keys(this.canvasControls.imageManipulation.controls).every(function(element,index,array){return!1===_this.canvasControls.imageManipulation.controls[element]})),_this.eventEmitter.publish("windowUpdated",{id:_this.id,annotationsAvailable:this.annotationsAvailable}),void 0===this.bottomPanelAvailable||this.bottomPanelAvailable||jQuery.each(this.focusOverlaysAvailable,function(key,value){_this.focusOverlaysAvailable[key].bottomPanel={"":!1}}),templateData.sidePanel=this.sidePanelAvailable,this.sidePanelAvailable&&(templateData.sidePanel=!Object.keys(this.sidePanelOptions).every(function(element,index,array){return!1===_this.sidePanelOptions[element]})),void 0===this.overlayAvailable||this.overlayAvailable?templateData.MetadataView=!0:jQuery.each(this.focusOverlaysAvailable,function(key,value){_this.focusOverlaysAvailable[key].overlay={"":!1}}),templateData.iconClasses={},jQuery.each(this.focuses,function(index,value){templateData[value]=!0,templateData.iconClasses[value]=_this.iconClasses[value]}),templateData.title=$.JsonLd.getTextValue(manifest.label),templateData.displayLayout=this.displayLayout,templateData.layoutOptions=this.layoutOptions,this.displayLayout&&(templateData.displayLayout=!Object.keys(this.layoutOptions).every(function(element,index,array){return!1===_this.layoutOptions[element]})),templateData.currentFocusClass=_this.iconClasses[_this.viewType],templateData.showFullScreen=_this.fullScreen,templateData.userButtons=_this.userButtons,_this.element=jQuery(this.template(templateData)).appendTo(_this.appendTo),this.element.find(".manifest-info .mirador-tooltip").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"top center",at:"bottom center",adjust:{method:"shift",y:-11},container:_this.element,viewport:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})}),this.element.find(".manifest-info .window-manifest-title").qtip({content:{text:jQuery(this).attr("title")},position:{my:"top center",at:"bottom left",adjust:{method:"shift",x:20,y:1},container:_this.element,viewport:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}}),_this.eventEmitter.publish("WINDOW_ELEMENT_UPDATED",{windowId:_this.id,element:_this.element}),_this.clearViews(),_this.clearPanelsAndOverlay(),this.listenForActions(),_this.bindNavigation(),focusState){case"ThumbnailsView":_this.toggleThumbnails(_this.canvasID);break;case"ImageView":_this.toggleImageView(_this.canvasID);break;case"BookView":_this.toggleBookView(_this.canvasID);break;case"ScrollView":_this.toggleScrollView(_this.canvasID)}_this.state.getSlots().length<=1&&_this.element.find(".remove-object-option").hide(),this.bindEvents(),this.bottomPanelVisibility(this.bottomPanelVisible),this.sidePanelVisibility(this.sidePanelVisible,"0s"),this.events.push(this.eventEmitter.subscribe("windowRemoved",function(event,id){_this.id===id&&_this.destroy()}))},buildCanvasesIndex:function(canvases){var _this=this;return canvases.reduce(function(canvasesIndex,canvas,index){var eventedCanvas=new $.EventEmitter;eventedCanvas.on=eventedCanvas.subscribe.bind(eventedCanvas),eventedCanvas.off=eventedCanvas.unsubscribe.bind(eventedCanvas),eventedCanvas.emit=eventedCanvas.publish.bind(eventedCanvas),eventedCanvas.subscribe("image-status-updated",function(event,imageResource){_this.eventEmitter.publish("image-status-updated"+_this.id,imageResource)}),eventedCanvas.subscribe("image-needed",function(event,imageResource){_this.eventEmitter.publish("image-needed"+_this.id,imageResource)}),eventedCanvas.subscribe("image-show",function(event,imageResource){_this.eventEmitter.publish("image-show"+_this.id,imageResource)}),eventedCanvas.subscribe("image-hide",function(event,imageResource){_this.eventEmitter.publish("image-hide"+_this.id,imageResource)}),eventedCanvas.subscribe("image-removed",function(event,imageResource){_this.eventEmitter.publish("image-removed"+_this.id,imageResource)}),eventedCanvas.subscribe("image-opacity-updated",function(event,imageResource){_this.eventEmitter.publish("image-opacity-updated"+_this.id,imageResource)});eventedCanvas=new iiifEventedCanvas({canvas:canvas,index:index,dispatcher:eventedCanvas});return canvasesIndex[canvas["@id"]]=eventedCanvas,canvasesIndex},{})},destroy:function(){var _this=this;this.events.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)}),this.element.remove()},update:function(options){jQuery.extend(this,options),this.windowOptions&&(this.windowOptions.osdBounds=null,this.windowOptions.zoomLevel=null),this.init()},removeBookView:function(){this.focuses=this.availableViews;var manifest=this.manifest.jsonLd;manifest.sequences[0].viewingHint&&"paged"!==manifest.sequences[0].viewingHint.toLowerCase()&&(this.focuses=jQuery.grep(this.focuses,function(value){return"BookView"!==value}))},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("bottomPanelSet."+_this.id,function(event,visible){var panel=_this.element.find(".bottomPanel");!0===visible?panel.css({transform:"translateY(0)"}):panel.css({transform:"translateY(100%)"})}),_this.events.push(_this.eventEmitter.subscribe("HIDE_REMOVE_OBJECT."+_this.id,function(event){_this.element.find(".remove-object-option").hide()})),_this.events.push(this.eventEmitter.subscribe("SHOW_REMOVE_OBJECT."+_this.id,function(event){_this.element.find(".remove-object-option").show()})),_this.events.push(_this.eventEmitter.subscribe("sidePanelStateUpdated."+this.id,function(event,state){state.open?(_this.element.find(".mirador-icon-toc").addClass("selected"),_this.element.find(".view-container").removeClass("maximised")):(_this.element.find(".mirador-icon-toc").removeClass("selected"),_this.element.find(".view-container").addClass("maximised"))})),_this.events.push(_this.eventEmitter.subscribe("sidePanelVisibilityByTab."+this.id,function(event,visible){_this.sidePanelVisibility(visible,"0s")})),_this.events.push(_this.eventEmitter.subscribe("SET_CURRENT_CANVAS_ID."+this.id,function(event,canvasID){"string"==typeof canvasID?_this.setCurrentCanvasID(canvasID):(_this.canvasID!==canvasID.canvasID&&_this.setCurrentCanvasID(canvasID.canvasID),_this.eventEmitter.publish("fitBounds."+_this.id,canvasID.bounds))})),_this.events.push(_this.eventEmitter.subscribe("REMOVE_CLASS."+this.id,function(event,className){_this.element.find(".view-container").removeClass(className)})),_this.events.push(_this.eventEmitter.subscribe("ADD_CLASS."+this.id,function(event,className){_this.element.find(".view-container").addClass(className)})),_this.events.push(_this.eventEmitter.subscribe("UPDATE_FOCUS_IMAGES."+this.id,function(event,images){_this.updateFocusImages(images.array)})),_this.events.push(_this.eventEmitter.subscribe("HIDE_ICON_TOC."+this.id,function(event){_this.element.find(".mirador-icon-toc").hide()})),_this.events.push(_this.eventEmitter.subscribe("SHOW_ICON_TOC."+this.id,function(event){_this.element.find(".mirador-icon-toc").show()})),_this.events.push(_this.eventEmitter.subscribe("SET_BOTTOM_PANEL_VISIBILITY."+this.id,function(event,visibility){null!=visibility?_this.bottomPanelVisibility(visibility):_this.bottomPanelVisibility(_this.bottomPanelVisible)})),_this.events.push(_this.eventEmitter.subscribe("TOGGLE_BOTTOM_PANEL_VISIBILITY."+this.id,function(event){var visible=!_this.bottomPanelVisible;_this.bottomPanelVisibility(visible)})),_this.events.push(_this.eventEmitter.subscribe("DISABLE_WINDOW_FULLSCREEN",function(event){_this.element.find(".mirador-osd-fullscreen").hide()})),_this.events.push(_this.eventEmitter.subscribe("ENABLE_WINDOW_FULLSCREEN",function(event){_this.element.find(".mirador-osd-fullscreen").show()}))},bindEvents:function(){var _this=this;jQuery(window).resize($.debounce(function(){var containerHeight,triggerShow;_this.focusModules.ScrollView&&(containerHeight=_this.element.find(".view-container").height(),triggerShow=!1,"ScrollView"===_this.viewType&&(triggerShow=!0),_this.focusModules.ScrollView.reloadImages(Math.floor(containerHeight*_this.scrollImageRatio),triggerShow))},300)),this.element.find(".mirador-osd-fullscreen").on("click",function(){$.fullscreenElement()?$.exitFullscreen():$.enterFullscreen(_this.element[0])}),jQuery(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){_this.toggleFullScreen()})},bindAnnotationEvents:function(){var _this=this;_this.eventEmitter.subscribe("annotationCreated."+_this.id,function(event,oaAnno,eventCallback){_this.endpoint.create(oaAnno,function(data){String(data["@id"]),_this.annotationsList.push(data),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList}),eventCallback()},function(){console.log("There was an error saving this new annotation")})}),_this.eventEmitter.subscribe("annotationUpdated."+_this.id,function(event,oaAnno){_this.endpoint.update(oaAnno,function(data){jQuery.each(_this.annotationsList,function(index,value){if(value["@id"]===data["@id"])return _this.annotationsList[index]=data,!1}),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})},function(){console.log("There was an error updating this annotation")})}),_this.eventEmitter.subscribe("annotationDeleted."+_this.id,function(event,annoId){_this.endpoint.deleteAnnotation(annoId,function(){_this.annotationsList=jQuery.grep(_this.annotationsList,function(e){return e["@id"]!==annoId}),_this.eventEmitter.publish("removeOverlay."+_this.id,annoId),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})},function(){})}),_this.eventEmitter.subscribe("updateAnnotationList."+_this.id,function(event){for(;0<_this.annotationsList.length;)_this.annotationsList.pop();_this.getAnnotations()})},clearViews:function(){var _this=this;jQuery.each(_this.focusModules,function(key,value){_this.focusModules[key]=null})},clearPanelsAndOverlay:function(){this.sidePanel=null,this.bottomPanel=null,this.overlay=null},updatePanelsAndOverlay:function(state){var _this=this;jQuery.each(this.focusOverlaysAvailable[state],function(panelType,viewOptions){jQuery.each(viewOptions,function(view,displayed){""!==view&&null===_this[panelType]&&(_this[panelType]=new $[view]({manifest:_this.manifest,appendTo:_this.element.find("."+panelType),state:_this.state,eventEmitter:_this.eventEmitter,windowId:_this.id,panel:!0,canvasID:_this.canvasID,canvases:_this.canvases,imagesList:_this.imagesList,imagesListLtr:_this.imagesListLtr,imagesListRtl:_this.imagesListRtl,vDirectionStatus:_this.vDirectionStatus,thumbInfo:{thumbsHeight:80,listingCssCls:"panel-listing-thumbs",thumbnailCls:"panel-thumbnail-view"}})),displayed=_this.focusOverlaysAvailable[state][panelType][view],""!==view&&displayed&&_this.togglePanels(panelType,displayed,view,state),""===view&&_this[panelType]&&_this.togglePanels(panelType,displayed,view,state),""===view&&_this.adjustFocusSize(panelType,displayed)})})},updateSidePanel:function(){var tocTabAvailable,annotationsTabAvailable,layersTabAvailable,searchTabAvailable,hasStructures,structures;this.sidePanelAvailable&&(tocTabAvailable=this.sidePanelOptions.tocTabAvailable,annotationsTabAvailable=this.sidePanelOptions.annotations,layersTabAvailable=this.sidePanelOptions.layersTabAvailable,searchTabAvailable=this.sidePanelOptions.searchTabAvailable,hasStructures=!0,(structures=this.manifest.getStructures())&&0!==structures.length||(hasStructures=!1),null===this.sidePanel?this.sidePanel=new $.SidePanel({windowId:this.id,state:this.state,eventEmitter:this.eventEmitter,appendTo:this.element.find(".sidePanel"),manifest:this.manifest,canvasID:this.canvasID,canvases:this.canvases,layersTabAvailable:layersTabAvailable,tocTabAvailable:tocTabAvailable,searchTabAvailable:searchTabAvailable,annotationsTabAvailable:annotationsTabAvailable,hasStructures:hasStructures}):this.sidePanel.update("annotations",annotationsTabAvailable))},get:function(prop,parent){return(parent?this[parent]:this)[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},togglePanels:function(panelType,panelState,viewType,focusState){this.focusOverlaysAvailable[focusState][panelType][viewType]=panelState,this[panelType].toggle(panelState),this.adjustFocusSize(panelType,panelState)},sidePanelVisibility:function(visible,transitionDuration){this.sidePanelVisible=visible;var tocIconElement=this.element.find(".mirador-icon-toc"),sidePanelElement=this.element.find(".sidePanel"),viewContainerElement=this.element.find(".view-container");sidePanelElement.css("transition-duration",transitionDuration),viewContainerElement.css("transition",transitionDuration),visible&&sidePanelElement.hasClass("minimized")?(tocIconElement.addClass("selected"),sidePanelElement.removeClass("minimized").width(280).css("border-right","1px solid lightgray"),viewContainerElement.css("margin-left",280)):visible||sidePanelElement.hasClass("minimized")||(tocIconElement.removeClass("selected"),viewContainerElement.css("margin-left",0),sidePanelElement.addClass("minimized").css("border","none").width(0)),this.eventEmitter.publish("windowUpdated",{id:this.id,sidePanelVisible:visible})},bottomPanelVisibility:function(visible){this.bottomPanelVisible=visible,this.eventEmitter.publish("bottomPanelSet."+this.id,visible),this.eventEmitter.publish("windowUpdated",{id:this.id,bottomPanelVisible:visible})},adjustFocusSize:function(panelType,panelState){"bottomPanel"===panelType?this.focusModules[this.viewType].adjustHeight("focus-max-height",panelState):"sidePanel"===panelType&&this.focusModules[this.viewType].adjustWidth("focus-max-width",panelState)},toggleMetadataOverlay:function(focusState){var currentState=this.focusOverlaysAvailable[focusState].overlay.MetadataView;currentState?this.element.find(".mirador-icon-metadata-view").removeClass("selected"):this.element.find(".mirador-icon-metadata-view").addClass("selected"),jQuery.each(this.focusOverlaysAvailable,function(focusType,options){focusState!==focusType&&(this.overlay.MetadataView=!currentState)}),this.togglePanels("overlay",!currentState,"MetadataView",focusState)},toggleFocus:function(focusState,imageMode){this.viewType=focusState,imageMode&&-1<jQuery.inArray(imageMode,this.imageModes)&&(this.currentImageMode=imageMode),jQuery.each(this.focusModules,function(focusKey,module){module&&focusState!==focusKey&&module.toggle(!1)}),this.focusModules[focusState].toggle(!0),this.updateManifestInfo(),this.updatePanelsAndOverlay(focusState),this.updateSidePanel(),this.eventEmitter.publish("focusUpdated"+this.id,focusState),this.eventEmitter.publish("windowUpdated",{id:this.id,viewType:this.viewType,canvasID:this.canvasID,imageMode:this.currentImageMode,loadedManifest:this.manifest.jsonLd["@id"],slotAddress:this.slotAddress,canvases:this.canvases})},toggleThumbnails:function(canvasID){this.canvasID=canvasID,null===this.focusModules.ThumbnailsView?this.focusModules.ThumbnailsView=new $.ThumbnailsView({manifest:this.manifest,appendTo:this.element.find(".view-container"),state:this.state,eventEmitter:this.eventEmitter,windowId:this.id,canvasID:this.canvasID,imagesList:this.imagesList,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus}):this.focusModules.ThumbnailsView.updateImage(canvasID),this.toggleFocus("ThumbnailsView","")},toggleImageView:function(canvasID){this.canvasID=canvasID,null===this.focusModules.ImageView?this.focusModules.ImageView=new $.ImageView({manifest:this.manifest,appendTo:this.element.find(".view-container"),qtipElement:this.element,windowId:this.id,state:this.state,eventEmitter:this.eventEmitter,canvasID:canvasID,canvases:this.canvases,imagesList:this.imagesList,imagesListRtl:this.imagesListRtl,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus,osdOptions:this.windowOptions,bottomPanelAvailable:this.bottomPanelAvailable,annoEndpointAvailable:this.annoEndpointAvailable,canvasControls:this.canvasControls,annotationState:this.canvasControls.annotations.annotationState}):this.focusModules.ImageView.updateImage(canvasID),this.toggleFocus("ImageView","ImageView")},toggleBookView:function(canvasID){this.canvasID=canvasID,null===this.focusModules.BookView?this.focusModules.BookView=new $.BookView({manifest:this.manifest,appendTo:this.element.find(".view-container"),windowId:this.id,state:this.state,eventEmitter:this.eventEmitter,canvasID:canvasID,imagesList:this.imagesList,imagesListRtl:this.imagesListRtl,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus,viewingDirection:this.viewingDirection,osdOptions:this.windowOptions,bottomPanelAvailable:this.bottomPanelAvailable}):this.focusModules.BookView.updateImage(canvasID),this.toggleFocus("BookView","BookView")},toggleScrollView:function(canvasID){var containerHeight;"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListRtl.concat()),this.canvasID=canvasID,null===this.focusModules.ScrollView?(containerHeight=this.element.find(".view-container").height(),this.focusModules.ScrollView=new $.ScrollView({manifest:this.manifest,appendTo:this.element.find(".view-container"),state:this.state,eventEmitter:this.eventEmitter,windowId:this.id,canvasID:this.canvasID,imagesList:this.imagesList,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus,thumbInfo:{thumbsHeight:Math.floor(containerHeight*this.scrollImageRatio),listingCssCls:"scroll-listing-thumbs",thumbnailCls:"scroll-view"}})):this.focusModules.ScrollView.updateImage(canvasID),this.toggleFocus("ScrollView","")},updateFocusImages:function(imageList){this.focusImages=imageList,this.bottomPanel&&this.bottomPanel.updateFocusImages(this.focusImages)},setCurrentCanvasID:function(canvasID){for(this.canvasID=canvasID,this.eventEmitter.publish("removeTooltips."+this.id);0<this.annotationsList.length;)this.annotationsList.pop();switch(this.getAnnotations(),this.currentImageMode){case"ImageView":this.toggleImageView(this.canvasID);break;case"BookView":this.toggleBookView(this.canvasID)}this.eventEmitter.publish("currentCanvasIDUpdated."+this.id,canvasID)},replaceWindow:function(newSlotAddress,newElement){this.slotAddress=newSlotAddress,this.appendTo=newElement,this.update()},setCursorFrameStart:function(canvasID){},updateManifestInfo:function(){this.element.find(".mirador-icon-view-type > i:first").removeClass().addClass(this.iconClasses[this.viewType]),this.focusOverlaysAvailable[this.viewType].overlay.MetadataView&&this.element.find(".mirador-icon-metadata-view").addClass("selected")},getAnnotations:function(){var dfd,module,_this=this,options=_this.manifest.getAnnotationsListUrls(_this.canvasID);0!==options.length&&jQuery.each(options,function(index,url){jQuery.getJSON(url,function(annotations){annotations=annotations.resources;jQuery.each(annotations,function(index,value){void 0===value["@id"]&&(value["@id"]=$.genUUID()),value.endpoint="manifest"}),_this.annotationsList=_this.annotationsList.concat(annotations),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})})}),this.annoEndpointAvailable&&(dfd=jQuery.Deferred(),module=_this.state.getStateProperty("annotationEndpoint").module,(options=_this.state.getStateProperty("annotationEndpoint").options||{}).name=_this.state.getStateProperty("annotationEndpoint").name,_this.endpoint&&null!==_this.endpoint?_this.endpoint.set("dfd",dfd):(options.dfd=dfd,options.windowID=_this.id,options.imagesList=_this.imagesList,options.eventEmitter=_this.eventEmitter,_this.endpoint=new $[module](options)),_this.endpoint.search({uri:_this.canvasID}),dfd.done(function(loaded){_this.annotationsList=_this.annotationsList.concat(_this.endpoint.annotationsList),_this.annotationsList=jQuery.grep(_this.annotationsList,function(value,index){return void 0!==value.on}),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})}))},toggleFullScreen:function(){OpenSeadragon.isFullScreen()?(this.element.find(".mirador-osd-fullscreen i").removeClass("fa-expand").addClass("fa-compress"),this.element.find(".mirador-osd-toggle-bottom-panel").hide(),this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.id,!1)):(this.element.find(".mirador-osd-fullscreen i").removeClass("fa-compress").addClass("fa-expand"),this.element.find(".mirador-osd-toggle-bottom-panel").show(),this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.id,!0))},bindNavigation:function(){var _this=this;this.element.find(".mirador-icon-view-type").on("mouseenter",function(){_this.element.find(".image-list").stop().slideFadeToggle(300)}).on("mouseleave",function(){_this.element.find(".image-list").stop().slideFadeToggle(300)}),this.element.find(".mirador-icon-window-menu").on("mouseenter",function(){_this.element.find(".slot-controls").stop().slideFadeToggle(300)}).on("mouseleave",function(){_this.element.find(".slot-controls").stop().slideFadeToggle(300)}),this.element.find(".single-image-option").on("click",function(){_this.toggleImageView(_this.canvasID)}),this.element.find(".book-option").on("click",function(){_this.toggleBookView(_this.canvasID)}),this.element.find(".scroll-option").on("click",function(){_this.toggleScrollView(_this.canvasID)}),this.element.find(".thumbnails-option").on("click",function(){_this.toggleThumbnails(_this.canvasID)}),this.element.find(".mirador-icon-metadata-view").on("click",function(){_this.toggleMetadataOverlay(_this.viewType)}),this.element.find(".mirador-icon-toc").on("click",function(){_this.sidePanelVisibility(!_this.sidePanelVisible,"0.3s")}),this.element.find(".new-object-option").on("click",function(){_this.eventEmitter.publish("ADD_ITEM_FROM_WINDOW",_this.id)}),this.element.find(".remove-object-option").on("click",function(){_this.eventEmitter.publish("REMOVE_SLOT_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-right").on("click",function(){_this.eventEmitter.publish("SPLIT_RIGHT_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-left").on("click",function(){_this.eventEmitter.publish("SPLIT_LEFT_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-below").on("click",function(){_this.eventEmitter.publish("SPLIT_DOWN_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-above").on("click",function(){_this.eventEmitter.publish("SPLIT_UP_FROM_WINDOW",_this.id)})},template:$.Handlebars.compile(['<div class="window">','<div class="manifest-info">','<div class="window-manifest-navigation">',"{{#if userButtons}}","{{windowuserbtns userButtons}}","{{/if}}",'<a href="javascript:;" class="mirador-btn mirador-icon-view-type" role="button" title="{{t "viewTypeTooltip"}}" aria-label="{{t "viewTypeTooltip"}}">','<i class="{{currentFocusClass}}"></i>','<i class="fa fa-caret-down"></i>','<ul class="dropdown image-list">',"{{#if ImageView}}",'<li class="single-image-option"><i class="{{iconClasses.ImageView}}"></i> {{t "imageView"}}</li>',"{{/if}}","{{#if BookView}}",'<li class="book-option"><i class="{{iconClasses.BookView}}"></i> {{t "bookView"}}</li>',"{{/if}}","{{#if ScrollView}}",'<li class="scroll-option"><i class="{{iconClasses.ScrollView}}"></i> {{t "scrollView"}}</li>',"{{/if}}","{{#if ThumbnailsView}}",'<li class="thumbnails-option"><i class="{{iconClasses.ThumbnailsView}}"></i> {{t "thumbnailsView"}}</li>',"{{/if}}","</ul>","</a>","{{#if MetadataView}}",'<a href="javascript:;" class="mirador-btn mirador-icon-metadata-view mirador-tooltip" role="button" title="{{t "metadataTooltip"}}" aria-label="{{t "metadataTooltip"}}">','<i class="fa fa-info-circle fa-lg fa-fw"></i>',"</a>","{{/if}}","{{#if showFullScreen}}",'<a class="mirador-btn mirador-osd-fullscreen mirador-tooltip" role="button" title="{{t "fullScreenWindowTooltip"}}" aria-label="{{t "fullScreenWindowTooltip"}}">','<i class="fa fa-lg fa-fw fa-expand"></i>',"</a>","{{/if}}","</div>","{{#if layoutOptions.close}}",'<a href="javascript:;" class="mirador-btn mirador-close-window remove-object-option mirador-tooltip" title="{{t "closeTooltip"}}" aria-label="{{t "closeTooltip"}}"><i class="fa fa-times fa-lg fa-fw"></i></a>',"{{/if}}","{{#if displayLayout}}",'<a href="javascript:;" class="mirador-btn mirador-icon-window-menu" title="{{t "changeLayoutTooltip"}}" aria-label="{{t "changeLayoutTooltip"}}"><i class="fa fa-th-large fa-lg fa-fw"></i><i class="fa fa-caret-down"></i>','<ul class="dropdown slot-controls">',"{{#if layoutOptions.newObject}}",'<li class="new-object-option"><i class="fa fa-refresh fa-lg fa-fw"></i> {{t "newObject"}}</li>','<hr class="menu-divider"/>',"{{/if}}","{{#if layoutOptions.slotRight}}",'<li class="add-slot-right"><i class="fa fa-arrow-circle-right fa-lg fa-fw"></i> {{t "addSlotRight"}}</li>',"{{/if}}","{{#if layoutOptions.slotLeft}}",'<li class="add-slot-left"><i class="fa fa-arrow-circle-left fa-lg fa-fw"></i> {{t "addSlotLeft"}}</li>',"{{/if}}","{{#if layoutOptions.slotAbove}}",'<li class="add-slot-above"><i class="fa fa-arrow-circle-up fa-lg fa-fw"></i> {{t "addSlotAbove"}}</li>',"{{/if}}","{{#if layoutOptions.slotBelow}}",'<li class="add-slot-below"><i class="fa fa-arrow-circle-down fa-lg fa-fw"></i> {{t "addSlotBelow"}}</li>',"{{/if}}","</ul>","</a>","{{/if}}","{{#if sidePanel}}",'<a href="javascript:;" class="mirador-btn mirador-icon-toc selected mirador-tooltip" title="{{t "sidePanelTooltip"}}" aria-label="{{t "sidePanelTooltip"}}"><i class="fa fa-bars fa-lg fa-fw"></i></a>',"{{/if}}",'<h3 class="window-manifest-title" title="{{{title}}}" aria-label="{{{title}}}">{{{title}}}</h3>',"</div>",'<div class="content-container">',"{{#if sidePanel}}",'<div class="sidePanel">',"</div>","{{/if}}",'<div class="overlay"></div>','<div class="view-container {{#unless sidePanel}}focus-max-width{{/unless}}">','<div class="bottomPanel">',"</div>","</div>","</div>","</div>"].join(""))};function processUserButtons(buttons){return buttons.map(function(button,argument_1){var $a=jQuery("<a>"),$i=jQuery("<i>",{class:"fa fa-lg fa-fw"});try{if(!button.iconClass)throw"userButtons must have an iconClass";if(button.attributes)$a.attr(button.attributes);$a.addClass("mirador-btn");$i.addClass(button.iconClass);$a.append($i);return $a.get(0).outerHTML}catch(error){console&&console.error&&console.error(error);return""}})}$.Handlebars.registerHelper("windowuserbtns",function(userButtons){return new $.Handlebars.SafeString(processUserButtons(userButtons).join(""))})}(Mirador),function($){$.AnnotationsLayer=function(options){jQuery.extend(!0,this,{annotationsList:null,viewer:null,drawTool:null,selected:null,hovered:null,windowId:null,mode:"default",element:null,eventEmitter:null},options),this.init()},$.AnnotationsLayer.DISPLAY_ANNOTATIONS="displayAnnotations",$.AnnotationsLayer.prototype={init:function(){this.eventEmitter.unsubscribe("modeChange."+this.windowId),this.eventEmitter.unsubscribe("slotLeave."+this.windowId),this.eventEmitter.unsubscribe("slotEnter."+this.windowId),this.createStateMachine(),this.createRenderer(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("modeChange."+_this.windowId,function(event,modeName){_this.mode=modeName,_this.modeSwitch()}),_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(event){_this.annotationsList=_this.state.getWindowAnnotationsList(_this.windowId),_this.updateRenderer()}),_this.eventEmitter.subscribe("slotLeave."+_this.windowId,function(event,eventData){"display"==_this.layerState.current&&(_this.layerState.defaultState(),_this.modeSwitch())}),_this.eventEmitter.subscribe("slotEnter."+_this.windowId,function(event,eventData){_this.element.showAnno&&"display"==_this.layerState.current&&(_this.layerState.defaultState(),_this.modeSwitch())})},bindEvents:function(){},createStateMachine:function(){var _this=this;this.layerState=StateMachine.create({events:[{name:"startup",from:"none",to:"default"},{name:"defaultState",from:["default","display","create","edit"],to:"default"},{name:"displayAnnotations",from:["default","display","create","edit","newShape"],to:"display"},{name:"createAnnotation",from:["default","display"],to:"create"},{name:"createShape",from:"edit",to:"newShape"},{name:"editAnnotation",from:["default","display","newShape"],to:"edit"}],callbacks:{onstartup:function(event){_this.drawTool.enterDefault()},ondefaultState:function(event){_this.drawTool.enterDefault()},ondisplayAnnotations:function(event){_this.drawTool.enterDisplayAnnotations()},oncreateAnnotation:function(event){_this.drawTool.enterCreateAnnotation()},oncreateShape:function(event){_this.drawTool.enterCreateShape()},oneditAnnotation:function(event){_this.drawTool.enterEditAnnotation()}}})},createRenderer:function(){this.drawTool=new $.OsdRegionDrawTool({osdViewer:this.viewer,parent:this,list:this.annotationsList,visible:!1,windowId:this.windowId,state:this.state,eventEmitter:this.eventEmitter}),this.layerState.startup()},updateRenderer:function(){this.drawTool.list=this.annotationsList},modeSwitch:function(){"displayAnnotations"===this.mode?this.layerState.displayAnnotations():"editingAnnotation"===this.mode?this.layerState.editAnnotation():"creatingAnnotation"===this.mode?"edit"!==this.layerState.current?this.layerState.createAnnotation():this.layerState.createShape():"default"===this.mode&&this.layerState.defaultState()}}}(Mirador),function($){$.AnnotationsTab=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,visible:null,state:null,eventEmitter:null},options),this.init()},$.AnnotationsTab.prototype={init:function(){this.windowId=this.windowId,this.localState({id:"annotationsTab",visible:this.visible,annotationLists:[],selectedList:null,empty:!0,focusedList:null},!0),this.listenForActions(),this.render(this.localState()),this.loadTabComponents(),this.bindEvents()},localState:function(state,initial){return arguments.length&&(this.annoTabState=state,initial||this.eventEmitter.publish("annotationsTabStateUpdated."+this.windowId,this.annoTabState)),this.annoTabState},loadTabComponents:function(){},tabStateUpdated:function(visible){localState=this.localState(),localState.visible=visible,this.localState(localState),visible?this.element.show():this.element.hide()},annotationListLoaded:function(){var annotationSources=[],localState=this.localState();jQuery.each(this.state.getWindowAnnotationsList(this.windowId),function(index,value){value.endpoint&&"string"==typeof value.endpoint?annotationSources.push(value.resource):value.resource&&(value.resource.endpoint&&"string"==typeof value.resource.endpoint?annotationSources.push(value.resource):annotationSources.push(value.resource[0]))}),annotationSources=annotationSources.filter(function(itm,i,annotationSources){return i==annotationSources.indexOf(itm)}),localState.annotationLists=annotationSources.map(function(annotationSource){return{annotationSource:annotationSource,layer:null,selected:annotationSource===localState.selectedList,focused:!1}}),localState.annotationLists.length&&(localState.empty=!1),this.localState(localState)},deselectList:function(listId){var localState=this.localState();localState.selectedList=null,localState.annotationLists.forEach(function(list){list.selected=!1}),this.localState(localState)},selectList:function(listId){var localState=this.localState();localState.selectedList=listId,localState.annotationLists.forEach(function(list){list.selected=list.annotationSource===listId}),this.localState(localState)},focusList:function(listId){var localState=this.localState();localState.focusedList=listId,localState.annotationLists.forEach(function(list){list.focused=list.annotationSource===listId}),this.localState(localState)},toggle:function(){},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("annotationsTabStateUpdated."+_this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){_this.tabStateUpdated("annotationsTab"==data.tabs[data.selectedTabIndex].options.id)}),_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(_,data){_this.annotationListLoaded()}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event){_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(event){_this.annotationListLoaded()}),_this.selectList(_this.localState().selectedList)}),_this.eventEmitter.subscribe("listSelected."+_this.windowId,function(event,listId){_this.selectList(listId)}),_this.eventEmitter.subscribe("listDeselected."+_this.windowId,function(event,listId){_this.deselectList(listId)})},bindEvents:function(){this.element.find(".annotationListItem")},render:function(state){var templateData={annotationSources:state.annotationLists};this.element&&jQuery(this.appendTo).find(".annotationsPanel").remove(),this.element=jQuery(this.template(templateData)).appendTo(this.appendTo),this.bindEvents(),state.visible?this.element.show():this.element.hide()},template:$.Handlebars.compile(['<div class="annotationsPanel">','<ul class="annotationSources">',"{{#each annotationSources}}",'<li class="annotationListItem" {{#if this.selected}}selected{{/if}} {{#if this.focused }}focused{{/if}}">','<span style="font-weight: bold">{{{this.annotationSource.label}}}</span>',"<br/>","<span>{{{this.annotationSource.chars}}}</span>","</li>","{{/each}}","</ul>","</div>"].join(""))}}(Mirador),function($){$.BookView=function(options){jQuery.extend(this,{currentImg:null,windowId:null,currentImgIndex:0,stitchList:[],canvasID:null,imagesList:[],imagesListRtl:[],element:null,focusImages:[],manifest:null,viewingDirection:"left-to-right",viewingHint:"paged",osd:null,osdCls:"mirador-osd",osdOptions:{osdBounds:null,zoomLevel:null},stitchTileMargin:10,eventEmitter:null},options),this.init()},$.BookView.prototype={init:function(){"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListRtl.concat()),null!==this.canvasID&&(this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID)),this.osdOptions||(this.osdOptions={osdBounds:null,zoomLevel:null}),this.currentImg=this.imagesList[this.currentImgIndex],this.element=jQuery(this.template()).appendTo(this.appendTo),this.hud=new $.Hud({appendTo:this.element,bottomPanelAvailable:this.bottomPanelAvailable,windowId:this.windowId,annotationLayerAvailable:!1,showNextPrev:1!==this.imagesList.length,eventEmitter:this.eventEmitter,showAnno:!1,showImageControls:!1}),this.manifest.jsonLd.sequences[0].viewingDirection&&(this.viewingDirection=this.manifest.jsonLd.sequences[0].viewingDirection.toLowerCase()),this.manifest.jsonLd.sequences[0].viewingHint&&(this.viewingHint=this.manifest.jsonLd.sequences[0].viewingHint.toLowerCase()),this.stitchList=this.getStitchList(),this.createOpenSeadragonInstance(),this.bindEvents(),this.listenForActions(),void 0===this.bottomPanelAvailable||this.bottomPanelAvailable?this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,null):this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,!1)},template:$.Handlebars.compile(['<div class="book-view">',"</div>"].join("")),listenForActions:function(){var _this=this,firstCanvasId=_this.imagesList[0]["@id"],lastCanvasId=_this.imagesList[_this.imagesList.length-1]["@id"];_this.eventEmitter.subscribe("bottomPanelSet."+_this.windowId,function(event,visible){var dodgers=_this.element.find(".mirador-osd-toggle-bottom-panel, .mirador-pan-zoom-controls"),arrows=_this.element.find(".mirador-osd-next, .mirador-osd-previous");!0===visible?(dodgers.addClass("bottom-panel-open"),arrows.addClass("bottom-panel-open")):(dodgers.removeClass("bottom-panel-open"),arrows.removeClass("bottom-panel-open"))}),_this.eventEmitter.subscribe("fitBounds."+_this.windowId,function(event,rect){rect=_this.osd.viewport.imageToViewportRectangle(Number(rect.x),Number(rect.y),Number(rect.width),Number(rect.height));_this.osd.viewport.fitBoundsWithConstraints(rect,!1)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event,canvasId){canvasId===firstCanvasId?(_this.element.find(".mirador-osd-previous").hide(),_this.element.find(".mirador-osd-next").show()):(canvasId===lastCanvasId?_this.element.find(".mirador-osd-next").hide():_this.element.find(".mirador-osd-next").show(),_this.element.find(".mirador-osd-previous").show())})},bindEvents:function(){var _this=this;this.element.find(".mirador-osd-next").on("click",function(){_this.next()}),this.element.find(".mirador-osd-previous").on("click",function(){_this.previous()}),this.element.find(".mirador-osd-go-home").on("click",function(){_this.osd.viewport.goHome()}),this.element.find(".mirador-osd-up").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,-panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-right").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-down").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-left").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(-panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-zoom-in").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(+osd.zoomPerClick),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-zoom-out").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(1/osd.zoomPerClick),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-toggle-bottom-panel").on("click",function(){_this.eventEmitter.publish("TOGGLE_BOTTOM_PANEL_VISIBILITY."+_this.windowId)})},getPanByValue:function(){var bounds=this.osd.viewport.getBounds(!0);return{x:.5*bounds.width,y:.5*bounds.height}},setBounds:function(){this.osdOptions.osdBounds=this.osd.viewport.getBounds(!0),this.eventEmitter.publish("imageBoundsUpdated",{id:this.windowId,osdBounds:{x:this.osdOptions.osdBounds.x,y:this.osdOptions.osdBounds.y,width:this.osdOptions.osdBounds.width,height:this.osdOptions.osdBounds.height}})},toggle:function(stateValue){stateValue?this.show():this.hide()},hide:function(){jQuery(this.element).hide({effect:"fade",duration:300,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:300,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block")}})},adjustWidth:function(className,hasClass){hasClass?this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,className):this.eventEmitter.publish("ADD_CLASS."+this.windowId,className)},adjustHeight:function(className,hasClass){hasClass?this.element.removeClass(className):this.element.addClass(className)},updateImage:function(canvasID){this.canvasID=canvasID,this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID),this.currentImg=this.imagesList[this.currentImgIndex];var newList=this.getStitchList();this.stitchList.length==newList.length&&this.stitchList.every(function(element,index){return element===newList[index]})||(this.stitchList=newList,this.osdOptions={osdBounds:null,zoomLevel:null},this.osd.close(),this.createOpenSeadragonInstance())},createOpenSeadragonInstance:function(){var elemOsd,uniqueID=$.genUUID(),osdId="mirador-osd-"+uniqueID,tileSources=[],_this=this,toolbarID="osd-toolbar-"+uniqueID,dfd=jQuery.Deferred();this.element.find("."+this.osdCls).remove(),jQuery.each(this.stitchList,function(index,imageUrl){imageUrl=$.Iiif.getImageUrl(imageUrl);jQuery.getJSON(imageUrl+"/info.json").done(function(data,status,jqXHR){tileSources.splice(index,0,data),tileSources.length===_this.stitchList.length&&dfd.resolve()})}),dfd.done(function(){var aspectRatio=tileSources[0].height/tileSources[0].width;elemOsd=jQuery("<div/>").addClass(_this.osdCls).attr("id",osdId).appendTo(_this.element),_this.osd=$.OpenSeadragon({id:elemOsd.attr("id"),toolbarID:toolbarID}),_this.osd.addHandler("open",function(){_this.addLayer(tileSources.slice(1),aspectRatio);function addItemHandler(event){var rect;_this.osd.world.removeHandler("add-item",addItemHandler),_this.osdOptions.osdBounds?(rect=new OpenSeadragon.Rect(_this.osdOptions.osdBounds.x,_this.osdOptions.osdBounds.y,_this.osdOptions.osdBounds.width,_this.osdOptions.osdBounds.height),_this.osd.viewport.fitBounds(rect,!0)):_this.osd.viewport.goHome(!0)}_this.boundsToFocusOnNextOpen&&(_this.eventEmitter.publish("fitBounds."+_this.windowId,_this.boundsToFocusOnNextOpen),_this.boundsToFocusOnNextOpen=null),_this.osd.world.addHandler("add-item",addItemHandler),_this.osd.addHandler("zoom",$.debounce(function(){_this.setBounds()},300)),_this.osd.addHandler("pan",$.debounce(function(){_this.setBounds()},300))}),_this.osd.open(tileSources[0],{opacity:1,x:0,y:0,width:1})})},addLayer:function(tileSources,aspectRatio){var _this=this;jQuery.each(tileSources,function(index,value){var newAR=value.height/value.width;_this.osd.addTiledImage({tileSource:value,opacity:1,x:1.01,y:0,width:aspectRatio/newAR})})},next:function(){var next=this.currentImgIndex%2==0?this.currentImgIndex+1:this.currentImgIndex+2;next<this.imagesList.length&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[next]["@id"])},previous:function(){var prev=this.currentImgIndex%2==0?this.currentImgIndex-2:this.currentImgIndex-1;0<=prev&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[prev]["@id"])},getStitchList:function(){var stitchList=[],leftIndex=[],rightIndex=[],topIndex=[],bottomIndex=[],viewAdjustedImgIndex=this.currentImgIndex,_this=this;if(this.focusImages=[],"individuals"===this.viewingHint)stitchList=[this.currentImg];else if("paged"===this.viewingHint)if(0===(viewAdjustedImgIndex="right-to-left"===this.viewingDirection?this.imagesList.length-1-this.currentImgIndex:viewAdjustedImgIndex)||viewAdjustedImgIndex===this.imagesList.length-1)stitchList=[this.currentImg];else if(viewAdjustedImgIndex%2==0)switch(this.viewingDirection){case"left-to-right":leftIndex[0]=this.currentImgIndex-1,stitchList=[this.imagesList[this.currentImgIndex-1],this.currentImg];break;case"right-to-left":rightIndex[0]=this.currentImgIndex+1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex+1]];break;case"top-to-bottom":topIndex[0]=this.currentImgIndex-1,stitchList=[this.imagesList[this.currentImgIndex-1],this.currentImg];break;case"bottom-to-top":bottomIndex[0]=this.currentImgIndex-1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex-1]]}else switch(this.viewingDirection){case"left-to-right":rightIndex[0]=this.currentImgIndex+1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex+1]];break;case"right-to-left":leftIndex[0]=this.currentImgIndex-1,stitchList=[this.imagesList[this.currentImgIndex-1],this.currentImg];break;case"top-to-bottom":bottomIndex[0]=this.currentImgIndex+1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex+1]];break;case"bottom-to-top":topIndex[0]=this.currentImgIndex+1,stitchList=[this.imagesList[this.currentImgIndex+1],this.currentImg]}else this.viewingHint;return jQuery.each(stitchList,function(index,image){_this.focusImages.push(image["@id"])}),_this.eventEmitter.publish("UPDATE_FOCUS_IMAGES."+this.windowId,{array:this.focusImages}),stitchList}}}(Mirador),function($){$.ContextControls=function(options){jQuery.extend(this,{element:null,container:null,mode:null,windowId:null,annoEndpointAvailable:!1,eventEmitter:null},options),this.init()},$.ContextControls.prototype={init:function(){var _this=this,showStrokeStyle=!1,showStrokeColor=!1,showFillColor=!1;this.availableAnnotationStylePickers.forEach(function(picker){"StrokeType"===picker&&(showStrokeStyle=!0),"FillColor"===picker&&(showFillColor=!0),"StrokeColor"===picker&&(showStrokeColor=!0)}),this.setBackground={solid:function(el){_this.setBackgroundImage(el,"border_type_1.png")},dashed:function(el){_this.setBackgroundImage(el,"border_type_2.png")},dotdashed:function(el){_this.setBackgroundImage(el,"border_type_3.png")},thick:function(el){_this.setBackgroundImage(el,"border_type_4.png")},thickest:function(el){_this.setBackgroundImage(el,"border_type_5.png")}};var annotationProperties=this.canvasControls.annotations;annotationProperties.annotationLayer&&this.annoEndpointAvailable&&(this.annotationElement=jQuery(this.annotationTemplate({tools:_this.availableAnnotationTools,showEdit:annotationProperties.annotationCreation,showStrokeStyle:showStrokeStyle,showStrokeColor:showStrokeColor,showFillColor:showFillColor,showRefresh:annotationProperties.annotationRefresh})).appendTo(this.container.find(".mirador-osd-annotation-controls")),this.annotationElement.hide(),this.setQtips(this.container.find(".mirador-osd-annotation-controls")),this.setBorderFillColorPickers()),showStrokeStyle&&this.addStrokeStylePicker(),this.canvasControls.imageManipulation.manipulationLayer&&(this.manipulationElement=jQuery(this.manipulationTemplate({filtersSupported:Modernizr.cssfilters,showRotate:this.canvasControls.imageManipulation.controls.rotate,showBrightness:this.canvasControls.imageManipulation.controls.brightness,showContrast:this.canvasControls.imageManipulation.controls.contrast,showSaturate:this.canvasControls.imageManipulation.controls.saturate,showGrayscale:this.canvasControls.imageManipulation.controls.grayscale,showInvert:this.canvasControls.imageManipulation.controls.invert,showMirror:this.canvasControls.imageManipulation.controls.mirror})).appendTo(this.container.find(".mirador-manipulation-controls")),this.setQtips(this.container.find(".mirador-manipulation-controls")),this.manipulationElement.hide()),this.bindEvents()},setQtips:function(element){var _this=this;element.find("a").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"bottom center",at:"top center",viewport:!0,container:_this.qtipElement},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})})},addColorPicker:function(selector,options){this.container.find(selector).spectrum(options)},getImagePath:function(imageName){return this.state.getStateProperty("buildPath")+this.state.getStateProperty("imagesPath")+imageName},setBackgroundImage:function(el,imageName){el.css("background-image","url("+this.getImagePath(imageName)+")")},removeBackgroundImage:function(el){el.css("background-image","")},addStrokeStylePicker:function(){this.setBackground.solid(this.container.find(".mirador-line-type .solid")),this.setBackground.thick(this.container.find(".mirador-line-type .thick")),this.setBackground.thickest(this.container.find(".mirador-line-type .thickest")),this.setBackground.dashed(this.container.find(".mirador-line-type .dashed")),this.setBackground.dotdashed(this.container.find(".mirador-line-type .dotdashed"))},setBorderFillColorPickers:function(){var _this=this,defaultBorderColor=_this.state.getStateProperty("drawingToolsSettings").strokeColor,colorObj=_this.state.getStateProperty("drawingToolsSettings").fillColor,defaultAlpha=_this.state.getStateProperty("drawingToolsSettings").fillColorAlpha,colorObj=tinycolor(colorObj);colorObj.setAlpha(defaultAlpha),this.addColorPicker(".borderColorPicker",{showInput:!0,showInitial:!1,showPalette:!0,showButtons:!1,showSelectionPalette:!0,hideAfterPaletteSelect:!0,appendTo:"parent",containerClassName:"borderColorPickerPop"+_this.windowId,preferredFormat:"rgb",hide:function(color){_this.eventEmitter.publish("changeBorderColor."+_this.windowId,color.toHexString()),jQuery(this).spectrum("set",color.toHexString())},move:function(color){_this.eventEmitter.publish("changeBorderColor."+_this.windowId,color.toHexString())},show:function(color){_this.setColorPickerInCanvas(".borderColorPicker")},maxSelectionSize:4,color:defaultBorderColor,palette:[[defaultBorderColor,"black","red","green"],["white","blue","magenta","yellow"]]}),_this.container.find(".borderColorPicker").next(".sp-replacer").prepend("<i class='material-icons'>border_color</i>"),_this.addColorPicker(".fillColorPicker",{showInput:!0,showInitial:!1,showAlpha:!0,showPalette:!0,showButtons:!1,showSelectionPalette:!0,appendTo:"parent",clickoutFiresChange:!0,containerClassName:"fillColorPickerPop"+_this.windowId,preferredFormat:"rgb",hide:function(color){_this.eventEmitter.publish("changeFillColor."+_this.windowId,[color.toHexString(),color.getAlpha()]),jQuery(this).spectrum("set",color)},move:function(color){_this.eventEmitter.publish("changeFillColor."+_this.windowId,[color.toHexString(),color.getAlpha()])},show:function(color){_this.setColorPickerInCanvas(".fillColorPicker")},maxSelectionSize:4,color:colorObj,palette:[[colorObj,"black","red","green"],["white","blue","magenta","yellow"]]}),_this.container.find(".fillColorPicker").next(".sp-replacer").prepend("<i class='material-icons'>format_color_fill</i>")},setColorPickerInCanvas:function(windowWidth){var pickerContainer=this.container.find(windowWidth).siblings(".sp-container").first(),pickerOffset=pickerContainer.offset(),windowWidth=this.state.windowsElements[this.windowId].width();pickerContainer.width()+pickerOffset.left>windowWidth&&pickerContainer.css("left",windowWidth-pickerContainer.outerWidth())},annotationShow:function(){this.annotationElement.fadeIn("150")},annotationHide:function(){this.annotationElement.fadeOut("150")},manipulationShow:function(){this.manipulationElement.fadeIn("150")},manipulationHide:function(){this.manipulationElement.fadeOut("150")},bindEvents:function(){var _this=this;this.container.find(".mirador-line-type").on("mouseenter",function(){return!jQuery(this).hasClass("hud-disabled")&&void _this.container.find(".type-list").stop().slideFadeToggle(300)}),this.container.find(".mirador-line-type").on("mouseleave",function(){return!jQuery(this).hasClass("hud-disabled")&&void _this.container.find(".type-list").stop().slideFadeToggle(300)}),this.container.find(".mirador-line-type").find("ul li").on("click",function(){if(jQuery(this).hasClass("hud-disabled"))return!1;var className=jQuery(this).find("i").attr("class").replace(/fa/,"").replace(/ /,"");_this.removeBackgroundImage(_this.container.find(".mirador-line-type .border-type-image")),_this.setBackground[className](_this.container.find(".mirador-line-type .border-type-image")),_this.eventEmitter.publish("toggleBorderType."+_this.windowId,className)})},annotationTemplate:$.Handlebars.compile(["{{#if showEdit}}",'<a class="mirador-osd-pointer-mode hud-control selected" title="{{t "pointerTooltip"}}">','<i class="fa fa-mouse-pointer"></i>',"</a>","{{#each tools}}",'<a class="mirador-osd-{{this.logoClass}}-mode hud-control mirador-osd-edit-mode" title="{{t this.tooltip}}">','<i class="material-icons">{{this.logoClass}}</i>',"</a>","{{/each}}","{{#if showStrokeStyle}}",'<a class="hud-control hud-dropdown hud-disabled mirador-line-type" aria-label="{{t "borderTypeTooltip"}}" title="{{t "borderTypeTooltip"}}">','<i class="material-icons mirador-border-icon">create</i>','<i class="border-type-image solid"></i>','<i class="fa fa-caret-down dropdown-icon"></i>','<ul class="dropdown type-list">','<li><i class="fa solid"></i> {{t "solid"}}</li>','<li><i class="fa thick"></i> {{t "thick"}}</li>','<li><i class="fa thickest"></i> {{t "thickest"}}</li>','<li><i class="fa dashed"></i> {{t "dashed"}}</li>','<li><i class="fa dotdashed"></i> {{t "dotDashed"}}</li>',"</ul>","</a>","{{/if}}","{{#if showStrokeColor}}",'<a class="hud-control hud-dropdown hud-disabled mirador-osd-color-picker" title="{{t "borderColorTooltip"}}">','<input type="text" class="borderColorPicker"/>',"</a>","{{/if}}","{{#if showFillColor}}",'<a class="hud-control hud-dropdown hud-disabled mirador-osd-color-picker" title="{{t "fillColorTooltip"}}">','<input type="text" class="fillColorPicker"/>',"</a>","{{/if}}","{{#if showRefresh}}",'<a class="hud-control mirador-osd-refresh-mode">','<i class="fa fa-lg fa-refresh"></i>',"</a>","{{/if}}","{{/if}}"].join("")),manipulationTemplate:$.Handlebars.compile(["{{#if showRotate}}",'<a class="hud-control mirador-osd-rotate-right" title="{{t "rotateRightTooltip"}}">','<i class="fa fa-lg fa-rotate-right"></i>',"</a>",'<a class="hud-control mirador-osd-rotate-left" title="{{t "rotateLeftTooltip"}}">','<i class="fa fa-lg fa-rotate-left"></i>',"</a>","{{/if}}","{{#if filtersSupported}}","{{#if showBrightness}}",'<a class="hud-control mirador-osd-brightness" title="{{t "brightnessTooltip"}}">','<i class="material-icons">wb_sunny</i>','<i class="fa fa-caret-down"></i>','<div class="mirador-osd-brightness-slider mirador-slider"/>',"</a>","{{/if}}","{{#if showContrast}}",'<a class="hud-control mirador-osd-contrast" title="{{t "contrastTooltip"}}">','<i class="material-icons">brightness_6</i>','<i class="fa fa-caret-down"></i>','<div class="mirador-osd-contrast-slider mirador-slider"/>',"</a>","{{/if}}","{{#if showSaturate}}",'<a class="hud-control mirador-osd-saturation" title="{{t "saturationTooltip"}}">','<i class="material-icons">gradient</i>','<i class="fa fa-caret-down"></i>','<div class="mirador-osd-saturation-slider mirador-slider"/>',"</a>","{{/if}}","{{#if showGrayscale}}",'<a class="hud-control mirador-osd-grayscale" title="{{t "grayscaleTooltip"}}">','<i class="material-icons">filter_b_and_w</i>',"</a>","{{/if}}","{{#if showInvert}}",'<a class="hud-control mirador-osd-invert" title="{{t "invertTooltip"}}">','<i class="material-icons">invert_colors</i>',"</a>","{{/if}}","{{#if showMirror}}",'<a class="hud-control mirador-osd-mirror" title="{{t "mirrorTooltip"}}">','<i class="material-icons">swap_horiz</i>',"</a>","{{/if}}",'<a class="hud-control mirador-osd-reset" title="{{t "resetTooltip"}}">','<i class="fa fa-lg fa-refresh"></i>',"</a>","{{/if}}"].join("")),editorTemplate:$.Handlebars.compile(['<div class="mirador-osd-context-controls hud-container">','<a class="mirador-osd-back hud-control" role="button">','<i class="fa fa-lg fa-arrow-left"></i>',"</a>",'<a class="mirador-osd-rect-tool hud-control" role ="buton">','<i class="fa fa-lg fa-pencil-square"></i>',"</a>",'<a class="mirador-osd-rect-tool hud-control" role="button">','<i class="fa fa-lg fa-ellipsis-h"></i>',"</a>",'<a class="mirador-osd-rect-tool hud-control" role="button">','<i class="fa fa-lg fa-gear"></i>',"</a>","</div>"].join(""))}}(Mirador),function($){$.Hud=function(options){jQuery.extend(this,{element:null,windowId:null,annoState:null,annoEndpointAvailable:!1,eventEmitter:null},options),this.init()},$.Hud.prototype={init:function(){this.createStateMachines();var showAnno=void 0!==this.showAnno?this.showAnno:this.canvasControls.annotations.annotationLayer,showImageControls=void 0!==this.showImageControls?this.showImageControls:this.canvasControls.imageManipulation.manipulationLayer;this.element=jQuery(this.template({showNextPrev:this.showNextPrev,showBottomPanel:void 0===this.bottomPanelAvailable||this.bottomPanelAvailable,showAnno:showAnno,showImageControls:showImageControls})).appendTo(this.appendTo),(showAnno||showImageControls)&&(this.contextControls=new $.ContextControls({element:null,container:this.element.find(".mirador-osd-context-controls"),qtipElement:this.qtipElement,mode:"displayAnnotations",windowId:this.windowId,canvasControls:this.canvasControls,annoEndpointAvailable:this.annoEndpointAvailable,availableAnnotationTools:this.availableAnnotationTools,availableAnnotationStylePickers:this.availableAnnotationStylePickers,state:this.state,eventEmitter:this.eventEmitter})),this.listenForActions(),this.bindEvents()},listenForActions:function(){var _this=this;this.eventEmitter.subscribe("DISABLE_TOOLTIPS_BY_CLASS."+this.windowId,function(event,className){_this.element.find(className).qtip("disable")}),this.eventEmitter.subscribe("ENABLE_TOOLTIPS_BY_CLASS."+this.windowId,function(event,className){_this.element.find(className).qtip("enable")}),this.eventEmitter.subscribe("SET_STATE_MACHINE_POINTER."+this.windowId,function(event){"none"===_this.annoState.current?_this.annoState.startup():"off"===_this.annoState.current?_this.annoState.displayOn():_this.annoState.choosePointer()})},bindEvents:function(){},createStateMachines:function(){var _this=this;this.annoState=StateMachine.create({events:[{name:"startup",from:"none",to:"off"},{name:"displayOn",from:"off",to:"pointer"},{name:"displayOff",from:["pointer","shape"],to:"off"},{name:"choosePointer",from:["pointer","shape"],to:"pointer"},{name:"chooseShape",from:"pointer",to:"shape"},{name:"changeShape",from:"shape",to:"shape"},{name:"refresh",from:"pointer",to:"pointer"},{name:"refresh",from:"shape",to:"shape"}],callbacks:{onstartup:function(event,from,to){_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},ondisplayOn:function(event,from,to){_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-annotations-layer","selected"]),_this.annoEndpointAvailable&&_this.contextControls.annotationShow(),_this.eventEmitter.publish("modeChange."+_this.windowId,"displayAnnotations"),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("DISABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("DEFAULT_CURSOR."+_this.windowId),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},ondisplayOff:function(event,from,to){_this.annoEndpointAvailable&&(_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("CANCEL_ACTIVE_ANNOTATIONS."+_this.windowId),_this.contextControls.annotationHide()),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-annotations-layer","selected"]),_this.eventEmitter.publish("modeChange."+_this.windowId,"default"),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onchoosePointer:function(event,from,to){_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("DISABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("modeChange."+_this.windowId,"displayAnnotations"),_this.eventEmitter.publish("DEFAULT_CURSOR."+_this.windowId),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onchooseShape:function(event,from,to,shape){_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("ENABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-"+shape+"-mode","selected"]),_this.eventEmitter.publish("modeChange."+_this.windowId,"creatingAnnotation"),_this.eventEmitter.publish("CROSSHAIR_CURSOR."+_this.windowId),_this.eventEmitter.publish("toggleDrawingTool."+_this.windowId,shape),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onchangeShape:function(event,from,to,shape){_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("ENABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-"+shape+"-mode","selected"]),_this.eventEmitter.publish("CROSSHAIR_CURSOR."+_this.windowId),_this.eventEmitter.publish("toggleDrawingTool."+_this.windowId,shape),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onrefresh:function(event,from,to){}}}),this.manipulationState=StateMachine.create({events:[{name:"startup",from:"none",to:"manipulationOff"},{name:"displayOn",from:"manipulationOff",to:"manipulationOn"},{name:"displayOff",from:"manipulationOn",to:"manipulationOff"}],callbacks:{onstartup:function(event,from,to){_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,manipulationState:to})},ondisplayOn:function(event,from,to){_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-manipulation-toggle","selected"]),_this.contextControls.manipulationShow(),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,manipulationState:to})},ondisplayOff:function(event,from,to){_this.contextControls.manipulationHide(),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-manipulation-toggle","selected"]),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,manipulationState:to})}}})},template:$.Handlebars.compile(['<div class="mirador-hud">',"{{#if showNextPrev}}",'<a class="mirador-osd-previous hud-control ">','<i class="fa fa-3x fa-chevron-left "></i>',"</a>","{{/if}}",'<div class="mirador-osd-context-controls hud-container">',"{{#if showAnno}}",'<div class="mirador-osd-annotation-controls">','<a class="mirador-osd-annotations-layer hud-control" role="button" title="{{t "annotationTooltip"}}" aria-label="{{t "annotationTooltip"}}">','<i class="fa fa-lg fa-comments"></i>',"</a>","</div>","{{/if}}","{{#if showImageControls}}",'<div class="mirador-manipulation-controls">','<a class="mirador-manipulation-toggle hud-control" role="button" title="{{t "imageManipulationTooltip"}}" aria-label="{{t "imageManipulationTooltip"}}">','<i class="material-icons">tune</i>',"</a>","</div>","{{/if}}","</div>","{{#if showNextPrev}}",'<a class="mirador-osd-next hud-control ">','<i class="fa fa-3x fa-chevron-right"></i>',"</a>","{{/if}}","{{#if showBottomPanel}}",'<a class="mirador-osd-toggle-bottom-panel hud-control" role="button" aria-label="Toggle Bottom Panel">','<i class="fa fa-2x fa-ellipsis-h"></i>',"</a>","{{/if}}",'<div class="mirador-pan-zoom-controls hud-control">','<a class="mirador-osd-up hud-control" role="button" aria-label="Move image up">','<i class="fa fa-chevron-circle-up"></i>',"</a>",'<a class="mirador-osd-right hud-control" role="button" aria-label="Move image right">','<i class="fa fa-chevron-circle-right"></i>',"</a>",'<a class="mirador-osd-down hud-control" role="button" aria-label="Move image down">','<i class="fa fa-chevron-circle-down"></i>',"</a>",'<a class="mirador-osd-left hud-control" role="button" aria-label="Move image left">','<i class="fa fa-chevron-circle-left"></i>',"</a>",'<a class="mirador-osd-zoom-in hud-control" role="button" aria-label="Zoom in">','<i class="fa fa-plus-circle"></i>',"</a>",'<a class="mirador-osd-zoom-out hud-control" role="button" aria-label="Zoom out">','<i class="fa fa-minus-circle"></i>',"</a>",'<a class="mirador-osd-go-home hud-control" role="button" aria-label="Reset image bounds">','<i class="fa fa-home"></i>',"</a>","</div>","</div>"].join(""))}}(Mirador),function($){$.ImageView=function(options){jQuery.extend(this,{currentImg:null,windowId:null,currentImgIndex:0,canvasID:null,canvases:null,imagesList:[],imagesListRtl:[],element:null,elemOsd:null,manifest:null,osd:null,osdOptions:{osdBounds:null,zoomLevel:null},osdCls:"mirador-osd",elemAnno:null,annoCls:"annotation-canvas",annotationsLayer:null,forceShowControls:!1,eventEmitter:null,vDirectionStatus:""},options),this.init()},$.ImageView.prototype={init:function(){this.horizontallyFlipped=!1,this.originalDragHandler=null,"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListRtl.concat()),null!==this.canvasID&&(this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID)),this.osdOptions||(this.osdOptions={osdBounds:null,zoomLevel:null}),this.currentImg=this.imagesList[this.currentImgIndex],this.element=jQuery(this.template()).appendTo(this.appendTo),this.elemAnno=jQuery("<div/>").addClass(this.annoCls).appendTo(this.element),this.eventEmitter.publish("UPDATE_FOCUS_IMAGES."+this.windowId,{array:[this.canvasID]});var allTools=$.getTools(this.state.getStateProperty("drawingToolsSettings"));this.availableAnnotationTools=[];for(var i=0;i<this.state.getStateProperty("availableAnnotationDrawingTools").length;i++)for(var values,j=0;j<allTools.length;j++)this.state.getStateProperty("availableAnnotationDrawingTools")[i]==allTools[j].name&&((values={}).logoClass=allTools[j].logoClass,values.tooltip=allTools[j].tooltip,this.availableAnnotationTools.push(values));this.hud=new $.Hud({appendTo:this.element,qtipElement:this.qtipElement,bottomPanelAvailable:this.bottomPanelAvailable,windowId:this.windowId,canvasControls:this.canvasControls,annoEndpointAvailable:this.annoEndpointAvailable,showNextPrev:1!==this.imagesList.length,availableAnnotationStylePickers:this.state.getStateProperty("availableAnnotationStylePickers"),availableAnnotationTools:this.availableAnnotationTools,state:this.state,eventEmitter:this.eventEmitter}),this.initialiseImageCanvas(),this.bindEvents(),this.listenForActions(),void 0===this.bottomPanelAvailable||this.bottomPanelAvailable?this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,null):this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,!1)},template:$.Handlebars.compile(['<div class="image-view">',"</div>"].join("")),listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("bottomPanelSet."+_this.windowId,function(event,visible){var dodgers=_this.element.find(".mirador-osd-toggle-bottom-panel, .mirador-pan-zoom-controls"),arrows=_this.element.find(".mirador-osd-next, .mirador-osd-previous");!0===visible?(dodgers.addClass("bottom-panel-open"),arrows.addClass("bottom-panel-open")):(dodgers.removeClass("bottom-panel-open"),arrows.removeClass("bottom-panel-open"))}),_this.eventEmitter.subscribe("fitBounds."+_this.windowId,function(event,rect){rect=new OpenSeadragon.Rect(rect.x,rect.y,rect.width,rect.height);_this.osd.viewport.fitBoundsWithConstraints(rect,!1)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,_this.currentCanvasIDUpdated.bind(_this)),_this.eventEmitter.subscribe("image-needed"+_this.windowId,_this.loadImage.bind(_this)),_this.eventEmitter.subscribe("image-show"+_this.windowId,_this.showImage.bind(_this)),_this.eventEmitter.subscribe("image-hide"+_this.windowId,_this.hideImage.bind(_this)),_this.eventEmitter.subscribe("image-removed"+_this.windowId,_this.removeImage.bind(_this)),_this.eventEmitter.subscribe("image-opacity-updated"+_this.windowId,_this.updateImageOpacity.bind(_this)),_this.eventEmitter.subscribe("HUD_REMOVE_CLASS."+_this.windowId,function(event,elementSelector,className){_this.element.find(elementSelector).removeClass(className)}),_this.eventEmitter.subscribe("HUD_ADD_CLASS."+_this.windowId,function(event,elementSelector,className){_this.element.find(elementSelector).addClass(className)}),_this.eventEmitter.subscribe("HUD_FADE_IN."+_this.windowId,function(event,elementSelector,duration){_this.element.find(elementSelector).fadeIn(duration)}),_this.eventEmitter.subscribe("HUD_FADE_OUT."+_this.windowId,function(event,elementSelector,duration,complete){_this.element.find(elementSelector).fadeOut(duration,complete)}),_this.eventEmitter.subscribe("DEFAULT_CURSOR."+_this.windowId,function(event){jQuery(_this.osd.canvas).css("cursor","default")}),_this.eventEmitter.subscribe("CROSSHAIR_CURSOR."+_this.windowId,function(event){jQuery(_this.osd.canvas).css("cursor","crosshair")}),_this.eventEmitter.subscribe("POINTER_CURSOR."+_this.windowId,function(event){jQuery(_this.osd.canvas).css("cursor","pointer")})},bindEvents:function(){var _this=this;this.element.find(".mirador-osd-next").on("click",function(){_this.next()}),this.element.find(".mirador-osd-previous").on("click",function(){_this.previous()}),this.element.find(".mirador-osd-annotations-layer").on("click",function(){"none"===_this.hud.annoState.current&&_this.hud.annoState.startup(this),"off"===_this.hud.annoState.current?(_this.hud.annoState.displayOn(this),_this.annotationState="on"):(_this.forceShowControls=!1,_this.hud.annoState.displayOff(this),_this.annotationState="off")}),this.element.find(".mirador-manipulation-toggle").on("click",function(){"none"===_this.hud.manipulationState.current&&_this.hud.manipulationState.startup(this),"manipulationOff"===_this.hud.manipulationState.current?_this.hud.manipulationState.displayOn(this):_this.hud.manipulationState.displayOff(this)}),this.element.find(".mirador-osd-go-home").on("click",function(){_this.osd.viewport.goHome()}),this.element.find(".mirador-osd-up").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,-panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-right").on("click",function(){var panBy=_this.getPanByValue();_this.horizontallyFlipped?_this.osd.viewport.panBy(new OpenSeadragon.Point(-panBy.x,0)):_this.osd.viewport.panBy(new OpenSeadragon.Point(panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-down").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-left").on("click",function(){var panBy=_this.getPanByValue();_this.horizontallyFlipped?_this.osd.viewport.panBy(new OpenSeadragon.Point(panBy.x,0)):_this.osd.viewport.panBy(new OpenSeadragon.Point(-panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-zoom-in").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(+osd.zoomPerClick),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-zoom-out").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(1/osd.zoomPerClick),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-toggle-bottom-panel").on("click",function(){_this.eventEmitter.publish("TOGGLE_BOTTOM_PANEL_VISIBILITY."+_this.windowId)}),this.element.find(".mirador-osd-edit-mode").on("click",function(){var shape=jQuery(this).find(".material-icons").html();"pointer"===_this.hud.annoState.current?_this.hud.annoState.chooseShape(shape):_this.hud.annoState.changeShape(shape),_this.forceShowControls=!0,_this.element.find(".hud-control").stop(!0,!0).removeClass("hidden",_this.state.getStateProperty("fadeDuration"))}),this.element.find(".mirador-osd-pointer-mode").on("click",function(){"shape"===_this.hud.annoState.current&&(_this.hud.annoState.choosePointer(),_this.forceShowControls=!1)}),this.element.find(".mirador-osd-refresh-mode").on("click",function(){_this.eventEmitter.publish("updateAnnotationList."+_this.windowId)});var filterValues={brightness:"brightness(100%)",contrast:"contrast(100%)",saturate:"saturate(100%)",grayscale:"grayscale(0%)",invert:"invert(0%)"};function setFilterCSS(){var filterCSS=jQuery.map(filterValues,function(value,key){return value}).join(" ");jQuery(_this.osd.drawer.canvas).css({filter:filterCSS,"-webkit-filter":filterCSS,"-moz-filter":filterCSS,"-o-filter":filterCSS,"-ms-filter":filterCSS})}function resetImageManipulationControls(){_this.osd&&_this.osd.viewport.setRotation(0),filterValues.brightness="brightness(100%)",_this.element.find(".mirador-osd-brightness-slider").slider("option","value",100),_this.element.find(".mirador-osd-brightness-slider").find(".percent").text("100%"),filterValues.contrast="contrast(100%)",_this.element.find(".mirador-osd-contrast-slider").slider("option","value",100),_this.element.find(".mirador-osd-contrast-slider").find(".percent").text("100%"),filterValues.saturate="saturate(100%)",_this.element.find(".mirador-osd-saturation-slider").slider("option","value",100),_this.element.find(".mirador-osd-saturation-slider").find(".percent").text("100%"),filterValues.grayscale="grayscale(0%)",_this.element.find(".mirador-osd-grayscale").removeClass("selected"),filterValues.invert="invert(0%)",_this.element.find(".mirador-osd-invert").removeClass("selected"),jQuery(_this.osd.canvas).removeClass("mirador-mirror"),_this.originalDragHandler&&(_this.osd.viewport.viewer.innerTracker.dragHandler=_this.originalDragHandler),setFilterCSS()}this.element.find(".mirador-osd-rotate-right").on("click",function(){var currentRotation;_this.osd&&(currentRotation=_this.osd.viewport.getRotation(),_this.osd.viewport.setRotation(currentRotation+90))}),this.element.find(".mirador-osd-rotate-left").on("click",function(){var currentRotation;_this.osd&&(currentRotation=_this.osd.viewport.getRotation(),_this.osd.viewport.setRotation(currentRotation-90))}),this.element.find(".mirador-osd-brightness-slider").slider({orientation:"vertical",range:"min",min:0,max:200,value:100,create:function(event,ui){var span=jQuery(this).slider("value"),span=jQuery('<span class="percent">').text(span+"%");jQuery(this).find(".ui-slider-handle").append(span)},slide:function(event,ui){filterValues.brightness="brightness("+ui.value+"%)",setFilterCSS(),jQuery(this).find(".percent").text(ui.value+"%")}}).hide(),this.element.find(".mirador-osd-brightness").on("mouseenter",function(){_this.element.find(".mirador-osd-brightness-slider").stop(!0,!0).show()}).on("mouseleave",function(){_this.element.find(".mirador-osd-brightness-slider").stop(!0,!0).hide()}),this.element.find(".mirador-osd-contrast-slider").slider({orientation:"vertical",range:"min",min:0,max:200,value:100,create:function(event,ui){var span=jQuery(this).slider("value"),span=jQuery('<span class="percent">').text(span+"%");jQuery(this).find(".ui-slider-handle").append(span)},slide:function(event,ui){filterValues.contrast="contrast("+ui.value+"%)",setFilterCSS(),jQuery(this).find(".percent").text(ui.value+"%")}}).hide(),this.element.find(".mirador-osd-contrast").on("mouseenter",function(){_this.element.find(".mirador-osd-contrast-slider").stop(!0,!0).show()}).on("mouseleave",function(){_this.element.find(".mirador-osd-contrast-slider").stop(!0,!0).hide()}),this.element.find(".mirador-osd-saturation-slider").slider({orientation:"vertical",range:"min",min:0,max:200,value:100,create:function(event,ui){var span=jQuery(this).slider("value"),span=jQuery('<span class="percent">').text(span+"%");jQuery(this).find(".ui-slider-handle").append(span)},slide:function(event,ui){filterValues.saturate="saturate("+ui.value+"%)",setFilterCSS(),jQuery(this).find(".percent").text(ui.value+"%")}}).hide(),this.element.find(".mirador-osd-saturation").on("mouseenter",function(){_this.element.find(".mirador-osd-saturation-slider").stop(!0,!0).show()}).on("mouseleave",function(){_this.element.find(".mirador-osd-saturation-slider").stop(!0,!0).hide()}),this.element.find(".mirador-osd-grayscale").on("click",function(){jQuery(this).hasClass("selected")?(filterValues.grayscale="grayscale(0%)",jQuery(this).removeClass("selected")):(filterValues.grayscale="grayscale(100%)",jQuery(this).addClass("selected")),setFilterCSS()}),this.element.find(".mirador-osd-invert").on("click",function(){jQuery(this).hasClass("selected")?(filterValues.invert="invert(0%)",jQuery(this).removeClass("selected")):(filterValues.invert="invert(100%)",jQuery(this).addClass("selected")),setFilterCSS()}),this.element.find(".mirador-osd-mirror").on("click",function(){var viewer;_this.originalDragHandler||(_this.originalDragHandler=_this.osd.viewport&&_this.osd.viewport.viewer.innerTracker.dragHandler),jQuery(this).hasClass("selected")?(jQuery(_this.osd.canvas).removeClass("mirador-mirror"),jQuery(this).removeClass("selected"),_this.eventEmitter.publish("disableManipulation","mirror"),_this.osd.viewport&&(_this.osd.viewport.viewer.innerTracker.dragHandler=_this.originalDragHandler),_this.horizontallyFlipped=!1):(jQuery(_this.osd.canvas).addClass("mirador-mirror"),jQuery(this).addClass("selected"),_this.eventEmitter.publish("enableManipulation","mirror"),_this.osd.viewport&&((viewer=_this.osd.viewport.viewer).innerTracker.dragHandler=OpenSeadragon.delegate(viewer,function(event){event.delta.x=-event.delta.x,_this.originalDragHandler(event)})),_this.horizontallyFlipped=!0)}),this.element.find(".mirador-osd-reset").on("click",function(){resetImageManipulationControls()}),this.eventEmitter.subscribe("resetImageManipulationControls."+this.windowId,function(){resetImageManipulationControls()})},currentCanvasIDUpdated:function(event,canvasId){var firstCanvasId=this.imagesList[0]["@id"],lastCanvasId=this.imagesList[this.imagesList.length-1]["@id"];canvasId===firstCanvasId?(this.element.find(".mirador-osd-previous").hide(),this.element.find(".mirador-osd-next").show()):(canvasId===lastCanvasId?this.element.find(".mirador-osd-next").hide():this.element.find(".mirador-osd-next").show(),this.element.find(".mirador-osd-previous").show())},loadImage:function(event,imageResource){var bounds,_this=this;"drawn"!==imageResource.status&&(imageResource.setStatus("requested"),bounds=imageResource.getGlobalBounds(),_this.osd.addTiledImage({x:bounds.x,y:bounds.y,width:bounds.width,tileSource:imageResource.tileSource,opacity:imageResource.opacity,clip:imageResource.clipRegion,index:imageResource.zIndex,success:function(event){var tiledImage=event.item;imageResource.osdTiledImage=tiledImage,imageResource.setStatus("loaded"),_this.syncAllImageResourceProperties(imageResource);function tileDrawnHandler(event){event.tiledImage===tiledImage&&(imageResource.setStatus("drawn"),_this.osd.removeHandler("tile-drawn",tileDrawnHandler))}_this.osd.addHandler("tile-drawn",tileDrawnHandler)},error:function(event){imageResource.setStatus("failed")}}))},showImage:function(event,imageResource){"drawn"===imageResource.getStatus()&&this.updateImageOpacity(null,imageResource)},hideImage:function(event,imageResource){"drawn"===imageResource.getStatus()&&imageResource.osdTiledImage.setOpacity(0)},removeImage:function(){},updateImageOpacity:function(event,imageResource){imageResource.osdTiledImage&&imageResource.osdTiledImage.setOpacity(imageResource.opacity*imageResource.parent.getOpacity())},syncAllImageResourceProperties:function(imageResource){var bounds;imageResource.osdTiledImage&&(bounds=imageResource.getGlobalBounds(),imageResource.osdTiledImage.setPosition({x:bounds.x,y:bounds.y},!0),imageResource.osdTiledImage.setWidth(bounds.width,!0),imageResource.osdTiledImage.setOpacity(imageResource.getOpacity()*imageResource.parent.getOpacity()))},getPanByValue:function(){var bounds=this.osd.viewport.getBounds(!0);return{x:.5*bounds.width,y:.5*bounds.height}},setBounds:function(){this.osdOptions.osdBounds=this.osd.viewport.getBounds(!0),this.eventEmitter.publish("imageBoundsUpdated",{id:this.windowId,osdBounds:{x:this.osdOptions.osdBounds.x,y:this.osdOptions.osdBounds.y,width:this.osdOptions.osdBounds.width,height:this.osdOptions.osdBounds.height}});var rectangle=this.osdOptions.osdBounds;this.eventEmitter.publish("imageRectangleUpdated",{id:this.windowId,osdBounds:{x:Math.round(rectangle.x),y:Math.round(rectangle.y),width:Math.round(rectangle.width),height:Math.round(rectangle.height)},warning:"Warning, image rectangle now based on canvas dimensions, not the constituent images."})},toggle:function(stateValue){stateValue?this.show():this.hide()},hide:function(){jQuery(this.element).hide({effect:"fade",duration:300,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:300,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block")}})},adjustWidth:function(className,hasClass){hasClass?this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,className):this.eventEmitter.publish("ADD_CLASS."+this.windowId,className)},adjustHeight:function(className,hasClass){hasClass?this.element.removeClass(className):this.element.addClass(className)},initialiseImageCanvas:function(){var _this=this,originalState="mirador-osd-"+$.genUUID(),selected=_this.canvases[_this.canvasID];_this.elemOsd=jQuery("<div/>").addClass(_this.osdCls).attr("id",originalState).appendTo(_this.element),_this.osd=$.OpenSeadragon({id:originalState,uniqueID:originalState,preserveViewport:!0,blendTime:.1,alwaysBlend:!1,showNavigationControl:!1});originalState=selected.getBounds(),originalState=new OpenSeadragon.Rect(originalState.x,originalState.y,originalState.width,originalState.height);_this.osd.viewport.fitBounds(originalState,!0),selected.show(),selected.getVisibleImages().forEach(function(imageResource){_this.loadImage(null,imageResource)}),_this.osd.addHandler("zoom",$.debounce(function(){var point={x:-1e7,y:-1e7};_this.eventEmitter.publish("updateTooltips."+_this.windowId,[point,point])},30)),_this.osd.addHandler("pan",$.debounce(function(){var point={x:-1e7,y:-1e7};_this.eventEmitter.publish("updateTooltips."+_this.windowId,[point,point])},30)),_this.eventEmitter.publish("osdOpen."+_this.windowId),_this.addAnnotationsLayer(_this.elemAnno),_this.osdOptions.osdBounds?(shape=new OpenSeadragon.Rect(_this.osdOptions.osdBounds.x,_this.osdOptions.osdBounds.y,_this.osdOptions.osdBounds.width,_this.osdOptions.osdBounds.height),_this.osd.viewport.fitBounds(shape,!0)):_this.setBounds();var originalState=_this.hud.annoState.current,selected=_this.element.find(".mirador-osd-edit-mode.selected"),shape=null;selected&&(shape=selected.find(".material-icons").html()),"none"===originalState?_this.hud.annoState.startup():"off"===originalState||"off"===_this.annotationState||_this.hud.annoState.displayOff(),"pointer"===originalState||"on"===_this.annotationState?_this.hud.annoState.displayOn():"shape"===originalState&&(_this.hud.annoState.displayOn(),_this.hud.annoState.chooseShape(shape)),_this.osd.addHandler("zoom",$.debounce(function(){_this.setBounds()},500)),_this.osd.addHandler("pan",$.debounce(function(){_this.setBounds()},500))},addAnnotationsLayer:function(element){this.annotationsLayer=new $.AnnotationsLayer({state:this.state,annotationsList:this.state.getWindowAnnotationsList(this.windowId)||[],viewer:this.osd,windowId:this.windowId,element:element,eventEmitter:this.eventEmitter})},updateImage:function(canvasID){var newCanvas,rect;this.canvasID!==canvasID&&(this.canvases[this.canvasID].getVisibleImages().forEach(function(imageResource){imageResource.hide()}),this.canvasID=canvasID,this.currentImgIndex=$.getImageIndexById(this.imagesList,canvasID),this.currentImg=this.imagesList[this.currentImgIndex],rect=(newCanvas=this.canvases[this.canvasID]).getBounds(),rect=new OpenSeadragon.Rect(rect.x,rect.y,rect.width,rect.height),this.osd.viewport.fitBounds(rect,!0),newCanvas.show(),this.osdOptions={osdBounds:null,zoomLevel:null},this.eventEmitter.publish("resetImageManipulationControls."+this.windowId)),this.eventEmitter.publish("UPDATE_FOCUS_IMAGES."+this.windowId,{array:[canvasID]})},next:function(){var next=this.currentImgIndex+1;next<this.imagesList.length&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[next]["@id"])},previous:function(){var prev=this.currentImgIndex-1;0<=prev&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[prev]["@id"])}}}(Mirador),function($){$.LayersTab=function(options){jQuery.extend(!0,this,{windowId:null,element:null,appendTo:null,manifest:null,visible:null,state:null,eventEmitter:null,canvasID:null,canvases:null},options),this.init()},$.LayersTab.prototype={init:function(){this.localState({id:"layersTab",visible:this.visible,active:!0,canvasID:this.canvasID,empty:!1},!0),this.render(this.localState()),this.bindEvents(),this.listenForActions()},localState:function(state,initial){return arguments.length&&(this.layerTabState=state,initial||this.eventEmitter.publish("layersTabStateUpdated."+this.windowId,this.layerTabState)),this.layerTabState},tabStateUpdated:function(visible){var localState=this.localState();localState.visible=visible,this.localState(localState)},canvasIdUpdated:function(event,canvasID){var localState=this.localState();localState.canvasID=canvasID,this.localState(localState)},imageFocusUpdated:function(focus){var localState=this.localState();localState.active="ImageView"===focus,this.localState(localState)},updateImageResourceStatus:function(event,imageResource){var _this=this;["loaded","requested","initialized","drawn"].forEach(function(statusString){_this.element.find('.layers-list-item[data-imageid="'+imageResource.id+'"]').removeClass(statusString)}),this.element.find('.layers-list-item[data-imageid="'+imageResource.id+'"]').addClass(imageResource.getStatus())},showImageResource:function(event,imageResource){this.element.find('.visibility-toggle[data-imageid="'+imageResource.id+'"]').prop("checked",!0),this.element.find('.opacity-slider[data-imageid="'+imageResource.id+'"]').prop("disabled",!1),this.element.find('.opacity-label[data-imageid="'+imageResource.id+'"]').removeClass("disabled").text("("+Math.ceil(100*imageResource.getOpacity())+")%")},hideImageResource:function(event,imageResource){this.element.find('.visibility-toggle[data-imageid="'+imageResource.id+'"]').prop("checked",!1),this.element.find('.opacity-slider[data-imageid="'+imageResource.id+'"]').prop("disabled",!0),this.element.find('.opacity-label[data-imageid="'+imageResource.id+'"]').addClass("disabled").text("("+i18next.t("disabledOpacityMessage")+")")},updateImageResourceOpacity:function(event,imageResource){this.element.find('.opacity-slider[data-imageid="'+imageResource.id+'"]').val(100*imageResource.getOpacity()),this.element.find('.opacity-label[data-imageid="'+imageResource.id+'"]').text("("+Math.ceil(100*imageResource.getOpacity())+")%")},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("layersTabStateUpdated."+_this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,visible){visible="layersTab"===visible.tabs[visible.selectedTabIndex].options.id;_this.tabStateUpdated(visible)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,_this.canvasIdUpdated.bind(_this)),_this.eventEmitter.subscribe("image-status-updated"+_this.windowId,_this.updateImageResourceStatus.bind(_this)),_this.eventEmitter.subscribe("image-show"+_this.windowId,_this.showImageResource.bind(_this)),_this.eventEmitter.subscribe("image-hide"+_this.windowId,_this.hideImageResource.bind(_this)),_this.eventEmitter.subscribe("image-opacity-updated"+_this.windowId,_this.updateImageResourceOpacity.bind(_this)),_this.eventEmitter.subscribe("focusUpdated"+_this.windowId,function(event,focus){_this.imageFocusUpdated(focus)})},bindEvents:function(){var _this=this;this.element.find("img").on("load",function(event){jQuery(this).addClass("loaded"),jQuery(this).closest(".thumb-container").removeClass("awaiting-thumbnail")}),this.element.find("img").on("error",function(event){jQuery(this).addClass("failed"),jQuery(this).closest(".thumb-container").removeClass("awaiting-thumbnail"),jQuery(this).closest(".thumb-container").addClass("thumb-failed")}),this.element.on("input",".opacity-slider",function(event){_this.canvases[_this.localState().canvasID].getImageById(event.currentTarget.attributes["data-imageid"].nodeValue).setOpacity(event.currentTarget.value/100)}),this.element.on("change",".visibility-toggle",function(event){var eventedImageResource=_this.canvases[_this.localState().canvasID].getImageById(event.currentTarget.attributes["data-imageid"].nodeValue);event.currentTarget.checked?eventedImageResource.show():eventedImageResource.hide()})},render:function(state){var templateData=this.canvases[state.canvasID],templateData={active:state.active?"":"inactive",imagesFor:i18next.t("imagesFor"),hasLayers:0<templateData.images.length,canvasTitle:templateData.label,disabledLayersTabMessage:i18next.t("disabledLayersTabMessage"),layers:templateData.images.map(function(imageResource){return{visibleLabel:i18next.t("visibleLabel"),opacityLabel:i18next.t("opacityLabel"),disabledOpacityMessage:i18next.t("disabledOpacityMessage"),emptyTemplateMessage:i18next.t("emptyTemplateMessage"),imageId:imageResource.id,title:"No Label"===imageResource.label?i18next.t("noLabel"):imageResource.label,opacity:100*imageResource.getOpacity(),loadingStatus:imageResource.getStatus(),visibility:imageResource.getVisible(),url:imageResource.thumbUrl}})};this.element&&this.appendTo.find(".layersPanel").remove(),this.element=jQuery(this.template(templateData)).appendTo(this.appendTo),this.bindEvents(),state.visible?this.element.show():this.element.hide()},template:$.Handlebars.compile(['<div class="layersPanel {{active}}">',"<h3>{{imagesFor}} {{canvasTitle}}</h3>","{{#if hasLayers}}",'<ul class="layers-listing">',"{{#each layers}}",'<li class="layers-list-item {{loadingStatus}}" data-imageid="{{imageId}}">',"<h4>{{this.title}}</h4>",'<div class="thumb-container awaiting-thumbnail">','<img class="layer-thumb" src="{{url}}" alt="{{canvasTitle}} title="{{canvasTitle}}">','<span class="spinner"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></span>','<span class="failed"><i class="fa fa-ban fa-3x fa-fw"></i></span>','<span class="thumb-failed"><i class="fa fa-picture-o fa-3x fa-fw"></i></span>',"</div>","<form>","<div>",'<input class="visibility-toggle" data-imageid="{{imageId}}" type=checkbox {{#if visibility}}checked{{/if}}>',"<label> {{this.visibleLabel}}</label>","</div>",'<label>{{this.opacityLabel}} <span class="opacity-label {{#unless visibility}}disabled{{/unless}}" data-imageid="{{imageId}}">',"{{#unless visibility}}({{this.dsabledOpacityLabel}}){{else}}({{opacity}})%{{/unless}}","</span></label>",'<input class="opacity-slider" data-imageid="{{imageId}}" type="range" min="0" max="100" step="2" value="{{opacity}}" {{#unless visibility}}disabled{{/unless}}>',"</form>","</li>","{{/each}}","</ul>","{{else}}","<h4>{{emptyTemplateMessage}}</h4>","{{/if}}",'<div class="disabled-overlay">',"<h3>{{disabledLayersTabMessage}}</h3>","</div>","</div>"].join(""))}}(Mirador),function($){$.MetadataView=function(options){jQuery.extend(this,{manifest:null,element:null,metadataTypes:null,metadataListingCls:"metadata-listing"},options),this.init()},$.MetadataView.prototype={init:function(){var logo,_this=this,tplData={metadataListingCls:this.metadataListingCls};_this.manifest=_this.manifest.jsonLd,this.metadataTypes={},this.metadataTypes.details=_this.getMetadataDetails(_this.manifest),this.metadataTypes.rights=_this.getMetadataRights(_this.manifest),this.metadataTypes.links=_this.getMetadataLinks(_this.manifest),jQuery.each(this.metadataTypes,function(metadataKey,metadataValues){tplData[metadataKey]=[],jQuery.each(metadataValues,function(idx,itm){"object"==typeof itm.value&&(itm.value=_this.stringifyObject(itm.value)),"string"==typeof itm.value&&""!==itm.value&&tplData[metadataKey].push({identifier:itm.identifier||"",label:_this.extractLabelFromAttribute(itm.label),value:"links"===metadataKey?itm.value:_this.addLinksToUris(itm.value)})})}),_this.manifest.logo&&(logo="","string"==typeof _this.manifest.logo?logo=_this.manifest.logo:void 0!==_this.manifest.logo["@id"]&&(logo=_this.manifest.logo["@id"]),tplData.logo=logo),this.element=jQuery(this.template(tplData)).appendTo(this.appendTo),this.bindEvents()},stringifyObject:function(obj,nestingMargin){var str,i,_this=this,first=!0;if(obj instanceof RegExp)return"/"+obj.source+"/";if(void 0===nestingMargin&&(nestingMargin=0),obj instanceof Array)return str="[ ",jQuery.each(obj,function(i,item){str+=(0===i?"":", ")+_this.stringifyObject(item,nestingMargin+15)}),str+" ]";if("object"==typeof obj&&"sc:Collection"===obj["@type"]){var collectionUrl=obj["@id"];return'<a href="'+collectionUrl+'" target="_blank">'+(obj.label||collectionUrl)+"</a>"}if("object"!=typeof obj)return obj.toString();for(i in str='<div style="margin-left:'+nestingMargin+'px">',obj)obj.hasOwnProperty(i)&&(str+=(first?"":"<br/>")+i+": "+_this.stringifyObject(obj[i],nestingMargin+15),first=!1);return str+"</div>"},stringifyRelated:function(obj){var str,next,label,format,_this=this;return obj instanceof Array?(str="",jQuery.each(obj,function(i,item){""!==(next=_this.stringifyRelated(item))&&(str+=(0===i?"":"<br/>")+next)}),str):"object"==typeof obj&&"@id"in obj?(label="label"in obj?obj.label:obj["@id"],format="format"in obj&&"text/html"!==obj.format?"("+obj.format+")":"",'<a href="'+obj["@id"]+'"  target="_blank">'+label+"</a> "+format):_this.addLinksToUris(obj.toString())},getMetadataDetails:function(jsonLd){var mdList=[{label:i18next.t("label"),value:"<b>"+($.JsonLd.getTextValue(jsonLd.label)||"")+"</b>"},{label:i18next.t("description"),value:$.JsonLd.getTextValue(jsonLd.description)||""}];return jsonLd.metadata&&(value="",label="",jQuery.each(jsonLd.metadata,function(index,item){label=$.JsonLd.getTextValue(item.label),value=$.JsonLd.getTextValue(item.value),mdList.push({label:label,value:value})})),mdList},getMetadataRights:function(jsonLd){return[{identifier:"license",label:i18next.t("license"),value:jsonLd.license||""},{identifier:"attribution",label:i18next.t("attribution"),value:$.JsonLd.getTextValue(jsonLd.attribution)||""}]},getMetadataLinks:function(jsonLd){return[{identifier:"related",label:i18next.t("related"),value:this.stringifyRelated(jsonLd.related||"")},{identifier:"seeAlso",label:i18next.t("seeAlso"),value:this.stringifyRelated(jsonLd.seeAlso||"")},{identifier:"manifest",label:i18next.t("manifest"),value:this.stringifyRelated(jsonLd["@id"]||"")},{identifier:"within",label:i18next.t("within"),value:this.getWithin(jsonLd.within||"")}]},getWithin:function(within){if("object"!=typeof within||"sc:Collection"!==within["@type"])return within instanceof Array?within.map(this.getWithin,this).join("<br/>"):this.stringifyObject(within);var collectionUrl=within["@id"];return'<a href="'+collectionUrl+'" target="_blank">'+(within.label||collectionUrl)+"</a>"},extractLabelFromAttribute:function(attr){return attr.replace(/^@/,"").replace(/\s{2,}/g," ")},bindEvents:function(){},toggle:function(stateValue){stateValue?this.show():this.hide()},show:function(){var element=jQuery(this.element);(element=this.panel?element.parent():element).show({effect:"slide",direction:"right",duration:300,easing:"swing"})},hide:function(){var element=jQuery(this.element);(element=this.panel?element.parent():element).hide({effect:"slide",direction:"right",duration:300,easing:"swing"})},addLinksToUris:function(text){var parsedTextWithLinks,textWithLinks=text;return"string"==typeof text&&(-1===textWithLinks.indexOf("<a ")?(parsedTextWithLinks=text.match(/(http|ftp|https):\/\/[\w\-]+(\.[\w\-]+)+([\w.,@?\^=%&amp;:\/~+#\-]*[\w@?\^=%&amp;\/~+#\-])?/gi))&&jQuery.each(parsedTextWithLinks,function(index,match){textWithLinks=textWithLinks.replace(match,'<a href="'+match+'" target="_blank">'+match+"</a>")}):(parsedTextWithLinks=jQuery("<div />").append(textWithLinks),jQuery(parsedTextWithLinks[0]).find("a").attr("target","_blank"),textWithLinks=parsedTextWithLinks[0].innerHTML)),textWithLinks},template:$.Handlebars.compile(['<div class="sub-title">{{t "details"}}:</div>','<div class="{{metadataListingCls}}">',"{{#each details}}",'<div class="metadata-item"><div class="metadata-label">{{label}}:</div><div class="metadata-value">{{{value}}}</div></div>',"{{/each}}","</div>",'<div class="sub-title">{{t "rights"}}:</div>',"{{#if rights}}",'<div class="{{metadataListingCls}}">',"{{#each rights}}",'<div class="metadata-item {{identifier}}"><div class="metadata-label">{{label}}:</div><div class="metadata-value">{{{value}}}</div></div>',"{{/each}}","{{#if logo}}",'<div class="metadata-item"><div class="metadata-label">{{t "logo"}}:</div><img class="metadata-logo" src="{{logo}}"/></div>',"{{/if}}","</div>","{{else}}",'<div class="{{metadataListingCls}}">','<div class="metadata-item"><div class="metadata-label">{{t "rightsStatus"}}:</div><div class="metadata-value">{{t "unspecified"}}</div></div>',"</div>","{{/if}}","{{#if links}}",'<div class="sub-title">{{t "links"}}:</div>','<div class="{{metadataListingCls}}">',"{{#each links}}",'<div class="metadata-item {{identifier}}"><div class="metadata-label">{{label}}:</div><div class="metadata-value">{{{value}}}</div></div>',"{{/each}}","</dl>","{{/if}}"].join(""),{noEscape:!0})}}(Mirador),function($){$.ScrollView=function(options){jQuery.extend(this,{currentImgIndex:0,canvasID:null,focusImages:[],manifest:null,element:null,imagesList:[],appendTo:null,thumbInfo:{thumbsHeight:150,listingCssCls:"listing-thumbs",thumbnailCls:"thumbnail-view"},windowId:null,panel:!1,vDirectionStatus:"",lazyLoadingFactor:1.5},options),jQuery.extend($.ScrollView.prototype,$.ThumbnailsView.prototype),this.init(),"rtl"==this.vDirectionStatus&&jQuery(this.appendTo).find(".scroll-view").addClass("v-direction-rtl")}}(Mirador),function($){$.SearchTab=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,visible:null,canvasID:null,windowId:null,eventEmitter:null},options),this.init()},$.SearchTab.prototype={init:function(){this.windowId=this.windowId,this.localState({id:"searchTab",visible:this.visible},!0),this.listenForActions(),this.render(this.localState()),this.loadTabComponents()},localState:function(state,initial){return arguments.length&&(this.searchTabState=state,initial||this.eventEmitter.publish("searchTabStateUpdated."+this.windowId,this.searchTabState)),this.searchTabState},loadTabComponents:function(){},tabStateUpdated:function(data){"searchTab"===data.tabs[data.selectedTabIndex].options.id?this.element.show():this.element.hide()},toggle:function(){},listenForActions:function(){var _this=this;this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){_this.tabStateUpdated(data)})},displaySearchWithin:function(query_params,searchUrl){""!==query_params&&(this.searchObject=new $.SearchWithinResults({manifest:this.manifest,appendTo:this.element.find(".search-results-list"),panel:!0,canvasID:this.canvasID,windowId:this.windowId,imagesList:this.imagesList,thumbInfo:{thumbsHeight:80,listingCssCls:"panel-listing-thumbs",thumbnailCls:"panel-thumbnail-view"},query_params:query_params,searchService:searchUrl,eventEmitter:this.eventEmitter}))},bindEvents:function(){var _this=this;this.element.find(".js-perform-query").on("submit",function(searchUrl){searchUrl.preventDefault();var query=_this.element.find(".js-query").val(),motivation=_this.element.find(".js-motivation").val(),date=_this.element.find(".js-date").val(),user=_this.element.find(".js-user").val(),searchUrl=_this.element.find("#search-within-selector").val();_this.displaySearchWithin({q:query,motivation:motivation,date:date,user:user},searchUrl)}),this.element.find(".js-search-expand").on("click",function(event){event.preventDefault(),_this.element.find(".js-search-expanded").slideToggle("fast"),jQuery(this).text()===i18next.t("more")?jQuery(this).text(i18next.t("less")):jQuery(this).text()===i18next.t("less")&&jQuery(this).text(i18next.t("more"))})},render:function(state){var templateData=this.manifest.getSearchWithinService(),templateData={searchService:templateData&&templateData.map(function(data){return{url:data["@id"],label:data.label}})};this.element?(this.appendTo.find(".search-results").remove(),this.element=jQuery(this.template(templateData)).appendTo(this.appendTo)):(this.element=jQuery(this.template(templateData)).appendTo(this.appendTo),this.bindEvents()),state.visible?this.element.show():this.element.hide()},template:$.Handlebars.compile(['<div class="search-results">',"{{#if searchService}}",'<label for="search-within-selector">{{t "searchLabelSelect"}}</label>','<select id="search-within-selector" style="width: 100%">',"{{#each searchService}}",'<option value="{{ url }}">{{#if label}}{{ label }}{{ else }} {{ url }}{{/if}}</option>',"{{/each}}","</select>",'<form id="search-within-form" class="js-perform-query">','<input class="js-query" type="text" placeholder="{{t "searchText"}}"/>','<input style="margin: 10px 0" type="submit" value="{{t "submit"}}"/>','<div style="margin-bottom: 5px"><a class="js-search-expand" href="#">{{t "more"}}</a></div>','<div class="js-search-expanded" style="display: none;">','<input class="js-motivation" type="text" placeholder="motivation"/>','<input class="js-date" type="text" placeholder="date"/>','<input class="js-user" type="text" placeholder="user"/>',"</div>","</form>",'<div class="search-results-list"></div>',"{{else}}",'{{t "searchNotAvailable"}}',"{{/if}}","</div>"].join(""))}}(Mirador),function($){$.SearchWithinResults=function(options){jQuery.extend(this,{manifest:null,element:null,metadataTypes:null,metadataListingCls:"metadata-listing",searchService:null,windowId:null,query_params:null,currentPage:1,eventEmitter:null},options),this.init()},$.SearchWithinResults.prototype={init:function(){this.registerHandlebars(),jQuery(this.appendTo).empty(),this.element=jQuery(this.template()).appendTo(this.appendTo),jQuery("<h3>Search results for: "+this.query_params.q+"</h3>").appendTo(this.appendTo.find(".search-results-messages")),this.doSearchFromQuery(this.query_params)},doSearchFromQuery:function(query_params){for(var param in query_string="",query_params)"q"===param?query_string+=param+"="+query_params[param]:0<query_params[param].length&&(query_string+="&"+param+"="+query_params[param]);var url=this.searchService+"?"+query_string;this.doSearchFromUrl(url)},doSearchFromUrl:function(url){var _this=this;this.element.find(".search-results-container").empty(),jQuery.ajax({url:url,dataType:"json",async:!0}).done(function(searchResults){searchResults.resources?(_this.displayResultCounts(searchResults),_this.processResults(searchResults)):jQuery(".search-results-count").html("<p>No results</p>")}).fail(function(){jQuery(".search-results-count").html("<p>No results</p>")}).always()},displayResultCounts:function(searchResults){var total=searchResults.within.total,startResultNumber=searchResults.startIndex+1,endResultNumber="",endResultNumber=searchResults.resources.constructor===Array?searchResults.startIndex+searchResults.resources.length:searchResults.startIndex+1;jQuery(".search-results-count").html("<p>Showing "+startResultNumber+" - "+endResultNumber+" out of "+total+"</p>")},processResults:function(searchResults){searchResults.hits?this.tplData=this.getHits(searchResults):this.tplData=this.getSearchAnnotations(searchResults),jQuery($.Handlebars.compile("{{> resultsList }}")(this.tplData)).appendTo(jQuery(this.element.find(".search-results-container"))),this.bindEvents(),this.setPager(searchResults)},needsPager:function(results){if(!results||!results.within||!results.resources)return!1;var total=results.within.total;return Array.isArray(results.resources)?results.resources.length<total:1<total},setPager:function(searchResults){var _this=this,pager=this.element.find(".search-results-pager");this.needsPager(searchResults)&&pager.pagination&&(this.onPageCount||(this.onPageCount=searchResults.resources.length),pager.pagination({items:searchResults.within.total,itemsOnPage:_this.onPageCount,currentPage:_this.currentPage,displayedPages:1,edges:1,ellipsePageSet:!1,cssStyle:"compact-theme",hrefTextPrefix:"",prevText:'<i class="fa fa-lg fa-angle-left"></i>',nextText:'<i class="fa fa-lg fa-angle-right"></i>',onPageClick:function(pageNumber,event){event.preventDefault(),pager.pagination("disable"),pageNumber==_this.currentPage-1?(_this.currentPage--,_this.doSearchFromUrl(searchResults.prev)):pageNumber==_this.currentPage+1?(_this.currentPage++,_this.doSearchFromUrl(searchResults.next)):1==pageNumber?(_this.doSearchFromUrl(searchResults.within.first),_this.currentPage=1):(_this.doSearchFromUrl(searchResults.within.last),_this.currentPage=parseInt(_this.element.find(".search-results-pager li:nth-last-child(2)").text()))}}),pager.pagination("enable"))},float2int:function(num){return 0|num},parseSearchAnnotation:function(annotation){var id_parts=annotation.on;"object"==typeof id_parts&&(id_parts=annotation.on["@id"]);var canvaslabel=this.getLabel(annotation),id_parts=this.splitBaseUrlAndCoordinates(id_parts);return{canvasid:id_parts.base,coordinates:id_parts.coords,canvaslabel:canvaslabel,resulttext:annotation.resource.chars}},getSearchAnnotations:function(searchResults){var _this=this;if(tplData=[],null!==searchResults.resources)return Array.isArray(searchResults.resources)?searchResults.resources.forEach(function(annotation){tplData.push(_this.parseSearchAnnotation(annotation))}):(annotation=searchResults.resources,tplData.push(_this.parseSearchAnnotation(annotation))),tplData},getHits:function(searchResults){var _this=this;return tplData=[],searchResults.hits.forEach(function(hit){var resultObject,resultObjects=[];hit.annotations.forEach(function(canvasIDParts){var resource=_this.getHitResources(searchResults,canvasIDParts)[0],canvasLabel=_this.getLabel(resource),canvasIDParts=resource&&resource.on;"object"==typeof canvasIDParts&&(canvasIDParts=resource.on["@id"]);canvasIDParts=_this.splitBaseUrlAndCoordinates(canvasIDParts);resultObject={canvasid:canvasIDParts.base,coordinates:canvasIDParts.coords,canvaslabel:canvasLabel,hit:hit},resultObjects.push(resultObject)}),resultObjects&&(resultObject=resultObjects[0],1<resultObjects.length&&(resultObject.annotations=resultObjects),tplData.push(resultObject))}),tplData},getLabel:function(resource){var label;if(resource&&"object"==typeof resource)return resource.label||resource.resource.label||(resource.on&&"string"==typeof resource.on?(label=this.manifest.getCanvasLabel(resource.on))?"Canvas "+label:void 0:resource.on&&"object"==typeof resource.on&&(label=resource.on.label||this.manifest.getCanvasLabel(resource.on["@id"]))?"Canvas "+label:void 0)},getHitResources:function(searchResults,annotationid){return searchResults.resources.filter(function(resource){return resource["@id"]===annotationid})},splitBaseUrlAndCoordinates:function(parts){var coordinates,base=parts;return"string"==typeof parts&&(base=(parts=parts.split("#"))[0],2===parts.length&&(coordinates=parts[1])),{base:base,coords:coordinates}},bindEvents:function(){var _this=this;this.element.find(".js-show-canvas").on("click",function(bounds){bounds.stopPropagation();var canvasid=jQuery(this).attr("data-canvasid"),coordinates=jQuery(this).attr("data-coordinates"),bounds=coordinates&&coordinates.split("=")[1].split(",").map(Number),bounds=bounds&&{x:bounds[0],y:bounds[1],width:bounds[2],height:bounds[3]};jQuery(".result-wrapper,.result-wrapper *").css("background-color",""),jQuery(this).parent().css("background-color","lightyellow"),jQuery(this).is("a")&&jQuery(this).parent().next().css("background-color","lightyellow"),miniAnnotationList=[{"@id":"test","@type":"oa:Annotation",motivation:"sc:painting",resource:{"@type":"cnt:ContentAsText",chars:_this.query},on:canvasid+(coordinates?"#"+coordinates:"")}],_this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+_this.windowId,{canvasID:canvasid,bounds:bounds})})},registerHandlebars:function(){$.Handlebars.registerPartial("resultsList",["{{#each this}}",'<div class="result-wrapper">','<a class="search-result search-title js-show-canvas" data-canvasid="{{canvasid}}" data-coordinates="{{coordinates}}">',"{{canvaslabel}}","</a>","{{#if annotations}}","<div>","<em>Annotations</em>: ","{{#each annotations}}",'<a class="search-result search-annotation js-show-canvas" data-canvasid="{{canvasid}}" data-coordinates="{{coordinates}}">','<i class="fa fa-fw" aria-hidden="true">ïµ</i>',"</a>","{{/each}}","</div>","{{/if}}",'<div class="search-result result-paragraph js-show-canvas" data-canvasid="{{canvasid}}" data-coordinates="{{coordinates}}">',"{{#if hit.before}}","{{hit.before}} ","{{/if}}","{{#if hit.match}}",'<span class="highlight">{{hit.match}}</span>',"{{else}}","{{{resulttext}}}","{{/if}}","{{#if hit.after}}","{{ hit.after}}","{{/if}}","</div>","</div>","{{/each}}"].join(""))},template:$.Handlebars.compile(["<div>",'<div class="search-results-messages"></div>','<div class="search-results-count"></div>','<div class="search-results-pager"></div>','<div class="search-results-container">',"{{> resultsList }}","</div>","</div>"].join(""))}}(Mirador),function($){$.SidePanel=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,panelState:{},tocTabAvailable:null,annotationsTabAvailable:!1,layersTabAvailable:!1,searchTabAvailable:null,hasStructures:!1,state:null,eventEmitter:null},options),this.init()},$.SidePanel.prototype={init:function(){this.updateState({tabs:[{name:"toc",options:{available:this.tocTabAvailable,id:"tocTab",label:i18next.t("tabTitleIndex")}},{name:"annotations",options:{available:this.annotationsTabAvailable,id:"annotationsTab",label:"Anno."}},{name:"search",options:{available:this.searchTabAvailable,id:"searchTab",label:i18next.t("tabTitleSearch")}},{name:"layers",options:{available:this.layersTabAvailable,id:"layersTab",label:i18next.t("tabTitleLayers")}}],width:280,open:!0},!0),this.listenForActions(),this.render(this.updateState()),this.loadSidePanelComponents()},loadSidePanelComponents:function(){new $.Tabs({windowId:this.windowId,appendTo:this.appendTo,tabs:this.panelState.tabs,hasStructures:this.hasStructures,eventEmitter:this.eventEmitter}),this.tocTabAvailable&&new $.TableOfContents({structures:this.manifest.getStructures(),appendTo:this.element.find(".tabContentArea"),windowId:this.windowId,canvasID:this.canvasID,manifestVersion:this.manifest.getVersion(),eventEmitter:this.eventEmitter}),this.annotationsTabAvailable&&new $.AnnotationsTab({manifest:this.manifest,windowId:this.windowId,appendTo:this.element.find(".tabContentArea"),state:this.state,eventEmitter:this.eventEmitter}),this.searchTabAvailable&&new $.SearchTab({manifest:this.manifest,windowId:this.windowId,appendTo:this.element.find(".tabContentArea"),state:this.state,manifestVersion:this.manifest.getVersion(),eventEmitter:this.eventEmitter}),this.layersTabAvailable&&new $.LayersTab({manifest:this.manifest,windowId:this.windowId,appendTo:this.element.find(".tabContentArea"),canvasID:this.canvasID,canvases:this.canvases,state:this.state,eventEmitter:this.eventEmitter})},update:function(name,availability){var updatedState=this.panelState;jQuery.each(updatedState.tabs,function(index,value){value.name===name&&(value.options.available=availability)}),this.updateState(updatedState)},updateState:function(newState,initial){return arguments.length&&(jQuery.extend(!0,this.panelState,newState),initial||this.eventEmitter.publish("sidePanelStateUpdated."+this.windowId,this.panelState)),this.panelState},panelToggled:function(){var currentState=this.updateState(),open=!currentState.open;currentState.open=open,this.updateState(currentState)},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("sidePanelStateUpdated."+this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("sidePanelResized",function(){}),_this.eventEmitter.subscribe("sidePanelToggled."+this.windowId,function(){_this.panelToggled()}),_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(event){var windowObject=_this.state.getWindowObjectById(_this.windowId);windowObject.annotationsAvailable[windowObject.viewType]&&0<_this.state.getWindowAnnotationsList(_this.windowId).length&&_this.update("annotations",!0)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event,newCanvasId){_this.canvasID=newCanvasId})},render:function(renderingData){this.element||(this.element=this.appendTo,jQuery(this.template(renderingData)).appendTo(this.appendTo))},template:$.Handlebars.compile(['<div class="tabContentArea">','<ul class="tabGroup">',"</ul>","</div>"].join("")),toggle:function(enableSidePanel){enableSidePanel?(jQuery(this.appendTo).show({effect:"fade",duration:300,easing:"easeInCubic"}),this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,"focus-max-width"),this.eventEmitter.publish("SHOW_ICON_TOC."+this.windowId)):(jQuery(this.appendTo).hide(),this.eventEmitter.publish("ADD_CLASS."+this.windowId,"focus-max-width"),this.eventEmitter.publish("HIDE_ICON_TOC."+this.windowId))}}}(Mirador),function($){$.WidgetStatusBar=function(options){jQuery.extend(!0,this,{},$.DEFAULT_SETTINGS,options)}}(Mirador),function($){$.Tabs=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,windowId:null,tabState:{},tabs:[],eventEmitter:null},options),this.init()},$.Tabs.prototype={init:function(){this.state({tabs:this.tabs,selectedTabIndex:0},!0),this.listenForActions(),this.render(this.state()),this.bindEvents()},state:function(state,initial){return arguments.length&&(jQuery.extend(!0,this.tabState,state),initial||this.eventEmitter.publish("tabStateUpdated."+this.windowId,this.tabState)),this.tabState},tabSelected:function(index){var state=this.state();state.selectedTabIndex=index,this.state(state)},getTemplateData:function(){return{annotationsTab:this.state().annotationsTab,tocTab:this.state().tocTab,searchTab:this.state().searchTab}},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("tabStateUpdated."+this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("tabSelected."+this.windowId,function(_,data){_this.tabSelected(data)}),_this.eventEmitter.subscribe("tabFocused.",function(){})},bindEvents:function(){var _this=this;this.element.find(".tab").on("click",function(event){_this.eventEmitter.publish("tabSelected."+_this.windowId,jQuery(this).index())})},render:function(tabClass){if(!this.element){var tabs=jQuery.grep(tabClass.tabs,function(value,index){return value.options.available});return tabClass.tabs=tabs,1===tabClass.tabs.length&&("toc"!==tabClass.tabs[0].name||this.hasStructures||this.eventEmitter.publish("sidePanelVisibilityByTab."+this.windowId,!1),tabClass.tabs=[]),void(this.element=jQuery(this.template(tabClass)).prependTo(this.appendTo))}this.element.find(".tab").removeClass("selected");tabClass="."+tabClass.tabs[tabClass.selectedTabIndex].options.id;this.element.find(tabClass).addClass("selected")},template:$.Handlebars.compile(['<ul class="tabGroup">',"{{#each tabs}}",'<li class="tab {{this.options.id}} {{#unless @index}}selected{{/unless}}" data-tabId="{{this.options.id}}">',"{{this.options.label}}","</li>","{{/each}}","</ul>"].join("")),toggle:function(){}}}(Mirador),function($){$.ThumbnailsView=function(options){jQuery.extend(this,{currentImgIndex:0,canvasID:null,focusImages:[],manifest:null,element:null,imagesList:[],imagesListLtr:[],vDirectionStatus:"",appendTo:null,thumbInfo:{thumbsHeight:150,listingCssCls:"listing-thumbs",thumbnailCls:"thumbnail-view"},defaultThumbHeight:150,windowId:null,panel:!1,lazyLoadingFactor:1.5,eventEmitter:null},options),this.init()},$.ThumbnailsView.prototype={init:function(){null!==this.canvasID&&(this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID)),"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListLtr.concat()),this.loadContent(),"rtl"==this.vDirectionStatus&&(this.imagesList[0]["@id"],jQuery(this.appendTo).find(".panel-thumbnail-view").addClass("v-direction-rtl"),jQuery(this.appendTo).find(".thumbnail-view").find("li").each(function(){jQuery(this).addClass("thumbnail-rtl")})),this.bindEvents(),this.listenForActions()},loadContent:function(){var _this=this,tplData={defaultHeight:this.thumbInfo.thumbsHeight,listingCssCls:this.thumbInfo.listingCssCls,thumbnailCls:this.thumbInfo.thumbnailCls};tplData.thumbs=jQuery.map(this.imagesList,function(canvas,index){if(0===canvas.width)return{};var width=canvas.height/canvas.width,width=_this.thumbInfo.thumbsHeight/width;return{thumbUrl:$.getThumbnailForCanvas(canvas,width),title:$.JsonLd.getTextValue(canvas.label),id:canvas["@id"],width:width,highlight:_this.currentImgIndex===index?"highlight":""}}),this.element=jQuery(_this.template(tplData)).appendTo(this.appendTo)},updateImage:function(canvasId){this.currentImgIndex=$.getImageIndexById(this.imagesList,canvasId),this.element.find(".highlight").removeClass("highlight"),this.element.find("img[data-image-id='"+canvasId+"']").addClass("highlight"),this.element.find("img[data-image-id='"+canvasId+"']").parent().addClass("highlight")},updateFocusImages:function(focusList){var _this=this;this.element.find(".highlight").removeClass("highlight"),jQuery.each(focusList,function(index,canvasId){_this.element.find("img[data-image-id='"+canvasId+"']").addClass("highlight"),_this.element.find("img[data-image-id='"+canvasId+"']").parent().addClass("highlight")})},currentImageChanged:function(){var scrollPosition,target=this.element.find(".highlight"),windowObject=this.state.getWindowObjectById(this.windowId);target.position()&&(scrollPosition=windowObject&&"BookView"===windowObject.viewType?this.element.scrollLeft()+(target.position().left+(target.next().width()+target.outerWidth())/2)-this.element.width()/2:this.element.scrollLeft()+(target.position().left+target.width()/2)-this.element.width()/2),this.element.scrollTo(scrollPosition,900)},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event){_this.currentImageChanged()}),_this.eventEmitter.subscribe("windowResize",$.debounce(function(){_this.loadImages()},100))},bindEvents:function(){var _this=this;_this.element.find("img").on("load",function(){jQuery(this).hide().fadeIn(750,function(){jQuery(this).css("display","block")})}),jQuery(_this.element).scroll(function(){_this.loadImages()}),_this.element.find(".thumbnail-image").on("click",function(){var canvasID=jQuery(this).attr("data-image-id");_this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+_this.windowId,canvasID)})},toggle:function(stateValue){stateValue?this.show():this.hide()},loadImages:function(){var _this=this;jQuery.each(_this.element.find("img"),function(key,value){var url;$.isOnScreen(value,_this.lazyLoadingFactor)&&!jQuery(value).attr("src")&&(url=jQuery(value).attr("data"),_this.loadImage(value,url))})},loadImage:function(imageElement,url){$.createImagePromise(url).done(function(image){jQuery(imageElement).attr("src",image)})},reloadImages:function(newThumbHeight,triggerShow){var _this=this;this.thumbInfo.thumbsHeight=newThumbHeight,jQuery.each(this.imagesList,function(index,id){var newThumbURL=id.height/id.width,width=_this.thumbInfo.thumbsHeight/newThumbURL,newThumbURL=$.getThumbnailForCanvas(id,width),id=id["@id"];_this.element.find('img[data-image-id="'+id+'"]').attr("data",newThumbURL).attr("height",_this.thumbInfo.thumbsHeight).attr("width",width).attr("src","")}),triggerShow&&this.show()},template:$.Handlebars.compile(['<div class="{{thumbnailCls}}">','<ul class="{{listingCssCls}}" role="list" aria-label="Thumbnails">',"{{#thumbs}}",'<li class="{{highlight}}" role="listitem" aria-label="Thumbnail">','<img class="thumbnail-image {{highlight}}" title="{{title}}" data-image-id="{{id}}" src="" data="{{thumbUrl}}" height="{{../defaultHeight}}" width="{{width}}">','<div class="thumb-label">{{title}}</div>',"</li>","{{/thumbs}}","</ul>","</div>"].join("")),hide:function(){var element=jQuery(this.element);(element=this.panel?element.parent():element).hide({effect:"fade",duration:300,easing:"easeOutCubic"})},show:function(){var element=jQuery(this.element);this.panel&&(element=element.parent());var _this=this;element.show({effect:"fade",duration:300,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block"),_this.loadImages()}})},adjustWidth:function(className,hasClass){hasClass?this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,className):this.eventEmitter.publish("ADD_CLASS."+this.windowId,className)},adjustHeight:function(className,hasClass){hasClass?this.element.removeClass(className):this.element.addClass(className)}}}(Mirador),function($){$.TableOfContents=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,windowId:null,structures:[],manifestVersion:null,previousSelectedElements:[],selectedElements:[],previousOpenElements:[],openElements:[],hoveredElement:[],selectContext:null,tocData:{},active:null,eventEmitter:null},options),this.init();var self=this;window.render=function(){self.render()}},$.TableOfContents.prototype={init:function(){this.structures&&0!==this.structures.length?(this.element=jQuery(this.template({ranges:this.getTplData()})).appendTo(this.appendTo),this.tocData=this.initTocData(),this.setSelectedElements($.getRangeIDByCanvasID(this.structures,this.canvasID)),this.element.find(".has-child ul").hide(),this.render()):this.element=jQuery(this.emptyTemplate()).appendTo(this.appendTo),this.bindEvents()},tabStateUpdated:function(data){"tocTab"===data.tabs[data.selectedTabIndex].options.id?this.element.show():this.element.hide()},getTplData:function(){var ranges;this.structures.map(function(structure){return structure.id=structure["@id"],structure});switch(this.manifestVersion){case"1":ranges=this.extractV1RangeTrees(this.structures);break;case"2":ranges=this.extractV2RangeTrees(this.structures)}return ranges=ranges.length<2&&ranges[0].children?ranges[0].children:ranges},initTocData:function(){var _this=this,tocData={};return _this.structures.forEach(function(structure){var rangeID=structure["@id"];tocData[structure["@id"]]={element:_this.element.find('[data-rangeid="'+rangeID+'"]').closest("li")}}),tocData},extractV1RangeTrees:function(rangeList){return function unflatten(flatRanges,parent,tree){tree=void 0!==tree?tree:[],parent=void 0!==parent?parent:{"@id":"root",label:"Table of Contents"};var children=jQuery.grep(flatRanges,function(child){return child.within||(child.within="root"),child.within==parent["@id"]});return children.length&&("root"===parent["@id"]?(children.forEach(function(child){child.level=0}),tree=children):(children.forEach(function(child){child.level=parent.level+1}),parent.children=children),jQuery.each(children,function(index,child){unflatten(flatRanges,child)})),tree}(rangeList)},extractV2RangeTrees:function(rangeList){return function unflatten(flatRanges,parent,tree){tree=void 0!==tree?tree:[];var top,children=[];return(parent=void 0!==parent?parent:{"@id":"root",label:"Table of Contents"}).ranges?jQuery.each(parent.ranges,function(index,id){id="object"==typeof id?id["@id"]:id;var child=jQuery.grep(flatRanges,function(range,index){if(range["@id"]===id)return range})[0];child&&children.push(child)}):"root"===parent["@id"]&&((top=jQuery.grep(flatRanges,function(range,index){if(range.hasOwnProperty("viewingHint")&&"top"===range.viewingHint)return range})[0])&&children.push(top),0===children.length&&(jQuery.each(flatRanges,function(index,range){if(range.ranges)return children.push(range),!1}),0===children.length&&children.push({ranges:flatRanges}))),children.length&&("root"===parent["@id"]?(children.forEach(function(child){child.level=0}),tree=children):(children.forEach(function(child){child.level=parent.level+1}),parent.children=children),jQuery.each(children,function(index,child){unflatten(flatRanges,child)})),tree}(rangeList)},render:function(){var _this=this,toDeselect=_this.previousSelectedElements.map(function(rangeID){return _this.tocData[rangeID].element}),toSelect=_this.selectedElements.map(function(rangeID){return _this.tocData[rangeID].element}),toOpen=_this.openElements.filter(function(rangeID){return-1===jQuery.inArray(rangeID,_this.previousOpenElements)}).map(function(rangeID){return _this.tocData[rangeID].element}),toClose=_this.previousOpenElements.filter(function(rangeID){return-1===jQuery.inArray(rangeID,_this.openElements)}).map(function(rangeID){return _this.tocData[rangeID].element});_this.previousSelectedElements!==_this.selectedElements?(toDeselect.forEach(function(element){element.removeClass("selected")}),toSelect.forEach(function(element){element.addClass("selected")}),toClose.forEach(function(element){element.removeClass("open"),element.find("ul:first").slideFadeToggle()}),toOpen.forEach(function(element){element.addClass("open").find("ul:first").slideFadeToggle()})):(toOpen.forEach(function(element){element.addClass("open").find("ul:first").slideFadeToggle()}),toClose.forEach(function(element){element.removeClass("open").find("ul:first").slideFadeToggle()}))},bindEvents:function(){var _this=this;_this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){_this.tabStateUpdated(data)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event,canvasID){_this.structures&&(_this.setSelectedElements($.getRangeIDByCanvasID(_this.structures,canvasID)),_this.render())}),_this.element.find(".toc-link").on("click",function(canvasID){canvasID.stopPropagation();var rangeID=jQuery(this).data().rangeid,canvasID=jQuery.grep(_this.structures,function(item){return item["@id"]==rangeID})[0].canvases[0];_this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+_this.windowId,canvasID)}),_this.element.find(".toc-caret").on("click",function(rangeID){rangeID.stopPropagation();rangeID=jQuery(this).parent().data().rangeid;_this.setOpenItem(rangeID),_this.render()})},setActive:function(active){this.active=active},setOpenItem:function(rangeID){var _this=this,alreadyOpen=-1!==jQuery.inArray(rangeID,_this.openElements);_this.previousOpenElements=_this.openElements,_this.openElements=alreadyOpen?_this.openElements.filter(function(elementID){return elementID!==rangeID}):_this.openElements.map(function(elementID){return elementID}).concat([rangeID])},setSelectedElements:function(rangeIDs){var _this=this;_this.previousSelectedElements=_this.selectedElements,_this.selectedElements=rangeIDs,_this.previousOpenElements=_this.openElements,_this.openElements=_this.openElements.filter(function(openElementID){return-1===jQuery.inArray(openElementID,_this.previousSelectedElements)}).concat(rangeIDs).filter(function(openElementID,index,openElements){return index===openElements.indexOf(openElementID)})},emptyTemplate:$.Handlebars.compile(['<ul class="toc">','<li class="leaf-item open">','<h2><span>{{t "noIndex"}}</span></h2>',"</ul>"].join("")),template:function(tplData){var previousTemplate,template=$.Handlebars.compile(['<ul class="toc">',"{{#nestedRangeLevel ranges}}",'<li class="{{#if children}}has-child{{else}}leaf-item{{/if}}">',"{{{tocLevel id label level children}}}","{{#if children}}","<ul>","{{{nestedRangeLevel children}}}","</ul>","{{/if}}","<li>","{{/nestedRangeLevel}}","</ul>"].join(""));return $.Handlebars.registerHelper("nestedRangeLevel",function(children,options){var out="";return void 0!==options.fn&&(previousTemplate=options.fn),children.forEach(function(child){child.label=$.JsonLd.getTextValue(child.label),out+=previousTemplate(child)}),out}),$.Handlebars.registerHelper("tocLevel",function(id,label,level,children){return"<h"+(level+1)+'><a class="toc-link" data-rangeID="'+id+'"><i class="fa fa-caret-right toc-caret"></i><i class="fa fa-certificate star"></i><span>'+label+"</span></a></h"+(level+1)+">"}),template(tplData)},hide:function(){jQuery(this.appendTo).hide(),this.eventEmitter.publish("ADD_CLASS."+this.windowId,"focus-max-width")},show:function(){jQuery(this.appendTo).show({effect:"fade",duration:300,easing:"easeInCubic"}),this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,"focus-max-width")}}}(Mirador),function($){$.DialogBuilder=function(container){this.container=container||jQuery(".window"),bootbox.setDefaults({container:this.container})},$.DialogBuilder.prototype={confirm:function(message,callback){return this._attachEvents(bootbox.confirm(message,callback))},dialog:function(opts){this._attachEvents(bootbox.dialog(opts))},_attachEvents:function(el){var _this=this;el.init(function(){jQuery(el).css("z-index",2e4),jQuery(".modal-backdrop").prependTo(_this.container).css("z-index",2e4)}),jQuery(el).on("hidden.bs.modal",function(){jQuery(".modal-backdrop").remove()})}}}(Mirador),function($){$.EventEmitter=function(config){jQuery.extend(!0,this,{debug:$.EventEmitter.debug,trace:$.EventEmitter.trace,debugExclude:$.EventEmitter.excludePatterns},config),this.emitterId=$.EventEmitter.nextId(),this.debug&&(this.logger=new $.EventEmitter.Logger({trace:this.trace,debugExclude:this.debugExclude}))},$.EventEmitter.id=0,$.EventEmitter.nextId=function(){return $.EventEmitter.id++,$.EventEmitter.id},$.EventEmitter.debug=!1,$.EventEmitter.trace=!1,$.EventEmitter.excludePatterns=[],$.EventEmitter.Logger=function(options){this.trace=options.trace,this.debugExclude=options.debugExclude,this.scaffoldMap={}},$.EventEmitter.Logger.prototype={log:function(){(this.trace?console.trace:console.log).apply(console,arguments)},exclude:function(str){for(var patterns=this.debugExclude,i=0;i<patterns.length;++i)if(str.match(patterns[i]))return!0;return!1},scaffoldHandler:function(eventId,handler){function scaffold(){_this.log("EventEmitter:handler:",eventId,handler,Array.prototype.slice.call(arguments)),handler.apply(null,arguments)}var _this=this;return this.scaffoldMap[handler]=scaffold},unscaffold:function(handler){var scaffold=this.scaffoldMap[handler];return delete this.scaffoldMap[handler],scaffold}},["subscribe","unsubscribe","publish"].forEach(function(action){$.EventEmitter.prototype[action]=function(){var event,args=Array.prototype.slice.call(arguments),eventId=args[0],globalEventId=this.emitterId.toString()+"::"+eventId,logging=this.logger&&!this.logger.exclude(globalEventId);if("subscribe"===action&&(event={name:eventId,handler:args[1]},logging&&(args[1]=this.logger.scaffoldHandler(globalEventId,args[1]))),"unsubscribe"===action&&logging&&(args[1]=this.logger.unscaffold(args[1])),args[0]=globalEventId,logging&&this.logger.log("EventEmitter:"+action+":",args),jQuery[action].apply(jQuery,args),event)return event}})}(Mirador),Mirador.Iiif={getImageUrl:function(image){if(!image.images[0].resource.service)return id=(id=image.images[0].resource.default.service["@id"]).replace(/\/$/,"");var id=image.images[0].resource.service["@id"];return id=id.replace(/\/$/,"")},getVersionFromContext:function(context){return"http://iiif.io/api/image/2/context.json"==(context=context instanceof Array?context.filter(function(ctx){return"string"==typeof ctx&&0===ctx.indexOf("http://iiif.io")})[0]:context)?"2.0":"1.1"},getComplianceLevelFromProfile:function(profile){var compliance=-1,complianceString=null;if(profile)switch("string"==typeof profile?complianceString=profile:"object"==typeof profile&&(complianceString=profile[0]),complianceString){case"http://iiif.io/api/image/2/level0.json":compliance=0;break;case"http://iiif.io/api/image/2/level1.json":compliance=1;break;case"http://iiif.io/api/image/2/level2.json":compliance=2}return compliance},makeUriWithWidth:function(uri,width,version){return uri=uri.replace(/\/$/,""),"1"==version[0]?uri+"/full/"+width+",/0/native.jpg":uri+"/full/"+width+",/0/default.jpg"},getImageHostUrl:function(json){var regex,matches;return json.hasOwnProperty("image_host")||(json.image_host=json.tilesUrl||json["@id"]||"",json.hasOwnProperty("identifier")?(regex=new RegExp("/?"+json.identifier+"/?$","i"),json.image_host=json.image_host.replace(regex,"")):(matches=(regex=new RegExp("(.*)/(.*)$")).exec(json.image_host))&&1<matches.length&&(json.image_host=matches[1],json.identifier=matches[2])),json.image_host}},function($){var JSONBLOB_API_ENDPOINT="/api/jsonBlob";function initSettings(method,host,port,ajaxSettings,requestBody){ajaxSettings={type:method,url:function(host,port,path,body){var proto="http";return port=port||"80",path&&(proto="https",port=port||"443"),host=host||"jsonblob.com",path=JSONBLOB_API_ENDPOINT,("string"==typeof body||body instanceof String)&&(path+="/"+body),proto+"://"+host+":"+port+path}(host,port,ajaxSettings,requestBody),contentType:"application/json; charset=UTF-8",accept:"application/json",dataType:"json",processData:!1};return"string"==typeof requestBody||requestBody instanceof String||(ajaxSettings.data=JSON.stringify(requestBody)),ajaxSettings}$.JSONBlobAPI=function(options){this.options=options},$.JSONBlobAPI.prototype={readSync:function(settings){return method="GET",host=this.options.host,port=this.options.port,ssl=this.options.ssl,(settings=initSettings(method,host,port,ssl,settings=settings)).async=!1,settings.success=function(data,textStatus,request){result=data},jQuery.ajax(settings),result;var method,host,port,ssl,result},save:function(settings){var method,host,port,ssl,cb,deferred=jQuery.Deferred();return method="POST",host=this.options.host,port=this.options.port,ssl=this.options.ssl,cb=function(data,textStatus,blobid){blobid=blobid.getResponseHeader("X-Jsonblob");deferred.resolve(blobid)},(settings=initSettings(method,host,port,ssl,settings=settings)).success=cb,jQuery.ajax(settings),deferred.promise()}}}(Mirador),function($){$.JsonLd={getTextValue:function(propertyValue,language){var languages=i18next.languages||["en"];if("string"==typeof language?languages=[language].concat(languages):Array.isArray(language)&&(languages=language.concat(languages)),null==propertyValue)return"";if("string"==typeof propertyValue)return $.sanitizeHtml(propertyValue);if(Array.isArray(propertyValue)){var displayLanguage=function(languages,items){var itemLanguages=items.map(function(itm){return"string"==typeof itm?null:itm["@language"]}),bestLanguageMatch=null;return jQuery.each(languages,function(idx,lang){return null===bestLanguageMatch&&void(-1!==itemLanguages.indexOf(lang)&&(bestLanguageMatch=lang))}),bestLanguageMatch=null===bestLanguageMatch&&-1===itemLanguages.indexOf(null)?itemLanguages[0]:bestLanguageMatch}(languages,propertyValue),text="";return jQuery.each(propertyValue,function(idx,item){var textToAdd="";"string"==typeof item&&null===displayLanguage?textToAdd=item:item["@language"]===displayLanguage&&(textToAdd=item["@value"]),""!==textToAdd&&""!==text&&(text+="<br/>"),text+=textToAdd}),$.sanitizeHtml(text)}return $.sanitizeHtml(propertyValue["@value"])}}}(Mirador),function($){$.LocalJSONBlobAPI=function(opts){this.options={storage:window.localStorage},jQuery.extend(this.options,opts)},$.LocalJSONBlobAPI.prototype={readSync:function(blobId){return JSON.parse(this.options.storage.getItem(blobId))},save:function(blob){var d,deferred=jQuery.Deferred(),uuid=(d=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)}));return this.options.storage.setItem("BM-"+uuid,JSON.stringify(blob)),deferred.resolve("BM-"+uuid),deferred.promise()}}}(Mirador),Mirador.OpenSeadragon=function(options){return OpenSeadragon(jQuery.extend({preserveViewport:!0,visibilityRatio:1,minZoomLevel:0,defaultZoomLevel:0,blendTime:.1,alwaysBlend:!1,showNavigationControl:!1},options))},function($){$.SaveController=function(config){function index(previousValue,currentValue,currentIndex){var newObj={};return newObj[currentValue]=previousValue,newObj}jQuery.extend(!0,this,{currentConfig:null,originalConfig:null,shareEndpoint:null,historySize:null,sessionID:null,slots:[],eventEmitter:null}),config.availableAnnotationDrawingTools&&(config.availableAnnotationDrawingTools=jQuery.grep(config.availableAnnotationDrawingTools,function(element,index){return 0<=jQuery.inArray(element,$.DEFAULT_SETTINGS.availableAnnotationDrawingTools)})),config.mainMenuSettings&&!config.mainMenuSettings.buttons&&(config.mainMenuSettings.buttons={}),jQuery.each(config,function(key,object){"string"==typeof key&&-1!==key.indexOf(".")&&(object=key.split(".").reverse().reduce(index,object),delete config[key],jQuery.extend(!0,config,object))}),function iterateStringify(object){for(var property in object)object.hasOwnProperty(property)&&(object[property]instanceof Array?object[property]=JSON.stringify(object[property]):"object"==typeof object[property]&&iterateStringify(object[property]))}(config);var newConfig=jQuery.extend(!0,{},$.DEFAULT_SETTINGS,config);!function iterateParse(object){for(var property in object)object.hasOwnProperty(property)&&("string"==typeof object[property]&&"["===object[property][0]?object[property]=JSON.parse(object[property]):"object"==typeof object[property]&&iterateParse(object[property]))}(newConfig),this.init(newConfig)},$.SaveController.prototype={init:function(cleanURL){if(this.eventEmitter=cleanURL.eventEmitter,!1===cleanURL.saveSession)return this.currentConfig=cleanURL,this.bindEvents(),!1;var saveModule=cleanURL.jsonStorageEndpoint.module,jsonblob=cleanURL.jsonStorageEndpoint.options;this.storageModule=new $[saveModule](jsonblob);jsonblob=window.location.hash.substring(1);this.sessionID=jsonblob||$.genUUID(),localStorage.getItem(this.sessionID)?this.currentConfig=JSON.parse(localStorage.getItem(jsonblob)):(jsonblob=window.location.search.substring(1))?(jsonblob=jsonblob.split("=")[1],this.currentConfig=this.storageModule.readSync(jsonblob)||cleanURL):this.currentConfig=cleanURL,this.currentConfig.windowObjects=jQuery.map(this.currentConfig.windowObjects,function(value,index){return 0===Object.keys(value).length?null:value}),this.currentConfig.windowObjects&&jQuery.each(this.currentConfig.windowObjects,function(index,window){window.id||(window.id=$.genUUID())});cleanURL=window.location.href.replace(window.location.search,"");window.location.hash?history.replaceState(this.currentConfig,"Mirador Session",cleanURL):history.replaceState(this.currentConfig,"Mirador Session",cleanURL+"#"+this.sessionID),this.bindEvents()},getWindowObjectById:function(windowId){var returnObject=null;return jQuery.each(this.currentConfig.windowObjects,function(index,window){if(window.id===windowId)return returnObject=window,!1}),returnObject},getWindowAnnotationsList:function(windowId){return this.windowsAnnotationsLists?this.windowsAnnotationsLists[windowId]:null},getSlots:function(){return this.slots},getWindowElement:function(windowId){return this.windowsElements?this.windowsElements[windowId]:null},getStateProperty:function(prop){return this.get(prop,"currentConfig")},getManifestIndex:function(manifestUri){var manifestIndex=-1;return jQuery.each(this.currentConfig.data,function(index,dataObj){if(dataObj.manifestUri===manifestUri)return manifestIndex=index,!1}),manifestIndex},get:function(prop,parent){return(parent?this[parent]:this)[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value,this.currentConfig.saveSession&&this.save(),this.eventEmitter.publish("saveControllerConfigUpdated")},bindEvents:function(){var _this=this;_this.eventEmitter.subscribe("manifestsPanelVisible.set",function(event,manifestPanelVisible){_this.set("manifestPanelVisible",manifestPanelVisible,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("windowUpdated",function(event,options){var windowObjects=_this.currentConfig.windowObjects;windowObjects&&0<windowObjects.length?jQuery.each(windowObjects,function(index,window){window.id===options.id&&jQuery.extend(windowObjects[index],options)}):windowObjects=[options],_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("imageBoundsUpdated",function(event,options){var windowObjects=_this.currentConfig.windowObjects;windowObjects&&0<windowObjects.length&&jQuery.each(windowObjects,function(index,window){window.id===options.id&&(windowObjects[index].windowOptions||(windowObjects[index].windowOptions={}),windowObjects[index].windowOptions.osdBounds=options.osdBounds)}),_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("ANNOTATIONS_LIST_UPDATED",function(event,options){_this.windowsAnnotationsLists||(_this.windowsAnnotationsLists={}),_this.windowsAnnotationsLists[options.windowId]=options.annotationsList,_this.eventEmitter.publish("annotationListLoaded."+options.windowId)}),_this.eventEmitter.subscribe("WINDOW_ELEMENT_UPDATED",function(event,options){_this.windowsElements||(_this.windowsElements={}),_this.windowsElements[options.windowId]=options.element}),_this.eventEmitter.subscribe("windowSlotAddressUpdated",function(event,options){var windowObjects=_this.currentConfig.windowObjects;windowObjects&&0<windowObjects.length?jQuery.each(windowObjects,function(index,window){window.id===options.id&&jQuery.extend(windowObjects[index],options)}):windowObjects=[options],_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("manifestQueued",function(event,manifestObject,repository){var manifests=_this.currentConfig.data,objectInConfig=!1,url=manifestObject.uri;jQuery.each(manifests,function(index,manifestObject){manifestObject.manifestUri===url&&(objectInConfig=!0)}),objectInConfig||(manifests.push({manifestUri:url,location:repository}),_this.set("data",manifests,{parent:"currentConfig"}));manifests=_this.currentConfig.manifests;manifests[url]=manifestObject,_this.set("manifests",manifests,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("slotsUpdated",function(event,options){_this.slots=options.slots}),_this.eventEmitter.subscribe("layoutChanged",function(event,serialisedLayout){serialisedLayout=JSON.stringify(serialisedLayout,function(key,value){if("parent"!==key)return value});_this.set("layout",serialisedLayout,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("windowSlotAdded",function(event,options){var windowObjects=_this.currentConfig.windowObjects;0===jQuery.grep(windowObjects,function(windowObj){return windowObj.id===options.id}).length&&(windowObjects.push({id:options.id,slotAddress:options.slotAddress}),_this.set("windowObjects",windowObjects,{parent:"currentConfig"}))}),_this.eventEmitter.subscribe("windowsRemoved",function(event){_this.set("windowObjects",[],{parent:"currentConfig"})}),_this.eventEmitter.subscribe("windowRemoved",function(event,windowID){var windowObjects=jQuery.grep(_this.currentConfig.windowObjects,function(window,index){return window.id!==windowID});_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("DELETE_FROM_CONFIG",function(event,options){var windowObjects=jQuery.grep(_this.currentConfig.windowObjects,function(window,index){return window.loadedManifest!==options.loadedManifest||window.id});_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("etc...",function(junk){})},cleanup:function(obj){var clonedSet=[];return function cloner(obj){if(null===obj||"object"!=typeof obj)return obj;if(-1===clonedSet.indexOf(obj)){clonedSet.push(obj);var key,temp=Array.isArray(obj)?[]:{};for(key in obj)obj.hasOwnProperty(key)&&(temp[key]=cloner(obj[key]));return temp}}(obj)},save:function(){localStorage.setItem(this.sessionID,JSON.stringify(this.cleanup(this.currentConfig)))}}}(Mirador),function($){$.trimString=function(str){return str.replace(/^\s+|\s+$/g,"")},$.getImageIndexById=function(imagesList,id){var imgIndex=0;return jQuery.each(imagesList,function(index,img){$.trimString(img["@id"])===$.trimString(id)&&(imgIndex=index)}),imgIndex},$.getThumbnailForCanvas=function(resource,width){var service,version="1.1",compliance=-1;return width=parseInt(width,10),resource.hasOwnProperty("thumbnail")?"string"==typeof resource.thumbnail?resource.thumbnail:!resource.thumbnail.hasOwnProperty("service")||0===(compliance=(service=resource.thumbnail.service).hasOwnProperty("profile")?$.Iiif.getComplianceLevelFromProfile(service.profile):compliance)?resource.thumbnail["@id"]:(service.hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),$.Iiif.makeUriWithWidth(service["@id"],width,version)):((service=((resource=resource.images[0].resource).default||resource).service).hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),$.Iiif.makeUriWithWidth(service["@id"],width,version))},$.getQueryParams=function(queryString){function decode(s){return decodeURIComponent(s.replace(/\+/g," "))}var assoc={},queryString=queryString.split("?")[1];if(void 0===queryString)return{};var i,keyValues=queryString.split("&");for(i in keyValues){var key=keyValues[i].split("=");1<key.length&&(assoc[decode(key[0])]=decode(key[1]))}return assoc},$.genUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},jQuery.fn.slideFadeToggle=function(speed,easing,callback){return this.animate({opacity:"toggle",height:"toggle"},speed,easing,callback)},$.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;void 0!==options&&(options={});function later(){previous=!1===options.leading?0:new Date,timeout=null,result=func.apply(context,args)}return function(){var now=new Date;previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}},$.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;return function(){context=this,args=arguments,timestamp=new Date;var later=function(){var last=new Date-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args)))},callNow=immediate&&!timeout;return timeout=timeout||setTimeout(later,wait),result=callNow?func.apply(context,args):result}},$.isOnScreen=function(bounds,viewport){var el=1;viewport&&(el=viewport);var win=jQuery(window),viewport={top:win.scrollTop()*el,left:win.scrollLeft()*el};viewport.bottom=(viewport.top+win.outerHeight())*el,viewport.right=(viewport.left+win.outerWidth())*el;el=jQuery(bounds),bounds=el.offset();return bounds.bottom=bounds.top+el.height(),bounds.right=bounds.left+el.width(),!(viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom)},$.getRangeIDByCanvasID=function(ranges,canvasID){ranges=jQuery.grep(ranges,function(range){return-1<jQuery.inArray(canvasID,range.canvases)});return jQuery.map(ranges,function(range){return range["@id"]})},$.layoutDescriptionFromGridString=function(gridString){var columns=parseInt(gridString.substring(gridString.indexOf("x")+1,gridString.length),10),rowsPerColumn=parseInt(gridString.substring(0,gridString.indexOf("x")),10),layoutDescription={type:"row"};if("1x1"===gridString)return layoutDescription;layoutDescription.children=[];for(var i=0,c=columns;i<c;i++){var column={type:"column"};if(1<rowsPerColumn){column.children=[];for(var j=0,r=rowsPerColumn;j<r;j++)column.children.push({type:"row"})}layoutDescription.children.push(column)}return layoutDescription},$.createImagePromise=function(imageUrl){var img=new Image,dfd=jQuery.Deferred();return img.onload=function(){dfd.resolve(img.src)},img.onerror=function(){dfd.reject(img.src)},dfd.fail(function(){console.log("image failed to load: "+img.src)}),img.src=imageUrl,dfd.promise()},$.enterFullscreen=function(el){el.requestFullscreen?el.requestFullscreen():el.mozRequestFullScreen?el.mozRequestFullScreen():el.webkitRequestFullscreen?el.webkitRequestFullscreen():el.msRequestFullscreen&&el.msRequestFullscreen()},$.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},$.isFullscreen=function(){return 0<$.fullscreenElement().length},$.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement},$.sanitizeHtml=function(dirty){return sanitizeHtml(dirty,{allowedTags:["a","b","br","i","img","p","span","strong","em","ul","ol","li"],allowedAttributes:{a:["href","target"],img:["src","alt"],p:["dir"]}})}}(Mirador);
//# sourceMappingURL=mirador.min.js.map